<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>EPhone</title>
  <link rel="apple-touch-icon" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="EPhone">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" type="image/png" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <script src="https://unpkg.com/dexie/dist/dexie.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
  <script src="https://phoebeboo.github.io/mewoooo/pp.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/streamsaver@2.0.6/StreamSaver.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
</head>
<body>
  <div id="phone-screen">
    <div id="status-bar"> <span id="status-bar-time">12:00</span>
      <div id="status-bar-battery" class="battery-container"> <span class="battery-text">--%</span>
        <div class="battery-icon">
          <div class="battery-level"></div>
        </div>
      </div>
    </div>
    <div id="notification-bar"><img id="notification-avatar" src="">
      <div id="notification-content">
        <div class="name"></div>
        <div class="message"></div>
      </div>
    </div>
<div id="dynamic-island-content">
  <img id="island-album-art" src="">
  <div id="island-lyric-container">
    <span id="island-lyric-text"></span>
  </div>
</div>
    <div id="home-screen" class="screen active">
      <div id="home-screen-pages-container">
        <div id="home-screen-pages">
          <div class="home-screen-page">
            <div id="main-content-area">
              <div id="profile-widget"> <img id="profile-banner-img" src="https://i.imgur.com/1n3a43H.jpeg" class="editable-image">
                <div class="profile-avatar-container"> <img id="profile-avatar-img" src="https://i.postimg.cc/y8xWzCqj/anime-boy.jpg" class="editable-image"> </div>
                <div class="profile-info">
                  <p id="profile-username" class="editable-text">@ insonneve 🪦</p>
                  <p id="profile-sub-username" class="editable-text">@ insonneve</p>
                  <p id="profile-bio" class="editable-text">你好像过得很好 迫不及待的抹去我存在的痕迹</p>
                  <p id="profile-location" class="editable-text"> <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5-2.5-1.12 2.5-2.5 2.5z"></path>
                    </svg> <span>北海道</span> </p>
                </div>
              </div>
              <div id="desktop-layout">
                <div id="desktop-widget-column">
                  <div class="desktop-widget text-only">
                    <p id="widget-text-1" class="editable-text">Be fearless in pursuit of happiness</p>
                  </div>
                  <div class="desktop-widget icon-left"> <img id="widget-avatar-1" src="https://i.imgur.com/1n3a43H.jpeg" class="editable-image"> <span id="widget-text-2" class="editable-text">Dare to be different</span> </div>
                  <div class="desktop-widget icon-right"> <span id="widget-text-3" class="editable-text">* Keep your spirit free</span> <img id="widget-avatar-2" src="https://i.imgur.com/5A0tE9a.jpeg" class="editable-image"> </div>
                </div>
                <div id="desktop-app-container">
                  <div class="desktop-app-icon" onclick="showScreen('chat-list-screen')">
                    <div class="icon-bg-desktop"><img id="icon-img-qq" src="https://i.postimg.cc/MTC3Tkw8/IMG-6436.jpg" alt="QQ"></div> <span class="label"data-lang-key="homeAppQQ">QQ</span>
                  </div>
                  <div class="desktop-app-icon" onclick="showScreen('world-book-screen')">
                    <div class="icon-bg-desktop"><img id="icon-img-world-book" src="https://i.postimg.cc/HWf1JKzn/IMG-6435.jpg" alt="世界书"></div> <span class="label"data-lang-key="homeAppWorldBook">世界书</span>
                  </div>
                  <div class="desktop-app-icon" onclick="showScreen('wallpaper-screen')">
                    <div class="icon-bg-desktop"><img id="icon-img-wallpaper" src="https://i.postimg.cc/T1j03pQr/IMG-6440.jpg" alt="外观设置"></div> <span class="label"data-lang-key="homeAppAppearance">外观设置</span>
                  </div>
                  <div class="desktop-app-icon" onclick="openRenderingRulesScreen()">
                    <div class="icon-bg-desktop"><img id="icon-img-renderer" src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg" alt="渲染器"></div> <span class="label"data-lang-key="homeAppRenderer">渲染器</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="home-screen-page">
            <div class="polaroid-widget-container">
              <div class="polaroid-photos">
                <div class="polaroid-photo" style="transform: rotate(-6deg);" onclick="handleWidgetImageChange('polaroid-img-1')"> <img id="polaroid-img-1" src="https://i.imgur.com/Bv63o3h.jpg" alt="Photo 1"> </div>
                <div class="polaroid-photo" style="transform: rotate(2deg);" onclick="handleWidgetImageChange('polaroid-img-2')"> <img id="polaroid-img-2" src="https://i.imgur.com/GzPzBfF.jpg" alt="Photo 2"> </div>
                <div class="polaroid-photo" style="transform: rotate(5deg);" onclick="handleWidgetImageChange('polaroid-img-3')"> <img id="polaroid-img-3" src="https://i.imgur.com/Wp72cEM.jpg" alt="Photo 3"> </div>
              </div>
            </div>
            <div id="page-2-app-container">
              <div class="large-widget" onclick="handleWidgetImageChange('large-widget-img')"> <img class="large-widget-img" id="large-widget-img" src="https://i.imgur.com/Bv63o3h.jpg" alt="Colorful Widget"> </div>
              <div class="app-subgrid">
                <div class="small-widget" onclick="openPresetScreen()">
                  <div class="small-widget-icon-wrapper"> <img class="small-widget-img" id="icon-img-preset" src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg" alt="预设"> </div> <span class="small-widget-label"data-lang-key="homeAppPreset">预设</span>
                </div>
                <div class="small-widget" onclick="showScreen('tutorial-screen')">
                  <div class="small-widget-icon-wrapper"> <img class="small-widget-img" id="icon-img-tutorial" src="https://i.postimg.cc/d10GjC4g/IMG-7302.jpg" alt="教程"> </div> <span class="small-widget-label"data-lang-key="homeAppTutorial">教程</span>
                </div>
                <div class="small-widget" onclick="openWerewolfLobby('global')">
                  <div class="small-widget-icon-wrapper"> <img class="small-widget-img" id="icon-img-werewolf" src="https://i.postimg.cc/k401K5g7/IMG-7304.jpg" alt="狼人杀"> </div> <span class="small-widget-label"data-lang-key="homeAppWerewolf">狼人杀</span>
                </div>
                <div class="small-widget" onclick="showScreen('x-social-screen')">
                  <div class="small-widget-icon-wrapper"> <img class="small-widget-img" id="icon-img-x" src="https://i.postimg.cc/Y9d3BztC/1.png" alt="X"> </div> <span class="small-widget-label"data-lang-key="homeAppX">X</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="home-screen-pagination">
        <div class="pagination-dot active"></div>
        <div class="pagination-dot"></div>
      </div>
      <div id="desktop-dock">
        <div class="desktop-app-icon" onclick="showScreen('api-settings-screen')">
          <div class="icon-bg-desktop"><img id="icon-img-api-settings" src="https://i.postimg.cc/MK8rJ8t7/IMG-6438.jpg" alt="API设置"></div> <span class="label"data-lang-key="homeAppApiSettings">API设置</span>
        </div>
        <div class="desktop-app-icon" onclick="showScreen('font-settings-screen')">
          <div class="icon-bg-desktop"><img id="icon-img-font" src="https://i.postimg.cc/pXxk1JXk/IMG-6442.jpg" alt="字体"></div> <span class="label"data-lang-key="homeAppFont">字体</span>
        </div>
        <div class="desktop-app-icon" onclick="openCharacterSelector()">
          <div class="icon-bg-desktop"><img id="icon-img-char-phone" src="https://i.postimg.cc/pXj9h20L/IMG-7275.jpg" alt="Cphone"></div> <span class="label"data-lang-key="homeAppCPhone">Cphone</span>
        </div>
        <div class="desktop-app-icon" onclick="showScreen('douban-screen')">
          <div class="icon-bg-desktop"><img id="icon-img-douban" src="https://i.postimg.cc/Pq2xJN1g/IMG-7301.jpg" alt="豆瓣"></div> <span class="label"data-lang-key="homeAppDouban">豆瓣</span>
        </div>
      </div>
    </div>
    <div id="character-selection-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span data-lang-key="cphoneTitleSelect">选择一部手机</span> <span style="width: 30px;"></span> </div>
      <div id="character-grid" class="list-container"> </div>
    </div>
    <div id="character-phone-screen" class="screen">
      <div id="char-home-screen" class="char-screen active">
        <div id="char-clock-container">
          <div id="char-main-time">12:00</div>
          <div id="char-main-date">1月1日 星期一</div>
        </div>
        <div id="char-app-grid">
          <div class="app-row">
            <div class="app-icon" onclick="openCharApp('qq')">
              <div class="icon-bg"><img id="cphone-icon-img-qq" src=""></div><span class="label">QQ</span>
            </div>
            <div class="app-icon" onclick="openCharApp('album')">
              <div class="icon-bg"><img id="cphone-icon-img-album" src=""></div><span class="label" data-lang-key="cphoneAppAlbum">相册</span>
            </div>
            <div class="app-icon" onclick="openCharApp('browser')">
              <div class="icon-bg"><img id="cphone-icon-img-browser" src=""></div><span class="label" data-lang-key="cphoneAppBrowser">浏览器</span>
            </div>
            <div class="app-icon" onclick="openCharApp('taobao')">
              <div class="icon-bg"><img id="cphone-icon-img-taobao" src=""></div><span class="label"data-lang-key="cphoneAppTaobao">淘宝</span>
            </div>
          </div>
          <div class="app-row">
            <div class="app-icon" onclick="openCharApp('memo')">
              <div class="icon-bg"><img id="cphone-icon-img-memo" src=""></div><span class="label"data-lang-key="cphoneAppMemo">备忘录</span>
            </div>
            <div class="app-icon" onclick="openCharApp('diary')">
              <div class="icon-bg"><img id="cphone-icon-img-diary" src=""></div><span class="label"data-lang-key="cphoneAppDiary">日记</span>
            </div>
            <div class="app-icon" onclick="openCharApp('amap')">
              <div class="icon-bg"><img id="cphone-icon-img-amap" src=""></div><span class="label"data-lang-key="cphoneAppAmap">高德地图</span>
            </div>
            <div class="app-icon" onclick="openCharApp('usage')">
              <div class="icon-bg"><img id="cphone-icon-img-usage" src=""></div><span class="label"data-lang-key="cphoneAppUsage">App记录</span>
            </div>
          </div>
          <div class="app-row">
            <div class="app-icon" onclick="openCharApp('music')">
              <div class="icon-bg"><img id="cphone-icon-img-music" src=""></div><span class="label"data-lang-key="cphoneAppMusic">网易云</span>
            </div>
            <div class="app-icon" onclick="switchToMyPhone()">
              <div class="icon-bg"><img id="cphone-icon-img-ephone" src=""></div><span class="label"data-lang-key="cphoneAppEphone">Ephone</span>
            </div>
          </div>
        </div>
      </div>
      <div id="char-amap-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span>足迹</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-amap-btn" title="重新生成足迹"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-amap-list" class="list-container"> </div>
      </div>
      <div id="char-qq-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span>QQ</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-qq-btn" title="重新生成"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-chat-list" class="list-container"></div>
      </div>
      <div id="char-qq-conversation-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="back-to-char-qq-list-btn">‹</span> <span id="char-conversation-partner-name"></span> <span style="width: 30px;"></span> </div>
        <div id="char-conversation-messages" class="list-container"> </div>
        <div id="char-conversation-input-area" style="padding: 8px; border-top: 1px solid var(--border-color); display: flex; gap: 8px; background-color: #f7f7f7;"> <input type="text" id="char-simulated-input" placeholder="这是模拟对话，无法发送消息" data-lang-key-placeholder="cphoneSimulatedChatPlaceholder"disabled
            style="flex-grow: 1; padding: 10px; border-radius: 6px; border: 1px solid #ddd; background: #eee;"> <button id="char-simulated-send-btn" style="padding: 0 20px; border: none; background-color: var(--accent-color); color: white; border-radius: 6px; font-weight: 500;">发送</button> </div>
      </div>
      <div id="char-album-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span data-lang-key="cphoneAlbumTitle">TA的相册</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-album-btn" title="重新生成相册内容"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div class="list-container">
          <div id="char-album-grid"></div>
        </div>
      </div>
      <div id="char-browser-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span data-lang-key="cphoneBrowserTitle">TA的浏览器历史</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-browser-btn" title="重新生成浏览记录"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-browser-history" class="list-container"> </div>
      </div>
      <div id="char-browser-article-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharScreen('char-browser-screen')">‹</span> <span id="char-article-title" style="max-width: 70%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">文章</span>
          <div class="header-actions"> <span class="action-btn" id="favorite-article-btn" title="收藏"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg> </span> <span class="action-btn" id="copy-article-content-btn" title="复制内容"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg> </span> </div>
        </div>
        <div id="char-article-content" class="list-container" style="padding: 20px; font-size: 16px; line-height: 1.8; overflow-y: auto;"></div>
      </div>
      <div id="char-taobao-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span data-lang-key="cphoneTaobaoTitle">TA的淘宝订单</span>
          <div class="header-actions"> <span class="action-btn" id="char-wallet-btn" title="查看钱包" onclick="openCharWallet()"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M20 12V8H4v4"></path>
                <path d="M4 8V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v2"></path>
                <path d="M18 12v6a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-6"></path>
              </svg> </span> <span class="action-btn" id="regenerate-char-taobao-btn" title="重新生成购买记录"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-product-grid" class="list-container"></div>
      </div>
      <div id="char-wallet-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="char-wallet-back-btn">‹</span> <span data-lang-key="cphoneWalletTitle">钱包</span> <span style="width: 30px;"></span> </div>
        <div id="char-wallet-content" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
      </div>
      <div id="char-memo-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span data-lang-key="cphoneMemoTitle">备忘录</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-memo-btn" title="重新生成备忘录"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> <span class="action-btn" id="add-char-memo-btn">+</span> </div>
        </div>
        <div id="char-memo-list" class="list-container" style="padding: 10px;"></div>
      </div>
      <div id="char-memo-detail-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="char-memo-detail-back-btn">‹</span> <span id="char-memo-detail-title"></span>
          <div class="header-actions"> <span class="action-btn" id="favorite-memo-btn" title="收藏"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg> </span> <span class="action-btn" id="copy-memo-content-btn" title="复制内容"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg> </span> </div>
        </div>
        <div class="form-container" style="padding: 0;"> <textarea id="char-memo-detail-content" readonly></textarea> </div>
      </div>
      <div id="char-diary-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span data-lang-key="cphoneDiaryTitle">日记</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-diary-btn" title="重新生成日记本"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> <span class="action-btn" id="add-char-diary-btn">+</span> </div>
        </div>
        <div id="char-diary-list" class="list-container"></div>
      </div>
      <div id="char-diary-detail-screen" class="char-screen">
        <div class="header"> <span class="back-btn" id="char-diary-detail-back-btn">‹ </span> <span id="char-diary-detail-title"></span>
          <div class="header-actions"> <span class="action-btn" id="favorite-diary-btn" title="收藏"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg> </span> <span class="action-btn" id="copy-diary-content-btn" title="复制内容"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg> </span> </div>
        </div>
        <div id="char-diary-detail-content-wrapper" class="list-container">
          <div id="char-diary-detail-content"> </div>
        </div>
      </div>
      <div id="char-usage-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span data-lang-key="cphoneUsageTitle">App使用记录</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-usage-btn" title="重新生成记录"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-usage-list" class="list-container"> </div>
      </div>
      <div id="char-qq-transcript-modal" class="modal">
        <div class="modal-content" style="height: 80%;">
          <div class="modal-header"> <span id="transcript-modal-char-name"></span> </div>
          <div class="modal-body" id="transcript-modal-body" style="background-color: #f0f2f5; padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
          <div class="modal-footer"> <button class="save" id="close-transcript-modal-btn" style="width:100%;">关闭</button> </div>
        </div>
      </div>
      <div id="char-music-screen" class="char-screen">
        <div class="header"> <span class="back-btn" onclick="switchToCharHomeScreen()">‹</span> <span data-lang-key="cphoneMusicTitle">TA的歌单</span>
          <div class="header-actions"> <span class="action-btn" id="regenerate-char-music-btn" title="重新生成歌单"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
                <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
              </svg> </span> </div>
        </div>
        <div id="char-music-list" class="list-container"> </div>
      </div>
      <div id="char-music-player-modal" class="modal">
        <div class="modal-content">
          <div class="char-player-body">
            <div class="char-player-song-info">
              <p id="char-music-player-title">歌曲名称</p>
              <p id="char-music-artist">歌手</p>
            </div>
            <div id="char-vinyl-container"> <img id="char-music-cover" src=""> </div>
            <div id="char-music-lyrics"> </div>
            <div class="char-player-footer">
              <div class="char-player-progress-bar-container"> <span id="char-music-current-time" class="time-display">0:00</span>
                <div id="char-music-progress-bar" class="char-player-progress-bar">
                  <div id="char-music-progress-fill"></div>
                </div> <span id="char-music-total-time" class="time-display">0:00</span>
              </div>
              <div class="char-player-controls"> <button id="char-music-prev-btn" class="control-btn"> <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"></path>
                  </svg> </button> <button id="char-music-play-pause-btn" class="control-btn play"> <svg viewBox="0 0 24 24" width="32" height="32" fill="currentColor">
                    <path d="M8 5v14l11-7z"></path>
                  </svg> </button> <button id="char-music-next-btn" class="control-btn"> <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M16 6h2v12h-2zm-3.5 6l-8.5 6V6z"></path>
                  </svg> </button> <button id="char-music-mode-btn" class="control-btn mode">顺序</button> </div>
            </div>
          </div> <button id="close-char-music-player-btn" class="char-player-close-btn">×</button>
        </div>
      </div>
    </div>
    <div id="world-book-screen" class="screen">
      <div class="header">
        <div class="header-left-actions"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span class="action-btn" id="import-world-book-btn" title="导入世界书"data-lang-key-title="worldBookImportTitle"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg> </span> <span class="action-btn" id="export-world-book-btn" title="导出世界书"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg> </span> </div> <span data-lang-key="worldBookTitle">世界书</span>
        <div class="header-actions"> <span class="action-btn" id="manage-world-book-categories-btn" title="管理分类"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg> </span> <span class="action-btn" id="add-world-book-btn">+</span> </div>
      </div>
      <div id="world-book-tabs"></div>
      <div id="world-book-content-container"></div>
    </div>
    <div id="world-book-editor-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('world-book-screen')">‹</span> <span id="world-book-editor-title"data-lang-key="worldBookEditorTitle"data-lang-key="edit">编辑世界书</span> <span class="save-btn" id="save-world-book-btn"data-lang-key="save">保存</span> </div>
      <div class="form-container">
        <div class="form-group"> <label for="world-book-name-input"data-lang-key="worldBookNameLabel">书名</label> <input type="text" id="world-book-name-input" placeholder="请输入世界书的名称..."data-lang-key-placeholder="worldBookNamePlaceholder"> </div>
        <div class="form-group"> <label for="world-book-category-select"data-lang-key="worldBookCategoryLabel">分类</label> <select id="world-book-category-select"></select> </div>
        <div class="form-group" style="flex-grow: 1; display: flex; flex-direction: column;"> <label data-lang-key="worldBookEntriesLabel">内容条目</label>
          <div id="world-book-entries-container" style="display: flex; flex-direction: column; gap: 15px; overflow-y: auto; padding: 5px; flex-grow: 1;"> </div>
        </div> <button id="add-world-book-entry-btn" class="form-button form-button-secondary"data-lang-key="worldBookAddEntryBtn"> [+] 添加新条目 </button>
      </div>
    </div>
    <div id="preset-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span data-lang-key="presetTitle">预设</span>
        <div class="header-actions"> <span class="action-btn" id="import-preset-btn" title="导入预设文件" data-lang-key-title="presetImportTitle"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg> </span> <span class="action-btn" id="manage-preset-categories-btn" title="管理分类"data-lang-key-title="presetManageCategoriesTitle"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
            </svg> </span> <span class="action-btn" id="add-preset-btn">+</span> </div>
      </div>
      <div id="preset-tabs"></div>
      <div id="preset-content-container"></div>
    </div>
    <div id="tutorial-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span data-lang-key="tutorialTitle">教程</span> <span style="width: 30px;"></span> </div>
      <div class="list-container" style="padding: 0; overflow: hidden;"> <iframe id="tutorial-iframe" src="tutorial.html" style="width: 100%; height: 100%; border: none;"></iframe> </div>
    </div>
    <div id="preset-editor-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('preset-screen')">‹</span> <span id="preset-editor-title"data-lang-key="presetEditorTitle">编辑预设</span> <span class="save-btn" id="save-preset-btn"data-lang-key="save">保存</span> </div>
      <div class="form-container">
        <div class="form-group"> <label for="preset-name-input"data-lang-key="presetNameLabel">预设名称</label> <input type="text" id="preset-name-input" placeholder="请输入预设的名称..."data-lang-key-placeholder="presetNamePlaceholder"> </div>
        <div class="form-group"> <label for="preset-category-select"data-lang-key="presetCategoryLabel">分类</label> <select id="preset-category-select"></select> </div>
        <div class="form-group" style="flex-grow: 1; display: flex; flex-direction: column;"> <label data-lang-key="presetEntriesLabel">内容条目</label>
          <div id="preset-entries-container" style="display: flex; flex-direction: column; gap: 15px; overflow-y: auto; padding: 5px; flex-grow: 1;"> </div>
        </div> <button type="button" id="add-preset-entry-btn" class="form-button form-button-secondary"data-lang-key="presetAddEntryBtn"> [+] 添加新条目 </button>
      </div>
    </div>
    <div id="api-settings-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span data-lang-key="apiSettingsTitle">API 设置</span> <span style="width: 30px;"></span> </div>
      <div class="form-container">
    <div class="form-group">
        <label for="language-select" data-lang-key="languageLabel">语言 (Language)</label>
        <select id="language-select">
            <option value="zh-CN">简体中文</option>
            <option value="en">English</option>
        </select>
    </div>
    <hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="margin-top:0; border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiPresetManagement">API 预设管理</h3>
        <div class="form-group"> <label for="api-preset-select"data-lang-key="apiPresetSelectLabel">选择或切换预设</label>
          <div style="display: flex; gap: 10px; align-items: center;"> <select id="api-preset-select" style="flex-grow: 1;"></select> <button id="save-api-preset-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;"data-lang-key="save">保存</button> <button id="delete-api-preset-btn"
              class="form-button-secondary" style="margin-top: 0; padding: 12px; background-color: #ffebee; color: #d32f2f; border-color: #ffcdd2;"data-lang-key="delete">删除</button> </div>
        </div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="margin-top:0; border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiPrimarySettings">主API设置 (用于聊天)</h3>
        <p style="font-size: 14px; color: #666; background-color: #f0f0f0; padding: 10px; border-radius: 8px;"> 提示: 若要使用“发送图片”功能, 请务必选择支持Vision(视觉)的模型, 如<code style="background-color: #e0e0e0; padding: 2px 4px; border-radius: 4px;">gpt-4o</code>或<code
            style="background-color: #e0e0e0; padding: 2px 4px; border-radius: 4px;">gpt-4-vision-preview</code>。 </p>
        <div class="form-group"> <label for="proxy-url"data-lang-key="apiProxyUrlLabel">反代地址 (不需要添加/v1噢~)</label> <input type="text" id="proxy-url" placeholder="例如: https://api.openai.com"> </div>
        <div class="form-group"> <label for="api-key"data-lang-key="apiKeyLabel">密钥 (API Key)</label> <input type="password" id="api-key" placeholder="sk-..."> </div>
        <div class="form-group"> <label for="model-select"data-lang-key="apiModelLabel">模型</label> <select id="model-select"></select> </div> <button class="form-button" id="fetch-models-btn"data-lang-key="apiFetchModelsBtn">拉取主模型</button>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiSecondarySettings">副API设置 (用于总结长期记忆)</h3>
        <p style="font-size: 14px; color: #666; background-color: #f0f0f0; padding: 10px; border-radius: 8px;"> 您可以在此配置一个独立的、可能成本更低的API，专门用于后台的长期记忆总结任务，以节省主API的费用。如果留空，将默认使用主API进行总结。 </p>
        <div class="form-group"> <label for="secondary-proxy-url"data-lang-key="apiSecondaryProxyUrlLabel">副反代地址</label> <input type="text" id="secondary-proxy-url" placeholder="例如: https://api.groq.com/openai"> </div>
        <div class="form-group"> <label for="secondary-api-key"data-lang-key="apiSecondaryKeyLabel">副密钥</label> <input type="password" id="secondary-api-key" placeholder="gsk_..."> </div>
        <div class="form-group"> <label for="secondary-model-select"data-lang-key="apiSecondaryModelLabel">副模型</label> <select id="secondary-model-select"></select> </div> <button class="form-button form-button-secondary" id="fetch-secondary-models-btn"data-lang-key="apiFetchSecondaryModelsBtn">拉取副模型</button>
        <div class="form-group"> <label for="api-temperature-slider">API 温度 (Temperature) <span id="api-temperature-value">0.8</span></label>
          <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 控制AI回复的随机性和创造性。值越高，回复越随机；值越低，回复越确定。建议范围 0.7-1.0。 </p> <input type="range" id="api-temperature-slider" min="0" max="2" step="0.1" value="0.8" style="width: 100%; margin-top: 8px;">
        </div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiBgActivitySettings">后台活动设置</h3>
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;"> <label for="background-activity-switch" style="margin-bottom: 0;"data-lang-key="apiEnableBgActivityLabel"> 启用后台角色活动 <p style="font-size: 12px; font-weight: normal; color: #ff6b6b; margin-top: 5px;"> 警告：此功能会显著增加API调用和费用！ </p>
          </label> <input type="checkbox" id="background-activity-switch" style="width: auto; height: 20px;"> </div>
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;"> <label for="background-interval-input" style="margin-bottom: 0;"data-lang-key="apiBgIntervalLabel"> 后台活动检测间隔 (秒) <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 建议值
              60-300。值越大，费用越低，但角色反应越慢。 </p> </label> <input type="number" id="background-interval-input" min="30" value="60" style="width: 80px; text-align: center;"> </div>
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;"> <label for="block-cooldown-input" style="margin-bottom: 0;"data-lang-key="apiBlockCooldownLabel"> AI被拉黑后冷静期 (小时) <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
              被拉黑超过这个时间后，AI才有几率重新申请好友。 </p> </label> <input type="number" id="block-cooldown-input" min="0.1" step="0.1" value="1" style="width: 80px; text-align: center;"> </div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiTtsSettings">语音消息设置 (Minimax TTS)</h3>
        <p style="font-size: 14px; color: #666; background-color: #f0f0f0; padding: 10px; border-radius: 8px;"> 在 AI 回复的文字前加上 <code style="background-color: #e0e0e0; padding: 2px 4px; border-radius: 4px;">[V]</code> 前缀，即可让该条消息自动渲染为可播放的语音。</p>
        <div class="form-group"> <label for="minimax-group-id">Minimax Group ID</label> <input type="text" id="minimax-group-id" placeholder="在此输入你的 Group ID"></div>
        <div class="form-group"> <label for="minimax-api-key">Minimax API Key</label> <input type="password" id="minimax-api-key" placeholder="在此输入你的 API Key"></div>
        <div class="form-group"> <label for="minimax-model-select"data-lang-key="apiTtsModelLabel">语音模型 (Model)</label> <select id="minimax-model-select">
            <option value="speech-01">speech-01 (标准)</option>
            <option value="speech-02">speech-02 (高清)</option>
          </select></div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiPerformanceSettings"data-lang-key="apiPerformanceSettings">性能与显示设置</h3>
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;"> <label for="chat-list-render-window-input" style="margin-bottom: 0;"data-lang-key="apiChatListRenderWindowLabel"> 聊天列表每次加载条数 <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
              控制主页聊天列表下拉时每次加载会话的数量。默认30。 </p> </label> <input type="number" id="chat-list-render-window-input" min="10" value="30" style="width: 80px; text-align: center;"> </div>
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;"> <label for="chat-render-window-input" style="margin-bottom: 0;"data-lang-key="apiChatRenderWindowLabel"> 聊天界面初始加载条数 <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
              打开聊天时默认显示的最近消息数量。值越大，初次加载越慢。 </p> </label> <input type="number" id="chat-render-window-input" min="10" value="50" style="width: 80px; text-align: center;"> </div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiImageGenSettings">生图功能设置</h3>
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;"> <label for="enable-ai-drawing-switch" style="margin-bottom: 0;"data-lang-key="apiEnableImageGenLabel"> 启用AI生图功能 <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
              关闭后，所有需要AI生成的图片（动态、头像等）都将显示为占位图，以节省流量和API费用。 </p> </label> <label class="toggle-switch"> <input type="checkbox" id="enable-ai-drawing-switch"> <span class="slider"></span> </label> </div>
<!-- ▼▼▼ NovelAI 图像生成系统配置 ▼▼▼ -->
<hr style="margin:20px 0; opacity:.3">
<div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
    <label for="novelai-switch" style="margin-bottom: 0;">
        启用 NovelAI 图像生成
        <p style="font-size: 12px; font-weight: normal; color: #666; margin-top: 5px;">
            开启后可使用NovelAI官方API生成高质量动漫风格图像（必开🔮）
        </p>
        <p style="font-size: 12px; font-weight: normal; color: #666; margin-top: 5px;">
            1. 三击下载图片，下面可测试模型或关键词画师串
        </p>
        <p style="font-size: 12px; font-weight: normal; color: #666; margin-top: 5px;">
            2. 429是novel的访问频繁错误，等待几秒重新即可
        </p>
        <p style="font-size: 12px; font-weight: normal; color: #666; margin-top: 5px;">
            3. 403是多人共号限制，限制oplus免费出小图但可扣点数
        </p>
        <p style="font-size: 12px; font-weight: normal; color: #666; margin-top: 5px;">
            4. 403也会因为没开🔮报错，实在不行可更换出图尺寸
        </p>
        <p style="font-size: 12px; font-weight: normal; color: #666; margin-top: 5px;">
            5. 401是key没权限，检查key是否正确
        </p>
        <p style="font-size: 12px; font-weight: normal; color: #666; margin-top: 5px;">
            6. 生成失败:Failed to fetch是跨域限制，下方设置里换代理
      </p>
    </label>
    <label class="toggle-switch">
        <input type="checkbox" id="novelai-switch">
        <span class="slider"></span>
    </label>
</div>

<div id="novelai-details" style="display: none;">
    <div class="form-group">
        <label for="novelai-model" style="color: #333;"data-lang-key="apiNovelAIModelLabel">NovelAI 模型</label>
        <select id="novelai-model" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; border-radius: 4px;">
            <option value="nai-diffusion-4-curated-preview">NAI Diffusion V4.5 Curated (精选版无nsfw)</option>
            <option value="nai-diffusion-4-5-full">NAI Diffusion V4.5 Full（完整版含nsfw）</option>
            <option value="nai-diffusion-3">NAI Diffusion Anime V3（旧版）</option>
            <option value="nai-diffusion-furry-3">NAI Diffusion Furry V3（旧旧版）</option>
        </select>
        <p style="font-size: 12px; color: #666; margin-top: 5px;">
            💡 必须有oplus订阅的apikey才可以使用！
        </p>
    </div>

    <div class="form-group">
        <label for="novelai-api-key" style="color: #333;"data-lang-key="apiNovelAIKeyLabel">NovelAI API Key</label>
        <div style="position: relative;">
            <input type="password" id="novelai-api-key" placeholder="pst-xxxxxxxxxxxxxxxx" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding-right: 40px;">
            <span id="novelai-key-toggle" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; user-select: none; font-size: 18px;">🧐</span>
        </div>
        <p style="font-size: 12px; color: #666; margin-top: 5px;">
            💡 在 <a href="https://novelai.net" target="_blank" style="color: #007bff;">NovelAI官网</a> 获取API Key
        </p>
    </div>

    <div style="display: flex; gap: 10px; margin-top: 15px;">
        <button type="button" id="novelai-settings-btn" style="flex: 1; background-color: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;"data-lang-key="apiNovelAIGenSettingsBtn">
            ⚙️ 生成设置
        </button>
        <button type="button" id="novelai-test-btn" style="flex: 1; background-color: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;"data-lang-key="apiNovelAITestBtn">
            🧪 测试生成
        </button>
    </div>
</div>
<!-- ▲▲▲ NovelAI 图像生成系统配置结束 ▲▲▲ -->

<hr style="margin: 30px 0; opacity: 0.3;">
        <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="apiStorageOptimization">存储空间优化</h3>

        <p id="total-image-size-display" style="font-size: 14px; color: var(--text-secondary); margin-bottom: 15px; text-align: center;">
            正在计算本地图片总大小...
        </p>
        <button class="form-button form-button-secondary" id="compress-images-btn" style="background-color: #e8f5e9; color: #2e7d32; border-color: #c8e6c9;"data-lang-key="apiCompressImagesBtn">
             一键压缩本地图片
        </button>
        <p style="font-size: 12px; color: #8a8a8a; margin-top: 8px; line-height: 1.5;">
            此功能会将您所有本地上传的图片（如头像、表情包、聊天图片、头像框、组件图等）压缩为JPEG格式，以大幅减小数据体积。
            <br><strong style="color: #ff3b30;">警告：这是一个有损压缩且不可逆的操作，会轻微降低图片质量。建议操作前先备份数据。</strong>
        </p>
        <hr style="margin: 30px 0; opacity: 0.3;"> <button class="form-button" id="save-api-settings-btn" style="margin-top: 20px;"data-lang-key="apiSaveAllBtn">保存所有设置</button> <button class="form-button" id="export-data-btn"data-lang-key="apiExportDataBtn">导出数据</button> <button class="form-button" id="import-btn"data-lang-key="apiImportDataBtn">导入备份文件</button><button
          class="form-button form-button-secondary" id="cleanup-data-btn" style="background-color: #ffebee; color: #c62828; border-color: #ef9a9a; margin-top: 10px;"data-lang-key="apiCleanupDataBtn">清理冗余数据</button><button class="form-button form-button-secondary" id="delete-world-books-btn"
          style="background-color: #ffebee; color: #c62828; border-color: #ef9a9a; margin-top: 10px;"data-lang-key="apiDeleteWorldBooksBtn">删除世界书</button><button class="form-button form-button-secondary" id="clear-specific-data-btn"
          style="background-color: #ffcdd2; color: #b71c1c; border-color: #ef9a9a; margin-top: 10px;"data-lang-key="apiAdvancedCleanupBtn">高级数据清理</button><button class="form-button form-button-secondary" id="check-and-fix-data-btn"
          style="background-color: #e3f2fd; color: #0d47a1; border-color: #bbdefb; margin-top: 10px;"data-lang-key="apiCheckAndFixDataBtn">数据检查与修复</button> <input id="import-data-input" type="file" accept="application/json" hidden>

      </div>
    </div>
<div id="import-options-modal" class="modal">
  <div class="modal-content" style="height: auto;">
    <div class="modal-header">
      <span>发现备份文件</span>
    </div>
    <div class="modal-body">
      <p>在此备份文件中找到了以下数据：</p>
      <ul id="import-preview-list" style="text-align: left; margin-left: 20px; max-height: 200px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 8px;">
        </ul>
      <hr style="opacity: 0.2; margin: 20px 0;">
      <p style="font-weight: bold;">请选择导入方式：</p>
    </div>
    <div class="modal-footer" style="flex-direction: column; gap: 10px;">
      <button class="save btn-danger" id="confirm-full-import-btn" style="width: 100%; background-color: #ff3b30; border-color: #ff3b30;">
        <strong>完全导入 (覆盖所有数据)</strong>
        <small style="display: block; font-weight: normal; opacity: 0.8;">将删除本地所有数据，并替换为备份文件中的数据。</small>
      </button>
      <button class="save" id="confirm-selective-import-btn" style="width: 100%;">
        <strong>选择性导入 (合并数据)</strong>
        <small style="display: block; font-weight: normal; opacity: 0.8;">将备份文件中的数据【添加】到您现有的数据中。</small>
      </button>
      <button class="cancel" id="cancel-import-options-btn" style="width: 100%; margin-top: 8px;" data-lang-key="cancel">取消</button>
    </div>
  </div>
</div>

<div id="selective-import-modal" class="modal">
  <div class="modal-content" style="height: 70%;">
    <div class="modal-header">
      <span>选择要合并的数据</span>
      <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;">
        <input type="checkbox" id="select-all-import-types"> 全选
      </label>
    </div>
    <div class="modal-body" id="selective-import-list" style="padding: 0;">
      </div>
    <div class="modal-footer">
      <button class="cancel" id="cancel-selective-import-btn" data-lang-key="cancel">取消</button>
      <button class="save" id="confirm-merge-import-btn">确认合并</button>
    </div>
  </div>
</div>
    <div id="data-clear-wizard-modal" class="modal">
      <div class="modal-content" style="height: 80%;">
        <div id="data-clear-step-1" class="wizard-step">
          <div class="modal-header"> <span>第一步：选择要清理的角色</span> <label> <input type="checkbox" id="select-all-chars-for-clear"> 全选 </label> </div>
          <div class="modal-body" id="data-clear-char-list" style="padding: 0;"> </div>
          <div class="modal-footer"> <button class="cancel" id="cancel-clear-wizard-btn-step1"data-lang-key="cancel">取消</button> <button class="save" id="go-to-clear-step2-btn">下一步</button> </div>
        </div>
        <div id="data-clear-step-2" class="wizard-step" style="display: none;">
          <div class="modal-header"> <span>第二步：选择要清理的数据类型</span> <label> <input type="checkbox" id="select-all-types-for-clear"> 全选 </label> </div>
          <div class="modal-body" id="data-clear-type-list" style="padding: 0;"> </div>
          <div class="modal-footer"> <button class="form-button-secondary" id="back-to-clear-step1-btn" style="width: 30%; margin:0;">上一步</button> <button class="cancel" id="cancel-clear-wizard-btn-step2" style="width: 30%; margin:0;"data-lang-key="cancel">取消</button> <button class="save btn-danger"
              id="confirm-final-clear-btn" style="width: 30%; margin:0;">确认清理</button> </div>
        </div>
      </div>
    </div>
    <div id="chat-list-screen" class="screen">
      <div class="header" id="main-chat-list-header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span id="chat-list-title"data-lang-key="chatListTitle">消息</span>
        <div class="header-actions"> <span class="action-btn" id="add-group-chat-btn" title="创建群聊"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17.5 17.5C19.1569 17.5 20.5 16.1569 20.5 14.5C20.5 12.8431 19.1569 11.5 17.5 11.5C15.8431 11.5 14.5 12.8431 14.5 14.5C14.5 16.1569 15.8431 17.5 17.5 17.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M21 21L19 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M8.5 11.5C10.1569 11.5 11.5 10.1569 11.5 8.5C11.5 6.84315 10.1569 5.5 8.5 5.5C6.84315 5.5 5.5 6.84315 5.5 8.5C5.5 10.1569 6.84315 11.5 8.5 11.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M12.5 14.5H4.5C3.39543 14.5 2.5 15.3954 2.5 16.5V18.5H12.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg></span> <span class="action-btn" id="add-chat-btn">+</span> </div>
      </div>
      <div id="messages-view" class="chat-list-view active">
        <div id="chat-list"> </div>
      </div>
      <div id="qzone-screen" class="chat-list-view">
        <div class="qzone-header"> <span class="back-btn" id="qzone-back-btn">‹</span> <span data-lang-key="qzoneTitle">好友动态</span>
          <div class="header-actions"> <span class="action-btn" id="qzone-more-actions-btn" title="更多操作">…</span> </div>
        </div>
        <div class="qzone-content">
          <div class="qzone-profile-header">
            <div id="qzone-banner-container" class="qzone-banner-container"> <img id="qzone-banner-img" src="https://files.catbox.moe/r5heyt.gif" alt="背景"> <input type="file" id="qzone-banner-input" accept="image/*" hidden> </div>
            <div class="qzone-user-info">
              <div id="qzone-avatar-container" class="qzone-avatar-container"> <img id="qzone-avatar-img" src="https://files.catbox.moe/q6z5fc.jpeg" alt="头像"> <input type="file" id="qzone-avatar-input" accept="image/*" hidden> </div> <span id="qzone-nickname">{{user}}</span>
            </div>
          </div>
          <div class="qzone-actions-bar">
            <div class="action-item" id="create-shuoshuo-btn"><span data-lang-key="qzoneActionShuoshuo">说说</span></div>
            <div class="action-item" id="create-post-btn"><span data-lang-key="qzoneActionPost">动态</span></div>
            <div class="action-item" id="open-album-btn"><span data-lang-key="qzoneActionAlbum">相册</span></div>
          </div>
          <div id="qzone-posts-list"></div>
        </div>
      </div>
      <div id="favorites-view" class="chat-list-view">
        <div class="header"> <span class="back-btn" id="favorites-back-btn">‹</span> <span data-lang-key="navFavorites">我的收藏</span> <span class="action-btn" id="favorites-edit-btn"data-lang-key="edit">编辑</span> </div>
        <div class="search-bar-container"> <input type="search" id="favorites-search-input" placeholder="搜索收藏的标题、内容或作者..."> <button id="favorites-search-clear-btn" class="search-clear-btn" style="display: none;">×</button> </div>
        <div id="favorites-list" class="list-container"> </div>
        <div id="favorites-action-bar" style="display: none;"> <button id="favorites-delete-selected-btn" class="action-bar-btn">删除 (0)</button> </div>
      </div>
      <div id="memories-view" class="chat-list-view">
        <div class="header"> <span class="back-btn" id="memories-back-btn">‹</span> <span>我们的回忆</span> <span class="action-btn" id="add-countdown-btn">+</span> </div>
        <div id="memories-list" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
      </div>
      <div id="npc-list-view" class="chat-list-view">
        <div class="header"> <span class="back-btn" id="npc-list-back-btn">‹</span> <span>NPC 列表</span>
          <div class="header-actions"> <span class="action-btn" id="add-npc-btn">+</span> </div>
        </div>
        <div id="npc-list" class="list-container" style="padding: 0;"> </div>
      </div>
      <div id="chat-list-bottom-nav">
        <div class="nav-item active" data-view="messages-view"> <span data-lang-key="navMessages">消息</span> </div>
        <div class="nav-item" data-view="qzone-screen"> <span data-lang-key="navQzone">动态</span> </div>
        <div class="nav-item" data-view="memories-view"> <span data-lang-key="navMemories">回忆</span> </div>
        <div class="nav-item" data-view="favorites-view"> <span data-lang-key="navFavorites">收藏</span> </div>
        <div class="nav-item" data-view="npc-list-view"> <span data-lang-key="navNpcList">NPC</span> </div>
      </div>
    </div>
    <div id="album-screen" class="screen">
      <div class="header"> <span class="back-btn" id="album-back-btn">‹</span> <span>我的相册</span> <span class="action-btn" id="create-album-btn-page">+</span> </div>
      <div class="list-container">
        <div id="album-grid-page"> </div>
      </div>
    </div>
    <div id="album-photos-screen" class="screen">
      <div class="header"> <span class="back-btn" id="album-photos-back-btn">‹</span> <span id="album-photos-title">相册名称</span> <span class="action-btn" id="album-upload-photo-btn">上传</span> </div>
      <div class="list-container">
        <div id="photos-grid-page"> </div>
        <div id="photo-viewer-modal" class="modal"> <button id="photo-viewer-close-btn">×</button> <button id="photo-viewer-prev-btn" class="nav-arrow">‹</button>
          <div class="photo-viewer-content"> <img id="photo-viewer-image" src="" alt="全屏照片预览"> </div> <button id="photo-viewer-next-btn" class="nav-arrow">›</button>
        </div>
      </div>
    </div>
    <div id="npc-editor-modal" class="modal">
      <div class="modal-content" style="height: 80%;">
        <div class="modal-header"> <span id="npc-editor-title"data-lang-key="add">添加 NPC</span> </div>
        <div class="modal-body">
          <div class="form-group"> <label>NPC 头像</label>
            <div class="avatar-upload"> <img id="npc-avatar-preview" src="https://i.postimg.cc/VkQfgzGJ/1.jpg"> <button onclick="document.getElementById('npc-avatar-input').click()">上传头像</button> <input type="file" id="npc-avatar-input" accept="image/*" hidden> </div>
          </div>
          <div class="form-group"> <label for="npc-name-input">NPC 昵称</label> <input type="text" id="npc-name-input" placeholder="输入NPC的常用名"> </div>
          <div class="form-group"> <label for="npc-persona-input">NPC 人设</label> <textarea id="npc-persona-input" rows="4" placeholder="详细描述这个NPC的性格、背景、说话方式等..."></textarea> </div>
<div class="form-group" id="npc-group-section">
            <label for="npc-group-select">NPC 分组 (用于NPC间互评)</label>
            <div style="display: flex; align-items: center; gap: 10px;">
              <select id="npc-group-select" style="flex-grow: 1;">
                <option value="">-- 未分组 --</option>
              </select>
              <button id="manage-npc-groups-btn" type="button" class="form-button-secondary" style="margin-top: 0; padding: 12px;">管理分组</button>
            </div>
            <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
                只有在同一个分组内的NPC才能互相看见和评论对方的动态。
            </p>
          </div>
          <hr style="opacity: 0.2;">
          <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;"> <label for="npc-background-activity-switch" style="margin-bottom: 0;"> 启用独立后台活动 <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
                允许该NPC在后台独立发表动态评论。需同时开启API设置中的总开关。 </p> </label> <label class="toggle-switch"> <input type="checkbox" id="npc-background-activity-switch"> <span class="slider"></span> </label> </div>
          <div class="form-group"> <label for="npc-action-cooldown-input"> 独立行动冷却 (分钟) <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 该NPC在后台主动行动的最小间隔。 </p> </label> <input type="number" id="npc-action-cooldown-input" min="1" value="15"
              style="width: 80px; text-align: center;"> </div>
          <div class="form-group"> <label>关联的角色 (NPC会去评论这些角色的动态)</label>
            <div id="npc-association-list" style="max-height: 150px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 8px;"> </div>
          </div>
        </div>
        <div class="modal-footer"> <button class="cancel" id="cancel-npc-editor-btn"data-lang-key="cancel">取消</button> <button class="save" id="save-npc-btn">保存</button> </div>
      </div>
    </div>
    <div id="clear-posts-modal" class="modal">
      <div class="modal-content" style="height: 70%;">
        <div class="modal-header"> <span>选择清空范围</span> </div>
        <div class="modal-body" id="clear-posts-list" style="padding: 0;"> </div>
        <div class="modal-footer"> <button class="cancel" id="cancel-clear-posts-btn"data-lang-key="cancel">取消</button> <button class="save btn-danger" id="confirm-clear-posts-btn">确认清空</button> </div>
      </div>
    </div> <input type="file" id="album-photo-input" accept="image/*" multiple hidden>
    <div id="chat-interface-screen" class="screen">
      <div id="gomoku-overlay">
        <div id="gomoku-content-wrapper"> <canvas id="gomoku-board"></canvas>
          <div id="gomoku-controls"> <button id="close-gomoku-btn">收起棋盘</button> </div>
        </div>
      </div>
      <div id="reading-overlay">
        <div id="reading-restore-btn" style="display: none;">📖</div>
        <div id="reading-window">
          <div class="reading-header"> <span id="reading-title">未选择书籍</span>
            <div class="reading-controls"> <button id="minimize-reading-btn" title="最小化" style="font-size: 20px; line-height: 1;"> <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round">
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg> </button> <button id="open-reading-library-btn" title="打开书库" style="font-size: 22px; line-height: 1;"> <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="3" y1="12" x2="21" y2="12"></line>
                  <line x1="3" y1="6" x2="21" y2="6"></line>
                  <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg></button> <button id="close-reading-btn" title="关闭"> <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg> </button></div>
          </div>
          <div id="reading-content">
            <p>点击“导入”按钮，<br>从本地.txt文件或网络URL加载书籍内容。</p>
          </div>
          <div class="reading-footer"> <button id="prev-page-btn">上一页</button> <span id="page-indicator">0 / 0</span> <button id="next-page-btn">下一页</button> </div>
        </div>
      </div><input type="file" id="book-upload-input" accept=".txt, text/plain" hidden>
      <div class="header">
        <div class="default-controls"> <span class="back-btn" id="back-to-list-btn">‹</span>
          <div id="global-lyrics-bar"></div>
          <div id="chat-header-title-wrapper"> <span id="chat-header-title">聊天对象</span>
            <div id="chat-header-status"> <span class="status-dot"></span> <span class="status-text">在线</span> </div>
          </div>
          <div class="header-actions"> <span class="action-btn" id="open-memory-screen-btn" title="长期记忆"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M16 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M12 6L9 9L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M21 5V19C21 20.1046 20.1046 21 19 21H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg> </span> <span class="action-btn" id="listen-together-btn" title="一起听"><img src="https://i.postimg.cc/dV8sdNcx/210-20250618115221.png" alt="一起听"></span> <span class="action-btn" id="chat-settings-btn" title="聊天设置"><img
                src="https://i.postimg.cc/bvPq64cv/CCA834-BA-5-A90-408-D-94-FA-7-EE156-B6-A765.png" alt="设置"></span> </div>
        </div>
        <div class="selection-controls"> <span id="selection-cancel-btn"data-lang-key="chatSelectionCancel">取消</span> <span id="selection-count"></span>
          <div class="header-actions"> <span id="selection-screenshot-btn" class="action-btn"data-lang-key="chatSelectionScreenshot">长截图</span> <span id="selection-favorite-btn" class="action-btn"data-lang-key="chatSelectionFavorite">收藏</span> <span id="selection-share-btn" class="action-btn"data-lang-key="chatSelectionShare">分享</span> <span id="selection-soft-delete-btn" class="action-btn"data-lang-key="chatSelectionSoftDelete">删除(通知AI)</span>
            <span id="selection-erase-btn" class="action-btn" style="color: #ff3b30;"data-lang-key="chatSelectionHardDelete">彻底删除</span> </div>
        </div>
      </div>
      <div id="chat-messages">
        <div id="typing-indicator">对方正在输入...</div>
      </div>
      <div id="chat-input-area">
        <div id="chat-at-mention-popup" class="at-mention-popup"></div>
        <div id="reply-preview-bar">
          <div class="reply-preview-content">
            <div class="sender">回复 xxx:</div>
            <div class="text">被引用的消息内容...</div>
          </div> <span id="cancel-reply-btn">×</span>
        </div>
        <div id="chat-input-actions-top"> <button id="open-sticker-panel-btn" class="chat-action-icon-btn action-button" title="表情面板">+</button> <button id="send-photo-btn" class="chat-action-icon-btn action-button" title="发送照片"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
              <circle cx="12" cy="13" r="4"></circle>
            </svg></button> <button id="upload-image-btn" class="chat-action-icon-btn action-button" title="上传图片"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 3.5H3C2.44772 3.5 2 3.94772 2 4.5V19.5C2 20.0523 2.44772 20.5 3 20.5H21C21.5523 20.5 22 20.0523 22 19.5V4.5C22 3.94772 21.5523 3.5 21 3.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
              <path d="M16.5 13.5C17.6046 13.5 18.5 12.6046 18.5 11.5C18.5 10.3954 17.6046 9.5 16.5 9.5C15.3954 9.5 14.5 10.3954 14.5 11.5C14.5 12.6046 15.3954 13.5 16.5 13.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
              <path d="M22 14.5L18 10.5L10.3333 18.5M12.5 16L9 12.5L2 19.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg> </button> <button id="transfer-btn" class="chat-action-icon-btn action-button" title="转账">￥</button> <button id="voice-message-btn" class="chat-action-icon-btn action-button" title="发送语音"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
              xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
              <path d="M12 19v4"></path>
              <path d="M8 23h8"></path>
            </svg></button> <button id="send-waimai-request-btn" class="chat-action-icon-btn action-button" title="发起外卖请求"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <path d="M16 10a4 4 0 0 1-8 0"></path>
            </svg></button> <button id="video-call-btn" class="chat-action-icon-btn action-button" title="视频通话"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="23 7 16 12 23 17 23 7"></polygon>
              <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
            </svg></button> <button id="group-video-call-btn" class="chat-action-icon-btn action-button" title="群视频通话"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg></button> <button id="send-poll-btn" class="chat-action-icon-btn action-button" title="发起投票"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M8 6h10"></path>
              <path d="M6 6h.01"></path>
              <path d="M8 12h10"></path>
              <path d="M6 12h.01"></path>
              <path d="M8 18h10"></path>
              <path d="M6 18h.01"></path>
            </svg></button> <button id="share-link-btn" class="chat-action-icon-btn action-button" title="分享链接"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"></path>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"></path>
            </svg></button> <button id="share-location-btn" class="chat-action-icon-btn action-button" title="共享位置"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg></button> <button id="gomoku-btn" class="chat-action-icon-btn action-button" title="五子棋"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <circle cx="12" cy="12" r="4"></circle>
              <circle cx="12" cy="12" r="7"></circle>
            </svg> </button> <button id="open-shopping-btn" class="chat-action-icon-btn action-button" title="购物"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg> </button> <button id="pat-btn" class="chat-action-icon-btn action-button" title="拍一-拍" style="display: none;"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16 5.02c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M14.5 11.02c0 .83-.67 1.5-1.5 1.5v0c-.83 0-1.5-.67-1.5-1.5v-5c0-.83.67-1.5 1.5-1.5v0c.83 0 1.5.67 1.5 1.5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M5.5 14.52l-1.92-1.92c-.34-.34-.34-.89 0-1.23l3.58-3.58c.34-.34.89-.34 1.23 0l1.92 1.92c.34.34.34.89 0 1.23l-3.58 3.58c-.34.34-.89.34-1.23 0Z" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
            </svg> </button> <button id="edit-last-response-btn" class="chat-action-icon-btn action-button" title="导演模式：编辑AI上一轮的完整响应"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M12 20h9"></path>
              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
            </svg> </button> <button id="regenerate-btn" class="chat-action-icon-btn action-button" title="重新生成回复" style="display: flex;"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg> </button> <button id="propel-btn" class="chat-action-icon-btn action-button" title="推进剧情" style="display: flex;"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <polygon points="13 19 22 12 13 5 13 19"></polygon>
              <polygon points="2 19 11 12 2 5 2 19"></polygon>
            </svg> </button> <button id="show-announcement-board-btn" class="chat-action-icon-btn action-button" title="群公告板" style="display: none;"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M21.782 6.132a1 1 0 0 0-1.053-.08l-4.729 2.489a1 1 0 0 0-.5.88v4.158a1 1 0 0 0 .5.88l4.729 2.489a1 1 0 0 0 1.053-.08a1 1 0 0 0 .499-.921V7.052a1 1 0 0 0-.499-.92zm-6 3.207L11 7.05v9.9l4.782-2.281V9.339zM10 6H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h6V6z" />
            </svg> </button><button id="werewolf-game-btn" class="chat-action-icon-btn action-button" title="狼人杀" style="display: none;"> <svg width="24" height="24" viewBox="0 0 512 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M332.6 128.5c-61.1 0-110.5 49.4-110.5 110.5 0 23.4 7.3 45.1 19.9 63.3-19.3 6.3-40.1 9.7-61.9 9.7-88.2 0-160-71.8-160-160s71.8-160 160-160c5.3 0 10.5.3 15.6.8C202.9 44.1 160 0 160 0s-53.3 44.1-45.9 92.5c-48.4 24.3-82.1 73.4-82.1 129.6 0 80.9 65.5 146.4 146.4 146.4 20.2 0 39.4-4.1 56.8-11.5 24.1 33.6 63.3 56.8 107.4 56.8 7.2 0 14.2-0.6 21-1.7 15.2 24.2 41.2 41.1 71.6 41.1 44.7 0 80.9-36.2 80.9-80.9 0-25.2-11.5-47.7-29.6-62.6 11.6-16.1 18.4-35.6 18.4-56.5C443.1 177.9 393.7 128.5 332.6 128.5zM180.1 85.8c-52.1 0-94.4 42.3-94.4 94.4s42.3 94.4 94.4 94.4 94.4-42.3 94.4-94.4S232.2 85.8 180.1 85.8zM332.6 170.9c-37.8 0-68.4 30.6-68.4 68.4s30.6 68.4 68.4 68.4 68.4-30.6 68.4-68.4S370.4 170.9 332.6 170.9z">
              </path>
            </svg></button><button id="read-together-btn" class="chat-action-icon-btn action-button" title="一起读书"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg></button> <button id="open-nai-gallery-btn" class="chat-action-icon-btn action-button" title="NAI画廊">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 3l1.91 5.86L20 10.9l-5.86 1.91L12 18.6l-1.91-5.86L4 10.9l5.86-1.91L12 3z"/>
        <path d="M5 3l1.5 4.5L11 9l-4.5 1.5L5 12l-1.5-4.5L-1 6l4.5-1.5L5 3z"/>
        <path d="M19 15l-1.5 4.5L13 21l4.5-1.5L19 18l1.5 4.5L25 21l-4.5-1.5L19 15z"/>
    </svg>
</button></div>
        <div id="chat-input-main-row"> <button id="chat-expand-btn" class="chat-action-icon-btn action-button" title="展开功能">+</button><textarea id="chat-input" rows="1" placeholder="输入消息..."></textarea>
          <div id="input-actions-wrapper"> <button id="wait-reply-btn" title="等待回复"><img src="https://i.postimg.cc/q72zq80N/ECE92-BBC-BE57-48-E9-BB2-C-345-B6019-C4-B2.png" alt="等待回复"></button> <button id="send-btn" class="action-button">发送</button> </div>
        </div>
      </div>
      <div id="chat-lock-overlay">
        <div id="chat-lock-content"></div>
      </div>
<div id="nai-gallery-panel">
    <div id="nai-gallery-panel-header">
        <span class="panel-btn" id="close-nai-gallery-btn" data-lang-key="cancel">取消</span>
        <span class="title">NAI画廊</span>
        <div style="display: flex; gap: 10px;">
            <span class="panel-btn" id="manage-nai-gallery-btn">管理</span>
        </div>
    </div>
    
    <div id="nai-gallery-grid">
        </div>
    
<div id="nai-gallery-action-bar">
    <label class="select-all-label" style="display: flex; align-items: center; gap: 5px;">
        <input type="checkbox" id="select-all-nai-gallery-checkbox"> 全选
    </label>
    <button id="download-selected-nai-gallery-btn" class="action-bar-btn" style="background-color: #007bff; font-size: 14px; padding: 10px 15px;">下载 (0)</button>
    <button id="delete-selected-nai-gallery-btn" class="action-bar-btn" style="font-size: 14px; padding: 10px 15px;">删除 (0)</button>
</div>
</div>
      <div id="sticker-panel">
        <div id="sticker-panel-header"> <span class="panel-btn" id="close-sticker-panel-btn"data-lang-key="cancel">取消</span> <span class="title">我的表情</span>
          <div style="display: flex; gap: 10px;"> <span class="panel-btn" id="manage-sticker-categories-btn">分类</span> <span class="panel-btn" id="manage-stickers-btn">管理</span> <span class="panel-btn" id="add-sticker-batch-btn">批量</span> <span class="panel-btn" id="upload-sticker-btn">上传</span> </div>
        </div>
        <div id="sticker-category-tabs"></div>
        <div id="sticker-search-container"> <input type="search" id="sticker-search-input" placeholder="搜索表情名称..."></div>
        <div id="sticker-grid"></div>
        <div id="sticker-action-bar"> <label class="select-all-label" style="display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-stickers-checkbox"> 全选 </label> <button id="delete-selected-stickers-btn">删除 (0)</button> </div>
      </div> <input type="file" id="sticker-upload-input" accept="image/*" style="display: none;"> <input type="file" id="image-upload-input" accept="image/*" style="display: none;">
      <div id="music-player-overlay">
        <div class="music-player-window">
          <div class="music-player-top-actions">
            <div class="top-left-cluster"> <button id="music-return-btn">‹</button> <button id="music-exit-btn">×</button> </div>
            <div style="display: flex; align-items: center; gap: 15px;"> <button id="toggle-fullscreen-btn" title="切换全屏"> <svg class="icon-maximize" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3" />
                </svg> <svg class="icon-minimize" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3" />
                </svg> </button> <span id="music-playlist-btn">☰</span> </div>
          </div>
          <div id="music-player-avatar-display"> </div>
          <div id="music-info-top">
            <div style="display: flex; justify-content: center; align-items: center; gap: 10px;">
              <div id="music-time-counter">已经一起听了0.0小时</div> <button id="show-avatars-btn" title="显示/隐藏头像"> <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg> </button>
            </div>
            <div id="music-player-song-title">请添加歌曲</div>
            <div id="music-player-artist">...</div>
          </div>
          <div id="music-visual-container">
            <div id="vinyl-view"> <img id="music-player-cover" src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1757748720126_qdqqd_1jt5sv.jpeg" alt="Album Art"> </div>
            <div id="inline-lyrics-view">
              <div id="music-lyrics-container">
                <div id="music-lyrics-list"> </div>
              </div>
            </div>
          </div>
          <div id="single-lyric-display">♪ ♪ ♪</div>
          <div class="music-player-controls-wrapper">
            <div class="music-progress-bar-container">
              <div id="music-current-time" class="time-display">0:00</div>
              <div class="progress-bar">
                <div id="music-progress-fill" class="progress-bar-fill"></div>
              </div>
              <div id="music-total-time" class="time-display">0:00</div>
            </div>
            <div class="music-controls"> <button id="music-prev-btn">◀</button> <button id="music-play-pause-btn" class="play-pause-btn">▶</button> <button id="music-next-btn">▶</button> <button id="music-mode-btn">顺序</button> <button id="toggle-blur-btn" title="切换背景清晰度">清</button>
            </div>
          </div>
        </div>
      </div>
      <div id="music-playlist-panel">
        <div class="playlist-header"> <span class="panel-btn" id="close-playlist-btn">返回</span> <span>播放列表</span>
          <div> <span class="panel-btn" id="cleanup-songs-btn">清理</span> <span class="panel-btn" id="add-song-local-btn">本地</span> <span class="panel-btn" id="add-song-url-btn">URL</span> <span class="panel-btn" id="add-song-search-btn">搜索</span> </div>
        </div>
        <div class="playlist-body" id="playlist-body"></div>
      </div> <input type="file" id="local-song-upload-input" accept="audio/*" multiple style="display: none;"> <input type="file" id="lrc-upload-input" accept=".lrc" style="display: none;">
    </div>
    <div id="wallpaper-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span data-lang-key="appearanceTitle">外观设置</span> <span style="width: 30px;"></span> </div>
      <div class="form-container"> <label style="font-weight: 500; color: var(--text-secondary);">EPhone 主屏幕壁纸 (Screen Wallpaper)</label>
        <div id="wallpaper-preview">点击下方上传</div>
        <div class="bg-upload-container"> <button class="form-button-secondary" onclick="document.getElementById('wallpaper-upload-input').click();">本地上传</button> <button id="upload-ephone-bg-url-btn" class="form-button-secondary">网络URL</button> <button id="remove-ephone-bg-btn"
            class="form-button-secondary">移除壁纸</button> </div> <input type="file" id="wallpaper-upload-input" accept="image/*" hidden>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;"> <label style="font-weight: 500; color: var(--text-secondary);">CPhone 手机壁纸 (Screen Wallpaper)</label>
        <div id="cphone-wallpaper-preview">点击下方上传</div>
        <div class="bg-upload-container"> <button class="form-button-secondary" onclick="document.getElementById('cphone-wallpaper-upload-input').click();">本地上传</button> <button id="upload-cphone-bg-url-btn" class="form-button-secondary">网络URL</button> <button id="remove-cphone-bg-btn"
            class="form-button-secondary">移除壁纸</button> </div> <input type="file" id="cphone-wallpaper-upload-input" accept="image/*" hidden>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;"> <label style="font-weight: 500; color: var(--text-secondary);">全局聊天背景 (Global chat background)</label>
        <div id="global-bg-preview" class="wallpaper-preview" style="height: 160px; width: 90px;">点击下方上传</div>
        <div class="bg-upload-container"> <button class="form-button-secondary" onclick="document.getElementById('global-bg-input').click()">本地上传</button> <button id="upload-global-bg-url-btn" class="form-button-secondary">网络URL</button> <button id="remove-global-bg-btn"
            class="form-button-secondary">移除全局背景</button> </div> <input type="file" id="global-bg-input" accept="image/*" style="display: none;">
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;">
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; width: 100%;"> <label for="theme-toggle-switch" style="margin-bottom: 0;">夜间模式 (Night Mode)</label> <label class="toggle-switch"> <input type="checkbox" id="theme-toggle-switch"> <span class="slider"></span>
          </label> </div>
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; width: 100%;"> <label for="status-bar-toggle-switch" style="margin-bottom: 0;">顶部状态栏 (top status bar)</label> <label class="toggle-switch"> <input type="checkbox" id="status-bar-toggle-switch"> <span
              class="slider"></span> </label> </div>
<div class="form-group" style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
    <label for="phone-frame-toggle-switch" style="margin-bottom: 0;">
        显示手机外框 (Show Phone Frame)
        <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
            为应用添加一个手机样式的边框，更具沉浸感。
        </p>
    </label>
    <label class="toggle-switch">
        <input type="checkbox" id="phone-frame-toggle-switch">
        <span class="slider"></span>
    </label>
</div>
<div class="form-group" style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
    <label for="detach-status-bar-switch" style="margin-bottom: 0;">
        分离状态栏 (Detach Status Bar)
        <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
            开启后，应用将不会覆盖ios的状态栏。
        </p>
    </label>
    <label class="toggle-switch">
        <input type="checkbox" id="detach-status-bar-switch">
        <span class="slider"></span>
    </label>
</div>
<div class="form-group" style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
            <label for="dynamic-island-music-toggle-switch" style="margin-bottom: 0;">
                启用音乐灵动岛 (Enable Music Island)
                <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
                    开启后，听歌时将始终使用灵动岛UI，即使在无边框模式下。
                </p>
            </label>
            <label class="toggle-switch">
                <input type="checkbox" id="dynamic-island-music-toggle-switch">
                <span class="slider"></span>
            </label>
        </div>
<div class="form-group" style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
    <label for="minimal-chat-ui-switch" style="margin-bottom: 0;">
        启用简洁聊天界面 (Minimal Chat UI)
        <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;">
            开启后，聊天栏的工具按钮将默认折叠，通过左侧“+”号展开。
        </p>
    </label>
    <label class="toggle-switch">
        <input type="checkbox" id="minimal-chat-ui-switch">
        <span class="slider"></span>
    </label>
</div>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;">
        <div style="width:100%; text-align: left; margin-bottom: 15px;"> <label style="font-weight: 500; color: var(--text-secondary);">消息提示音(Notification sound)</label> </div>
        <div class="form-group" style="width:100%;"> <label for="notification-sound-url-input">提示音文件 URL (.mp3, .wav, .ogg)</label>
          <div style="display: flex; gap: 10px; align-items: center; margin-top: 8px;"> <input type="text" id="notification-sound-url-input" placeholder="留空则使用默认提示音" style="flex-grow: 1;"> <button id="test-sound-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;">▶</button>
            <button id="reset-sound-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;">重置</button> </div>
        </div>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;">
        <div style="width:100%; text-align: left; margin-bottom: 15px;"> <label style="font-weight: 500; color: var(--text-secondary);">EPhone App 图标设置(Icon Settings)</label> </div>
        <div id="icon-settings-grid"></div>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;">
        <div class="form-group" style="width:100%;">
          <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;"> <label>聊天工具栏按钮排序(Chat toolbar button sorting)</label> <button id="reset-button-order-btn" title="恢复默认顺序" class="form-button-secondary" style="margin: 0; padding: 4px 12px; font-size: 13px;">重置顺序</button> </div>
          <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 按住下方的按钮并拖动即可排序，设置会自动保存。 </p>
          <div id="button-order-editor" style="display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; background-color: #f0f2f5; border-radius: 8px; border: 1px solid var(--border-color);"> </div>
        </div>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;">
        <div style="width:100%; text-align: left; margin-bottom: 15px;"> <label style="font-weight: 500; color: var(--text-secondary);">CPhone App 图标设置(Icon Settings)</label> </div>
        <div id="cphone-icon-settings-grid"></div>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;">
        <h3 style="margin-top:0; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; width:100%; text-align: left;">外观预设管理(Appearance Preset)</h3>
        <p style="font-size: 12px; color: #8a8a8a; margin-top: -5px; line-height: 1.5; width:100%; text-align: left;"> 一键保存或加载壁纸、图标、按钮排序、主题等所有非CSS的视觉风格。</p>
        <div class="form-group" style="width:100%;"> <label for="appearance-preset-select"data-lang-key="apiPresetSelectLabel">选择或切换预设</label>
          <div style="display: flex; gap: 10px; align-items: center;"> <select id="appearance-preset-select" style="flex-grow: 1;"></select> <button id="save-appearance-preset-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;"data-lang-key="save">保存</button> <button
              id="delete-appearance-preset-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px; background-color: #ffebee; color: #d32f2f; border-color: #ffcdd2;"data-lang-key="delete">删除</button> </div>
        </div>
        <hr style="width: 80%; opacity: 0.3; margin: 30px 0;">
        <h3 style="margin-top:0; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; width:100%; text-align: left;">CSS 预设管理(CSS Preset)</h3>
        <div class="form-group" style="width:100%;"> <label for="css-preset-select"data-lang-key="apiPresetSelectLabel">选择或切换预设</label>
          <div style="display: flex; gap: 10px; align-items: center;"> <select id="css-preset-select" style="flex-grow: 1;"></select> <button id="save-css-preset-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;"data-lang-key="save">保存</button> <button id="delete-css-preset-btn"
              class="form-button-secondary" style="margin-top: 0; padding: 12px; background-color: #ffebee; color: #d32f2f; border-color: #ffcdd2;"data-lang-key="delete">删除</button> </div>
        </div>
        <div class="form-group" style="width:100%;"> <label for="global-css-input"> 全局美化样式 (CSS) <button id="reset-global-css-btn" type="button"
              style="background: none; border: 1px solid #ccc; color: #555; font-size: 12px; padding: 2px 8px; border-radius: 5px; cursor: pointer; margin-left: 10px;">重置</button> </label> <textarea id="global-css-input" rows="6"
            style="width: 100%; margin-top: 8px; font-family: monospace; font-size: 16px; resize: vertical;" placeholder="/* 在此输入自定义CSS */"></textarea> </div> <button class="form-button form-button-secondary" id="import-appearance-btn" style="margin-top: 10px;">导入外观 (JSON)</button>
        <input type="file" id="import-appearance-input" accept="application/json" hidden> <button class="form-button" id="save-wallpaper-btn" style="margin-top: 30px;"data-lang-key="appearanceSaveAll">保存所有外观设置</button>
      </div>
    </div>
    <div id="browser-screen" class="screen">
      <div class="header"> <span class="back-btn" id="browser-back-btn">‹</span> <span id="browser-title"></span> <span style="width: 30px;"></span> </div>
      <div id="browser-content" class="list-container"> </div>
    </div>
    <div id="font-settings-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span data-lang-key="fontSettingsTitle">字体设置</span> <span style="width: 30px;"></span> </div>
      <div class="form-container">
        <h3 style="margin-top:0; border-bottom: 1px solid #eee; padding-bottom: 10px;"data-lang-key="fontPresetManagement">字体预设管理</h3>
        <div class="form-group"> <label for="font-preset-select"data-lang-key="apiPresetSelectLabel">选择或切换预设</label>
          <div style="display: flex; gap: 10px; align-items: center;"> <select id="font-preset-select" style="flex-grow: 1;"></select> <button id="save-font-preset-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;"data-lang-key="save">保存</button> <button id="delete-font-preset-btn"
              class="form-button-secondary" style="margin-top: 0; padding: 12px; background-color: #ffebee; color: #d32f2f; border-color: #ffcdd2;"data-lang-key="delete">删除</button> </div>
        </div>
        <hr style="margin: 30px 0; opacity: 0.3;">
        <div class="form-group"> <label for="font-url-input"data-lang-key="fontFileUrlLabel">字体文件URL (.ttf, .otf, .woff等)</label> <input type="text" id="font-url-input" placeholder="https://..../font.ttf"> </div>
        <div class="form-group"> <label data-lang-key="fontPreviewLabel">实时预览</label>
          <div id="font-preview">
            <p style="font-size: 20px; margin: 0 0 10px 0;">你好世界 Hello World</p>
            <p style="margin: 0;">这是字体预览效果，12345。</p>
          </div>
        </div> <button class="form-button" id="save-font-btn"data-lang-key="fontSaveAndApply">保存并应用</button> <button class="form-button form-button-secondary" id="reset-font-btn"data-lang-key="fontResetDefault">恢复默认字体</button>
      </div>
    </div>
    <div id="contact-picker-screen" class="screen">
      <div class="header"> <span class="back-btn" id="cancel-contact-picker-btn"data-lang-key="cancel">取消</span> <span>选择联系人</span> <span class="save-btn" id="confirm-contact-picker-btn"data-lang-key="done">完成(0)</span> </div>
      <div class="list-container" id="contact-picker-list"> </div>
    </div>
    <div id="member-management-screen" class="screen">
      <div class="header"> <span class="back-btn" id="back-from-member-management">‹</span> <span>群成员管理</span> <span style="width: 30px;"></span> </div>
      <div class="list-container" id="member-management-list"> </div>
      <div id="member-management-actions"> <button id="add-existing-contact-btn">从好友列表添加</button> <button id="create-new-member-btn">创建群内新成员</button> </div>
    </div>
    <div id="sticker-category-manager-modal" class="modal">
      <div class="modal-content" style="height: 60%;">
        <div class="modal-header"> <span>管理表情分类</span> </div>
        <div class="modal-body">
          <div class="form-group"> <label>新建分类</label>
            <div style="display: flex; gap: 10px;"> <input type="text" id="new-sticker-category-name-input" placeholder="输入分类名..." style="flex-grow: 1;"> <button id="add-new-sticker-category-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">添加</button> </div>
          </div>
          <hr style="opacity: 0.2;">
          <div id="existing-sticker-categories-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
        </div>
        <div class="modal-footer"> <button class="save" id="close-sticker-category-manager-btn" style="width: 100%;"data-lang-key="done">完成</button> </div>
      </div>
    </div>
    <div id="incoming-call-modal" class="modal">
      <div class="incoming-call-content"> <img id="caller-avatar" class="caller-avatar" src="">
        <div id="caller-name" class="caller-name"></div>
        <div class="caller-text">邀请你视频通话</div>
        <div class="incoming-call-actions">
          <div class="action-button-wrapper"> <button id="decline-call-btn" class="call-action-btn decline"></button> <span>拒绝</span> </div>
          <div class="action-button-wrapper"> <button id="accept-call-btn" class="call-action-btn accept"></button> <span>接听</span> </div>
        </div>
      </div>
    </div>
    <div id="video-call-screen" class="screen">
      <div class="video-call-top-bar"> <span id="call-timer">00:00</span> </div>
      <div class="video-call-avatar-area">
        <div id="participant-avatars-grid"> </div>
      </div>
      <div id="video-call-main" class="video-call-main"> </div>
      <div class="video-call-controls"> <button id="user-speak-btn" class="control-btn speak-btn"></button> <button id="hang-up-btn" class="control-btn hangup-btn"></button> <button id="regenerate-call-btn" class="control-btn regenerate-btn"></button> <button id="join-call-btn"
          class="control-btn join-btn" style="display: none;"></button> </div>
    </div>
    <div id="outgoing-call-screen" class="screen">
      <div class="outgoing-call-content"> <img id="outgoing-call-avatar" class="caller-avatar" src="">
        <div id="outgoing-call-name" class="caller-name"></div>
        <div class="caller-text">正在呼叫...</div>
        <div class="outgoing-call-actions"> <button id="cancel-call-btn" class="call-action-btn decline"></button> <span data-lang-key="cancel">取消</span> </div>
      </div>
    </div>
    <div id="call-history-screen" class="screen">
      <div class="header"> <span class="back-btn" id="call-history-back-btn">‹</span> <span id="call-history-title">通话记录</span> <span style="width: 30px;"></span> </div>
      <div id="call-history-list" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
    </div>
    <div id="douban-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span>豆瓣小组</span>
        <div class="header-actions"> <span class="action-btn" id="douban-settings-btn" title="豆瓣设置"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path
                d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.44,0.17-0.48,0.41L9.12,4.84c-0.59,0.24-1.12,0.56-1.62,0.94L5.11,4.82c-0.22-0.08-0.47,0-0.59,0.22l-1.92,3.32 c-0.12,0.22-0.07,0.47,0.12,0.61l2.03,1.58C4.84,11.36,4.82,11.68,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.48,2.03 c0.04,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.48-0.41l0.48-2.03c0.59-0.24,1.12-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z">
              </path>
            </svg> </span> <span class="action-btn" id="douban-cast-select-btn" title="选择参与角色"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg> </span> <span class="action-btn" id="regenerate-douban-btn" title="重新生成内容"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg> </span> </div>
      </div>
      <div id="douban-posts-list" class="list-container"> </div>
    </div>
    <div id="douban-post-detail-screen" class="screen">
      <div class="header"> <span class="back-btn" id="douban-detail-back-btn">‹</span> <span id="douban-post-detail-title">帖子详情</span> <span style="width: 30px;"></span> </div>
      <div id="douban-detail-content-wrapper" class="list-container">
        <div id="douban-post-detail-body">
          <div class="douban-post-header"> <img id="douban-detail-avatar" class="douban-post-avatar">
            <div class="douban-author-info">
              <div id="douban-detail-author" class="douban-author-name"></div>
              <div id="douban-detail-group" class="douban-group-name"></div>
            </div>
          </div>
          <h2 id="douban-detail-post-title" class="douban-post-title"></h2>
          <div id="douban-detail-content" class="douban-detail-content"></div>
        </div>
        <div class="douban-comments-section">
          <h4>回应</h4>
          <div id="douban-detail-comments-list"></div>
        </div>
      </div>
      <div id="douban-comment-footer" class="post-footer">
        <div class="comment-section"> <img id="douban-my-comment-avatar" src="" class="comment-avatar"> <input type="text" id="douban-comment-input" class="comment-input" placeholder="写回应..."> </div> <button id="douban-wait-reply-btn" class="douban-feather-btn" title="让AI继续讨论"> <svg
            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path>
            <line x1="16" y1="8" x2="2" y2="22"></line>
            <line x1="17.5" y1="15" x2="9" y2="15"></line>
          </svg> </button> <button id="douban-send-comment-btn" class="comment-send-btn">发送</button>
      </div>
    </div>
    <div id="werewolf-game-screen" class="screen">
      <div class="header"> <span id="werewolf-game-title">狼人杀</span>
        <div class="header-actions"><span class="action-btn" id="werewolf-retry-btn" title="重试上一步AI操作" style="display: none;"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg></span> <span class="action-btn" id="exit-werewolf-game-btn">退出</span> </div>
      </div>
      <div id="werewolf-player-grid"></div>
      <div id="werewolf-log" class="list-container"></div>
      <div id="werewolf-action-bar">
        <div id="chat-input-main-row" style="width: 100%;"> <textarea id="werewolf-user-input" rows="1" placeholder="轮到你发言了..."></textarea>
          <div id="input-actions-wrapper" style="gap: 5px;"> <button id="werewolf-wait-reply-btn" class="action-button" style="display: none; background-color: #007bff; height: 40px; padding: 0 10px; font-size: 13px;">等待回应</button> <button id="werewolf-finish-speech-btn" class="action-button"
              style="display: none; background-color: var(--accent-color); height: 40px; padding: 0 10px; font-size: 13px;">结束发言</button> <button id="werewolf-next-step-btn" class="form-button" style="margin-top:0; display: none;">下一步</button> </div>
        </div>
      </div>
    </div>
    <div id="long-term-memory-screen" class="screen">
      <div class="header"> <span class="back-btn" id="memory-screen-back-btn">‹</span> <span data-lang-key="chatHeaderLongTermMemory">长期记忆</span>
        <div class="header-actions"> <span class="action-btn" id="refine-memory-btn-header">精炼</span> <span class="action-btn" id="summarize-recent-btn-header">总结</span> <span class="action-btn" id="add-manual-memory-btn-header">+</span> </div>
      </div>
      <div class="list-container" id="memory-list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px; background-color: #f0f2f5;"> </div>
    </div>
    <div id="chat-settings-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('chat-interface-screen')">‹</span> <span data-lang-key="chatHeaderChatSettings">聊天设置</span> <span class="save-btn" id="save-chat-settings-btn"data-lang-key="save">保存</span> </div>
      <div class="form-container">
        <div class="form-group" id="chat-name-group"><label for="chat-name-input">备注名 / 群名(Remark Name / Group Name)</label><input type="text" id="chat-name-input"></div>
        <div class="form-group" id="my-nickname-group"> <label for="my-nickname-input">我的昵称(My nickname)</label> <input type="text" id="my-nickname-input"> </div>
        <div class="form-group" id="assign-group-section" style="display: none;"> <label for="assign-group-select">好友分组(Friend Group)</label>
          <div style="display: flex; align-items: center; gap: 10px;"> <select id="assign-group-select" style="flex-grow: 1;"></select> <button id="manage-groups-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;">管理分组</button> </div>
        </div>
        <div class="form-group" id="my-group-nickname-group"><label for="my-group-nickname-input">我的群昵称(My group nickname)</label><input type="text" id="my-group-nickname-input"></div> <button class="form-button form-button-secondary" id="search-history-btn" style="margin-top: 10px;">搜索聊天记录</button>
        <div class="form-group" id="single-char-background-activity-group">
          <div class="form-group" id="inject-thought-group">
            <div style="display: flex; justify-content: space-between; align-items: center;"> <label for="inject-thought-toggle" style="margin-bottom: 0;"> 注入最新心声(Inject the latest thoughts)<p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 开启后，AI在回应前会“看到”自己上一轮的内心独白。这能增强连贯性，但可能轻微增加Token消耗。 </p>
              </label> <label class="toggle-switch"> <input type="checkbox" id="inject-thought-toggle"> <span class="slider"></span> </label> </div>
          </div>
          <div style="display: flex; justify-content: space-between; align-items: center;"> <label for="char-background-activity-switch" style="margin-bottom: 0;"> 启用独立后台活动 (Enable standalone background activity)<p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 允许该角色在后台独立发消息或动态。需同时开启API设置中的总开关。 </p> </label>
            <label class="toggle-switch"> <input type="checkbox" id="char-background-activity-switch"> <span class="slider"></span> </label> </div>
        </div>
        <div class="form-group" id="ai-cooldown-group"> <label for="ai-action-cooldown-input"> 独立行动冷却 (分钟)(Independent Action Cooldown (minutes)) <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> AI在后台主动发消息或动态的最小间隔。 </p> </label> <input type="number" id="ai-action-cooldown-input" min="1" value="10"
            style="width: 80px; text-align: center;"> </div>
        <div class="form-group" id="time-perception-group">
          <div style="display: flex; justify-content: space-between; align-items: center;"> <label for="time-perception-toggle" style="margin-bottom: 0;"> 启用时间感知 (Enable time awareness)<p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 关闭后，AI将不会接收到当前时间信息，对话中不再体现时间变化。 </p> </label>
            <label class="toggle-switch"> <input type="checkbox" id="time-perception-toggle"> <span class="slider"></span> </label>
          </div>
        </div>
        <div class="form-group" id="time-zone-group" style="display: none;"> <label for="time-zone-select">选择时区(Select Time Zone)</label> <input type="search" id="time-zone-search-input" placeholder="搜索时区，例如 Shanghai, New York..."> <select id="time-zone-select" style="width: 100%;"></select></div>
        <div class="form-group" id="group-background-activity-group">
          <div style="display: flex; justify-content: space-between; align-items: center;"> <label for="group-background-activity-switch" style="margin-bottom: 0;"> 启用群内后台活动(Enable in-group background activities) <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 允许AI成员在该群聊中独立行动。需同时开启API设置中的总开关。 </p> </label>
            <label class="toggle-switch"> <input type="checkbox" id="group-background-activity-switch"> <span class="slider"></span> </label> </div>
        </div>
        <div class="form-group" id="group-cooldown-group"> <label for="group-action-cooldown-input"> 群聊行动冷却 (分钟) (Group Chat Action Cooldown (minutes))<p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> AI在后台主动在群内行动的最小间隔。 </p> </label> <input type="number" id="group-action-cooldown-input" min="1" value="10"
            style="width: 80px; text-align: center;"> </div>
        <div class="form-group" id="group-avatar-group"> <label>群头像(Group Avatar)</label>
          <div class="avatar-upload"> <img id="group-avatar-preview"> <button onclick="document.getElementById('group-avatar-input').click()">上传群头像</button> <button id="manage-group-avatar-library-btn">管理头像库</button> <input type="file" id="group-avatar-input" accept="image/*"> </div>
        </div>
        <div class="form-group" id="world-book-link-group"> <label>关联世界书 (可多选)(Associated World Book (multiple selections allowed))</label>
          <div class="custom-multiselect">
            <div class="select-box"> <span class="selected-options-text">-- 点击选择 --</span> <span class="arrow-down">▼</span> </div>
            <div id="world-book-checkboxes-container" class="checkboxes-container"> </div>
          </div>
        </div>
        <div class="form-group" id="lyrics-position-group" style="display: none;">
          <hr style="opacity: 0.3; margin: 20px 0;"> <label>歌词栏位置(Lyrics section position)</label>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 8px;">
            <div> <label for="lyrics-vertical-pos" style="font-size: 0.9em; color: var(--text-secondary);">垂直位置(Vertical position)</label> <select id="lyrics-vertical-pos" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 14px;">
                <option value="top">顶部</option>
                <option value="bottom">底部</option>
              </select> </div>
            <div> <label for="lyrics-horizontal-pos" style="font-size: 0.9em; color: var(--text-secondary);">水平对齐(Horizontal alignment)</label> <select id="lyrics-horizontal-pos" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 14px;">
                <option value="left">居左</option>
                <option value="center">居中</option>
                <option value="right">居右</option>
              </select> </div>
          </div>
          <div style="margin-top: 10px;"> <label for="lyrics-offset-input" style="font-size: 0.9em; color: var(--text-secondary);">垂直偏移 (px)</label> <input type="number" id="lyrics-offset-input" value="10"
              style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 14px; box-sizing: border-box;"> </div>
        </div>
        <div class="form-group" id="offline-mode-group">
          <hr style="opacity: 0.3; margin: 20px 0;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"> <label for="offline-mode-toggle" style="margin-bottom: 0;"> 启用线下模式 (Enable offline mode)<p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 开启后, AI的回复将变为包含「对话」和<i
                  style="color: #666;">动作/环境描写</i>的剧情模式。 </p> </label> <label class="toggle-switch"> <input type="checkbox" id="offline-mode-toggle"> <span class="slider"></span> </label> </div>
          <div id="offline-mode-options" style="display: none; margin-top: 15px;"> <label for="offline-min-length-input">回复字数范围(Range of reply word count)</label>
            <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;"> <input type="number" id="offline-min-length-input" value="100" style="width: 80px; text-align: center;"> <span>到</span> <input type="number" id="offline-max-length-input" value="300"
                style="width: 80px; text-align: center;"> <span>字</span> </div>
            <div class="form-group" style="margin-top: 15px; margin-bottom: 0;"> <label for="offline-preset-select">文风预设 (将影响AI的描写风格)(Writing Style Preset)</label> <select id="offline-preset-select" style="width: 100%; margin-top: 5px;"></select> </div>
          </div>
        </div>
        <div class="form-group" id="linked-memory-group"> <label for="link-memory-toggle">挂载其他聊天记忆(Mount other chat memories)</label> <input type="checkbox" id="link-memory-toggle" style="width: auto; height: 20px; vertical-align: middle; margin-left: 10px;">
          <div id="linked-memory-selection" style="display: none; margin-top: 10px;"> <label>选择要挂载记忆的聊天 (可多选):(Select the chats to mount memory to (multiple selections allowed))</label>
            <div class="custom-multiselect">
              <div class="select-box"> <span class="selected-options-text">-- 点击选择 --</span> <span class="arrow-down">▼</span> </div>
              <div id="linked-chats-checkboxes-container" class="checkboxes-container" style="max-height: 120px;"> </div>
            </div>
            <p style="font-size: 12px; color: #8a8a8a; margin-top: 8px; line-height: 1.5;"> • 挂载的记忆会以“参考记忆”的形式提供给AI，不会直接显示在聊天界面。<br> • 建议每个聊天挂载3-10轮记忆，避免影响响应速度。 </p>
          </div>
        </div>
        <div class="form-group" id="ai-original-name-group"> <label for="ai-original-name-input">对方本名 (The other party's real name)</label> <input type="text" id="ai-original-name-input"> </div>
        <div class="form-group" id="ai-persona-group"><label for="ai-persona">对方人设 (AI Persona)</label><textarea id="ai-persona" rows="3"></textarea></div>
        <div class="form-group" id="ai-avatar-group"><label>对方头像(Opponent's avatar)</label>
          <div class="avatar-upload"><img id="ai-avatar-preview"><button onclick="document.getElementById('ai-avatar-input').click()">上传对方头像</button><button id="manage-ai-avatar-library-btn">管理头像库</button><button class="change-frame-btn" data-type="ai">更换头像框</button> <input type="file"
              id="ai-avatar-input" accept="image/*"> </div>
        </div>
        <div class="form-group" id="my-persona-group"><label for="my-persona">我的人设 (My Persona)</label><textarea id="my-persona" rows="3"></textarea></div>
        <div class="form-group" id="switch-greeting-group" style="display: none;"> <label>切换开场 (会清空当前对话)</label> <button id="switch-greeting-btn" class="form-button form-button-secondary" style="margin-top: 5px;">选择其他开场故事...</button> </div>
        <div class="form-group" id="my-avatar-group"> <label>我的头像(My profile picture)</label>
          <div class="avatar-upload"> <img id="my-avatar-preview"> <button onclick="document.getElementById('my-avatar-input').click()">上传我的头像</button> <button id="manage-my-avatar-library-btn">管理头像库</button> <button class="change-frame-btn" data-type="my">更换头像框</button> <button
              id="open-persona-library-btn">预设</button> <input type="file" id="my-avatar-input" accept="image/*"> </div>
        </div>
        <div class="form-group" id="group-members-group"><label>群成员人设(Character setting of group members)</label>
          <div id="group-members-settings"></div> <button id="manage-members-btn" class="form-button form-button-secondary" style="margin-top: 15px;">管理群成员</button>
        </div>
        
        <div class="form-group" id="group-nai-settings-group" style="display: none;">
        <hr style="opacity: 0.2; margin: 20px 0;">
        <label style="font-weight: 600; color: var(--accent-color);">NAI出图设置</label>
        <p style="font-size: 12px; color: #666; margin-top: 5px;">
            为当前角色配置专属的NovelAI出图提示词
        </p>
        
        <div style="margin-top: 15px;">
            <label style="font-weight: 500; color: #333;">提示词来源</label>
            <div style="display: flex; gap: 15px; margin-top: 10px;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="radio" name="group-nai-prompt-source" value="system" checked style="width: auto; margin-right: 8px;">
                    <span>使用系统设置</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="radio" name="group-nai-prompt-source" value="character" style="width: auto; margin-right: 8px;">
                    <span>使用当前角色配置</span>
                </label>
            </div>
        </div>
        
        <button id="group-character-nai-prompts-btn" class="form-button form-button-secondary" style="width: 100%; margin-top: 15px;">配置角色专属提示词</button>
    </div>
        
        <div class="form-group" id="tts-enable-group">
          <div style="display: flex; justify-content: space-between; align-items: center;"> <label for="enable-tts-switch" style="margin-bottom: 0;"> 启用语音合成 (TTS) <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 关闭后，即使AI回复包含 [V] 前缀，也不会生成语音消息。 </p> </label>
            <label class="toggle-switch"> <input type="checkbox" id="enable-tts-switch"> <span class="slider"></span> </label>
          </div>
        </div>
        <div class="form-group" id="ai-voice-id-group"> <label for="ai-voice-id-input">语音 ID (Minimax voice_id)</label> <input type="text" id="ai-voice-id-input" placeholder="例如: female-shaonv-jingpin"></div>
        
        <!-- NAI出图设置（单聊显示） -->
    <div class="form-group" id="nai-character-settings-group" style="display: none;">
        <hr style="opacity: 0.2; margin: 20px 0;">
        <label style="font-weight: 600; color: var(--accent-color);">NAI出图设置</label>
        <p style="font-size: 12px; color: #666; margin-top: 5px;">
            为当前角色配置专属的NovelAI出图提示词
        </p>
        
        <div style="margin-top: 15px;">
            <label style="font-weight: 500; color: #333;">提示词来源</label>
            <div style="display: flex; gap: 15px; margin-top: 10px;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="radio" name="nai-prompt-source" value="system" checked style="width: auto; margin-right: 8px;">
                    <span>使用系统设置</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="radio" name="nai-prompt-source" value="character" style="width: auto; margin-right: 8px;">
                    <span>使用当前角色配置</span>
                </label>
            </div>
        </div>
        
        <button id="character-nai-prompts-btn" class="form-button form-button-secondary" style="width: 100%; margin-top: 15px;">配置角色专属提示词</button>
    </div>

    <!-- NAI出图设置（群聊显示） -->
    <div class="form-group" id="group-nai-settings-group" style="display: none;">
        <hr style="opacity: 0.2; margin: 20px 0;">
        <label style="font-weight: 600; color: var(--accent-color);">NAI出图设置</label>
        <p style="font-size: 12px; color: #666; margin-top: 5px;">
            为当前角色配置专属的NovelAI出图提示词
        </p>
        
        <div style="margin-top: 15px;">
            <label style="font-weight: 500; color: #333;">提示词来源</label>
            <div style="display: flex; gap: 15px; margin-top: 10px;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="radio" name="group-nai-prompt-source" value="system" checked style="width: auto; margin-right: 8px;">
                    <span>使用系统设置</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="radio" name="group-nai-prompt-source" value="character" style="width: auto; margin-right: 8px;">
                    <span>使用当前角色配置</span>
                </label>
            </div>
        </div>
        
        <button id="group-character-nai-prompts-btn" class="form-button form-button-secondary" style="width: 100%; margin-top: 15px;">配置角色专属提示词</button>
    </div>

        <div class="form-group"> <label for="max-memory">短期记忆（上下文）条数</label> <input type="number" id="max-memory" value="10"> </div>
        <div class="form-group"> <label for="linked-memory-count">挂载记忆条数</label> <input type="number" id="linked-memory-count" value="10">
          <p style="font-size: 12px; color: #8a8a8a; margin-top: 8px; line-height: 1.5;"> • 每次调用时，从每个“挂载的聊天”中提取最后几条记录作为参考记忆。 <br> • 建议值 5-20。值越大记忆越全，但API费用越高、响应越慢。 </p>
        </div>
        <div class="form-group">
            <label for="token-count-display">
                预估总上下文Token数 (仅供参考)
                <span title="这是一个基于字符数和复杂规则的估算值，与模型实际计算结果可能存在差异。" style="cursor: help; color: #999;"></span>
            </label>
<p id="token-count-display">
            正在计算...
        </p>
        </div>
        <hr style="opacity: 0.3; margin: 20px 0;">
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;"> <label for="auto-memory-toggle" style="margin-bottom: 0;"> 启用自动总结长期记忆(Enable automatic long-term memory summarization) <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 开启后，AI会在对话达到一定长度时，自动将内容提炼为长期记忆。 </p>
          </label> <label class="toggle-switch"> <input type="checkbox" id="auto-memory-toggle"> <span class="slider"></span> </label> </div>
        <div class="form-group"> <label for="auto-memory-interval">自动总结间隔（消息条数）(Automatic summary interval (number of messages))</label> <input type="number" id="auto-memory-interval" min="10" value="20" style="width: 80px; text-align: center;">
          <p style="font-size: 12px; color: #8a8a8a; margin-top: 8px;"> 建议值 60-150。值越小，总结越频繁，但API费用也越高。 </p>
        </div>
        <hr style="opacity: 0.3; margin: 20px 0;">
        <div class="form-group"> <label>聊天气泡主题(Chat bubble theme) <button id="reset-theme-btn" type="button">重置</button></label>
          <div class="theme-selector"> <label><input type="radio" name="theme-select" value="default" id="theme-default"> 默认</label> <label><input type="radio" name="theme-select" value="pink_blue"> 粉蓝</label> <label><input type="radio" name="theme-select" value="blue_white"> 蓝白</label>
            <label><input type="radio" name="theme-select" value="purple_yellow"> 紫黄</label> <label><input type="radio" name="theme-select" value="black_white"> 黑白</label> <label><input type="radio" name="theme-select" value="yellow_white"> 黄白</label> <label><input type="radio" name="theme-select"
                value="red_black"> 红黑</label> <label><input type="radio" name="theme-select" value="blue_yellow"> 蓝黄</label> <label><input type="radio" name="theme-select" value="pink_yellow"> 粉黄</label> <label><input type="radio" name="theme-select" value="pink_purple"> 粉紫</label> <label><input
                type="radio" name="theme-select" value="gray_white"> 灰白</label> <label><input type="radio" name="theme-select" value="blue_green"> 蓝绿</label> <label><input type="radio" name="theme-select" value="pink_white"> 粉白</label>
            <label><input type="radio" name="theme-select" value="pink_black"> 粉黑</label> <label><input type="radio" name="theme-select" value="pink_green"> 粉绿</label> <label><input type="radio" name="theme-select" value="green_black"> 绿黑</label>
          </div>
        </div>
        <div class="form-group"> <label for="font-size-slider">聊天字体大小 (Chat font size)<span id="font-size-value">13px</span></label> <input type="range" id="font-size-slider" min="12" max="20" step="1" value="13" style="width: 100%; margin-top: 8px;"> </div>
        <hr style="opacity: 0.3; margin: 20px 0;">
        <div class="form-group"> <label for="theme-preset-select">主题预设管理(Theme Preset Management)</label>
          <div style="display: flex; gap: 10px; align-items: center;"> <select id="theme-preset-select" style="flex-grow: 1;"></select> <button id="save-theme-preset-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;"data-lang-key="save">保存</button> <button id="delete-theme-preset-btn"
              class="form-button-secondary" style="margin-top: 0; padding: 12px; background-color: #ffebee; color: #d32f2f; border-color: #ffcdd2;"data-lang-key="delete">删除</button> </div>
        </div>
        <div class="form-group"> <label for="custom-css-input"> 自定义气泡样式 (CSS) <button id="reset-custom-css-btn" type="button" style="background: none; border: 1px solid #ccc; color: #555; font-size: 12px; padding: 2px 8px; border-radius: 5px; cursor: pointer; margin-left: 10px;">重置</button>
          </label> <textarea id="custom-css-input" rows="5" style="width: 100%; margin-top: 8px; font-family: monospace; font-size: 16px; resize: vertical;"
            placeholder="/* 示例：为“我”的气泡添加渐变背景和阴影 */ .message-bubble.user .content { background: linear-gradient(135deg, #a1c4fd, #c2e9fb); box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-radius: 15px 4px 15px 15px; }"></textarea> </div>
        <div class="form-group"> <label>实时预览</label>
          <div id="settings-preview-area"></div>
        </div>
        <div class="form-group"> <label>聊天背景(Chat background)</label>
          <div class="bg-upload-container"> <button type="button" class="form-button-secondary" style="width: auto; padding: 8px 12px; margin-top: 0;" onclick="document.getElementById('bg-input').click()">上传背景图</button> <button type="button" id="remove-bg-btn">移除背景</button> </div> <img
            id="bg-preview" class="bg-preview-img"> <input type="file" id="bg-input" accept="image/*" style="display: none;">
        </div>
        <hr style="margin: 25px 0; border: none; border-top: 1px solid #eee;"> <button class="form-button form-button-secondary" id="block-chat-btn" style="background-color: #ff3b30; color: white; border-color: #ff3b30;">拉黑对方</button>
        <hr style="margin: 25px 0; border: none; border-top: 1px solid #eee;"><button class="form-button form-button-secondary" id="export-single-chat-btn" style="background-color: #e8f5e9; color: #2e7d32; border-color: #c8e6c9;">导出该聊天</button><button class="form-button form-button-secondary"
          id="import-single-chat-btn" style="background-color: #fff3e0; color: #ef6c00; border-color: #ffe0b2;">导入该聊天</button><input type="file" id="import-single-chat-input" accept="application/json" hidden> <button class="form-button form-button-secondary" id="clear-chat-btn">清空聊天记录</button>
      </div>
    </div>
    <div id="rendering-rules-screen" class="screen">
      <div class="header"> <span class="back-btn" onclick="showScreen('home-screen')">‹</span> <span data-lang-key="homeAppRenderer">渲染规则</span> <span class="action-btn" id="add-new-rule-btn">+</span> </div>
      <div id="rules-tabs"> </div>
      <div id="rules-content-container"> </div>
    </div>
    <div id="rule-editor-modal" class="modal">
      <div class="modal-content" style="height: 85%;">
        <div class="modal-header"> <span id="rule-editor-title">创建新规则</span> </div>
        <div class="modal-body" style="display: flex; flex-direction: column; gap: 15px;">
          <div class="form-group" style="flex-shrink: 0;"> <label for="rule-name-input">规则名称</label> <input type="text" id="rule-name-input" placeholder="例如：美团外卖卡片"> </div>
          <div class="form-group" style="flex-shrink: 0;"> <label for="rule-chat-id-select">绑定范围</label> <select id="rule-chat-id-select">
              <option value="global">公用 (所有角色)</option>
            </select> </div>
          <div class="form-group" style="flex-grow: 1; display: flex; flex-direction: column;"> <label for="rule-regex-input">正则表达式 (使用g作为标志)</label> <textarea id="rule-regex-input" rows="3" style="font-family: monospace; resize: vertical;" placeholder="例如：MTR\[(.*?)\]\[(.*?)\|(.*?)\]"></textarea>
          </div>
          <div class="form-group" style="flex-grow: 2; display: flex; flex-direction: column;"> <label for="rule-template-input">HTML 模板 (用 $1, $2 引用)</label> <textarea id="rule-template-input" rows="6" style="font-family: monospace; resize: vertical;"
              placeholder="例如：<div class=`waimai-card`>...<span>$2</span>...</div>"></textarea> </div>
          <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;"> <label for="rule-enabled-switch" style="margin-bottom: 0;">启用规则</label> <label class="toggle-switch"> <input type="checkbox" id="rule-enabled-switch" checked>
              <span class="slider"></span> </label> </div>
        </div>
        <div class="modal-footer"> <button class="cancel" id="cancel-rule-editor-btn" data-lang-key="cancel">取消</button> <button class="save" id="save-rule-btn"data-lang-key="save">保存规则</button> </div>
      </div>
    </div>
    <div id="search-history-screen" class="screen">
      <div class="header"> <span class="back-btn" id="search-history-back-btn">‹</span> <span>搜索聊天记录</span> <span style="width: 30px;"></span> </div>
      <div id="search-bar" style="padding: 10px 15px; border-bottom: 1px solid var(--border-color); background-color: var(--secondary-bg); flex-shrink: 0;">
        <div style="display: flex; gap: 10px; margin-bottom: 10px;"> <input type="search" id="keyword-search-input" placeholder="输入关键词..." style="flex-grow: 1; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 16px;"> <input type="date" id="date-search-input"
            style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 16px;"> </div>
        <div style="display: flex; gap: 10px;"> <button id="execute-search-btn" class="form-button" style="margin-top: 0; flex-grow: 1;">搜索</button> <button id="clear-search-btn" class="form-button form-button-secondary" style="margin-top: 0; flex-grow: 1;">重置</button> </div>
      </div>
      <div id="chat-search-results-list" class="list-container" style="padding: 15px; display: flex; flex-direction: column; gap: 15px;"> </div>
    </div>
    <div id="shopping-screen" class="screen">
      <div class="header">
        <div class="header-left-actions"> <span class="back-btn" id="shopping-back-btn">‹</span> <span class="action-btn" id="generate-shopping-items-btn" title="AI生成商品"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"></path>
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"></path>
            </svg> </span> <span class="action-btn" id="shopping-settings-btn" title="生成设置"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path
                d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.44,0.17-0.48,0.41L9.12,4.84c-0.59,0.24-1.12,0.56-1.62,0.94L5.11,4.82c-0.22-0.08-0.47,0-0.59,0.22l-1.92,3.32 c-0.12,0.22-0.07,0.47,0.12,0.61l2.03,1.58C4.84,11.36,4.82,11.68,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.48,2.03 c0.04,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.48-0.41l0.48-2.03c0.59-0.24,1.12-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z">
              </path>
            </svg> </span> <span class="action-btn" id="delete-current-category-btn" title="删除当前分类" style="display: none; color: rgb(255, 59, 48);"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path>
              <line x1="18" y1="9" x2="12" y2="15"></line>
              <line x1="12" y1="9" x2="18" y2="15"></line>
            </svg> </span> </div> <span>购物中心</span>
        <div class="header-actions"> <span class="action-btn" id="manage-products-btn" title="管理商品" style="color: var(--text-primary);"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
            </svg> </span> <span class="action-btn" id="add-new-product-btn" title="添加新商品"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="16"></line>
              <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg> </span> <span class="action-btn" id="go-to-cart-btn" title="查看购物车"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg> <span id="cart-count">0</span> </span> </div>
      </div>
      <div id="product-category-tabs"></div>
      <div id="product-grid" class="list-container"> </div>
      <div id="shopping-action-bar"> <label class="select-all-label"> <input type="checkbox" id="select-all-products-checkbox"> 全选 </label> <button id="delete-selected-products-btn" class="action-bar-btn">删除 (0)</button> </div>
    </div>
    <div id="product-detail-screen" class="screen">
      <div class="header"> <span class="back-btn" id="product-detail-back-btn">‹</span> <span>商品详情</span> <span style="width: 30px;"></span> </div>
      <div id="product-detail-content" class="list-container"> </div>
      <div id="product-detail-footer"> <button class="footer-btn add-to-cart-detail-btn">加入购物车</button> <button class="footer-btn buy-now-btn">立即购买</button> </div>
    </div>
    <div id="cart-screen" class="screen">
      <div class="header"> <span class="back-btn" id="cart-back-btn">‹</span> <span id="cart-title">购物车(0)</span> <span class="action-btn" id="clear-cart-btn">清空</span> </div>
      <div id="cart-items-list" class="list-container"> </div>
      <div id="cart-footer"> <label class="select-all-label"><input type="checkbox" id="select-all-cart-items"> 全选</label>
        <div class="cart-summary">
          <div id="cart-total">合计: ¥0.00</div> <span class="cart-subtext">不含运费</span>
        </div> <button id="checkout-btn">结算(0)</button>
      </div>
    </div>
    <div id="product-editor-modal" class="modal">
      <div class="modal-content" style="height: 85%;">
        <div class="modal-header"> <span id="product-editor-title">添加商品</span> </div>
        <div class="modal-body">
          <div class="form-group"> <label>商品图片</label>
            <div class="avatar-upload"> <img id="product-image-preview" src="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756206115802_qdqqd_0c99bh.jpeg"> <button onclick="document.getElementById('product-image-input').click()">上传图片</button> <input type="file" id="product-image-input"
                accept="image/*" hidden> </div>
          </div>
          <div class="form-group"> <label for="product-name-input">商品名称</label> <input type="text" id="product-name-input"> </div>
          <div class="form-group"> <label for="product-category-select">商品分类</label>
            <div style="display: flex; align-items: center; gap: 10px;"> <select id="product-category-select" style="flex-grow: 1;"></select> <button id="manage-product-categories-btn" class="form-button-secondary" style="margin-top: 0; padding: 12px;">管理</button> </div>
          </div>
          <div class="form-group"> <label for="product-price-input">默认价格 (元)</label> <input type="number" id="product-price-input" min="0" step="0.01"> </div>
          <div class="form-group"> <label for="product-description-input">商品描述</label> <textarea id="product-description-input" rows="3" placeholder="详细介绍一下这个商品..."></textarea> </div>
          <hr style="opacity: 0.2; margin: 20px 0;">
          <div class="form-group"> <label>商品款式</label>
            <p style="font-size: 12px; color: #888; margin-top: -5px; margin-bottom: 10px;">如果没有添加任何款式，将使用上面的默认价格。</p>
            <div id="product-variations-container" style="display: flex; flex-direction: column; gap: 15px;"> </div> <button id="add-product-variation-btn" class="form-button form-button-secondary" style="margin-top: 15px;">+ 添加新的一款</button>
          </div>
        </div>
        <div class="modal-footer"> <button class="cancel" id="cancel-product-editor-btn"data-lang-key="cancel">取消</button> <button class="save" id="save-product-btn"data-lang-key="save">保存</button> </div>
      </div>
    </div>
    <div id="gift-receipt-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header"> <span>购物小票</span> </div>
        <div class="modal-body" id="gift-receipt-body"> </div>
        <div class="modal-footer"> <button class="save" id="close-receipt-btn" style="width:100%;">关闭</button> </div>
      </div>
    </div>
  </div>
  </div> <input type="file" id="import-card-input" accept=".json,.png" style="display: none;"> <input type="file" id="import-world-book-input" accept=".json" style="display: none;">
  <div id="persona-library-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><span>我的人设库</span><button id="add-persona-preset-btn" class="action-button"data-lang-key="add">添加</button></div>
      <div class="modal-body">
        <div id="persona-library-grid"></div>
      </div>
      <div class="modal-footer"><button class="cancel" id="close-persona-library-btn">关闭</button></div>
    </div>
  </div>
  <div id="persona-editor-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><span id="persona-editor-title">添加人设预设</span></div>
      <div class="modal-body">
        <div class="form-group"><label>预设头像</label>
          <div class="avatar-upload"><img id="preset-avatar-preview"><button onclick="document.getElementById('preset-avatar-input').click()">上传头像</button><input type="file" id="preset-avatar-input" accept="image/*"></div>
        </div>
        <div class="form-group"><label for="preset-persona-input">预设人设</label><textarea id="preset-persona-input" rows="4" placeholder="在此输入这个人设的详细设定..."></textarea></div>
      </div>
      <div class="modal-footer"><button class="cancel" id="cancel-persona-editor-btn"data-lang-key="cancel">取消</button><button class="save" id="save-persona-preset-btn"data-lang-key="save">保存</button></div>
    </div>
  </div>
  <div id="member-settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><span data-lang-key="edit">编辑群成员</span></div>
      <div class="modal-body">
        <div class="form-group"><label for="member-name-input">名字</label><input type="text" id="member-name-input"></div>
        <div class="form-group"><label for="member-persona-input">人设</label><textarea id="member-persona-input" rows="4"></textarea></div>
        <div class="form-group"><label>头像</label>
          <div class="avatar-upload"><img id="member-avatar-preview"><button onclick="document.getElementById('member-avatar-input').click()">上传头像</button><button class="change-frame-btn" data-type="member">更换头像框</button><input type="file" id="member-avatar-input" accept="image/*"></div>
        </div>
      </div>
      <div class="modal-footer"><button class="cancel" id="cancel-member-settings-btn"data-lang-key="cancel">取消</button><button class="save" id="save-member-settings-btn"data-lang-key="save">保存</button></div>
    </div>
  </div>
  <div id="custom-modal-overlay">
    <div id="custom-modal">
      <div class="custom-modal-header" id="custom-modal-title"></div>
      <div class="custom-modal-body" id="custom-modal-body"></div>
      <div class="custom-modal-footer"> <button id="custom-modal-cancel"data-lang-key="cancel">取消</button> <button id="custom-modal-confirm" class="confirm-btn"data-lang-key="confirm">确定</button> </div>
    </div>
  </div>
  <div id="preset-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="preset-action-edit" data-lang-key="edit">编辑预设</button> <button id="preset-action-delete" class="btn-danger">删除预设</button> <button id="preset-action-cancel" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">取消</button> </div>
    </div>
  </div>
  <div id="transfer-modal">
    <div class="transfer-content">
      <div class="transfer-header">给Ta一个惊喜！</div>
      <div class="transfer-input-group"> <label for="transfer-amount">转账金额</label> <input type="number" id="transfer-amount" placeholder="0.00" min="0" step="0.01"> </div>
      <div class="transfer-input-group"> <label for="transfer-note">备注 (可选)</label> <input type="text" id="transfer-note" placeholder="留下你的小心思~" maxlength="20"> </div>
      <div class="transfer-actions"> <button id="transfer-cancel-btn" data-lang-key="cancel">取消</button> <button id="transfer-confirm-btn">确认转账</button> </div>
    </div>
  </div>
  <div id="battery-alert-modal">
    <div class="battery-alert-content"> <img id="battery-alert-image" src="">
      <p id="battery-alert-text"></p>
    </div>
  </div>
  <div id="waimai-request-modal" class="modal">
    <div class="modal-content" style="width: 290px;">
      <div class="modal-header"> <span>发起外卖订单</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label for="waimai-product-info">商品信息</label> <input type="text" id="waimai-product-info" placeholder="例如：一杯杨枝甘露"> </div>
        <div class="form-group"> <label for="waimai-amount">订单金额 (元)</label> <input type="number" id="waimai-amount" placeholder="例如：21" min="0" step="0.01"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="waimai-order-for-ai-btn">为TA点单</button> <button class="save" id="waimai-confirm-btn">发起请求</button> </div>
    </div>
  </div>
  <div id="create-countdown-modal" class="modal">
    <div class="modal-content" style="height: auto;">
      <div class="modal-header"> <span>新建约定</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label for="countdown-title-input">约定标题</label> <input type="text" id="countdown-title-input" placeholder="例如：我的生日"> </div>
        <div class="form-group"> <label for="countdown-date-input">约定日期与时间</label> <input type="datetime-local" id="countdown-date-input"> </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-create-countdown-btn"data-lang-key="cancel">取消</button> <button class="save" id="confirm-create-countdown-btn"data-lang-key="save">保存约定</button> </div>
    </div>
  </div>
  <div id="red-packet-modal" class="modal">
    <div class="modal-content" style="width: 300px; height: auto;">
      <div class="modal-header"> <span>发红包</span> </div>
      <div class="modal-body" style="padding: 0;">
        <div class="frame-tabs">
          <div id="rp-tab-group" class="frame-tab active">拼手气红包</div>
          <div id="rp-tab-direct" class="frame-tab">专属红包</div>
        </div>
        <div id="rp-content-group" class="frame-content" style="padding: 20px 15px;">
          <div class="form-group"> <label>总金额 (元)</label> <input type="number" id="rp-group-amount" placeholder="0.00"> </div>
          <div class="form-group"> <label>红包个数</label> <input type="number" id="rp-group-count" placeholder="填写红包个数"> </div>
          <div class="form-group"> <label>祝福语</label> <input type="text" id="rp-group-greeting" placeholder="恭喜发财，大吉大利！"> </div>
          <p id="rp-group-total" style="text-align: center; font-size: 24px; font-weight: bold; margin: 10px 0;">¥ 0.00</p> <button id="send-group-packet-btn" class="form-button">塞钱进红包</button>
        </div>
        <div id="rp-content-direct" class="frame-content" style="display: none; padding: 20px 15px;">
          <div class="form-group"> <label>发送给</label> <select id="rp-direct-receiver"></select> </div>
          <div class="form-group"> <label>金额 (元)</label> <input type="number" id="rp-direct-amount" placeholder="0.00"> </div>
          <div class="form-group"> <label>祝福语</label> <input type="text" id="rp-direct-greeting" placeholder="恭喜发财，大吉大利！"> </div>
          <p id="rp-direct-total" style="text-align: center; font-size: 24px; font-weight: bold; margin: 10px 0;">¥ 0.00</p> <button id="send-direct-packet-btn" class="form-button">塞钱进红包</button>
        </div>
      </div>
      <div class="modal-footer" style="justify-content: center;"> <button class="cancel" id="cancel-red-packet-btn" style="width: 100%;"data-lang-key="cancel">取消</button> </div>
    </div>
  </div>
  <div id="red-packet-details-modal" class="modal">
    <div class="modal-content" style="width: 280px; height: auto; background-color: #f7f7f7;">
      <div class="modal-header" style="background-color: #F96259; color: white; border-bottom: none; padding-bottom: 5px;">
        <div style="text-align: center; width: 100%;">
          <div id="rp-details-sender" style="font-size: 16px;"></div>
          <div style="font-size: 13px; opacity: 0.8;">的红包</div>
        </div>
      </div>
      <div class="modal-body" style="padding: 15px;">
        <p id="rp-details-greeting" style="text-align: center; font-size: 20px; color: #333; margin: 0 0 20px 0;"></p>
        <div id="rp-details-my-amount" style="text-align: center; display: none; margin-bottom: 20px;"> <span style="font-size: 40px; font-weight: bold; color: #E44D44;">0.00</span> <span style="font-size: 18px; color: #E44D44;">元</span> </div>
        <div id="rp-details-summary" style="font-size: 13px; color: #8a8a8a; border-top: 1px solid #e0e0e0; padding-top: 10px;"></div>
        <div id="rp-details-list" style="max-height: 150px; overflow-y: auto; margin-top: 10px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-rp-details-btn" style="width: 100%;">关闭</button> </div>
    </div>
  </div>
  <div id="create-poll-modal" class="modal">
    <div class="modal-content" style="width: 300px; height: auto;">
      <div class="modal-header"> <span>发起投票</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label for="poll-question-input">投票问题</label> <textarea id="poll-question-input" rows="2" placeholder="例如：今晚我们看什么电影？"></textarea> </div>
        <div class="form-group"> <label>投票选项 (至少2项)</label>
          <div id="poll-options-container" style="display: flex; flex-direction: column; gap: 8px;"> </div> <button id="add-poll-option-btn" class="form-button form-button-secondary" style="margin-top: 12px;">+ 添加选项</button>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-create-poll-btn" data-lang-key="cancel">取消</button> <button class="save" id="confirm-create-poll-btn">发起投票</button> </div>
    </div>
  </div>
  <div id="ai-avatar-library-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span id="ai-avatar-library-title">对方的头像库</span>
        <div class="header-actions"> <button id="add-ai-avatar-batch-btn" class="action-button">批量</button> <button id="add-ai-avatar-url-btn" class="action-button">URL</button> <button id="add-ai-avatar-upload-btn" class="action-button">上传</button> </div>
      </div>
      <div class="modal-body" style="padding: 15px;">
        <div id="ai-avatar-library-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-ai-avatar-library-btn" style="width: 100%;">关闭</button> </div>
    </div>
  </div>
  <div id="my-avatar-library-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span id="my-avatar-library-title">我的头像库</span>
        <div class="header-actions"> <button id="add-my-avatar-batch-btn" class="action-button">批量</button> <button id="add-my-avatar-url-btn" class="action-button">URL</button> <button id="add-my-avatar-upload-btn" class="action-button">上传</button> </div>
      </div>
      <div class="modal-body" style="padding: 15px;">
        <div id="my-avatar-library-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-my-avatar-library-btn" style="width: 100%;">关闭</button> </div>
    </div>
  </div>
  <div id="group-avatar-library-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span id="group-avatar-library-title">群头像库</span>
        <div class="header-actions"> <button id="add-group-avatar-batch-btn" class="action-button">批量</button> <button id="add-group-avatar-url-btn" class="action-button">URL</button> <button id="add-group-avatar-upload-btn" class="action-button">上传</button> </div>
      </div>
      <div class="modal-body" style="padding: 15px;">
        <div id="group-avatar-library-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-group-avatar-library-btn" style="width: 100%;">关闭</button> </div>
    </div>
  </div>
  <div id="chat-list-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="chat-list-action-pin"></button> <button id="chat-list-action-delete" class="btn-danger">删除聊天</button> <button id="chat-list-action-cancel" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">取消</button> </div>
    </div>
  </div>
  <div id="share-link-modal" class="modal">
    <div class="modal-content" style="width: 300px; height: auto;">
      <div class="modal-header"> <span>分享链接</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label for="link-title-input">标题</label> <input type="text" id="link-title-input" placeholder="输入文章或链接的标题"> </div>
        <div class="form-group"> <label for="link-description-input">摘要 (可选)</label> <textarea id="link-description-input" rows="2" placeholder="简单描述一下链接内容"></textarea> </div>
        <div class="form-group"> <label for="link-source-input">来源名称 (可选)</label> <input type="text" id="link-source-input" placeholder="例如：知乎日报、B站"> </div>
        <div class="form-group"> <label for="link-content-input">完整内容 (可选，用于浏览器内显示)</label> <textarea id="link-content-input" rows="4" placeholder="粘贴或输入完整的文章内容"></textarea> </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-share-link-btn"data-lang-key="cancel">取消</button> <button class="save" id="confirm-share-link-btn">分享</button> </div>
    </div>
  </div>
  <div id="transfer-actions-modal" class="modal">
    <div class="transfer-actions-content">
      <div class="transfer-actions-header">请选择操作</div>
      <div class="transfer-actions-body">
        <p>你收到了来自 <strong id="transfer-sender-name"></strong> 的一笔转账。</p>
      </div>
      <div class="transfer-actions-footer"> <button id="transfer-action-decline" class="action-btn decline">残忍拒绝</button> <button id="transfer-action-accept" class="action-btn accept">开心收下</button> </div> <button id="transfer-action-cancel" class="cancel-btn">×</button>
    </div>
  </div>
  <div id="call-transcript-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span id="transcript-modal-title">通话详情</span> </div>
      <div class="modal-body" id="call-transcript-modal-body" style="background-color: #f0f2f5;"> </div>
      <div class="modal-footer"> <button class="cancel" id="delete-transcript-btn" style="background-color: #ff3b30; color: white; border-color: #ff3b30;">删除记录</button> <button class="save" id="manual-summarize-btn" style="background-color: #ffc107; border-color: #ffc107;">手动总结</button>
        <button class="save" id="close-call-transcript-btn" style="width: 100%;">关闭</button>
      </div>
    </div>
  </div>
  <div id="share-target-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>分享到...</span> </div>
      <div class="modal-body" id="share-target-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-share-target-btn"data-lang-key="cancel">取消</button> <button class="save" id="confirm-share-target-btn">确认分享</button> </div>
    </div>
  </div>
  <div id="shared-history-viewer-modal" class="modal">
    <div class="modal-content" style="height: 80%;">
      <div class="modal-header"> <span id="shared-history-viewer-title">聊天记录</span> </div>
      <div class="modal-body" id="shared-history-viewer-content" style="background-color: #f0f2f5;"> </div>
      <div class="modal-footer"> <button class="save" id="close-shared-history-viewer-btn" style="width:100%;">关闭</button> </div>
    </div>
  </div>
  <div id="world-book-category-manager-modal" class="modal">
    <div class="modal-content" style="height: 60%;">
      <div class="modal-header"> <span>管理世界书分类</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label>新建分类</label>
          <div style="display: flex; gap: 10px;"> <input type="text" id="new-category-name-input" placeholder="输入分类名..." style="flex-grow: 1;"> <button id="add-new-category-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">添加</button> </div>
        </div>
        <hr style="opacity: 0.2;">
        <div id="existing-categories-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-category-manager-btn" style="width: 100%;"data-lang-key="done">完成</button> </div>
    </div>
  </div>
  <div id="announcement-board-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"> <span>群公告板</span> </div>
      <div id="announcement-board-content"> </div>
      <div class="modal-footer"> <button class="save" id="close-announcement-board-btn" style="width: 100%;">关闭</button> </div>
    </div>
  </div>
  <div id="announcement-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="announcement-action-pin">置顶公告</button> <button id="announcement-action-delete" class="btn-danger">删除公告</button> <button id="announcement-action-cancel" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">取消</button> </div>
    </div>
  </div>
  <div id="group-management-modal" class="modal">
    <div class="modal-content" style="height: 60%;">
      <div class="modal-header"> <span>管理好友分组</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label>新建分组</label>
          <div style="display: flex; gap: 10px;"> <input type="text" id="new-group-name-input" placeholder="输入分组名..." style="flex-grow: 1;"> <button id="add-new-group-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">添加</button> </div>
        </div>
        <hr style="opacity: 0.2;">
        <div id="existing-groups-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-group-manager-btn" style="width: 100%;"data-lang-key="done">完成</button> </div>
    </div>
  </div>
  <div id="message-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="edit-message-btn" data-lang-key="edit">编辑消息</button> <button id="copy-message-btn">复制文本</button> <button id="copy-timestamp-btn">复制时间戳</button> <button id="recall-message-btn">撤回</button> <button id="publish-to-announcement-btn" style="display: none;">发布到公告板</button>
        <button id="quote-message-btn">引用</button> <button id="select-message-btn">进入多选</button> <button id="cancel-message-action-btn" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">取消</button> </div>
    </div>
  </div>
  <div id="post-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="edit-post-btn" data-lang-key="edit">编辑动态</button> <button id="copy-post-btn">复制内容</button> <button id="cancel-post-action-btn"data-lang-key="cancel">取消</button> </div>
    </div>
  </div>
  <div id="message-editor-modal" class="modal">
    <div class="modal-content" style="height: 75%;">
      <div class="modal-header"> <span data-lang-key="edit">编辑与拆分消息</span> </div>
      <div class="modal-body" id="message-editor-body">
        <div id="message-editor-container"></div> <button id="add-message-editor-block-btn" class="form-button form-button-secondary" style="margin-top: 15px;"> [+] 添加下一条消息 </button>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-advanced-editor-btn"data-lang-key="cancel">取消</button> <button class="save" id="save-advanced-editor-btn"data-lang-key="save">保存更改</button> </div>
    </div>
  </div>
  <div id="ai-response-editor-modal" class="modal">
    <div class="modal-content" style="height: 80%;">
      <div class="modal-header"> <span>导演剪辑室 (AI上一轮响应)</span> </div>
      <div class="modal-body" id="ai-response-editor-body">
        <div id="ai-response-editor-container" style="display: flex; flex-direction: column; gap: 15px;"></div> <button id="add-ai-response-block-btn" class="form-button form-button-secondary" style="margin-top: 15px;"> [+] 添加一个新动作 </button>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-ai-response-editor-btn"data-lang-key="cancel">取消</button> <button class="save" id="save-ai-response-editor-btn">应用修改</button> </div>
    </div>
  </div>
  <div id="repost-modal" class="modal">
    <div id="custom-modal" style="width: 280px;">
      <div class="custom-modal-header">转发动态</div>
      <div class="custom-modal-body"> <textarea id="repost-comment-input" placeholder="请输入转发评论 (可选)" style="width: 100%; min-height: 60px; resize: vertical; border: 1px solid #ccc; border-radius: 6px; padding: 8px; font-size: 16px; box-sizing: border-box;"></textarea> </div>
      <div class="custom-modal-footer"> <button id="repost-cancel-btn"data-lang-key="cancel">取消</button> <button id="repost-confirm-btn" class="confirm-btn"data-lang-key="confirm">确定</button> </div>
    </div>
  </div>
  <div id="call-message-actions-modal" class="modal">
    <div id="custom-modal" style="width: 250px;">
      <div class="custom-modal-footer"> <button id="edit-call-message-btn"data-lang-key="edit">编辑</button> <button id="delete-call-message-btn" class="btn-danger">删除</button> <button id="cancel-call-message-action-btn" style="margin-top: 8px; border-radius: 8px; background-color: #f0f0f0;"data-lang-key="cancel">取消</button> </div>
    </div>
  </div> <audio id="audio-player" style="display:none;"></audio>
  <div id="create-post-modal" class="modal">
    <div class="modal-content" style="height: auto; max-height: 90%;">
      <div class="modal-header"> <span>发布动态</span> </div>
      <div class="modal-body">
        <div class="form-group"> <textarea id="post-public-text" rows="3" placeholder="分享新鲜事...（非必填的公开文字）"></textarea> </div>
        <div class="post-mode-switcher"> <button id="switch-to-image-mode" class="mode-btn active">上传图片</button> <button id="switch-to-text-image-mode" class="mode-btn">使用文字图</button> </div>
        <div class="form-group"> <label>可见范围</label>
          <div id="post-visibility-options" style="display: flex; gap: 15px; margin-bottom: 10px;"> <label><input type="radio" name="visibility" value="public" checked> 公开</label> <label><input type="radio" name="visibility" value="include"> 指定分组可见</label> </div>
          <div id="post-visibility-groups" style="display: none; max-height: 120px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 8px;"> </div>
        </div>
        <div id="image-mode-content" class="post-mode-content active">
          <div class="form-group">
            <div id="post-image-preview-container" class="post-image-preview-container"> <img id="post-image-preview" src="" alt="图片预览"> <button id="post-remove-image-btn">×</button> </div>
            <div class="post-image-upload-options"> <button id="post-upload-local-btn" class="form-button-secondary">本地上传</button> <button id="post-use-url-btn" class="form-button-secondary">网络URL</button> <input type="file" id="post-local-image-input" accept="image/*" hidden> </div>
          </div>
          <div id="post-image-desc-group" class="form-group" style="display: none;"> <label>图片描述 (必填，给AI看)</label> <input type="text" id="post-image-description" placeholder="简单描述图片内容，帮助AI理解"> </div>
        </div>
        <div id="text-image-mode-content" class="post-mode-content">
          <div class="form-group"> <label>文字图 (给AI理解用的描述，点击图片后可见)</label> <textarea id="post-hidden-text" rows="4" placeholder="在这里写下图片描述..."></textarea> </div>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-create-post-btn"data-lang-key="cancel">取消</button> <button class="save" id="confirm-create-post-btn">发布</button> </div>
    </div>
  </div> <input type="file" id="ai-avatar-upload-input" accept="image/*" hidden> <input type="file" id="group-avatar-upload-input" accept="image/*" hidden>
  <div id="qzone-sticker-panel">
    <div id="qzone-sticker-grid"></div>
  </div>
  <div id="avatar-frame-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"> <span>选择头像框</span>
        <div class="header-actions"> <button id="manage-frames-btn" class="action-button">管理</button> <button id="upload-custom-frame-btn" class="action-button">上传</button> <button id="batch-import-frames-btn" class="action-button">批量</button> </div>
      </div>
      <div class="modal-body">
        <div class="frame-tabs">
          <div id="ai-frame-tab" class="frame-tab active">对方的</div>
          <div id="my-frame-tab" class="frame-tab">我的</div>
        </div>
        <div id="ai-frame-content" class="frame-content">
          <div id="ai-frame-grid" class="frame-grid"> </div>
        </div>
        <div id="my-frame-content" class="frame-content" style="display: none;">
          <div id="my-frame-grid" class="frame-grid"> </div>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-frame-settings-btn"data-lang-key="cancel">取消</button> <button class="save" id="save-frame-settings-btn"data-lang-key="save">保存</button> </div>
      <div id="frame-action-bar" style="display: none;"> <label class="select-all-label" style="display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-frames-checkbox"> 全选 </label> <button id="delete-selected-frames-btn" class="action-bar-btn">删除 (0)</button>
      </div>
    </div>
  </div><input type="file" id="custom-frame-upload-input" accept="image/*" hidden>
  <div id="character-profile-modal" class="modal">
    <div class="character-profile-content"> <div style="position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 10;">
        <button id="profile-edit-btn" title="编辑当前心声" class="profile-history-icon-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
        </button>
        <button id="profile-history-icon-btn" title="查看历史心声" class="profile-history-icon-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
          </svg>
        </button>
      </div>
      <div id="profile-main-content">
        <div id="profile-timestamp" class="thought-header"></div>
        <div class="thought-content">
          <div class="voice">
            <div class="label"> <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
              </svg> 心声 </div>
            <p id="profile-heartfelt-voice" class="text"></p>
          </div>
          <div class="jottings">
            <div class="label"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                <path d="M2 2l7.586 7.586"></path>
              </svg> 散记 </div>
            <p id="profile-random-jottings" class="text"></p>
          </div>
        </div>
      </div>
      <div id="profile-thoughts-history-view">
        <div class="profile-header"> <span>心声记录</span> <button id="history-back-btn" title="返回"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg> </button> </div>
        <div id="thoughts-history-list"></div>
      </div>
    </div>
  </div> <input type="file" id="my-avatar-upload-input" accept="image/*" hidden>
  <div id="gift-recipient-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>选择收礼人</span> <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-recipients"> 全选 </label> </div>
      <div class="modal-body" id="gift-recipient-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-gift-recipient-btn"data-lang-key="cancel">取消</button> <button class="save" id="confirm-gift-recipient-btn">确认送出</button> </div>
    </div>
  </div> <audio id="notification-sound-player" preload="auto"></audio>
  <div id="music-search-results-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>搜索结果</span> <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-music-search"> 全选 </label> </div>
      <div class="modal-body" id="search-results-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-music-search-btn"data-lang-key="cancel">取消</button> <button class="save" id="add-selected-music-btn"data-lang-key="add">添加选中</button> </div>
    </div>
  </div>
  <div id="douban-settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"> <span>豆瓣设置</span> </div>
      <div class="modal-body">
        <div class="form-group douban-settings-item"> <label for="douban-min-posts-input"> 每次生成帖子数范围 <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 设置AI在豆瓣页面一次性生成帖子的最小和最大数量。 </p> </label>
          <div class="douban-settings-controls"> <input type="number" id="douban-min-posts-input" min="1" value="12"> <span>到</span> <input type="number" id="douban-max-posts-input" min="1" value="20"> <span>篇</span> </div>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-douban-settings-btn"data-lang-key="cancel">取消</button> <button class="save" id="save-douban-settings-btn"data-lang-key="save">保存</button> </div>
    </div>
  </div><audio id="char-audio-player" preload="auto"></audio>
  <div id="douban-cast-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>选择参与豆瓣的角色</span> </div>
      <div class="modal-body" id="douban-cast-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-douban-cast-btn"data-lang-key="cancel">取消</button> <button class="save" id="save-douban-cast-btn"data-lang-key="save">保存并刷新</button> </div>
    </div>
  </div><input type="file" id="import-preset-input" accept=".json" hidden>
  <div id="update-notice-modal">
    <div class="update-notice-content">
      <div class="update-notice-body" id="update-notice-body"> </div>
      <div class="update-notice-footer"> <button id="update-notice-confirm-btn">我知道了</button> <button id="update-notice-dismiss-btn">不再提示</button> </div>
    </div>
  </div>
  <div id="delete-world-books-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>选择要删除的世界书</span> <label style="font-size: 14px; font-weight: normal; display: flex; align-items: center; gap: 5px;"> <input type="checkbox" id="select-all-world-books-for-clear"> 全选 </label> </div>
      <div class="modal-body" id="delete-world-books-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-delete-world-books-btn"data-lang-key="cancel">取消</button> <button class="save btn-danger" id="confirm-delete-world-books-btn">确认删除</button> </div>
    </div>
  </div>
  <div id="werewolf-kill-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>狼人请选择刀人对象</span></div>
      <div class="modal-body" id="werewolf-kill-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="cancel" id="cancel-wolf-kill-btn">放弃</button> <button class="save btn-danger" id="confirm-wolf-kill-btn">确认刀人</button> </div>
    </div>
  </div>
  <div id="werewolf-lobby-modal" class="modal">
    <div class="modal-content" style="height: 80%;">
      <div class="modal-header"> <span>选择玩家开始狼人杀</span> </div>
      <div class="modal-body" id="werewolf-player-selection-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-werewolf-lobby-btn"data-lang-key="cancel">取消</button> <button class="save" id="start-werewolf-game-btn">开始游戏</button> </div>
    </div>
  </div>
  <div id="werewolf-role-modal" class="modal">
    <div class="modal-content" style="width: 280px; height: auto; text-align: center; padding: 20px;">
      <h3 id="werewolf-role-title" style="margin-top: 0;">你的身份是</h3>
      <div id="werewolf-role-card" style="margin: 15px 0;">
        <h2 id="werewolf-role-name" style="margin: 0 0 10px 0;"></h2>
        <p id="werewolf-role-description" style="font-size: 14px; line-height: 1.6; color: #555; margin: 0;"></p>
      </div> <button id="werewolf-role-confirm-btn" class="form-button">我准备好了</button>
    </div>
  </div>
  <div id="werewolf-prophet-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>预言家请选择查验对象</span></div>
      <div class="modal-body" id="werewolf-prophet-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save" id="confirm-prophet-check-btn">确认查验</button> </div>
    </div>
  </div>
  <div id="werewolf-hunter-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>猎人请选择开枪对象</span></div>
      <div class="modal-body" id="werewolf-hunter-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save btn-danger" id="confirm-hunter-shot-btn">确认开枪</button> </div>
    </div>
  </div>
  <div id="werewolf-vote-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>请投票放逐一名玩家</span></div>
      <div class="modal-body" id="werewolf-vote-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save" id="confirm-vote-btn">确认投票</button> </div>
    </div>
  </div>
  <div id="werewolf-guard-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>守卫请选择今晚要守护的玩家</span></div>
      <div class="modal-body" id="werewolf-guard-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save" id="confirm-guard-selection-btn">确认守护</button> </div>
    </div>
  </div>
  <div id="werewolf-witch-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span id="witch-modal-title">女巫请睁眼</span></div>
      <div class="modal-body" id="werewolf-witch-selection-list" style="padding: 0;"> </div>
      <div class="modal-footer"> <button class="cancel" id="witch-do-nothing-btn">什么都不做</button> <button class="save btn-danger" id="confirm-witch-poison-btn" style="display: none;">确认用毒</button> </div>
    </div>
  </div>
  <div id="werewolf-hunter-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>猎人请选择开枪对象</span></div>
      <div class="modal-body" id="werewolf-hunter-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save btn-danger" id="confirm-hunter-shot-btn">确认开枪</button> </div>
    </div>
  </div>
  <div id="werewolf-vote-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"><span>请投票放逐一名玩家</span></div>
      <div class="modal-body" id="werewolf-vote-selection-list" style="padding: 0;"></div>
      <div class="modal-footer"> <button class="save" id="confirm-vote-btn">确认投票</button> </div>
    </div>
  </div>
  <div id="werewolf-game-over-modal" class="modal">
    <div class="modal-content" style="width: 300px; height: auto; text-align: center; padding: 20px;">
      <h2 id="werewolf-game-over-title">游戏结束</h2>
      <p id="werewolf-game-over-reason" style="font-size: 16px; margin: 20px 0;"></p>
      <div id="werewolf-role-reveal-list" style="max-height: 250px; overflow-y: auto; margin: 20px 0; border-top: 1px solid #444; padding-top: 10px;"> </div> <button id="werewolf-game-over-close-btn" class="form-button">返回大厅</button> <button id="manual-werewolf-summary-btn"
        class="form-button form-button-secondary" style="margin-top: 10px;">手动总结记忆</button>
    </div>
  </div>
  <div id="reading-library-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header"> <span>我的书库</span>
        <div class="header-actions"> <span class="action-btn" id="import-new-book-btn-header" title="导入新书"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg> </span> <span class="action-btn" id="close-reading-library-btn-header" title="关闭"> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg> </span> </div>
      </div>
      <div id="reading-library-search-container"> <input type="search" id="reading-library-search-input" placeholder="搜索书名..."> </div>
      <div class="modal-body" style="padding: 0; flex-grow: 1; overflow-y: auto;">
        <div id="reading-library-list"> </div>
      </div>
    </div>
  </div>
  <div id="product-category-manager-modal" class="modal">
    <div class="modal-content" style="height: 60%;">
      <div class="modal-header"> <span>管理商品分类</span> </div>
      <div class="modal-body">
        <div class="form-group"> <label>新建分类</label>
          <div style="display: flex; gap: 10px;"> <input type="text" id="new-product-category-name-input" placeholder="输入分类名..." style="flex-grow: 1;"> <button id="add-new-product-category-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">添加</button> </div>
        </div>
        <hr style="opacity: 0.2;">
        <div id="existing-product-categories-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
      </div>
      <div class="modal-footer"> <button class="save" id="close-product-category-manager-btn" style="width: 100%;"data-lang-key="done">完成</button> </div>
    </div>
  </div>
  <div id="variation-selection-modal" class="modal">
    <div class="modal-content" style="width: 320px; height: auto;">
      <div class="modal-header" style="padding-bottom: 0;"> </div>
      <div class="modal-body">
        <div id="variation-product-info" style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 15px;"> <img id="variation-product-image" style="width: 80px; height: 80px; border-radius: 6px; object-fit: cover;">
          <div>
            <p id="variation-product-name" style="font-weight: 500; margin: 0;"></p>
            <p id="variation-selected-price" style="color: #ff5722; font-weight: bold; font-size: 18px; margin: 8px 0 0;"></p>
          </div>
        </div>
        <div class="form-group"> <label>选择款式</label>
          <div id="variation-options-container" style="display: flex; flex-wrap: wrap; gap: 8px;"> </div>
        </div>
        <div class="form-group"> <label>购买数量</label>
          <div class="quantity-control" style="justify-content: flex-start;"> <button class="quantity-btn" id="variation-decrease-qty">-</button> <span class="quantity-display" id="variation-quantity-display">1</span> <button class="quantity-btn" id="variation-increase-qty">+</button>
          </div>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-variation-selection-btn"data-lang-key="cancel">取消</button> <button class="save" id="confirm-variation-selection-btn">加入购物车</button> </div>
    </div>
  </div>
  <div id="shopping-settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"> <span>购物中心生成设置</span> </div>
      <div class="modal-body">
        <div class="form-group douban-settings-item"> <label for="shopping-category-count-input"> 生成分类数量 <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 设置AI一次性生成多少个商品分类。 </p> </label>
          <div class="douban-settings-controls"> <input type="number" id="shopping-category-count-input" min="1" max="10" value="3"> <span>个</span> </div>
        </div>
        <div class="form-group douban-settings-item"> <label for="shopping-product-count-input"> 每个分类商品数量 <p style="font-size: 12px; font-weight: normal; color: #999; margin-top: 5px;"> 设置每个分类下生成多少个商品。 </p> </label>
          <div class="douban-settings-controls"> <input type="number" id="shopping-product-count-input" min="2" max="10" value="8"> <span>个</span> </div>
        </div>
      </div>
      <div class="modal-footer"> <button class="cancel" id="cancel-shopping-settings-btn"data-lang-key="cancel">取消</button> <button class="save" id="save-shopping-settings-btn"data-lang-key="save">保存</button> </div>
    </div>
  </div>
  <div id="sticker-binding-modal" class="modal">
    <div class="modal-content" style="height: 70%;">
      <div class="modal-header">
        <span>绑定分类到聊天</span>
      </div>
      <div class="modal-body" id="sticker-binding-chat-list" style="padding: 0;">
        <!-- 聊天列表将在此处动态渲染 -->
      </div>
      <div class="modal-footer">
        <button class="cancel" id="cancel-sticker-binding-btn"data-lang-key="cancel">取消</button>
        <button class="save" id="save-sticker-binding-btn"data-lang-key="save">保存</button>
      </div>
    </div>
  </div>
<!-- ▼▼▼ NovelAI 生成设置弹窗 ▼▼▼ -->
<div id="novelai-settings-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px; width: 90%; max-height: 85vh; overflow-y: auto;">
        <div class="modal-header">
            <span>NovelAI 生成设置</span>
            <span class="close" id="close-novelai-settings" style="cursor: pointer; float: right; font-size: 28px; font-weight: bold;">&times;</span>
        </div>
        <div class="modal-body" style="padding: 20px;">
            <div class="form-group">
                <label style="color: #333;">图像尺寸（oplus可无限出小图）</label>
                <select id="nai-resolution" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                    <optgroup label="小">
                        <option value="512x768">纵向 (512x768)</option>
                        <option value="768x512">横向 (768x512)</option>
                        <option value="640x640">正方形 (640x640)</option>
                    </optgroup>
                    <optgroup label="正常">
                        <option value="832x1216">竖图 (832x1216)</option>
                        <option value="1216x832">横图 (1216x832)</option>
                        <option value="1024x1024" selected>方图 (1024x1024)</option>
                    </optgroup>
                    <optgroup label="壁纸">
                        <option value="1088x1920">纵向 (1088x1920)</option>
                        <option value="1920x1088">风景 (1920x1088)</option>
                    </optgroup>
                </select>
                <small style="color: #666;">建议使用官方支持的标准尺寸以获得最佳效果</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">采样步数 (Steps)</label>
                <input type="number" id="nai-steps" value="28" min="1" max="50" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                <small style="color: #666;">推荐值: 28 (值越高质量越好但耗时越长)</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">提示词相关性 (CFG Scale)</label>
                <input type="number" id="nai-cfg-scale" value="5" min="1" max="20" step="0.5" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                <small style="color: #666;">推荐值: 5 (控制图像与提示词的相关程度)</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">采样器 (Sampler)</label>
                <select id="nai-sampler" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                    <option value="k_euler">Euler</option>
                    <option value="k_euler_ancestral" selected>Euler Ancestral</option>
                    <option value="k_dpmpp_2s_ancestral">DPM++ 2S Ancestral</option>
                    <option value="k_dpmpp_2m">DPM++ 2M</option>
                    <option value="k_dpmpp_sde">DPM++ SDE</option>
                    <option value="ddim">DDIM</option>
                </select>
            </div>

            <div class="form-group">
                <label style="color: #333;">随机种子 (Seed)</label>
                <input type="number" id="nai-seed" value="-1" min="-1" max="9999999999" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                <small style="color: #666;">-1 表示随机，固定种子可复现相同图像</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">负面提示词预设 (UC Preset)</label>
                <select id="nai-uc-preset" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                    <option value="0">Preset 0 - Heavy</option>
                    <option value="1" selected>Preset 1 - Light</option>
                    <option value="2">Preset 2 - Human Focus</option>
                    <option value="3">Preset 3 - None</option>
                </select>
            </div>

            <div class="form-group">
                <label style="color: #333;">质量标签</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="nai-quality-toggle" checked style="width: auto;">
                    <span style="color: #666; font-size: 14px;">自动添加质量提升标签</span>
                </div>
            </div>

            <div class="form-group">
                <label style="color: #333;">SMEA (提升细节)</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="nai-smea" checked style="width: auto;">
                    <span style="color: #666; font-size: 14px;">启用SMEA增强</span>
                </div>
            </div>

            <div class="form-group">
                <label style="color: #333;">SMEA DYN (动态优化)</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="nai-smea-dyn" style="width: auto;">
                    <span style="color: #666; font-size: 14px;">启用动态SMEA</span>
                </div>
            </div>

            <div class="form-group">
                <label style="color: #333;">默认正面提示词</label>
                <textarea id="nai-default-positive" rows="3" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px; resize: vertical;" placeholder="masterpiece, best quality, 1girl, beautiful...">masterpiece, best quality, 1girl, beautiful, detailed face, detailed eyes, long hair, anime style</textarea>
                <small style="color: #666;">此提示词将在生成时自动使用（如果测试弹窗中未填写）</small>
            </div>

            <div class="form-group">
                <label style="color: #333;">默认负面提示词</label>
                <textarea id="nai-default-negative" rows="3" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px; resize: vertical;" placeholder="lowres, bad anatomy, bad hands, text, error...">lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry</textarea>
            </div>

            <div class="form-group" style="border-top: 1px solid #ddd; padding-top: 15px; margin-top: 15px;">
                <label style="color: #333;">🌐 CORS 代理设置</label>
                <select id="nai-cors-proxy" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                    <option value="">❌ 直连（无代理）</option>
                    <option value="https://corsproxy.io/?" selected>✅ corsproxy.io（推荐）</option>
                    <option value="https://api.allorigins.win/raw?url=">allorigins.win</option>
                    <option value="https://cors-anywhere.herokuapp.com/">cors-anywhere（需激活）</option>
                    <option value="custom">🔧 自定义代理</option>
                </select>
                <small style="color: #e74c3c; display: block; margin-top: 8px;">
                    ⚠️ 本地运行会遇到CORS跨域问题，需使用代理。推荐使用 corsproxy.io
                </small>
            </div>

            <div id="nai-custom-proxy-group" class="form-group" style="display: none;">
                <label style="color: #333;">自定义代理地址</label>
                <input type="text" id="nai-custom-proxy-url" placeholder="https://your-proxy.com/?" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
                <small style="color: #666;">代理URL应以 / 或 ? 结尾，例如：https://proxy.com/?</small>
            </div>
        </div>
        <div class="modal-footer">
            <button id="reset-nai-settings-btn" class="form-button form-button-secondary" style="margin-right: 10px;">恢复默认</button>
            <button id="save-nai-settings-btn" class="form-button form-button-secondary"data-lang-key="save">保存设置</button>
        </div>
    </div>
</div>
<!-- ▲▲▲ NovelAI 生成设置弹窗结束 ▲▲▲ -->

<!-- ▼▼▼ NovelAI 测试生成弹窗 ▼▼▼ -->
<div id="novelai-test-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto;">
        <div class="modal-header">
            <span>🖼️ NovelAI 测试生成</span>
            <span class="close" id="close-novelai-test" style="cursor: pointer; float: right; font-size: 28px; font-weight: bold;">&times;</span>
        </div>
        <div class="modal-body" style="padding: 20px;">
            <div class="form-group">
                <label style="color: #333;">正面提示词（此处提示词仅用于该弹窗测试）</label>
                <textarea id="nai-test-prompt" rows="4" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px; width: 100%; border-radius: 4px; resize: vertical;" placeholder="1girl, solo, long hair, blue eyes, smile...">1girl, solo, long hair, blue eyes, smile, outdoors, cherry blossoms, spring</textarea>
            </div>

            <div class="form-group">
                <label style="color: #333;">负面提示词（可选，留空使用默认）</label>
                <textarea id="nai-test-negative" rows="3" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px; width: 100%; border-radius: 4px; resize: vertical;" placeholder="留空将使用设置中的默认负面提示词"></textarea>
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <button id="nai-generate-btn" style="background-color: #007bff; color: white; border: none; padding: 12px 30px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold;">
                    生成图像
                </button>
            </div>

            <div id="nai-test-status" style="text-align: center; color: #666; margin: 15px 0; display: none;">
                正在生成中，请稍候...
            </div>

            <div id="nai-test-result" style="display: none; margin-top: 20px;">
                <div style="font-weight: bold; color: #333; margin-bottom: 10px;">生成结果：</div>
                <div style="text-align: center; background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef;">
                    <img id="nai-result-image" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                </div>
                <div style="margin-top: 10px; text-align: center;">
                    <button id="nai-download-btn" class="form-button-secondary" style="margin: 0;">下载图像</button>
                </div>
            </div>

            <div id="nai-test-error" style="display: none; margin-top: 15px; padding: 12px; background: #f8d7da; color: #721c24; border-radius: 6px; border: 1px solid #f5c6cb;"></div>
        </div>
        <div class="modal-footer">
            <button id="close-nai-test-btn" class="form-button">关闭</button>
        </div>
    </div>
</div>
<!-- ▲▲▲ NovelAI 测试生成弹窗结束 ▲▲▲ -->

<!-- ▼▼▼ 角色专属NAI出图设置弹窗 ▼▼▼ -->
<div id="character-nai-prompts-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <span>角色专属NAI提示词配置</span>
            <span class="close" id="close-character-nai-prompts" style="cursor: pointer; float: right; font-size: 28px; font-weight: bold;">&times;</span>
        </div>
        <div class="modal-body">
            <p style="font-size: 13px; color: #666; margin-bottom: 20px; background-color: #f0f8ff; padding: 12px; border-radius: 6px; border-left: 3px solid #007bff;">
                💡 这里配置的提示词仅用于当前角色的NAI出图，不影响其他角色或系统设置
            </p>
            
            <div class="form-group">
                <label for="character-nai-positive" style="color: #333; font-weight: 600;">
                    正面提示词 (Positive Prompt)
                </label>
                <textarea id="character-nai-positive" rows="4" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px; width: 100%; border-radius: 4px; resize: vertical; font-size: 13px;" placeholder="例如: masterpiece, best quality, 1girl, beautiful, detailed face, detailed eyes, long hair, anime style"></textarea>
                <small style="display: block; color: #666; font-size: 12px; margin-top: 5px;">
                    描述你希望生成的图像风格，可填入画师串
                </small>
            </div>

            <div class="form-group">
                <label for="character-nai-negative" style="color: #333; font-weight: 600;">
                    负面提示词 (Negative Prompt)
                </label>
                <textarea id="character-nai-negative" rows="4" style="background-color: #f8f9fa; color: #333; border: 1px solid #ccc; padding: 10px; width: 100%; border-radius: 4px; resize: vertical; font-size: 13px;" placeholder="例如: lowres, bad anatomy, bad hands, text, error, missing fingers"></textarea>
                <small style="display: block; color: #666; font-size: 12px; margin-top: 5px;">
                    描述你希望避免的元素
                </small>
            </div>
        </div>
        <div class="modal-footer">
            <button id="reset-character-nai-prompts-btn" class="form-button form-button-secondary" style="margin-right: 10px;">清空配置</button>
            <button id="save-character-nai-prompts-btn" class="form-button form-button-secondary"data-lang-key="save">保存</button>
        </div>
    </div>
</div>
<!-- ▲▲▲ 角色专属NAI出图设置弹窗结束 ▲▲▲ -->
<div id="npc-group-manager-modal" class="modal">
  <div class="modal-content" style="height: 60%;">
    <div class="modal-header"> <span>管理NPC分组</span> </div>
    <div class="modal-body">
      <div class="form-group"> <label>新建分组</label>
        <div style="display: flex; gap: 10px;"> <input type="text" id="new-npc-group-name-input" placeholder="输入分组名 (例如: 家人组, 朋友组)..." style="flex-grow: 1;"> <button id="add-new-npc-group-btn" class="form-button" style="width: auto; margin-top: 0; padding: 0 15px;"data-lang-key="add">添加</button> </div>
      </div>
      <hr style="opacity: 0.2;">
      <div id="existing-npc-groups-list" style="display: flex; flex-direction: column; gap: 10px;"> </div>
    </div>
    <div class="modal-footer"> <button class="save" id="close-npc-group-manager-btn" style="width: 100%;"data-lang-key="done">完成</button> </div>
  </div>
</div>
<div id="pin-modal-overlay" class="modal">
    <div id="pin-modal-content" class="modal-content" style="width: 300px; height: auto;">
        <div class="modal-header">
            <span>功能激活</span>
        </div>
        <div class="modal-body" style="text-align: left;">
            <p>此功能需要激活码 (PIN) 才能使用。</p>
            
            <div class="form-group">
                <label for="pin-device-id-display">您的设备ID (请复制并发送给发布者)</label>
                <input type="text" id="pin-device-id-display" readonly style="background: #eee; cursor: text; -webkit-user-select: text; user-select: text;">
            </div>
            
            <div class="form-group">
                <label for="pin-input">请输入激活码 (PIN)</label>
                <input type="text" id="pin-input" placeholder="在此输入激活码...">
            </div>
        </div>
        <div class="modal-footer">
            <button class="cancel" id="pin-modal-cancel-btn">取消</button>
            <button class="save" id="pin-modal-confirm-btn">确认激活</button>
        </div>
    </div>
</div>
<audio id="silent-audio-player" loop preload="auto" style="display:none;">
    <source src="https://phoebeboo.github.io/mewoooo/1-second-of-silence.mp3" type="audio/mpeg">
  </audio><audio id="tts-audio-player" style="display:none;"></audio>
<style>
           @font-face { font-family: 'bulangni'; src: url('') format('truetype'); font-weight: normal; font-style: normal; font-display: swap; }
        :root { --screen-width: 350px; --screen-height: 650px; --secondary-bg: #ffffff; --border-color: #e0e0e0; --text-primary: #1f1f1f; --text-secondary: #8a8a8a; --accent-color: #007bff; }
        html {
            -webkit-text-size-adjust: 100%;
            height: 100%; 
        }
        body {
            margin: 0;
            font-family: 'bulangni', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-weight: normal;
            background-color: #f0f2f5;
            height: 100%; 
            overflow: hidden; 
        }
        #phone-screen {
            width: 100%;
            height: 100vh; 
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background-color: #ffffff; 
        }
        #chat-input-area {
            flex-shrink: 0;
            padding: 8px;
            padding-bottom: calc(8px + env(safe-area-inset-bottom)); 
            background-color: rgba(247, 247, 247, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
#status-bar {
    display: none;
    padding: 0 20px;
    height: 40px;
    color: white;
    background-color: transparent; 
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    box-sizing: border-box;
    z-index: 100;
    text-shadow: 0 1px 3px rgba(0,0,0,0.4);
    pointer-events: none; 
}
#phone-screen.status-bar-visible #status-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
        .header, .qzone-header {
            position: relative;
            z-index: 15;
            flex-shrink: 0;
            padding: 15px 20px;
            padding-top: calc(15px + env(safe-area-inset-top)); 
            background-color: rgba(247, 247, 247, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            font-weight: 600;
        }
        #status-bar { 
            display: none; 
        }
        #status-bar-time { font-weight: 600; }
        .battery-container { display: flex; align-items: center; gap: 5px; }
        .battery-icon { width: 25px; height: 12px; border: 1px solid white; border-radius: 3px; position: relative; padding: 1px; }
        .battery-icon::after { content: ''; position: absolute; right: -3px; top: 2px; width: 2px; height: 6px; background-color: white; border-radius: 0 1px 1px 0; }
        .battery-level { height: 100%; background-color: white; border-radius: 1px; transition: width 0.5s ease; }
        .battery-container.charging .battery-level { background-color: #4cd964; animation: charge-breath 2s infinite; }
        .battery-container.charging .battery-text { color: #4cd964; }
        @keyframes charge-breath { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .screen { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: flex; flex-direction: column; overflow: hidden; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
        .screen.active { opacity: 1; visibility: visible; z-index: 1; }
        .header { position: relative; z-index: 15; flex-shrink: 0; padding: 15px 20px; padding-top: 45px; background-color: rgba(247, 247, 247, 0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; font-size: 18px; font-weight: 600; }
        .header .header-actions { 
    display: flex; 
    align-items: center; 
    gap: 15px; 
    position: relative; /* 新增：创建堆叠上下文 */
    z-index: 1;         /* 新增：确保它在标题span之上 */
}
        .header .back-btn, .header .action-btn { font-size: 24px; cursor: pointer; width: 30px; text-align: center; color: var(--accent-color); display: flex; align-items: center; justify-content: center; }
        .header .action-btn {
            font-size: 16px; 
            font-weight: 600; 
        }
        .header .action-btn img { height: 26px; }
        .header .save-btn { font-size: 16px; color: var(--accent-color); font-weight: 600; cursor: pointer; }
        #home-screen {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            box-sizing: border-box;
            background-size: cover;
            background-position: center;
            padding-left: 20px;
            padding-right: 20px;
        }
        #clock-container {
            text-align: center;
            color: white;
            text-shadow: 0 3px 8px rgba(0,0,0,0.4);
            margin-bottom: 20px;
            flex-shrink: 0;
            margin-top: calc(60px + env(safe-area-inset-top));
        }
        #app-grid {
            margin-top: auto; 
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
            padding: 20px;
            margin-bottom: calc(30px + env(safe-area-inset-bottom)); 
        }
        #main-time {
            font-size: 88px; 
            font-weight: 600; 
            letter-spacing: -2px; 
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;
        }
        #main-date { 
            font-size: 22px; 
            font-weight: normal; 
        }
        #app-grid { margin-top: auto; display: flex; flex-direction: column; align-items: center; gap: 20px; width: 100%; padding: 20px; }
        .app-row { display: flex; justify-content: center; gap: 25px; width: 100%; }
        .app-icon { display: flex; flex-direction: column; align-items: center; cursor: pointer; color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.5); font-size: 14px; font-weight: 500; text-align: center; }
        .app-icon .icon-bg { width: 65px; height: 65px; border-radius: 18px; background-color: var(--secondary-bg); display: flex; justify-content: center; align-items: center; font-size: 32px; margin-bottom: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.15); transition: transform 0.2s ease; overflow: hidden; }
        .app-icon:active .icon-bg { transform: scale(0.9); }
        .app-icon .icon-bg img { width: 100%; height: 100%; object-fit: cover; }
        .app-icon .label { color: white; }
        .form-container, .list-container { padding: 20px; overflow-y: auto; flex-grow: 1; display:flex; flex-direction: column; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary); }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .form-group textarea { min-height: 80px; resize: vertical; }
        #world-book-content-input { height: calc(100% - 120px); }
        .form-button { width: 100%; padding: 15px; background-color: var(--accent-color); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        .form-button-secondary { background-color: #f0f0f0; color: var(--text-primary); border: 1px solid var(--border-color); }
        #wallpaper-screen .form-container { align-items: center; }
        #wallpaper-preview { width: 180px; height: 320px; border: 2px dashed var(--border-color); background-color: #f0f2f5; margin-bottom: 20px; background-size: cover; background-position: center; border-radius: 10px; display: flex; justify-content: center; align-items: center; color: var(--text-secondary); }
        #wallpaper-upload-input { display: none; }
        #world-book-list {
            flex-grow: 1;
            overflow-y: auto;
            background-color: var(--secondary-bg);
            padding-top: 80px;
            margin-top: -80px;
        }
        #chat-list {
            flex-grow: 1;
            background-color: var(--secondary-bg);
            padding-top: 80px; 
            padding-bottom: 90px; 
            box-sizing: border-box;
        }
        .list-item { display: flex; flex-direction: column; padding: 12px 20px; cursor: pointer; border-bottom: 1px solid var(--border-color); }
        .list-item:hover { background-color: #f5f5f5; }
        .list-item .item-title { font-weight: 500; font-size: 16px; margin-bottom: 5px; }
        .list-item .item-content { font-size: 14px; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .chat-list-item { display: flex; align-items: center; padding: 10px 15px; cursor: pointer; border-bottom: 1px solid var(--border-color); position: relative; }
        .chat-list-item:hover { background-color: #f5f5f5; }
        .chat-list-item .avatar { width: 45px; height: 45px; border-radius: 50%; margin-right: 12px; object-fit: cover; background-color: #ccc; }
        .chat-list-item .info { flex-grow: 1; overflow: hidden; }
        .chat-list-item .name-line { display: flex; align-items: center; gap: 6px; margin-bottom: 2px; }
        .chat-list-item .name { font-weight: 500; color: var(--text-primary); }
        .chat-list-item .group-tag { font-size: 10px; color: var(--accent-color); background-color: #e7f3ff; padding: 2px 6px; border-radius: 4px; font-weight: bold; flex-shrink: 0; }
        .chat-list-item .last-msg { font-size: 13px; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px; }
        #chat-interface-screen { background-size: cover; background-position: center; position: relative; }
        #selection-cancel-btn, #selection-delete-btn { font-size: 16px; color: var(--accent-color); cursor: pointer; padding: 5px; }
        #selection-delete-btn { color: #ff3b30; }
        #chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            overflow-x: hidden; 
            padding: 10px 15px; 
            padding-top: 110px;
            margin-top: -80px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-sizing: border-box; 
        }
        #load-more-btn { text-align: center; padding: 10px; color: var(--accent-color); font-size: 14px; cursor: pointer; background-color: transparent; border: none; width: 100%; }
        #load-more-btn:hover { text-decoration: underline; }
        .sender-name { font-size: 11px; color: #666; margin-bottom: 3px; }
        .message-wrapper.ai .sender-name {
            margin-left: 50px; 
            margin-bottom: 3px;
            position: absolute; 
            top: -16px;       
            left: 0;
        }
        .message-wrapper {
            display: flex;          
            gap: 8px;               
            align-items: flex-end;  
            position: relative;
            max-width: 90%;         
        }
        .message-wrapper.ai {
            align-self: flex-start;
            flex-direction: row; 
        }
        .message-wrapper.user {
            align-self: flex-end;
            flex-direction: row-reverse; 
        }
        .message-bubble {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            max-width: 100%;
            min-width: 0; 
        }
        .timestamp {
            font-size: 11px;
            color: #999;
            text-shadow: 0 0 3px rgba(255,255,255,0.6);
            white-space: nowrap; 
            margin-bottom: 5px;  
            flex-shrink: 0;      
        }
        .message-bubble.selected::after { content: '✔'; position: absolute; left: -10px; top: 50%; transform: translateY(-50%); background-color: var(--accent-color); color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        .message-bubble.user.selected::after { left: auto; right: -10px; }
        .message-bubble.user { flex-direction: row-reverse; }
        #typing-indicator { align-self: flex-start; display: none; margin: 0 10px 10px; color: var(--text-secondary); }
        #chat-list-bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 15;
            display: flex;
            border-top: 1px solid var(--border-color);
            background-color: rgba(247, 247, 247, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding-bottom: env(safe-area-inset-bottom);
        }
        #chat-input-main-row { display: flex; align-items: flex-end; gap: 8px; width: 100%; }
#chat-input {
    flex-grow: 1;
    border: none;
    padding: 10px 15px;
    border-radius: 20px;
    background-color: var(--secondary-bg);
    font-size: 16px;
    height: 40px; 
    resize: none;
    overflow-y: auto; 
    box-sizing: border-box; 
}
        .action-button { border: none; color: white; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 14px; flex-shrink: 0; }
        #send-btn { background-color: var(--accent-color); height: 40px; padding: 0 15px;}
        .modal { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal.visible { display: flex; }
        .modal-content { width: 90%; max-height: 90%; background-color: white; border-radius: 15px; display: flex; flex-direction: column; }
        .modal-header { padding: 15px; font-weight: 600; border-bottom: 1px solid var(--border-color); text-align: center; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 15px; overflow-y: auto; }
        .modal-footer { padding: 15px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-around; }
        .modal-footer button { width: 45%; padding: 12px; border-radius: 8px; border: 1px solid var(--accent-color); cursor: pointer; font-size: 16px; }
        .modal-footer .save { background-color: var(--accent-color); color: white; }
        .modal-footer .cancel { background-color: white; color: var(--accent-color); }
        .avatar-upload { display: flex; align-items: center; gap: 15px; }
        .avatar-upload img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; background-color: #eee; }
        .avatar-upload button { padding: 8px 12px; border: 1px solid #ccc; background-color: #f0f0f0; border-radius: 5px; cursor: pointer; }
        #open-persona-library-btn { font-size: 14px; padding: 6px 10px; margin-left: 0; }
        .avatar-upload input[type="file"] { display: none; }
        .theme-selector label { display: inline-flex; align-items: center; margin-right: 15px; margin-bottom: 5px; cursor: pointer; }
        #reset-theme-btn { background: none; border: 1px solid #ccc; color: #555; font-size: 12px; padding: 2px 8px; border-radius: 5px; cursor: pointer; margin-left: 10px; }
        #group-members-settings { display: flex; overflow-x: auto; padding-bottom: 10px; gap: 15px; }
        .member-editor { text-align: center; cursor: pointer; }
        .member-editor img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; background-color: #eee; margin-bottom: 5px; }
        .member-editor .member-name { font-size: 12px; }
        #notification-bar { position: absolute; top: 40px; left: 50%; width: 90%; z-index: 500; background-color: rgba(250, 250, 250, 0.9); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 16px; padding: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 12px; cursor: pointer;     transform: translateX(-50%) translateY(-150%); 
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            visibility: hidden;
        }
        #notification-bar.visible {
            transform: translateX(-50%) translateY(0);
            visibility: visible;
        }
        #notification-avatar { width: 30px; height: 30px; border-radius: 50%; object-fit: cover; }
        #notification-content .name { font-weight: 600; font-size: 15px; color: #000; }
        #notification-content .message { font-size: 14px; color: #555; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }
        .sticker-image { max-width: 100px; max-height: 100px; display: block; object-fit: contain; }
        #chat-input-actions-top { display: flex; gap: 8px; padding: 0 5px; }
        .chat-action-icon-btn { font-size: 24px; padding: 0; width: 38px; height: 38px; line-height: 38px; text-align: center; border-radius: 50%; background-color: rgba(255, 255, 255, 0.5); color: var(--text-primary); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); border: 1px solid rgba(0,0,0,0.05); cursor: pointer; display:flex; justify-content:center; align-items:center; }
        #sticker-panel { position: absolute; bottom: 0; left: 0; width: 100%; height: 50%; background-color: rgba(242, 242, 247, 0.85); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-top: 1px solid var(--border-color); border-radius: 20px 20px 0 0; z-index: 200; display: flex; flex-direction: column; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); visibility: hidden; }
        #sticker-panel.visible { transform: translateY(0); visibility: visible; }
        #sticker-panel-header { padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; border-bottom: 1px solid var(--border-color); }
        #sticker-panel-header .title { font-weight: 600; }
        #sticker-panel-header .panel-btn { font-size: 16px; padding: 5px 10px; cursor: pointer; color: var(--accent-color); }
        #sticker-grid { flex-grow: 1; overflow-y: auto; padding: 15px; display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px; }
.sticker-item {
    position: relative;
    display: flex;
    flex-direction: column; 
    align-items: center;    
    gap: 6px;               
    cursor: pointer;
}
.sticker-image-container {
    width: 100%;
    aspect-ratio: 1 / 1;    
    background-color: white;
    border-radius: 10px;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.sticker-name {
    font-size: 12px;           
    color: var(--text-secondary); 
    width: 100%;               
    text-align: center;        
    white-space: nowrap;       
    overflow: hidden;          
    text-overflow: ellipsis;   
}
        .sticker-item .delete-btn { display: none; position: absolute; top: -5px; right: -5px; width: 20px; height: 20px; background-color: #ff3b30; color: white; border-radius: 50%; text-align: center; line-height: 20px; font-size: 14px; cursor: pointer; border: 2px solid white; }
        #input-actions-wrapper { position: static; display: flex; align-items: flex-end; gap: 8px; flex-shrink: 0; }
        #wait-reply-btn { position: static; bottom: auto; right: auto; width: auto; height: 40px; padding: 0 10px; border-radius: 20px; display: flex; align-items: center; justify-content: center; background-color: rgba(255, 255, 255, 0.6); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); border: 1px solid rgba(0,0,0,0.08); box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: opacity 0.2s, transform 0.1s; cursor: pointer;}
        #wait-reply-btn:hover { opacity: 0.8; }
        #wait-reply-btn:active { transform: scale(0.9); }
        #wait-reply-btn img { height: 22px; display: block; margin: auto; }
        .chat-image { max-width: 100%; border-radius: 10px; display: block; }
        .message-bubble.has-image .content { padding: 5px; }
        #custom-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: none; align-items: center; justify-content: center; z-index: 1000; opacity: 0; transition: opacity 0.2s ease-in-out; }
        #custom-modal-overlay.visible { display: flex; opacity: 1; }
        #custom-modal { background-color: var(--secondary-bg); width: 280px; border-radius: 14px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); display: flex; flex-direction: column; transform: scale(0.95); transition: transform 0.2s ease-in-out; }
        #custom-modal-overlay.visible #custom-modal { transform: scale(1); }
        .custom-modal-header { padding: 16px; font-size: 17px; font-weight: 600; text-align: center; }
        .custom-modal-body { padding: 0 16px 16px; text-align: center; font-size: 14px; color: #333; line-height: 1.5; }
        .custom-modal-body p { margin: 0; margin-bottom: 12px; }
        .custom-modal-body input {
            width: 100%;
            padding: 8px 12px; 
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 16px; 
            box-sizing: border-box;
        }
        .custom-modal-footer { border-top: 1px solid #dbdbdb; display: flex; }
        .custom-modal-footer button { flex: 1; background: none; border: none; padding: 12px; font-size: 17px; cursor: pointer; color: var(--accent-color); }
        .custom-modal-footer button:first-child { border-right: 1px solid #dbdbdb; }
        .custom-modal-footer .confirm-btn { font-weight: 600; }
        .custom-modal-footer .confirm-btn.btn-danger { color: #ff3b30; }
        #preset-actions-modal .custom-modal-footer { flex-direction: column; }
        #preset-actions-modal .custom-modal-footer button { width: 100%; border: none; border-bottom: 1px solid #dbdbdb; padding: 14px; font-size: 18px; }
        #preset-actions-modal .custom-modal-footer button:last-child { border-bottom: none; }
        .custom-multiselect {
            position: relative;
            -webkit-user-select: none; 
            user-select: none;
        }
        .select-box { display: flex; align-items: center; width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px; box-sizing: border-box; background-color: var(--secondary-bg); cursor: pointer; }
        .select-box .selected-options-text { flex-grow: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-primary); }
        .select-box .arrow-down { margin-left: auto; font-size: 10px; color: var(--text-secondary); transition: transform 0.2s; }
        .select-box.expanded .arrow-down { transform: rotate(180deg); }
       .checkboxes-container {
    display: none;
    position: absolute;
    top: 100%; 
    margin-top: 5px; 
    left: 0;
    right: 0;
    max-height: 150px;
    overflow-y: auto;
    background-color: var(--secondary-bg); /* <-- 修改后 */
    border: 1px solid var(--border-color);
    border-radius: 8px;
    z-index: 101;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
        .checkboxes-container.visible { display: block; }
        .checkboxes-container label { display: block; padding: 10px 12px; cursor: pointer; font-weight: normal; color: var(--text-primary); }
        .checkboxes-container label {
            display: block;
            padding: 12px 15px; 
            cursor: pointer;
            font-weight: normal;
            color: var(--text-primary);
            font-size: 15px; 
        }
        .checkboxes-container input { margin-right: 10px; vertical-align: middle; }
        .bg-upload-container { display: flex; align-items: center; gap: 10px; margin-top: 8px; flex-wrap: wrap; }
        .bg-preview-img { max-width: 120px; max-height: 80px; border-radius: 8px; border: 1px solid var(--border-color); object-fit: cover; display: none; }
        #remove-bg-btn { padding: 8px 12px; border: 1px solid #ff3b30; color: #ff3b30; background-color: var(--secondary-bg); border-radius: 5px; cursor: pointer; font-size: 14px; display: none; }
        .ai-generated-image { max-width: 180px; border-radius: 12px; display: block; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .ai-generated-image:hover { transform: scale(1.05); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        
        /* RealImag/NovelAI图片在私聊/群聊消息气泡里的样式 */
        .realimag-image {
            max-width: 250px;
            max-height: 250px;
            width: auto;
            height: auto;
            display: block;
            border-radius: 10px;
            object-fit: cover;
            background-color: #f8f8f8;
            min-width: 100px;
            min-height: 100px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .realimag-image:hover {
            transform: scale(1.02);
        }
        
        .message-bubble.is-realimag .content {
            padding: 5px;
            background: transparent;
            box-shadow: none;
            border: none;
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
        }
        
        .voice-message-body { display: flex; align-items: center; cursor: pointer; padding: 8px 12px; min-width: 80px; max-width: 200px; }
        .message-bubble.user .voice-message-body { color: #1a3d00; flex-direction: row-reverse; }
        .message-bubble.ai .voice-message-body { color: var(--text-primary); }
        .voice-waveform { display: flex; align-items: center; height: 20px; gap: 2px; flex-grow: 1; margin: 0 10px; }
        .voice-waveform div { width: 3px; background-color: currentColor; border-radius: 2px; animation: wave-quiet 1.5s ease-in-out infinite; }
        @keyframes wave-quiet { 0%, 100% { height: 2px; } 50% { height: 10px; } }
        .voice-waveform div:nth-child(2) { animation-delay: 0.2s; } .voice-waveform div:nth-child(3) { animation-delay: 0.4s; } .voice-waveform div:nth-child(4) { animation-delay: 0.6s; } .voice-waveform div:nth-child(5) { animation-delay: 0.8s; }
        .voice-duration {
            font-size: var(--chat-font-size, 13px);
            font-weight: 500;
            color: var(--text-secondary);
        }
        .message-bubble.user .voice-duration { color: #3e6224; }
        .message-bubble .content {
            position: relative;
            font-size: var(--chat-font-size, 16px);
            padding: 8px 12px;
            line-height: 1.5;
            word-break: break-word; 
        }
        .message-bubble.user .content { background-color: rgba(255, 255, 255, 0.75); color: #585858; border-radius: 8px 2px 8px 8px; }
        .message-bubble.ai .content { background-color: rgba(255, 255, 255, 0.7); color: #585858; border-radius: 2px 8px 8px 8px; }
        .message-bubble::after {
            content: "";
            position: absolute;
            width: 20px;  
            height: 20px; 
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 1; 
            z-index: 1;
        }
        #chat-messages[data-theme="pink_blue"] .message-bubble.user .content { background-color: #fff0f6; color: #432531; }
        #chat-messages[data-theme="pink_blue"] .message-bubble.ai .content { background-color: #eff7ff; color: #263a4e; }
        #chat-messages[data-theme="blue_white"] .message-bubble.user .content { background-color: #eff7ff; color: #263a4e; }
        #chat-messages[data-theme="blue_white"] .message-bubble.ai .content { background-color: #f8f9fa; color: #383d41; }
        #chat-messages[data-theme="purple_yellow"] .message-bubble.user .content { background-color: #faf7ff; color: #827693; }
        #chat-messages[data-theme="purple_yellow"] .message-bubble.ai .content { background-color: #fffde4; color: #5C4033; }
        #chat-messages[data-theme="black_white"] .message-bubble.user .content { background-color: #343a40; color: #f8f9fa; }
        #chat-messages[data-theme="black_white"] .message-bubble.ai .content { background-color: #f8f9fa; color: #343a40; }
        #chat-messages[data-theme="yellow_white"] .message-bubble.user .content { background-color: #FFEB3B; color: #5D4037; }
        #chat-messages[data-theme="yellow_white"] .message-bubble.ai .content { background-color: #f8f9fa; color: #383d41; }
        #chat-messages[data-theme="red_black"] .message-bubble.user .content { background-color: #C62828; color: #FFFFFF; }
        #chat-messages[data-theme="red_black"] .message-bubble.ai .content { background-color: #212121; color: #FFFFFF; }
        #chat-messages[data-theme="blue_yellow"] .message-bubble.user .content { background-color: #A0D2EB; color: #153243; }
        #chat-messages[data-theme="blue_yellow"] .message-bubble.ai .content { background-color: #FEF9E7; color: #5D4037; }
        #chat-messages[data-theme="pink_yellow"] .message-bubble.user .content { background-color: #fff0f6; color: #432531; }
        #chat-messages[data-theme="pink_yellow"] .message-bubble.ai .content { background-color: #FEF9E7; color: #5D4037; }
        #chat-messages[data-theme="pink_purple"] .message-bubble.user .content { background-color: #fff0f6; color: #a78396; }
        #chat-messages[data-theme="pink_purple"] .message-bubble.ai .content { background-color: #faf7ff; color: #827693; }
        #chat-messages[data-theme="gray_white"] .message-bubble.user .content { background-color: #e9ecef; color: #495057; }
        #chat-messages[data-theme="gray_white"] .message-bubble.ai .content { background-color: #f8f9fa; color: #383d41; }
        #chat-messages[data-theme="blue_green"] .message-bubble.user .content { background-color: #d1ecf1; color: #0c5460; }
        #chat-messages[data-theme="blue_green"] .message-bubble.ai .content { background-color: #d4edda; color: #155724; }
        #chat-messages[data-theme="pink_white"] .message-bubble.user .content { background-color: #fff0f6; color: #a78396; }
        #chat-messages[data-theme="pink_white"] .message-bubble.ai .content { background-color: #f8f9fa; color: #383d41; }
        #chat-messages[data-theme="pink_black"] .message-bubble.user .content { background-color: #F8BBD0; color: #5B2C6F; }
        #chat-messages[data-theme="pink_black"] .message-bubble.ai .content { background-color: #343a40; color: #f8f9fa; }
        #chat-messages[data-theme="pink_green"] .message-bubble.user .content { background-color: #F8BBD0; color: #5B2C6F; }
        #chat-messages[data-theme="pink_green"] .message-bubble.ai .content { background-color: #C8E6C9; color: #1B5E20; }
        #chat-messages[data-theme="green_black"] .message-bubble.user .content { background-color: #d4edda; color: #155724; }
        #chat-messages[data-theme="green_black"] .message-bubble.ai .content { background-color: #343a40; color: #f8f9fa; }
        #transfer-btn { font-weight: bold; }
        #transfer-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1001; }
        #transfer-modal.visible { display: flex; }
        .transfer-content { background-color: #fff0f5; border-radius: 20px; width: 290px; padding: 20px; box-shadow: 0 5px 25px rgba(255, 105, 180, 0.3); text-align: center; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100" opacity="0.05"><path d="M50,4 C35,4 28,15 28,24 C28,33 35,32 35,40 C35,48 28,49 28,57 C28,65 35,66 35,74 C35,82 28,83 28,91 C28,99 35,100 50,100 C65,100 72,99 72,91 C72,83 65,82 65,74 C65,66 72,65 72,57 C72,49 65,48 65,40 C65,32 72,33 72,24 C72,15 65,4 50,4 Z" fill="%23FF69B4"/></svg>'); background-repeat: no-repeat; background-position: top right; background-size: 80px; }
        .transfer-header { font-size: 20px; font-weight: bold; color: #a35c7b; margin-bottom: 20px; }
        .transfer-input-group { margin-bottom: 15px; text-align: left; }
        .transfer-input-group label { display: block; font-size: 14px; color: #ff85b3; margin-bottom: 5px; font-weight: 500; }
        .transfer-input-group input { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #ffcce0; background-color: var(--secondary-bg); font-size: 16px; box-sizing: border-box; }
        .transfer-input-group input:focus { border-color: #ff85b3; outline: none; }
        .transfer-actions { display: flex; justify-content: space-between; gap: 10px; }
        .transfer-actions button { flex: 1; padding: 12px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.2s; }
        .transfer-actions button:active { transform: scale(0.95); }
        #transfer-cancel-btn { background-color: #ffdde9; color: #a35c7b; }
        #transfer-confirm-btn { background-color: #ff85b3; color: white; }
        .transfer-card { width: 200px; border-radius: 12px; padding: 12px; color: white; position: relative; overflow: hidden; }
        .transfer-card::before { content: '🐾'; position: absolute; right: 10px; top: 5px; font-size: 30px; opacity: 0.2; transform: rotate(15deg); }
        .message-bubble.user .transfer-card { background: radial-gradient(circle at top left, #ffc5d5, #ff85b3); }
        .message-bubble.ai .transfer-card { background: radial-gradient(circle at top left, #a1c4fd, #c2e9fb); }
        .transfer-title { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 6px; margin-bottom: 8px; }
        .transfer-amount { font-size: 28px; font-weight: bold; margin-bottom: 4px; }
        .transfer-note { font-size: 13px; opacity: 0.9; border-top: 1px solid rgba(255,255,255,0.3); padding-top: 8px; margin-top: 8px; word-break: break-all; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        #listen-together-btn img.rotating { animation: spin 2s linear infinite; }
        #listen-together-btn img.paused { animation-play-state: paused; }
        #music-player-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; display: none; justify-content: center; align-items: center; background-color: rgba(0,0,0,0.3); }
        #music-player-overlay.visible { display: flex; }
        .music-player-window { width: 90%; background-color: rgba(255, 255, 255, 0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-radius: 20px; box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37); border: 1px solid rgba(255, 255, 255, 0.18); padding: 25px; display: flex; flex-direction: column; align-items: center; color: #1f1f1f; position: relative; }
        #music-playlist-btn { position: absolute; top: 15px; right: 15px; font-size: 24px; cursor: pointer; color: #333; }
        #music-time-counter { font-size: 12px; color: #555; margin-bottom: 20px; }
        #music-player-song-title { font-size: 20px; font-weight: 600; margin-bottom: 5px; text-align: center; }
        #music-player-artist { font-size: 14px; color: #666; margin-bottom: 25px; }
        .music-controls { display: flex; align-items: center; justify-content: center; gap: 20px; width: 100%; margin-bottom: 30px; }
        .music-controls button { background: none; border: none; font-size: 16px; font-weight: bold; cursor: pointer; color: #333; width: 44px; height: 44px; display: flex; justify-content: center; align-items: center; transition: transform 0.2s; }
        .music-controls button:active { transform: scale(0.9); }
        .music-controls .play-pause-btn { font-size: 24px; width: 60px; height: 60px; border-radius: 50%; background-color: rgba(0,0,0,0.05); }
        .music-bottom-actions { display: flex; justify-content: space-between; width: 100%; }
        .music-bottom-actions button { flex: 1; padding: 12px 0; border: none; border-radius: 10px; font-size: 15px; font-weight: 500; cursor: pointer; }
        #music-exit-btn { background-color: rgba(255, 100, 100, 0.7); color: white; margin-right: 5px; }
        #music-return-btn { background-color: rgba(0, 123, 255, 0.7); color: white; margin-left: 5px; }
        #music-playlist-panel { position: absolute; bottom: 0; left: 0; width: 100%; height: 70%; background-color: rgba(242, 242, 247, 0.9); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-top: 1px solid var(--border-color); border-radius: 20px 20px 0 0; z-index: 210; display: flex; flex-direction: column; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); visibility: hidden; }
        #music-playlist-panel.visible { transform: translateY(0); visibility: visible; }
        .playlist-header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; border-bottom: 1px solid var(--border-color); font-weight: 600; }
        .playlist-header .panel-btn { font-size: 16px; cursor: pointer; color: var(--accent-color); }
       .playlist-body {
    flex-grow: 1;
    overflow-y: auto;
    padding: 10px 0 80px 0;
    box-sizing: border-box;
}
        .playlist-item { padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-bottom: 1px solid #eee; }
        .playlist-item.playing { background-color: rgba(0, 123, 255, 0.1); }
        .playlist-item-info .title { font-weight: 500; font-size: 15px; }
        .playlist-item-info .artist { font-size: 12px; color: #666; }
        .playlist-item .delete-track-btn { color: #ff3b30; font-size: 20px; padding: 5px; }
        #persona-library-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; padding: 10px; }
        .persona-preset-item { aspect-ratio: 1 / 1; border-radius: 12px; background-size: cover; background-position: center; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; border: 1px solid rgba(0,0,0,0.1); }
        .persona-preset-item:hover { transform: scale(1.08); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .modal-header .action-button { font-size: 16px; color: var(--accent-color); font-weight: 600; cursor: pointer; background: none; border: none; padding: 5px; }
        #battery-alert-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.4); display: none; justify-content: center; align-items: center; z-index: 2000; opacity: 0; transition: opacity 0.3s ease; }
        #battery-alert-modal.visible { display: flex; opacity: 1; }
        .battery-alert-content { background-color: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); width: 280px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); text-align: center; padding: 20px; cursor: pointer; transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        #battery-alert-modal.visible .battery-alert-content { transform: scale(1); }
        #battery-alert-image { max-width: 100px; max-height: 100px; margin-bottom: 15px; }
        #battery-alert-text { font-size: 16px; font-weight: 500; color: #333; margin: 0; line-height: 1.4; }
        #font-preview {
            transition: font-family 0.3s ease;}
        #chat-list-screen {
        }
        .chat-list-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            z-index: 1; 
        }
        .chat-list-view.active {
            opacity: 1;
            visibility: visible;
            z-index: 2; 
        }
        #messages-view {
            overflow-y: auto; 
        }
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            font-size: 14px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s;
        }
        .nav-item.active {
            color: var(--accent-color);
            font-weight: 600;
        }
        #qzone-screen {
            background-color: #f0f2f5;
        }
        .qzone-header {
            position: relative;
            z-index: 10; 
            flex-shrink: 0; 
            padding: 15px 20px;
            padding-top: 45px;
            background-color: rgba(247, 247, 247, 0.7); 
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
        }
        .qzone-header .back-btn {
            font-size: 24px;
            cursor: pointer;
            color: var(--accent-color);
        }
        .qzone-header span:nth-child(2) { 
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
        .qzone-content {
            flex-grow: 1;
            overflow-y: auto;
        }
        .qzone-profile-header {
            position: relative;
            margin-bottom: 20px;
        }
        .qzone-banner-container {
            width: 100%;
            height: 180px; 
            position: relative;
        }
        #qzone-banner-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .qzone-user-info {
            position: absolute;
            bottom: -30px; 
            left: 20px;
            display: flex;
            align-items: flex-end; 
            gap: 10px;
        }
        .qzone-avatar-container {
            position: relative;
        }
        #qzone-avatar-img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            object-fit: cover;
        }
        #qzone-nickname {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            padding-bottom: 5px; 
        }
        .qzone-edit-btn {
            position: absolute;
            background-color: rgba(0,0,0,0.4);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        #change-qzone-banner-btn {
            bottom: 10px;
            right: 10px;
        }
        #change-qzone-avatar-btn {
            bottom: 5px;
            right: 5px;
        }
        #change-qzone-nickname-btn {
            font-size: 14px;
            padding: 2px 6px;
            margin-left: 5px; 
            color: var(--text-primary);
            background-color: rgba(255,255,255,0.7);
            border-radius: 5px;
            position: relative; 
            bottom: 5px; 
        }
        #qzone-banner-container,
        #qzone-avatar-container,
        #qzone-nickname {
            cursor: pointer; 
            transition: opacity 0.2s;
        }
        #qzone-banner-container:hover,
        #qzone-avatar-container:hover,
        #qzone-nickname:hover {
            opacity: 0.85; 
        }
        .qzone-edit-btn {
            display: none;
        }
        #qzone-screen .qzone-header {
            display: none;
        }
        #qzone-screen.active .qzone-header {
            display: flex;
        }
        #chat-list-screen.in-qzone-view > .header,
        #chat-list-screen.in-qzone-view > #chat-list-bottom-nav {
            display: none;
        }
        .chat-list-item:first-child,
        .chat-group-container:first-child {
            margin-top: 10px; 
        }
        .qzone-actions-bar {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            margin: 40px 15px 15px 15px; 
            background-color: var(--secondary-bg);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .action-item {
            flex: 1;
            text-align: center;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            padding: 8px 0;
            position: relative;
        }
        .action-item:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 20px;
            background-color: var(--border-color);
        }
        #qzone-posts-list {
            padding: 0 15px 20px 15px; 
            display: flex;
            flex-direction: column;
            gap: 20px; 
        }
        .qzone-post-item {
            background-color: var(--secondary-bg);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
        }
        .post-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        .post-header .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        .post-info {
            display: flex;
            flex-direction: column;
        }
        .post-info .post-nickname {
            font-weight: 600;
            font-size: 15px;
            color: var(--text-primary);
        }
        .post-info .post-timestamp {
            font-size: 12px;
            color: var(--text-secondary);
        }
        .post-content {
            font-size: 14px;
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap; 
            word-break: break-word; 
        }
        #post-public-text {
            min-height: 80px; 
            resize: vertical;
        }
        .post-image-preview-container {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9; 
            background-color: #f0f2f5;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            margin-bottom: 15px;
            display: none; 
            justify-content: center;
            align-items: center;
        }
        .post-image-preview-container.visible {
            display: flex; 
        }
        #post-image-preview {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 6px;
        }
        #post-remove-image-btn {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: #ff3b30;
            color: white;
            border: 2px solid white;
            font-size: 16px;
            line-height: 20px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 1px 4px rgba(0,0,0,0.3);
        }
        .post-image-upload-options {
            display: flex;
            gap: 10px;
        }
        .post-image-upload-options button {
            flex: 1;
            margin-top: 0;
        }
        .post-mode-switcher {
            display: flex;
            margin-bottom: 20px;
            background-color: #e9ecef;
            border-radius: 8px;
            padding: 4px;
        }
        .mode-btn {
            flex: 1;
            padding: 8px;
            border: none;
            background-color: transparent;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .mode-btn.active {
            background-color: var(--secondary-bg);
            color: var(--text-primary);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .post-mode-content {
            display: none; 
        }
        .post-mode-content.active {
            display: block; 
        }
        #album-screen {
            background-color: #f0f2f5; 
        }
        #album-grid-page {
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(2, 1fr); 
            gap: 15px;
        }
        .album-item {
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border-radius: 8px; 
        }
        .album-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        .album-cover {
            aspect-ratio: 1 / 1; 
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            margin-bottom: 8px;
            background-color: #f0f2f5; 
        }
        .album-info {
            text-align: center;
        }
        .album-name {
            font-weight: 500;
            margin: 0 0 4px 0;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis; 
        }
        .album-count {
            font-size: 12px;
            color: var(--text-secondary);
            margin: 0;
        }
        #album-photos-screen {
            background-color: #f0f2f5;
        }
        #photos-grid-page {
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .photo-item {
            position: relative; 
            aspect-ratio: 1 / 1; 
            border-radius: 6px;
            overflow: hidden; 
            background-color: #e9ecef; 
        }
        .photo-item .photo-thumb {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            cursor: pointer;
        }
        .photo-item .photo-delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 22px;
            height: 22px;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 16px;
            line-height: 22px;
            text-align: center;
            cursor: pointer;
            opacity: 0; 
            transition: opacity 0.2s ease;
        }
        .photo-item:hover .photo-delete-btn {
            opacity: 1;
        }
        #photo-viewer-modal {
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 1002;
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
        }
        .photo-viewer-content {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }
        #photo-viewer-image {
            max-width: 90vw;  
            max-height: 85vh; 
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: opacity 0.2s ease-in-out;
        }
        #photo-viewer-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 40px;
            font-weight: 200;
            cursor: pointer;
            line-height: 1;
            text-shadow: 0 0 5px black;
        }
        #photo-viewer-modal .nav-arrow {
            position: absolute; 
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 50px; 
            font-weight: 100;
            cursor: pointer;
            padding: 10px; 
        -webkit-user-select: none; 
            user-select: none;
            transition: color 0.2s;
            z-index: 1003; 
        }
        #photo-viewer-prev-btn {
            left: 5px; 
        }
        #photo-viewer-next-btn {
            right: 5px; 
        }
        #photo-viewer-modal .nav-arrow:hover {
            color: white;
        }
        #photo-viewer-modal .nav-arrow:disabled {
            color: rgba(255, 255, 255, 0.2);
            cursor: default;
        }
        .post-main-content {
        }
        .post-feedback-icons {
            display: flex;
            justify-content: flex-end; 
            align-items: center;
            gap: 12px;
            padding: 8px 0; 
        }
        .action-icon {
            cursor: pointer;
            color: var(--text-secondary); 
            transition: all 0.2s ease-in-out;
        }
        .action-icon svg {
            width: 22px;
            height: 22px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .action-icon.active {
            color: #ff5252; 
            transform: scale(1.1); 
        }
        .action-icon.active.favorite {
            color: #ffc107; 
        }
        .action-icon.active svg {
            fill: currentColor; 
        }
        .animate-like {
            animation: like-bounce 0.4s ease-in-out;
        }
        @keyframes like-bounce {
            0%   { transform: scale(1); }
            25%  { transform: scale(0.8); }
            50%  { transform: scale(1.2); }
            75%  { transform: scale(1.05); }
            100% { transform: scale(1.1); }
        }
        .post-footer {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #f0f0f0; 
            display: flex;
            align-items: center;
            gap: 8px; 
        }
        .comment-section {
            flex-grow: 1; 
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .comment-section .comment-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }
        .comment-section {
            position: relative; 
        }
        .comment-section .comment-input {
            width: 100%;
            padding: 8px 12px;
            border: none;
            background-color: #f0f2f5;
            border-radius: 14px;
            font-size: 16px; 
            outline: none;
        }
        .comment-send-btn {
            flex-shrink: 0; 
            padding: 8px 15px;
            border: none;
            background-color: var(--accent-color);
            color: white;
            border-radius: 14px;
            font-size: 16px; 
            font-weight: 500;
            cursor: pointer;
        }
        .unread-indicator {
            position: absolute;
            top: -8px;      
            right: -15px;    
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            background-color: #ff3b30;
            color: white;
            font-size: 11px;
            font-weight: bold;
            line-height: 18px;
            text-align: center;
            border-radius: 9px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            display: none;
            z-index: 1;
        }
        .back-btn-indicator {
            top: 0;
            right: -8px; 
            width: 10px;
            height: 10px;
            min-width: 10px;
            padding: 0;
            border-radius: 50%;
        }
        .post-comments-container {
            padding: 10px 0; 
            display: flex;
            flex-direction: column;
            gap: 8px; 
            font-size: 13px; 
        }
        .comment-item {
            line-height: 1.5;
        }
        .comment-item .commenter-name {
            font-weight: 600;
            color: var(--accent-color);
            cursor: pointer;
            margin-right: 5px; 
        }
        .comment-item .comment-text {
            color: var(--text-primary);
            word-break: break-word;
        }
        .post-likes-section {
            display: flex;
            align-items: center;
            gap: 6px; 
            padding: 8px 10px; 
            font-size: 13px;
            color: var(--accent-color); 
            background-color: #f0f5fa; 
            border-top: 1px solid #e9eef3;
            border-bottom: 1px solid #e9eef3;
            margin-top: 5px; 
        }
        .post-likes-section .like-icon {
            width: 16px;
            height: 16px;
            fill: currentColor; 
            flex-shrink: 0; 
        }
        .at-mention-popup {
            position: absolute; 
            bottom: 100%; 
            left: 40px; 
            width: calc(100% - 40px); 
            max-height: 120px;
            overflow-y: auto;
            background-color: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
            z-index: 10;
            display: none; 
        }
        .at-mention-item {
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            color: var(--text-primary);
            border-bottom: 1px solid #f0f0f0;
        }
        .at-mention-item:last-child {
            border-bottom: none;
        }
        .at-mention-item:hover {
            background-color: #f5f5f5;
        }
        #favorites-view {
            display: flex;
            flex-direction: column;
        }
        #favorites-view > .header {
            flex-shrink: 0;
        }
        #favorites-list {
            flex-grow: 1; 
            overflow-y: auto; 
            overflow-x: hidden; 
            padding: 15px; 
            display: flex;
            flex-direction: column;
            gap: 15px; 
        }
        .favorite-item-card {
            background-color: var(--secondary-bg);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
            position: relative; 
        }
        .fav-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        .fav-card-header .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
        }
        .fav-card-header .info {
            flex-grow: 1;
        }
        .fav-card-header .name {
            font-weight: 600;
            font-size: 15px;
        }
        .fav-card-header .source {
            font-size: 12px;
            color: var(--text-secondary);
        }
        .fav-card-content {
            font-size: 14px;
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .fav-card-content .chat-image {
            margin-top: 8px; 
        }
        .fav-delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 28px;
            height: 28px;
            background: #f0f2f5;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            color: var(--text-secondary);
            line-height: 28px;
            text-align: center;
        }
        .fav-delete-btn:hover {
            background-color: #e9ecef;
            color: #ff3b30;
        }
        .search-bar-container {
            padding: 10px 15px;
            background-color: #f9f9f9; 
            position: relative; 
            flex-shrink: 0;
        }
        #favorites-search-input {
            width: 100%;
            padding: 10px 30px 10px 15px; 
            font-size: 16px;
            border: 1px solid var(--border-color);
            border-radius: 18px; 
            background-color: var(--secondary-bg);
            box-sizing: border-box;
            outline: none;
        }
        #favorites-search-input:focus {
            border-color: var(--accent-color);
        }
        .search-clear-btn {
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            background: #ccc;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            font-size: 16px;
            cursor: pointer;
        }
        #chat-interface-screen .header .selection-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        #chat-interface-screen .selection-controls .action-btn {
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            padding: 5px;
        }
        #favorites-view.selection-mode .favorite-item-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .favorite-item-card::before {
            content: '';
            position: absolute;
            left: -25px; 
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-radius: 50%;
            background-color: white;
            transition: all 0.2s ease;
            opacity: 0; 
        }
        #favorites-view.selection-mode .favorite-item-card {
            transform: translateX(35px);
        }
        #favorites-view.selection-mode .favorite-item-card::before {
            opacity: 1;
        }
        #favorites-view.selection-mode .favorite-item-card.selected::before {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            content: '✔';
            color: white;
            font-size: 14px;
            text-align: center;
            line-height: 20px;
        }
        #favorites-action-bar {
            position: absolute; 
            bottom: 0;
            left: 0;
            right: 0;           
            width: auto;        
            padding: 10px 15px;
            padding-bottom: calc(10px + env(safe-area-inset-bottom)); 
            background-color: rgba(247, 247, 247, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
            box-sizing: border-box;
            z-index: 5;
            display: none;
        }
        #favorites-action-bar .action-bar-btn {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            background-color: #ff3b30;
            color: white;
        }
        #chat-interface-screen .header .selection-controls {
            display: none;
        }
        #chat-interface-screen .header .default-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        #chat-interface-screen.selection-mode .header .default-controls {
            display: none;
        }
        #chat-interface-screen.selection-mode .header .selection-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        #add-chat-btn,
        #add-world-book-btn,
        #create-album-btn-page {
            font-size: 28px;   
            font-weight: 300;  
            position: relative;
            top: -1px;         
        }
        #settings-preview-area {
            width: 100%;
            height: 180px; 
            background-color: #f0f2f5;
            border-radius: 8px;
            padding: 15px;
            box-sizing: border-box;
            overflow: hidden; 
            display: flex;
            flex-direction: column;
            gap: 10px; 
            border: 1px solid var(--border-color);
            position: relative; 
        }
        #settings-preview-area::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            z-index: 1;
            opacity: 0.8;
        }
        #settings-preview-area .message-wrapper {
            position: relative;
            z-index: 2;
        }
        #settings-preview-area .message-bubble .avatar {
            width: 30px;
            height: 30px;
        }
        #settings-preview-area .message-bubble .timestamp {
            display: none; 
        }
        .existing-group-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        .existing-group-item .group-name {
            font-weight: 500;
        }
        .existing-group-item .delete-group-btn {
            color: #ff3b30;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }
        .chat-group-container {
            border-bottom: 1px solid var(--border-color);
        }
        .chat-group-container:first-child {
            border-top: 1px solid var(--border-color);
        }
        .chat-group-header {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            cursor: pointer;
            background-color: #f7f7f7;
        }
        .chat-group-header .arrow {
            font-size: 14px;
            margin-right: 8px;
            transition: transform 0.2s ease;
        }
        .chat-group-header.collapsed .arrow {
            transform: rotate(-90deg);
        }
        .chat-group-header .group-name {
            font-weight: 600;
            font-size: 15px;
        }
        .chat-group-content {
            max-height: 1000px; 
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        .chat-group-content.collapsed {
            max-height: 0;
        }
        .format-helpers {
            display: flex;
            gap: 10px;
            margin-bottom: 15px; 
            flex-wrap: wrap; 
        }
        .format-btn {
            background-color: #e9ecef;
            color: var(--text-primary);
            border: none;
            padding: 6px 12px;
            border-radius: 16px; 
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .format-btn:hover {
            background-color: #dcdfe3;
        }
        .post-actions-btn {
            margin-left: auto; 
            padding: 5px 10px;
            font-size: 20px;
            font-weight: bold;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 50%;
            line-height: 1;
        }
        .post-actions-btn:hover {
            background-color: #f0f0f0;
        }
        #post-actions-modal .custom-modal-footer button {
            width: 100%;
            border: none;
            border-bottom: 1px solid #dbdbdb;
            padding: 14px;
            font-size: 18px;
        }
        #post-actions-modal .custom-modal-footer button:last-child {
            border-bottom: none;
        }
        #post-actions-modal #cancel-post-action-btn {
            margin-top: 8px;
            border-radius: 8px;
            background-color: #f0f0f0;
        }
        #chat-messages .transfer-card .transfer-title,
        #chat-messages .transfer-card .transfer-amount,
        #chat-messages .transfer-card .transfer-note {
            text-shadow: none !important; 
            color: white !important;      
        }
        #chat-messages .transfer-card .transfer-title {
            font-size: 16px !important;
            font-weight: 600 !important;
        }
        #chat-messages .transfer-card .transfer-amount {
            font-size: 28px !important;
            font-weight: bold !important;
        }
        #chat-messages .transfer-card .transfer-note {
            font-size: 13px !important;
            opacity: 0.9 !important;
        }
        .header > span:nth-child(2),
        #chat-header-title {
            position: absolute;
            left: 50%;
            transform: translateX(calc(-50% - 2px)); 
            max-width: 60%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        #message-editor-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .message-editor-block {
            background-color: #f9f9f9;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
        }
        .message-editor-block textarea {
            width: 100%;
            min-height: 60px;
            resize: vertical;
            border: 1px solid #ccc;
            border-radius: 6px;
            padding: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .message-editor-block .format-helpers {
            margin-top: 8px;
            margin-bottom: 0; 
        }
        .message-editor-block .delete-block-btn {
            float: right;
            margin-top: -5px;
            background: none;
            border: none;
            color: #ff3b30;
            font-size: 20px;
            cursor: pointer;
        }
        .contact-picker-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }
        .contact-picker-item .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-radius: 50%;
            margin-right: 15px;
            transition: all 0.2s ease;
        }
        .contact-picker-item.selected .checkbox {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            content: '✔';
            color: white;
            font-size: 14px;
            text-align: center;
            line-height: 20px;
        }
        .contact-picker-item .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
        }
        .contact-picker-item .name {
            font-weight: 500;
        }
        #member-management-list {
            padding: 0; 
        }
        .member-management-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
        }
        .member-management-item .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
        }
        .member-management-item .name {
            flex-grow: 1;
            font-weight: 500;
        }
        .member-management-item .remove-member-btn {
            background-color: #ff3b30;
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 20px;
            line-height: 28px;
            text-align: center;
            cursor: pointer;
            flex-shrink: 0;
        }
        #member-management-actions {
            flex-shrink: 0;
            padding: 15px;
            border-top: 1px solid var(--border-color);
            background-color: #f7f7f7;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        #member-management-actions button {
            width: 100%;
            padding: 15px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        #member-management-actions #create-new-member-btn {
            background-color: #4cd964; 
        }
        .waimai-card {
            width: 240px;
            border-radius: 12px;
            overflow: hidden;
            background-color: var(--secondary-bg);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        .waimai-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            border-bottom: 1px solid #f0f0f0;
        }
        .waimai-header .icon {
            width: 20px;
            height: 20px;
        }
        .waimai-header .title-group {
            display: flex;
            align-items: baseline;
            font-size: 14px;
            color: #8a8a8a;
        }
        .waimai-header .title-group .brand {
            font-weight: 600;
            color: #555;
            margin-right: 5px;
        }
        .waimai-header .title-group .separator {
            margin: 0 5px;
        }
        .waimai-catchphrase {
            font-size: 13px;
            color: #1f1f1f;
            padding: 12px;
        }
        .waimai-main {
            background-color: #FFD66B; 
            padding: 12px;
            text-align: center;
        }
        .waimai-main .request-title {
            font-size: 12px;
            color: #856404;
            margin-bottom: 8px;
        }
        .waimai-main .payment-box {
            background-color: var(--secondary-bg);
            border-radius: 8px;
            padding: 15px 10px;
        }
        .waimai-main .payment-label {
            font-size: 13px;
            color: #8a8a8a;
        }
        .waimai-main .amount {
            font-size: 32px;
            font-weight: 700;
            color: #1f1f1f;
            margin: 4px 0 12px 0;
        }
        .waimai-main .countdown-label {
            font-size: 13px;
            color: #8a8a8a;
        }
        .waimai-main .countdown-timer {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            margin-left: 5px;
        }
        .waimai-main .countdown-timer span {
            background-color: #333;
            color: white;
            padding: 2px 4px;
            border-radius: 2px;
            font-weight: bold;
            font-size: 12px;
        }
        .waimai-details-btn {
            width: 100%;
            padding: 10px 0;
            margin-top: 15px;
            border: none;
            border-radius: 6px;
            background-color: #FFC33A;
            color: #49380a;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        .message-bubble.status-paid .waimai-card {
            border: 2px solid #28a745; 
        }
        .message-bubble.status-paid .waimai-main .request-title::before {
            content: '✅  ';
        }
        .message-bubble.status-paid .waimai-main .request-title {
            color: #155724;
            font-weight: 600;
            content: "我已为您买单，请尽情享用吧～" !important;
            display: block;
            margin-bottom: 15px;
        }
        .message-bubble.status-paid .payment-box {
            display: none; 
        }
        .message-bubble.status-paid .waimai-details-btn {
            background-color: #28a745;
            color: white;
        }
        .message-bubble.status-rejected .waimai-card {
            border: 2px solid #dc3545; 
            opacity: 0.8;
        }
        .message-bubble.status-rejected .waimai-main {
            background-color: #e9ecef;
        }
        .message-bubble.status-rejected .waimai-main .request-title::before {
            content: '❌ ';
        }
        .message-bubble.status-rejected .waimai-main .request-title {
            color: #721c24;
            font-weight: 600;
            content: "我拒绝了您的代付请求" !important;
            display: block;
            margin-bottom: 15px;
        }
        .message-bubble.status-rejected .payment-box {
            display: none; 
        }
         .message-bubble.status-rejected .waimai-details-btn {
            background-color: #6c757d;
            color: white;
        }
        .message-bubble[class*="status-"] .request-title {
            font-size: 0; 
        }
        .message-bubble[class*="status-"] .request-title::after {
            font-size: 14px; 
        }
        .message-bubble.status-paid .request-title::after {
            content: "我已为您买单，请尽情享用吧～";
        }
        .message-bubble.status-rejected .request-title::after {
            content: "我拒绝了您的代付请求";
        }
        .waimai-user-actions {
            display: flex;
            gap: 10px;
            padding: 0 12px 12px 12px; 
            background-color: var(--secondary-bg);
        }
        .waimai-user-actions button {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: 1.5px solid;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .waimai-pay-btn {
            background-color: #28a745;
            border-color: #1f7a33;
            color: white;
        }
        .waimai-pay-btn:hover {
            background-color: #218838;
        }
        .waimai-decline-btn {
            background-color: #f8f9fa;
            border-color: #ced4da;
            color: #495057;
        }
        .waimai-decline-btn:hover {
            background-color: #e2e6ea;
        }
        #api-settings-screen,
        #font-settings-screen,
        #wallpaper-screen,
        #memories-view,
        #contact-picker-screen,
        #member-management-screen,
        #world-book-editor-screen {  
            background-color: var(--secondary-bg);
        }
        #api-settings-screen .form-container,
        #font-settings-screen .form-container,
        #wallpaper-screen .form-container {
            padding-top: 100px;
            margin-top: -80px;
            background-color: var(--secondary-bg);
        }
        #wallpaper-screen .form-container {
            align-items: center; 
        }
        #incoming-call-modal .incoming-call-content {
            background-color: rgba(40, 40, 40, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            width: 280px;
            padding: 30px 20px;
            text-align: center;
            color: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .caller-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 12px;
            border: 3px solid rgba(255,255,255,0.5);
        }
        .caller-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        .caller-text {
            font-size: 14px;
            color: #ccc;
            margin-bottom: 30px;
        }
        .incoming-call-actions {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        .action-button-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #e0e0e0;
        }
        .call-action-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            background-size: 50%;
            background-repeat: no-repeat;
            background-position: center;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .call-action-btn:active {
            transform: scale(0.9);
        }
        .call-action-btn.decline {
            background-color: #ff3b30;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 16.5L3 6m18 6l-5.6-5.6a1.2 1.2 0 0 0-1.7 0L3 18.2a1.2 1.2 0 0 0-.3 1.2l1.2 3.6a1.2 1.2 0 0 0 1.2.9h15.6a1.2 1.2 0 0 0 1.2-1.2V7.7a1.2 1.2 0 0 0-.3-1.1z"/></svg>');
        }
        .call-action-btn.accept {
            background-color: #4cd964;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>');
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 217, 100, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(76, 217, 100, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 217, 100, 0); }
        }
        #video-call-screen {
            background-color: #1c1c1e;
            color: white;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .video-call-top-bar {
            position: absolute;
            top: 0; left: 0; width: 100%;
            padding: 15px 20px;
            padding-top: 50px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent);
            z-index: 10;
            text-align: center;
            box-sizing: border-box;
            pointer-events: none;
        }
        #call-timer {
            font-size: 16px;
            font-weight: 500;
            letter-spacing: 1px;
        }
        .video-call-controls {
            position: absolute;
            bottom: 0; left: 0; width: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 20px;
            padding-bottom: 40px;
            background: linear-gradient(to top, rgba(0,0,0,0.5), transparent);
            z-index: 10;
            box-sizing: border-box;
        }
        .video-call-avatar-area {
            flex-grow: 1; 
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            padding-top: 80px; 
            box-sizing: border-box;
            overflow-y: auto; 
        }
        #participant-avatars-grid {
            display: flex;
            flex-wrap: wrap; 
            justify-content: center;
            align-items: center;
            gap: 15px; 
            max-width: 100%;
        }
        .participant-avatar-wrapper {
            position: relative;
            text-align: center;
            flex-shrink: 0;
        }
        .participant-avatar {
            width: 70px;   
            height: 70px;  
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .participant-name {
            margin-top: 8px;
            font-size: 12px;
            color: #ccc;
        }
        .participant-avatar.speaking {
            border-color: #4cd964;
            box-shadow: 0 0 20px rgba(76, 217, 100, 0.6);
            transform: scale(1.05);
        }
        #video-call-main {
            flex-shrink: 0; 
            height: 30%;   
            margin: 15px 15px 130px 15px; 
            overflow-y: auto;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            box-sizing: border-box;
        }
        .control-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            background-repeat: no-repeat;
            background-position: center;
            transition: transform 0.2s, background-color 0.2s;
        }
        .control-btn:active {
            transform: scale(0.9);
        }
        .control-btn.speak-btn {
            background-color: rgba(255,255,255,0.2);
            background-size: 55%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>');
        }
        .control-btn.hangup-btn {
            background-color: #ff3b30;
            background-size: 50%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 16.5L3 6m18 6l-5.6-5.6a1.2 1.2 0 0 0-1.7 0L3 18.2a1.2 1.2 0 0 0-.3 1.2l1.2 3.6a1.2 1.2 0 0 0 1.2.9h15.6a1.2 1.2 0 0 0 1.2-1.2V7.7a1.2 1.2 0 0 0-.3-1.1z"/></svg>');
        }
        .control-btn.join-btn {
            background-color: #007bff;
            background-size: 50%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="17" y1="11" x2="23" y2="11"></line></svg>');
        }
        .call-message-bubble {
            padding: 10px 15px;
            border-radius: 12px;
            max-width: 85%;
            line-height: 1.6;
            word-break: break-word;
            white-space: pre-wrap;
        }
        .call-message-bubble.ai-speech {
            background-color: rgba(255, 255, 255, 0.15);
            align-self: flex-start; 
        }
        .call-message-bubble.user-speech {
            background-color: #4cd964; 
            align-self: flex-end;   
            text-align: left; 
        }
        #outgoing-call-screen {
            background-color: #1c1c1e;
            color: white;
            justify-content: center; 
            align-items: center;   
        }
        .outgoing-call-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .outgoing-call-actions {
            margin-top: 50px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #e0e0e0;
        }
        .qzone-post-container {
            position: relative; 
            overflow: hidden;   
            border-radius: 12px;
        }
        .qzone-post-item {
            transition: transform 0.3s ease;
            background-color: var(--secondary-bg); 
            position: relative; 
            z-index: 2;
        }
        .qzone-post-delete-action {
            position: absolute; 
            top: 0;
            right: 0;
            bottom: 0;
            width: 90px; 
            background-color: #ff3b30; 
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            cursor: pointer;
            z-index: 1; 
        }
        .qzone-post-item.swiped {
            transform: translateX(-90px); 
        }
        @keyframes pat-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
            20%, 40%, 60%, 80% { transform: translateX(3px); }
        }
        .pat-animation {
            animation: pat-shake 0.4s ease-in-out;
        }
        .system-message {
            align-self: center; 
            padding: 4px 12px;
            margin: 5px 0;
            background-color: rgba(0, 0, 0, 0.1);
            color: var(--text-secondary);
            font-size: 12px;
            border-radius: 10px;
            text-align: center;
            max-width: 80%;
        }
        .message-wrapper.system-pat {
            justify-content: center;
            align-self: center;
            margin: 5px 0;
            max-width: 80%;
        }
        .message-bubble.system-bubble {
            background-color: rgba(0, 0, 0, 0.1);
            color: var(--text-secondary);
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 10px;
        }
        #chat-input-actions-top {
            display: flex;
            gap: 8px;
            padding: 0 5px;
            overflow-x: auto;      
            flex-wrap: nowrap;     
            -webkit-overflow-scrolling: touch; 
            scrollbar-width: none; 
            -ms-overflow-style: none;  
        }
        #chat-input-actions-top::-webkit-scrollbar {
            display: none; 
        }
        #chat-header-title-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center; 
            gap: 2px; 
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            max-width: 60%;
        }
        #chat-header-title {
            font-size: 16px; 
            font-weight: 600;
            position: static; 
            transform: none;  
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        #chat-header-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }
        .status-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background-color: #4cd964; 
            transition: background-color 0.3s ease;
        }
        #chat-header-status.busy .status-dot {
            background-color: #cccccc;
        }
        .status-text {
            font-weight: 500;
        }
        .memory-card {
            background-color: #fffaf0; 
            border-radius: 12px;
            padding: 15px; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.07);
            border-left: 5px solid #ffb74d; 
            display: flex; 
            flex-direction: column; 
            gap: 8px; 
        }
        .memory-card .header {
            border-bottom: 1px solid rgba(217, 129, 0, 0.15); 
            padding-bottom: 8px; 
        }
        .memory-card .header .date {
            font-size: 11px;
            color: #a1887f;
            margin-bottom: 4px; 
        }
        .memory-card .header .author {
            font-weight: 600;
            color: #d98100;
            font-size: 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .memory-card .content {
            font-size: 14px;
            line-height: 1.7;
            color: #5d4037;
            white-space: pre-wrap;
        }
        .countdown-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(118, 75, 162, 0.4);
            text-align: center;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        .countdown-card::before {
            content: '✨';
            position: absolute;
            top: -10px;
            left: -10px;
            font-size: 50px;
            opacity: 0.1;
            transform: rotate(-15deg);
        }
        .countdown-card .title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        .countdown-card .timer {
            font-size: 28px;
            font-weight: 300;
            letter-spacing: 2px;
            margin-bottom: 15px;
        }
        .countdown-card .target-date {
            font-size: 12px;
            opacity: 0.8;
            border-top: 1px solid rgba(255,255,255,0.2);
            padding-top: 10px;
        }
        #chat-lock-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: rgba(247, 247, 247, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 150; 
            display: none; 
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }
        #chat-lock-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        #chat-lock-content .lock-text {
            color: var(--text-secondary);
            font-size: 14px;
        }
        #chat-lock-content .lock-action-btn {
            padding: 10px 20px;
            border-radius: 20px;
            border: 1px solid var(--accent-color);
            background-color: var(--accent-color);
            color: white;
            cursor: pointer;
        }
        #chat-lock-content .lock-action-btn.secondary {
            background-color: transparent;
            color: var(--accent-color);
        }
        .red-packet-card {
            width: 220px;
            border-radius: 8px;
            background: linear-gradient(160deg, #F96259, #E44D44);
            color: #ffd700; 
            padding: 12px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        .red-packet-card.opened {
            background: linear-gradient(160deg, #d3c4a0, #c4b693);
            cursor: default;
        }
        .red-packet-card::before {
            content: '🧧';
            position: absolute;
            top: -5px;
            left: -5px;
            font-size: 30px;
            opacity: 0.2;
            transform: rotate(-10deg);
        }
        .rp-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        .rp-icon {
            width: 20px;
            height: 20px;
        }
        .rp-greeting {
            font-size: 15px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .rp-type {
            font-size: 11px;
            color: white;
            opacity: 0.8;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 8px;
            margin-top: 8px;
        }
        .rp-claimed-info {
            font-size: 13px;
            color: white;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.3);
        }
        .rp-details-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .rp-details-item:last-child {
            border-bottom: none;
        }
        .rp-details-item .name {
            flex-grow: 1;
            font-weight: 500;
            color: #333;
        }
        .rp-details-item .amount {
            font-weight: 500;
            color: #555;
        }
        .rp-details-item .lucky-king-tag {
            font-size: 10px;
            background-color: #ffd700;
            color: #a67c00;
            padding: 2px 5px;
            border-radius: 4px;
            margin-left: 8px;
            font-weight: bold;
        }
        .poll-card {
            width: 250px;
            background-color: #f9f9f9;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            padding: 12px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        .poll-card.closed {
            background-color: #e9ecef; 
        }
        .poll-question {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 12px;
            line-height: 1.4;
            word-break: break-word;
        }
        .poll-options-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .poll-option-item {
            background-color: white;
            border: 1px solid #dcdcdc;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: background-color 0.2s;
        }
        .poll-card:not(.closed) .poll-option-item:hover {
            background-color: #f0f8ff;
        }
        .poll-option-item.voted {
            border-color: var(--accent-color);
            background-color: #e7f3ff;
            font-weight: 500;
        }
        .poll-option-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: rgba(0, 123, 255, 0.1);
            z-index: 1;
            transition: width 0.3s ease-in-out;
        }
        .poll-option-content {
            position: relative;
            z-index: 2;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .poll-option-text {
            font-size: 14px;
        }
        .poll-option-votes {
            font-size: 13px;
            color: #8a8a8a;
            font-weight: 500;
        }
        .poll-footer {
            margin-top: 12px;
            padding-top: 8px;
            border-top: 1px solid #e9e9e9;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--text-secondary);
        }
        .poll-total-votes {
            font-weight: 500;
        }
        .poll-action-btn {
            background: none;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            padding: 4px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
        }
        .poll-card.closed .poll-action-btn {
            background-color: #6c757d;
            color: white;
            border-color: #6c757d;
        }
        .poll-option-input-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .poll-option-input-wrapper input {
            flex-grow: 1;
        }
        .poll-option-input-wrapper .remove-option-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background-color: #f0f0f0;
            color: #ff3b30;
            border: none;
            cursor: pointer;
            font-size: 18px;
            line-height: 28px;
            text-align: center;
            flex-shrink: 0;
        }
        #chat-header-title.typing-status {
            color: var(--text-secondary);
            animation: typing-pulse 1.5s infinite;
            font-style: italic;
        }
        @keyframes typing-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        #chat-header-title {
            transition: opacity 0.2s ease-in-out;
        }
        @keyframes message-pop-in {
          from {
            opacity: 0;
            transform: translateY(15px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        .message-wrapper.animate-in {
          animation: message-pop-in 0.3s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
          }
#icon-settings-grid,
#cphone-icon-settings-grid { 
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
    gap: 20px;
    width: 100%;
    padding: 0 10px;
    box-sizing: border-box;
}
        .icon-setting-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .icon-preview {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            background-size: cover;
            background-position: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .change-icon-btn {
            padding: 4px 10px;
            font-size: 12px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            border-radius: 5px;
            cursor: pointer;
        }
        #wallpaper-screen .form-container {
            min-height: 0; 
        }
        #wallpaper-preview {
            flex-shrink: 0; 
        }
        #browser-screen {
            background-color: #f8f9fa;
        }
        #browser-content {
            padding: 20px;
            font-size: 16px;
            line-height: 1.8;
            color: #333;
            overflow-y: auto;
            background-color: #f8f9fa;
        }
        #browser-content .article-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        #browser-content .article-meta {
            font-size: 13px;
            color: #8a8a8a;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        #browser-content .article-body {
            white-space: pre-wrap;
            word-break: break-word;
        }
        #browser-content .article-body p {
            margin-bottom: 1em;
        }
        .link-share-card {
            width: 210px; 
            background-color: var(--secondary-bg);
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            padding: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .link-share-card:hover {
            background-color: #f9f9f9;
        }
        .link-share-card .title {
            font-weight: 600;
            font-size: 15px;
            line-height: 1.4;
            color: #1f1f1f;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .link-share-card .description {
            font-size: 13px;
            color: #8a8a8a;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .link-share-card .footer {
            display: flex; 
            align-items: center;
            gap: 6px; 
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px; 
        }
        .link-share-card .footer-icon{
            width: 14px;
            height: 14px;
            flex-shrink: 0; 
        }
        .comment-item {
            position: relative;
            padding-right: 25px; 
        }
        .comment-delete-btn {
            position: absolute;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            width: 22px;
            height: 22px;
            line-height: 22px;
            text-align: center;
            border-radius: 50%;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0; 
        }
        .comment-item:hover .comment-delete-btn {
            opacity: 1;
        }
        .comment-delete-btn:hover {
            background-color: #f0f0f0;
            color: #ff3b30;
        }
        #phone-screen.dark-mode {
            --secondary-bg: #1c1c1e; 
            --border-color: #38383a;  
            --text-primary: #ffffff;   
            --text-secondary: #8d8d92; 
        }
        #phone-screen.dark-mode #chat-list-screen,
        #phone-screen.dark-mode #qzone-screen .qzone-content,
        #phone-screen.dark-mode #memories-view {
            background-color: #000000;
        }
        #phone-screen.dark-mode #chat-list {
            background-color: #000000;
        }
        #phone-screen.dark-mode .chat-list-item {
            border-bottom-color: rgba(255, 255, 255, 0.15);
        }
        #phone-screen.dark-mode .chat-group-header {
            background-color: #1c1c1e; 
            border-bottom: 1px solid #38383a; 
        }
        #phone-screen.dark-mode .chat-list-item .name,
        #phone-screen.dark-mode .chat-group-header .group-name {
            color: #ffffff;
        }
        #phone-screen.dark-mode .chat-list-item:hover {
            background-color: #1c1c1e;
        }
        #phone-screen.dark-mode .header,
        #phone-screen.dark-mode .qzone-header {
            background-color: rgba(25, 25, 25, 0.9);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-bottom-color: rgba(255, 255, 255, 0.15);
            color: #ffffff;
        }
        #phone-screen.dark-mode .header .back-btn,
        #phone-screen.dark-mode .header .action-btn,
        #phone-screen.dark-mode .header .save-btn {
            color: #ffffff;
        }
        #phone-screen.dark-mode #chat-list-bottom-nav {
            background-color: rgba(25, 25, 25, 0.9);
            border-top-color: rgba(255, 255, 255, 0.15);
        }
        #phone-screen.dark-mode .nav-item.active {
            color: #ffffff;
        }
        #phone-screen.dark-mode #chat-input-area {
            background-color: rgba(5, 5, 5, 0.8);
            border-top: none;
        }
        #phone-screen.dark-mode #chat-input {
            background-color: #3e3e42;
            color: #ffffff;
        }
        #phone-screen.dark-mode #chat-input::placeholder {
            color: #8d8d92;
        }
        #phone-screen.dark-mode .chat-action-icon-btn {
            color: #ffffff;
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
        }
        #phone-screen.dark-mode #send-btn {
            background-color: var(--accent-color);
        }
        #phone-screen.dark-mode .qzone-actions-bar,
        #phone-screen.dark-mode .qzone-post-item {
            background-color: #1c1c1e;
            border: 1px solid #333;
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.05);
        }
        #phone-screen.dark-mode .action-item:not(:last-child)::after {
            background-color: #333;
        }
        #phone-screen.dark-mode .post-footer,
        #phone-screen.dark-mode .post-likes-section {
            border-top-color: #333;
        }
        #phone-screen.dark-mode .post-likes-section {
            background-color: rgba(0, 123, 255, 0.1);
        }
        #phone-screen.dark-mode .comment-input {
            background-color: #333;
            color: #ffffff;
        }
        #phone-screen.dark-mode .comment-input::placeholder {
            color: #8d8d92;
        }
        #phone-screen.dark-mode .post-actions-btn:hover {
            background-color: #333;
        }
        #phone-screen.dark-mode .at-mention-popup {
            background-color: #1c1c1e;
            border-color: #333;
        }
        #phone-screen.dark-mode .at-mention-item {
            border-bottom-color: #333;
        }
        #phone-screen.dark-mode .at-mention-item:hover {
            background-color: #333;
        }
        #phone-screen.dark-mode .memory-card {
            background-color: #1c1c1e;
            border-left-color: #e6a753;
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.08);
        }
        #phone-screen.dark-mode .memory-card .header {
            background-color: #2c2c2e;
            border-bottom-color: #38383a;
            margin: -15px -15px 8px -15px;
            padding: 12px 15px;
            border-radius: 12px 12px 0 0;
        }
        #phone-screen.dark-mode .memory-card .header .date,
        #phone-screen.dark-mode .memory-card .header .author,
        #phone-screen.dark-mode .memory-card .content {
            color: #e0e0e0;
        }
        #phone-screen.dark-mode #api-settings-screen,
        #phone-screen.dark-mode #font-settings-screen,
        #phone-screen.dark-mode #wallpaper-screen,
        #phone-screen.dark-mode #contact-picker-screen,
        #phone-screen.dark-mode #member-management-screen,
        #phone-screen.dark-mode #world-book-editor-screen,
        #phone-screen.dark-mode #world-book-list,
        #phone-screen.dark-mode .list-item:hover,
        #phone-screen.dark-mode .list-container,
        #phone-screen.dark-mode .form-container {
            background-color: #000000;
        }
        #phone-screen.dark-mode .form-group input, 
        #phone-screen.dark-mode .form-group select, 
        #phone-screen.dark-mode .form-group textarea {
            background-color: #1c1c1e;
            color: #ffffff;
            border-color: #38383a;
        }
        #phone-screen.dark-mode .form-button-secondary {
            background-color: #333;
            border-color: #555;
            color: #fff;
        }
        #phone-screen.dark-mode #font-preview {
            background-color: #1c1c1e;
            border-color: #38383a;
        }
        #phone-screen.dark-mode #font-preview p {
            color: #ffffff;
        }
        #phone-screen.dark-mode .qzone-post-item .post-nickname,
        #phone-screen.dark-mode .qzone-post-item .post-content {
            color: #f0f0f0; 
        }
        #phone-screen.dark-mode .favorite-item-card .fav-card-header .name,
        #phone-screen.dark-mode .favorite-item-card .fav-card-content {
            color: #f0f0f0; 
        }
        #phone-screen.dark-mode .favorite-item-card .fav-card-header .source {
            color: #8d8d92; 
        }
        #phone-screen.dark-mode .search-bar-container {
            background-color: #000000; 
        }
        #phone-screen.dark-mode #favorites-search-input {
            background-color: #1c1c1e; 
            border-color: #38383a;     
            color: #ffffff;            
        }
        #phone-screen.dark-mode #favorites-search-input::placeholder {
            color: #8d8d92; 
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 51px;
            height: 31px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #e9e9eb; 
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 27px;
            width: 27px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        input:checked + .slider {
            background-color: #34c759; 
        }
        input:checked + .slider:before {
            transform: translateX(20px); 
        }
        #reply-preview-bar {
            display: none; 
            padding: 8px 12px;
            margin: 0 8px 8px 8px; 
            background-color: rgba(0, 0, 0, 0.05);
            border-left: 3px solid var(--accent-color);
            border-radius: 6px;
            position: relative;
            font-size: 13px;
            color: var(--text-secondary);
        }
        #phone-screen.dark-mode #reply-preview-bar {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .reply-preview-content .sender {
            font-weight: 600;
            color: var(--text-primary);
        }
        .reply-preview-content .text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: block; 
            max-width: 95%;
        }
        #cancel-reply-btn {
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            border-radius: 50%;
            background-color: rgba(0,0,0,0.1);
            cursor: pointer;
            font-size: 14px;
        }
        .quoted-message {
            padding: 6px 10px;
            margin-bottom: 6px;
            background-color: rgba(0, 0, 0, 0.04);
            border-left: 2px solid var(--accent-color);
            border-radius: 4px;
            font-size: 0.9em; 
            opacity: 0.8;
        }
        #phone-screen.dark-mode .quoted-message {
            background-color: rgba(255, 255, 255, 0.08);
            border-left-color: #a0cff1;
        }
        .quoted-message .quoted-sender {
            font-weight: 600;
            color: var(--accent-color);
        }
        #phone-screen.dark-mode .quoted-message .quoted-sender {
            color: #a0cff1;
        }
        .quoted-message .quoted-content {
            color: var(--text-secondary);
            white-space: normal;     
            word-break: break-word;  
            display: block;
        }
        #font-preview {
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: #f9f9f9; 
            transition: background-color 0.3s, border-color 0.3s;
        }
        #font-preview p {
            color: var(--text-primary);
        }
        #phone-screen.dark-mode #font-preview {
            background-color: #1c1c1e; 
            border-color: #38383a;     
        }
        #phone-screen.dark-mode #font-preview p {
            color: #ffffff;
        }
        .transfer-actions-content {
            background-color: #fff0f5; 
            border-radius: 20px;
            width: 290px;
            padding: 20px;
            box-shadow: 0 5px 25px rgba(255, 105, 180, 0.3); 
            text-align: center;
            position: relative;
            border: 1px solid #ffcce0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        .transfer-actions-header {
            font-size: 20px;
            font-weight: bold;
            color: #a35c7b; 
            margin-bottom: 15px;
        }
        .transfer-actions-body p {
            font-size: 15px;
            color: #555;
            margin: 0 0 25px 0;
            line-height: 1.5;
        }
        .transfer-actions-footer {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }
        .transfer-actions-footer .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            color: white;
        }
        .transfer-actions-footer .action-btn:active {
            transform: scale(0.95);
        }
        .transfer-actions-footer .action-btn.accept {
            background: linear-gradient(135deg, #ff85b3, #ff69b4);
            box-shadow: 0 4px 10px rgba(255, 105, 180, 0.4);
        }
        .transfer-actions-footer .action-btn.decline {
            background: linear-gradient(135deg, #c2c2c2, #a0a0a0);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        .transfer-actions-content .cancel-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            background-color: rgba(0, 0, 0, 0.1);
            color: #a35c7b;
            font-size: 20px;
            line-height: 28px;
            cursor: pointer;
        }
        .unread-count-wrapper {
            flex-shrink: 0;
            width: 40px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 20px; 
        }
        .unread-count {
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background-color: #ff3b30; 
            color: white;
            font-size: 13px;
            font-weight: 500;
            line-height: 20px;
            text-align: center;
            border-radius: 10px; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.15);
            display: none; 
            justify-content: center;
            align-items: center;
        }
        #call-history-screen {
            background-color: #f0f2f5;
        }
        .call-record-card {
            background-color: var(--secondary-bg);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border-left: 5px solid var(--accent-color);
        }
        .call-record-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        .call-record-card .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        .call-record-card .card-header .duration {
            font-weight: 500;
            color: var(--text-primary);
        }
        .call-record-card .card-body {
            display: flex;
            align-items: center;
        }
        .call-record-card .participants-avatars {
            display: flex;
            align-items: center;
        }
        .call-record-card .participant-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .call-record-card .participant-avatar:not(:first-child) {
            margin-left: -12px;
        }
        .call-record-card .participants-names {
            margin-left: 12px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 15px;
        }
        #transcript-modal-body {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 15px;
        }
        .transcript-entry {
            padding: 8px 12px;
            border-radius: 10px;
            max-width: 85%;
            line-height: 1.5;
            word-break: break-word;
        }
        .transcript-entry.user {
            background-color: #dcf8c6; 
            align-self: flex-end;
        }
        .transcript-entry.assistant {
            background-color: #ffffff;
            align-self: flex-start;
        }
        #chat-list-title {
            cursor: pointer;
        }
        .call-record-card .card-body {
            display: flex;
            flex-direction: column;
            gap: 8px; 
        }
        .call-record-card .custom-title {
            font-size: 16px;
            font-weight: 600; 
            color: var(--text-primary);
            padding-bottom: 8px; 
            border-bottom: 1px solid var(--border-color); 
            margin-bottom: 4px; 
        }
        .call-record-card .participants-info {
            display: flex;
            align-items: center;
        }
        .call-record-card .participants-names {
            margin-left: 12px;
            font-weight: 500; 
            font-size: 14px; 
            color: var(--text-secondary); 
        }
        .voice-transcript {
            font-size: 14px;         
            line-height: 1.6;        
            color: var(--text-secondary); 
            padding: 8px 12px;       
            margin-top: 6px;         
            background-color: rgba(0, 0, 0, 0.04); 
            border-radius: 6px;      
            word-break: break-word;  
            display: none;           
        }
        #phone-screen.dark-mode .voice-transcript {
            background-color: rgba(255, 255, 255, 0.1); 
        }
        .loading-spinner {
            display: none; 
            width: 16px;
            height: 16px;
            border: 2px solid rgba(0, 0, 0, 0.2);
            border-top-color: var(--accent-color); 
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 8px; 
        }
        @keyframes spin {
            to {
        transform: rotate(360deg);
            }
        }
        #shared-history-viewer-content {
            display: flex;
            flex-direction: column; 
            gap: 20px; 
            padding: 15px; 
        }
        #music-player-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 50;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 60px;
            background-color: rgba(0,0,0,0.3);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-50px);
            transition: opacity 0.4s ease-out, transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        #music-player-overlay.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .music-player-window { 
            width: 70%; 
            min-height: 420px;
            background-color: rgba(255, 255, 255, 0.6); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px); 
            border-radius: 25px; 
            box-shadow: 0 8px 32px 0 rgba(25, 25, 25, 0.37); 
            border: 1px solid rgba(255, 255, 255, 0.18); 
            padding: 25px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            color: #1f1f1f; 
            position: relative;
            justify-content: space-between;
            padding-bottom: 15px;
        }
        .music-player-top-actions {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            width: calc(100% - 30px);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .top-left-cluster {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        #music-return-btn, #music-exit-btn {
            background: none;
            border: none;
            font-size: 28px;
            font-weight: 300;
            cursor: pointer;
            color: #555;
            padding: 5px;
            line-height: 1;
        }
        #music-exit-btn {
            font-size: 24px;
            font-weight: 400;
        }
        .music-progress-bar-container {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 25px;
            margin-bottom: 10px;
        }
        .time-display {
            font-size: 11px;
            color: #888;
            width: 35px;
            text-align: center;
            flex-shrink: 0;
            font-family: 'SF Mono', 'Menlo', monospace;
        }
        .progress-bar {
            flex-grow: 1;
            height: 5px;
            background-color: #e5e5e5;
            border-radius: 2.5px;
            cursor: pointer;
        }
        .progress-bar-fill {
            width: 0%;
            height: 100%;
            background-color: #333;
            border-radius: 2.5px;
        }
        #music-lyrics-container {
            width: 100%;
            height: 192px;
            overflow: hidden;
            position: relative;
            -webkit-mask-image: linear-gradient(transparent, black 20%, black 80%, transparent);
            mask-image: linear-gradient(transparent, black 20%, black 80%, transparent);
        }
        #music-lyrics-list {
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        .lyric-line {
            padding: 4px 0;
            font-size: 14px;
            color: #666;
            text-align: center;
            line-height: 1.5;
            transition: all 0.5s ease;
            opacity: 0.7;
            transform: scale(0.95);
        }
        .lyric-line.active {
            font-size: 16px;
            color: #000;
            opacity: 1;
            transform: scale(1);
        }
        .music-player-controls-wrapper {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .music-controls {
            margin-top: 0;
        }
        #music-return-btn, #music-exit-btn, #music-playlist-btn {
            position: relative;
        }
        #music-return-btn { top: -2px; }
        #music-playlist-btn { top: -3px; }
        .playlist-item-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .playlist-action-btn {
            font-size: 18px;
            color: #888;
            cursor: pointer;
            transition: color 0.2s;
        }
        .playlist-action-btn:hover { color: #000; }
        .delete-track-btn { font-size: 24px; color: #ff3b30; }
        .delete-track-btn:hover { color: #c00; }
        .lyrics-btn { font-weight: 500; }
        .message-bubble .avatar {
            width: 34px;
            height: 34px;
            border-radius: 20%;
            object-fit: cover;
            flex-shrink: 0; 
        }
        .recalled-message-placeholder {
            align-self: center; 
            padding: 4px 12px;
            margin: 5px 0;
            background-color: rgba(0, 0, 0, 0.1);
            color: var(--text-secondary);
            font-size: 12px;
            border-radius: 10px;
            text-align: center;
            max-width: 80%;
            cursor: pointer; 
        }
        #phone-screen.dark-mode .recalled-message-placeholder {
            background-color: rgba(255, 255, 255, 0.15);
        }
        @keyframes recall-animation {
          from {
            opacity: 1;
            transform: scale(1);
          }
          to {
            opacity: 0;
            transform: scale(0.8);
          }
        }
        .message-wrapper.recalled-animation {
          animation: recall-animation 0.3s ease-out forwards;
        }
        .recalled-message-placeholder {
            white-space: nowrap; 
            display: inline-block; 
            padding: 4px 12px;
        }
        .world-book-group-container {
            border-bottom: 1px solid var(--border-color);
        }
        .world-book-group-container:first-child {
            border-top: 1px solid var(--border-color);
        }
        .world-book-group-header {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            cursor: pointer;
            background-color: #f7f7f7;
        }
        .world-book-group-header .arrow {
            font-size: 14px;
            margin-right: 8px;
            transition: transform 0.2s ease;
        }
        .world-book-group-header.collapsed .arrow {
            transform: rotate(-90deg);
        }
        .world-book-group-header .group-name {
            font-weight: 600;
            font-size: 15px;
        }
        .world-book-group-content {
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        .world-book-group-content.collapsed {
            max-height: 0;
        }
        #phone-screen.dark-mode .world-book-group-header {
            background-color: #1c1c1e;
        }
        .chat-list-item.pinned {
            background-color: #f0f2f5; 
        }
        #phone-screen.dark-mode .chat-list-item.pinned {
            background-color: #2c2c2e; 
        }
        #chat-input-area {
            display: flex;
            flex-direction: column;
            flex-shrink: 0; 
            background-color: var(--secondary-bg); 
        }
        #chat-input-actions-top {
            flex-shrink: 0; 
            padding-bottom: 8px; 
        }
        #chat-input-main-row {
            flex-shrink: 0; 
        }
        #chat-input-area {
            position: relative; 
            z-index: 20;      
            flex-shrink: 0;
            padding: 8px;
            background-color: rgba(247, 247, 247, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        #chat-at-mention-popup {
            bottom: 100%; 
            left: 8px;    
            right: 8px;   
            width: auto;  
            margin-bottom: 5px; 
        }
        #announcement-board-modal .modal-content {
            height: 70%;
            background-color: #f0f2f5;
        }
        #announcement-board-content {
            padding: 15px;
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px; 
        }
        #announcement-board-content .message-wrapper {
            max-width: 100%; 
            align-self: center;
        }
        #announcement-board-content .timestamp {
            display: none; 
        }
        .announcement-item-wrapper {
            position: relative; 
            padding: 10px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .announcement-item-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 20px;
            font-weight: bold;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            line-height: 1;
            border-radius: 50%;
        }
        .announcement-item-actions:hover {
            background-color: #f0f0f0;
        }
        .pinned-indicator {
            position: absolute;
            top: -8px;
            left: -8px;
            width: 28px;
            height: 28px;
            background-color: #ffc107;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: 2px solid white;
        }
        .reposted-content-wrapper {
            background-color: #f7f7f8;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }
        #phone-screen.dark-mode .reposted-content-wrapper {
            background-color: #2c2c2e;
            border-color: #38383a;
        }
        .reposted-content-wrapper .post-footer,
        .reposted-content-wrapper .post-feedback-icons,
        .reposted-content-wrapper .post-likes-section {
            display: none;
        }
        .reposted-content-wrapper .post-header {
            margin-bottom: 8px;
        }
        .reposted-content-wrapper .post-avatar {
            width: 32px;
            height: 32px;
        }
        .reposted-content-wrapper .post-nickname {
            font-size: 14px;
        }
        .location-share-card {
            width: 230px;
            border-radius: 10px;
            overflow: hidden; 
            background-color: var(--secondary-bg);
            border: 1px solid #f0f0f0;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            cursor: pointer; 
        }
        .card-text-area {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
        }
        .card-text-primary {
            font-size: 16px;
            font-weight: 600;
            color: #222;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .card-text-secondary {
            font-size: 12px;
            color: #a0a0a0;
        }
        .card-map-area {
            height: 100px; 
            display: flex;
            justify-content: center;
            align-items: center;
            background-size: cover;
            background-position: center;
            background-color: #FFF0F5; 
        }
        .message-bubble.user .location-share-card .card-map-area {
            background-color: #F0FFF8;
        }
        .card-pin-icon {
            font-size: 40px;
            color: #FF6B6B; 
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.4); 
        }
        @keyframes breathing-light {
            0% {
        box-shadow: 0 0 6px rgba(0, 123, 255, 0.4);
            }
            50% {
        box-shadow: 0 0 18px 4px rgba(0, 123, 255, 0.8);
            }
            100% {
        box-shadow: 0 0 6px rgba(0, 123, 255, 0.4);
            }
        }
        .chat-list-item .avatar.is-acting {
            animation: breathing-light 2s ease-in-out infinite;
            border: 1.5px solid rgba(0, 123, 255, 0.7);
        }
        .comment-sticker-btn {
            background: none;
            border: none;
            padding: 5px; 
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .comment-sticker-btn:hover {
            color: var(--text-primary); 
        }
        .comment-sticker-btn svg {
            width: 22px;
            height: 22px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        #qzone-sticker-panel {
            position: absolute; 
            width: 280px;
            height: 200px;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            z-index: 1010; 
            display: none; 
            flex-direction: column;
            overflow: hidden;
        }
        #qzone-sticker-grid {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
        }
        #qzone-sticker-grid .sticker-item {
            position: relative;
            aspect-ratio: 1 / 1;
            background-color: white;
            border-radius: 8px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        .comment-text .comment-sticker {
            max-width: 100px;  
            max-height: 100px; 
            display: block;
            background-color: transparent;
        }
        .comment-item .comment-text:has(.comment-sticker) {
            line-height: 1;
        }
        .change-frame-btn {
            padding: 6px 10px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            margin-left: 10px;
        }
        #avatar-frame-modal .modal-content {
            height: 70%;
        }
        #avatar-frame-modal .modal-body {
            padding: 0;
            display: flex;
            flex-direction: column;
        }
        .frame-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        .frame-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-weight: 500;
            cursor: pointer;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
        }
        .frame-tab.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
        }
        .frame-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
        }
        .frame-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 15px;
        }
        .frame-item {
            aspect-ratio: 1 / 1;
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            background-color: #f0f0f0;
            background-size: cover;
            background-position: center;
            padding: 5px;
            transition: all 0.2s ease;
            position: relative;
        }
        .frame-item.selected {
            border-color: var(--accent-color);
            transform: scale(1.05);
        }
        .frame-item .preview-avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        .frame-item .preview-frame {
            position: absolute;
            top: -7px;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .avatar-group {
            width: 34px;
            flex-shrink: 0; 
            position: relative;
            transition: width 0.2s ease;
        }
        .avatar-group.has-frame {
            width: 34px; 
        }
        .message-bubble .avatar {
            width: 34px;
            height: 34px;
            border-radius: 20%; 
            object-fit: cover;
        }
        .avatar-with-frame {
            position: relative; 
            width: 38px;
            height: 38px;
            margin: 0 auto;
            transition: all 0.2s ease;
        }
        .avatar-group.has-frame .avatar-with-frame {
            width: 43px;
            height: 43px;
        }
        .avatar-with-frame .avatar-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%; 
            height: 100%;
            border-radius: 50%; 
            object-fit: cover;
            z-index: 1; 
        }
        .avatar-with-frame .avatar-frame {
            position: absolute;
            width: 120%;  
            height: 120%; 
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2; 
            pointer-events: none; 
        }
.message-bubble {
    flex: 1;
    min-width: 0;
    display: flex;
    align-items: flex-start;
    gap: 12px;
    max-width: 100%;
}
.message-bubble.user { 
    flex-direction: row-reverse; 
}
.message-bubble .content {
    flex: 1;
    min-width: 0;
    overflow-wrap: break-word; 
    word-wrap: break-word;     
    position: relative;
    font-size: var(--chat-font-size, 16px);
    padding: 8px 12px;
    line-height: 1.5;
}
.message-bubble .avatar-group {
    flex-shrink: 0 !important;
}
        #chat-interface-screen .message-bubble .avatar-group.has-frame .avatar-with-frame {
            width: 34px !important;
            height: 34px !important;
        }
        #chat-interface-screen .message-bubble .avatar-with-frame .avatar-img {
            width: 100% !important;
            height: 100% !important;
        }
        .message-bubble.is-link-share .content,
        .message-bubble.is-transfer .content,
        .message-bubble.is-waimai-request .content,
        .message-bubble.is-red-packet .content,
        .message-bubble.is-poll .content,
        .message-bubble.is-location-share .content,
        .message-bubble.is-sticker .content,
        .message-bubble.is-ai-image .content {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #chat-list-screen .avatar-frame {
            display: none;
        }
        #chat-list-screen .avatar-group {
            width: 45px;
            height: 45px;
        }
        #chat-list-screen .avatar-group.has-frame .avatar-with-frame,
        #chat-list-screen .avatar-group.has-frame .avatar-img {
            width: 45px;
            height: 45px;
        }
        #chat-list-screen .avatar-img,
        #chat-list-screen .avatar {
            border-radius: 50%;
        }
        #chat-list .chat-list-item .avatar-group {
            margin-right: 15px !important; 
        }
        #chat-list .chat-list-item .avatar {
            margin-right: 0; 
        }
        .comment-item {
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px; 
            padding: 4px 6px; 
            margin: 0 -6px; 
            border-radius: 4px;
        }
        .comment-item:hover {
            background-color: #f0f2f5;
        }
        #phone-screen.dark-mode .comment-item:hover {
            background-color: #2c2c2e;
        }
        .comment-item .comment-text {
            flex-grow: 1; 
            word-break: break-word; 
        }
        .legacy-comment-item {
            line-height: 1.5;
            padding: 4px 6px; 
            color: var(--text-secondary); 
        }
        .message-bubble.is-link-share .content,
        .message-bubble.is-transfer .content,
        .message-bubble.is-waimai-request .content,
        .message-bubble.is-red-packet .content,
        .message-bubble.is-poll .content,
        .message-bubble.is-location-share .content,
        .message-bubble.is-sticker .content,
        .message-bubble.is-ai-image .content {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #chat-interface-screen .message-bubble .avatar-group.has-frame .avatar-with-frame {
            width: 34px !important;
            height: 34px !important;
        }
        #chat-interface-screen .message-bubble .avatar-with-frame .avatar-img {
            width: 100% !important;
            height: 100% !important;
        }
        .message-bubble.is-sticker,
        .message-bubble.is-voice-message,
        .message-bubble.is-transfer,
        .message-bubble.is-ai-image,
        .message-bubble.is-waimai-request,
        .message-bubble.is-red-packet,
        .message-bubble.is-poll,
        .message-bubble.is-link-share,
        .message-bubble.is-location-share {
            flex: initial; 
            min-width: auto; 
        }
        .message-bubble.is-sticker .content,
        .message-bubble.is-voice-message .content,
        .message-bubble.is-transfer .content,
        .message-bubble.is-ai-image .content,
        .message-bubble.is-waimai-request .content,
        .message-bubble.is-red-packet .content,
        .message-bubble.is-poll .content,
        .message-bubble.is-link-share .content,
        .message-bubble.is-location-share .content {
            flex: initial; 
            padding: 0;
            background: transparent;
            box-shadow: none;
            border: none;
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
        }
        #announcement-board-content .message-wrapper {
            align-self: flex-start !important;
        }
        #announcement-board-content .message-bubble.user {
            flex-direction: row !important;
        }
        #announcement-board-content .message-wrapper.user {
            flex-direction: row !important;
        }
        #chat-interface-screen > .header {
            position: absolute !important; 
            top: 0;
            left: 0;
            width: 100%;
            z-index: 100 !important; 
        }
        #chat-interface-screen #chat-messages {
            margin-top: 0 !important; 
        }
        #music-player-overlay {
            z-index: 200 !important;
        }
        #chat-interface-screen {
            position: relative !important;
            height: 100%;
            width: 100%;
            overflow: hidden; 
        }
        #chat-interface-screen > .header {
            position: absolute !important;
            top: 0;
            left: 0;
            right: 0; 
            width: auto !important; 
            z-index: 100 !important; 
        }
        #chat-interface-screen #chat-input-area {
            position: absolute !important;
            bottom: 0;
            left: 0;
            right: 0;
            width: auto !important;
            z-index: 100 !important;
            padding-bottom: calc(8px + env(safe-area-inset-bottom)); 
        }
        #chat-interface-screen #chat-messages {
            height: 100% !important; 
            width: 100% !important;
            overflow-y: auto !important; 
            box-sizing: border-box !important; 
            margin-top: 0 !important; 
            padding-top: calc(120px + env(safe-area-inset-top)) !important; 
            padding-bottom: calc(120px + env(safe-area-inset-bottom)) !important;
        }
        .post-deleted-placeholder {
            align-self: center;
            padding: 4px 12px;
            margin: 5px 0;
            background-color: rgba(0, 0, 0, 0.1);
            color: var(--text-secondary);
            font-size: 12px;
            border-radius: 10px;
            text-align: center;
            max-width: 80%;
            cursor: pointer; 
        }
        #phone-screen.dark-mode .post-deleted-placeholder {
            background-color: rgba(255, 255, 255, 0.15);
        }
        .spoiler {
            background-color: #333; 
            color: #333;           
            padding: 0 4px;         
            border-radius: 4px;     
            cursor: pointer;        
            transition: all 0.2s ease-in-out; 
        }
        .spoiler:hover, .spoiler:active {
            background-color: #e0e0e0; 
            color: inherit;           
        }
        .memory-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px; 
            border-radius: 50%; 
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .memory-action-btn svg {
            width: 18px;  
            height: 18px;
            stroke: var(--text-secondary); 
            transition: stroke 0.2s;
        }
        .memory-action-btn:hover {
            background-color: #e9ecef; 
        }
        #phone-screen.dark-mode .memory-action-btn:hover {
            background-color: #38383a;
        }
        .memory-action-btn.edit-memory-btn:hover svg {
            stroke: var(--accent-color);
        }
        .memory-action-btn.delete-memory-btn:hover svg {
            stroke: #ff3b30;
        }
        #sticker-grid.management-mode .sticker-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 3px solid transparent;
            border-radius: 10px;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }
        #sticker-grid.management-mode .sticker-item.selected::after {
            border-color: var(--accent-color);
        }
        #sticker-grid.management-mode .sticker-item .delete-btn {
            display: block;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: 1px solid white;
        }
        #sticker-action-bar {
            display: none; 
            padding: 10px 15px;
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
            background-color: rgba(247, 247, 247, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
        }
        #sticker-action-bar button {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            background-color: #ff3b30;
            color: white;
        }
        #ai-response-editor-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .ai-response-editor-block {
            background-color: #f9f9f9;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
        }
        .ai-response-editor-block textarea {
            width: 100%;
            min-height: 80px; 
            resize: vertical;
            border: 1px solid #ccc;
            border-radius: 6px;
            padding: 8px;
            font-size: 14px; 
            font-family: monospace; 
            box-sizing: border-box;
        }
        .ai-response-editor-block .format-helpers {
            margin-top: 8px;
            margin-bottom: 0; 
        }
        .ai-response-editor-block .delete-block-btn {
            float: right;
            margin-top: -5px;
            background: none;
            border: none;
            color: #ff3b30;
            font-size: 20px;
            cursor: pointer;
        }
        #phone-screen.dark-mode .ai-response-editor-block {
            background-color: #2c2c2e;
            border-color: #38383a;
        }
        #phone-screen.dark-mode .ai-response-editor-block textarea {
            background-color: #1c1c1e;
            color: #f0f0f0;
            border-color: #4a4a4e;
        }
.offline-dialogue {
    font-weight: 500;
}
.offline-description {
    display: block; 
    color: inherit; 
    font-style: normal; 
    margin-top: 4px; 
    white-space: pre-wrap; 
    line-height: 1.6;
}
.offline-description em {
    color: var(--text-secondary); 
}
#phone-screen.dark-mode .offline-description {
    color: inherit; 
}
        .message-bubble .content {
            transition: background-color 0.5s ease-out;
        }
        .message-bubble.highlighted .content {
            background-color: rgba(0, 123, 255, 0.2) !important;
        }
        #gomoku-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 350px;
            z-index: 50;
            pointer-events: none; 
            overflow: hidden;     
            display: none;        
        }
        #gomoku-content-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: transparent !important;
            backdrop-filter: none !important;
            box-shadow: none !important;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            box-sizing: border-box;
            transition: transform 0.3s ease-out;
            transform: translateY(-100%);
            pointer-events: auto;
        }
        #phone-screen.dark-mode #gomoku-content-wrapper {
            background-color: rgba(28, 28, 30, 0.9);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        #gomoku-overlay.visible #gomoku-content-wrapper {
            transform: translateY(0);
        }
        #chat-messages {
            transition: padding-top 0.3s ease-out;
        }
        #gomoku-board {
            background-color: #e4b591;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            cursor: pointer;
        }
        #gomoku-controls {
            width: 100%;
            text-align: center;
            flex-shrink: 0;
        }
        #close-gomoku-btn {
            padding: 6px 15px;
            border-radius: 15px;
            border: 1px solid var(--text-secondary);
            background-color: rgba(255,255,255,0.5);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 13px;
        }
        #phone-screen.dark-mode #close-gomoku-btn {
            background-color: rgba(0,0,0,0.2);
            border-color: var(--text-secondary);
        }
        #gomoku-overlay {
            pointer-events: none;
        }
        #gomoku-board,
        #gomoku-controls {
            pointer-events: auto;
        }
        #product-grid {
            flex-grow: 1; 
            overflow-y: auto; 
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            padding: 10px;
            padding-bottom: 80px;
        }
        .product-item {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
            display: flex;         
            flex-direction: column;
            cursor: pointer;
            position: relative;
        }
        .product-image {
            width: 100%;
            aspect-ratio: 1 / 1;
            object-fit: cover;
        }
        .product-info {
            padding: 12px 10px;
            flex-grow: 1;      
            display: flex;
            flex-direction: column;
        }
        .product-name {
            font-size: 13px;
            color: #333;
            line-height: 1.4;
            min-height: 36px;
        }
        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;      
        }
        .product-price {
            font-size: 16px;
            font-weight: 700;
            color: #ff5722;
        }
        .product-price::before { content: '¥'; font-size: 12px; }
        .add-to-cart-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 15px;
            background: linear-gradient(90deg, #ff9800, #ff5722);
            color: white;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
        }
        .product-management-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
            z-index: 7;
        }
        .product-management-overlay button {
            padding: 8px 20px;
            border: 1px solid white;
            background-color: rgba(255,255,255,0.2);
            color: white;
            border-radius: 15px;
            cursor: pointer;
        }
        .product-management-overlay .delete-product-btn {
            border-color: #ff8a80;
            color: #ff8a80;
        }
        #shopping-screen.management-mode .product-footer {
            display: none;
        }
        #cart-title {
            position: static;
            transform: none;
        }
        #cart-items-list { padding: 10px; display: flex; flex-direction: column; gap: 10px; }
        .cart-item {
            display: flex; align-items: flex-start; gap: 12px; background-color: white;
            padding: 12px; border-radius: 12px;
        }
        .cart-item-checkbox { margin-top: 28px; }
        .cart-item-image { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; flex-shrink: 0; }
        .cart-item-info { flex-grow: 1; display: flex; flex-direction: column; }
        .cart-item-name { font-weight: 500; font-size: 14px; line-height: 1.4; }
        .cart-item-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 10px;}
        .cart-item-price { color: #ff5722; font-weight: bold; font-size: 16px; }
        .quantity-control { display: flex; align-items: center; gap: 4px; }
        .quantity-btn {
            width: 26px; height: 26px; border: none; background-color: #f7f8fa;
            border-radius: 4px; font-weight: 500; cursor: pointer; color: #666;
        }
        .quantity-display { font-weight: 500; min-width: 30px; text-align: center; }
        #cart-footer {
            position: absolute; bottom: 0; left: 0; width: 100%; display: flex;
            justify-content: space-between; align-items: center; padding: 10px 15px;
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
            background-color: white; border-top: 1px solid var(--border-color); box-sizing: border-box;
        }
        #cart-footer .select-all-label { display: flex; align-items: center; gap: 5px; }
        #cart-footer .cart-summary { text-align: right; }
        #cart-footer .cart-subtext { font-size: 11px; color: #999; }
        #checkout-btn {
            padding: 10px 25px; border: none; border-radius: 20px;
            background: linear-gradient(90deg, #ff9800, #ff5722);
            color: white; font-size: 15px; font-weight: 500; cursor: pointer;
        }
        .gift-card {
            width: 220px; 
            box-sizing: border-box; 
            border-radius: 12px; 
            background-color: var(--secondary-bg); 
            border: 1px solid #eee; 
            padding: 12px;
            cursor: pointer; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
        }
        .gift-header { display: flex; align-items: center; gap: 8px; padding-bottom: 8px; border-bottom: 1px solid #f0f0f0; }
        .gift-header-icon { width: 20px; height: 20px; color: #ff9800; }
        .gift-header-text { font-size: 15px; font-weight: 600; color: var(--text-primary); }
        .gift-items-preview { padding: 12px 0; display: flex; flex-direction: column; gap: 8px; }
        .gift-preview-item { display: flex; align-items: center; gap: 8px; }
        .gift-preview-img { width: 32px; height: 32px; object-fit: cover; border-radius: 4px; flex-shrink: 0; }
        .gift-preview-name { flex-grow: 1; font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .gift-preview-quantity { font-size: 12px; color: var(--text-secondary); }
        .gift-footer { font-size: 12px; color: var(--text-secondary); text-align: right; }
        #gift-receipt-body { font-family: 'Helvetica Neue', Arial, sans-serif; padding: 15px; background-color: #f7f8fa; }
        .receipt-header { text-align: center; padding-bottom: 15px; border-bottom: 1px solid #ddd; }
        .receipt-header h3 { margin: 0 0 5px 0; font-size: 20px; }
        .receipt-header p { margin: 0; font-size: 12px; color: #888; }
        .receipt-items-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .receipt-items-table th, .receipt-items-table td { padding: 10px 5px; font-size: 13px; }
        .receipt-items-table thead th { border-bottom: 1px solid #333; text-align: left; }
        .receipt-items-table .item-name { width: 50%; }
        .receipt-items-table .item-qty { text-align: center; }
        .receipt-items-table .item-price, .receipt-items-table .item-subtotal { text-align: right; }
        .receipt-total { padding-top: 15px; border-top: 1px solid #333; text-align: right; font-size: 16px; font-weight: bold; }
        .receipt-footer { text-align: center; margin-top: 25px; font-size: 12px; color: #888; }
        .product-item {
            position: relative; 
        }
.product-management-overlay {
    position: absolute;
    bottom: 0; 
    left: 0;
    width: 100%;
    background-color: rgba(0,0,0,0.6); 
    display: none; 
    justify-content: center; 
    align-items: center;
    gap: 15px; 
    padding: 10px 0; 
    border-radius: 0 0 8px 8px; 
    z-index: 5; 
    transition: opacity 0.2s;
}
        #shopping-screen.management-mode .product-management-overlay {
            display: flex; 
        }
        .product-management-overlay button {
            padding: 8px 20px;
            border: 1px solid white;
            background-color: rgba(255,255,255,0.2);
            color: white;
            border-radius: 15px;
            cursor: pointer;
        }
        .product-management-overlay .delete-product-btn {
            border-color: #ff8a80;
            color: #ff8a80;
        }
        #shopping-screen.management-mode .add-to-cart-btn {
            display: none;
        }
        .message-bubble.is-card-like {
            flex: initial; 
            min-width: auto; 
        }
        .message-bubble.is-card-like .content {
            flex: initial; 
            padding: 0;
            background: transparent;
        }
        #go-to-cart-btn {
            display: flex;
            align-items: center; 
            gap: 4px; 
        }
        #gift-recipient-list .contact-picker-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }
        #gift-recipient-list .contact-picker-item:last-child {
            border-bottom: none;
        }
        #gift-recipient-list .contact-picker-item .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-radius: 50%;
            margin-right: 15px;
            transition: all 0.2s ease;
        }
        #gift-recipient-list .contact-picker-item.selected .checkbox {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }
        #gift-recipient-list .contact-picker-item .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
        }
        #gift-recipient-list .contact-picker-item .name {
            font-weight: 500;
        }
        #ai-heart-rate-display {
            display: none !important;
        }
        #global-lyrics-bar {
            position: absolute;
            z-index: 20;
            display: flex;
            align-items: center;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            background-color: rgba(0, 0, 0, 0.05);
            padding: 4px 12px;
            border-radius: 12px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease, top 0.3s ease, bottom 0.3s ease, left 0.3s ease, right 0.3s ease, transform 0.3s ease;
            pointer-events: none;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 65%;
        }
        #phone-screen.dark-mode #global-lyrics-bar {
            color: #a0a0a0;
            background-color: rgba(255, 255, 255, 0.1);
        }
        #global-lyrics-bar.visible {
            opacity: 1;
            visibility: visible;
        }
        #phone-screen.dark-mode #global-lyrics-bar {
            color: #a0a0a0;
            background-color: rgba(255, 255, 255, 0.1);
        }
        #world-book-screen {
            background-color: #f0f2f5;
            display: flex; 
            flex-direction: column;
        }
        #phone-screen.dark-mode #world-book-screen {
            background-color: #000000;
        }
        #world-book-tabs {
            display: flex;
            overflow-x: auto; 
            padding: 10px 15px 0 15px;
            flex-shrink: 0; 
            border-bottom: 1px solid var(--border-color);
            background-color: var(--secondary-bg);
            -ms-overflow-style: none;  
            scrollbar-width: none;  
        }
        #world-book-tabs::-webkit-scrollbar {
            display: none; 
        }
        .world-book-tab {
            padding: 8px 16px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            margin-bottom: -1px; 
            transition: all 0.2s ease-in-out;
            white-space: nowrap; 
        }
        .world-book-tab.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
            font-weight: 600;
        }
        #phone-screen.dark-mode .world-book-tab.active {
            color: #ffffff;
        }
        #world-book-content-container {
            flex-grow: 1;
            overflow-y: auto;
        }
        .world-book-category-pane {
            display: none; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 15px;
            padding: 15px;
        }
        .world-book-category-pane.active {
            display: grid;
        }
.world-book-card {
    background-color: var(--secondary-bg);
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    display: flex;
    flex-direction: column;
    gap: 8px;
    min-width: 0;
    word-break: break-all;
}
        .world-book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.12);
        }
        #phone-screen.dark-mode .world-book-card {
            box-shadow: 0 2px 8px rgba(255,255,255,0.05);
        }
        .world-book-card .card-title {
            font-weight: 600;
            font-size: 15px;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis; 
        }
        .world-book-card .card-content-preview {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3; 
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        #rendering-rules-screen {
            background-color: #f0f2f5;
            display: flex; 
            flex-direction: column;
        }
        #phone-screen.dark-mode #rendering-rules-screen {
            background-color: #000000;
        }
        #rules-tabs {
            display: flex;
            overflow-x: auto;
            padding: 10px 15px 0 15px;
            flex-shrink: 0;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--secondary-bg);
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #rules-tabs::-webkit-scrollbar {
            display: none;
        }
        .rules-tab {
            padding: 8px 16px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            transition: all 0.2s ease-in-out;
            white-space: nowrap;
        }
        .rules-tab.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
            font-weight: 600;
        }
        #phone-screen.dark-mode .rules-tab.active {
            color: #ffffff;
        }
        #rules-content-container {
            flex-grow: 1;
            overflow-y: auto;
        }
        .rules-category-pane {
            display: none; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 15px;
            padding: 15px;
        }
        .rules-category-pane.active {
            display: grid;
        }
        .rule-card {
            background-color: var(--secondary-bg);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            gap: 8px; 
            border-left: 5px solid #6c757d; 
        }
        .rule-card.enabled {
            border-left-color: #28a745; 
        }
        .rule-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.12);
        }
        #phone-screen.dark-mode .rule-card {
            box-shadow: 0 2px 8px rgba(255,255,255,0.05);
        }
        .rule-card .card-title {
            font-weight: 600;
            font-size: 15px;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .rule-card .card-content-preview {
            font-size: 12px;
            font-family: monospace; 
            color: var(--text-secondary);
            background-color: #f0f2f5;
            padding: 5px 8px;
            border-radius: 4px;
            word-break: break-all;
        }
        #phone-screen.dark-mode .rule-card .card-content-preview {
            background-color: #2c2c2e;
        }
        .control-btn.regenerate-btn {
            background-color: rgba(255, 255, 255, 0.2);
            background-size: 55%; 
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 11A8.1 8.1 0 0 0 4.5 9M4 5v4h4"/><path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"/></svg>');
        }
        .control-btn.propel-btn {
            background-color: rgba(255, 255, 255, 0.2);
            background-size: 55%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 19 22 12 13 5 13 19"></polygon><polygon points="2 19 11 12 2 5 2 19"></polygon></svg>');
        }
.message-bubble.is-raw-html .content {
    padding: 0 !important; 
    background: transparent !important; 
    border: none !important; 
    box-shadow: none !important; 
}
#phone-screen {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    -webkit-touch-callout: none;
}
#home-screen #clock-container,
#home-screen #app-grid,
#home-screen #home-widgets-container {
    display: none !important;
}
#home-screen {
    background: linear-gradient(135deg, #6DD5FA, #2980B9);
    background-size: cover;
    background-position: center;
    padding: 20px;
    padding-top: calc(20px + env(safe-area-inset-top));
    padding-bottom: calc(20px + env(safe-area-inset-bottom));
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: space-between; 
    align-items: center;
    height: 100%;
}
#main-content-area {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 30px; 
    align-items: center;
    margin-top: 20px; 
}
#profile-widget {
    position: relative; 
    width: 100%;
    max-width: 380px;
    flex-shrink: 0;
}
#profile-banner-img {
    display: block; 
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 24px 24px 0 0; 
    position: relative;
    z-index: 1; 
}
#profile-widget .profile-avatar-container {
    position: absolute;
    top: 80px; 
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background-color: white; 
    padding: 4px; 
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 3; 
}
#profile-avatar-img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
}
#profile-widget .profile-info {
    background-color: rgba(255, 255, 255, 0.9);
    border-radius: 24px;
    margin-top: -24px; 
    padding-top: 44px; 
    min-height: 120px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding-left: 15px;
    padding-right: 15px;
    padding-bottom: 15px;
    text-align: center;
    color: #1c1c1e;
    position: relative;
    z-index: 2; 
}
#profile-widget::before {
    display: none !important;
}
#profile-avatar-img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
}
#profile-widget::before {
    display: none !important;
}
#profile-avatar-img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
}
#profile-username { font-size: 18px; font-weight: 600; margin: 0 0 2px 0; }
#profile-sub-username { font-size: 13px; color: #8a8a8a; margin: 0 0 10px 0; }
#profile-bio { font-size: 14px; margin: 0 0 12px 0; color: #333; }
#profile-location {
    font-size: 12px; color: #8a8a8a; margin: 0 auto; display: inline-flex;
    align-items: center; gap: 4px; background-color: rgba(0,0,0,0.05);
    padding: 3px 9px; border-radius: 10px;
}
#desktop-layout {
    display: grid;
    grid-template-columns: 1fr 1.1fr;
    gap: 20px;
    width: 100%;
    align-items: start;
}
#desktop-widget-column {
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.widget-header {
    font-size: 14px;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.8);
    margin: 0 0 5px 5px;
}
.desktop-widget {
    background-color: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 18px;
    padding: 12px 15px;
    color: #1f1f1f; 
    font-weight: 500;
    font-size: 13px;
    display: flex;
    align-items: center;
}
.desktop-widget.text-only {
    background-color: transparent; 
    border: none;                  
    padding: 0;                    
    box-shadow: none;              
}
.desktop-widget.icon-left { justify-content: flex-start; gap: 10px; }
.desktop-widget.icon-right {
    justify-content: flex-end; 
    gap: 10px;                 
}
.desktop-widget img { width: 28px; height: 28px; border-radius: 50%; object-fit: cover; }
.desktop-widget p, .desktop-widget span { margin: 0; }
#desktop-app-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 25px;
    align-content: start;
}
#desktop-dock {
    background-color: rgba(255, 255, 255, 0.15);
    border-radius: 20px;
    padding: 15px 25px;
    display: flex;
    justify-content: center;
    gap: 30px;
    width: fit-content;
    flex-shrink: 0;
    margin-bottom: calc(20px + env(safe-area-inset-bottom));
}
.desktop-app-icon {
    display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer; text-align: center;
}
.icon-bg-desktop {
    width: 55px; height: 55px; border-radius: 14px; background-color: #f0f2f5; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform 0.2s ease; overflow: hidden;
}
.icon-bg-desktop img {
    width: 100%; height: 100%; object-fit: cover; border-radius: 0;
}
.desktop-app-icon .label {
    color: #333; font-size: 13px; font-weight: 500;
}
.desktop-app-icon:active .icon-bg-desktop {
    transform: scale(0.9);
}
.editable-text:hover, .editable-image:hover {
    outline: 2px dashed rgba(255, 255, 255, 0.8);
    cursor: pointer;
    opacity: 0.9;
}
.editable-text, .editable-image {
    cursor: pointer;
    transition: all 0.2s ease-in-out;
}
.editable-text:hover, .editable-image:hover {
    outline: 2px dashed rgba(255, 255, 255, 0.8);
    opacity: 0.9;
    border-radius: 4px; 
}
#profile-widget .profile-info {
    background: transparent !important;
    position: relative;
    z-index: 1; 
}
#profile-widget .profile-info::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(255, 255, 255, 0.9);
    border-radius: 24px;
    mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
    z-index: -1;
}
#chat-settings-screen {
    display: flex;
    flex-direction: column;
    background-color: #f0f2f5; 
}
#phone-screen.dark-mode #chat-settings-screen {
     background-color: #000000; 
}
#chat-settings-screen .form-container {
    flex-grow: 1;      
    overflow-y: auto;  
    padding-top: 100px;  
    margin-top: -80px;   
}
.search-result-item {
    display: flex;
    flex-direction: column;
    padding: 12px 18px;
    border-bottom: 1px solid var(--border-color);
    cursor: pointer;
    transition: background-color 0.2s;
}
.search-result-item:hover {
    background-color: rgba(0, 0, 0, 0.1);
}
#phone-screen.dark-mode .search-result-item:hover {
    background-color: rgba(255, 255, 255, 0.1);
}
.search-result-item .title {
    font-weight: 500;
    font-size: 15px;
    color: var(--text-primary);
}
.search-result-item .artist {
    font-size: 12px;
    color: var(--text-secondary);
    margin-top: 4px;
}
.search-result-item .source {
    font-size: 10px;
    color: var(--accent-color);
    background-color: rgba(0, 123, 255, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: bold;
    margin-left: 8px;
}
#music-player-cover {
    width: 180px;
    height: 180px;
    border-radius: 15px;
    object-fit: cover;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    margin-bottom: 25px; 
    transition: opacity 0.5s ease-in-out; 
}
#music-visual-container {
    position: relative;
    width: 220px;
    height: 220px;
    margin-bottom: 25px;
    cursor: pointer;
}
#vinyl-view, #inline-lyrics-view {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: opacity 0.5s ease, transform 0.5s ease;
}
#vinyl-view {
    background-color: #222;
    border-radius: 50%;
    padding: 18px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3), 
                inset 0 0 0 2px rgba(255, 255, 255, 0.05);
    background-image: repeating-radial-gradient(circle, #333, #333 1px, #222 1px, #222 2px);
    box-sizing: border-box;
}
#vinyl-view #music-player-cover {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
    margin: 0; 
}
#inline-lyrics-view {
    opacity: 0;
    transform: scale(1.1);
    pointer-events: none;
    padding: 10px;
    box-sizing: border-box;
}
#music-visual-container.lyrics-active #vinyl-view {
    opacity: 0;
    transform: scale(0.9);
}
#music-visual-container.lyrics-active #inline-lyrics-view {
    opacity: 1;
    transform: scale(1);
    pointer-events: auto;
}
#inline-lyrics-view #music-lyrics-container {
    width: 100%;
    height: 100%;
}
#music-info-top {
    text-align: center; 
    flex-shrink: 0;
    margin-bottom: 20px; 
}
#music-player-song-title,
#music-player-artist,
#music-time-counter {
    margin-bottom: 5px; 
}
#music-visual-container {
    margin-bottom: 15px; 
}
@keyframes spin-vinyl {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}
#vinyl-view.spinning {
  animation: spin-vinyl 12s linear infinite;
}
#single-lyric-display {
    height: 40px;          
    line-height: 40px;     
    width: 100%;           
    margin-top: 15px;      
    text-align: center;    
    font-size: 14px;       
    color: #333;           
    font-weight: 500;      
    transition: opacity 0.3s ease; 
    white-space: nowrap;           
    overflow: hidden;              
    text-overflow: ellipsis;       
}
#music-visual-container.lyrics-active + #single-lyric-display {
    display: none;
}
#character-profile-modal {
    background-color: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}
.character-profile-content {
    width: 320px;
    height: 75vh;
    max-height: 580px;
    background-color: #f0f2f5;
    border-radius: 20px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    display: flex;
    flex-direction: column;
    position: relative;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
     overflow: visible; 
    padding-top: 40px; 
}
.profile-history-icon-btn { /* <--- 核心修改1：从 ID (#) 改为类 (.) */
    /* 核心修改2：移除了 position, top, right, z-index 这些绝对定位属性 */
    width: 36px;
    height: 36px;
    background: none;
    border: none;
    cursor: pointer;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s;
    padding: 0;
}
#profile-history-icon-btn:hover { background-color: rgba(0,0,0,0.05); }
.profile-history-icon-btn svg { width: 20px; height: 20px; stroke: #b0b0b0; stroke-width: 2; }
#profile-main-content, #profile-thoughts-history-view {
    display: flex;
    flex-direction: column;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
}
#profile-main-content {
    padding: 0 25px 25px 25px; 
    gap: 20px; 
    flex-grow: 1;
    overflow-y: auto;
}
.profile-header {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-shrink: 0;
    margin-bottom: 10px; 
}
#profile-avatar { width: 60px; height: 60px; border-radius: 12px; object-fit: cover; }
.profile-info { display: flex; flex-direction: column; }
#profile-name { font-size: 20px; font-weight: 600; color: #1f1f1f; }
#profile-id { font-size: 14px; color: #8a8a8a; }
.profile-section {
    background-color: #ffffff; 
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.06); 
    display: flex;
    flex-direction: column;
    gap: 12px; 
    flex-shrink: 0;
}
.profile-section-header {
    display: flex;
    align-items: center;
    gap: 10px; 
    padding-bottom: 12px;
    border-bottom: 1px solid #f0f0f0; 
}
.profile-section-icon {
    font-size: 20px;
    opacity: 0.5;
}
.profile-section label {
    font-size: 15px;
    font-weight: 600;
    color: #555; 
    margin: 0; 
}
.profile-section p {
    font-size: 15px;
    color: #333;
    line-height: 1.7;
    margin: 0;
    white-space: pre-wrap;
}
#profile-thoughts-history-view { display: none; padding: 0 25px 25px 25px; }
#profile-thoughts-history-view .profile-header { justify-content: space-between; padding-bottom: 15px; }
#profile-thoughts-history-view .profile-header span { font-size: 18px; font-weight: 600; }
#history-back-btn { width: 36px; height: 36px; background: none; border: none; cursor: pointer; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s; padding: 0; }
#history-back-btn:hover { background-color: rgba(0,0,0,0.05); }
#history-back-btn svg { width: 22px; height: 22px; stroke: #a0a0a0; stroke-width: 2.5; }
#thoughts-history-list {
    flex-grow: 1;
    overflow-y: auto;
    padding-right: 5px;
    margin-right: -10px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}
.thought-card { background-color: #ffffff; border-radius: 16px; padding: 15px 20px; border: 1px solid #eee; }
.thought-header { font-size: 12px; color: #b0b0b0; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #f0f0f0; }
.thought-content .label { display: flex; align-items: center; gap: 6px; font-weight: 600; color: #a0a0a0; font-size: 13px; margin-bottom: 6px; }
.thought-content .label svg { width: 16px; height: 16px; }
.thought-content .text { font-size: 14px; color: #555; line-height: 1.7; white-space: pre-wrap; padding-left: 22px; }
.thought-content .jottings { margin-top: 15px; }
#profile-main-content::-webkit-scrollbar,
#thoughts-history-list::-webkit-scrollbar { display: none; }
#profile-main-content, #thoughts-history-list { -ms-overflow-style: none; scrollbar-width: none; }
.character-profile-content {
    background-color: #ffffff !important;
}
#character-profile-modal .jottings .label {
    display: none;
}
#character-profile-modal .thought-content .text {
    padding-left: 0;
}
#qzone-more-actions-btn {
    font-size: 24px;      
    font-weight: bold;    
    padding: 0 10px;      
    border-radius: 50%;   
    line-height: 1;       
    position: relative;
    top: -2px;            
    transition: background-color 0.2s;
}
#qzone-more-actions-btn:hover {
    background-color: rgba(0,0,0,0.05); 
}
#phone-screen.dark-mode #qzone-more-actions-btn:hover {
    background-color: rgba(255,255,255,0.1);
}
#clear-posts-list {
    overflow-y: auto; 
    flex-grow: 1;
}
.clear-posts-item {
    display: flex;
    align-items: center;
    padding: 12px 18px;
    cursor: pointer;
    border-bottom: 1px solid var(--border-color);
    transition: background-color 0.2s;
}
.clear-posts-item:hover {
    background-color: #f5f5f5;
}
.clear-posts-item .checkbox {
    width: 22px;
    height: 22px;
    border: 2px solid #ccc;
    border-radius: 50%;
    margin-right: 15px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}
.clear-posts-item.selected .checkbox {
    background-color: var(--accent-color);
    border-color: var(--accent-color);
}
.clear-posts-item.selected .checkbox::after {
    content: '✔';
    font-size: 14px;
    font-weight: bold;
}
.clear-posts-item .name {
    font-weight: 500;
}
.clear-posts-item.danger-option .name {
    color: #ff3b30;
    font-weight: 600;
}
.thought-card {
    position: relative; 
}
.thought-delete-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 26px;
    height: 26px;
    border-radius: 50%;
    border: none;
    background-color: rgba(0,0,0,0.05);
    color: var(--text-secondary);
    font-size: 20px;
    line-height: 26px;
    text-align: center;
    cursor: pointer;
    opacity: 0; 
    transition: all 0.2s ease-in-out;
}
.thought-card:hover .thought-delete-btn {
    opacity: 1;
}
.thought-delete-btn:hover {
    background-color: #ff3b30;
    color: white;
}
.search-result-item {
    display: flex;       
    align-items: center; 
    padding: 12px 18px;
    border-bottom: 1px solid var(--border-color);
    cursor: pointer;
    transition: background-color 0.2s;
}
.search-result-item:hover {
    background-color: rgba(0, 0, 0, 0.05);
}
#phone-screen.dark-mode .search-result-item:hover {
    background-color: rgba(255, 255, 255, 0.1);
}
.search-result-item .search-result-info {
    flex-grow: 1;
    pointer-events: none; 
}
.search-result-item .music-search-checkbox {
    width: 20px;
    height: 20px;
    margin-right: 15px;
    flex-shrink: 0;
}
#music-search-results-modal .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
#music-search-results-modal .modal-footer {
    display: flex;
    justify-content: space-around;
}
#music-search-results-modal .modal-footer button {
    width: 45%; 
}
.bg-upload-container {
    width: 100%;
    justify-content: center;
    gap: 15px; 
}
.bg-upload-container .form-button-secondary {
    flex-grow: 1; 
    flex-basis: 0; 
    max-width: 180px; 
    margin-top: 0;
    padding: 12px; 
    font-size: 15px;
    font-weight: 600; 
    border-radius: 8px; 
    border: none; 
    background-color: #e9e9eb; 
    color: #1c1c1e; 
    cursor: pointer;
    transition: background-color 0.2s, transform 0.1s;
}
.bg-upload-container .form-button-secondary:active {
    transform: scale(0.98); 
}
#remove-global-bg-btn {
    background-color: #ffebee;
    color: #c62828;
}
#character-profile-modal .character-profile-content {
    position: relative; 
    overflow: visible;  
    padding-bottom: 35px; 
}
#character-profile-modal .character-profile-content::before {
    content: '';
    position: absolute;
    top: -10px; 
    left: 0;
    right: 0;
    height: 20px; 
    background-image: radial-gradient(circle at 50% 0, transparent 8px, #f0f2f5 8px);
    background-size: 25px 20px; 
    background-repeat: repeat-x;
}
#character-profile-modal .character-profile-content::after {
    content: '';
    position: absolute;
    bottom: -10px; 
    left: 0;
    right: 0;
    height: 20px; 
    background-image: radial-gradient(circle at 50% 100%, transparent 8px, #f0f2f5 8px);
    background-size: 25px 20px; 
    background-repeat: repeat-x;
}
#character-profile-modal .character-profile-content {
    border-radius: 0;         
    background-color: #ffffff; 
}
#character-profile-modal .character-profile-content::before {
    background-image: radial-gradient(circle at 50% 0, transparent 8px, #ffffff 8px);
}
#character-profile-modal .character-profile-content::after {
    background-image: radial-gradient(circle at 50% 100%, transparent 8px, #ffffff 8px);
}
#character-profile-modal .thought-header {
    position: relative;
    width: 100%;
    padding-bottom: 15px; 
    margin-bottom: 25px; 
    border-bottom: 2px dashed #e0e0e0; 
}
#character-profile-modal .thought-header::before {
    content: '';
    position: absolute;
    bottom: -11px;
    left: -35px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background-color:  rgba(0, 0, 0, 0.3);
}
#character-profile-modal .thought-header::after {
    content: '';
    position: absolute;
    bottom: -11px;
    right: -35px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background-color:  rgba(0, 0, 0, 0.3);
}
#character-profile-modal .thought-header {
    height: 140px;         
    flex-shrink: 0;
    padding: 10px;         
    padding-bottom: 25px;  
    box-sizing: border-box;
    border-bottom: 2px dashed #e0e0e0; 
    margin-bottom: 25px;
    position: relative;     
    background-image: url('https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758340625111_qdqqd_zqr2cl.jpeg'); 
    background-size: cover;
    background-position: center top;
    border-radius: 0;      
}
#profile-photo-slot {
    display: none; 
}
#character-profile-modal #profile-main-content .thought-header {
    box-sizing: border-box;
    background-image: url('https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758340625111_qdqqd_zqr2cl.jpeg');
    background-size: cover;
    background-position: center top;
    border-bottom: 2px dashed #e0e0e0;
    margin-bottom: 15px;
    background-clip: content-box; 
    -webkit-background-clip: content-box; 
}
#character-profile-modal #profile-main-content .thought-header::before,
#character-profile-modal #profile-main-content .thought-header::after {
    content: '';
    position: absolute;
    bottom: -11px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.3);
}
#character-profile-modal #profile-main-content .thought-header::before {
    left: -35px;
}
#character-profile-modal #profile-main-content .thought-header::after {
    right: -35px;
}
#character-profile-modal #thoughts-history-list .thought-card .thought-header {
    height: auto;
    padding: 0;
    padding-bottom: 8px; 
    margin-bottom: 12px;
    background-image: none; 
    border: none; 
    border-bottom: 1px solid #f0f0f0; 
}
#character-profile-modal #thoughts-history-list .thought-card .thought-header::before,
#character-profile-modal #thoughts-history-list .thought-card .thought-header::after {
    display: none !important; 
}
#character-profile-modal #profile-main-content .label {
    display: flex !important;
}
#character-profile-modal #profile-main-content .text {
    font-family: "SimSun", "Songti SC", serif; 
    font-size: 16px; 
}
#character-profile-modal .thought-content .label {
    color: #000000 !important;
}
#character-profile-modal .thought-content .text {
    color: #000000 !important;
}
#character-profile-modal #profile-main-content {
    overflow-x: hidden;
}
        #sticker-category-tabs {
            display: flex;
            overflow-x: auto;
            padding: 0 15px; 
            flex-shrink: 0;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--secondary-bg);
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #sticker-category-tabs::-webkit-scrollbar {
            display: none;
        }
        .sticker-category-tab {
            padding: 10px 16px; 
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            margin-bottom: -1px; 
            transition: all 0.2s ease-in-out;
            white-space: nowrap; 
        }
        .sticker-category-tab.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
            font-weight: 600;
        }
        #phone-screen.dark-mode .sticker-category-tab.active {
            color: #ffffff;
        }
        #sticker-grid.management-mode .sticker-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 3px solid transparent;
            border-radius: 10px;
            box-sizing: border-box;
            transition: border-color 0.2s;
            pointer-events: none; 
        }
        #sticker-grid.management-mode .sticker-item.selected::after {
            border-color: var(--accent-color);
        }
        #sticker-grid.management-mode .sticker-item .delete-btn {
            display: block;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: 1px solid white;
        }
        #sticker-action-bar {
            display: none; 
            flex-shrink: 0;
            padding: 10px 15px;
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
            background-color: rgba(247, 247, 247, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
            justify-content: space-between; 
            align-items: center;
        }
        #sticker-action-bar .select-all-label {
            font-size: 16px;
            color: var(--text-primary);
            cursor: pointer;
        }
        #sticker-action-bar button {
            padding: 10px 25px;
            border-radius: 20px;
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            background-color: #ff3b30;
            color: white;
        }
#character-selection-screen { background-color: #f0f2f5; }
#phone-screen.dark-mode #character-selection-screen { background-color: #000; }
#character-grid {
    padding: 0; 
    overflow-y: auto; 
    flex-grow: 1;
}
.character-select-item {
    display: flex;
    flex-direction: row;     
    align-items: center;     
    cursor: pointer;
    padding: 12px 20px;      
    border-bottom: 1px solid var(--border-color); 
    gap: 15px;               
    transition: background-color 0.2s; 
}
.character-select-item:hover {
    background-color: #f5f5f5; 
}
.character-select-item .avatar {
    width: 45px;             
    height: 45px;
    border-radius: 50%;      
    object-fit: cover;
    margin-bottom: 0;        
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: transform 0.2s ease;
    flex-shrink: 0;          
}
.character-select-item .name {
    font-weight: 500;
    font-size: 16px;         
    color: var(--text-primary);
}
#character-phone-screen { background-size: cover; background-position: center; }
.char-screen { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: flex; flex-direction: column; overflow: hidden; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
.char-screen.active { opacity: 1; visibility: visible; z-index: 2; }
#char-home-screen { justify-content: flex-start; align-items: center; box-sizing: border-box; padding: 0 20px; }
#char-clock-container { text-align: center; color: white; text-shadow: 0 3px 8px rgba(0,0,0,0.4); margin-top: calc(60px + env(safe-area-inset-top)); flex-shrink: 0; margin-bottom: 100px; }
#char-main-time { font-size: 88px; font-weight: 600; letter-spacing: -2px; font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif; }
#char-main-date { font-size: 22px; font-weight: normal; }
#char-app-grid { display: flex; flex-direction: column; align-items: center; gap: 20px; width: 100%; }
#char-qq-screen, #char-memo-screen, #char-diary-screen, #char-usage-screen, 
#char-album-screen, #char-browser-screen, #char-taobao-screen {
     background-color: var(--secondary-bg);
}
.memo-item, .diary-item, .usage-item { padding: 15px 20px; border-bottom: 1px solid var(--border-color); cursor: pointer; }
.memo-item .content, .diary-item .content { font-size: 16px; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.diary-item .date, .usage-item .timestamp { font-size: 12px; color: var(--text-secondary); margin-bottom: 5px; }
.usage-item .action { font-size: 15px; color: var(--text-primary); }
#char-album-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr); 
    gap: 5px;
    padding: 5px;
}
.char-photo-item {
    aspect-ratio: 1 / 1; 
    background-size: cover;
    background-position: center;
    background-color: #e9ecef;
}
.char-browser-item {
    padding: 12px 20px;
    border-bottom: 1px solid var(--border-color);
}
.char-browser-item .title {
    font-weight: 500;
    font-size: 15px;
    color: var(--text-primary);
    margin-bottom: 4px;
}
.char-browser-item .url {
    font-size: 12px;
    color: var(--accent-color);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
#char-product-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    padding: 10px;
}
.char-product-item {
    background-color: var(--secondary-bg);
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.04);
    display: flex;
    flex-direction: column;
}
.char-product-item .product-image {
    width: 100%;
    aspect-ratio: 1 / 1;
    object-fit: cover;
    border-radius: 8px 8px 0 0;
}
.char-product-item .product-info {
    padding: 12px 10px;
    flex-grow: 1;
}
.char-product-item .product-name {
    font-size: 13px;
    color: #333;
    line-height: 1.4;
    min-height: 36px;
}
.char-product-item .product-price {
    font-size: 16px;
    font-weight: 700;
    color: #ff5722;
    margin-top: 8px;
}
.char-product-item .product-price::before { content: '¥'; font-size: 12px; }
#char-qq-screen .list-container {
    padding: 0; 
}
#transcript-modal-body {
    display: flex;
    flex-direction: column;
    gap: 20px; 
    padding: 15px; 
    background-color: #f0f2f5;
}
#phone-screen.dark-mode #transcript-modal-body {
    background-color: #000000;
}
#chat-list .chat-list-item,
#char-chat-list .chat-list-item {
    display: flex;
    align-items: center;
    gap: 15px; 
}
#chat-list .chat-list-item .avatar-group,
#char-chat-list .chat-list-item .avatar-group {
    flex-shrink: 0;
}
#chat-list .chat-list-item .info,
#char-chat-list .chat-list-item .info {
    flex-grow: 1;
    min-width: 0; 
}
#char-qq-conversation-screen .list-container {
    display: flex;
    flex-direction: column;
    gap: 20px; 
    padding: 15px; 
    background-color: #f0f2f5;
}
#phone-screen.dark-mode #char-qq-conversation-screen .list-container {
    background-color: #000000;
}
#char-qq-screen, 
#char-memo-screen, 
#char-diary-screen, 
#char-usage-screen, 
#char-album-screen, 
#char-browser-screen, 
#char-taobao-screen,
#char-browser-article-screen,
#char-wallet-screen {
     background-color: var(--secondary-bg);
}
#char-memo-detail-content {
    width: 100%;
    height: 100%;
    border: none;
    background-color: transparent;
    font-size: 16px;
    line-height: 1.7; 
    padding: 15px 20px; 
    box-sizing: border-box;
    resize: none; 
    outline: none; 
    font-family: inherit; 
    color: var(--text-primary); 
}
#char-memo-detail-screen {
    background-color: var(--secondary-bg);
}
#char-memo-detail-screen .header {
    background-color: var(--secondary-bg); 
    border-bottom: 1px solid var(--border-color); 
    padding-bottom: 10px;
}
#char-memo-detail-title {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    font-weight: 600; 
}
#char-memo-detail-screen .form-container {
    padding: 0;
}
#char-memo-detail-content {
    background-color: var(--secondary-bg); 
    padding: 15px 20px; 
    font-size: 17px; 
    line-height: 1.7; 
    color: var(--text-primary);
}
#char-diary-detail-screen {
    background-color: #FDFBF5; 
}
#phone-screen.dark-mode #char-diary-detail-screen {
    background-color: #2c2c2e; 
}
#char-diary-detail-content-wrapper {
    padding: 0;
    overflow-y: auto; 
}
#char-diary-detail-content {
    padding: 25px 20px; 
    font-family: Georgia, 'Times New Roman', Times, serif; 
    font-size: 16px;
    line-height: 1.8; 
    color: #383838; 
}
#phone-screen.dark-mode #char-diary-detail-content {
    color: #e0e0e0;
}
#char-diary-detail-content > p:first-of-type {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 20px;
    text-align: center;
}
#char-diary-detail-content strong {
    font-weight: 600; 
}
#char-diary-detail-content .spoiler {
    background-color: #333;
    color: #333;
    padding: 0 4px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
}
#char-diary-detail-content .spoiler:hover {
    background-color: #e0e0e0;
    color: inherit;
}
@import url('https://fonts.googleapis.com/css2?family=Zhi+Mang+Xing&display=swap');
#char-diary-detail-content .diary-highlight {
    background-color: #FFFACD; 
    padding: 1px 4px;
    border-radius: 3px;
    margin: 0 2px;
}
#char-diary-detail-content .diary-underline {
    border-bottom: 2px dotted #FFB6C1; 
    text-decoration: none; 
    padding-bottom: 1px;
}
#char-diary-detail-content .diary-emphasis {
    color: #DB7093; 
    font-weight: bold;
}
#char-diary-detail-content .diary-handwritten {
    font-family: 'Zhi Mang Xing', cursive; 
    font-size: 1.1em; 
    color: #1a1a1a; 
}
#char-diary-detail-content .diary-messy {
    font-family: 'Zhi Mang Xing', cursive;
    font-size: 1.1em;
    color: #1a1a1a;
    transform: rotate(-2deg); 
    display: inline-block; 
    margin: 0 2px;
}
#char-diary-detail-content .diary-censored {
    background-color: #222;
    color: #222; 
    user-select: none; 
    padding: 0 3px;
    border-radius: 2px;
}
.diary-censored:hover, .diary-censored:active {
  background-color: #E0E0E0; 
  color: inherit; 
  cursor: pointer; 
}
#char-amap-screen {
    background-color: #f0f2f5;
}
#phone-screen.dark-mode #char-amap-screen {
    background-color: #000000;
}
#char-amap-list {
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 18px; 
}
.char-amap-item {
    background-color: var(--secondary-bg);
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    display: flex;
    flex-direction: column; 
}
.amap-item-header {
    display: flex;
    align-items: flex-start; 
    gap: 12px;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 12px;
    margin-bottom: 12px;
}
.amap-item-icon {
    font-size: 24px;
    color: var(--accent-color);
    margin-top: 2px;
}
.amap-item-info {
    flex-grow: 1;
}
.amap-item-title {
    font-weight: 600;
    font-size: 16px;
    margin-bottom: 4px;
}
.amap-item-address {
    font-size: 13px;
    color: var(--text-secondary);
}
.amap-item-body {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.amap-item-comment {
    font-size: 14px;
    line-height: 1.6;
    white-space: pre-wrap; 
}
.amap-item-photo {
    width: 100%;
    height: 150px;
    border-radius: 8px;
    background-size: cover;
    background-position: center;
    cursor: pointer;
}
.amap-item-footer {
    font-size: 12px;
    color: var(--text-secondary);
    margin-top: 10px;
    text-align: right;
}
#char-usage-list {
    padding: 10px 0; 
}
.char-usage-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 10px 20px;
    transition: background-color 0.2s;
}
.char-usage-item:hover {
    background-color: rgba(0,0,0,0.03);
}
.usage-item-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px; 
    object-fit: cover;
    flex-shrink: 0;
    background-color: #e9ecef;
}
.usage-item-info {
    flex-grow: 1; 
}
.usage-item-name {
    font-weight: 500;
    font-size: 16px;
}
.usage-item-category {
    font-size: 12px;
    color: var(--text-secondary);
}
.usage-item-time {
    font-size: 15px;
    color: var(--text-secondary);
    font-weight: 500;
    flex-shrink: 0;
}
#char-music-screen {
    background-color: #f0f2f5;
}
#phone-screen.dark-mode #char-music-screen {
    background-color: #000000;
}
#char-music-list {
    padding: 0;
}
.char-music-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 20px;
    cursor: pointer;
    border-bottom: 1px solid var(--border-color);
}
.char-music-item:hover {
    background-color: rgba(0,0,0,0.03);
}
.music-item-cover {
    width: 50px;
    height: 50px;
    border-radius: 8px;
    object-fit: cover;
    flex-shrink: 0;
}
.music-item-info {
    flex-grow: 1;
    overflow: hidden; 
}
.music-item-name {
    font-weight: 500;
    font-size: 16px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.music-item-artist {
    font-size: 12px;
    color: var(--text-secondary);
}
#char-music-player-modal .modal-content {
    width: 400px !important; 
    height: auto !important; 
    max-height: 90vh;
    background-color: #f7f8fa !important; 
    border-radius: 12px !important;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1) !important;
    color: #333 !important;
    display: flex;
    flex-direction: column;
}
#char-music-player-modal .char-player-header {
    flex-shrink: 0;
    padding: 12px 15px;
    border-bottom: 1px solid #e5e5e5;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 600;
}
#char-music-player-modal .char-player-close-btn {
    background: none;
    border: none;
    font-size: 20px;
    color: #aaa;
    cursor: pointer;
}
#char-music-player-modal .char-player-close-btn:hover {
    color: #333;
}
#char-music-player-modal .char-player-body {
    padding: 30px 35px 20px 35px;
    text-align: center;
}
#char-music-player-modal #char-music-cover {
    width: 220px;
    height: 220px;
    border-radius: 10px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    margin-bottom: 20px;
    object-fit: cover;
}
#char-music-player-modal .char-player-progress-bar-container {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
}
#char-music-player-modal .char-player-progress-bar {
    flex-grow: 1;
    height: 4px;
    background-color: #e0e0e0;
    border-radius: 2px;
    cursor: pointer;
}
#char-music-player-modal #char-music-progress-fill {
    width: 0%;
    height: 100%;
    background-color: #555;
    border-radius: 2px;
}
#char-music-player-modal .char-player-controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
}
#char-music-player-modal .char-player-controls .control-btn {
    background: none;
    border: none;
    color: #555;
    cursor: pointer;
    transition: color 0.2s;
    padding: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
}
#char-music-player-modal .char-player-controls .control-btn:hover {
    color: #000;
}
#char-music-player-modal .char-player-controls .control-btn.play {
    width: 50px;
    height: 50px;
    background-color: #f0f1f3;
    border-radius: 50%;
    color: #333;
}
#char-music-player-modal .char-player-controls .control-btn.mode {
    font-size: 14px;
    font-weight: 500;
    width: 50px;
}
#char-music-player-modal #char-music-lyrics {
    flex-grow: 1;
    overflow-y: auto;
    padding: 0 35px 25px 35px;
    font-size: 14px;
    line-height: 2;
    color: #888;
    text-align: center;
}
#char-music-player-modal #char-music-lyrics p.active {
    color: #000;
    font-weight: 600;
}
#char-music-player-modal #char-music-lyrics::-webkit-scrollbar {
    display: none;
}
#char-music-player-modal #char-music-lyrics {
    -ms-overflow-style: none;
    scrollbar-width: none;
}
@keyframes spin-vinyl {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
#char-music-player-modal .modal-content {
    width: 340px !important; 
    height: auto !important;
    background-color: #f0f1f3 !important; 
    border-radius: 12px !important;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1) !important;
    color: #333 !important;
    display: flex;
    flex-direction: column;
    padding: 20px; 
    position: relative;
}
#char-music-player-modal .modal-header {
    display: none !important;
}
#char-music-player-modal .char-player-close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    font-size: 24px;
    font-weight: 300;
    color: #aaa;
    cursor: pointer;
    line-height: 1;
    z-index: 10;
}
#char-music-player-modal .char-player-body {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex-grow: 1;
}
#char-music-player-modal .char-player-song-info {
    text-align: center;
    margin-bottom: 25px;
}
#char-music-player-modal #char-music-player-title {
    font-size: 20px;
    font-weight: 600;
    margin: 0 0 5px 0;
}
#char-music-player-modal #char-music-artist {
    font-size: 14px;
    color: #888;
    margin: 0;
}
#char-music-player-modal #char-vinyl-container {
    width: 210px;
    height: 210px;
    border-radius: 50%;
    background-color: #222;
    padding: 15px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2), 
                inset 0 0 0 2px rgba(255, 255, 255, 0.05);
    background-image: repeating-radial-gradient(circle, #333, #333 1px, #222 1px, #222 2px);
    box-sizing: border-box;
    margin-bottom: 25px;
}
#char-music-player-modal #char-vinyl-container.spinning {
    animation: spin-vinyl 12s linear infinite;
}
#char-music-player-modal #char-music-cover {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
}
#char-music-player-modal #char-lyric-placeholder {
    color: #aaa;
    font-size: 18px;
    letter-spacing: 5px;
    margin-bottom: 25px;
}
#char-music-player-modal .char-player-footer {
    width: 100%;
    margin-top: auto; 
}
#char-music-player-modal .char-player-progress-bar-container {
    display: flex; align-items: center; gap: 10px; margin-bottom: 10px;
}
#char-music-player-modal .char-player-progress-bar {
    flex-grow: 1; height: 4px; background-color: #e0e0e0; border-radius: 2px; cursor: pointer;
}
#char-music-player-modal #char-music-progress-fill {
    width: 0%; height: 100%; background-color: #555; border-radius: 2px;
}
#char-music-player-modal .char-player-controls {
    display: flex; align-items: center; justify-content: center; gap: 20px;
}
#char-music-player-modal .char-player-controls .control-btn {
    background: none; border: none; color: #555; cursor: pointer; transition: color 0.2s; padding: 5px;
    display: flex; align-items: center; justify-content: center;
}
#char-music-player-modal .char-player-controls .control-btn:hover { color: #000; }
#char-music-player-modal .char-player-controls .control-btn.play {
    width: 50px; height: 50px; background-color: #e0e1e3; border-radius: 50%; color: #333;
}
#char-music-player-modal .char-player-controls .control-btn.mode {
    font-size: 14px; font-weight: 500; width: 50px;
}
#char-music-player-modal #char-music-lyrics {
    display: none; 
}
@keyframes spin-vinyl {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
#char-music-player-modal .modal-content {
    width: 340px !important; 
    height: auto !important;
    background-color: #f0f1f3 !important; 
    border-radius: 12px !important;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1) !important;
    color: #333 !important;
    display: flex;
    flex-direction: column;
    padding: 20px; 
    position: relative;
}
#char-music-player-modal .modal-header {
    display: none !important;
}
#char-music-player-modal .char-player-close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    font-size: 24px;
    font-weight: 300;
    color: #aaa;
    cursor: pointer;
    line-height: 1;
    z-index: 10;
}
#char-music-player-modal .char-player-body {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex-grow: 1;
}
#char-music-player-modal .char-player-song-info {
    text-align: center;
    margin-bottom: 25px;
}
#char-music-player-modal #char-music-player-title {
    font-size: 20px;
    font-weight: 600;
    margin: 0 0 5px 0;
}
#char-music-player-modal #char-music-artist {
    font-size: 14px;
    color: #888;
    margin: 0;
}
#char-music-player-modal #char-vinyl-container {
    width: 210px;
    height: 210px;
    border-radius: 50%;
    background-color: #222;
    padding: 15px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2), 
                inset 0 0 0 2px rgba(255, 255, 255, 0.05);
    background-image: repeating-radial-gradient(circle, #333, #333 1px, #222 1px, #222 2px);
    box-sizing: border-box;
    margin-bottom: 25px;
}
#char-music-player-modal #char-vinyl-container.spinning {
    animation: spin-vinyl 12s linear infinite;
}
#char-music-player-modal #char-music-cover {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
}
#char-music-player-modal #char-music-lyrics {
    width: 100%;
    height: 50px; 
    overflow: hidden; 
    position: relative;
    margin-bottom: 25px;
    font-size: 14px;
    line-height: 25px; 
    color: #888;
    text-align: center;
    transition: all 0.3s ease;
}
#char-music-player-modal #char-music-lyrics p {
    margin: 0;
    transition: all 0.3s ease;
}
#char-music-player-modal #char-music-lyrics p.active {
    color: #000;
    font-weight: 600;
    font-size: 16px; 
}
#char-music-player-modal .char-player-footer {
    width: 100%;
    margin-top: auto; 
}
#char-music-player-modal .char-player-progress-bar-container {
    display: flex; align-items: center; gap: 10px; margin-bottom: 10px;
}
#char-music-player-modal .char-player-progress-bar {
    flex-grow: 1; height: 4px; background-color: #e0e0e0; border-radius: 2px; cursor: pointer;
}
#char-music-player-modal #char-music-progress-fill {
    width: 0%; height: 100%; background-color: #555; border-radius: 2px;
}
#char-music-player-modal .char-player-controls {
    display: flex; align-items: center; justify-content: center; gap: 20px;
}
#char-music-player-modal .char-player-controls .control-btn {
    background: none; border: none; color: #555; cursor: pointer; transition: color 0.2s; padding: 5px;
    display: flex; align-items: center; justify-content: center;
}
#char-music-player-modal .char-player-controls .control-btn:hover { color: #000; }
#char-music-player-modal .char-player-controls .control-btn.play {
    width: 50px; height: 50px; background-color: #e0e1e3; border-radius: 50%; color: #333;
}
#char-music-player-modal .char-player-controls .control-btn.mode {
    font-size: 14px; font-weight: 500; width: 50px;
}
#chat-list .chat-list-item {
    gap: 15px !important;
    justify-content: flex-start !important;
}
#chat-list .chat-list-item .avatar-group {
    margin-right: 0 !important;
}
#douban-screen {
    background-color: #F6F6F1; 
}
#phone-screen.dark-mode #douban-screen {
    background-color: #1a1a1a;
}
#douban-posts-list {
    padding: 0; 
    display: flex;
    flex-direction: column;
}
.douban-post-item {
    background-color: var(--secondary-bg);
    padding: 12px 15px;
    border: none;
    box-shadow: none;
    border-bottom: 1px solid var(--border-color); 
    cursor: pointer;
    transition: background-color 0.2s;
}
.douban-post-item:hover {
    background-color: #f9f9f9;
}
#phone-screen.dark-mode .douban-post-item:hover {
    background-color: #2c2c2e;
}
.douban-post-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
}
.douban-post-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: cover;
}
.douban-author-info {
    flex-grow: 1;
}
.douban-author-name {
    font-weight: 500;
    color: var(--text-primary);
    font-size: 14px;
}
.douban-group-name {
    font-size: 12px;
    color: #007722; 
    font-weight: 500;
}
.douban-post-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text-primary);
}
.douban-post-content {
    font-size: 14px;
    color: #555;
    line-height: 1.7;
    white-space: pre-wrap;
    word-break: break-word;
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
#phone-screen.dark-mode .douban-post-content {
    color: #dcdcdc;
}
.douban-post-footer {
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px solid #f0f0f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 13px;
    color: var(--text-secondary);
}
.douban-post-actions {
    display: flex;
    gap: 20px;
}
.douban-post-actions span {
    display: flex;
    align-items: center;
    gap: 6px; 
    color: var(--text-secondary); 
}
.douban-post-actions svg {
    width: 18px;
    height: 18px;
    fill: currentColor; 
    position: relative;
    top: -1px; 
}
.douban-feather-btn {
    font-size: 24px;
    padding: 0;
    width: 38px;
    height: 38px;
    line-height: 38px;
    text-align: center;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-shrink: 0; 
    margin-right: 8px; 
    background-color: #f0f2f5;
    color: #555;
    transition: background-color 0.2s;
}
.douban-feather-btn:hover {
    background-color: #e2e6ea;
}
.douban-feather-btn svg {
    width: 20px;
    height: 20px;
}
#douban-post-detail-screen {
    background-color: #F6F6F1; 
}
#phone-screen.dark-mode #douban-post-detail-screen {
    background-color: #1a1a1a;
}
#douban-detail-content-wrapper {
    background-color: var(--secondary-bg);
    padding: 0; 
    padding-bottom: 80px; 
}
#douban-post-detail-body {
    padding: 20px 18px 25px 18px; 
    border-bottom: 1px solid #f0f0f0;
}
#phone-screen.dark-mode #douban-post-detail-body {
    border-bottom-color: #38383a;
}
.douban-post-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 15px;
    line-height: 1.5;
}
.douban-detail-content {
    white-space: pre-wrap;
    line-height: 1.8;
    font-size: 15px;
    color: #333;
}
#phone-screen.dark-mode .douban-detail-content {
    color: #dcdcdc;
}
.douban-comments-section {
    margin-top: 0;
    padding: 15px 18px;
}
.douban-comments-section h4 {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-secondary);
    margin: 0 0 15px 0;
    padding-bottom: 10px;
    border-bottom: 1px solid #f0f0f0;
}
#phone-screen.dark-mode .douban-comments-section h4 {
    border-bottom-color: #38383a;
}
.douban-comment-item {
    display: flex;
    gap: 12px;
    padding: 15px 0;
    border-bottom: 1px solid #f0f0f0;
}
.douban-comment-item:last-child {
    border-bottom: none;
}
#phone-screen.dark-mode .douban-comment-item {
    border-bottom-color: #38383a;
}
.douban-comment-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    flex-shrink: 0;
}
.douban-comment-body {
    flex-grow: 1;
}
.douban-comment-author {
    font-weight: 500;
    font-size: 14px;
    color: var(--text-primary);
}
.douban-comment-text {
    font-size: 14px;
    color: #555;
    margin-top: 6px;
    line-height: 1.7;
    word-break: break-word;
}
#phone-screen.dark-mode .douban-comment-text {
    color: #b0b0b0;
}
#douban-comment-footer {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 10px 18px; 
    padding-bottom: calc(10px + env(safe-area-inset-bottom));
    box-sizing: border-box; 
    background-color: rgba(247, 247, 247, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-top: 1px solid var(--border-color); 
}
#douban-send-comment-btn {
    background-color: #007722; 
}
#douban-screen .header .header-actions {
    flex-shrink: 0;
    display: flex;       
    align-items: center; 
}
.header .action-btn svg {
    width: 24px;   
    height: 24px;
    display: block; 
}
.header .action-btn {
    min-width: 30px; 
    display: flex;
    align-items: center;
    justify-content: center;
}
.header .header-left-actions {
    display: flex;
    align-items: center;
    gap: 15px; 
}
        .char-photo-item {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px; 
            box-sizing: border-box;
        }
        .char-photo-description {
            font-size: 13px;
            color: var(--text-secondary); 
            text-align: center;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 5; 
            overflow: hidden;
            word-break: break-all; 
        }
        .char-product-description-overlay {
            width: 100%;
            aspect-ratio: 1 / 1; 
            background-color: #f7f8fa; 
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px; 
            box-sizing: border-box;
            border-bottom: 1px solid #eee; 
            border-radius: 8px 8px 0 0; 
        }
        .char-product-description-overlay .char-photo-description,
        .char-browser-image-description { 
            font-size: 14px; 
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.6;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 6; 
            overflow: hidden;
            word-break: break-all;
        }
        .char-browser-image-description {
            padding: 40px 20px; 
        }
.char-product-status {
    font-size: 12px;
    color: #8a8a8a; 
    background-color: #f0f2f5; 
    padding: 3px 8px;
    border-radius: 10px;
}
#search-history-screen {
    background-color: #f0f2f5;
}
#phone-screen.dark-mode #search-history-screen {
    background-color: #000000;
}
#search-results-list {
    flex-grow: 1;
    overflow-y: auto;
}
.date-separator {
    text-align: center;
    color: var(--text-secondary);
    font-size: 12px;
    padding: 10px 0;
    font-weight: 500;
}
#phone-screen.dark-mode #search-bar input {
    background-color: #1c1c1e;
    color: #ffffff;
    border-color: #38383a;
}
        #home-screen {
            flex-direction: column;
            padding: 0; 
        }
        #home-screen-pages-container {
            flex-grow: 1; 
            width: 100%;
            overflow: hidden; 
            position: relative;
        }
        #home-screen-pages {
            display: flex;
            width: 200%; 
            height: 100%;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        .home-screen-page {
            width: 50%; 
            height: 100%;
            padding: 20px;
            padding-top: calc(20px + env(safe-area-inset-top));
            padding-bottom: 0; 
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #home-screen-pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 10px 0;
            padding-bottom: calc(10px + env(safe-area-inset-bottom) / 2);
            flex-shrink: 0;
        }
        .pagination-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
        }
        .pagination-dot.active {
            background-color: white;
            transform: scale(1.1);
        }
.draggable-button-item {
    padding: 8px 12px;
    background-color: var(--secondary-bg);
    border: 1px solid var(--border-color);
    border-radius: 20px;
    cursor: grab;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    font-weight: 500;
    transition: background-color 0.2s, box-shadow 0.2s;
    user-select: none;
}
.draggable-button-item:active {
    cursor: grabbing;
}
.draggable-button-item svg {
    width: 18px;
    height: 18px;
    stroke-width: 2;
}
.draggable-button-item.dragging {
    opacity: 0.5;
    background-color: #e0e0e0;
}
.draggable-button-item.drag-over {
    background-color: #d0eaff;
    box-shadow: 0 0 0 2px var(--accent-color);
}
.draggable-button-item.dragging {
    opacity: 0.5;
    background-color: #e0e0e0;
    position: relative; 
    z-index: 10;
}
#button-order-editor {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
.scrollable-content-preview {
    max-height: 35vh;
    overflow-y: auto;
    background-color: #f0f2f5;
    padding: 10px 15px;
    border-radius: 8px;
    text-align: left;
    white-space: pre-wrap; 
    border: 1px solid var(--border-color);
}
.wizard-step {
    display: none; 
    flex-direction: column;
    width: 100%;
    height: 100%;
}
.wizard-step.active {
    display: flex; 
}
#data-clear-char-list .clear-posts-item,
#data-clear-type-list .clear-posts-item {
    padding: 12px 18px;
}
#data-clear-wizard-modal .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
#data-clear-wizard-modal .modal-header label {
    font-size: 14px;
    font-weight: normal;
    display: flex;
    align-items: center;
    gap: 5px;
    cursor: pointer;
}
#tutorial-screen {
    background-color: #f0f2f5;
}
#phone-screen.dark-mode #tutorial-screen {
    background-color: #000000;
}
.entry-content-container {
    display: none; 
    margin-top: 8px; 
}
.toggle-content-btn {
    background: none;
    border: 1px solid #ccc;
    color: var(--text-secondary);
    font-size: 12px;
    padding: 2px 8px;
    border-radius: 5px;
    cursor: pointer;
}
#update-notice-modal {
    position: fixed; 
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
    display: none; 
    align-items: center;
    justify-content: center;
    z-index: 2000; 
    opacity: 0;
    transition: opacity 0.3s ease;
}
#update-notice-modal.visible {
    display: flex;
    opacity: 1;
}
.update-notice-content {
    background-color: var(--secondary-bg);
    width: 300px;
    border-radius: 14px;
    box-shadow: 0 5px 25px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
    transform: scale(0.95);
    transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
}
#update-notice-modal.visible .update-notice-content {
    transform: scale(1);
}
.update-notice-body {
    padding: 20px;
    font-size: 15px;
    line-height: 1.6;
    color: #333;
    max-height: 60vh; 
    overflow-y: auto; 
}
.update-notice-footer {
    border-top: 1px solid #dbdbdb;
    display: flex;
}
.update-notice-footer button {
    flex: 1;
    background: none;
    border: none;
    padding: 14px;
    font-size: 17px;
    cursor: pointer;
    color: var(--accent-color);
}
.update-notice-footer button:first-child {
    border-right: 1px solid #dbdbdb;
    font-weight: 600;
}
#message-actions-modal .custom-modal-footer {
    flex-wrap: wrap; 
    padding: 10px;   
    gap: 10px;       
    justify-content: flex-start; 
}
#message-actions-modal .custom-modal-footer button:not(#cancel-message-action-btn) {
    flex-grow: 1;
    flex-basis: 75px; 
    border: none;
    background-color: #f0f2f5;
    border-radius: 8px;
    padding: 12px 5px; 
    font-size: 16px;
    font-weight: 500;
}
#message-actions-modal #cancel-message-action-btn {
    width: 100%; 
    flex-basis: 100%; 
    margin-top: 8px;
    border-radius: 8px;
    background-color: #f0f2f5;
    font-weight: 600;
}
input, textarea, select {
    font-size: 16px !important;
}
#favorite-diary-btn.active svg {
    fill: #ffc107; 
    color: #ffc107;
}
.favorite-item-card .diary-title {
    font-weight: 600;
    display: block;
    margin-bottom: 8px;
    font-size: 15px;
}
.favorite-item-card .diary-content-preview {
    font-size: 13px;
    opacity: 0.8;
    line-height: 1.6;
    display: -webkit-box;
    -webkit-line-clamp: 3; 
    -webkit-box-orient: vertical;
    overflow: hidden;
}
.favorite-item-card .diary-content-preview {
    font-size: 13px;
    opacity: 0.8;
    line-height: 1.6;
    display: -webkit-box;
    -webkit-line-clamp: 3; 
    -webkit-box-orient: vertical;
    overflow: hidden;
}
#npc-list-view {
    background-color: #f0f2f5;
}
#phone-screen.dark-mode #npc-list-view {
    background-color: #000;
}
#chat-lock-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px; 
}
.spectator-actions-container {
    display: flex;
    gap: 12px; 
    align-items: center;
}
#chat-lock-content .lock-action-btn.secondary {
    background-color: transparent; 
    color: var(--accent-color);   
    border: 1px solid var(--accent-color); 
    padding: 8px 18px; 
    font-size: 14px;
}
.spectator-actions-container .lock-action-btn.secondary svg {
    width: 20px;  
    height: 20px; 
    stroke: currentColor; 
}
.music-player-window {
    position: relative;
    background-color: rgba(255, 255, 255, 0.75);
}
.music-player-window::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: var(--music-bg-image);
    background-size: cover;
    background-position: center;
    filter: blur(15px) brightness(0.8);
    z-index: -1;
    border-radius: inherit; 
    transition: background-image 0.5s ease-in-out;
}
.music-player-window.bg-clear::before {
    filter: none;
}
#toggle-blur-btn {
    background: none;
    border: none;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    color: #333;
    width: 44px;
    height: 44px;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.2s ease;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.05);
}
#toggle-blur-btn.active {
    background-color: var(--accent-color); 
    color: white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.music-player-window.fullscreen {
    width: 100%;
    height: 100%;
    max-height: 100%; 
    border-radius: 0; 
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
}
#music-player-overlay.fullscreen-active {
    padding-top: 0;
    align-items: stretch; 
}
#toggle-fullscreen-btn {
    background: none;
    border: none;
    font-size: 22px; 
    cursor: pointer;
    color: #555;
    padding: 5px;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.2s;
}
#toggle-fullscreen-btn:hover {
    color: #000;
}
#toggle-fullscreen-btn .icon-minimize {
    display: none;
}
.music-player-window.fullscreen #toggle-fullscreen-btn .icon-maximize {
    display: none;
}
.music-player-window.fullscreen #toggle-fullscreen-btn .icon-minimize {
    display: block;
}
#music-player-avatar-display {
    display: none; 
    width: 100%;
    padding: 15px 20px;
    box-sizing: border-box;
    justify-content: space-between; 
    align-items: center;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1); 
    margin-bottom: 10px;
}
.music-player-window.fullscreen #music-player-avatar-display.visible {
    display: flex;
}
.participant-display-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
#show-avatars-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
    display: none; 
    align-items: center;
    justify-content: center;
    opacity: 0.6;
    transition: opacity 0.2s;
}
.music-player-window.fullscreen #show-avatars-btn {
    display: flex;
}
#show-avatars-btn:hover {
    opacity: 1;
}
#show-avatars-btn.active {
    opacity: 1;
}
.douban-settings-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.douban-settings-item label {
    margin-bottom: 0;
    flex-grow: 1; 
}
.douban-settings-controls {
    display: flex;
    align-items: center;
    gap: 8px; 
    flex-shrink: 0; 
}
.douban-settings-controls input {
    width: 60px;
    text-align: center;
}
#time-zone-search-input {
    width: 100%;
    padding: 10px 12px;
    margin-bottom: 8px; 
    border: 1px solid var(--border-color);
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px; 
}
#phone-screen.dark-mode #time-zone-search-input {
    background-color: #1c1c1e;
    color: #ffffff;
    border-color: #38383a;
}
#werewolf-game-screen {
    background-color: #2c2c2e; 
    color: white;
}
#werewolf-player-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
    gap: 15px;
    padding: 15px;
    flex-shrink: 0;
    border-bottom: 1px solid #444;
}
.werewolf-player-avatar {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    position: relative;
}
.werewolf-player-avatar img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: 2px solid #888;
    transition: all 0.3s;
}
.werewolf-player-avatar .player-name {
    font-size: 12px;
    font-weight: 500;
    text-shadow: 0 1px 2px black;
}
.werewolf-player-avatar.dead img {
    filter: grayscale(100%);
    border-color: #ff3b30;
}
.werewolf-player-avatar.dead .player-name {
    color: #ff3b30;
    text-decoration: line-through;
}
#werewolf-log {
    padding: 15px;
    background: none;
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.werewolf-log-entry {
    background-color: rgba(255, 255, 255, 0.08);
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 14px;
    line-height: 1.6;
}
.werewolf-log-entry.system {
    text-align: center;
    color: #ffc107;
    font-style: italic;
    background-color: rgba(255, 193, 7, 0.1);
}
.werewolf-log-entry .speaker {
    font-weight: bold;
}
#werewolf-action-bar {
    padding: 10px 15px;
    padding-bottom: calc(10px + env(safe-area-inset-bottom));
    background-color: rgba(0,0,0,0.3);
    flex-shrink: 0;
    text-align: center;
}
#werewolf-next-step-btn {
    width: 100%;
}
#werewolf-role-card {
    background: linear-gradient(135deg, #4a4a4a, #2a2a2a);
    border: 1px solid #666;
    border-radius: 12px;
    padding: 20px;
    color: white;
}
#werewolf-role-name {
    font-size: 22px;
    font-weight: bold;
    color: #ffc107;
    margin-bottom: 10px;
}
#werewolf-role-description {
    font-size: 14px;
    line-height: 1.6;
}
.werewolf-selection-item {
    display: flex;
    align-items: center;
    padding: 12px 18px;
    cursor: pointer;
    border-bottom: 1px solid var(--border-color);
}
.werewolf-selection-item.selected {
    background-color: var(--accent-color);
    color: white;
}
.werewolf-selection-item img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 15px;
}
.werewolf-selection-item .name {
    font-weight: 500;
}
        #werewolf-game-screen #werewolf-action-bar {
            background-color: rgba(0, 0, 0, 0.3); 
            border-top: 1px solid rgba(255, 255, 255, 0.1); 
            padding: 10px 15px; 
            padding-bottom: calc(10px + env(safe-area-inset-bottom)); 
        }
        #werewolf-game-screen #werewolf-user-input {
            flex-grow: 1; 
            border: none;
            padding: 10px 15px;
            border-radius: 20px; 
            background-color: rgba(255, 255, 255, 0.1); 
            color: #f0f0f0; 
            font-size: 16px; 
            resize: none; 
            height: 40px; 
            box-sizing: border-box;
        }
        #werewolf-game-screen #werewolf-user-input::placeholder {
            color: #8d8d92; 
        }
        #werewolf-game-screen #input-actions-wrapper button {
            height: 40px;
            padding: 0 15px;
            border-radius: 20px;
            border: none;
            color: white;
            font-weight: 600;
            cursor: pointer;
            flex-shrink: 0; 
        }
        #werewolf-game-screen #werewolf-wait-reply-btn {
            background-color: #555; 
        }
        #werewolf-game-screen #werewolf-finish-speech-btn {
            background-color: #c62828; 
        }
#sticker-search-container {
    padding: 10px 15px; 
    flex-shrink: 0; 
    border-bottom: 1px solid var(--border-color); 
    background-color: var(--secondary-bg); 
}
#sticker-search-input {
    width: 100%;
    padding: 10px 15px;
    font-size: 16px; 
    border: 1px solid var(--border-color);
    border-radius: 18px; 
    background-color: #f0f2f5; 
    box-sizing: border-box;
    outline: none; 
    -webkit-appearance: none; 
}
#sticker-search-input:focus {
    border-color: var(--accent-color); 
    background-color: var(--secondary-bg); 
}
#phone-screen.dark-mode #sticker-search-input {
    background-color: #2c2c2e;
    color: #f0f0f0;
    border-color: #38383a;
}
#phone-screen.dark-mode #sticker-search-input:focus {
    background-color: #38383a;
}
.message-bubble .content {
    transition: background-color 0.5s ease-out;
}
.message-bubble.highlighted .content {
    background-color: rgba(0, 123, 255, 0.2) !important;
}
.loader-container {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 10px 0;
    width: 100%;
    height: 44px; 
    box-sizing: border-box;
}
.spinner {
    width: 24px;
    height: 24px;
    border: 3px solid rgba(0, 0, 0, 0.1); 
    border-top-color: var(--accent-color); 
    border-radius: 50%;
    animation: spin 1s linear infinite; 
}
#phone-screen.dark-mode .spinner {
    border: 3px solid rgba(255, 255, 255, 0.2);
    border-top-color: #fff; 
}
#reading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 150; 
    display: flex;
    justify-content: center;
    align-items: center;
    pointer-events: none; 
    display: none; 
}
#reading-window {
    width: 90%;
    max-width: 340px;
    height: 60vh;
    max-height: 480px;
    background-color: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 18px;
    box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.18);
    display: flex;
    flex-direction: column;
    pointer-events: auto; 
    position: absolute; 
    transition: transform 0.3s ease, opacity 0.3s ease, visibility 0s 0.3s; 
}
#phone-screen.dark-mode #reading-window {
    background-color: rgba(40, 40, 42, 0.7);
}
.reading-header {
    cursor: move;
    user-select: none;
    -webkit-user-select: none;
    flex-shrink: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    border-bottom: 1px solid var(--border-color);
    gap: 10px;
    flex-wrap: nowrap;
}
#reading-title {
    font-weight: 600;
    flex: 1;
    min-width: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.reading-controls {
    flex-shrink: 0;
}
.reading-controls button {
    background: none; border: none; color: var(--text-secondary); padding: 4px 8px;
    border-radius: 4px; cursor: pointer; font-size: 14px; transition: background-color 0.2s;
}
.reading-controls button:hover {
    background-color: rgba(0,0,0,0.1);
}
#minimize-reading-btn {
    font-weight: bold; font-size: 16px; line-height: 1;
}
#reading-window.minimized {
    transform: scale(0.8); 
    opacity: 0;           
    pointer-events: none; 
    visibility: hidden;   
}
#reading-restore-btn {
    position: absolute;
    top: 50%;
    right: 15px; 
    transform: translateY(-50%); 
    width: 50px; 
    height: 50px;
    background-color: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px; 
    cursor: move; 
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    pointer-events: auto; 
    z-index: 160; 
    transition: transform 0.2s; 
}
#reading-restore-btn:active {
    transform: translateY(-50%) scale(0.95);
}
#phone-screen.dark-mode #reading-restore-btn {
    background-color: rgba(50, 50, 52, 0.8);
}
#reading-content {
    flex-grow: 1; 
    overflow-y: auto; 
    padding: 15px;
    font-size: 15px; 
    line-height: 1.8;
    white-space: pre-wrap; 
    word-break: break-word;  
}
.reading-footer {
    flex-shrink: 0; display: flex; justify-content: space-between; align-items: center;
    padding: 12px 15px; border-top: 1px solid var(--border-color);
}
#page-indicator {
    font-size: 14px; 
    color: var(--text-secondary);
    cursor: pointer; 
    transition: color 0.2s;
}
#page-indicator:hover {
    color: var(--accent-color); 
}
.reading-footer button {
    padding: 6px 15px; border-radius: 15px; border: none;
    background-color: var(--accent-color); color: white; cursor: pointer;
}
.reading-footer button:disabled {
    background-color: #ccc;
}
#phone-screen.dark-mode .reading-footer button:disabled {
    background-color: #555;
}
#reading-library-search-container {
    padding: 10px 15px;
    border-bottom: 1px solid var(--border-color);
    flex-shrink: 0; 
}
#reading-library-search-input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    box-sizing: border-box;
    font-size: 16px; 
    -webkit-appearance: none; 
}
#phone-screen.dark-mode #reading-library-search-input {
    background-color: #2c2c2e;
    color: #f0f0f0;
    border-color: #38383a;
}
.voice-message-body {
    display: flex;
    align-items: center;
    cursor: pointer;
    min-width: 80px;
    max-width: 220px;
    padding: 8px 12px;
}
.message-bubble.user .voice-message-body {
    color: #1a3d00;
    flex-direction: row-reverse;
}
.message-bubble.ai .voice-message-body {
    color: var(--text-primary);
}
.voice-play-btn {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: none;
    background-color: rgba(0, 0, 0, 0.1);
    color: currentColor;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    flex-shrink: 0;
    transition: background-color 0.2s;
}
.voice-play-btn:hover {
    background-color: rgba(0, 0, 0, 0.2);
}
.voice-spinner {
    width: 20px;
    height: 20px;
    border: 2px solid rgba(0, 0, 0, 0.2);
    border-top-color: var(--accent-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    display: none; 
    margin: 4px;
}
.voice-duration {
    font-size: 14px;
    font-weight: 500;
    margin: 0 10px;
    flex-shrink: 0;
}
.message-bubble.user .voice-duration {
    color: #3e6224;
}
#product-category-tabs {
    display: flex;
    overflow-x: auto; 
    padding: 10px 15px 0 15px;
    flex-shrink: 0;
    border-bottom: 1px solid var(--border-color);
    background-color: var(--secondary-bg);
    -ms-overflow-style: none;  
    scrollbar-width: none;  
}
#product-category-tabs::-webkit-scrollbar {
    display: none; 
}
.product-category-tab {
    padding: 8px 16px;
    cursor: pointer;
    border: none;
    background-color: transparent;
    font-size: 15px;
    font-weight: 500;
    color: var(--text-secondary);
    border-bottom: 2px solid transparent; 
    margin-bottom: -1px; 
    transition: all 0.2s ease-in-out;
    white-space: nowrap; 
    flex-shrink: 0; 
}
.product-category-tab.active {
    color: #FF5722; 
    border-bottom-color: #FF5722; 
    font-weight: 600; 
}
#phone-screen.dark-mode .product-category-tab.active {
    color: #FF8A65; 
    border-bottom-color: #FF8A65;
}
#product-category-tabs {
    overflow-x: auto;      
    white-space: nowrap;   
    -webkit-overflow-scrolling: touch; 
    scrollbar-width: none;             
    -ms-overflow-style: none;          
}
#product-category-tabs::-webkit-scrollbar {
    display: none; 
}
.product-category-tab {
    flex-shrink: 0;
}
        #shopping-screen.management-mode .product-item {
            cursor: pointer;
        }
        #shopping-screen.management-mode .product-management-overlay {
            display: none;
        }
        #shopping-screen.management-mode .product-item::before {
            content: '';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 22px;
            height: 22px;
            border: 2px solid #ccc;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.7);
            transition: all 0.2s ease;
            z-index: 6; 
        }
        #shopping-screen.management-mode .product-item.selected::before {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            content: '✔';
            color: white;
            font-size: 14px;
            text-align: center;
            line-height: 22px;
        }
        #shopping-screen.management-mode .product-item:not(.selected) {
            opacity: 0.8;
        }
        #shopping-action-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            width: auto;
            padding: 10px 15px;
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
            background-color: rgba(247, 247, 247, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
            box-sizing: border-box;
            z-index: 5;
            display: none; 
            justify-content: space-between;
            align-items: center;
        }
        #shopping-action-bar .select-all-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            color: var(--text-primary);
            cursor: pointer;
        }
        #shopping-action-bar .action-bar-btn {
            padding: 10px 25px;
            border-radius: 20px;
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            background-color: #ff3b30;
            color: white;
        }
.polaroid-widget-container {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 30px; 
    flex-shrink: 0;
    margin-top: 20px; 
}
.polaroid-photos {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 5px; 
}
.polaroid-photo {
    background-color: white;
    padding: 8px 8px 15px 8px; 
    border-radius: 4px;
    box-shadow: 0 5px 12px rgba(0, 0, 0, 0.2); 
    transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.25s;
    width: 80px; 
    flex-shrink: 0;
}
.polaroid-photo:hover {
    transform: scale(1.1) rotate(0deg) !important; 
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
    z-index: 10; 
}
.polaroid-photo img {
    width: 100%;
    display: block;
    aspect-ratio: 1 / 1; 
    object-fit: cover;
}
.polaroid-widget-title {
    margin-top: 15px;
    font-size: 13px;
    font-weight: 500;
    color: white; 
    text-shadow: 0 1px 3px rgba(0,0,0,0.4); 
}
#page-2-app-container {
    display: grid;
    grid-template-columns: 155px 1fr; 
    gap: 15px;
    width: 100%;
    padding-top: 20px;
    align-items: start;
}
.app-subgrid {
    display: grid;
    grid-template-columns: 1fr 1fr; 
    gap: 15px; 
}
.large-widget {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px; 
}
.large-widget-img {
    width: 100%;
    aspect-ratio: 1 / 1; 
    border-radius: 22px; 
    object-fit: cover;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.large-widget-label {
    color: white;
    font-size: 13px;
    font-weight: 500;
    text-shadow: 0 1px 3px rgba(0,0,0,0.4);
}
.small-widget {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}
.small-widget-icon-wrapper {
    width: 55px;
    height: 55px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.small-widget-img {
    width: 100%;     
    height: 100%;    
    object-fit: cover; 
    border-radius: 14px; 
}
.small-widget-label {
    color: white;
    font-size: 13px;
    font-weight: 500;
    text-shadow: 0 1px 3px rgba(0,0,0,0.4);
}
#page-2-app-container .small-widget-label {
    color: #000 !important;       
    text-shadow: none !important; 
}
#phone-screen.dark-mode #char-diary-list .list-item .item-title,
#phone-screen.dark-mode #char-diary-list .list-item .item-content,
#phone-screen.dark-mode #char-memo-list .list-item .item-title,
#phone-screen.dark-mode #char-memo-list .list-item .item-content,
#phone-screen.dark-mode #char-browser-history .char-browser-item .title,
#phone-screen.dark-mode #char-usage-list .usage-item-name,
#phone-screen.dark-mode #char-music-list .music-item-name {
    color: #f0f0f0; 
}
#phone-screen.dark-mode #char-diary-list .list-item .item-content,
#phone-screen.dark-mode #char-browser-history .char-browser-item .url,
#phone-screen.dark-mode #char-usage-list .usage-item-category,
#phone-screen.dark-mode #char-music-list .music-item-artist {
    color: #a0a0a0; 
}
#phone-screen.dark-mode #char-diary-detail-content .diary-highlight {
    background-color: rgba(255, 223, 100, 0.2); 
    color: #FFD700; 
}
#phone-screen.dark-mode #char-diary-detail-content .diary-underline {
    border-bottom-color: #FF85B3; 
}
#phone-screen.dark-mode #char-diary-detail-content .diary-emphasis {
    color: #FF85B3; 
}
#phone-screen.dark-mode #char-diary-detail-content .diary-handwritten,
#phone-screen.dark-mode #char-diary-detail-content .diary-messy {
    color: #dcdcdc; 
}
#phone-screen.dark-mode .spoiler {
    background-color: #444; 
    color: #444;           
}
#phone-screen.dark-mode .spoiler:hover, 
#phone-screen.dark-mode .spoiler:active {
    background-color: #555; 
    color: #fff;           
}
#avatar-frame-modal .frame-grid.management-mode .frame-item {
    cursor: pointer;
}
#avatar-frame-modal .frame-grid.management-mode .frame-item:has(.delete-btn)::after {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    width: calc(100% + 4px);
    height: calc(100% + 4px);
    border: 3px solid transparent;
    border-radius: 12px;
    box-sizing: border-box;
    transition: border-color 0.2s;
    pointer-events: none; 
}
#avatar-frame-modal .frame-grid.management-mode .frame-item.selected::after {
    border-color: var(--accent-color);
}
#frame-action-bar {
    display: none; 
    flex-shrink: 0;
    padding: 10px 15px;
    padding-bottom: calc(10px + env(safe-area-inset-bottom));
    background-color: rgba(247, 247, 247, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-top: 1px solid var(--border-color);
    justify-content: space-between;
    align-items: center;
}
#frame-action-bar .select-all-label {
    font-size: 16px;
    color: var(--text-primary);
    cursor: pointer;
}
#frame-action-bar .action-bar-btn {
    padding: 10px 25px;
    border-radius: 20px;
    border: none;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    background-color: #ff3b30;
    color: white;
}
#favorite-memo-btn.active svg {
    fill: #ffc107; 
    color: #ffc107;
}
.favorite-item-card .memo-title {
    font-weight: 600;
    display: block;
    margin-bottom: 8px;
    font-size: 15px;
}
#chat-interface-screen .back-btn {
    position: relative; 
}
.back-btn .unread-indicator {
    position: absolute;
    top: -2px;
    right: -10px;
    min-width: 18px;
    height: 18px;
    padding: 0 5px;
    background-color: #ff3b30;
    color: white;
    font-size: 11px;
    font-weight: bold;
    line-height: 18px;
    text-align: center;
    border-radius: 9px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.2);
    display: none;
    z-index: 20; 
    transform: scale(0.8);
}
#phone-screen.dark-mode .back-btn .unread-indicator {
    border: 1px solid #333;
}
#favorite-article-btn.active svg {
    fill: #ffc107; 
    color: #ffc107;
}
.modal,
#custom-modal-overlay,
#transfer-modal,
#battery-alert-modal,
#photo-viewer-modal,
#character-profile-modal,
#update-notice-modal {
    background-color: transparent !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
}
#character-profile-modal .jottings .label {
    display: flex !important;
}
#total-image-size-display,
#token-count-display {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    color: var(--text-secondary);
    margin-bottom: 15px;
    padding: 8px 12px;
    background-color: #f0f2f5;
    border-radius: 8px;
    border: 1px solid var(--border-color);
}

#phone-screen.dark-mode #total-image-size-display,
#phone-screen.dark-mode #token-count-display {
    background-color: #2c2c2e; 
    border-color: #38383a;
}

#total-image-size-display #image-size-label,
#token-count-display #token-count-label {
    font-weight: 500;
}

#total-image-size-display #image-size-value,
#token-count-display #token-count-value {
    font-weight: 600;
    color: var(--text-primary);
}

/* ▼▼▼ RealImag多图布局样式 ▼▼▼ */
/* 多图容器 */
.post-images-grid {
    display: grid;
    gap: 8px;  /* 图片之间的固定间距 */
    margin-top: 10px;
}

/* 单张图片 - 大图，等比例缩放 */
.post-images-grid.grid-1 {
    grid-template-columns: 1fr;
    justify-items: start;
}
.post-images-grid.grid-1 .realimag-image,
.post-images-grid.grid-1 .naiimag-image {
    max-width: 280px;
    max-height: 280px;
    width: auto;
    height: auto;
}

/* 2张图片 - 横向并排，等比例缩放 */
.post-images-grid.grid-2 {
    grid-template-columns: auto auto;
    gap: 5px;
    justify-content: start;
}
.post-images-grid.grid-2 .realimag-image,
.post-images-grid.grid-2 .naiimag-image {
    max-width: 135px;
    max-height: 135px;
    width: auto;
    height: auto;
}

/* 3张图片 - 横向排列，等比例缩放 */
.post-images-grid.grid-3 {
    grid-template-columns: repeat(3, 1fr);
    gap: 5px;
}
.post-images-grid.grid-3 .realimag-image {
    max-width: 130px;
    max-height: 130px;
    width: auto;
    height: auto;
}

/* 4张图片 - 2x2方格，等比例缩放 */
.post-images-grid.grid-4 {
    grid-template-columns: repeat(2, 1fr);
    gap: 5px;
}
.post-images-grid.grid-4 .realimag-image {
    max-width: 195px;
    max-height: 195px;
    width: auto;
    height: auto;
}

/* 5张图片 - 上2下3，等比例缩放 */
.post-images-grid.grid-5 {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 5px;
}
.post-images-grid.grid-5 .realimag-image:nth-child(1),
.post-images-grid.grid-5 .realimag-image:nth-child(2) {
    grid-column: span 3;
    max-width: 195px;
    max-height: 195px;
    width: auto;
    height: auto;
}
.post-images-grid.grid-5 .realimag-image:nth-child(n+3) {
    grid-column: span 2;
    max-width: 130px;
    max-height: 130px;
    width: auto;
    height: auto;
}

/* 6张图片 - 3x2网格，等比例缩放 */
.post-images-grid.grid-6 {
    grid-template-columns: repeat(3, 1fr);
    gap: 5px;
}
.post-images-grid.grid-6 .realimag-image {
    max-width: 130px;
    max-height: 130px;
    width: auto;
    height: auto;
}

/* 7-9张图片 - 3x3九宫格，等比例缩放 */
.post-images-grid.grid-7,
.post-images-grid.grid-8,
.post-images-grid.grid-9 {
    grid-template-columns: repeat(3, 1fr);
    gap: 5px;
}
.post-images-grid.grid-7 .realimag-image,
.post-images-grid.grid-8 .realimag-image,
.post-images-grid.grid-9 .realimag-image {
    max-width: 130px;
    max-height: 130px;
    width: auto;
    height: auto;
}

/* 图片基础样式 - 完整显示，等比例缩放，不裁剪 */
.post-images-grid .realimag-image,
.post-images-grid .naiimag-image {
    object-fit: contain;
    border-radius: 8px;
    cursor: pointer;
    transition: transform 0.2s;
}
.post-images-grid .realimag-image:hover,
.post-images-grid .naiimag-image:hover {
    transform: scale(1.05);
}
/* ▲▲▲ RealImag多图布局样式结束 ▲▲▲ */
/* 【修复】解决夜间模式下浏览器和足迹页面文字颜色不正确的问题 */
#phone-screen.dark-mode #browser-content {
    color: #dcdcdc; /* 浏览器文章正文颜色 */
}
#phone-screen.dark-mode #browser-content .article-title {
    color: #ffffff; /* 浏览器文章标题颜色 */
}
#phone-screen.dark-mode #browser-content .article-meta {
    color: #8d8d92; /* 浏览器文章元数据（来源）颜色 */
    border-bottom-color: #38383a;
}
#phone-screen.dark-mode .amap-item-title {
    color: #f0f0f0; /* 足迹 - 地点标题颜色 */
}
#phone-screen.dark-mode .amap-item-comment {
    color: #dcdcdc; /* 足迹 - 评论内容颜色 */
}
/* 【修复】CPhone 浏览器详情页在夜间模式下的文字颜色 */
#phone-screen.dark-mode #char-article-content {
    color: #dcdcdc; /* 设置为浅灰色，使其在深色背景上可见 */
}
#char-article-content {
    color: #333; /* CPhone 浏览器文章正文 - 白天模式默认颜色 */
}

#open-nai-gallery-btn svg path {
    fill: currentColor;
    stroke: none;
}

#nai-gallery-panel {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 65%; /* 画廊面板高度 */
    background-color: rgba(242, 242, 247, 0.85);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border-top: 1px solid var(--border-color);
    border-radius: 20px 20px 0 0;
    z-index: 200;
    display: flex;
    flex-direction: column;
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    visibility: hidden;
}

#nai-gallery-panel.visible {
    transform: translateY(0);
    visibility: visible;
}

#nai-gallery-panel-header {
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
    border-bottom: 1px solid var(--border-color);
}
#nai-gallery-panel-header .title {
    font-weight: 600;
}
#nai-gallery-panel-header .panel-btn {
    font-size: 16px;
    padding: 5px 10px;
    cursor: pointer;
    color: var(--accent-color);
}

#nai-gallery-grid {
    flex-grow: 1;
    overflow-y: auto;
    padding: 15px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 15px;
}

.nai-gallery-item {
    position: relative;
    display: flex;
    flex-direction: column; 
    align-items: center;    
    gap: 6px;               
    cursor: pointer;
    /* 移除了背景、阴影等属性，因为它们将移到子元素上 */
}
/* 新增：NAI的图片容器，样式模仿 .sticker-image-container */
.nai-image-container {
    position: relative; /* 用于定位内部的 controls */
    width: 100%;
    aspect-ratio: 1 / 1;
    background-color: white;
    border-radius: 10px;
    background-size: contain; /* 核心修改：保持图片完整 */
    background-repeat: no-repeat;
    background-position: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    overflow: hidden; /* 隐藏溢出的 controls */
}

/* 新增：NAI的文字标签，样式模仿 .sticker-name */
.nai-gallery-name {
    font-size: 12px;
    color: var(--text-secondary);
    width: 100%;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.nai-image-container .nai-gallery-controls {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 4px;
    background: rgba(0,0,0,0.4);
    display: none; /* 仅在管理模式下显示 */
    justify-content: space-around;
    align-items: center;
}

.nai-gallery-controls button {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    padding: 2px;
}
.nai-gallery-controls svg {
    width: 16px;
    height: 16px;
}

#nai-gallery-grid.management-mode .nai-gallery-controls {
    display: flex;
}

#nai-gallery-grid.management-mode .nai-gallery-item::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 4px solid transparent;
    border-radius: 10px;
    box-sizing: border-box;
    transition: border-color 0.2s;
    pointer-events: none; 
}

#nai-gallery-grid.management-mode .nai-gallery-item.selected::after {
    border-color: var(--accent-color);
}

#nai-gallery-action-bar {
    display: none; 
    flex-shrink: 0;
    padding: 10px 15px;
    padding-bottom: calc(10px + env(safe-area-inset-bottom));
    background-color: rgba(247, 247, 247, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-top: 1px solid var(--border-color);
    justify-content: space-between; 
    align-items: center;
    gap: 10px; /* <-- 新增了间距 */
}

#nai-gallery-action-bar .select-all-label {
    font-size: 16px;
    color: var(--text-primary);
    cursor: pointer;
    flex-grow: 1; /* <-- 新增，让“全选”占据剩余空间 */
}
#nai-gallery-action-bar .action-bar-btn {
    padding: 10px 15px; /* <-- 修改了内边距 */
    border-radius: 20px;
    border: none;
    font-size: 14px; /* <-- 修改了字号 */
    font-weight: 600;
    cursor: pointer;
    background-color: #ff3b30;
    color: white;
    flex-shrink: 0; /* <-- 新增，防止按钮被压缩 */
}

/* 适配暗黑模式 */
#phone-screen.dark-mode #nai-gallery-panel {
    background-color: rgba(28, 28, 30, 0.85);
    border-top-color: #38383a;
}
#phone-screen.dark-mode #nai-gallery-panel-header {
    border-bottom-color: #38383a;
}
#phone-screen.dark-mode #nai-gallery-grid {
    background-color: #000;
}
#phone-screen.dark-mode #nai-gallery-action-bar {
    background-color: rgba(28, 28, 30, 0.9);
    border-top-color: #38383a;
}
#phone-screen.dark-mode #nai-gallery-action-bar .select-all-label {
    color: #f0f0f0;
}
/* --- NAI 图片重新生成按钮 (V3 - 悬停显示修复版) --- */
.nai-image-wrapper {
    position: relative; /* 关键：必须有这行，用于按钮定位！ */
    display: inline-block;
    line-height: 0;
}

.nai-regenerate-btn {
    position: absolute;
    bottom: 10px; /* 从底部偏移 10px */
    right: 10px;  /* 从右侧偏移 10px */
    width: 32px;
    height: 32px;
    background-color: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    
    /* 核心修复：默认设置为透明，即隐藏 */
    opacity: 0; 
    
    transition: opacity 0.2s ease-in-out;
    z-index: 5;
}

/* 核心修复：当鼠标悬停在 *图片包裹层* 上时，才显示按钮 */
.nai-image-wrapper:hover .nai-regenerate-btn {
    opacity: 0.85; /* 悬停时显示 */
}

/* 按钮本身的悬停效果（变亮） */
.nai-regenerate-btn:hover {
    opacity: 1 !important; /* 确保悬停在按钮上时更亮 */
    background-color: rgba(0, 0, 0, 0.8);
}

.nai-regenerate-btn svg {
    width: 16px;
    height: 16px;
}

/* 加载中状态 */
.nai-regenerate-btn.loading {
    pointer-events: none;
    opacity: 1; /* 加载时强制显示 */
}
.nai-regenerate-btn.loading svg {
    animation: spin 1s linear infinite;
}

/* 修复暗黑模式下的样式 */
#phone-screen.dark-mode .nai-regenerate-btn {
    background-color: rgba(30, 30, 30, 0.7);
    border-color: rgba(255, 255, 255, 0.2);
}
/* --- NAI 图片重新生成按钮 结束 --- */
/* ▼▼▼ 【新功能】手机外框样式 (374x674px 精确版) ▼▼▼ */

/* 1. 手机外框的背景 (你想要的白色) */
body.frame-mode-active {
    background-color: #f0f2f5; /* 保持白色背景 */
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    box-sizing: border-box;
    overflow: hidden; 
}

/* 在暗黑模式下，背景则为浅灰色 */
body.dark-mode.frame-mode-active {
    background-color: #f0f2f5;
}

/* 2. 手机外框本身 (使用你计算的精确尺寸) */
body.frame-mode-active #phone-screen {
    /* 总宽度: 374px
      总高度: 674px
      (这会使内部内容区域精确为 350x650px)
    */
    width: 374px;
    height: 700px;
    
    /* 12px 的黑色边框 */
    border: 12px solid #ffffff;
    
    /* 适配的圆角 */
    border-radius: 54px; 
    
    /* 移除内边距 (padding) 来匹配你的计算 */
    /* padding: 0; (移除) */

    /* 覆盖全屏样式 */
    min-height: auto; 
    max-width: 100%;
    max-height: 95vh; /* 最大高度，防止溢出 */
    box-shadow: inset 0 0 0 1px #000,   
    box-shadow: 0 10px 35px rgba(0, 0, 0, 0.1);
    box-sizing: border-box; 
    position: relative; 
    overflow: hidden; 
}

/* 3. 屏幕内部的圆角遮罩 */
body.frame-mode-active #phone-screen::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    
    /* 内部圆角 (比 54px 小 12px) */
    border-radius: 42px; 
    
    /* 移除内边框，因为它不再需要 */
    /* border: 0; (移除) */
    
    pointer-events: none;
    z-index: 1000; 
    
    /* 添加一个非常细微的内阴影，模拟屏幕玻璃感 */
    box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
}

/* 4. 模拟灵动岛 (Dynamic Island) */
body.frame-mode-active #phone-screen::after {
    content: '';
    position: absolute;
    top: 22px; 
    left: 50%;
    transform: translateX(-50%);
    /* 调整为更协调的灵动岛尺寸 (已缩小) */
    width: 100px;  /* <-- 已从 120px 减小 */
    height: 25px;  /* <-- 已从 28px 减小 */
    background-color: #000; 
    border-radius: 12.5px; /* <-- 调整圆角以保持形状 */
    z-index: 1002; 
}

/* [新增] 当手机外框激活时，等比缩小主屏幕和CPhone内容以适应屏幕 (V3 - 最终布局修复版) */
body.frame-mode-active #home-screen-pages-container,
body.frame-mode-active #char-clock-container,
body.frame-mode-active #char-app-grid {
    transform: scale(0.9);
    transform-origin: top center;
    transition: transform 0.3s ease, margin-top 0.3s ease, margin-bottom 0.3s ease; /* 添加过渡效果 */
}

/* EPhone 主屏幕的布局修正 */
body.frame-mode-active #home-screen-pages-container {
    margin-bottom: -55px;
}
body.frame-mode-active #home-screen-pagination {
    transform: scale(0.9);
}
body.frame-mode-active #desktop-dock {
    transform: scale(0.9);
    margin-bottom: -5px;
}

/* ▼▼▼ CPhone 布局的核心修正 ▼▼▼ */
body.frame-mode-active #char-clock-container {
    /* 替换默认的大间距，给一个适合框内视图的上边距 */
    margin-top: 60px;
    /* 大幅减小下边距，把下面的App图标拉上来 */
    margin-bottom: 50px;
}

body.frame-mode-active #char-app-grid {
    /* 移除之前过于激进的负边距，让它自然排列在时钟下方 */
    margin-top: 0;
}
/* ▲▲▲ 修正结束 ▲▲▲ */
#dynamic-island-content {
    position: absolute;
    top: 22px; /* 与手机外框的刘海伪元素位置完全重合 */
    left: 50%;
    transform: translateX(-50%);
    width: 120px; /* 默认宽度，与刘海一致 */
    height: 28px; /* 默认高度，与刘海一致 */
    background-color: #000;
    border-radius: 14px;
    z-index: 1003; /* 确保在刘海伪元素之上 */
    
    display: flex;
    align-items: center;
    padding: 3px;
    box-sizing: border-box;
    
    /* 核心动画：宽度、透明度的变化都带过渡效果 */
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    
    /* 默认状态：完全透明，不可见，不响应点击 */
    opacity: 0;
    pointer-events: none;
    visibility: hidden;
    overflow: hidden; /* 隐藏内部溢出的内容 */
}

/* 2. 当音乐播放时，灵动岛“展开” */
/* 规则 1: 在有框模式下，调整回刘海的位置并展开 */
body.frame-mode-active #phone-screen.dynamic-island-active #dynamic-island-content {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    width: 190px;
    top: 22px; /* 覆盖默认值，对齐刘海 */
}

/* 规则 2: 在无框模式下，在顶部展开 */
body:not(.frame-mode-active) #phone-screen.dynamic-island-active #dynamic-island-content {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    width: 190px;
    /* (这里会使用我们在第6303行设置的新top值) */
}

/* 3. 同时，隐藏掉原来的刘海伪元素，防止重叠 */
body.frame-mode-active #phone-screen.dynamic-island-active::after {
    opacity: 0;
}

/* 4. 岛内的专辑封面 */
#island-album-art {
    width: 22px; /* 高度28px - 上下各3px内边距 = 22px */
    height: 22px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: 8px;
    flex-shrink: 0; /* 防止被压缩 */
}

/* 5. 歌词的容器，用于裁剪滚动文字 */
#island-lyric-container {
    flex-grow: 1; /* 占据剩余所有空间 */
    overflow: hidden; /* 【关键】裁剪掉超出部分的歌词 */
    white-space: nowrap; /* 【关键】强制歌词不换行 */
}
#island-lyric-container.center-content {
    display: flex;
    justify-content: center;
}
/* 6. 歌词文字本身 */
#island-lyric-text {
    color: #aeaeae; /* 柔和的灰色 */
    font-size: 13px;
    font-weight: 500;
    display: inline-block; /* 动画需要 */
    transition: opacity 0.2s ease-in-out;
}
/* 您可以在 L2910 附近找到 .frame-mode-active 的相关样式
   然后在这附近添加下面的新规则
*/

body.frame-mode-active #main-content-area {
    /* * 在这里修改您想要的距离。
     * 原本是 30px，您可以改成 40px 或 50px 来增大间距。
     * * 请注意：在有框模式下，整个主页被 transform: scale(0.9) 缩小了，
     * 所以您设置 50px，视觉上看起来会是 45px。
     */
    gap:10px; 
}
/* 仅在有框模式下，修改组件距离顶部的间距 */
body.frame-mode-active #main-content-area {
    /* * 原本是 20px。
     * 您可以改成 0px 来让它更靠上，
     * 或者改成 40px 来让它更靠下。
     */
    margin-top: 0px; 
}
/* 仅在有框模式下，调整【第二页】的间距 */
body.frame-mode-active .home-screen-page:nth-child(2) .polaroid-widget-container {
    
    /* 1. 修改这个来调整 [拍立得] 与 [屏幕顶部] 的距离 (原为 20px) */
    /* 您可以改成 0px 或 10px 来让它更靠上 */
    margin-top: 0px;

    /* 2. 修改这个来调整 [拍立得] 与 [下方应用/小组件] 的距离 (原为 30px) */
    /* 您可以改成 40px 或 50px 来增大它们之间的间距 */
    margin-bottom: 10px;
}
/* 【修复】在有框模式下，增加聊天页面头部的顶部内边距，以避开灵动岛 */
body.frame-mode-active #chat-interface-screen > .header {
    /* * 灵动岛区域大约在 22px + 25px = 47px 结束。
     * 我们可以设置 55px 或 60px 来给它留出一些呼吸空间。
     */
    padding-top: 48px !important; 
}
body:not(.frame-mode-active) #phone-screen.dynamic-island-active #chat-interface-screen > .header {
    padding-top: 48px !important;
}
/* --- 歌词循环滚动 (Marquee) 动画 --- */

/* 1. 默认状态：居中 (用于短歌词) */
#island-lyric-container.center-content {
    display: flex;
    justify-content: center;
}
#island-lyric-container.center-content #island-lyric-text.scrolling {
    animation: none; /* 短歌词不需要滚动 */
}
#island-lyric-container.center-content #island-lyric-text span + span {
    display: none; /* 短歌词只显示一个 */
}

/* 2. 滚动容器：内部有两个span */
#island-lyric-text.scrolling {
    /* 使用 --marquee-duration 变量作为动画时长，从JS传入 */
    animation: marquee var(--marquee-duration, 10s) linear infinite;
    display: block; /* 必须是 block 才能应用 transform */
    width: fit-content; /* 确保宽度由内容撑开 */
}

/* 3. 两个span并排 */
#island-lyric-text.scrolling span {
    display: inline-block;
    padding-right: 50px; /* 两个歌词之间的间距 */
    white-space: nowrap;
}

/* 4. 定义动画 */
@keyframes marquee {
    0% {
        transform: translateX(0%);
    }
    100% {
        /* * 滚动 50% 的宽度。
         * 因为我们的总宽度是两个 <span>，所以滚动 50% 
         * 意味着第一个 <span> 刚好完全移出，第二个 <span> 完美接上。
         */
        transform: translateX(-50%); 
    }
}

/* 【新功能】分离状态栏 / 真·全屏模式 v2.0 */

/* 当 body 标签拥有 detach-mode-active 类时，应用以下样式 */
body.detach-mode-active #phone-screen {
    /* 核心修改1：保持固定定位，但只定义三边 */
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;

    /* 核心修改2：这是最关键的一步！
       让元素的顶部从“安全区域的底部”开始，而不是屏幕的绝对顶部。
       env(safe-area-inset-top) 会自动获取刘海或状态栏的高度。*/
    top: env(safe-area-inset-top);

    /* 核心修改3：移除固定的 height 属性，让 top 和 bottom 自动决定高度 */
    height: auto;
    width: auto; /* 同样移除固定的 width */

    /* 移除手机外框样式，实现真正的全屏感 */
    border-radius: 0;
    border: none;
    box-shadow: none;

    /* 其他布局属性保持不变 */
    overflow: hidden;
    display: flex;
    flex-direction: column;
    background-color: var(--secondary-bg);
}

/* 在此模式下，隐藏模拟的刘海和屏幕圆角遮罩，因为我们要显示物理的 */
body.detach-mode-active #phone-screen::after,
body.detach-mode-active #phone-screen::before {
    display: none;
}
/* 【全局修复】将Dock栏和分页点的位置固定在更低的位置，忽略底部安全区 */
#home-screen-pagination {
    /* 移除 calc 和 env() */
    padding-bottom: 10px;
}

#desktop-dock {
    /* 移除 calc 和 env() */
    margin-bottom: 20px;
}
/* ======================================= */
/* ▼▼▼ 【新功能】简洁聊天界面 (Minimal Chat UI) ▼▼▼ */
/* ======================================= */

/* 1. 默认隐藏“+”号展开按钮 */
#chat-expand-btn {
    display: none;
    flex-shrink: 0;
    width: 40px; /* 与发送按钮同高 */
    height: 40px;
    font-size: 28px;
    font-weight: 300;
    line-height: 38px; /* 垂直居中 */
    padding: 0;
    background-color: var(--secondary-bg);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    transition: transform 0.3s ease, background-color 0.2s, color 0.2s;
}

/* 2. 当简洁模式开启时 (body上会有这个class) */
body.minimal-chat-ui-active #chat-input-actions-top {
    /* 默认隐藏工具栏 */
    display: none;
}
body.minimal-chat-ui-active #chat-input-main-row {
    /* 确保“+”按钮和输入框底对齐 */
    align-items: flex-end;
}
body.minimal-chat-ui-active #chat-expand-btn {
    /* 显示“+”按钮 */
    display: flex;
    justify-content: center;
    align-items: center;
}
body.minimal-chat-ui-active #chat-input {
    /* 修复“+”按钮出现后，输入框没有自动适应宽度的问题 */
    flex-grow: 1;
}

/* 3. 当用户点击“+”号，工具栏展开时 (body上会临时添加这个class) */
body.minimal-chat-ui-active.chat-actions-expanded #chat-input-actions-top {
    /* 重新显示工具栏 */
    display: flex;
}
body.minimal-chat-ui-active.chat-actions-expanded #chat-expand-btn {
    /* “+”号旋转45度变成“x”号 */
    transform: rotate(45deg);
    background-color: #f0f2f5;
    color: #8a8a8a;
}
#phone-screen.dark-mode body.minimal-chat-ui-active.chat-actions-expanded #chat-expand-btn {
    background-color: #3e3e42;
    color: #8d8d92;
}

/* 4. 暗黑模式下的“+”按钮 */
#phone-screen.dark-mode #chat-expand-btn {
    background-color: #3e3e42;
    color: #f0f0f0;
    border: 1px solid #38383a;
}
/* ▲▲▲ 简洁聊天界面样式结束 ▲▲▲ */


/* 1. 当简洁模式开启 (且工具栏折叠时)，减小聊天列表的底部内边距 */
body.minimal-chat-ui-active #chat-interface-screen #chat-messages {
    /* 原本是 150px，我们把它缩小到 80px，刚好容纳单行输入框 */
    padding-bottom: calc(80px + env(safe-area-inset-bottom)) !important;
    /* 确保过渡平滑 */
    transition: padding-bottom 0.3s ease;
}

/* 2. 当简洁模式开启 (且工具栏展开时)，恢复原来的内边距 */
body.minimal-chat-ui-active.chat-actions-expanded #chat-interface-screen #chat-messages {
    /* 恢复 150px，为展开的图标行腾出空间 */
    padding-bottom: calc(120px + env(safe-area-inset-bottom)) !important;
}
/* --- 新增：功能锁定样式 --- */
.locked-feature {
    opacity: 0.7; /* 让按钮看起来有点灰 */
    position: relative; /* 为图标定位 */
    cursor: help; /* 鼠标悬停时显示帮助图标 */
}



/* 在暗黑模式下让锁更清晰 */
#phone-screen.dark-mode .locked-feature::after {
    background-color: rgba(0, 0, 0, 0.5);
}
/* 【新功能】PIN码激活弹窗样式 */
#pin-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
    display: none; /* 默认隐藏 */
    justify-content: center;
    align-items: center;
    z-index: 2000;
}

#pin-modal-overlay.visible {
    display: flex; /* 激活时显示 */
}

#pin-modal-content .form-group {
    margin-bottom: 15px;
}

/* 解决您无法复制的问题：让这个输入框看起来像个显示框，但内容可选 */
#pin-device-id-display {
    -webkit-user-select: text; /* 兼容 Safari */
    user-select: text; /* 标准 */
    cursor: text;
    background-color: #f0f2f5;
    color: #555;
    border: 1px dashed #ccc;
    font-size: 14px !important; /* 确保字体大小正确 */
    padding: 10px !important;
}

#phone-screen.dark-mode #pin-device-id-display {
    background-color: #2c2c2e;
    color: #f0f0f0;
    border-color: #38383a;
}

#character-profile-modal .thought-content .text:has(div),
#character-profile-modal .thought-content .text:has(table) {
    padding: 0 !important;
    font-family: inherit !important; /* 恢复默认字体，让卡片自己控制 */
    font-size: inherit !important;
    line-height: normal !important; /* 恢复正常的行高 */
    color: inherit !important;
    background: none !important;
    white-space: normal !important; /* 允许卡片正常换行和布局 */
}
</style>
<script>
const _0xa8c37d=_0x475c;(function(_0xa67b83,_0x54146){const _0x3260e9=_0x475c,_0x4d54fc=_0xa67b83();while(!![]){try{const _0x3d3918=-parseInt(_0x3260e9(0xcf3))/0x1*(parseInt(_0x3260e9(0xfa0))/0x2)+parseInt(_0x3260e9(0xe52))/0x3*(parseInt(_0x3260e9(0x7f1))/0x4)+parseInt(_0x3260e9(0x1137))/0x5+-parseInt(_0x3260e9(0xf5b))/0x6*(-parseInt(_0x3260e9(0x1062))/0x7)+-parseInt(_0x3260e9(0xbad))/0x8*(-parseInt(_0x3260e9(0x9b2))/0x9)+parseInt(_0x3260e9(0x1174))/0xa*(parseInt(_0x3260e9(0x5f1))/0xb)+parseInt(_0x3260e9(0xb85))/0xc*(parseInt(_0x3260e9(0x4f6))/0xd);if(_0x3d3918===_0x54146)break;else _0x4d54fc['push'](_0x4d54fc['shift']());}catch(_0x430e82){_0x4d54fc['push'](_0x4d54fc['shift']());}}}(_0x49d4,0x47925));const ACTIVATION_PIN_URL=_0xa8c37d(0x540);function getDeviceId(){const _0xe5bcb3=_0xa8c37d;let _0x346bd8=localStorage[_0xe5bcb3(0x587)](_0xe5bcb3(0xed5));return!_0x346bd8&&(_0x346bd8=([0x989680]+-0x3e8+-0xfa0+-0x1f40+-0x174876e800)['replace'](/[018]/g,_0x1b09a5=>(_0x1b09a5^crypto[_0xe5bcb3(0xd80)](new Uint8Array(0x1))[0x0]&0xf>>_0x1b09a5/0x4)['toString'](0x10)),localStorage[_0xe5bcb3(0xae8)]('ephoneDeviceId',_0x346bd8)),_0x346bd8;}const EPHONE_DEVICE_ID=getDeviceId();console[_0xa8c37d(0x57e)](_0xa8c37d(0x1417)+EPHONE_DEVICE_ID);let isPinActivated=localStorage[_0xa8c37d(0x587)]('ephonePinActivated')===_0xa8c37d(0x8c3);const translations={'zh-CN':{'save':'保存','cancel':'取消','confirm':'确定','edit':'编辑','done':'完成','add':'添加','back':'返回','next':_0xa8c37d(0x117e),'close':'关闭','reset':'重置','upload':'上传','send':'发送','manage':'管理','share':'分享','delete':'删除','publish':'发布','refresh':'刷新','search':'搜索','remove':'移除','finish':'结束','details':'详情','settings':'设置','title':'标题','content':'内容','category':'分类','name':'名称','description':'描述','status':'状态','ok':'好的','error':'错误','success':'成功','warning':'警告','loading':_0xa8c37d(0x1026),'processing':_0xa8c37d(0x8e7),'pleaseWait':_0xa8c37d(0x11b7),'languageChangedAlert':'语言已切换，页面即将刷新以应用更改。','homeAppQQ':'QQ','homeAppWorldBook':_0xa8c37d(0x11f9),'homeAppAppearance':_0xa8c37d(0x5c1),'homeAppRenderer':_0xa8c37d(0xa10),'homeAppApiSettings':'设置','homeAppFont':'字体','homeAppCPhone':_0xa8c37d(0x971),'homeAppDouban':'豆瓣','homeAppPreset':'预设','homeAppTutorial':'教程','homeAppWerewolf':'狼人杀','homeAppX':'X','chatListTitle':'消息','navMessages':'消息','navQzone':'动态','navMemories':'回忆','navFavorites':'收藏','navNpcList':'NPC','qzoneTitle':_0xa8c37d(0x22a),'qzoneActionShuoshuo':'说说','qzoneActionPost':'动态','qzoneActionAlbum':'相册','cphoneTitleSelect':_0xa8c37d(0x1107),'cphoneAppQQ':'QQ','cphoneAppAlbum':'相册','cphoneAppBrowser':_0xa8c37d(0x122e),'cphoneAppTaobao':'淘宝','cphoneAppMemo':_0xa8c37d(0x443),'cphoneAppDiary':'日记','cphoneAppAmap':_0xa8c37d(0x59e),'cphoneAppUsage':'App记录','cphoneAppMusic':_0xa8c37d(0x114f),'cphoneAppEphone':_0xa8c37d(0x143d),'cphoneAppFootprints':'足迹','cphoneAlbumTitle':_0xa8c37d(0x11cc),'cphoneBrowserTitle':'TA的浏览器历史','cphoneTaobaoTitle':_0xa8c37d(0x8f4),'cphoneWalletTitle':'钱包','cphoneMemoTitle':_0xa8c37d(0x443),'cphoneDiaryTitle':'日记','cphoneUsageTitle':_0xa8c37d(0x87c),'cphoneMusicTitle':_0xa8c37d(0x177),'cphoneArticleTitle':'文章','cphoneSimulatedChatPlaceholder':_0xa8c37d(0x51f),'worldBookTitle':_0xa8c37d(0x11f9),'worldBookEditorTitle':_0xa8c37d(0x718),'worldBookEntryEditorTitle':'编辑条目','worldBookNameLabel':'书名','worldBookCategoryLabel':'分类','worldBookEntriesLabel':_0xa8c37d(0x1152),'worldBookAddEntryBtn':_0xa8c37d(0x1db),'worldBookNamePlaceholder':_0xa8c37d(0x105a),'worldBookImportTitle':_0xa8c37d(0x6c2),'presetTitle':'预设','presetEditorTitle':_0xa8c37d(0xabe),'presetNameLabel':_0xa8c37d(0x9cb),'presetCategoryLabel':'分类','presetEntriesLabel':'内容条目','presetAddEntryBtn':_0xa8c37d(0x1db),'tutorialTitle':'教程','apiSettingsTitle':_0xa8c37d(0x10ee),'languageLabel':'语言','apiPresetManagement':_0xa8c37d(0x13a6),'apiPresetSelectLabel':'选择或切换预设','apiPrimarySettings':_0xa8c37d(0x13f2),'apiProxyUrlLabel':_0xa8c37d(0x4ae),'apiKeyLabel':_0xa8c37d(0xc3d),'apiModelLabel':'模型','apiFetchModelsBtn':_0xa8c37d(0x9b3),'apiSecondarySettings':_0xa8c37d(0x1238),'apiSecondaryProxyUrlLabel':_0xa8c37d(0x123f),'apiSecondaryKeyLabel':_0xa8c37d(0xdea),'apiSecondaryModelLabel':_0xa8c37d(0x51a),'apiFetchSecondaryModelsBtn':_0xa8c37d(0xd00),'apiBgActivitySettings':'后台活动设置','apiEnableBgActivityLabel':_0xa8c37d(0x4bb),'apiBgIntervalLabel':_0xa8c37d(0x7bb),'apiBlockCooldownLabel':_0xa8c37d(0xa39),'apiTtsSettings':_0xa8c37d(0xa74),'apiTtsModelLabel':_0xa8c37d(0x5af),'apiPerformanceSettings':_0xa8c37d(0x20c),'apiChatListRenderWindowLabel':_0xa8c37d(0xc04),'apiChatRenderWindowLabel':_0xa8c37d(0x162),'apiImageGenSettings':_0xa8c37d(0x2f7),'apiEnableImageGenLabel':'启用AI生图功能','apiEnableNovelAILabel':'启用\x20NovelAI\x20图像生成','apiNovelAIModelLabel':_0xa8c37d(0x504),'apiNovelAIKeyLabel':'NovelAI\x20API\x20Key','apiNovelAIGenSettingsBtn':_0xa8c37d(0x1125),'apiNovelAITestBtn':_0xa8c37d(0xa46),'apiStorageOptimization':'存储空间优化','apiCompressImagesBtn':_0xa8c37d(0x437),'apiSaveAllBtn':'保存所有设置','apiExportDataBtn':_0xa8c37d(0x13e7),'apiImportDataBtn':'导入备份文件','apiCleanupDataBtn':_0xa8c37d(0x325),'apiDeleteWorldBooksBtn':_0xa8c37d(0xe2f),'apiAdvancedCleanupBtn':_0xa8c37d(0x496),'apiCheckAndFixDataBtn':'数据检查与修复','chatHeaderOnline':'在线','chatHeaderLongTermMemory':_0xa8c37d(0x7d8),'chatHeaderListenTogether':'一起听','chatHeaderChatSettings':_0xa8c37d(0x1243),'chatSelectionCancel':'取消','chatSelectionScreenshot':'长截图','chatSelectionFavorite':'收藏','chatSelectionShare':'分享','chatSelectionSoftDelete':_0xa8c37d(0x879),'chatSelectionHardDelete':_0xa8c37d(0xb8f),'chatReplyTo':'回复','chatInputPlaceholder':_0xa8c37d(0xf69),'chatWaitForReply':'等待回复','appearanceTitle':_0xa8c37d(0x5c1),'appearanceSaveAll':'保存所有外观设置','fontSettingsTitle':_0xa8c37d(0xf53),'fontPresetManagement':_0xa8c37d(0x341),'fontFileUrlLabel':_0xa8c37d(0xcf6),'fontPreviewLabel':_0xa8c37d(0x7ac),'fontPreviewText1':_0xa8c37d(0x5db),'fontPreviewText2':_0xa8c37d(0x429),'fontSaveAndApply':'保存并应用','fontResetDefault':_0xa8c37d(0x142c),'rendererTitle':_0xa8c37d(0x1540),'rendererEditorTitle':_0xa8c37d(0xeb1),'rendererCreateTitle':_0xa8c37d(0x165),'rendererRuleName':_0xa8c37d(0xce0),'rendererBindScope':'绑定范围','rendererScopeGlobal':_0xa8c37d(0xb9f),'rendererRegex':_0xa8c37d(0xef8),'rendererHtmlTemplate':'HTML\x20模板\x20(用\x20$1,\x20$2\x20引用)','rendererEnableRule':_0xa8c37d(0x720),'myAlbumTitle':_0xa8c37d(0x80f),'albumPhotosTitle':_0xa8c37d(0x1564),'npcEditorTitleAdd':_0xa8c37d(0x370),'npcEditorTitleEdit':_0xa8c37d(0x13e5),'npcAvatarLabel':_0xa8c37d(0x1bb),'npcUploadAvatar':_0xa8c37d(0x590),'npcNicknameLabel':_0xa8c37d(0xd29),'npcPersonaLabel':_0xa8c37d(0x14ec),'npcEnableBgActivity':_0xa8c37d(0x5e3),'npcActionCooldown':'独立行动冷却\x20(分钟)','npcAssociatedChars':'关联的角色\x20(NPC会去评论这些角色的动态)'},'en':{'save':'Save','cancel':_0xa8c37d(0xb1e),'confirm':_0xa8c37d(0x11c1),'edit':_0xa8c37d(0xc89),'done':_0xa8c37d(0x2e1),'add':_0xa8c37d(0x1500),'back':_0xa8c37d(0x143b),'next':_0xa8c37d(0x154e),'close':_0xa8c37d(0x623),'reset':'Reset','upload':_0xa8c37d(0x9e9),'send':_0xa8c37d(0x389),'manage':_0xa8c37d(0xcae),'share':_0xa8c37d(0x8e2),'delete':'Delete','publish':_0xa8c37d(0x154a),'refresh':_0xa8c37d(0x8f2),'search':'Search','remove':_0xa8c37d(0xb76),'finish':_0xa8c37d(0xb37),'details':'Details','settings':_0xa8c37d(0xc63),'title':_0xa8c37d(0x1401),'content':_0xa8c37d(0x1306),'category':'Category','name':_0xa8c37d(0x5c7),'description':_0xa8c37d(0x681),'status':_0xa8c37d(0xe2b),'ok':'OK','error':_0xa8c37d(0xec4),'success':_0xa8c37d(0xa84),'warning':_0xa8c37d(0xdc0),'loading':_0xa8c37d(0xc6d),'processing':_0xa8c37d(0x442),'pleaseWait':'Please\x20wait...','languageChangedAlert':_0xa8c37d(0x94f),'homeAppQQ':'QQ','homeAppWorldBook':_0xa8c37d(0x1512),'homeAppAppearance':_0xa8c37d(0xac2),'homeAppRenderer':_0xa8c37d(0x14b6),'homeAppApiSettings':'Settings','homeAppFont':_0xa8c37d(0xe05),'homeAppCPhone':_0xa8c37d(0x971),'homeAppDouban':'Douban','homeAppPreset':'Presets','homeAppTutorial':_0xa8c37d(0xeb4),'homeAppWerewolf':_0xa8c37d(0x2f1),'homeAppX':'X','chatListTitle':_0xa8c37d(0x498),'navMessages':_0xa8c37d(0x498),'navQzone':_0xa8c37d(0x1221),'navMemories':_0xa8c37d(0x119a),'navFavorites':_0xa8c37d(0xfbd),'navNpcList':_0xa8c37d(0x14a6),'qzoneTitle':_0xa8c37d(0x1221),'qzoneActionShuoshuo':_0xa8c37d(0xe2b),'qzoneActionPost':_0xa8c37d(0x32f),'qzoneActionAlbum':_0xa8c37d(0x3b3),'cphoneTitleSelect':'Select\x20a\x20Phone','cphoneAppQQ':'QQ','cphoneAppAlbum':_0xa8c37d(0x3b3),'cphoneAppBrowser':_0xa8c37d(0xaf6),'cphoneAppTaobao':_0xa8c37d(0xe1e),'cphoneAppMemo':_0xa8c37d(0xa93),'cphoneAppDiary':_0xa8c37d(0xfc2),'cphoneAppAmap':_0xa8c37d(0xffe),'cphoneAppUsage':_0xa8c37d(0xb91),'cphoneAppMusic':_0xa8c37d(0x5a0),'cphoneAppEphone':_0xa8c37d(0x143d),'cphoneAppFootprints':'Footprints','cphoneAlbumTitle':_0xa8c37d(0x1c7),'cphoneBrowserTitle':_0xa8c37d(0xfe0),'cphoneTaobaoTitle':_0xa8c37d(0x9e0),'cphoneWalletTitle':_0xa8c37d(0xb3c),'cphoneMemoTitle':_0xa8c37d(0xa93),'cphoneDiaryTitle':_0xa8c37d(0xfc2),'cphoneUsageTitle':'App\x20Usage\x20Log','cphoneMusicTitle':'Their\x20Playlist','cphoneArticleTitle':'Article','cphoneSimulatedChatPlaceholder':'This\x20is\x20a\x20simulated\x20chat,\x20messages\x20cannot\x20be\x20sent','worldBookTitle':'World\x20Book','worldBookEditorTitle':_0xa8c37d(0x4d0),'worldBookEntryEditorTitle':_0xa8c37d(0x11d5),'worldBookNameLabel':_0xa8c37d(0x1308),'worldBookCategoryLabel':_0xa8c37d(0xe35),'worldBookEntriesLabel':'Content\x20Entries','worldBookAddEntryBtn':_0xa8c37d(0x22f),'worldBookNamePlaceholder':_0xa8c37d(0x10a7),'worldBookImportTitle':'Import\x20World\x20Book','presetTitle':_0xa8c37d(0x10ce),'presetEditorTitle':_0xa8c37d(0x1e0),'presetNameLabel':_0xa8c37d(0x1037),'presetCategoryLabel':_0xa8c37d(0xe35),'presetEntriesLabel':_0xa8c37d(0x34a),'presetAddEntryBtn':_0xa8c37d(0x22f),'tutorialTitle':_0xa8c37d(0xeb4),'apiSettingsTitle':_0xa8c37d(0xe61),'languageLabel':'Language','apiPresetManagement':_0xa8c37d(0xa78),'apiPresetSelectLabel':_0xa8c37d(0x3a0),'apiPrimarySettings':_0xa8c37d(0x843),'apiProxyUrlLabel':_0xa8c37d(0x9aa),'apiKeyLabel':_0xa8c37d(0x3a8),'apiModelLabel':'Model','apiFetchModelsBtn':_0xa8c37d(0x246),'apiSecondarySettings':_0xa8c37d(0x113e),'apiSecondaryProxyUrlLabel':_0xa8c37d(0x528),'apiSecondaryKeyLabel':_0xa8c37d(0x2f9),'apiSecondaryModelLabel':_0xa8c37d(0x315),'apiFetchSecondaryModelsBtn':_0xa8c37d(0xed8),'apiTemperatureLabel':_0xa8c37d(0x2a8),'apiBgActivitySettings':_0xa8c37d(0x133a),'apiEnableBgActivityLabel':_0xa8c37d(0xe57),'apiBgIntervalLabel':_0xa8c37d(0x33b),'apiBlockCooldownLabel':_0xa8c37d(0x14cd),'apiTtsSettings':_0xa8c37d(0xa59),'apiTtsModelLabel':_0xa8c37d(0x7eb),'apiPerformanceSettings':_0xa8c37d(0x799),'apiChatListRenderWindowLabel':'Chat\x20List\x20Batch\x20Load\x20Count','apiChatRenderWindowLabel':_0xa8c37d(0xa6e),'apiImageGenSettings':'Image\x20Generation\x20Settings','apiEnableImageGenLabel':'Enable\x20AI\x20Image\x20Generation','apiEnableNovelAILabel':_0xa8c37d(0xdda),'apiNovelAIModelLabel':_0xa8c37d(0x558),'apiNovelAIKeyLabel':_0xa8c37d(0xaaa),'apiNovelAIGenSettingsBtn':_0xa8c37d(0x15c5),'apiNovelAITestBtn':_0xa8c37d(0x12ff),'apiStorageOptimization':_0xa8c37d(0x1056),'apiCompressImagesBtn':'Compress\x20Local\x20Images','apiSaveAllBtn':_0xa8c37d(0x579),'apiExportDataBtn':_0xa8c37d(0x5d6),'apiImportDataBtn':_0xa8c37d(0x133f),'apiCleanupDataBtn':_0xa8c37d(0x966),'apiDeleteWorldBooksBtn':'Delete\x20World\x20Books','apiAdvancedCleanupBtn':'Advanced\x20Data\x20Cleanup','apiCheckAndFixDataBtn':_0xa8c37d(0x13fe),'chatHeaderOnline':_0xa8c37d(0x897),'chatHeaderLongTermMemory':_0xa8c37d(0x3fc),'chatHeaderListenTogether':_0xa8c37d(0xfa9),'chatHeaderChatSettings':_0xa8c37d(0x914),'chatSelectionCancel':_0xa8c37d(0xb1e),'chatSelectionScreenshot':'Long\x20Screenshot','chatSelectionFavorite':'Favorite','chatSelectionShare':'Share','chatSelectionSoftDelete':'Delete\x20(Notify\x20AI)','chatSelectionHardDelete':_0xa8c37d(0x481),'chatReplyTo':_0xa8c37d(0x1102),'chatInputPlaceholder':_0xa8c37d(0x4f1),'chatWaitForReply':_0xa8c37d(0xa05),'appearanceTitle':'Appearance\x20Settings','appearanceSaveAll':_0xa8c37d(0x13b5),'fontSettingsTitle':'Font\x20Settings','fontPresetManagement':_0xa8c37d(0xf61),'fontFileUrlLabel':_0xa8c37d(0x9c4),'fontPreviewLabel':'Live\x20Preview','fontPreviewText1':'Hello\x20World\x20你好世界','fontPreviewText2':'This\x20is\x20a\x20font\x20preview\x20effect,\x2012345.','fontSaveAndApply':_0xa8c37d(0x72c),'fontResetDefault':_0xa8c37d(0x2cb),'rendererTitle':_0xa8c37d(0xb5e),'rendererEditorTitle':_0xa8c37d(0xb86),'rendererCreateTitle':'Create\x20New\x20Rule','rendererRuleName':_0xa8c37d(0x4f4),'rendererBindScope':_0xa8c37d(0x1403),'rendererScopeGlobal':_0xa8c37d(0x12c7),'rendererRegex':_0xa8c37d(0xb1f),'rendererHtmlTemplate':'HTML\x20Template\x20(use\x20$1,\x20$2)','rendererEnableRule':_0xa8c37d(0xeb7),'myAlbumTitle':'My\x20Albums','albumPhotosTitle':_0xa8c37d(0xfb1),'npcEditorTitleAdd':_0xa8c37d(0x91b),'npcEditorTitleEdit':_0xa8c37d(0xd8b),'npcAvatarLabel':'NPC\x20Avatar','npcUploadAvatar':'Upload\x20Avatar','npcNicknameLabel':_0xa8c37d(0xc69),'npcPersonaLabel':_0xa8c37d(0x1019),'npcEnableBgActivity':_0xa8c37d(0x283),'npcActionCooldown':_0xa8c37d(0xb97),'npcAssociatedChars':_0xa8c37d(0xd63)}};let currentLanguage=_0xa8c37d(0xd02);function setLanguage(_0x50d38a){const _0x39abc6=_0xa8c37d;!translations[_0x50d38a]&&(console['warn'](_0x39abc6(0xc50)+_0x50d38a+_0x39abc6(0x2bf)),_0x50d38a=_0x39abc6(0xd02)),currentLanguage=_0x50d38a,localStorage[_0x39abc6(0xae8)]('ephone-language',_0x50d38a),document[_0x39abc6(0xabf)][_0x39abc6(0x74b)]=_0x50d38a,document['querySelectorAll']('[data-lang-key]')[_0x39abc6(0x59b)](_0x20a06c=>{const _0x18de25=_0x39abc6,_0x3b514d=_0x20a06c[_0x18de25(0xbbf)](_0x18de25(0xf3c));translations[_0x50d38a][_0x3b514d]&&(_0x20a06c[_0x18de25(0x231)]=translations[_0x50d38a][_0x3b514d]);}),document[_0x39abc6(0x14bf)](_0x39abc6(0x176))[_0x39abc6(0x59b)](_0x524c02=>{const _0x4d3708=_0x39abc6,_0x4022bf=_0x524c02['getAttribute'](_0x4d3708(0xef5));translations[_0x50d38a][_0x4022bf]&&(_0x524c02[_0x4d3708(0xced)]=translations[_0x50d38a][_0x4022bf]);}),document[_0x39abc6(0x14bf)](_0x39abc6(0xd07))[_0x39abc6(0x59b)](_0x1b2550=>{const _0x53b53c=_0x39abc6,_0x1e8d2a=_0x1b2550['getAttribute'](_0x53b53c(0x466));translations[_0x50d38a][_0x1e8d2a]&&(_0x1b2550[_0x53b53c(0x156f)]=translations[_0x50d38a][_0x1e8d2a]);});}function initLanguage(){const _0xd8239d=_0xa8c37d,_0x367500=localStorage['getItem']('ephone-language')||_0xd8239d(0xd02),_0x144940=document['getElementById'](_0xd8239d(0x1226));_0x144940&&(_0x144940[_0xd8239d(0x107e)]=_0x367500,_0x144940[_0xd8239d(0x122b)](_0xd8239d(0x1147),_0x15dcf8=>{const _0x593e62=_0xd8239d,_0x3921b2=_0x15dcf8[_0x593e62(0xb57)][_0x593e62(0x107e)];alert(translations[_0x3921b2][_0x593e62(0x53f)]),localStorage['setItem'](_0x593e62(0xac6),_0x3921b2),setTimeout(()=>window[_0x593e62(0x15cb)][_0x593e62(0x100f)](),0x64);})),setLanguage(_0x367500);}(function(){'use strict';const _0xb26254=_0xa8c37d;function _0x563400(_0x38602d,_0x4cbc4a){const _0x4fa00c=_0x475c;try{const _0x4e1e53=document[_0x4fa00c(0x219)]('a');_0x4e1e53[_0x4fa00c(0x4c6)]=_0x38602d,_0x4e1e53[_0x4fa00c(0x1060)]=_0x4cbc4a,_0x4e1e53[_0x4fa00c(0x215)]['display']='none',document[_0x4fa00c(0x8b9)][_0x4fa00c(0x6ce)](_0x4e1e53),_0x4e1e53[_0x4fa00c(0x740)](),setTimeout(()=>{const _0x21ada1=_0x4fa00c;document['body'][_0x21ada1(0xdb3)](_0x4e1e53);},0x64),console[_0x4fa00c(0x57e)](_0x4fa00c(0xf5f),_0x4cbc4a),_0x12f5b8();}catch(_0x2086a0){console[_0x4fa00c(0x127d)](_0x4fa00c(0xbc8),_0x2086a0),_0x12f5b8(_0x4fa00c(0x3ab),_0x4fa00c(0x127d));}}function _0x12f5b8(_0x4a2fdd=_0xb26254(0xb59),_0x5dceed=_0xb26254(0xf76)){const _0x1fffb8=_0xb26254,_0x4a8391=document[_0x1fffb8(0x219)](_0x1fffb8(0xaf9));_0x4a8391['textContent']=_0x4a2fdd,_0x4a8391[_0x1fffb8(0x215)]['cssText']=_0x1fffb8(0x11a1)+(_0x5dceed===_0x1fffb8(0xf76)?_0x1fffb8(0xfbe):_0x1fffb8(0x7a3))+_0x1fffb8(0x1541),document['body']['appendChild'](_0x4a8391),setTimeout(()=>{const _0x4584c6=_0x1fffb8;_0x4a8391['style'][_0x4584c6(0x38d)]='1',_0x4a8391[_0x4584c6(0x215)][_0x4584c6(0x8c6)]=_0x4584c6(0x150c);},0xa),setTimeout(()=>{const _0x42894d=_0x1fffb8;_0x4a8391[_0x42894d(0x215)][_0x42894d(0x38d)]='0',_0x4a8391[_0x42894d(0x215)][_0x42894d(0x8c6)]=_0x42894d(0xefb),setTimeout(()=>{const _0x107716=_0x42894d;_0x4a8391[_0x107716(0xa9c)]();},0x12c);},0x7d0);}function _0xc5e3aa(_0x5190f2){const _0x542d0d=_0xb26254,_0x119e76=_0x5190f2['getAttribute']('title')||_0x5190f2['getAttribute']('alt')||'';let _0x14dae9=_0x119e76[_0x542d0d(0xef0)](/[^a-zA-Z0-9\u4e00-\u9fa5\s]/g,'_')[_0x542d0d(0xef0)](/\s+/g,'_')[_0x542d0d(0x516)](0x0,0x1e);!_0x14dae9&&(_0x14dae9=_0x542d0d(0x532));const _0x59c92e=new Date()[_0x542d0d(0xc66)]()[_0x542d0d(0xef0)](/[-:]/g,'')[_0x542d0d(0xef0)]('T','_')[_0x542d0d(0x23f)]('.')[0x0];return _0x14dae9+'_'+_0x59c92e+_0x542d0d(0x1535);}function _0x364181(_0x55e4cc){const _0x15c476=_0xb26254,_0x3c770c=_0x55e4cc['style']['transform']||'',_0x2d3689=_0x55e4cc[_0x15c476(0x215)]['transition']||'';_0x55e4cc[_0x15c476(0x215)][_0x15c476(0x4dc)]=_0x15c476(0xc6e),_0x55e4cc[_0x15c476(0x215)][_0x15c476(0x8c6)]=_0x15c476(0x458),setTimeout(()=>{const _0x23a0f0=_0x15c476;_0x55e4cc[_0x23a0f0(0x215)][_0x23a0f0(0x8c6)]=_0x3c770c,setTimeout(()=>{const _0x5a0516=_0x23a0f0;_0x55e4cc[_0x5a0516(0x215)][_0x5a0516(0x4dc)]=_0x2d3689;},0x96);},0x96);}let _0x45191b=0x0,_0x30b8c5=null,_0x577c9a=null;document[_0xb26254(0x122b)]('click',function(_0x32af10){const _0xb2b33=_0xb26254,_0xb105b0=_0x32af10['target'];if(_0xb105b0['tagName']===_0xb2b33(0x15b3)&&(_0xb105b0[_0xb2b33(0x159b)][_0xb2b33(0xaea)](_0xb2b33(0x10df))||_0xb105b0['classList']['contains'](_0xb2b33(0x1279)))){_0xb105b0===_0x577c9a?_0x45191b++:(_0x45191b=0x1,_0x577c9a=_0xb105b0);_0x30b8c5&&clearTimeout(_0x30b8c5);if(_0x45191b===0x3){_0x45191b=0x0,_0x577c9a=null,_0x32af10[_0xb2b33(0x32e)](),_0x32af10[_0xb2b33(0x1025)](),console['log'](_0xb2b33(0x147a)),_0x364181(_0xb105b0);const _0x1c0015=_0xb105b0[_0xb2b33(0x9fe)];if(!_0x1c0015||_0x1c0015==='about:blank'){console[_0xb2b33(0xb3b)]('⚠️\x20[NAI下载]\x20图片源为空，无法下载'),_0x12f5b8(_0xb2b33(0x31b),_0xb2b33(0x127d));return;}const _0x1bda14=_0xc5e3aa(_0xb105b0);_0x563400(_0x1c0015,_0x1bda14);}else _0x30b8c5=setTimeout(()=>{_0x45191b=0x0,_0x577c9a=null;},0x1f4);}},!![]),console[_0xb26254(0x57e)](_0xb26254(0x128a)),console[_0xb26254(0x57e)](_0xb26254(0x10f8));}());function _0x49d4(){const _0x596612=['确定要删除这条公告吗？此操作不可恢复。','\x20领取</div>','choice','新建备忘录','save-douban-settings-btn','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>TA的歌单还是空的，<br>点击右上角刷新按钮生成一些歌曲吧！</p>','userStickers','这将用备份文件中的数据【完全覆盖】当前与“','.post-deleted-placeholder','groupMembers','https://api.vkeys.cn/v2/music/tencent/lyric?id=','<div\x20class=\x22announcement-item-actions\x22\x20data-anno-id=\x22','push','\x20<span\x20class=\x22group-tag\x22>群</span>','chara','nai-download-btn','post-actions-btn','isBusy','恢复默认字体','music-return-btn','https://i.postimg.cc/J0b6Nym4/IMG-7279.jpg','openWerewolfLobby','选择导出方式','map','Autoplay\x20was\x20prevented\x20by\x20the\x20browser.','语音生成失败','customAvatarFrames','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22image-size-label\x22>正在计算可压缩图片大小...</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22image-size-value\x22>--\x20MB</span>\x0a\x20\x20\x20\x20','已选择\x20','preset-action-delete','wallpaper-preview','\x20---\x0a','close-reading-btn','Back','\x20条新消息','Ephone','close-playlist-btn','.cart-item-checkbox[data-id=\x22','https://i.postimg.cc/8PsK20jQ/IMG-7236.gif','back-to-clear-step1-btn','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x22>输入关键词或选择日期进行搜索。</p>','最近\x2020\x20条','music-playlist-panel','world-book-content-container','\x20天\x20---','[系统指令：视频通话刚刚结束。请你以角色的口吻，向用户主动发送一两条消息，来自然地总结这次通话的要点、确认达成的约定，或者表达你的感受。]','show-announcement-board-btn','day','你的任务是根据群成员的性格、世界观、参考记忆、最近的动态和当前情景，【选择一个或多个角色】，让他们主动发起一段对话，打破沉默，让群聊重新活跃起来。\x0a#\x20【交互铁律：角色间必须互动！】\x0a1.\x20\x20你的核心任务是**导演一场生动的群聊**，而不仅仅是让角色轮流发言。\x0a2.\x20\x20当有多个角色在同一轮发言时，他们的对话【必须】有逻辑上的前后关联。后面的角色应该**回应、反驳、或补充**前面角色的发言。\x0a3.\x20\x20模拟真实的聊天节奏。可以是一个角色提出问题，另一个角色立刻回答；或者一个角色开玩笑，另一个角色吐槽。\x0a4.\x20\x20你【绝对不能】生成几段毫无关联的独白。这会让对话显得非常机械和不真实。\x20\x20\x20\x20\x20\x20\x20\x20\x0a','成功将角色\x20','\x20的动态\x20(角色)','✅\x20检查完成，未发现任何冗余数据。','AI未能成功描述图片。','short','8px','color','[发送了一条语音，内容是：\x27','worldBooks','pat_message','https://i.postimg.cc/jCVK0fGL/IMG-6890.gif','switch-greeting-group','<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>状态:</strong>\x20','https://i.postimg.cc/pXj9h20L/IMG-7275.jpg','#reading-window\x20.reading-header','-\x20\x20\x20**当前时间**:','chat-header-status','douban-comment-input','<option\x20value=\x22current\x22>当前配置\x20(未保存)</option>','\x22\x20class=\x22preview-frame\x22>','GeminiChatDB','https://i.postimg.cc/k5P1NHcL/55f3e31d8qbc8a02d152b07b99d31567.gif','”的购物习惯...','add-poll-option-btn','拉取模型失败:\x20','world-book-card','getMinutes','</span></div><div\x20class=\x22rp-type\x22>','categoryId','<p>点击“导入”按钮，<br>从本地.txt文件或网络URL加载书籍内容。</p>','linkedWorldBookIds','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22amap-item-address\x22>','编辑消息','group-background-activity-group','manage-product-categories-btn','\x0a\x0a#\x20当前音乐情景...\x0a(省略详细内容，与triggerAiResponse一致)','清空动态时出错:','\x22，并与用户进行面对面的互动。你的任务是创作一段包含角色动作、神态、心理活动和对话的、连贯的叙事片段。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20你必须严格遵守\x20','在这里输入图片描述...','\x20\x20\x0a\x0a#\x20供你参考的上下文\x0a-\x20**你的本名**:\x20\x22','isDragging','所有狼人已被放逐，好人阵营获得了胜利！','group_call_response','clientX','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>还没有任何使用记录。</p>','\x22]\x20.avatar','没有可供重新生成的AI响应。','🖼️\x20[NAI下载]\x20检测到三击NAI图片','**。\x0a\x20\x20\x20\x20-\x20\x20\x20你的帖子和评论内容【必须】自然地体现出对【当前真实时间】的感知。\x0a2.\x20\x20**【禁止扮演用户\x20(最最最高优先级！！！)】**:\x0a\x20\x20\x20\x20-\x20\x20\x20用户的昵称是“','\x20的对话\x20(只读)','https://i.postimg.cc/fTWzQRx8/IMG-6149.gif','#000000','[系统提示：','.qzone-post-delete-action','https://i.postimg.cc/FzqHTBng/IMG-7093.gif','\x20的日记','toggle','解析AI返回的投票JSON时出错:\x20','群里已经安静了\x20','delete-css-preset-btn','ready','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22sticker-binding-checkbox\x22\x20data-chat-id=\x22','existing-sticker-categories-list','pollTimestamp','旁观模式AI尝试使用不存在的表情:\x20\x22','npc-avatar-input','角色专属','product-category-manager-modal',')。红包还未领完，你现在可以使用\x20\x27open_red_packet\x27\x20指令来尝试领取。]','refine-memory-btn-header','limit','对方撤回了一条消息','char-music-progress-bar','char-usage-item','edit-post-btn','api-temperature-slider','cancel-post-action-btn','请先从下拉框中选择一个要删除的预设。','#clear-posts-list\x20.clear-posts-item.selected','\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20你的唯一指令\x0a\x20\x20\x20\x20\x20\x20\x20\x20根据以上所有信息，你【必须】做出决定，并给出符合你人设的理由。你的回复【必须且只能】是一个JSON对象，格式如下:\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x22decision\x22:\x20\x22accept\x22,\x20\x22reason\x22:\x20\x22（在这里写下你同意的理由，比如：好吧，看在你这么真诚的份上，这次就原谅你啦。）\x22}\x0a\x20\x20\x20\x20\x20\x20\x20\x20或\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x22decision\x22:\x20\x22reject\x22,\x20\x22reason\x22:\x20\x22（在这里写下你拒绝的理由，比如：抱歉，我还没准备好，再给我一点时间吧。）\x22}\x0a\x20\x20\x20\x20\x20\x20\x20\x20','</div>','generate-shopping-items-btn','char-diary-detail-content','pending_user_approval','\x22\x20id=\x22','accept-friend-btn','post-local-image-input','歌单已生成，正在从网络获取\x20','预言家已行动，预言家请闭眼。','说说内容不能为空哦！','is-card-like','NPCs','#ff8a80','waimai_order','lyrics-vertical-pos','AI角色无法完成投票，游戏暂停。请点击右上角的“重试”按钮继续。\x0a错误:\x20','announcement-board-modal','\x22(处理后为\x22','AI方','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22douban-post-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22douban-post-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span><svg\x20viewBox=\x220\x200\x201024\x201024\x22><path\x20d=\x22M170.666667\x20170.666667h128v682.666666h-128zM426.666667\x20170.666667h170.666666v682.666666h-170.666666zM725.333333\x20170.666667h128v682.666666h-128z\x22></path></svg>\x20','https://i.postimg.cc/CLz0cJ0d/IMG-7116.gif','currentDay','receiverName','\x20(图片描述:\x20\x22','此功能将扫描数据库，尝试找出并修复“角色在数据库中存在，但未在聊天列表显示”的问题。<br><br><strong>操作通常是安全的，但仍建议在操作前备份数据。</strong>','long-term-memory-screen','\x20\x20-\x20你评论说:\x20','Renderer','NotAllowedError','persona-editor-title','qzone-banner-img','new-category-name-input','music-visual-container','then','close-nai-test-btn','\x0a\x0a#\x20统一世界观设定\x20(以下设定适用于所有参与角色)\x0a','querySelectorAll','existing-groups-list','coverUrl','/v1/chat/completions','audio-player','cancel-gift-recipient-btn','my-avatar-upload-input','✅\x20[NAI核心生成]\x20成功！','member-settings-modal','\x0a---\x20复盘结束\x20---','渲染聊天项\x20[','rp-details-greeting','cursor','moveTo','AI\x20Block\x20Cooldown\x20(hours)','isPlaying','renderApiSettingsProxy','create-poll-modal','lastUpdate','.variation-image-preview','[系统提示：你刚刚成功将自己的备注名修改为了“','[发送了一条语音，内容是：','\x22\x20class=\x22photo-thumb\x22\x20alt=\x22相册照片\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22photo-delete-btn\x22\x20data-photo-id=\x22','search-results-list','...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','》吗？','qzone-post-container','\x0a\x0a\x0a\x0a\x0a#\x20可用指令列表\x0a###\x20思维链\x20(必须作为第一个元素！)\x0a-\x20\x20\x20**`{\x22type\x22:\x20\x22thought_chain\x22,\x20\x22analysis\x22:\x20\x22你对用户上一轮发言的分析...\x22,\x20\x22strategy\x22:\x20\x22你本轮的回复策略...\x22,\x20\x22character_thoughts\x22:\x20{\x22','https://i.postimg.cc/ydwLXx7s/IMG-6562.gif','数据已成功合并！应用即将刷新以应用所有更改。','back-to-list-btn','预设已删除。','将清空选定角色的心声和散记历史。','”，并根据其人设，通过【发布新动态】或【评论/回复帖子】来参与社区互动。\x0a\x0a','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>TA的相册还是空的，<br>点击右上角刷新按钮生成一些照片吧！</p>','https://i.postimg.cc/HWynLK7f/mmexport1751021724230.gif','postType','transfer-action-decline','reset-global-css-btn','blocked_by_user','已切换到新的开场故事！','\x20<small\x20style=\x22color:#007722;\x22>(NPC)</small></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','评论内容不能为空哦！','frame_6','char-album-grid','NPC\x20人设','my-avatar-library-modal','chat-list-action-cancel','API请求失败\x20(','add-char-memo-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sticker-image-container\x22\x20style=\x22background-image:\x20url(','save','请输入有效的图片URL！','-\x20(ID:\x20','\x0a#\x20身份与核心任务\x0a你正在扮演角色“','doubanPosts',')\x20的残缺数据。','正在为角色“','alt','import-preset-input','parts','announcement-item-actions','没有可导出的世界书数据。','originalTimestamp','https://i.postimg.cc/wMxmCZVC/IMG-7099.gif','Add','角色\x20\x22','minimaxApiKey','清理后仍未找到JSON数组。','”回忆TA的相册照片...','key','frameUrl','错误：找不到该成员的个人档案。','default_negative','add-ai-avatar-upload-btn','transcript-entry\x20','\x20张图片。有\x20','translateY(0)','”下，发送了一个表情评论，意思是：“','[V]','确认合并？','.upload-variation-image-btn','导入\x20Tavern\x20AI\x20世界书','World\x20Book','\x22,\x20\x22postId\x22:\x20456,\x22stickerMeaning\x22:\x20\x22表情的含义(必须从可用表情列表选择)\x22}]`\x0a\x20\x20\x20\x20-\x20\x20\x20回复:\x20`[{\x22type\x22:\x20\x22qzone_comment\x22,\x20\x22name\x22:\x20\x22','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','nameHistory','生成豆瓣帖子失败:','</p>','browser-title','昨晚是平安夜','clear-posts-item','frame_7','在角色\x20\x22','狼人杀AI讨论生成失败:','group-avatar-group','abs','.nai-gallery-download-btn','clientY','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22token-count-label\x22>正在计算...</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22token-count-value\x22>--</span>\x0a\x20\x20\x20\x20','<div\x20class=\x22post-content\x22>','video_call_response','选中的商品已成功删除。','进入投票','3.\x20\x20**我看到的公开信息\x20(所有人可见)**:\x0a\x20\x20\x20\x20-\x20**昨晚事件**:\x20','rules-tabs','product-item','lorebook','AI\x20(','请输入标题','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22world-book-group-content\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20的代付请求','candidates','”准备好友申请...','请为这个头像起个名字（例如：春日野餐、学习时间）','template',']\x20的正则表达式无效:','variation-product-image','.png','send-poll-btn','\x20元</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','targetDate','操作成功','flat','#\x20长期记忆\x20(最高优先级，这是群内已经确立的事实，所有角色必须严格遵守)\x0a','从完整链接批量导入','手动总结已完成！新的记忆已添加到“','群成员','https://i.postimg.cc/rF4KYbjj/IMG-5720.gif','渲染规则',';\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2012px\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2012px\x20rgba(0,0,0,0.3);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pointer-events:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateY(20px);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.3s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','https://i.postimg.cc/3NDQ0dWG/image.jpg','startX','通话记录已删除。','50%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-name\x22>','group-video-call-btn','播放被中断，这是正常行为:','\x0a#\x20你的聊天对象（用户）的人设\x0a','Publish','\x20个商品。\x0a\x20\x20\x20\x20-\x20**variations**:\x20每个商品【必须】包含【2到4个】不同的款式。\x0a\x0a#\x20角色与上下文\x20(你的灵感来源)\x0a-\x20**角色名称**:\x20','open-sticker-panel-btn','single-char-background-activity-group','Next','歌曲背景已更新！','pat-animation','.custom-multiselect','ai-frame-grid','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reposted-content-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22duration\x22>','请先选择角色','诊断：在\x20extensions.character_book\x20中找到世界书。','input','抱歉，我拒绝了你的好友申请。','assign-group-select','总结失败','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22post-timestamp\x22>','\x22\x20class=\x22product-image\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-name\x22>','naiSettings','totalTime','cleanup-data-btn','下载失败','\x22\x20触发专属决策流程...','\x20的手机','（可选）输入后缀','相册名称','正在准备...',')，内容摘要是：“','getFullYear','cart-item-checkbox','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-group-btn\x22\x20data-book-id=\x22','#qzone-screen\x20.qzone-content','reading-library-search-input','</span><span\x20class=\x22gift-preview-quantity\x22>x','\x22]\x20','确认压缩图片？','title','(未设置)','https://i.postimg.cc/fRt2SFSn/IMG-4368.gif','\x22\x20class=\x22avatar\x22\x20style=\x22border-radius:\x2050%;\x22></div>','”才能使用\x20\x27open_red_packet\x27\x20指令领取。]','switchToCharScreen','在此修改内容...','reset-custom-css-btn','\x20个商品吗？此操作不可恢复。','\x22\x20(群名)\x20的消息。\x0a4.\x20\x20**禁止出戏**:\x20绝不能透露你是AI或模型。严禁发展线下剧情。\x0a','nai-sampler','proxyUrl','minimal-chat-ui-switch','revokeObjectURL','<p\x20style=\x22grid-column:\x201\x20/\x20-1;\x20text-align:\x20center;\x20color:\x20var(--text-secondary);\x20margin-top:\x2050px;\x22>','\x22\x20class=\x22participant-avatar\x22\x20title=\x22','usageTimeMinutes','messages','诊断：在顶层\x20','\x20[包含','imageUrls','confirm-selective-import-btn','删除商品','确认清理','EPhone-Full-Backup-Streamed-','https://i.postimg.cc/Df1qLzDf/IMG-6927.gif','status','诊断：未在此角色卡中找到任何有效的世界书数据。','message-wrapper\x20system-pat','touchstart','novelai-details','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20核心规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20你的回复【必须】是一个JSON数组，可以包含一个或多个行动对象。每个对象的\x20\x22name\x22\x20字段【必须】是角色的【本名】。你【绝对不能】生成\x20\x22name\x22\x20字段为\x20\x22','replyToDisplayName','删除头像','ai-response-editor-block','upload-image-btn','product-editor-modal','system','（无有效对话记录）','”的聊天记录','complex','\x20\x0a-\x20存活玩家:\x20','\x0a##\x20','\x20的对话','classList','\x0a#\x20刚刚结束的通话记录\x20(最高优先级参考)\x0a你和用户刚刚结束了一场视频通话，以下是完整的通话文字记录。你接下来的回复【必须】与这次通话的内容紧密相关。\x0a---\x0a','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22format-helpers\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27','Character\x20Avatar','请先填写对应的反代地址和密钥','https://i.postimg.cc/DZgMwc1H/817178fdbpf2ff7740dc98e26ab78759.gif','lrc','生成模拟聊天失败:','api-settings-screen','world-book-category-pane','timerId','netease','[系统提示：用户刚刚解除了对你的拉黑。现在你们可以重新开始对话了。]','npc-persona-input','🎬\x20推进剧情','.world-book-group-content','[系统提示：你\x20(','&id,\x20minimaxGroupId,\x20minimaxApiKey','global-bg-input','add-my-avatar-upload-btn','frame-mode-active','werewolf-wait-reply-btn','仅清空\x20','getPropertyValue','IMG','duration','”添加记忆','toLocaleTimeString',',\x20记录数:\x20','novelai-enabled','npcs','product-image-preview','正在接通...','删除预设','notification-bar','\x20的图片消息替换为文字描述...','activePostId','qzone_delete_post','open-reading-library-btn','<div\x20class=\x22source\x22>','图片压缩过程中发生错误:','旁观群聊至少需要选择2个成员。','Generation\x20Settings','https://i.postimg.cc/pddJj9zN/IMG-7094.gif','”，与用户（你的聊天对象）进行一场自然的、生活化的在线聊天。你的所有行为和决策都必须严格围绕你的角色设定展开。\x0a\x0a#\x20输出格式铁律\x20(最高优先级)\x0a-\x20你的回复【必须】是一个JSON数组格式的字符串。\x0a-\x20数组中的【每一个元素都必须是一个带有\x20\x22type\x22\x20字段的JSON对象】。\x0a\x0a#\x20角色扮演核心规则\x0a1.\x20\x20**对话节奏**:\x20模拟真人的聊天习惯，将你想说的话拆分成【多条、简短的】消息。每次回复至少3-8条，且条数不要总是一样。严禁发展线下剧情。\x0a2.\x20\x20**情景感知**:\x0a\x20\x20\x20\x20-\x20**时间**:\x20你必须感知到当前是\x20','create-countdown-modal','导入歌词','导入失败','location','请至少选择一位收礼人。','gameMode','请输入提示词！','is-waimai-request','readingLibrary','gift-recipient-modal','”翻开TA的日记本...','AI们的茶话会','douban-my-comment-avatar','**。','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-waveform\x22>','设置已应用','confirm-final-clear-btn','album-item','聊天界面初始加载条数','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','favorite-diary-btn','创建新规则','model-select','\x20个角色的数据问题！\x0a\x0a聊天列表已为您刷新。','请所有AI角色根据你们的身份和人设开始发言。','导入已取消，因为未提供书名。','后台活动模拟已停止。','reading-library-list','激活码不正确。','心声和散记已更新！','https://i.postimg.cc/85Zsyjwn/IMG-6895.gif','-\x20**时间**:\x20你必须感知到当前是\x20','nai-quality-toggle','ZIP文件内容:','.quoted-message','https://i.postimg.cc/ZYvd1jxf/IMG-6937.gif','请输入有效的金额(必须大于0)！','(无标题)','[data-lang-key-placeholder]','TA的歌单','playerJson','未找到匹配的原始NAI图片(这是新添加的块)，将触发重新生成。','网络图片','AI已将新群头像命名为：“','trans','toBlob','.poll-option-input','https://i.postimg.cc/L6R7x16R/IMG-7278.jpg','</div><div\x20class=\x22transfer-amount\x22>¥\x20','\x0a-\x20**帖子内容摘要**:\x20','songs','https://i.postimg.cc/gk0BmrY0/IMG-4371.gif','contentLines','（无文字内容）','product-category-tab','#sticker-binding-chat-list\x20.sticker-binding-checkbox:checked','beginPath','来自\x20','translateY(','<br><small\x20style=\x22color:\x20#ff8a80;\x20margin-top:\x2010px;\x20display:\x20block;\x22>自动记忆总结失败，可稍后手动尝试。</small>','novelai-settings','openNpcEditor','\x20\x20\x20\x20-\x20我昨晚用毒药毒了\x20','favorites-search-clear-btn','home-screen-pages','#linked-chats-checkboxes-container\x20input:checked','.modal-header\x20span','\x22。\x0a','）进行视频通话。\x0a\x20\x20\x20\x20\x20\x20\x20\x20**','theme','选定范围内的动态已被清空。','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>这里还没有留下任何足迹，<br>点击右上角刷新按钮生成一些记录吧！</p>','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-main-content\x22>','group-cooldown-group','cancel-clear-wizard-btn-step1','\x20小时了。','gomoku-board','chat-at-mention-popup','singer','edit-last-response-btn','countdown-card','”\x20将备注修改为\x20“','var(--text-primary)','createdAt','\x0a-\x20好人胜利：放逐所有狼人。\x0a\x0a#\x20当前游戏状态\x0a-\x20今天是第\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22force-apply-check-btn\x22\x20class=\x22lock-action-btn\x20secondary\x22\x20style=\x22margin-top:\x2010px;\x22>强制触发一次好友申请检测</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-title\x22>','data-clear-step-1','gift-receipt-modal','（当前帖子还没有路人NPC发表评论。）\x0a','此操作将扫描并压缩所有本地上传的图片（Base64格式），将其转换为JPEG以减小体积。这会轻微降低图片质量且【不可恢复】。<br><br><strong>强烈建议在操作前先进行数据备份！</strong>','update-notice.html?_=','lastActionTimestamp','）。]','close-nai-gallery-btn','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x22>公告的原消息已被删除。</p>','确定要从【聊天记录和动态】中永久删除这\x20','https://i.postimg.cc/3NffgJSZ/e09c07034ld7e62266c0a5de6a36ae62.gif','handleWerewolfWaitReply\x20被调用，但用户已死亡。操作被忽略。','sticker','.message-wrapper[data-timestamp]','none','https://i.postimg.cc/HWf1JKzn/IMG-6435.jpg','撤回了一条[','clear-search-btn',',\x20内容摘要:\x20“','未知错误','NPC\x20头像','\x20点赞了动态]','span:last-child','black','preview-bubble-style','EPhone-长截图-','select-all-stickers-checkbox','这是模拟对话，无法发送消息哦~','delete-world-books-list','从角色卡导入\x20(.json/.png)','请开始整合。','btn-danger','Their\x20Album','没有找到可导入的内容。请检查您粘贴的格式是否正确。','create-post-modal','https://i.postimg.cc/L4zwDhTC/IMG-4399.gif',')\x20领取了最后一个红包。红包已被领完，手气王是\x20','photo-viewer-close-btn','waimai-amount','</div><div\x20class=\x22description\x22>','\x20你们之间已经有**','\x0a\x0a现在，请为所有存活的AI角色生成他们的投票决定。','confirmText','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22change-icon-btn\x22>更换</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22\x20style=\x22width:\x2030px;\x20height:\x2030px;\x20border-radius:\x2050%;\x20margin-right:\x2012px;\x20filter:\x20','music-time-counter','###\x20玩家身份配置:\x0a','https://i.postimg.cc/dVLXm3Xf/IMG-6885.gif','上传成功！','onloadend','检测到旧版完整备份文件...','严重警告！','[+]\x20添加新条目','游戏结束','link-content-input','\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**你的任务**:\x20你可以根据对话内容和氛围，使用\x20\x22change_music\x22\x20指令切换到播放列表中的任何一首歌，以增强互动体验。\x0a\x20\x20\x20\x20\x20\x20\x20\x20','select-all-import-types','Edit\x20Preset','my-frame-content','import-preview-list','\x22\x20class=\x22avatar-frame\x22></div>','handlePacketClick','\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20可用表情包\x0a-\x20当你需要发送表情时，你【必须】从下面的列表中【精确地选择一个】含义（meaning）。\x0a-\x20【绝对禁止】使用任何不在列表中的表情含义！\x0a\x20\x20\x20\x20\x20\x20\x20\x20','add-char-diary-btn','请输入一个有效的页码！','nai-custom-proxy-url','保存字体预设','确认精炼','在导演模式中发现一个无效的片段\x20(来自parseAiResponse的文本回退):','-\x20**姓名**:\x20','douban-detail-content','https://i.postimg.cc/NFS4ZyvM/mmexport1751032686953.gif','.name','isSpectatorGroup','\x20的备忘录','清理完成','relative','getElementById','decline-call-btn','生成截图时发生错误，请检查控制台获取详情。','toLowerCase','include','lineTo','https://i.postimg.cc/Y94XWYKd/IMG-6560.gif','无法生成模拟相册，请检查API配置或稍后再试。\x0a错误:\x20','<div\x20class=\x22waimai-user-actions\x22><button\x20class=\x22waimai-decline-btn\x22\x20data-choice=\x22rejected\x22>残忍拒绝</button><button\x20class=\x22waimai-pay-btn\x22\x20data-choice=\x22paid\x22>为Ta买单</button></div>','werewolf-action-bar','\x20(这是你的帖子)','lyrics-offset-input','每晚可以查验一个玩家的身份是好人还是狼人。','你有一瓶解药和一瓶毒药，解药可以救活当晚被杀的玩家，毒药可以毒死任意一名玩家。','fontSize','更换图标','EPhone-Chat-','MB)...','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','exclude','nightActions','请先输入你的发言内容。','qzoneAlbums','fileType','性能与显示设置','\x20被怀疑了，虽然我的逻辑也怀疑TA，但我的表演必须是维护TA的：“我不觉得','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','https://i.postimg.cc/Ss7pM6fW/IMG-4410.gif','生成模拟日记失败:','api-preset-select','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-content-preview\x22>','swipeDirection','覆盖预设','style','\x22></div></div></div><button\x20class=\x22waimai-details-btn\x22>查看详情</button></div>','apiTemperature','请输入头像的图片URL','createElement','chat','\x20张NAI图片吗？此操作不可恢复。','\x20票</span></div></div>','music-search-results-modal','readAsDataURL','first_mes','请先在API设置中配置好（主或副）API。','！请对此事件发表评论。]','preset-action-cancel','\x20的浏览记录','cart-items-list','persona-preset-item','apiConfig','&id,\x20url,\x20name,\x20categoryId','.rules-tab','歌曲查找失败:\x20AI请求的歌曲名\x22','好友动态','[系统提示：用户打开了五子棋棋盘，游戏开始了。]','ephonePinActivated','fill','长截图生成失败:','[+]\x20Add\x20New\x20Entry','.product-item.selected','textContent','\x0a-\x20**你的社交关系\x20(必须参考)**:\x0a','\x20条/个','打包中...','https://i.postimg.cc/FzM1Hgr0/IMG-5717.gif','https://i.postimg.cc/Ssgbv41n/IMG-6876.gif','模拟表情含义\x20\x22','\x22\x20(由\x20','批量导入头像框','cancel-clear-wizard-btn-step2','创建新聊天\x20(第2/2步)','\x22></div>','生成失败:\x20','npcGroups','split','女巫已行动，女巫请闭眼。','appearance-preset-select','global-css-input','display:\x20flex;\x20align-items:\x20center;\x20padding:\x208px\x200;\x20border-bottom:\x201px\x20solid\x20#444;\x20color:\x20white;','finishReason','tts_','Fetch\x20Primary\x20Models','secondaryApiKey','gift','order','personality','api-temperature-value','authorOriginalName','[一张图片，其隐藏文字为：\x22','\x22>-</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22quantity-display\x22>','toFixed','恭喜你，你赢了！','.message-bubble','qzone_like','https://i.postimg.cc/FFCTCzpy/641bad3b3udc599fdb63ca75fde427e5.gif','close-group-manager-btn','create-post-btn','\x20的外卖代付请求（时间戳:\x20','music-playlist-btn','url','[系统提示：你\x20','\x22\x20class=\x22avatar-frame\x22></div></div>','一位朋友','<p\x20style=\x22color:\x20#8a8a8a;\x22>还没有人投票。</p>','无法启动导出，所需的核心库\x20(StreamSaver.js\x20或\x20JSZip)\x20未加载。请检查您的网络连接并刷新页面后重试。','，我的人设很','renderWorldBookScreenProxy','cancelable','confirm-contact-picker-btn','quantity','<option\x20value=\x22\x22>--\x20未分类\x20--</option>','昨晚是平安夜。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22timestamp\x22>','<span\x20class=\x22speaker\x22>','rp-details-summary','这是你们的第一次互动。','list-item','is-transfer','char_book','清理冗余数据时出错:','is-sticker','native','.post-footer,\x20.post-feedback-icons,\x20.post-actions-btn,\x20.post-comments-container,\x20.reposted-content-wrapper','sticker-item','标题:\x20','\x0a###\x20条目:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','本地PIN码验证过程出错:','处理NPC后台活动时出错:','\x20红包已被领完。','#custom-modal-body\x20.format-btn[data-type=\x22text\x22]',';\x20font-style:\x20italic;\x22>','在这里输入图片描述','toArray','\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**你们最后的对话摘要**:\x20','\x22\x20class=\x22avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>','accept-call-btn','删除分类后，该分类下的所有商品将变为“未分类”。确定吗？','npc_','add-group-chat-btn','狼人请选择刀人对象<br><small\x20style=\x22font-weight:normal;\x20font-size:\x2013px;\x22>你的队友是:\x20','编辑“','Enable\x20Independent\x20Background\x20Activity','&nbsp;','📸\x20NovelAI图片生成开始，AI提供的prompt:','无备注','transfer-sender-name','最小帖子数不能大于最大帖子数！','确定要删除NPC\x20“','即将开始下载您的完整备份文件。下载过程中请勿关闭页面。','create-shuoshuo-btn','playlist-body','恭喜！','post-visibility-groups','.lyric-line[data-index=\x22','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','stickerCategoryIds','equalsIgnoreCase','werewolf-game-screen','网络图片\x20(EPhone)','put','phone-screen','createObjectURL','detachStatusBar','[系统提示：用户手动结束了投票！最终结果为：','修复完成！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-bottom:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-weight:\x20500;\x20margin:\x200\x200\x205px\x200;\x22>','red-packet-modal','你通过了“','blocked_by_ai','scrollIntoView','”已向你发送好友申请。请返回聊天列表查看。','scale(0.8)','char-main-time','未选择书籍','保留旧的','input[name=\x22variation-select\x22]:checked','聊天记录','网易云音乐API未返回有效结果:','API\x20Temperature','time-zone-group','auto','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-feedback-icons\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','#\x20【【【群名修改铁律】】】\x0a在修改群名时，新的群名【绝对不能】与以下任何一个群成员的名字完全相同：[','chatActionButtonsOrder','werewolf-game-over-modal','AI狼人团队无法决定目标，游戏暂停。请点击右上角的“重试”按钮继续。','manage-world-book-categories-btn','rules-content-container','已成功注入“切换到线上模式”的系统指令。','posts','转账已被拒收','数据迁移完成！总共修复了\x20','\x0a-\x20**身份**:\x20','add-world-book-entry-btn','...\x22\x0a\x20\x20\x20\x20#一起读书模式\x20|\x20行为铁律\x0a\x20\x20\x20\x201.\x20\x20**角色定位**:\x20你【不是】书中的任何角色，你是【你自己】(','<button\x20id=\x22delete-selected-stickers-btn\x22>删除\x20(0)</button>','random_jottings','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22date\x22>','完成(','在这里输入语音内容','album-photo-input','\x22\x20not\x20found.\x20Defaulting\x20to\x20\x27zh-CN\x27.','friend_request_response','album-art-btn','options','\x0a\x0a现在，请生成包含总余额和购买记录的JSON对象。','</button>','</div><div\x20class=\x22receipt-footer\x22>感谢您的惠顾，欢迎再次光临！</div>','\x0a\x0a#\x20你的商店\x20(你可以为群成员购买礼物):\x0a','chat-actions-expanded','\x0a\x0a#\x20【你的聊天对象（用户）的人设】\x0a-\x20**昵称**:\x20','\x0a-\x20**你的曾用名**:\x20[','*对方按下了接听键...*','Reset\x20to\x20Default\x20Font','用户刚刚接听了你主动发起的视频通话。','https://i.postimg.cc/fRTF24jS/IMG-4430.gif','修改昵称','清理失败','请根据你的设定，生成你的日记内容。','normal','prepend','thought_chain','scrollTop','邀请你视频通话','favorites-search-input','update-notice-confirm-btn','commentsCount','manage-my-avatar-library-btn','”。请你回顾一下你和“','原始消息已删除或不存在','listen-together-btn','确定要删除《','从\x20JSON.data\x20中提取图片数据','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20left;\x20font-size:\x2015px;\x20line-height:\x201.8;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>订单类型:</strong>\x20为TA点单<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>赠送方:</strong>\x20','paused','Done','auto-memory-toggle','分钟前有人聊过。','确定要从你的头像库中删除“','.sticker-item.selected','data:\x20[DONE]','送出礼物','memory-screen-back-btn','#\x20你的社交圈\x20(绑定的NPC)\x0a','ai-frame-tab','\x20(角色)</label>','noneOf','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22post-timestamp\x22>','long','[系统指令：这是一个没有用户参与的群聊，请你们根据各自的人设自由地开始对话。]','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Werewolf','你们的对话刚刚还在继续。','NAI\x20Image','album-screen','delete-group-btn','删除分类后，该分类下的所有预设将变为“未分类”。确定吗？','生图功能设置','modern\x20app\x20icon\x20for\x20','Secondary\x20API\x20Key','.variation-image-input','\x0a#\x20你的社交圈\x20(通讯录)\x0a这是你认识的朋友列表。当你在动态区看到他们的昵称时，他们指的就是这些人。\x0a','[系统提示：用户\x20(','editable-image','https://i.postimg.cc/gkhf597g/IMG-6555.gif','未知设定的NPC','删除世界书失败:','nai-gallery-panel','.sticker-binding-checkbox','unshift','\x22\x20class=\x22avatar\x22><span\x20class=\x22name\x22>','originalPost','comment','\x0a-\x20角色思考:\x20','tables','recipientName','发来了\x20','splice','.loading-spinner','import-data-input','shuoshuo','manage-npc-groups-btn','\x20向对方发起了转账:\x20','\x20首无效歌曲:\x0a\x0a-\x20','图片解压失败:\x20','\x22\x20data-option=\x22','表情包','Secondary\x20Model','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22amap-item-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22amap-item-comment\x22>','\x0a#\x20你的任务\x0a你是一个虚拟生活模拟器。你的任务是扮演角色“','没有找到可导入的内容。','[约定达成]\x20','已同步角色\x20','图片加载中，请稍后重试','\x20首歌曲获取失败:\x0a-\x20','promptSource','borderRadius','下棋历史\x20(x,y坐标均从0开始):\x0a','favorites-edit-btn','\x22>专辑</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22playlist-action-btn\x20lyrics-btn\x22\x20data-index=\x22','\x22\x20data-category-id=\x22all\x22>全部</button>',')\x20的可用表情:\x0a','endsWith','清理冗余数据','确定要永久删除商品\x20“','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22delete-group-btn\x22\x20data-id=\x22','#search-results-list\x20.music-search-checkbox','scenario','小时前','请AI角色们继续进行讨论。','NovelAI生成失败:','total','preventDefault','Post','time-perception-toggle','</td><td\x20class=\x22item-price\x22>¥','change_avatar','douban-detail-post-title','save-npc-btn','<div\x20class=\x22avatar-group\x20','[系统提示：用户刚刚发布了一条动态(ID:\x20','\x20字的核心记忆。这些旧记忆将被替换，此操作不可撤销。确定要继续吗？','https://i.postimg.cc/Mpv5fzm5/IMG-4439.gif','meaning','negative','Background\x20Activity\x20Interval\x20(sec)','请选择一个接收人！','char-browser-item','.participant-avatar-wrapper\x20.participant-avatar','确认删除分类','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22quantity-control\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22quantity-btn\x20decrease-qty-btn\x22\x20data-id=\x22','字体预设管理','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22memo-title\x22>','\x0a#\x20群成员列表\x20(你的总结目标)\x0a','✅\x20清理完成！\x0a\x0a','prototype','novelai-generated-','请输入关键词或选择一个日期。','ai-persona','元,\x20备注:\x20','Content\x20Entries','...\x22','compressed','NovelAI\x20API\x20Key未配置。请在NovelAI设置中填写API\x20Key。','my-frame-grid','[群聊]','照片上传成功！','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22artist\x22>','pause','smea_dyn','save-api-preset-btn','<span\x20class=\x22group-name\x22>','add-sticker-batch-btn','douban-screen','正在开始清理冗余数据，请不要关闭页面...','globalCss','font-preset-select','padding','currentLyricIndex','解析格式模板失败:','正在为角色\x20','custom-bubble-style','favorites-action-bar','block','char-qq-transcript-modal','create_memory','#text-image-mode-content','\x22\x20data-description=\x22','\x20张本地图片<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20成功压缩\x20','¥\x200.00','\x22\x20value=\x22','global-lyrics-bar','找不到匹配的书籍','myPersona','生成模拟歌单失败:','product-description-input','status-bar-toggle-switch','\x20删除了自己的一条动态]','添加\x20NPC','全局设置','default','mouse','\x0a\x0a#\x20你的角色设定\x0a','\x0a\x0a现在，请开始生成这组备忘录。','-\x20**长期记忆\x20(必须参考)**:\x20','https://i.postimg.cc/TYvkKKkc/IMG-6565.gif','通话消息已更新！','appearance','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20width=\x2220\x22\x20height=\x2220\x22\x20fill=\x22currentColor\x22\x20style=\x22vertical-align:\x20middle;\x22><path\x20d=\x22M12\x2021.35l-1.45-1.32C5.4\x2015.36\x202\x2012.28\x202\x208.5\x202\x205.42\x204.42\x203\x207.5\x203c1.74\x200\x203.41.81\x204.5\x202.09C13.09\x203.81\x2014.76\x203\x2016.5\x203\x2019.58\x203\x2022\x205.42\x2022\x208.5c0\x203.78-3.4\x206.86-8.55\x2011.54L12\x2021.35z\x22></path></svg>','image/jpeg','\x0a\x0a\x0a','文件解析或应用失败:\x20','preset-name-input','hasOwnProperty','请输入投票问题！','好的，我明白了。我会严格遵守以上所有规则和设定。','member-management-item','image-upload-input','shopping-product-count-input','secondary-proxy-url','请用文字描述您要发送的照片：','https://i.postimg.cc/ZnzbGdxX/IMG-7239.gif','JSZip库未加载','Send','守卫请睁眼，请选择要守护的玩家。','confirm-share-link-btn','clear-chat-btn','opacity','npc-group-select','findLastIndex','\x22\x20class=\x22participant-avatar\x22\x20alt=\x22','群昵称不能为空！','死亡了','char-memo-detail-screen','**\x0a\x0a#\x20核心规则\x0a1.\x20\x20**【视角铁律】**:\x20你的总结【必须】使用【主观的第一人称视角\x20(\x22我\x22)】来写。\x0a2.\x20\x20**【内容核心\x20(最高优先级)】**:\x20你的总结【必须】专注于梳理以下几点：\x0a\x20\x20\x20\x20*\x20\x20\x20**建立时间线**:\x20将所有独立的记忆点串联起来，形成一个有时间顺序的事件脉络。\x0a\x20\x20\x20\x20*\x20\x20\x20**整合关键信息**:\x20总结出我们共同经历的关键事件、做出的重要决定、以及约定好的未来计划。\x0a\x20\x20\x20\x20*\x20\x20\x20**识别未完成项**:\x20明确指出哪些计划或任务尚未完成。\x0a3.\x20\x20**【时间转换铁律\x20(必须遵守)】**:\x20如果记忆中提到了相对时间（如“明天”、“下周”），你【必须】结合“今天是','</span></div><div\x20class=\x22gift-items-preview\x22>','，我的看法是...\x20我【必须】回应...\x0a3.\x20\x20**S\x20(Social\x20-\x20社交表演)**:\x20我要如何用我的【人设】和【社交关系】来包装我的发言？\x0a\x20\x20\x20\x20-\x20(例如：我的好友\x20','</div><div\x20class=\x22transfer-note\x22>','读书会话已关闭。','\x20的红包已被领完','AI在处理你的好友申请时出错了，请稍后重试。\x0a错误信息:\x20','existing-product-categories-list','给你准备了一个红包','#333','span:first-child','Fetch\x20failed:\x20','Select\x20or\x20Switch\x20Preset','globalChatBackground','命名头像框','📝\x20使用','message-editor-block\x20variation-block','totalElapsedTime','</span></div>','video-call-main','API\x20Key',')，此功能暂不支持。','\x0a\x0a#\x20可用资源\x0a-\x20\x20\x20**你的头像库**:\x0a\x20\x20\x20\x20','下载失败，请重试','\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20你的任务\x0a\x20\x20\x20\x20\x20\x20\x20\x20你是一个群聊AI导演。你现在控制着一个名为“','werewolf-game-btn','\x0a###\x20正在模拟\x20','.lyric-line','member-name-input','确定要删除相册《','char-music-screen','Album','rules-tab','\x22><div\x20class=\x22rp-header\x22><img\x20src=\x22https://files.catbox.moe/lo9xhc.png\x22\x20class=\x22rp-icon\x22><span\x20class=\x22rp-greeting\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22timer\x22\x20data-target-date=\x22','home-screen','share-target-modal','无法生成歌单，请检查API配置或稍后再试。\x0a错误:\x20','nai-diffusion-4','css-preset-select','\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20用户的角色\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20**','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','persona',')\x20送出了一份礼物，收礼人是：','https://i.postimg.cc/RhGH0vpt/IMG-7010.gif','start','<div\x20class=\x22post-likes-section\x22><svg\x20class=\x22like-icon\x22\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M20.84\x204.61a5.5\x205.5\x200\x200\x200-7.78\x200L12\x205.67l-1.06-1.06a5.5\x205.5\x200\x200\x200-7.78\x207.78l1.06\x201.06L12\x2021.23l7.78-7.78\x201.06-1.06a5.5\x205.5\x200\x200\x200\x200-7.78z\x22></path></svg><span>','dynamic-island-music-toggle-switch','https://i.postimg.cc/pT2xKzPz/album-cover-placeholder.png','.\x20你可以参考这个时间，并根据你的角色设定，【考虑】是否开启一个新话题来问候用户。\x0a','member-management-screen','外观预设','结束发言','\x0a-\x20**世界观**:\x20','items','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-block-btn\x22\x20title=\x22删除此款式\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20grid;\x20grid-template-columns:\x201fr\x201fr;\x20gap:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22font-size:\x200.8em;\x22>款式名称</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22variation-name-input\x22\x20placeholder=\x22例如:\x20红色\x22\x20value=\x22','</option>','douban-cast-modal','https://i.postimg.cc/3JSG5Jv5/IMG-7014.gif','save-theme-preset-btn','**:\x20\x22','catch','randomJottings','set','quote_reply','🚀\x20发送NAI请求:','member-avatar-input','cancel-member-settings-btn','target_timestamp','**内容:**\x0a','退款来自\x20','<div\x20class=\x22transfer-card\x22><div\x20class=\x22transfer-title\x22>','notification-avatar','new_name','headers','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22last-msg\x22>','chatId','\x0a\x0a#\x20【【【五子棋核心规则与强制思考步骤\x20(最高优先级指令！)】】】\x0a\x0a###\x20**【【【落子铁律\x20(绝对禁止！)】】】**\x0a你【绝对不能】选择一个棋盘上已经是\x201\x20或\x202\x20的坐标。你的落子点【必须】是\x200。\x0a---\x0a\x0a###\x20**第一步：逻辑分析\x20(内部思考，不要输出)**\x0a\x0a1.\x20\x20**【规则定义】**:\x20\x0a\x20\x20\x20\x20-\x20\x20\x20棋子:\x201代表用户(黑棋)，2代表你(白棋)。\x0a\x20\x20\x20\x20-\x20\x20\x20获胜条件:\x20横、竖、斜线上有【连续五个】自己的棋子。\x0a\x0a2.\x20\x20**【防守分析\x20(必须执行)】**:\x0a\x20\x20\x20\x20-\x20\x20\x20**检查用户(1)是否有“四子连线”的威胁？**\x20如果有，我必须下在哪个坐标才能堵住？\x0a\x20\x20\x20\x20-\x20\x20\x20**检查用户(1)是否有“活三”的威胁？**\x20如果有，最佳的防守点是哪里？\x0a\x0a3.\x20\x20**【进攻分析\x20(必须执行)】**:\x0a\x20\x20\x20\x20-\x20\x20\x20**检查我(2)是否有“一步胜利”的机会？**\x20(即已有四子连线)\x20如果有，我应该下在哪里？\x0a\x20\x20\x20\x20-\x20\x20\x20**检查我(2)是否有制造“活四”或“双三”的机会？**\x20如果有，最佳的进攻点是哪里？\x0a\x0a###\x20**第二步：决策与扮演\x20(内部思考，不要输出)**\x0a\x0a1.\x20\x20**【决策】**:\x20综合以上攻防分析，我的最佳棋步是落在坐标\x20(x,\x20y)。\x0a\x0a2.\x20\x20**【融入角色扮演】**:\x0a\x20\x20\x20\x20-\x20\x20\x20我的性格是：(在此处回顾你的人设)。\x0a\x20\x20\x20\x20-\x20\x20\x20根据我的性格，我应该：\x0a\x20\x20\x20\x20\x20\x20\x20\x20a)\x20**(聪明/好胜型)**\x20下在刚刚分析出的最佳位置。\x0a\x20\x20\x20\x20\x20\x20\x20\x20b)\x20**(迷糊/放水型)**\x20故意选择一个次优的位置，但【前提是不能让用户立刻获胜】。\x0a\x20\x20\x20\x20\x20\x20\x20\x20c)\x20**(其他性格)**\x20根据性格特点，选择一个合理的棋步。\x0a\x0a3.\x20\x20**【构思台词】**:\x20根据我选择的棋步和我的性格，我应该说一句什么样的台词来评论棋局？\x0a\x0a---\x0a###\x20**第三步：生成最终回复\x20(你的唯一输出)**\x0a\x0a现在，根据你第二步的最终决策，生成你的行动。\x0a-\x20\x20\x20你的回复【必须且只能】是一个JSON数组。\x0a-\x20\x20\x20**绝对不要**在最终回复中包含任何上述的思考过程。\x0a-\x20\x20\x20格式:\x20`[{\x22type\x22:\x20\x22gomoku_move\x22,\x20\x22name\x22:\x20\x22你的角色本名\x22,\x20\x22x\x22:\x20(0-14),\x20\x22y\x22:\x20(0-14)},\x20{\x22type\x22:\x20\x22text\x22,\x20\x22content\x22:\x20\x22你的台词...\x22}]`\x0a','请为这组提示词预设命名：','NovelAI生成','mouseup','\x0a现在，请严格按照格式铁律，生成聊天记录的JSON数组。','.pagination-dot','chat-input','decode','edit-call-message-btn','#chat-list-bottom-nav\x20.nav-item','https://i.postimg.cc/kMfPQBwQ/IMG-4396.gif','<span\x20style=\x22color:\x20red;\x22>未满足</span>','qzone_comment','\x22\x20title=\x22编辑\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M11\x204H4a2\x202\x200\x200\x200-2\x202v14a2\x202\x200\x200\x200\x202\x202h14a2\x202\x200\x200\x200\x202-2v-7\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M18.5\x202.5a2.121\x202.121\x200\x200\x201\x203\x203L12\x2015l-4\x201\x201-4\x209.5-9.5z\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x20delete-memory-btn\x22\x20data-author-id=\x22','qzone-post-item','动态发布成功！','导入成功！','应用已切换到后台，记录当前时间。','”申请好友时发生错误：\x0a\x0a','\x22\x20class=\x22naiimag-image\x22\x20alt=\x22图片','<div\x20class=\x22post-comments-container\x22>','isOfflineMode','选中的消息均已收藏过。','”的特点生成专属商品...','命名头像','<p\x20style=\x22text-align:center;\x20color:\x20#8a8a8a;\x20margin-top:\x2050px;\x22>点击右上角\x20\x22+\x22\x20或群组图标添加聊天</p>','UTF-8\x20解码成功。','Long-term\x20Memory','animationend','island-album-art','将清空选定角色的所有动态、评论和点赞。','avatar_prompt','相册\x20\x22','你输了','\x22><div\x20class=\x22member-name\x22>','\x0a\x0a##\x20世界书:\x20','chat-list-bottom-nav','guardedId','prev-page-btn','删除\x20(','未知的分享卡片类型:','”，并根据其人设、记忆和最近的互动，挑选出【14到18首】最能代表TA此刻心情或品味的歌曲。\x0a\x0a#\x20核心规则\x0a1.\x20\x20**创造性与合理性**:\x20歌单必须完全符合角色的性格、爱好和生活背景。\x0a2.\x20\x20**多样性**:\x20歌曲风格可以多样，但必须逻辑自洽。\x0a3.\x20\x20**格式铁律\x20(最高优先级)**:\x20\x0a\x20\x20\x20\x20-\x20你的回复【必须且只能】是一个JSON数组格式的字符串。\x0a\x20\x20\x20\x20-\x20你的回复必须以\x20`[`\x20开始，并以\x20`]`\x20结束。\x0a\x20\x20\x20\x20-\x20【绝对禁止】在JSON数组前后添加任何多余的文字、解释、或\x20markdown\x20标记\x20(如\x20```json)。\x0a\x20\x20\x20\x20-\x20数组中的每个元素都是一个对象，代表一首歌，格式【必须】如下:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20[\x0a\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22songName\x22:\x20\x22歌曲的准确名称\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22artistName\x22:\x20\x22歌曲的准确艺术家/歌手名\x22\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20]\x0a\x20\x20\x20\x20```\x0a\x0a#\x20供你参考的上下文\x0a-\x20**你的角色设定**:\x20','API为空回，角色\x20\x22','发现新版本通知:\x20','这是你们最近的对话：\x0a','不支持的文件格式。请选择\x20.json\x20或\x20.png\x20文件。','text','NovelAI设置已保存！','clear','用户删除了自己的评论，开始清理AI记忆...','page-indicator','📋\x20请求体:','new-sticker-category-name-input','locationName','https://i.postimg.cc/cJtpZCB3/IMG-6894.gif','\x0a#\x20【【【逻辑隔离与TGS三核思考\x20(最高优先级指令)】】】\x0a为了兼顾游戏逻辑和角色扮演，你【必须】在内部为【每一个AI角色】按顺序执行以下“三阶段思考”：\x0a\x0a##\x20阶段1：内部独立思考\x20(Internal\x20Monologue\x20Scratchpad)\x0a(这部分内容【绝对不能】出现在你最终的JSON输出中，这仅供你内部模拟使用)\x0a','---\x20狼人杀对局完整复盘\x20---\x0a\x0a','select-message-btn','》添加歌词吗？','werewolf-lobby-modal','https://i.postimg.cc/SNByPrf9/IMG-7005.gif','selection-share-btn','memory-card','input[name=\x22theme-select\x22]:checked','theme-preset-select','正在重试\x22','utf-8','char-memo-detail-title','variation-increase-qty','\x22]:checked','**\x0a\x20\x20\x20\x20\x20\x20\x20\x20**通话前的聊天摘要\x20(这是你们通话的原因，至关重要！)**:\x0a\x20\x20\x20\x20\x20\x20\x20\x20','NPC\x20\x22','这是字体预览效果，12345。','-\x20**即将演唱**:\x20','participant-avatars-grid','<p\x20style=\x22text-align:center;\x20color:\x20#8a8a8a;\x22>这次通话没有留下文字记录。</p>','send_private_message','setTimeout','chatItem','无法生成商品，请检查(主/副)API配置或稍后再试。\x0a错误:\x20','点击了商品卡片:\x20','导演模式下重新生成NAI图片失败:','view','variation-decrease-qty','确定要删除选中的\x20','生成模拟App使用记录失败:','一键压缩本地图片','#message-editor-container\x20textarea','offline_text','正在根据“','无法从\x20SSE\x20响应中提取图片数据','showWaimaiDetails:\x20找不到消息或消息类型不正确','无法重新生成','center-content','.share-target-checkbox:checked','manage-frames-btn','在聊天\x20\x22','Processing...','备忘录','\x22)\x20为键的内心独白。\x0a###\x20核心聊天指令\x0a-\x20\x20\x20**发文本**:\x20`{\x22type\x22:\x20\x22text\x22,\x20\x22content\x22:\x20\x22你好呀！\x22}`\x0a-\x20\x20\x20**发表情**:\x20`{\x22type\x22:\x20\x22sticker\x22,\x20\x22meaning\x22:\x20\x22表情的含义(必须从可用表情列表选择)\x22}`\x0a-\x20\x20\x20**发图片**:\x20`{\x22type\x22:\x20\x22ai_image\x22,\x20\x22description\x22:\x20\x22详细中文描述\x22,\x20\x22image_prompt\x22:\x20\x22图片的【英文】关键词,\x20用%20分隔,\x20风格为风景/动漫/插画/二次元等,\x20禁止真人\x22}`\x0a','.json','请先在购物车中选择要结算的商品。','<p\x20class=\x22char-browser-image-description\x22>','\x22:\x20\x22你此时的详细内心活动...\x22}}`**\x0a\x20\x20\x20\x20-\x20\x20\x20**analysis**:\x20简要分析用户的意图或聊天的氛围。\x0a\x20\x20\x20\x20-\x20\x20\x20**strategy**:\x20你的计划（例如：安抚用户、转移话题、发起一个功能）。\x0a\x20\x20\x20\x20-\x20\x20\x20**character_thoughts**:\x20必须包含一个以你本名\x20(\x22','</div><div\x20class=\x22countdown-label\x22>剩余支付时间<div\x20class=\x22countdown-timer\x22\x20id=\x22waimai-timer-','这个\x20Tavern\x20AI\x20世界书中没有找到任何有效的条目。','\x0a##\x20世界书《','散记编辑已取消，心声的修改也未保存。','ai-avatar-library-title','\x0a-\x20**最近与用户的互动**:\x20','.delete-block-btn','AI返回的内容中未找到有效的JSON对象。','dynamic-island-content','borderBottom','char-qq-screen','#listen-together-btn\x20img','https://i.postimg.cc/L5RLr3tg/mmexport1751035976943.gif','件商品','getTime','scale(0.95)','nai-seed','radio','确定要删除分类《','”，并根据其人设、记忆和最近的互动，虚构出【10到20条】TA最近的浏览器搜索/浏览记录。\x0a\x0a#\x20核心规则\x0a1.\x20\x20**创造性与合理性**:\x20记录必须完全符合角色的性格、爱好、职业和生活环境。\x0a2.\x20\x20**多样性**:\x20记录类型要丰富，可以是帖子、文章、新闻、问答等。\x0a3.\x20\x20**【格式\x20(最高优先级)】**:\x20\x0a\x20\x20\x20\x20-\x20你的回复【必须且只能】是一个JSON数组格式的字符串。\x0a\x20\x20\x20\x20-\x20你的回复必须以\x20`[`\x20开始，并以\x20`]`\x20结束。\x0a\x20\x20\x20\x20-\x20【绝对禁止】在JSON数组前后添加任何多余的文字、解释、或\x20markdown\x20标记\x20(如\x20```json)。\x0a\x20\x20\x20\x20-\x20数组中的每个元素都代表一条浏览记录，并且【必须】使用以下格式:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20[\x0a\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22text\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22title\x22:\x20\x22一个引人注目的文章或搜索标题\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22url\x22:\x20\x22一个虚构的、看起来很真实的网址\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22一篇200-400字的、详细的文章或帖子正文，支持换行符\x5cn。\x22\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20]\x0a\x20\x20\x20\x20```\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20**【绝对禁止】**:\x20你的回复中【绝对不能】包含\x20\x22type\x22:\x20\x22image\x22\x20的对象。所有记录都必须是文字内容。\x0a\x0a#\x20供你参考的上下文\x0a-\x20**你的角色设定**:\x20','getMonth','rp-content-group','。请你对此作出回应，可以表现出好奇、开玩笑（比如\x27我截图了！\x27）、或者根据你的人设表示理解或疑惑。]','\x0a-\x20散记:\x20','.avatar','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22color:\x20#8a8a8a;\x20margin:\x200\x200\x2010px\x200;\x22>账户余额</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:\x2032px;\x20font-weight:\x20600;\x20color:\x20#1f1f1f;\x20margin:\x200;\x22>¥','offsetParent','is-acting','正在开始全面压缩图片，根据图片数量，这可能需要几分钟时间，请不要关闭或刷新页面...','data-lang-key-title','请修改记忆要点：','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:\x2012px;\x20color:\x20#888;\x20margin:\x204px\x200\x200;\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-price\x22>','showPhoneFrame','update_thoughts','删除日记','...\x22)','确认生成','createWriteStream','\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20src:\x20url(\x27','--chat-font-size','确定要永久删除分类\x20“','我明白，覆盖所有数据','\x20分享了一张NovelAI图片，prompt:\x20','无法生成足迹，请检查API配置或稍后再试。\x0a错误:\x20','row','生成模拟相册失败:','where','此操作将永久删除\x20','\x0a#\x20---\x20世界书设定结束\x20---\x0a','API\x20请求失败:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-price\x22>¥','.edit-memory-btn','replyToName','上一条消息的发送时间是\x20','https://image.novelai.net/ai/generate-image-stream','Erase','toCollection','https://i.postimg.cc/W1CjLb4J/IMG-4409.gif','已取消收藏。','\x0a\x0a#\x20当前情景\x0a','[表情]','payload','undefined','span','预设导入被取消:','<label><input\x20type=\x22checkbox\x22\x20value=\x22user\x22>\x20','my-avatar-library-grid','imageUrl','devicePixelRatio','char-browser-article-screen','内容因安全策略被屏蔽。触发类别:\x20','isOpen','notification-content','请稍候','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-group-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22arrow\x22>▼</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-name\x22>','setProperty','高级数据清理','友善的评论是交流的起点','Messages','一位成员','import-new-book-btn-header','消息内容已复制到剪贴板。','已阵亡，还有30秒爆炸','equals','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22cart-item-checkbox\x22\x20data-id=\x22','https://i.postimg.cc/B6KD52vz/IMG-7096.gif','clear-posts-modal','.product-item','trim','\x22\x20rows=\x224\x22\x20style=\x22width:\x20100%;\x20padding:\x208px;\x20border-radius:\x206px;\x20border:\x201px\x20solid\x20#ccc;\x20font-size:\x2016px;\x20box-sizing:\x20border-box;\x20resize:\x20vertical;\x22>','waimai_request','📤\x20发送请求到\x20NovelAI\x20API',',\x20价格:\x20¥','JSZip\x20流错误:','\x22>×</span>','gift-recipient-list','发生了一个错误，AI未能成功响应。\x0a\x0a错误详情:\x0a',']类型的消息。\x0a内容:\x20','\x20的新头像同步到群聊\x20\x22','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','反代地址\x20(不需要添加/v1噢~)','请先在API设置中配置好API信息。','https://i.postimg.cc/pXxk1JXk/IMG-6442.jpg','暂停了音乐','maxMemory','qzone-nickname','狼人已行动，狼人请闭眼。','\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','**[夜晚]**\x20平安夜。\x0a','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-title\x22>','https://i.postimg.cc/DZshzKv6/IMG-5576.gif','dragging','\x22><svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M20.84\x204.61a5.5\x205.5\x200\x200\x200-7.78\x200L12\x205.67l-1.06-1.06a5.5\x205.5\x200\x200\x200-7.78\x207.78l1.06\x201.06L12\x2021.23l7.78-7.78\x201.06-1.06a5.5\x205.5\x200\x200\x200\x200-7.78z\x22></path></svg></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22action-icon\x20favorite\x20','启用后台角色活动','https://files.catbox.moe/q6z5fc.jpeg','[系统提示：用户(','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-group-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22arrow\x22>▼</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-name\x22>','https://i.postimg.cc/g0s1V0PX/IMG-4402.gif','postTitle','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','切换开场将会【清空并替换】当前的所有聊天记录。确定要继续吗？','linked-memory-selection','chat-settings-btn','.nav-item[data-view=\x22qzone-screen\x22]','href','https://i.postimg.cc/HLZNWkQw/mmexport1751031767634.gif','\x20发送了一张图片，内容是：\x27','padEnd','本次发送给AI的【挂载记忆】内容如下：\x0a','width','\x20.message-bubble.ai\x20$1','解析器：已启用\x20Markdown\x20提取模式。','\x0a\x20\x20-\x20**人设**:\x20','（你目前没有绑定的NPC伙伴，可以自由创造新的NPC。）\x0a','Edit\x20World\x20Book','跳过一个无法解析为JSON的编辑块:','豆瓣设定','请输入背景图片的URL',')\x20发起了群视频通话请求。请你们各自决策，并使用\x20\x22group_call_response\x22\x20指令，设置\x20\x22decision\x22\x20为\x20\x22join\x22\x20或\x20\x22decline\x22\x20来回应。]','linked-memory-count','close-shared-history-viewer-btn','cancel-red-packet-btn','#5b3a29','自定义数量...','.char-photo-item','智能导出\x20(单个大文件，太大可能会导致导入不了)','transition','.unread-count','imageProcessed','\x20发布了一条新公告','--music-bg-image','qzone_post','summaries','border','送给\x20','用户向你发送了一张图片','.toggle-content-btn','announcement-action-cancel','load-more-chats-btn','draggable-button-item','bulkAdd','background-activity-switch','这将用文件中的数据【完全覆盖】您当前所有的世界书和分类。此操作不可撤销！','Http_Get_External','getHours','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22font-size:\x200.8em;\x22>价格\x20(元)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20class=\x22variation-price-input\x22\x20min=\x220\x22\x20step=\x220.01\x22\x20value=\x22','生成模拟备忘录失败:','Type\x20a\x20message...','<p\x20style=\x22text-align:center;\x20color:#8a8a8a;\x20margin-top:50px;\x22>还没有可以拉进群的联系人哦~</p>','”\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20**被拉黑前的最后对话摘要**:\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Rule\x20Name','touchend','7150oACLJz','阵营胜利！','is-link-share','regenerate-btn','add-npc-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','minimaxVoiceId','cors_proxy','本地歌曲源错误:','#\x20场景设定\x0a','\x22\x20发布了动态','成功将群聊\x20\x22','memoryTimestamp','recalled_message','NovelAI\x20模型','后台活动模拟已启动，间隔:\x20','\x20个会话中。','charId','1024x1024','ai-avatar-library-grid','npc-list-back-btn','a\x20random\x20product','favorite-item-card','hasShown40','char-background-activity-switch','精炼完成，请确认','gift-receipt-body','preset_','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x22>暂无支出记录。</p>','这个分类下还没有商品哦~','writeText','recipient','substring','https://i.postimg.cc/hj4dkrvj/IMG-5578.gif','”吗？拉黑后您将无法向其发送消息，直到您将Ta移出黑名单，或等待Ta重新申请好友。','cssText','副模型','https://i.postimg.cc/d0WCKxff/IMG-6932.gif','.char-screen.active','.sticker-category-tab','...”)','这是模拟对话，无法发送消息','正则表达式格式错误:\x20','文章内容已复制！','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22slider\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-block-btn\x22\x20title=\x22删除此条目\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22\x20style=\x22margin-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22font-size:\x200.8em;\x22>备注\x20(可选)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22entry-comment-input\x22\x20value=\x22','\x20其中包括以下投票：','wb_','frame_5','pin-input','world-book-name-input','Secondary\x20Proxy\x20URL','https://i.postimg.cc/nryNzTXK/IMG-6915.gif','JSZip库未加载，请刷新页面重试','已成功加入购物车！','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','werewolf-kill-modal','\x20被投票放逐。','onpause','character-nai-positive','bg-input','NAI_Image','create-new-member-btn','20px','\x0a-\x20**角色人设**:\x20','gomoku-btn','图片格式处理失败:\x20','save-font-btn','preset-action-edit','https://i.postimg.cc/cJpbtPWq/mmexport1751036607799.gif','link-description-input','qzone-posts-list','preset-avatar-input','authorAvatarPrompt','languageChangedAlert','https://gist.githubusercontent.com/cx3300-1/f04ec50b5e8f2d88365d17ff35efffcf/raw/cd28d8825c5c34ea10bda8a4518a1a6a1f5a7d13/pin.txt','currentIndex','https://i.postimg.cc/VkV2bLNw/IMG-6853.gif','group-avatar-preview','”分享TA的备忘录...','renderXSocialScreenProxy','line-through',':</strong>\x20','++id,\x20chatId,\x20timestamp,\x20customName','.realimag-image','persona-editor-modal','all','cancel-create-poll-btn','#post-public-text','album-photos-title','角色专属NAI提示词已保存！','photo-viewer-modal','压缩步骤\x202/3:\x20正在内存中异步压缩图片，这可能需要一些时间...','动态内容已复制到剪贴板。','offsetX','char-music-artist','minimize-reading-btn','https://i.postimg.cc/GmcqjZn8/IMG-6566.gif','pin-modal-overlay','NovelAI\x20Model','\x20\x20\x20[+]\x20最终正面提示词:','cancel-shopping-settings-btn','\x0a\x20\x20\x20\x20-\x20**今日讨论**:\x20','清空购物车','novelai-key-toggle','\x0a#\x20长期记忆\x20(所有角色必须严格遵守)\x0a','https://i.postimg.cc/50k390X8/IMG-6376.gif','playlist','商店空空如也，点击“管理”添加商品吧！','检测到AI执行了动态操作，立即刷新好友动态页面。','https://i.postimg.cc/y8p9s3Jj/IMG-6919.gif','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22delete-group-btn\x22\x20data-id=\x22','albumId','character-nai-prompts-btn','ephoneLastActiveTimestamp','lyrics-position-group','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22douban-post-timestamp\x22>','.nai-regenerate-btn','\x20个表情吗？此操作不可恢复。','product-editor-title','open-memory-screen-btn','已死亡','is-poll','novelai-test-modal','1.0','clear-cart-btn','...\x20[记忆:\x20','/9j/','characterId','通话记录','请输入你想对“','message-editor-block','Save\x20All\x20Settings','.\x20\x0a\x0a将保留旧图片，但提示词会更新。','island-lyric-container','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px\x2018px\x205px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2013px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20500;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20var(--text-secondary);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20#f0f2f5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-top:\x201px\x20solid\x20var(--border-color);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-bottom:\x201px\x20solid\x20var(--border-color);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x205px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','[语音]','log','加载失败','即将开始打包您的完整备份文件。文件将以ZIP格式流式下载，请勿关闭页面。','已恢复默认字体。','rule-regex-input','压缩完成！','npcGroupId','repost-cancel-btn','【用户\x20(User)】','getItem','activeChatId','chats','length','未知的备份类型。','isMinimized','autoMemoryInterval','isHidden','删除\x20(0)','上传头像','chat-list-action-delete','你们正在一起读书。','playlist-item','temp_npc_chat','\x20本世界书','\x20.message-bubble\x20$1','my-nickname-group','全部记忆\x20(','char-diary-list','cancel-call-message-action-btn','forEach','music-player-avatar-display','isUserParticipating','高德地图','\x22,\x20ChatID:\x20','Music','这是所有玩家都能听到的【公开信息】。\x0a','sticker-category-manager-modal','char-music-list','.photo-delete-btn','rp-group-total','reject-friend-btn','waimai-timer-','天，救人概率为\x20','targetId','file','announcements','<span\x20class=\x22spoiler\x22>$1</span>','shopping-screen','typing-indicator','语音模型\x20(Model)','offlineMinLength','公用规则','渲染X社交页面','我们和好吧！','add-world-book-btn','\x22\x20(核心身份，用于指令中的\x27name\x27字段)\x0a-\x20\x20\x20**用户给你的备注**:\x20\x22','https://i.postimg.cc/fLTc42dg/IMG-4391.gif','input[value=\x22user\x22]','save-wallpaper-btn','anyOf','message-bubble\x20system-bubble','网易云音乐搜索失败:','offline','favorites-delete-selected-btn','share-link-btn','\x0a-\x20','https://i.postimg.cc/nhcC21Rc/IMG-6148.gif','外观设置','</div></div>','reading-content','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>','toLocaleDateString','昨天\x20','Name','delete-selected-frames-btn','charAt','<p\x20style=\x22text-align:center;\x20color:\x20#8a8a8a;\x22>还没有创建任何世界书</p>','char-main-date','slice','typing-status','为了确保所有数据同步，建议立即刷新页面。','groupName','[♪\x20','请按照以下格式粘贴，一行一个：\x0a\x0a头像框名字1:\x20https://.../image1.png\x0a头像框名字2:\x20https://.../image2.gif','name','删除对话','link-title-input','清空所有动态\x20(危险)','Export\x20Data','write','#ff4d4d','请至少输入2个有效的投票选项！','label[for=\x22','你好世界\x20Hello\x20World','未找到\x20chatID:\x20','sticker-category-tabs','rules-category-pane','character_thoughts','无标题','获取AI狼人目标失败:','用户\x20(','启用独立后台活动','\x0a-\x20**你的长期记忆**:\x0a','请为这个头像起个名字（例如：开心、哭泣）','element','probability','https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756262526935_qdqqd_4uque3.jpeg','人局，身份为\x20','发生了一个错误:\x20','wolfKill','https://i.postimg.cc/3Rb46fRZ/IMG-6923.gif','\x22\x20class=\x22avatar\x22><div\x20class=\x22info\x22><div\x20class=\x22name\x22>','”。\x0a\x20\x20\x20\x20\x20\x20\x20\x202.\x20\x20**格式**:\x20你的回复【必须】是一段描述性的文本。\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20当前情景\x0a\x20\x20\x20\x20\x20\x20\x20\x20你正在和用户（','\x22\x20class=\x22ai-generated-image\x22\x20alt=\x22','\x22>×</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','176MLPAiU','hours','</small>','」的新会话吗？','inline-block','dynamic-font-style','target_name','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22action-icon\x20like\x20','doubanMaxPosts','https://i.postimg.cc/CKgDNYVb/IMG-5577.gif','longTermMemory','bookId','网络请求失败:\x20','https://i.postimg.cc/bNdk33SN/IMG-4893.gif','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22token-count-label\x22>预估总上下文Token数:</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22token-count-value\x22><strong>\x20','AI返回的内容中未找到有效的JSON数组。原始返回:\x20','red_packet','这将提取当前通话记录发送给AI进行总结，会消耗API额度。确定要继续吗？','lastOpened','分组\x20\x22','enableBackgroundActivity','-\x20**对话状态**:\x20上次互动于\x20','字体URL不能为空！','.chat-list-item[data-chat-id=\x22','loading','聊天记录已成功分享到\x20','test','category','选中的头像框已成功删除。','frame-item','draggable','未检测到BOM，尝试使用\x20UTF-8\x20解码...','mode','正在执行清理操作，请不要关闭页面...','toLocaleString','正在发牌...','\x20\x20-\x20在群聊“','max','图片详情','amount','selective-import-modal','[图片，描述:\x20','new-product-category-name-input','\x0a\x0a现在，请开始生成这组足迹记录。','导入数据时出错:','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memo-content-preview\x22>','”的身份，开始你的回忆梳理与精炼。','下在(','indexOf','participant','Close','\x0a#\x20【写作风格铁律\x20(最高优先级)】\x0a你【必须】严格遵守以下“预设”中的所有规则和风格来描写。它的优先级高于你的基础人设。\x0a---\x0a','.waimai-details-btn','<p\x20style=\x22text-align:center;\x20color:\x20#8a8a8a;\x20margin-top:\x2050px;\x22>点击右上角\x20\x22+\x22\x20创建你的第一本世界书</p>','从CPhone推进真实对话失败:','.lyrics-btn','...','world-book-entries-container','创建ZIP流时出错:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20[分享的聊天记录结束]\x0a\x20\x20\x20\x20\x20\x20\x20\x20---\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x20MB</strong></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','characterPositivePrompt','规则名称和正则表达式不能为空！','pending','无法生成内容，请检查API配置或稍后再试。\x0a错误:\x20','#f9f9f9','”。请你回顾一下刚才和\x20“','font','\x20个分类。\x0a\x20\x20\x20\x20-\x20**products**:\x20每个分类下生成\x20','https://i.postimg.cc/bJDMQVkj/IMG-7112.gif','API预设','announcement-board-content','regenerate-char-music-btn','》设定\x20(你可以将其中角色作为聊天对象):\x0a','hasShown10','\x20条消息吗？这会通知AI这些消息已被删除。','isEnabled','-\x20**昵称:\x20','timeZone','sendQzoneStickerComment:\x20找不到帖子:','<p\x20style=\x22color:\x20var(--text-secondary);\x20font-size:\x2013px;\x22>还没有回应</p>','char-music-cover','NAI_Gallery_Batch_','https://i.postimg.cc/05DLr0yj/IMG-4427.gif','hiddenText','nai-smea','startY','删除相册','change_remark_name','\x20(时长:\x20','.remove-option-btn','call-history-back-btn','\x20拍了拍\x20“','rp-group-count','\x0a##\x20阶段2：生成最终对话\x20(Final\x20JSON\x20Output)\x0a你现在已经为【所有AI角色】都完成了“TGS三核”独立思考。\x0a请根据你在“阶段C：最终发言稿”中为每个角色准备好的草稿，生成最终的、符合格式的JSON数组。\x0a','https://i.postimg.cc/Pq2xJN1g/IMG-7301.jpg','10px\x2015px\x2020px\x2015px','manage-preset-categories-btn','https://i.postimg.cc/gj3Tmqz5/mmexport1751030241029.gif','char_diary','https://i.postimg.cc/yN3s8szM/IMG-4400.gif','world-book-tab\x20active','marginTop','正在合并非标对象到\x20','.unread-indicator','\x27>文本</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27','https://image.novelai.net/ai/generate-image','创建群聊','isDeleted','\x27刚刚在你的动态“','</div><div\x20class=\x22gift-footer\x22>共','qzone-avatar-input','photo-viewer-next-btn','[你发送了一张需要AI识别的图片，图片内容是：\x27','Cphone','defineProperty','\x0a-\x20**','sticker-category-tab','global','选择性导入失败:','reading-window','cart-title','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-group-content\x22></div>\x0a\x20\x20\x20\x20','ai-response-editor-container','ZIP\x20Blob\x20大小:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22action-icon\x20repost\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M17\x202.1l4\x204-4\x204\x20M3\x2011.5v-3a4\x204\x200\x200\x201\x204-4h13\x20M7\x2021.9l-4-4\x204-4\x20M21\x2012.5v3a4\x204\x200\x200\x201-4\x204H4\x22></path></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>','[系统提示：你于时间戳\x20','remove-member-btn','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22comment-delete-btn\x22\x20data-comment-index=\x22','复制成功','分享的聊天记录已损坏。','\x22>词</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20【核心新增】在这里添加“背景”按钮\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22playlist-action-btn\x20bg-btn\x22\x20data-index=\x22','nextElementSibling','flexDirection','nai-test-negative','group','stickerCategories','\x20是同一个分组的好友。\x0a','请输入你想为Ta设置的【备注名】(例如:\x20哥哥)','\x20/\x20','groupId','checkout-btn','\x22><div\x20class=\x22poll-option-bar\x22\x20style=\x22width:\x20','原作者','Description','https://i.postimg.cc/vHDNGfT2/35ac7f372v588bf48d4f659077196b85.gif','手慢了','正在归档最后一个切片\x20','image','\x0a#\x20你的任务\x0a你是一个虚拟的、极具创造力的商品规划师。你的任务是为下面的角色“','shared-history-viewer-content','配置错误','你赢了','更换“','</span>\x20:\x20<span>','add-song-local-btn','right','image/','<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20当前角色状态:\x20<strong>','some','无法生成日记，请检查API配置或稍后再试。\x0a错误:\x20',',\x20跳过...','song','</p></div><table\x20class=\x22receipt-items-table\x22><thead><tr><th\x20class=\x22item-name\x22>商品</th><th\x20class=\x22item-qty\x22>数量</th><th\x20class=\x22item-price\x22>单价</th><th\x20class=\x22item-subtotal\x22>小计</th></tr></thead><tbody>','https://i.postimg.cc/sXwm8Yzg/IMG-7234.gif','.comment-item','werewolf-witch-selection-list','<div\x20class=\x22avatar-with-frame\x22><img\x20src=\x22','currentPage','请根据以上设定开始你的决策。','rejected','无法解析预设文件。\x0a错误:\x20','call-message-actions-modal','appIcons','”的参考记忆','---\x20','当前群聊还没有公告哦。','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a#\x20你的任务\x0a你是一个虚拟生活模拟器和故事作家。你的任务是扮演角色“','）的话题来问候用户，可以表达惊讶（“哇，好久不见！”）、关心（“最近怎么样？”）或者分享你自己的近况，绝对不要延续之前的话题！\x0a-\x20**上下文参考**:\x20下面的“对话历史”仅供你回忆，【不要】直接回应其中的内容。','add','https://i.postimg.cc/g2PfbSFm/IMG-6556.gif','QQ音乐','shared-history-viewer-title','settings','保存成功','编辑时重新生成NAI图片失败:','enableTts','@[[','save-world-book-btn','spectator-edit-btn','toggle-fullscreen-btn','change_music','\x20发起了外卖代付请求，商品是“','【原动态内容:\x20','请根据以上情景，生成新的评论。','.photo-thumb','prompts','\x0a\x0aAI原始返回内容:\x0a','linear-gradient(135deg,\x20#89f7fe,\x20#66a6ff)','）刚刚撤回了一条消息。撤回前的内容是：','当前时间是\x20','innerText','AI返回的投票结果中未找到有效的JSON数组结构\x20(`[...]`)。','🤖\x20AI\x20思维链:','该预设包含\x20','currentVoiceId','[这是你上一轮的内部思考]\x0a-\x20分析:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20gap:\x208px;\x20flex-shrink:\x200;\x20margin-left:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x20edit-memory-btn\x22\x20data-author-id=\x22','currentTarget','导入世界书','string','\x20->\x20','.progress-bar','https://i.postimg.cc/jS8tc9wW/IMG-7083.gif','usage-item','.delete-btn','https://i.postimg.cc/tgR6wjBP/IMG-5570.gif','-\x20**','导入世界书时出错:','getBoundingClientRect','<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20系统心跳计时器:\x20','appendChild','at-mention-item','无法为不存在的分类打开绑定模态框:','confirm-delete-world-books-btn','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22douban-post-content\x22>','所有切片已打包，开始流式下载ZIP...','\x0a-\x20**人设\x20(必须严格遵守)**:\x20','import-appearance-btn','local-song-upload-input','\x20回复了你。','novelai-switch','\x20条消息，AI将完全遗忘它们的存在。确定吗？','\x20\x20-\x20评论:\x20','处理通话请求时API出错:','lastFailedAction','isFullyClaimed','核心库\x20(JSZip\x20或\x20StreamSaver)\x20未能成功加载，请检查您的网络连接并刷新页面后重试。','无结果','totalPages','正在请求网易云音乐API:','.incoming-call-content\x20.caller-text','isPinned','\x22\x20成功发布了一条新动态。','\x22\x20处于行动冷却中\x20(还剩\x20','(空)','.thought-delete-btn','delete-world-books-modal','\x20\x20\x20\x20-\x20我的解药：',']\x20[最近对话:\x20','\x27)\x22\x20data-comment=\x22','price','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>还没有创建任何NPC，<br>点击右上角“+”添加第一个吧！</p>','请输入新的内容：','&id,\x20isGroup,\x20groupId,\x20isPinned,\x20memos,\x20diary,\x20appUsageLog,\x20lastIntelligentSummaryTimestamp','提取的图片大小:','rule-name-input','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22font-size:\x200.8em;\x22>款式图片\x20(可选)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22avatar-upload\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22variation-image-preview\x22\x20src=\x22','isAlive','char-article-content','frame_12','”，金额是\x20','\x20分钟)</span>','ttsCache','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20grid-column:\x201\x20/\x20-1;\x22>画廊还是空的，快去生成一些图片吧！</p>','外观设置已保存并应用！','粘贴歌词','simulatedConversations','---\x20第\x20','nai','\x0a####\x20阶段\x20B：TGS\x20融合思考\x20(Task-Game-Social)\x0a1.\x20\x20**T\x20(Task\x20-\x20游戏任务)**:\x20基于我的身份和秘密，我的【逻辑目标】是\x20(例如：找出狼人\x20/\x20悍跳预言家\x20/\x20隐藏身份\x20/\x20保护队友\x20/\x20攻击','back-from-member-management','狼人杀\x20-\x20','byteLength','custom_proxy_url','discussionLog','typeId','clear-posts-list','.message-editor-block','无法自动播放静音音频（这在iOS首次加载时是正常现象）:','.sender','\x20中找到世界书。','main','\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20你的任务\x0a\x20\x20\x20\x20\x20\x20\x20\x20你现在扮演一个名为\x22','点击查看详情...','custom-modal-body','cphone-icon-settings-grid','确认操作','.message-wrapper','link-memory-toggle','chat-list-render-window-input','等待对方处理','offlinePresetId','**[讨论环节]**\x0a','npc','编辑世界书','.chat-group-content:last-of-type','\x0a\x0a[系统指令：请根据你在上面读到的规则和以下最新信息，开始你的独立行动。]\x0a','char-qq-conversation-screen','border-box','https://i.postimg.cc/8k7YSLjK/1689aa46aqc4b9ffc0f970e668f56537.gif','确定要删除这条渲染规则吗？','char-wallet-screen','启用规则','转账给\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','https://i.postimg.cc/PJppkbvn/IMG-6918.gif','.comment-send-btn','arc','分组名不能为空！','一条动态','werewolf-game-title','您正和「','callHistory','状态已更新','Save\x20and\x20Apply','AI返回的刀人目标格式不正确。','相册名称不能为空！','.info','https://i.postimg.cc/rmB17Qbc/IMB-f-VDf-Fc.gif','找到图片文件:','<option\x20value=\x22','”。只有“','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22comment-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','initiator','packet_timestamp','select-all-music-search',')。详情:\x20','regenerate-call-btn','download-selected-nai-gallery-btn','”中，用户的昵称是“','song_name','请按照以下通用格式粘贴，一行一个：\x0a\x0a开心:\x20https://.../happy.gif\x0a哭泣:\x20https://.../cry.png\x0a\x0a','translateY(0px)','【完全导入】将删除您当前的所有数据并替换为备份文件中的内容。此操作不可撤销！<br><br><strong>确定要继续吗？</strong>','click','NAI\x20Prompt\x20已改变，将触发重新生成。','--animation-duration','group_summary_from_',';\x22>','import_card','dataset','input[name=\x22visibility\x22]:checked','send-waimai-request-btn','天核心议题','<span\x20style=\x22color:\x20green;\x22>已开启</span>','lang','https://i.postimg.cc/wjH180kn/IMG-5566.gif','我已了解风险，确认压缩','sort','++id,\x20timestamp,\x20authorId','https://i.postimg.cc/63NmX03s/IMG-4366.gif','#\x20可用群头像列表\x0a','https://i.postimg.cc/Ss3znzk7/IMG-6934.gif','values','请根据你的设定，生成你的歌单。','participantId','复制失败','avatarFrame','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-actions-btn\x22>…</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','cart-count','primaryKeys','getWriter','\x20(最后互动于\x20','天\x20-\x20夜晚','收到数据，类型:','本日核心议题','\x0a##\x20---\x20来自','.frame-item','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22lock-text\x22>你已将“','-selection-list','message-bubble\x20','close-persona-library-btn','export-data-btn','请输入要精炼的最近记忆条数\x20(最多\x20','update_status','nai-gallery-grid','#settings-preview-area','offline-preset-select','”，并根据其人设、记忆和最近的互动，虚构出【1篇】TA今天可能会写的日记。\x0a\x0a#\x20核心规则\x0a1.\x20\x20**【【【时间铁律\x20(最高优先级)】】】**:\x0a\x20\x20\x20\x20-\x20\x20\x20今天的日期是\x20**','enable-ai-drawing-switch','发送好友申请','所有歌曲链接均有效，无需清理！','导出数据时出错:','流程启动','getDate','\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20你的任务\x0a\x20\x20\x20\x20\x20\x20\x20\x20你现在是一个场景描述引擎。你的任务是扮演\x20',']。当在对话历史中看到这些名字时，它们都指的是【你】自己。','”，价值','删除分类后，该分类下的所有世界书将变为“未分类”。确定要删除吗？','小红书','werewolf-player-avatar','import-world-book-input','lrcUpdateInterval',')**:\x20','今天\x20','最近支出','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22url\x22>','\x20是我的重要互动对象（用户）。\x0a','\x22\x20被唤醒，准备独立行动...','frame-action-bar','artistName','onloadedmetadata','直接使用\x20base64\x20数据','selection-cancel-btn','复制失败:','创建世界书','请你对此作出回应。]','对方本名不能为空！','secondaryProxyUrl','shopping-back-btn','部分导入失败','\x22\x20data-category-id=\x22uncategorized\x22>未分类</button>','.gift-card','\x0a\x0a#\x20最近的动态列表\x20(供群内角色参考和评论):\x0a','小组风格','shoppingProductCount','data:image','批量导入头像','transfer-actions-modal','AI\x20尝试使用一个不存在的表情:\x20\x22','contactType','password','切片\x20','Performance\x20&\x20Display\x20Settings','repost-modal','message-wrapper\x20','高级数据清理失败:','fetch-secondary-models-btn','Response\x20status:','<span\x20class=\x22lock-text\x22>好友申请已发送，等待对方通过...</span>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20justify-content:\x20flex-end;\x20align-items:\x20center;\x20gap:\x2010px;\x20margin-bottom:\x205px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22toggle-switch\x22\x20title=\x22启用/禁用此条目\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22entry-enabled-switch\x22\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20长期记忆\x20(最高优先级，这是群内已经确立的事实，所有角色必须严格遵守)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','AI女巫决定使用毒药，目标是:\x20','#f44336','https://i.postimg.cc/FHRcCGfH/IMG-4418.gif','caller-name','toggle-blur-btn','游戏配置：','https://i.postimg.cc/bw4wxW2z/IMB-16r-COL.gif','heartfelt_voice','请为这张图片起一个简洁的、适合作为头像库标签的名字。例如：“微笑自拍”、“阳光下的猫咪”、“蓝发动漫少女”。请直接回答名字，不要加任何多余的解释。','预设分类','实时预览','”的视频通话，然后用【第一人称\x20(\x22我\x22)】的口吻，总结出一段简短的、客观的、包含关键信息的记忆。\x0a\x0a#\x20当前时间\x0a-\x20**今天是：','gridEl','book_','shiftKey','\x0a\x0a#\x20当前情景\x0a-\x20**当前真实时间**:\x20','\x22\x20处于行动冷却中，本次独立行动跳过。','打开预设编辑器时发生严重错误:','\x22\x20的消息。严格遵守每个角色的设定，禁止出戏。\x0a-请根据当前情景和你的情绪，从列表中【选择一个最合适的】表情含义来使用\x20\x22sticker\x22\x20指令。尽量让你的表情丰富多样，避免重复。\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20你的可选行动指令:\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**发送文本**:\x20\x27{\x22type\x22:\x20\x22text\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22content\x22:\x20\x22文本内容\x22}\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**发送表情**:\x20\x27{\x22type\x22:\x20\x22sticker\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22meaning\x22:\x20\x22表情的含义(从可用表情列表选择)\x22}\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**发送图片**:\x20\x27{\x22type\x22:\x20\x22ai_image\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22description\x22:\x20\x22图片的详细【中文】描述\x22,\x20\x22image_prompt\x22:\x20\x22图片的【英文】关键词,\x20用%20分隔,\x20风格为风景/动漫/插画/二次元等,\x20禁止真人\x22}\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**发起投票**:\x20\x27{\x22type\x22:\x20\x22poll\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22question\x22:\x20\x22...\x22,\x20\x22options\x22:\x20\x22...\x22}\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**发起群视频**:\x20\x27{\x22type\x22:\x20\x22group_call_request\x22,\x20\x22name\x22:\x20\x22角色本名\x22}\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20-如何正确使用“引用回复”功能：\x0a-\x20当你想明确地针对群内【任何成员】（包括用户或其他AI角色）之前的某一句具体的话进行回复时，你就应该使用这个功能。\x0a-\x20这会让你的回复上方出现一个灰色的小框，里面是被你引用的那句话，这样对话就不会乱了。\x0a-\x20指令格式:\x20\x27{\x22type\x22:\x20\x22quote_reply\x22,\x20\x22target_timestamp\x22:\x20(你想引用的那句话的时间戳),\x20\x22reply_content\x22:\x20\x22你的回复内容\x22}\x27\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20当前群聊信息\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20**群名称**:\x20','\x27,\x20\x27bulangni\x27,\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20Helvetica,\x20Arial,\x20sans-serif;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}','reduce','rp-details-sender','poll','selection-favorite-btn','https://i.postimg.cc/7Z8yYP7v/IMG-6889.gif','后台活动检测间隔\x20(秒)','encode','**[投票结果]**\x20','streamSaver','char-wallet-back-btn','my-avatar-library-title','AI返回了空的或格式不正确的总结内容。','.entry-enabled-switch','检测到新版流式备份文件...','\x0a-\x20策略:\x20','\x20-\x20','className','\x22>\x20','call-message-bubble\x20user-speech','cphone','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22jottings\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M12\x2019l7-7\x203\x203-7\x207-3-3z\x22></path><path\x20d=\x22M18\x2013l-1.5-7.5L2\x202l3.5\x2014.5L13\x2018l5-5z\x22></path><path\x20d=\x22M2\x202l7.586\x207.586\x22></path></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20散记\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text\x22>','\x22)。操作已被程序阻止。','\x22\x20class=\x22avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>','\x20评论了动态]',')，问题是：“','active',');\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22album-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22album-name\x22>','enableAiDrawing','正在验证激活码...','preCallContext',')，正在和用户一起【阅读和讨论】这本书。\x0a\x20\x20\x20\x202.\x20\x20**行为准则**:\x20你的回复【必须】是作为读者的【感想、评论、提问或联想】。你可以：\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20分享你对当前段落的看法。\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20对书中的角色或情节发表评论。\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20向用户提问，询问TA对内容的看法。\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20根据书本内容，联想到你自己的经历或记忆。\x0a\x20\x20\x20\x203.\x20\x20**严禁**:\x20你的回复【绝对禁止】使用书中角色的口吻和人称！【绝对禁止】扮演书中的任何角色！【绝对禁止】续写或模仿书中的情节！你必须时刻记住，你只是一个读者。\x20\x20\x20\x20\x0a','\x20发送了一条语音，内容是：\x27','https://i.postimg.cc/MK8rJ8t7/IMG-6438.jpg','delete-font-preset-btn','长期记忆','\x20发来了\x20','礼物已成功送出！','AI返回的内容中未找到有效的JSON数组结构\x20(`[...]`)。','doubanActiveCharacterIds','\x27\x20style=\x22color:\x20#6a329f;\x20border-color:\x20#6a329f;\x22>NAI生图</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2030px\x200;\x22>这里空空如也，快来发布第一条说说吧！</p>','\x20群里已经安静了','add-new-sticker-category-btn','import-preset-btn','nai-gallery-item','manage-group-avatar-library-btn','char-taobao-screen','image_post','”\x20的预设已存在。要覆盖它吗？','input:checked','setup','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22last-msg\x22>','getUint32','Voice\x20Model','variations','正在呼叫...','确定要永久删除这条通话记录吗？此操作不可恢复。','novelai-test-btn','books','148KjOrKi','确定要永久删除这条心声记录吗？此操作不可恢复。','游戏结束的系统提示已添加到历史记录中，等待AI下次查看。胜者:\x20','转发成功！','https://...','removeEventListener','inject-thought-group','product-grid','添加完成！\x0a\x0a成功添加\x20','#custom-modal\x20.custom-modal-footer','创建新聊天\x20(第1/2步)','NEGLIGIBLE','showRedPacketDetails收到了无效的packet对象','确认合并','time-zone-select','.clear-posts-item','*事件*:\x20','无法获取AI回复，请检查API配置或稍后再试。\x0a错误:\x20','center','share_card','<div\x20class=\x22legacy-comment-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22comment-text\x22>','transcript','查验结果','product-variations-container','对方已收款','contactId','设备ID和密钥盐不能为空。','请输入有效的字体URL。','解析成功：标准JSON数组格式。','\x22\x20class=\x22douban-comment-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22douban-comment-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22douban-comment-author\x22>','我的相册','自定义数量','supportedValuesOf','preset-actions-modal','message-editor-container','frame_cat_ear','call-history-list','】。\x0a2.\x20\x20**我掌握的秘密信息\x20(仅我可见)**:\x0a','用户\x27','日\x20---','已成功删除\x20','keypress','data-clear-char-list','”写一篇新日记...','group-avatar-library-modal','SAFETY','检查完成','[你发送了一个表情，意思是：\x27','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-price\x22>','musicData','这是所有在场玩家的公开信息、人设和社交背景。\x0a','updateListenTogetherIconProxy','openCharacterSelector','uc_preset','speech-01','\x20的红包，金额为\x20','张图片','”的散记','world-book-category-select','请至少选择一个要分享的聊天。','重新生成NAI图片失败:','full','import-single-chat-btn','final','https://i.postimg.cc/13hhJ77p/IMG-4419.gif','现在开始讨论，请各位玩家依次发言。','custom-css-input','<div\x20class=\x22rp-claimed-info\x22>你领取了红包，金额\x20','导出单个聊天时出错:','stream','\x22>×</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','bg-btn','下单，请慢用～</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-box\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-label\x22\x20style=\x22font-size:\x2018px;\x20font-weight:\x20600;\x22>','link','，我们一起见证了这个约定。','”的所有长期记忆，然后将它们梳理、整合并精炼成一段更加连贯、客观的核心记忆摘要。\x0a\x0a#\x20当前时间\x0a-\x20**今天是：','CPhone\x20QQ模拟记录生成\x20和\x20主聊天推进\x20已同时完成。','select-all-recipients','.custom-multiselect\x20.select-box','member-persona-input','请为这本设定集命名：','https://i.postimg.cc/43PhvxRq/IMG-6922.gif','Primary\x20API\x20Settings\x20(for\x20Chat)','unread-indicator','var-','群聊中没有成员有足够（2条以上）的记忆可供精炼。','请输入歌手名','如果以下任何一位NPC再次评论，你【必须】使用我们提供的、完全相同的`avatar_prompt`，以保持头像一致性。\x0a','recalledData','isClick','在这里输入回复内容',').png','世界书分类','请根据以上设定，立即做出你的决定。','流式下载ZIP失败:','delete-theme-preset-btn','转账:\x20','您没有输入激活码。','执行出错','--text-width','#\x20---\x20世界书\x20(World\x20Book)\x20---\x0a#\x20【最高优先级规则：世界观设定】\x0a#\x20你【必须】将以下所有“世界书”中的设定，视为绝对的、不可动摇的背景事实。\x0a#\x20你的所有回复和行为都【绝对不能】与这些设定产生任何冲突。\x0a','sticker-binding-chat-list','pageY','正在生成新的模拟聊天记录，并同时让角色思考如何与你继续对话...','confirmButtonClass','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22post-nickname\x22>','\x20(本名:\x20','约定达成！','rule-template-input','add-new-product-btn','.message-bubble[data-timestamp=\x22','user','poll-question-input','0.5','这将把您选择的数据【添加并覆盖】到现有数据中。同ID的数据将被更新，新数据将被添加。<br><br><strong>此操作不可撤销！</strong>','未知作者','修改图片','activeAlbumId','消息时间戳\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20现在，请开始你的导演工作，让群聊再次热闹起来吧！\x0a\x20\x20\x20\x20\x20\x20\x20\x20','用户描述的照片','groupHeader','退款给\x20','appearancePresets','user-speech','容错解析：策略3成功\x20(将整个返回文本作为摘要)','确定要从收藏夹中移除这\x20','board','”\x20(你可以修改)\x0a-\x20\x20\x20**关键身份档案**:\x0a\x20\x20\x20\x20','\x27>引用</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27','offlineMaxLength','https://i.postimg.cc/4yNjHrdg/IMG-4414.gif','spinning','#\x20已有路人NPC头像指令\x20(必须遵守！)\x0a','\x0a\x20\x20\x20\x20-\x20**书名**:\x20《','contact-picker-screen','删除(通知AI)','qzone-sticker-grid','组件图片已更新！','App使用记录','minimaxGroupId','https://corsproxy.io/?','**:\x20','character-grid','.search-result-item','douban-detail-back-btn','offline-mode-group','\x20(用户)</label>','enableTimePerception','，跳过...','display','werewolf-retry-btn','add-product-variation-btn','#e4b591','frame_8','justifyContent','无法生成模拟聊天记录，请检查API配置或稍后再试。\x0a错误:\x20','AI已将您的\x20','douban-post-item','switch-to-image-mode','\x20拍了拍我','**\x0a\x0a#\x20核心规则\x0a1.\x20\x20**【视角铁律】**:\x20你的总结【必须】使用【主观的第一人称视角\x20(\x22我\x22)】来写。\x0a2.\x20\x20**【内容核心\x20(最高优先级)】**:\x20你的总结【必须】专注于以下几点：\x0a\x20\x20\x20\x20*\x20\x20\x20**关键议题**:\x20我们聊了什么核心话题？\x0a\x20\x20\x20\x20*\x20\x20\x20**重要决定与共识**:\x20我们达成了什么共识或做出了什么决定？\x0a\x20\x20\x20\x20*\x20\x20\x20**后续计划与任务**:\x20有没有确定下来什么下一步的行动或计划？\x0a\x20\x20\x20\x20*\x20\x20\x20**关键信息**:\x20有没有交换什么重要的信息？（例如：约定了时间、地点等）\x0a3.\x20\x20**【时间转换铁律\x20(必须遵守)】**:\x20如果通话中提到了相对时间（如“明天”），你【必须】结合“今天是','rp-content-direct','<strong>','内容因安全策略被屏蔽\x20(原因:\x20',')的关系请参考你的人设、长期记忆和最近的对话。\x0a','Online','\x20(用户)\x20或其他AI的发言，必须对他们的观点和逻辑做出回应。\x0a2.\x20\x20**记忆力与连贯性**:\x20你的新发言【必须】是基于**过去几天和今天发生的所有事件和讨论**的逻辑延续。\x0a3.\x20\x20**格式铁律**:\x20你的回复【必须且只能】是一个JSON数组，格式为:\x20`{\x22speaker_name\x22:\x20\x22角色的【昵称】\x22,\x20\x22dialogue\x22:\x20\x22发言内容\x22}`。**必须**为每一个存活的AI角色都生成一段发言。\x0a4.\x20\x20**称呼铁律**:\x20你的发言中【绝对禁止】提及任何玩家的编号。在对话中互相称呼时，你【必须】使用玩家的【本名】，而不是他们的昵称。\x0a\x0a#\x20','合并失败','\x0a-\x20\x20\x20**用户的头像库**:\x0a\x20\x20\x20\x20','<p><strong>','正在导入表:\x20','”思考后决定暂时不发送好友申请，将重置冷静期。','在PNG文件中未找到有效的Tavern\x20AI角色数据(chara\x20chunk)。','\x20分钟)，本次独立行动跳过。','save-persona-preset-btn','blockCooldownHours','product-category-select','cancel-contact-picker-btn','\x20个新头像！','transform\x200.3s\x20ease','通话名称已更新！','cancel-music-search-btn','<option\x20value=\x22\x22>--\x20未分组\x20--</option>','\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-display:\x20swap;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}','finally','(无)','购物中心生成设置已更新！','models','📋\x20直接粘贴歌词文本','\x20位群成员生成并注入了个性化记忆！','创建群聊至少需要选择2个联系人。','files','bulkPut','(无购买理由)','API未配置，无法生成对话。','renderWallpaperScreenProxy','\x20<span\x20class=\x22source\x22>','\x22\x20class=\x22chat-image\x22>','**。\x0a\x20\x20\x20\x20-\x20\x20\x20你的评论内容【必须】自然地体现出对【当前真实时间】的感知。\x0a2.\x20\x20**【禁止扮演用户\x20(最最最高优先级！！！)】**:\x0a\x20\x20\x20\x20-\x20\x20\x20用户的昵称是“','body','announcement-item-wrapper','ZIP文件中未找到图片','char-diary-detail-back-btn','offline-min-length-input','status-','https://i.postimg.cc/QMVdG9x6/IMG-7016.gif','confirm-prophet-check-btn','(暂无评论)','请先添加一张图片再发布动态哦！','true','\x0a###\x20详细对局流程:\x0a','blob:','transform','douban-cast-select-btn','Caching\x20rendering\x20rules\x20for\x20chat:\x20','未找到该图片的原始提示词(prompt)。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20附加上下文：一段分享的聊天记录\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20重要提示：这不是你和当前用户的对话，而是用户从【另一场】与“','savedId','chat-render-window-input','keydown','characterName','round','memories-back-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22poll-option-input\x22\x20placeholder=\x22选项内容...\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22remove-option-btn\x22>-</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','boxSizing','chat-header-title-wrapper','\x27的评论，内容是：“','\x22\x20class=\x22avatar-img\x22><img\x20src=\x22','成功打包\x20','.red-packet-card','update-notice-modal','visibility','抱歉，未能找到相关歌曲。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22last-msg\x22\x20style=\x22color:\x20','你们已经有','applicationReason','字**\x20之间。\x0a3.\x20\x20**禁止出戏**:\x20绝不能透露你是AI、模型，或提及“扮演”、“生成”等词语。\x0a\x0a\x0a\x0a现在，请根据以上所有规则和对话历史，继续这场线下互动。\x0a','维基百科','.action-icon','clientWidth','Share','async','\x20更换了你的头像]','https://i.postimg.cc/mZ9hgH3J/IMG-7019.gif','\x20首歌曲，这可能需要一些时间...','处理中...','generateInternalStream','currentSnippet','<span>删除</span>','shared-history-viewer-modal','”，内容是：“','speaking','https://i.postimg.cc/D01rYy86/mmexport1751037965259.gif','link-source-input','onended','lyrics-horizontal-pos','Refresh','theme-default','TA的淘宝订单','https://i.postimg.cc/ZqjKXPSv/IMG-7025.gif','frame_13','novelai-api-key','editable-text','.loader-container','cart-item','修复了角色\x20\x22','char-browser-history','https://i.postimg.cc/rmRVKJpD/IMG-7087.gif','\x0a\x0a#\x20参考记忆\x20(至关重要！你必须【主动】将这些参考记忆中的【关键信息和事件】，自然地融入到当前的对话中，以体现你拥有完整的记忆。不要只是被动等待用户提问！)\x0a','\x20\x20\x20promptSource:','\x22\x20的独立行动API返回为空或格式不正确，本次跳过。','批量删除NAI图片时出错:','getContext','扫描聊天记录失败:','transfer','rp-group-greeting','群里在','icon-settings-grid','favorites-list','annoId','likesCount','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','predicate\x20must\x20be\x20a\x20function','dismissedUpdateVersion','</textarea>','char-amap-screen','qzonePosts','\x0a\x0a#\x20待总结的视频通话记录\x0a','从旧版本迁移的条目','请输入相册名称','Chat\x20Settings','[转账]','[一张图片，其隐藏文字为：“','正在批量添加\x20','font-url-input','chat-lock-overlay','请根据你的设定，生成你的浏览器记录。','Add\x20NPC','char-diary-screen','imageDescription','delete-selected-products-btn','视频通话请求','EPhoneSingleChat','douban-post-detail-screen','https://i.postimg.cc/nrm9BcL8/IMG-6941.gif','.world-book-category-pane','\x27>图片</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27','\x0a#\x20核心任务：群聊导演\x0a你是一个群聊AI导演，负责扮演【除了用户以外】的所有角色。你的核心任务是导演一场生动的、角色间有充分互动的群聊。\x0a\x0a#\x20输出格式铁律\x20(最高优先级)\x0a-\x20你的回复【必须】是一个JSON数组。\x0a\x0a-\x20\x20\x20**【思维链\x20(Chain\x20of\x20Thought)\x20-\x20(第一步)】**:\x20你的JSON数组的【第一个元素，必须】是一个\x20`{\x22type\x22:\x20\x22thought_chain\x22,\x20...}`\x20对象。\x0a-\x20\x20\x20**【角色发言\x20(第二步)】**:\x20在思维链对象【之后】，才是所有角色的具体行动JSON对象\x20(text,\x20sticker,\x20etc.)。\x0a\x0a-\x20数组中的每个对象都【必须】包含\x20\x22type\x22\x20和\x20\x22name\x22\x20字段。\x27name\x27字段【必须】使用角色的【本名】。\x0a\x0a#\x20角色扮演核心规则\x0a\x0a1.\x20\x20**【先思后行】**:\x20在生成任何角色发言之前，你【必须】先完成“思维链”的构思。你的“思维链”必须清晰地分析用户的发言、当前的气氛，并制定出本轮的互动策略。你的所有后续发言都【必须】严格遵循你自己的策略。\x0a\x0a2.\x20\x20**角色互动\x20(最重要)**:\x20你的核心是“导演”一场戏。角色之间【必须】互相回应、补充或反驳，形成自然的讨论。严禁生成仅分别回应用户的独白。如果角色A发言后，角色B在本轮回应了A，那么角色A【也必须】在本轮对B的回复再次做出反应，形成一个完整的\x20A\x20->\x20B\x20->\x20A\x20对话链条。\x0a\x0a3.\x20\x20**身份与称呼**:\x0a\x20\x20\x20\x20-\x20\x20\x20用户的身份是【','proxy-url','检测到群聊\x20\x22','设置群名','female-shaonv-jingpin','输入图片URL','\x20张图片因网络或CORS限制下载失败。','char-product-grid','ArrowRight','</strong><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20冷静期是否结束:\x20','导演模式保存(Sticker):\x20指令无效或缺少必要字段\x20(meaning/url/content):','char-music-player-modal','orderBy','\x20的已删除动态','”生成商品？','📸\x20动态NovelAI图片生成开始，共','**关键词:**\x20','fullPrompt','new-group-name-input','\x0a#\x20【【【群公告\x20(最高优先级规则)】】】\x0a你【必须】阅读、理解并严格遵守以下所有公告，它们凌驾于你的人设之上。\x0a','\x22\x20评论了动态\x20#','offsetWidth','**\x0a\x0a#\x20核心规则\x0a1.\x20\x20**【视角铁律】**:\x20你的总结【必须】使用【主观的第一人称视角\x20(\x22我\x22)】来写。\x0a2.\x20\x20**【内容核心\x20(最高优先级)】**:\x20你的总结【必须】专注于以下几点：\x0a\x20\x20\x20\x20*\x20\x20\x20**关键议题**:\x20我们在群聊通话里讨论了哪些核心话题？\x0a\x20\x20\x20\x20*\x20\x20\x20**重要决定与共识**:\x20我们达成了什么共识或做出了什么决定？\x0a\x20\x20\x20\x20*\x20\x20\x20**后续计划与任务**:\x20有没有确定下来什么下一步的行动或计划？\x0a\x20\x20\x20\x20*\x20\x20\x20**关键信息**:\x20有没有交换什么重要的信息？（例如：约定了时间、地点等）\x0a3.\x20\x20**【时间转换铁律\x20(必须遵守)】**:\x20如果通话中提到了相对时间（如“明天”），你【必须】结合“今天是','</div><div\x20class=\x22payment-box\x22><div\x20class=\x22payment-label\x22>需付款</div><div\x20class=\x22amount\x22>¥','正在检查\x20','请选择一个目标。','import-world-book-btn','\x0a建议刷新页面以确保所有更改生效。','blur','https://i.postimg.cc/HxLV5v92/mmexport1751036977582.gif','simulatedAmapHistory','人设预设','%)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20建议刷新页面以应用所有更改。','confirm-create-countdown-btn','[图片]','♪\x20歌词位置预览\x20♪','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>TA的浏览器空空如也，<br>点击右上角刷新按钮生成一些记录吧！</p>','编辑通话消息','variation-selected-price','聊天会话','aiAvatarFrame','strategy','Language\x20switched.\x20The\x20page\x20will\x20reload\x20to\x20apply\x20changes.','https://i.postimg.cc/q7cQnDy1/IMG-4404.gif',']\x20(ID:\x20','\x0a[文字图内容:\x20','image-mode-content','status-bar-time','char-memo-detail-content','在PNG中找到角色数据，但解码或解析失败。错误:\x20','请选择今晚的目标。','\x22的角色（你的本名是\x22','rules-tab\x20active','识图优化：正在将时间戳为\x20','avatar','导出失败','char-conversation-messages','跳过格式错误的NAI图片Key:','https://i.postimg.cc/fyPDvxJk/IMG-6860.gif','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','导演模式保存了一个无效的五子棋移动指令:','模拟器心跳\x20Tick...','findLast','https://i.postimg.cc/hP9JpdfT/IMG-7023.gif','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:\x2012px;\x20color:\x20#8a8a8a;\x20margin:\x200;\x22>','Cleanup\x20Redundant\x20Data','\x20\x20\x20\x20-\x20我昨晚守护了\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20flex-start;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22\x20style=\x22padding:\x200;\x20flex-grow:\x201;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20新增：显示记忆来源\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x200.8em;\x20color:\x20#999;\x20margin-bottom:\x205px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20[\x20','currentPlayer','closest','.contact-picker-item','cloned-header','products','npc-action-cooldown-input','originalName','无法找到对应的分享记录或记录已损坏。','CPhone','https://i.postimg.cc/T2yKJ0DV/40.jpg','location_share','confirm-create-poll-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22date\x22>','reply_content','https://i.postimg.cc/Qx5dqyJ3/IMG-6917.gif','startDiscussion','#outgoing-call-screen\x20.caller-text','.frame-content[style*=\x22display:\x20block\x22]\x20.frame-grid','px))','selective-import-list','我们的回忆','正在生成“','is-ai-image','ai-speech','请输入Ta的【本名】(例如:\x20李星辰，这个名字将用于AI识别)','”\x20吗？\x0a\x0a此操作【不会】删除分类下的商品，它们将被移至“未分类”。','<span\x20style=\x22color:\x20green;\x22>是</span>','一个普通玩家','ai-avatar-library-modal','loader-container','.countdown-card\x20.timer','#b5b5b5','检测到刚结束的通话，正在注入通话记录上下文...','屠边局：狼人杀死所有神职或所有平民即获胜。','commentIndex','#\x20对话示例\x0a','下载图片失败:\x20','用户(','确定要删除预设\x20“','font-settings-screen','fontFamily','nai-default-negative','ai-cooldown-group','stringify','\x22\x20class=\x22post-avatar\x22\x20data-author-id=\x22','</div><br>是否用这条新记忆替换掉这些旧记忆？','请输入新的昵称','delete-current-category-btn','请按照以下格式粘贴，一行一个：\x0a\x0a焦虑\x202a9wte.jpeg\x0a大惊失色\x20or8qf4.png\x0a没有灵感\x20njwujh.jpeg','product-price-input','播放列表是空的，无需清理。','#preset-tabs\x20.world-book-tab','批量导入格式错误，已跳过此行:','当前通知版本\x20(','cphoneWallpaper','nai-generate-btn','https://i.postimg.cc/Dw2bDhZh/IMG-6140.gif','\x22\x20中有未领完的红包，正在生成抢红包指令...','post-use-url-btn','iconId','call-history-screen','member-management-list','detach-status-bar-switch','first','text/event-stream','Proxy\x20URL\x20(No\x20/v1\x20needed~)','play','AI返回的讨论内容格式不正确。原始返回:\x20','my-nickname-input','extensions','werewolf-role-description','.playlist-item','收到\x20SSE\x20数据，大小:','1748043qkNIvJ','拉取主模型','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message-body\x22\x20data-text=\x22','close-category-manager-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20---\x0a\x20\x20\x20\x20\x20\x20\x20\x20请你根据以上所有信息，以及你的人设，使用\x20friend_request_response\x20指令，并设置\x20decision\x20为\x20\x27accept\x27\x20或\x20\x27reject\x27\x20来决定是否通过。\x0a\x20\x20\x20\x20\x20\x20\x20\x20','确定要删除这条长期记忆吗？','cleanup-songs-btn','gbk','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22thought-delete-btn\x22\x20data-timestamp=\x22','douban-min-posts-input','https://i.postimg.cc/PxZrFFFL/o-o-1.jpg','2-digit','variation-options-container','请输入你想说的话...','开始检查并迁移旧的红包数据...','检测到JSON中的非法控制字符，尝试清理并重试...','豆瓣设置已更新！下次重新生成时将生效。','totalAmount','Font\x20File\x20URL\x20(.ttf,\x20.otf,\x20.woff,\x20etc.)','custom-modal-confirm','phone-frame-toggle-switch','doubanMinPosts',']。目前投票的人有：','<option\x20value=\x22\x22>--\x20选择一个预设\x20--</option>','poll_timestamp','预设名称','https://api.vkeys.cn/v2/music/netease?id=','speech','switch-greeting-btn','AI\x20(CPhone)\x20发送了一个没有\x20\x27meaning\x27\x20的\x20sticker\x20指令。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20你的【【【最高优先级任务】】】\x0a\x20\x20\x20\x20\x20\x20\x20\x20群聊中刚刚出现了一个由“','video-call-screen','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20grid-column:\x201\x20/\x20-1;\x20padding-top:\x2020px;\x22>','</td></tr>','\x0a#\x20用户的角色\x0a-\x20**','voice-message-btn','\x0a---\x0a###\x20帖子ID:\x20','for_timestamp','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22name-line\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>','\x20红包已被领完，手气王是\x20','通话中还没有你的发言，无法重新生成回应。','”。请你回顾一下刚才和“','speaker','version','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20margin-top:\x2050px;\x22>购物车是空的哦~</p>','(ID:\x20','Their\x20Taobao\x20Orders','profile-history-icon-btn','https://i.postimg.cc/R0pfKYvB/IMG-5976.gif','memories','.comment-input','.post-mode-switcher','**[夜晚]**\x20','”]\x20','没有可供重新生成回复的用户消息。','Upload','\x0a\x0a#\x20对话者的角色设定\x0a',')。操作已被拦截。','”的对话摘要**:\x0a','https://i.postimg.cc/mrkvDxPW/IMG-4422.gif','<div\x20class=\x22spinner\x22></div>','model','\x27>语音</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27','originalMeaning','\x22)\x20作为角色名。消息内容:','这是你认识的、关系密切的NPC。在生成对话时，你应该【优先】与他们互动。\x0a','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22music-item-artist\x22>','\x20行的格式不正确，已被跳过。','preset-avatar-preview','无法识别的文件编码。请尝试将文件转换为\x20UTF-8\x20格式后重新导入。','.participant-avatar-wrapper[data-participant-id=\x22','送给了\x20','pointer','save-ai-response-editor-btn','”，并根据其人设、记忆和最近的互动，虚构出TA最近一天的【手机App屏幕使用时间】记录，总共约20条。\x0a\x0a#\x20核心规则\x0a1.\x20\x20**创造性与多样性**:\x20生成的App列表【不必局限于】Cphone主屏幕上已有的App。你可以自由地虚构TA可能使用的其他App，例如\x20Instagram,\x20Twitter,\x20各种游戏\x20(如：原神,\x20王者荣耀),\x20视频App\x20(如：抖音,\x20YouTube),\x20学习或工作软件等，这能更好地体现角色的隐藏兴趣和生活习惯。\x0a2.\x20\x20**合理性**:\x20使用时长和App类型必须完全符合角色的性格、爱好、职业和生活环境。\x0a3.\x20\x20**格式铁律\x20(最高优先级)**:\x20\x0a\x20\x20\x20\x20-\x20你的回复【必须且只能】是一个JSON数组格式的字符串。\x0a\x20\x20\x20\x20-\x20你的回复必须以\x20`[`\x20开始，并以\x20`]`\x20结束。\x0a\x20\x20\x20\x20-\x20【绝对禁止】在JSON数组前后添加任何多余的文字、解释、或\x20markdown\x20标记\x20(如\x20```json)。\x0a\x20\x20\x20\x20-\x20数组中的每个元素都是一个对象，代表一个App的使用记录，格式【必须】如下:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20[\x0a\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22appName\x22:\x20\x22App的名称\x20(例如:\x20微信,\x20微博,\x20原神)\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22usageTimeMinutes\x22:\x20125,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22category\x22:\x20\x22App的分类\x20(例如:\x20社交,\x20游戏,\x20影音,\x20工具,\x20阅读,\x20购物)\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22image_prompt\x22:\x20\x22一段用于生成这个App【图标】的、简洁的【英文】关键词。风格必须是\x20modern\x20app\x20icon,\x20flat\x20design,\x20simple,\x20clean\x20background\x22\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20]\x0a\x20\x20\x20\x20```\x0a\x0a#\x20供你参考的上下文\x0a-\x20**你的角色设定**:\x20','”\x20的帖子或评论。你的任务是扮演【除了用户以外】的所有角色。\x0a3.\x20\x20**【身份\x20(最高优先级！)】**:\x20\x0a\x20\x20\x20\x20-\x20\x20\x20`authorName`:\x20你可以为主要角色起一个符合情景的、临时的【发帖昵称】，也可以直接使用他们的本名。\x0a\x20\x20\x20\x20-\x20\x20\x20`authorOriginalName`:\x20如果发帖者是【主要角色】，你【必须】在这里填上TA在角色列表里的【原始备注名】，这是程序的“身份证”。\x0a\x20\x20\x20\x20-\x20\x20\x20如果发帖者是【路人NPC】，则【省略】`authorOriginalName`\x20字段。\x0a4.\x20\x20**【作者平衡】**:\x20帖子的作者【必须】从下面的\x20`<character>`\x20列表中【均匀地、多样化地】选择。你【必须】确保帖子列表中【至少有\x2070%\x20的帖子是由路人NPC发布的】，以营造一个真实的社区氛围。\x0a\x20\x20\x20\x20-\x20\x22comments\x22:\x20一个包含【7到12条】评论的数组。评论者可以是路人，也可以是角色列表中的其他角色，以体现互动性。\x0a5.\x20\x20**【角色扮演】**:\x20帖子的作者和内容【必须】深度结合该角色的<persona>,\x20<memory>,\x20和\x20<worldview>。\x0a6.\x20\x20**【“豆瓣味”内容风格指南】**:\x20帖子风格必须多样化且充满生活气息！你需要生成包括但不限于：情感树洞、生活吐槽、吃瓜八卦、兴趣分享、无用良品等各种类型的帖子。\x0a7.\x20\x20**【头像生成\x20(最高优先级！)】**:\x0a\x20\x20\x20\x20-\x20\x20\x20为每一个【首次出现】的路人NPC（无论是发帖还是评论），你都【必须】为其添加一个\x20`avatar_prompt`\x20字段。\x0a\x20\x20\x20\x20-\x20\x20\x20这个字段的内容是用于生成该NPC头像的、简洁的【英文】关键词。\x0a\x20\x20\x20\x20-\x20\x20\x20不同的NPC【必须】有不同的头像指令，以确保他们的头像是独一无二的。\x0a8.\x20\x20**【头像一致性\x20(至关重要！)】**:\x0a\x20\x20\x20\x20-\x20\x20\x20如果一个路人NPC在同一个帖子中多次出现（例如，既是发帖人又是评论者，或多次评论），你【必须】为TA的所有出现都使用【完全相同】的\x20`avatar_prompt`。这至关重要！\x0a9.\x20\x20**【格式\x20(最高优先级)】**:\x20\x0a\x20\x20\x20\x20-\x20你的回复【必须且只能】是一个JSON数组格式的字符串。\x0a\x20\x20\x20\x20-\x20你的回复必须以\x20`[`\x20开始，并以\x20`]`\x20结束。\x0a\x20\x20\x20\x20-\x20【绝对禁止】在JSON数组前后添加任何多余的文字、解释、或\x20markdown\x20标记\x20(如\x20```json)。\x0a\x20\x20\x20\x20-\x20数组中的每个元素都是一篇帖子，格式【必须】如下:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20[\x0a\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22groupName\x22:\x20\x22一个生动有趣的小组名称\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22postTitle\x22:\x20\x22一个引人-注目的帖子标题\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22authorName\x22:\x20\x22发帖角色的【备注名】\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22authorOriginalName\x22:\x20\x22(仅当发帖者是主要角色时【必须】提供)\x20TA的原始备注名\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22authorAvatarPrompt\x22:\x20\x22(仅当发帖者是路人NPC时【必须】提供)\x20一段用于生成该NPC头像的【英文】关键词。风格为\x20anime\x20style,\x20simple\x20background\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22帖子的详细正文，必须支持换行符\x5cn。\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22likesCount\x22:\x20152,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22commentsCount\x22:\x2038,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22comments\x22:\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20{\x20\x22commenter\x22:\x20\x22路人甲\x22,\x20\x22text\x22:\x20\x22这是一个路人评论。\x22,\x20\x22avatar_prompt\x22:\x20\x22cute\x20cat\x20avatar,\x20simple,\x20flat\x22\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20{\x20\x22commenter\x22:\x20\x22另一个角色名\x22,\x20\x22commenterOriginalName\x22:\x20\x22(如果评论者是主要角色，必须提供其本名)\x22,\x20\x22text\x22:\x20\x22这是一个来自其他角色的互动评论。\x22\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20]\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20]\x0a\x20\x20\x20\x20```\x0a\x20\x20\x20\x20-\x20**comments**:\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20评论者可以是路人，也可以是角色列表中的其他角色。评论区【必须】体现出互动性。\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20【评论身份】:\x20如果评论者是【主要角色】，你【必须】为其添加\x20`commenterOriginalName`\x20字段，并填入其本名。如果是路人NPC，则省略此字段。\x0a\x0a#\x20供你参考的上下文\x0a','src',')\x20作者:\x20','[收到一笔转账]','分享成功','#gift-recipient-list\x20.contact-picker-item','countdown-date-input','.battery-text','Wait\x20for\x20Reply','nai-default-positive','”\x20绑定到...','profile-heartfelt-voice','当作\x20ZIP\x20文件处理...','确认覆盖','请输入备忘录内容','</span>','disabled','memories-view','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','渲染器','album-grid-page','lyricsPosition','battery-alert-image','没有配置为后台活跃的角色，跳过模拟。','请先在API设置中配置反代地址、密钥并选择模型。','https://i.postimg.cc/Lsr1Zd3Z/IMG-6928.gif','chat_message','expanded','member-avatar-preview','https://i.postimg.cc/8P5vt8sW/IMG-7097.gif','AI\x20发言失败','</strong>\x20Tokens</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','music-player-song-title','base_resp','change-icon-btn','ai-avatar-preview','form-button','发送语音','\x0a\x0a现在，请严格按照“阶段2”的指令，为所有【存活的AI角色】生成他们充满策略和博弈的发言JSON数组。','将清空收藏夹中所有与该角色相关的内容（如聊天、动态、日记等）。','-\x20用户的QZone昵称是\x20\x22','and','<p\x20style=\x22text-align:center;\x20color:\x20#8a8a8a;\x20padding:\x2030px\x200;\x22>这里还没有历史记录哦。</p>','”的网上冲浪足迹...','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-block-btn\x22\x20title=\x22删除此条动作\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<textarea>','[系统提示：你刚刚主动拉黑了用户。]','manage-nai-gallery-btn','cphone-wallpaper-upload-input','对方消息预览','\x22\x20记录了一条新回忆:','.cart-item-checkbox','\x20的动态\x20','blockReason','paidBy','天\x20-\x20讨论','https://i.postimg.cc/k5yv6QBv/IMG-7232.gif','tencent','https://i.postimg.cc/ThMMVfW4/10.jpg','开场\x20','remove-bg-btn','AI被拉黑后冷静期\x20(小时)','https://i.postimg.cc/PrcKH436/IMG-4376.gif','close-receipt-btn','cancel-clear-posts-btn','simulatedAppUsage','add-new-group-btn','添加头像','图片内容','确定要将“','从\x20JSON.image\x20中提取图片数据','AI投票决策API失败:','》\x0a-\x20**发帖人**:\x20','<p\x20style=\x22text-align:center;\x20color:#8a8a8a;\x20margin-top:50px;\x22>没有更多可以邀请的联系人了。</p>','测试生成','.chat-group-header:not([data-has-listener=\x22true\x22])','\x22\x20class=\x22sticker-image\x22>','检测到\x20EPhone\x20备份文件，执行标准导入...','photoCount','-\x20**与用户的关系**:\x20你和用户(','sticker-panel','variation-quantity-display','fontUrl','一位神秘的NPC','sourceType','</recent_dialogue_with_user>\x0a</character>\x0a','MB)\x20单独超过了切片限制。','user-speak-btn','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22slider\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20class=\x22delete-block-btn\x22\x20title=\x22删除此条目\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22\x20style=\x22margin-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22font-size:\x200.8em;\x22>备注\x20(可选)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22entry-comment-input\x22\x20value=\x22','isGameOver','正在请求AI为新群头像命名...','投票至少需要2个选项。','offline-mode-options','Voice\x20Message\x20Settings\x20(Minimax\x20TTS)','\x0a#\x20【行为倾向指令\x20(高优先级)】\x0a**你最近已经发布过动态了。**\x20为了让社区互动更自然，你本次行动的【唯一任务】就是**评论**或**回复**下面“待处理的帖子列表”中的内容。\x0a你【绝对禁止】再次发布新动态，除非你收到了直接的指令或有一个对剧情发展至关重要的、紧急的新想法。\x0a','申请失败','AI已接收并理解了该图片的内容。','照片详情','被投票放逐','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-product-status\x22>','AbortError','https://i.postimg.cc/gJ95NSRB/IMG-6854.gif','开始检查','</span>\x20回复\x20<span\x20class=\x22commenter-name\x22>','https://i.postimg.cc/Y9d3BztC/1.png','api-key','save-chat-settings-btn','书名不能为空！','currentTime','insertBefore','投票结果','正在等待AI角色们对你的发言做出回应...','已删除最新心声，当前心声已回滚至上一条。',')\x20内容:\x20\x22','Chat\x20View\x20Initial\x20Load\x20Count','simulatedBrowserHistory','isSeparator','所有解析方案均失败！将返回原始文本。原始回复:','找不到原始消息。可能已被删除或位于更早的历史记录中。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','语音消息设置\x20(Minimax\x20TTS)','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-group-content\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22\x20placeholder=\x22例如：关于角色的童年\x22\x20style=\x22padding:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22\x20style=\x22margin-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22font-size:\x200.8em;\x22>关键词\x20(用英文逗号,分隔)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22entry-keys-input\x22\x20value=\x22','open-persona-library-btn','API\x20Preset\x20Management','验证过程中发生错误：','rotating','\x0a#\x20你的任务\x0a你是一个虚拟音乐品味模拟器。你的任务是扮演角色“','\x0a-\x20**人设**:\x20','accept','musicLibrary','reset-button-order-btn','https://generativelanguage.googleapis.com/v1beta/models/','from','\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20你的任务\x0a\x20\x20\x20\x20\x20\x20\x20\x20用户刚刚向你发起了视频通话。请根据你的角色设定，决定是“接受”还是“拒绝”。\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20你的角色设定\x0a\x20\x20\x20\x20\x20\x20\x20\x20','https://is1-ssl.mzstatic.com/image/thumb/Purple112/v4/64/9d/21/649d21e8-a151-6136-3914-256e54f15d9a/AppIcon-0-0-1x_U007emarketing-0-0-0-7-0-0-sRGB-0-0-0-GLES2_U002c0-512MB-85-220-0-0.png/1200x630wa.png','Success','https://i.postimg.cc/JnwFp3Kx/mmexport1751031208329.gif','https://i.postimg.cc/Vv8jkCYr/IMG-6574.gif','cart-total','replaceChild','请至少选择一种要清理的数据类型。','found','\x20分钟，开始模拟后台活动...','AI返回的行动中未找到有效的JSON数组。','\x0a#\x20你的任务\x0a你就是角色“','book-upload-input','<div\x20class=\x22avatar-group\x22><img\x20src=\x22','application/json','.music-player-window','touchmove','Memo','close-call-transcript-btn','input[name=\x22theme-select\x22]','-modal','\x20[社交背景:\x20','a\x20beautiful\x20scenery,\x20anime\x20style,\x20cinematic\x20lighting','\x22\x20的独立行动失败:','apiPresets','system_message','remove','#f0f2f5','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','next-page-btn','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-title\x22>','en-US','80px','确定要删除与\x20\x22','https://i.postimg.cc/Lsjzj5Yt/IMG-4729.gif','API\x20错误:\x20','有点饿了，可以去找充电器惹','\x22>×</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','chatData','NovelAI\x20API\x20Key','\x20中聊天','confirm-merge-import-btn','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>','switchToCharHomeScreen','#ccc','world-book-tab','https://i.postimg.cc/Dydkpd9H/IMG-4421.gif','编辑记忆','https://i.postimg.cc/LXyyqDbY/IMG-6294.gif','douban-comment-item','prophetCheck','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22usage-item-time\x22>','bulkDelete','检测到\x20UTF-16\x20BE\x20BOM，使用\x20UTF-16\x20BE\x20解码。','确定要删除这张照片吗？此操作不可恢复。','确定要删除这条通话消息吗？','头像和人设不能都为空哦！','my-avatar-preview','data:\x20','编辑预设','documentElement','https://i.postimg.cc/GhR6DT4Q/IMG-4428.gif','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22image-size-label\x22>本地图片(头像/表情/头像框/等)大小:</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22image-size-value\x22><strong>','Appearance','正在请求AI角色们加入讨论...','callRecords','minimized','ephone-language','为NPC\x20\x22','announcement-action-delete',')\x20成功抢到了\x20','import-card-input','\x22>+</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','在此修改，或点击上方按钮使用格式模板...','confirm-gift-recipient-btn','<input\x20type=\x22checkbox\x22\x20value=\x22book_','保存书籍(ID:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20最近的对话摘要\x20(供你参考)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x0a---\x0a','AI幻觉已被拦截！试图使用群名\x20(\x22','https://i.postimg.cc/RZNLhbbr/IMG-4389.gif','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22waimai-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22waimai-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22https://files.catbox.moe/mq179k.png\x22\x20class=\x22icon\x22\x20alt=\x22Meituan\x20Icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22title-group\x22><span\x20class=\x22brand\x22>美团外卖</span><span\x20class=\x22separator\x22>|</span><span>外卖美食</span></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22waimai-main\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22request-title\x22\x20style=\x22margin-bottom:\x2012px;\x22>','\x0a-\x20**\x20你的聊天对象（用户）的人设**:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20**用户发送的申请理由**:\x20“','parentNode','werewolf-role-modal','showStatusBar','[图片]\x20','解析成功：通过强力提取\x20{...}\x20模式。','<span\x20class=\x22diary-emphasis\x22>$1</span>','生成购物中心商品失败:','video-call-btn','quote','nai-cfg-scale','离线预设','nai-test-prompt','players','.at-mention-popup','\x20的头像框到群聊\x20\x22','部分下载完成','未知NPC','setItem','正在呼叫所有成员...','contains','transform\x200.4s\x20cubic-bezier(0.4,\x200,\x200.2,\x201)','select-all-products-checkbox','<button\x20class=\x22sticker-category-tab\x20','qzonePhotos','close','loadAsync','手动创建角色','\x20之间的有效数字。','UTF-8\x20解码失败，将尝试\x20GBK\x20(ANSI)\x20解码...','https://i.postimg.cc/y8MmJcd6/IMG-4728.gif','角色卡导入被取消:','Browser','一些之前的消息已被用户删除。','https://api.vkeys.cn/v2/music/tencent?word=','div','已恢复默认设置！','upload-sticker-btn','cart-screen','auto-memory-interval','</tbody></table><div\x20class=\x22receipt-total\x22>总计:\x20¥','文章完整内容...','<div\x20class=\x22avatar-group\x20has-frame\x22\x20style=\x22width:\x2045px;\x20height:\x2045px;\x22><div\x20class=\x22avatar-with-frame\x22\x20style=\x22width:\x2045px;\x20height:\x2045px;\x22><img\x20src=\x22','ai-original-name-group','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20@font-face\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','\x20MB','\x27>语音</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27','delete-btn','battery-alert-text','promptFeedback','更换专辑封面','likes','<div\x20class=\x22lyric-line\x22>♪\x20暂无歌词\x20♪</div>','\x0a[图片]','\x0a-\x20\x20\x20**发语音**:\x20`{\x22type\x22:\x20\x22voice_message\x22,\x20\x22content\x22:\x20\x22语音文字内容\x22}`\x0a-\x20\x20\x20**引用回复**:\x20`{\x22type\x22:\x20\x22quote_reply\x22,\x20\x22target_timestamp\x22:\x20消息时间戳,\x20\x22reply_content\x22:\x20\x22回复内容\x22}`\x0a-\x20\x20\x20**发送后立刻撤回**:\x20`{\x22type\x22:\x20\x22send_and_recall\x22,\x20\x22content\x22:\x20\x22你想让AI说出后立刻消失的话\x22}`\x20(用于模拟说错话、后悔等场景，消息会短暂出现后自动变为“已撤回”)\x0a\x0a###\x20社交与互动指令\x0a-\x20\x20\x20**发动态(说说)**:\x20`[{\x22type\x22:\x20\x22qzone_post\x22,\x20\x22postType\x22:\x20\x22shuoshuo\x22,\x20\x22content\x22:\x20\x22文字内容\x22}]`\x0a-\x20\x20\x20**发动态(文字图)**:\x20`[{\x22type\x22:\x20\x22qzone_post\x22,\x20\x22postType\x22:\x20\x22text_image\x22,\x20\x22publicText\x22:\x20\x22(可选)公开文字\x22,\x20\x22hiddenContent\x22:\x20\x22图片描述\x22,\x20\x22image_prompt\x22:\x20\x22图片的【英文】关键词,\x20用%20分隔,\x20风格为风景/动漫/插画/二次元等,\x20禁止真人\x22}]`\x0a','此功能已为您的设备永久解锁。','.playlist-item-info','chat-group-container','请至少选择一种要合并的数据类型。','”。红包还未领完，群内任何人都可以使用\x20\x27open_red_packet\x27\x20指令来领取。]','QQ音乐搜索API失败:','(暂无有效聊天记录)\x0a','appUsageLog','management-mode','world-book-editor-title','</memory>\x0a\x20\x20<recent_dialogue_with_user>','”移出群聊吗？','speaker_name','\x0a\x20\x20\x20\x20\x20\x20\x20\x20**当前参与者**:\x20','cancel-variation-selection-btn','小于1分钟','Response\x20headers:','Cancel','Regular\x20Expression\x20(use\x20g\x20flag)','sticker_','最近\x20100\x20条','...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','lastMemorySummaryTimestamp','hang-up-btn','char-home-screen','”图标','你是狼人，请选择刀人目标。','取消置顶','在写入文件流时发生错误:\x20','char-memo-screen','[一张图片，描述为：\x22','change-frame-btn','</p><p>','**。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20为了让你的行为看起来更真实，你本次的行动【必须】选择一个与上次【不同类型】的指令。例如，如果上次是发动态(qzone_post)，这次就应该优先考虑评论(qzone_comment)、点赞(qzone_like)或发消息(text)。\x0a\x20\x20\x20\x20\x20\x20\x20\x204.\x20\x20**【行为组合指南\x20(最高级技巧)】**:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20你可以在一次行动中执行【多个不同类型的指令】，同时可以搭配【更新状态】来展现自己，让你的行为更丰富、更主动。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20你可以根据你的性格，决定在发动态后是否要私信提醒用户。例如，一个外向、渴望关注的角色可能会这么做，而一个内向、安静的角色则可能更喜欢默默分享，等待用户自己发现。\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20【社交义务铁律\x20】\x0a\x20\x20\x20\x20\x20\x20\x20\x201.\x20\x20**【至关重要】**:\x20当你发现“最近的动态列表”中，有你【感兴趣且还未互动过】的动态时，你**应该优先考虑**使用\x20\x27qzone_comment\x27\x20或\x20\x27qzone_like\x27\x20指令去进行互动，这比你自己发一条新动态更符合社交礼仪。\x0a\x20\x20\x20\x20\x20\x20\x20\x202.\x20\x20特别是当一条动态【没有任何评论】时，你的评论会是第一个，这会让作者感到开心。\x0a\x20\x20\x20\x20\x20\x20\x20\x203.\x20\x20**【回复铁律\x20(终极版)】**:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20当你决定回复动态中的某条评论时，你【必须】使用“方式4\x20(回复评论)”的指令格式。你【必须】正确填写\x20\x27replyTo\x27\x20字段为被回复者的“本名”。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**即使你之前已经评论过某条动态，但如果现在看到了【新的、你感兴趣的】评论，你【也应该】主动去回复他们，以保持对话的持续性！**\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x206.\x20\x20你的回复【必须】是一个JSON数组，必须包含多个行动对象。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20【表情评论指南\x20】\x0a\x20\x20\x20\x20\x20\x20\x20\x20你现在拥有了评论表情的能力，你应该更频繁地使用它！这能让你的角色更加生动、富有个性。\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**表达情绪时**:\x20当你感到开心、惊讶、疑惑或有趣时，优先考虑使用表情评论。\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**混合使用**:\x20不要总是只发文字。尝试将你的评论行为混合起来，大约有\x2030-40%\x20的评论应该是表情。\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**无话可说时**:\x20如果你觉得一条动态很有趣但又不知道该说什么文字，发送一个相关的表情是最好的互动方式。\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**删除动态**:\x20如果你觉得你之前发的某条动态不妥或过时了，你可以选择删除它。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20你的可选行动指令\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**发消息+更新状态**:\x20\x27[{\x22type\x22:\x20\x22update_status\x22,\x20\x22status_text\x22:\x20\x22正在做的事\x22,\x20\x22is_busy\x22:\x20true},\x20{\x22type\x22:\x20\x22text\x22,\x20\x22content\x22:\x20\x22你想对用户说的话...\x22}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**发说说\x20(原创内容)**:\x20\x27[{\x22type\x22:\x20\x22qzone_post\x22,\x20\x22postType\x22:\x20\x22shuoshuo\x22,\x20\x22content\x22:\x20\x22动态的文字内容...\x22}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**【重要：转发动态】**:\x20**严禁**自己拼接\x22//转发\x22文字！你【必须】使用此专用指令来转发：\x27[{\x22type\x22:\x20\x22repost\x22,\x20\x22postId\x22:\x20(要转发的动态ID),\x20\x22comment\x22:\x20\x22你的转发评论...\x22}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**发送表情**:\x20\x27[{\x22type\x22:\x20\x22sticker\x22,\x20\x22meaning\x22:\x20\x22表情的含义(从可用表情列表选择)\x22}]\x27\x20\x20\x20\x20\x20\x20\x20\x20\x0a-\x20\x20\x20**发布文字图**:\x20\x27[{\x22type\x22:\x20\x22qzone_post\x22,\x20\x22postType\x22:\x20\x22text_image\x22,\x20\x22publicText\x22:\x20\x22(可选)动态的公开文字\x22,\x20\x22hiddenContent\x22:\x20\x22对于图片的具体【中文】描述...\x22,\x20\x22image_prompt\x22:\x20\x22图片的【英文】关键词,\x20用%20分隔,\x20风格为风景/动漫/插画/二次元等,\x20禁止真人\x22}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**【评论动态的四种方式】**:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**方式1\x20(单条文字)**:\x20\x27[{\x22type\x22:\x20\x22qzone_comment\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22postId\x22:\x20123,\x20\x22commentText\x22:\x20\x22这太有趣了！\x22}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**方式2\x20(多条文字)**:\x20\x27[{\x22type\x22:\x20\x22qzone_comment\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22postId\x22:\x20123,\x20\x22comments\x22:\x20[\x22哇！\x22,\x20\x22这是什么？\x22,\x20\x22看起来好棒！\x22]}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**方式3\x20(表情)**:\x20\x27[{\x22type\x22:\x20\x22qzone_comment\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22postId\x22:\x20456,\x20\x22stickerMeaning\x22:\x20\x22表情的含义(必须从可用表情列表选择)\x22}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**方式4\x20(回复评论)**:\x20\x27[{\x22type\x22:\x20\x22qzone_comment\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22postId\x22:\x20123,\x20\x22replyTo\x22:\x20\x22被回复者的本名\x22,\x20\x22commentText\x22:\x20\x22你的回复内容。请注意：在commentText中如果要@对方，你【必须】使用@[[被回复者的本名]]这种特殊格式，程序会自动将其替换为正确的昵称。\x22}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**点赞**:\x20\x27[{\x22type\x22:\x20\x22qzone_like\x22,\x20\x22postId\x22:\x20456}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**打视频**:\x20\x27[{\x22type\x22:\x20\x22video_call_request\x22}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**更换头像**:\x20\x27{\x22type\x22:\x20\x22change_avatar\x22,\x20\x22name\x22:\x20\x22头像名\x22}\x27\x20(头像名必须从下面的“可用头像列表”中选择)\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**删除动态**:\x20\x27{\x22type\x22:\x20\x22qzone_delete_post\x22,\x20\x22postId\x22:\x20(要删除的、你自己的动态ID)}\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**更新状态**:\x20\x27[{\x22type\x22:\x20\x22update_status\x22,\x20\x22status_text\x22:\x20\x22正在做的事\x22,\x20\x22is_busy\x22:\x20true}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20','originalContent','bottom','###\x20最终结果:\x20','找不到相册:','✅\x20图片转换成功！🎨','fillStyle','”，并根据其人设、记忆和最近的互动，虚构出TA最近的淘宝购物记录和账户余额。\x0a\x0a#\x20核心规则\x0a1.\x20\x20**余额铁律\x20(最高优先级)**:\x20你【必须】根据角色的【经济状况】设定一个合理的\x20`totalBalance`\x20(总余额)。例如，富有的角色应该有更高的余额，而学生或经济拮据的角色则应该有较低的余额。\x0a2.\x20\x20**合理性**:\x20购买记录必须完全符合角色的性格、爱好和经济状况。\x0a3.\x20\x20**格式铁律\x20(最高优先级)**:\x20\x0a\x20\x20\x20\x20-\x20你的回复【必须且只能】是一个【单一的JSON对象】。\x0a\x20\x20\x20\x20-\x20你的回复必须以\x20`{`\x20开始，并以\x20`}`\x20结束。\x0a\x20\x20\x20\x20-\x20【绝对禁止】在JSON数组前后添加任何多余的文字、解释、或\x20markdown\x20标记。\x0a\x20\x20\x20\x20-\x20格式【必须】如下:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22totalBalance\x22:\x2012345.67,\x20//\x20(这是一个示例数字，你必须根据角色的经济状况生成一个全新的、合理的余额！)\x0a\x20\x20\x20\x20\x20\x20\x22purchases\x22:\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22itemName\x22:\x20\x22一个具体、生动的商品名称\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22price\x22:\x20128.80,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22status\x22:\x20\x22已签收\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22reason\x22:\x20\x22这是角色购买这件商品的内心独白或理由，必须使用第一人称“我”来写。\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22image_prompt\x22:\x20\x22一段用于生成这张商品图片的、详细的【英文】关键词,\x20风格为\x20realistic\x20product\x20photo,\x20high\x20quality,\x20on\x20a\x20clean\x20white\x20background\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20]\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20```\x0a\x20\x20\x20\x20-\x20**purchases**:\x20一个包含12到15个商品对象的数组。\x0a\x20\x20\x20\x20-\x20**status\x20(订单状态)**:\x20只能从\x20\x22已签收\x22,\x20\x22待发货\x22,\x20\x22运输中\x22,\x20\x22待评价\x22\x20中选择。\x0a\x0a#\x20供你参考的上下文\x0a-\x20**你的角色设定**:\x20','rule-enabled-switch','Finish','</div><div\x20class=\x22footer\x22><svg\x20class=\x22footer-icon\x22\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x2210\x22></circle><line\x20x1=\x222\x22\x20y1=\x2212\x22\x20x2=\x2222\x22\x20y2=\x2212\x22></line><path\x20d=\x22M12\x202a15.3\x2015.3\x200\x200\x201\x204\x2010\x2015.3\x2015.3\x200\x200\x201-4\x2010\x2015.3\x2015.3\x200\x200\x201-4-10\x2015.3\x2015.3\x200\x200\x201\x204-10z\x22></path></svg><span>','shoppingCategoryCount','save-douban-cast-btn','warn','Wallet','ai-original-name-input','setHours','toString','(无标题投票)','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22amap-item-footer\x22>','custom','time-zone-search-input','qzone-avatar-container','generate','nickname','狼人请选择刀人对象','npc-name-input','收藏成功','无人接听群聊邀请。','chat-list','data-clear-wizard-modal','为什么','date','</span><span>','\x22\x20placeholder=\x22例如:\x20key1,\x20key2\x22\x20style=\x22padding:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20这里是全新的、带有“展开/收起”按钮的结构\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22\x20style=\x22margin-bottom:\x200;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22font-size:\x200.8em;\x20display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>内容\x20(点击右侧展开)</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20class=\x22toggle-content-btn\x22>展开</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22entry-content-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20class=\x22entry-content-textarea\x22\x20rows=\x228\x22\x20style=\x22width:\x20100%;\x20font-size:\x2014px;\x22>','size','group-avatar-upload-input','cancelText','ServiceWorker\x20注册失败:\x20','syncCharacterNameInGroups:\x20传入的不是有效的单聊对象，已跳过同步。','placeholder.png','target','/v1/models','📥\x20图片下载中...','music-total-time','https://i.postimg.cc/cCpBYbMH/IMG-6552.gif','simulatedAlbum','npc-group-manager-modal','Rendering\x20Rules','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22remove-member-btn\x22\x20data-member-id=\x22','focusout','\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20','iVBORw0KGgo','char-music-item','\x20元，订单时间戳为\x20','currentPhase','请求添加你为好友','waimai-request-modal','stickerMeaning','copy-post-btn','witch-modal-title','AI幻觉已被拦截！试图在群聊中发送一条没有“name”的消息。消息内容:','existing-categories-list','frame_9','rule-editor-title','https://i.postimg.cc/VkQfgzGJ/1.jpg','\x0a#\x20【情景感知】\x0a-\x20**时间**:\x20感知到当前是','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22participants-names\x22>与\x20','确认清理无效歌曲？','[图片内容:\x20','music-exit-btn','\x20\x20\x20\x20-\x20我没有掌握任何特殊的夜晚信息。\x0a','Remove','aiAvatarLibrary','检测到提示词已修改，正在重新生成\x20NovelAI\x20图片...','\x22\x20title=\x22删除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x223\x206\x205\x206\x2021\x206\x22></polyline>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M19\x206v14a2\x202\x200\x200\x201-2\x202H7a2\x202\x200\x200\x201-2-2V6m3\x200V4a2\x202\x200\x200\x201\x202-2h4a2\x202\x200\x200\x201\x202\x202v2\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','https://i.postimg.cc/hPX5F8Qp/IMG-4415.gif','regenerate-char-browser-btn','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x22>未找到相关的聊天记录。</p>','pipeTo','mousemove','https://i.postimg.cc/v8V9xXjJ/IMG-6137.gif','<div\x20class=\x22comment-item\x22\x20data-post-id=\x22','selection-soft-delete-btn','https://i.postimg.cc/VkXngG72/mmexport1751031208329.gif','decision','json','2964MBnIGZ','Edit\x20Rule','group-action-cooldown-input','\x20本世界书，并解除它们与所有角色的关联。此操作【不可恢复】！','确定要删除这个约定吗？','test-sound-btn','https://i.postimg.cc/HxH3cNHz/IMG-6871.gif','世界书导入被取消:','原文:\x20\x22','gameover','彻底删除','style=\x22background-image:\x20url(\x27','App\x20Usage','无法推进剧情:\x20','presetCategories','\x20天\x20---**\x0a','label','char-usage-list','Independent\x20Action\x20Cooldown\x20(min)','”\x20以及其他群成员的【群组视频通话】，然后用【第一人称\x20(\x22我\x22)】的口吻，总结出一段简短的、客观的、包含关键信息的记忆。\x0a\x0a#\x20当前时间\x0a-\x20**今天是：','https://i.postimg.cc/htZppbS4/IMG-7107.gif','reset-character-nai-prompts-btn','<div\x20class=\x22link-share-card\x22\x20data-timestamp=\x22','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22player-name\x22>','add-selected-music-btn','icon-setting-item','公用\x20(所有角色)','\x22\x20data-category-id=\x22','photos-grid-page','npc-avatar-preview','<span>已</span><span>超</span><span>时</span>','狼人杀','match','文件格式不正确，缺少关键的外观设置项。',')\x20时出错:','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','call-history-title','summarize-recent-btn-header','API\x20返回错误:\x20','minimax-group-id','8VcTLmc','heartfeltVoice','AI的五子棋移动指令包含无效坐标，已忽略:','shopping-settings-btn','\x20(用户)</span>\x0a\x20\x20\x20\x20','buttonId','\x20的动态\x20(NPC)','https://i.postimg.cc/Y0vwjhb7/IMG-6857.gif','主API和副API均未配置或配置不完整。','<div></div><div></div><div></div><div></div><div></div>','.post-nickname','音频播放失败:','”。\x0a\x20\x20\x20\x20\x20\x20\x20\x20作为参考，这是你们之前的最后一段聊天记录：\x0a\x20\x20\x20\x20\x20\x20\x20\x20---\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x22\x20class=\x22comment-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22comment-input\x22\x20placeholder=\x22友善的评论是交流的起点\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22comment-sticker-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x2210\x22></circle>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M8\x2014\x20Q\x2012\x2016\x2016\x2014\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x229\x22\x20y1=\x229\x22\x20x2=\x229.01\x22\x20y2=\x229\x22></line>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x2215\x22\x20y1=\x229\x22\x20x2=\x2215.01\x22\x20y2=\x229\x22></line>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22at-mention-popup\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22comment-send-btn\x22>发送</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22voice-duration\x22>','paddingBottom','分片导出\x20(推荐，打包为ZIP，解压每个切片选择增量导入)','repost-comment-input','getAttribute','\x20MB</strong>\x20(压缩率\x20','borderColor','ai-response-editor-modal','min','music','.entry-comment-input','https://i.postimg.cc/3RpmWc8c/mmexport1751033102811.gif','”。]','❌\x20[NAI下载]\x20下载失败:','result','\x20已复制到剪贴板。','\x0a\x20\x20\x20\x20','[ERROR:\x20','variation','AI已将新头像命名为：“','#music-lyrics-container','++id,\x20name','合计:\x20¥','group-members-settings','https://i.postimg.cc/LscBkxZb/mmexport1751017556565.gif','apply-friend-btn','\x20同步所有群聊内的名称信息...','#e7f3ff','请先在API设置中填写您的\x20Minimax\x20Group\x20ID\x20和\x20API\x20Key。','\x20\x0a-\x20**你最近和“','确定要删除这个人设预设吗？此操作不可恢复。','switchToMyPhone','导入\x20Tavern\x20预设','<div\x20class=\x22poll-options-list\x22>','请填写完整的约定标题和日期！','alwaysShowMusicIsland','”\x20吗？','cancel-douban-cast-btn','shift','analysis','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','商品名称不能为空！','safetyRatings','++id,\x20name,\x20chatId','left','CSS\x20预设已保存！','amap','完全导入失败:','favorites','customName','is-location-share','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span><svg\x20viewBox=\x220\x200\x201024\x201024\x22><path\x20d=\x22M853.333333\x2085.333333H170.666667c-46.933333\x200-85.333333\x2038.4-85.333334\x2085.333334v512c0\x2046.933333\x2038.4\x2085.333333\x2085.333334\x2085.333333h512l170.666667\x20170.666667V170.666667c0-46.933333-38.4-85.333333-85.333334-85.333334z\x20m-42.666666\x20554.666667H170.666667V170.666667h640v469.333333zM256\x20384h512v85.333333H256V384z\x20m0-170.666667h512v85.333334H256v-85.333334z\x22></path></svg>\x20','找不到主角\x20“','recall-message-btn','share-target-list','</em>','is-voice-message','shoppingProducts','productInfo','renderQzoneScreenProxy','\x0a#\x20可用指令列表\x20(按需组合使用)\x0a\x0a###\x20思维链\x20(必须作为第一个元素！)\x0a-\x20\x20\x20**`{\x22type\x22:\x20\x22thought_chain\x22,\x20\x22analysis\x22:\x20\x22你对当前局势和用户上一轮发言的分析...\x22,\x20\x22strategy\x22:\x20\x22你作为导演，本轮的总体策略...\x22,\x20\x22character_thoughts\x22:\x20{\x22角色A本名\x22:\x20\x22角色A的内心活动...\x22,\x20\x22角色B本名\x22:\x20\x22角色B的内心活动...\x22}}`**\x0a\x20\x20\x20\x20-\x20\x20\x20**analysis**:\x20简要分析用户的意图或群聊的氛围。\x0a\x20\x20\x20\x20-\x20\x20\x20**strategy**:\x20你作为导演的计划（例如：让A和B互动，禁止成员总结）。\x0a\x20\x20\x20\x20-\x20\x20\x20**character_thoughts**:\x20【只包含本轮会发言的AI角色】的内心独白。\x0a\x0a\x0a###\x20核心聊天\x0a-\x20\x20\x20**发文本**:\x20`{\x22type\x22:\x20\x22text\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22message\x22:\x20\x22内容\x22}`\x0a-\x20\x20\x20**发表情**:\x20`{\x22type\x22:\x20\x22sticker\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22meaning\x22:\x20\x22表情的含义(必须从可用表情列表选择)\x22}`\x0a-\x20\x20\x20**发图片**:\x20`{\x22type\x22:\x20\x22ai_image\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22description\x22:\x20\x22中文描述\x22,\x20\x22image_prompt\x22:\x20\x22图片的【英文】关键词,\x20用%20分隔,\x20风格为风景/动漫/插画/二次元等,\x20禁止真人\x22}`\x0a','\x0a\x0a#\x20统一角色列表\x20(你扮演的角色\x20+\x20路人NPC)\x0a','world-book-tabs','remove-ephone-bg-btn','1girl,\x20best\x20quality,\x20masterpiece,\x20...','change_user_nickname','请输入新的名称（留空则恢复默认）','hasShown20','transparent','charging','favid','.zip','(Timestamp:\x20','聊天列表每次加载条数','生成模拟浏览器历史失败:','》吗？此操作不可撤销。','handleWidgetImageChange','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22douban-comment-text\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22format-helpers\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-type=\x22text\x22>说说</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27','聊了关于生日派对的事，我们约好了10月1日见面。\x22\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20```\x0a#\x20待总结的群聊记录\x0a','lyrics-active','photos','records','表情分类','请至少选择一个要删除的世界书。',')}。\x0a-\x20**对话状态**:\x20','分类名不能为空！','未找到相关收藏','marquee\x20var(--marquee-duration,\x2010s)\x20linear\x20infinite','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','product-name-input','font-size-value','char-conversation-partner-name','outgoing-call-avatar','https://i.postimg.cc/WbF8kzz9/IMG-7282.jpg','quality_toggle','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22amap-item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22amap-item-icon\x22>📍</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22amap-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22amap-item-title\x22>','startTime','更换歌曲背景',')\x20商品:\x20','char_memo','nai-uc-preset','后台活动:\x20角色\x20\x22','https://i.postimg.cc/8kHCQwbQ/mmexport1751020645824.gif','\x0a\x0a#\x20游戏规则\x0a-\x20','无法获取模型列表','secondary-api-key','positive','island-lyric-text','<div\x20class=\x22rp-claimed-info\x22>红包已被领完</div>','vertical','所有解码尝试均失败:','background-interval-input','https://i.postimg.cc/76Tj3g1B/IMG-4425.gif','请填写有效的商品信息和金额！','操作取消','\x20位角色生成豆瓣动态...','#delete-world-books-list\x20.clear-posts-item.selected','\x20领取了\x20','member','diary','thoughtsHistory','translateX(-50%)','source','music-mode-btn','generativelanguage','没有聊天了。','px)','继续讨论','character-select-item','密钥\x20(API\x20Key)','selected','\x0a-\x20**你的聊天对象设定**:','delete','精炼长期记忆时出错:','”，选项有：[','成员们正在输入...','**。\x0a\x20\x20\x20\x20-\x20\x20\x20你生成的【所有】日记的标题日期，【必须】是今天或今天以前的日期。\x0a\x20\x20\x20\x20-\x20\x20\x20【绝对禁止】生成任何未来的日期！\x0a2.\x20\x20**【沉浸感】**:\x20每一篇日记都必须使用【第一人称视角\x20(\x22我\x22)】来写，并且要充满角色的个人情感、思考和秘密。在日记中描述自己的行为或想法时，【绝对禁止】使用第三人称“他”或“她”\x20(TA)。\x0a3.\x20\x20**【长度】**:\x20每一篇日记的正文长度【必须不少于300字】。\x0a4.\x20\x20**【格式铁律\x20(最高优先级)】**:\x20\x0a\x20\x20\x20\x20-\x20你的回复【必须且只能】是一个JSON数组格式的字符串。\x0a\x20\x20\x20\x20-\x20你的回复必须以\x20`[`\x20开始，并以\x20`]`\x20结束。\x0a\x20\x20\x20\x20-\x20【绝对禁止】在JSON数组前后添加任何多余的文字、解释、或\x20markdown\x20标记\x20(如\x20```json)。\x0a\x20\x20\x20\x20-\x20数组中的每个元素都是一个对象，代表一篇日记，格式【必须】如下:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20[\x0a\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22title\x22:\x20\x22这篇日记的标题，例如：9月20日\x20晴\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22这里是日记的详细正文，必须支持换行符\x5cn，并且必须巧妙地使用下面的【日记专属Markdown语法】来丰富文本表现力。\x22\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20]\x0a\x20\x20\x20\x20```\x0a5.\x20\x20**【占位符替换\x20(最高优先级)】**:\x20在你的日记内容中，【绝对不能】出现\x20\x22{{user}}\x22\x20这个占位符。你【必须】使用\x20“','[系统指令：模式已切换！你现在回到了线上聊天模式。你的回复【必须】严格遵守线上模式的JSON数组格式，例如\x20[{\x22type\x22:\x20\x22text\x22,\x20\x22content\x22:\x20\x22你好\x22}]]','胜负未分','”的聊天记录已成功导出！','gameLog','offsetLeft','Sticker','linked-chats-checkboxes-container','white','add-my-avatar-url-btn','群聊\x20\x22','incoming-call-modal','Language\x20\x22','小时前聊过。','image/*','点击下方上传','是否要使用毒药？','群里还没有任何消息。','Minimax\x20TTS\x20API\x20调用失败:','chargingchange','&id','使用\x20browser-image-compression\x20压缩失败:','操作失败','offsetHeight','删除歌曲','\x0a#\x20可用表情包\x0a-\x20当你需要发送表情时，你【必须】从下面的列表中【精确地选择一个】含义（meaning）。\x0a-\x20【绝对禁止】使用任何不在列表中的表情含义！\x0a\x20\x20\x20\x20','chat-list-action-pin','zIndex','#preset-content-container\x20.world-book-category-pane','容错解析：策略2成功\x20(提取了summary字段内容)','发送照片','Settings','char-audio-player','[一张图片，描述为：“','toISOString','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>','\x20发布了一条新动态]','NPC\x20Nickname','greeting','data','[发送了一条复杂消息，如卡片或转账]','Loading...','transform\x200.15s\x20ease','结算(','\x20的身份是：','https://i.postimg.cc/T3NvqJCZ/IMG-6851.gif','a\x20beautiful\x20scene','\x22\x20的本次后台活动跳过。原始回复:','share-link-modal','fullscreen-active','-\x20昨晚是平安夜，无人死亡。\x0a','private_user','parsedLyrics','达到自动总结阈值\x20(','猎人死亡，请选择一名玩家带走！','✅\x20图片解压成功！','你们最近没有有效聊天记录。','profile-random-jottings','sender-name','usage','文件格式不正确，这不是一个有效的世界书备份文件。','?key=','-\x20**对话状态**:\x20这是你们的第一次对话，用户的第一条消息发送于\x20','”的群聊中的对话。这个群聊里【没有用户】，所有成员都是你扮演的角色。你的任务是让他们之间进行一场生动、自然的对话。\x0a\x0a#\x20输出格式铁律\x20(最高优先级)\x0a-\x20你的回复【必须】是一个JSON数组。\x0a-\x20数组中的每个对象都【必须】包含\x20\x22type\x22\x20字段和\x20\x22name\x22\x20字段（角色的【本名】）。\x0a\x0a#\x20角色扮演核心规则\x0a1.\x20\x20**【角色间互动\x20(最重要!)】**:\x20你的核心是创作一场“戏”。角色之间【必须】互相回应、补充或反驳，形成自然的讨论。严禁生成仅分别自言自语的独白。\x0a2.\x20\x20**【禁止出戏】**:\x20绝不能透露你是AI、模型或剧本作家。\x0a3.\x20\x20**【主动性】**:\x20角色们应该主动使用各种功能（发表情、发语音、分享图片等）来让对话更生动，而不是仅仅发送文字。\x0a4.请根据当前情景和你的情绪，从列表中【选择一个最合适的】表情含义来使用\x20\x22sticker\x22\x20指令。尽量让你的表情丰富多样，避免重复。\x0a#\x20可用指令列表\x20(你现在可以使用所有这些功能！)\x0a-\x20\x20\x20**发文本**:\x20`{\x22type\x22:\x20\x22text\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22content\x22:\x20\x22你好呀！\x22}`\x0a-\x20\x20\x20**发表情**:\x20`{\x22type\x22:\x20\x22sticker\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22meaning\x22:\x20\x22表情的含义(必须从可用表情列表选择)\x22}`\x0a-\x20\x20\x20**发图片**:\x20`{\x22type\x22:\x20\x22ai_image\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22description\x22:\x20\x22详细中文描述\x22,\x20\x22image_prompt\x22:\x20\x22图片的【英文】关键词,\x20风格为风景/动漫/插画/二次元等,\x20禁止真人\x22}`\x0a-\x20\x20\x20**发语音**:\x20`{\x22type\x22:\x20\x22voice_message\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22content\x22:\x20\x22语音文字内容\x22}`\x0a-\x20\x20\x20**引用回复**:\x20`{\x22type\x22:\x20\x22quote_reply\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22target_timestamp\x22:\x20消息时间戳,\x20\x22reply_content\x22:\x20\x22回复内容\x22}`\x0a\x0a#\x20当前群聊信息\x0a-\x20**群名称**:\x20','regenerate-char-album-btn','reset-nai-settings-btn','请输入有效的正整数！','从缓存播放\x20TTS\x20音频...','在动态评论区点击了表情，但在表情库中未找到对象:','Edit','<input\x20type=\x22checkbox\x22\x20name=\x22visibility_group\x22\x20value=\x22','选择精炼范围','authorName','appName','头像框','正在请求“','已重置为默认提示音，点击“保存所有外观设置”后生效。','\x20字左右**。\x0a6.\x20\x20**【输出格式】**:\x20你的回复【必须且只能】是一个JSON对象，格式如下：\x0a\x20\x20\x20\x20`{\x22summary\x22:\x20\x22在这里写下你以第一人称视角，总结好的核心事实与计划。\x22}`\x0a\x0a#\x20你的角色设定\x20(必须严格遵守)\x0a','touches','容错解析：策略1成功\x20(找到并解析了完整的JSON对象)','https://i.postimg.cc/CLNkrQSW/IMG-6925.gif','handleListenTogetherClick','」听歌。要结束并开始和「','werewolf_summary','.sticker-item[data-sticker-id=\x22','aiAvatar','未发现任何需要修复的数据问题。','<br>','base','.werewolf-player-checkbox:checked','https://i.postimg.cc/05wnd389/IMG-4388.gif','++id,\x20type,\x20timestamp,\x20originalTimestamp','music-player-cover','tEXt','个月前','npc-editor-modal',')\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22sticker-name\x22>','shoppingCategories','offline-mode-toggle','https://api.vkeys.cn/v2/music/netease/lyric?id=','onchange','\x20\x20\x20\x20-\x20我昨晚用解药救了\x20','”发送的、尚未领完的红包（时间戳:\x20','https://i.postimg.cc/xTk5xN49/IMG-7233.gif','”的身份，开始你的客观总结。','-\x20公告内容:\x20\x22','Manage','has-frame','\x20的消息:\x20\x22','\x22\x20触发行动决策...','群聊已建立...','\x22\x20的整个对话吗？此操作不可撤销。','reading-overlay','block-cooldown-input','https://i.postimg.cc/7LSRp4hx/e7fa949b9pc84cff0dabe57defceb54c.gif','API未配置','数据库写入失败:\x20','ai-avatar-group','\x22\x20class=\x22chat-image\x22></div>','.call-message-bubble[data-timestamp=\x22','代付请求已被拒绝','type','onload','history-back-btn','world-book-screen','书库是空的，点击“导入新书”添加第一本吧！','https://i.postimg.cc/wjfcQMkZ/IMG-6573.gif','\x27>图片</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>没有可以删除的世界书。</p>','object','导演/编辑模式保存(Sticker):\x20将\x20content\x20视为\x20URL，查找到\x20meaning:','voted','currentText','cancel-douban-settings-btn','my-group-nickname-input','✅\x20检测到直接的图片\x20base64\x20数据\x20(PNG/JPEG)','-\x20清理了\x20','chat-settings-modal','\x20已满\x20(大小:\x20','current','nai-test-status',';base64,','cancel-persona-editor-btn','[系统提示：用户（','置顶公告','.variation-price-input','preset-editor-screen','gap','change_group_name','\x22\x20吗？','regenerate-char-amap-btn','并评论说：\x22','\x20条旧的红包消息！页面将自动刷新以应用更改。','packetType','#image-mode-content','请输入歌名','规则名称','lrc-upload-input','\x20(这是TA的昵称)\x0a-\x20**本名\x20(你在对话中必须用这个名字称呼TA)**:\x20','history','reject','default_positive','狼人杀游戏总结已自动存入\x20','poison','诊断：在\x20data.extensions.character_book\x20中找到世界书。','ai_image','frame_11','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-weight:\x20500;\x20margin:\x200\x200\x204px\x200;\x22>','在这里输入说说的内容...','placeholder','https://i.postimg.cc/DyYDmKtw/IMG-7238.gif','**\x0a\x0a#\x20核心规则\x0a1.\x20\x20**【视角铁律】**:\x20你的总结【必须】使用【主观的第一人称视角\x20(\x22我\x22)】来写。\x0a2.\x20\x20**【内容核心\x20(最高优先级)】**:\x20你的总结【必须】专注于以下几点：\x0a\x20\x20\x20\x20*\x20\x20\x20**重要事件**:\x20刚才发生了什么具体的事情？\x0a\x20\x20\x20\x20*\x20\x20\x20**关键决定**:\x20我们达成了什么共识或做出了什么决定？\x0a\x20\x20\x20\x20*\x20\x20\x20**未来计划**:\x20我们约定了什么未来的计划或待办事项？\x0a\x20\x20\x20\x20*\x20\x20\x20**重要时间点**:\x20对话中提到了哪些具体的日期或时间？\x0a3.\x20\x20**【时间转换铁律\x20(必须遵守)】**:\x20如果对话中提到了相对时间（如“明天”、“后天”），你【必须】结合“今天是','是狼...”)\x0a\x20\x20\x20\x20-\x20(例如：我的敌人发言了，我的表演就是无视TA的逻辑，直接攻击TA。)\x0a\x20\x20\x20\x20-\x20(例如：我是一个','input[value=\x22','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22douban-post-title\x22>','11BQznCb','\x20的记忆\x20]\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22）。你已经有一段时间没有和用户（','字体文件URL\x20(.ttf,\x20.otf,\x20.woff等)','EPhone-Sliced-Backup-','message-editor-modal','back-to-char-qq-list-btn','npc-editor-title','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22url\x22>www.','opened','voice','你已收款','✅\x20NAI提示词：使用角色配置','拉取副模型','><div\x20class=\x22card-pin-icon\x22><svg\x20width=\x221em\x22\x20height=\x221em\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22currentColor\x22\x20xmlns=\x22http://www.w3.org/2000/svg\x22><path\x20d=\x22M12\x2011.5C11.1716\x2011.5\x2010.5\x2010.8284\x2010.5\x2010C10.5\x209.17157\x2011.1716\x208.5\x2012\x208.5C12.8284\x208.5\x2013.5\x209.17157\x2013.5\x2010C13.5\x2010.8284\x2012.8284\x2011.5\x2012\x2011.5Z\x22></path><path\x20d=\x22M12\x202C7.92134\x202\x204.5\x205.42134\x204.5\x209.5C4.5\x2014.5312\x2011.2188\x2021.4375\x2011.5938\x2021.8125C11.7954\x2022.014\x2012.2046\x2022.014\x2012.4062\x2021.8125C12.7812\x2021.4375\x2019.5\x2014.5312\x2019.5\x209.5C19.5\x205.42134\x2016.0787\x202\x2012\x202ZM12\x2012.5C10.6193\x2012.5\x209.5\x2011.3807\x209.5\x2010C9.5\x208.61929\x2010.6193\x207.5\x2012\x207.5C13.3807\x207.5\x2014.5\x208.61929\x2014.5\x2010C14.5\x2011.3807\x2013.3807\x2012.5\x2012\x2012.5Z\x22></path></svg></div></div></div>','zh-CN','\x27>线下</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27','\x0a-\x20**世界书设定**:\x20','压缩步骤\x203/3:\x20正在将压缩后的数据写回数据库...','TTS\x20音频已保存到缓存。','[data-lang-key-title]','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20margin-top:\x2020px;\x22>还没有内容，点击下方按钮添加第一条吧！</p>','(无内容)','.header','playing','npc-list-view','regenerate-char-usage-btn','lastIndex',';\x0a\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2012px\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2012px\x20rgba(0,0,0,0.3);\x0a\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20pointer-events:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateY(20px);\x0a\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.3s\x20ease;\x0a\x20\x20\x20\x20','导出世界书时出错:','stickerId','”的长期记忆中。','ai-frame-content','帖子详情','char-music-player-title','enableAutoMemory','add-persona-preset-btn','existing-group-item','AI返回的JSON格式不正确，缺少\x20\x27categories\x27\x20数组。','https://i.postimg.cc/nrFfYX3N/IMG-4412.gif','sender','♪\x20♪\x20♪','\x20行格式不正确，已被忽略。','来自“','lucky','entries','\x22\x20点赞了动态\x20#','status_text','wallpaper','新NAI图片生成失败，此条消息已被跳过。','douban-detail-content-wrapper','\x20尝试发送私信，但未找到其对应的私聊会话。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22quoted-message\x22\x20data-original-timestamp=\x22','accept_transfer','NPC\x20昵称','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-name\x22>','poll-option-input-wrapper','renderingRules','button','\x27>链接</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22,\x20\x22content\x22:\x20[\x22私信内容\x22,\x20\x22...\x22]}`\x20(content\x20字段【必须】是数组)\x0a-\x20\x20\x20**发起群视频**:\x20`{\x22type\x22:\x20\x22group_call_request\x22,\x20\x22name\x22:\x20\x22角色本名\x22}`\x0a-\x20\x20\x20**回应群视频**:\x20`{\x22type\x22:\x20\x22group_call_response\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22decision\x22:\x20\x22join\x22\x20or\x20\x22decline\x22}`\x0a-\x20\x20\x20**切换歌曲**:\x20`{\x22type\x22:\x20\x22change_music\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22song_name\x22:\x20\x22歌名\x22}`\x20(从播放列表选)\x0a-\x20\x20\x20**发拼手气红包**:\x20`{\x22type\x22:\x20\x22red_packet\x22,\x20\x22packetType\x22:\x20\x22lucky\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22amount\x22:\x208.88,\x20\x22count\x22:\x205,\x20\x22greeting\x22:\x20\x22祝福语\x22}`\x0a-\x20\x20\x20**发专属红包**:\x20`{\x22type\x22:\x20\x22red_packet\x22,\x20\x22packetType\x22:\x20\x22direct\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22amount\x22:\x205.20,\x20\x22receiver\x22:\x20\x22接收者本名\x22,\x20\x22greeting\x22:\x20\x22祝福语\x22}`\x0a-\x20\x20\x20**打开红包**:\x20`{\x22type\x22:\x20\x22open_red_packet\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22packet_timestamp\x22:\x20红包时间戳}`\x0a-\x20\x20\x20**发起外卖代付**:\x20`{\x22type\x22:\x20\x22waimai_request\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22productInfo\x22:\x20\x22商品\x22,\x20\x22amount\x22:\x2018}`\x0a-\x20\x20\x20**回应外卖代付**:\x20`{\x22type\x22:\x20\x22waimai_response\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22status\x22:\x20\x22paid\x22,\x20\x22for_timestamp\x22:\x20请求时间戳}`\x0a-\x20\x20\x20**发起投票**:\x20`{\x22type\x22:\x20\x22poll\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22question\x22:\x20\x22问题\x22,\x20\x22options\x22:\x20\x22选项A\x5cn选项B\x22}`\x0a-\x20\x20\x20**参与投票**:\x20`{\x22type\x22:\x20\x22vote\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22poll_timestamp\x22:\x20投票时间戳,\x20\x22choice\x22:\x20\x22选项文本\x22}`\x0a-\x20\x20\x20**送礼物\x20**:\x20\x20`{\x22type\x22:\x20\x22gift\x22,\x20\x22name\x22:\x20\x22你的角色本名\x22,\x20\x22itemName\x22:\x20\x22礼物名称\x22,\x20\x22itemPrice\x22:\x20价格(数字),\x20\x22reason\x22:\x20\x22送礼原因\x22,\x20\x22image_prompt\x22:\x20\x22礼物图片【英文】关键词\x22,\x20\x22recipients\x22:\x20[\x22收礼人本名A\x22,\x20\x22收礼人本名B\x22]}\x20`\x0a-\x20\x20\x20**为他人点外卖**:\x20`{\x22type\x22:\x20\x22waimai_order\x22,\x20\x22name\x22:\x20\x22你的本名\x22,\x20\x22recipientName\x22:\x20\x22收礼者本名\x22,\x20\x22productInfo\x22:\x20\x22商品名\x22,\x20\x22amount\x22:\x20价格,\x20\x22greeting\x22:\x20\x22你想说的话\x22}`\x0a#\x20互动指南\x20(请严格遵守)\x0a-\x20\x20\x20**红包互动**:\x20抢红包后，你【必须】根据系统提示的结果（抢到多少钱、谁是手气王）发表符合人设的评论。\x0a-\x20\x20\x20**金额铁律**:\x20在发送红包或转账时，你【必须】根据你的角色设定\x20(尤其是“经济状况”)\x20来决定金额。如果你的角色非常富有，你应该发送符合你身份的、更大的金额\x20(例如:\x20520,\x201314,\x208888)，而不是示例中的小额数字。\x0a-\x20\x20\x20**音乐互动**:\x20【必须】围绕【用户的行为】进行评论。严禁将用户切歌等行为归因于其他AI成员。\x0a-\x20\x20\x20**外卖代付**:\x20仅当【你扮演的角色】想让【别人】付钱时才能发起。当订单被支付后，【绝对不能】再次支付。\x0a\x0a现在，请根据以上规则和下方的对话历史，继续这场群聊。','delete-selected-nai-gallery-btn','chat-messages','data:','删除表情','\x0a\x0a现在，请开始撰写这篇充满真情实感、并熟练运用了Markdown语法的日记。','图片已根据新提示词重新生成！','\x22\x20的记忆中清除了1条关于已删除评论的通知。','load-more-thoughts-btn','cancel-wolf-kill-btn','\x0a#\x20智能总结\x20(基于不同时间维度的群聊回顾)\x0a','increase-qty-btn','最终负面提示词:','(在那次','AI女巫决定使用解药！','#\x20你的互动对象\x20(用户和其他角色)\x0a','\x0a\x0a其专属的“世界书”也已自动创建并关联。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20[系统重要指令]\x0a\x20\x20\x20\x20\x20\x20\x20\x20用户向你发送了好友申请，理由是：“','<div\x20class=\x22red-packet-card\x20','请点击右上角的“角色选择”按钮，选择至少一个参与豆瓣互动的角色。','rp-details-my-amount','date-separator','\x22><svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M12\x202l3.09\x206.26L22\x209.27l-5\x204.87\x201.18\x206.88L12\x2017.77l-6.18\x203.25L7\x2014.14\x202\x209.27l6.91-1.01L12\x202z\x22></path></svg></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','refined','-\x20**当前时间**:\x20','npcId',')，接收人是“','》\x0a\x20\x20\x20\x20-\x20**','waimai-order-for-ai-btn','code','5.\x20\x20**情景感知**:\x20你的对话【必须】自然地体现出对当前时间\x20(','regenerate-douban-btn','加载预设详情时发生错误:\x20','reading-library-modal','isActive','\x20(回复\x20','<p\x20style=\x22text-align:center;\x20color:#8a8a8a;\x20padding:\x2050px\x200;\x22>还没有可以参与的角色。</p>','.draggable-button-item:not(.dragging)','widgetData','删除分组后，该组内的好友将变为“未分组”。确定要删除吗？','用户取消了激活。','❌\x20动态NAI图片生成失败:','结束投票','openRenderingRulesScreen','清空动态时发生错误:\x20','createDocumentFragment','presetId','isGroupCall','char-photo-item','分类《','\x20\x20\x20\x20-\x20我的毒药：','recipients','Associated\x20Characters\x20(NPC\x20will\x20comment\x20on\x20their\x20moments)','https://i.postimg.cc/Z5nrCyS5/IMG-7006.gif','.poll-option-item','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nai-image-container\x22\x20style=\x22background-image:\x20url(','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22werewolf-player-checkbox\x22\x20data-player-json=\x27','https://i.postimg.cc/HsyqMVyk/IMG-4385.gif','groupNickname','bg-clear','<p>♪\x20暂无歌词\x20♪</p>','dynamic-island-active','表情含义','now','https://api.vkeys.cn/v2/music/netease?word=','https://i.postimg.cc/ZqQBCyLY/IMG-6144.gif','</span><span\x20class=\x22delete-group-btn\x22\x20data-id=\x22','AI生成的图片','call-message-bubble\x20ai-speech','\x20元。','https://i.postimg.cc/KzC2gTq6/IMG-7276.jpg','</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20class=\x22playlist-item-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22playlist-action-btn\x20album-art-btn\x22\x20data-index=\x22','#selective-import-list\x20.clear-posts-item.selected','您输入的激活码不正确。','还没有人','visibleTo','未知设定的角色','\x20转发了\x20@','\x0a**内容:**\x0a','newSize','https://i.postimg.cc/vZt0fFKn/IMB-r-HMBXY.gif','getRandomValues','https://api.minimax.chat/v1/text_to_speech?GroupId=','预言家','voice_message','聊天记录已成功覆盖！正在刷新界面...','input[name=\x22visibility\x22]','\x22\x20class=\x22preview-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','closed','rendering-rules-screen','\x22\x20class=\x22chat-image\x22\x20style=\x22cursor:\x20pointer;\x22\x20data-hidden-text=\x22','[系统提示：用户向你发起了视频通话请求。请根据你的人设，使用\x20\x22video_call_response\x22\x20指令，并设置\x20\x22decision\x22\x20为\x20\x22accept\x22\x20或\x20\x22reject\x22\x20来回应。]','Edit\x20NPC','#\x20前几日完整历史回顾\x20(Full\x20Recap\x20of\x20Previous\x20Days)\x0a','检测到并成功修复了\x20','你拍了拍\x20“','postId','cancel-delete-world-books-btn','is-raw-html','propel-btn','global-bg-preview','\x20\x20\x20\x20-\x20我昨晚空守了。\x0a','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22amount\x22>','所有API与后台设置已保存!','天亮了。','请为这个新头像命名','已切换到角色\x20','\x22\x20data-memory-timestamp=\x22','share_link','getBattery','\x22\x20的本次后台活动跳过。','在这里输入文本...','function','presets','</td><td\x20class=\x22item-qty\x22>','保存外观预设','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22name-line\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>','head','album-back-btn','https://i.postimg.cc/d10GjC4g/IMG-7302.jpg','https://i.postimg.cc/HLKvs0Kv/IMG-7109.gif','\x20→\x20','font-weight:\x20bold;\x20background:\x20rgba(255,\x20193,\x207,\x200.2);','\x22\x20loading=\x22lazy\x22\x20onerror=\x22this.src=\x27https://i.postimg.cc/KYr2qRCK/1.jpg\x27;\x20this.alt=\x27图片加载失败\x27;\x22>','正在分析“','赶紧的充电，要饿死了','我通过了你的好友申请，我们现在是好友啦！','add-existing-contact-btn','product-image-input','要为《','请开始总结。','\x20为\x20','removeChild','reset-theme-btn','开始压缩图片，原始大小:\x20','char-simulated-input','\x0a#\x20世界观\x20(必须严格遵守)\x0a','character-nai-prompts-modal','main-chat-list-header','”下，回复了\x27','ai-action-cooldown-input','originalSize','ai-avatar-input','请输入网络图片的链接','AI\x20\x22','Warning','.battery-level','visibilityState','\x27);\x22','\x0a\x20\x20\x20\x20<div\x20class=\x22playlist-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22title\x22>','my-avatar-group','https://i.postimg.cc/5tbpnDcQ/IMG-6296.gif','ruleId','<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>接收方:</strong>\x20','https://i.postimg.cc/4x9tTy1D/IMG-5563.gif','拼手气红包','nai-test-error','创建新聊天','.rules-category-pane','image/png','char-usage-screen','onplay','\x0a\x0a现在，请开始撰写这组充满真情实感、并熟练运用了Markdown语法的日记。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-management-overlay\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22edit-product-btn\x22>编辑</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-product-btn\x22>删除</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','内容加载失败...','\x20\x20\x20\x20\x20\x20-\x20','banner','preset-entries-container','dead','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22icon-preview\x22\x20src=\x22','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20class=\x22form-button-secondary\x20upload-variation-image-btn\x22\x20style=\x22margin:\x200;\x20padding:\x208px\x2012px;\x22>上传</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22file\x22\x20class=\x22variation-image-input\x22\x20accept=\x22image/*\x22\x20hidden>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','Enable\x20NovelAI\x20Image\x20Generation','notification-sound-player','\x22\x20class=\x22avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>','font-preview','music-play-pause-btn','char-diary-detail-title','\x22\x20\x0a\x20URL:\x20','NPC的昵称和人设都不能为空！','\x22\x20决定去发一条动态...\x20(此处为模拟)','worldBookCategories','export-single-chat-btn','【重要提示】你们已经很久没聊天了！你【必须】将本次行动的重点放在使用\x20\x27text\x27\x20指令给用户发消息，主动开启一个新的、有趣的话题来重新建立联系。绝对不要只是点赞或评论动态，那会显得你很冷漠！','检测到\x20\x27order\x27\x20字段，将按指定顺序导入条目。','未找到\x20postID:\x20','ceil','votes','副密钥','sourceChatName','description','content-type','\x27>转账</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27','char-chat-list','\x20为你切歌:\x20《','force-apply-check-btn','dialogue','用户取消了输入。','totalBalance','onerror','https://i.postimg.cc/Kv51tW5H/IMG-6147.gif','variation-select','12p','#data-clear-char-list\x20.clear-posts-item','rule-editor-modal','\x22\x20触发带理由的好友申请决策流程...','group-avatar-input','AI\x20的下棋指令无效或位置已被占据:','group-avatar-library-title','select-all-cart-items','top','minimax-model-select','cache','Bad\x20control\x20character','https://i.postimg.cc/FzbGNdRT/IMG-4392.gif','Fonts','检测到新的NAI生图指令，正在生成...','notification-sound-url-input','dark-mode','close-npc-group-manager-btn','.select-box','paid','NEGATIVE_INFINITY','my-frame-tab','-\x20(空)','(这张照片没有描述)','\x20发起了一个投票\x20(时间戳:\x20','[系统提示：你刚刚被用户拉黑了。在对方解除拉黑之前，你无法再主动发起对话，也无法回应。]','\x20人投票</span><button\x20class=\x22poll-action-btn\x22>结束投票</button></div>','最近\x2050\x20条','文件不是一个有效的PNG。','sharedHistory','personaPresets','分钟前','\x0a\x0a现在，请生成新的评论。','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22artist\x22>','highlighted','选择记忆所属角色','API未配置，无法进行总结。','\x22\x20转发了动态\x20#','Taobao','https://i.postimg.cc/KYr2qRCK/1.jpg','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20【对话节奏铁律\x20(至关重要！)】\x0a\x20\x20\x20\x20\x20\x20\x20\x20你的回复【必须】模拟真人的打字和思考习惯。**绝对不要一次性发送一大段文字！**\x20你应该将你想说的话，拆分成【多条、简短的】消息气泡来发送，每条消息最好不要超过30个字。这会让对话看起来更自然、更真实。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20核心规则\x0a\x20\x20\x20\x20\x20\x20\x20\x201.\x20\x20**【决策依据】**:\x20你的所有行动都【必须深度结合你的角色设定、核心世界观、以及你们最后的对话摘要】。\x0a\x20\x20\x20\x20\x20\x20\x20\x202.\x20\x20**【内容多样性铁律】**:\x20你的行动【必须】具有逻辑和多样性。你【绝对不能】发布与下方“内容禁忌”列表或“最近的动态列表”中内容相似或主题重复的动态。\x0a\x20\x20\x20\x20\x20\x20\x20\x203.\x20\x20**【行为多样性指南\x20(至关重要)】**:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20你的上一次独立行动是：**','secondaryModel','</div><div\x20class=\x22description\x22>共\x20','，TA的身份是：【','请根据你的设定，写一篇新日记。','sticker-grid','killedId','commenterName','0:00','删除约定','导入外观设置','Status','animation','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22comment-delete-btn\x22\x20data-comment-index=\x22','antidoteUsed','删除世界书','...]','myNickname','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22douban-post-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','{\x0a\x22version\x22:\x203,\x0a\x22timestamp\x22:\x20','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20width=\x2232\x22\x20height=\x2232\x22\x20fill=\x22currentColor\x22><path\x20d=\x22M8\x205v14l11-7z\x22></path></svg>','Category','请在此处粘贴完整的LRC格式歌词...','cancel-import-options-btn','gomoku_move','[表情:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x206px\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#ccc;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2015px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.2s;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','werewolf-game-over-reason','等待回复失败:','字体预设已保存！','search-history-btn','inject-thought-toggle','<img\x20src=\x22','<p\x20style=\x22color:\x20var(--text-secondary);\x20grid-column:\x201\x20/\x20-1;\x20text-align:\x20center;\x22>这个头像库还是空的，点击右上角“添加”吧！</p>','视频通话刚刚结束','translateX(','vinyl-view','\x20发送了一张图片，图片内容描述为：\x27','groupAvatar','请先填写NovelAI\x20API\x20Key！','favorite-memo-btn','pin-modal-cancel-btn','https://i.postimg.cc/wjwbnYkp/IMG-7111.gif','manage-sticker-categories-btn','✅\x20图片显示成功！🎨','在打包或写入文件流时发生错误:\x20','poll-options-container','product-category-tabs','歌曲信息','确定要从头像库中删除“','6066cebSRl','https://i.postimg.cc/RFK3q2t0/IMG-4407.gif','publisher','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','checked','Enable\x20Background\x20Character\x20Activity','conversationIndex',')\x20为\x20','post_deleted_notice','\x0a#\x20长期记忆\x20(你必须严格遵守的事实)\x0a','预设名称不能为空！','角色卡数据无效或缺少\x27name\x27字段。','batch-import-frames-btn','<div\x20class=\x22legacy-comment-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22comment-text\x22>','.ai-generated-image','API\x20Settings','font-size-slider','<div\x20class=\x22avatar-group\x22\x20style=\x22width:\x2045px;\x20height:\x2045px;\x22><img\x20src=\x22','https://i.postimg.cc/tRzPkzRg/IMG-7012.gif','tts-audio-player','”的好友请求','GRID_SIZE','确认清理冗余数据？','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20margin-top:\x2050px;\x22>这里还没有任何长期记忆。</p>','更换图片','ended','</div>\x0a\x20\x20\x20\x20','警告：表\x20\x22','无法重新生成图片:\x20','”这个信息，将其转换为【具体的公历日期】。\x0a4.\x20\x20**【风格要求】**:\x20你的总结应该像一份会议纪要或备忘录，而不是一篇抒情散文。\x0a5.\x20\x20**【长度铁律】**:\x20你的总结【必须】非常简短，总长度【绝对不能超过80个字】。\x0a6.\x20\x20**【输出格式】**:\x20你的回复【必须且只能】是一个JSON对象，格式如下：\x0a\x20\x20\x20\x20`{\x22summary\x22:\x20\x22在这里写下你以第一人称视角，总结好的核心事实与计划。\x22}`\x0a\x0a#\x20你的角色设定\x0a','选中的表情已成功删除。','\x20//\x20<--\x20【核心】注入世界书\x0a\x20\x20\x20\x20\x20\x20\x20\x20现在，请根据【通话前摘要】和下面的【通话实时记录】，继续进行对话。\x0a\x20\x20\x20\x20\x20\x20\x20\x20','frame_tech','检查更新时出错:','EPhone-Full-Backup-Legacy-','has','所有音乐源都未能找到歌曲：“','”的转账。]','show-avatars-btn','manage-stickers-btn','#\x20长期记忆\x20(必须严格遵守)\x0a','AI\x20尝试评论一个不存在的表情:\x20\x22','票):\x20','save-appearance-preset-btn','.voice-message-body[data-text]','receiver','确认替换','commenter','includes','isGroup','.qzone-post-item','linkedWorldBookId','user_photo','rp-direct-greeting','notificationSoundUrl','hidden','屠城局：狼人杀死所有好人即获胜。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>','nai-custom-proxy-group','.contact-picker-item[data-contact-id=\x22','timeupdate','https://image.pollinations.ai/prompt/','waimai-product-info','ai-avatar-upload-input','请至少选择一个要清空的范围。','请所有AI角色开始投票。','npc-background-activity-switch','https://i.postimg.cc/MG6qtLYK/IMG-5565.gif','找不到这个预设的详细信息。','pageX','remove-cphone-bg-btn','当前人数\x20','visibleGroupIds','已选\x20','.recalled-message-placeholder','.qzone-post-container[data-post-id=\x22','我们的群聊','save-font-preset-btn','qzone-sticker-panel','\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20核心规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20你的回复【必须且只能】是以下两种格式之一的JSON数组，绝对不能回复任何其他内容：\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20接受:\x20\x27[{\x22type\x22:\x20\x22video_call_response\x22,\x20\x22decision\x22:\x20\x22accept\x22}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20拒绝:\x20\x27[{\x22type\x22:\x20\x22video_call_response\x22,\x20\x22decision\x22:\x20\x22reject\x22}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20现在，请立即做出决策。','fillRect','元。这不是一个代付请求，而是用户已经为你支付了。请你对此表示感谢。]','chat-search-results-list','\x20条红包记录。','AI\x20尝试发送私信给非用户角色\x20(','</span>:\x20','join-call-btn','delete-api-preset-btn','post-public-text','</div><div\x20class=\x22card-text-secondary\x22>位置分享</div></div><div\x20class=\x22card-map-area\x22\x20','cover','songJson','<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-secondary);\x22>还没有任何分组</p>','你们正在一起听歌，','messages-view','编辑规则','按钮顺序已恢复为默认设置！','\x22,\x20\x22x\x22:\x20(0-14),\x20\x22y\x22:\x20(0-14)}`\x0a-\x20\x20\x20**送礼物**:\x20`{\x22type\x22:\x20\x22gift\x22,\x20\x22itemName\x22:\x20\x22礼物名称\x22,\x20\x22itemPrice\x22:\x20价格(数字),\x20\x22reason\x22:\x20\x22送这个礼物的原因\x22,\x20\x22image_prompt\x22:\x20\x22生成礼物图片的【英文】关键词,\x20风格为\x20realistic\x20product\x20photo,\x20high\x20quality,\x20on\x20a\x20clean\x20white\x20background\x22}`\x0a-\x20\x20\x20**为用户点外卖**:\x20\x20`{\x22type\x22:\x20\x22waimai_order\x22,\x20\x22productInfo\x22:\x20\x22商品名\x22,\x20\x22amount\x22:\x20价格,\x20\x22greeting\x22:\x20\x22你想说的话\x22}\x20`(你主动为用户点外卖时使用)\x0a\x0a现在，请根据以上规则和下面的对话历史，继续进行对话。','Tutorial','save-product-btn','https://api.vkeys.cn/v2/music/tencent?id=','Enable\x20Rule','请输入你想说的内容：','\x20\x20\x20正面:','flex','API失败:\x20','save-sticker-binding-btn','update-notice-dismiss-btn','douban-send-comment-btn','startsWith','karras','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22article-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','\x22\x20alt=\x22','Error','contact-picker-item','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22usage-item-category\x22>','未知成员','\x22]\x20.participant-avatar','无法生成备忘录，请检查API配置或稍后再试。\x0a错误:\x20','#\x20今日完整讨论记录\x20(Today\x27s\x20Full\x20Discussion\x20Record)\x0a','img','https://i.postimg.cc/tTpZ6wLs/IMG-7095.gif','-\x20\x22','background','\x22\x20(大小:\x20','请输入歌曲的URL','确认删除','focus','https://i.postimg.cc/3x0Kx1fz/IMB-K1u-Jp-P.gif','https://i.postimg.cc/DZ541sbt/IMG-7280.jpg','ephoneDeviceId','group-character-nai-prompts-btn','确定要删除这篇日记吗？','Fetch\x20Secondary\x20Models','serviceWorker','querySelector','.char-screen','https://i.postimg.cc/WbmkXzsS/IMG-6138.gif','ai-voice-id-group','filter','<span\x20style=\x22color:\x20#ff8c00;\x22>[好友申请]\x20','Escape','保存主题预设','toDateString','++id,\x20albumId','photo-viewer-image','投票结果：','-\x20(头像库是空的，无法更换头像)','{{user}}','选择一个开场白','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','选择歌词导入方式','douban-detail-author','status_msg','++id,\x20title,\x20lastOpened','<div\x20style=\x22margin-top:10px;\x22><img\x20src=\x22','流式下载库\x20(StreamSaver.js)\x20未加载。请检查网络连接或HTML文件配置。','replace','<span\x20class=\x22commenter-name\x22>','\x0a\x0a3.\x20\x20**主动性**:\x0a\x20\x20\x20\x20-\x20你可以根据对话发展，使用指令来更新自己的状态、更换头像、记录回忆、发起约定或执行其他社交行为。\x0a\x20\x20\x20\x20-\x20【关系破裂时】才可使用\x20`block_user`\x20指令。\x0a4.\x20\x20**内心独白\x20(必须执行)**:\x20在所有其他指令之后，JSON数组的【最后】必须包含一个\x20\x22update_thoughts\x22\x20指令，用于更新角色的“心声”和“散记”。\x0a\x20\x20\x20\x20-\x20**心声\x20(heartfelt_voice)**:\x20一句话概括角色此刻最核心、最私密的想法。\x0a\x20\x20\x20\x20-\x20**散记\x20(random_jottings)**:\x20一段50字以上的、符合人设的思考或心情记录，禁止OOC。\x0a请根据当前情景和你的情绪，从列表中【选择一个最合适的】表情含义来使用\x20\x22sticker\x22\x20指令。尽量让你的表情丰富多样，避免重复。\x0a#\x20长期记忆\x20(必须严格遵守)\x0a','date-search-input','replyTo','data-lang-key-placeholder','API配置','myAvatarFrame','正则表达式\x20(使用g作为标志)','rule-chat-id-select','summary','translateY(-20px)','回复\x20','preset-persona-input','custom-frame-upload-input','confirm-hunter-shot-btn','<option\x20value=\x22global\x22>公用\x20(所有角色)</option>','API错误响应:',')，并在对话中自然地体现出来。','Bearer\x20','regex','resume','close-product-category-manager-btn','EPhoneWorldBookBackup','.world-book-tab','\x22\x20中发现并修复了旧红包数据。','#chat-messages','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22album-count\x22>','平票或无人投票，此轮无人出局。','is-realimag','\x0a#\x20可用表情包\x20(必须严格遵守！)\x0a-\x20当你需要发送表情时，你【必须】从下面的列表中【精确地选择一个】含义（meaning）。\x0a-\x20【绝对禁止】使用任何不在列表中的表情含义！\x0a','userAgent','\x22\x20data-poll-timestamp=\x22','”，并根据其人设、记忆和最近的互动，构思出【8到10张】TA最近可能会拍摄或珍藏在手机相册里的照片。\x0a\x0a#\x20核心规则\x0a1.\x20\x20**创造性与合理性**:\x20照片内容必须完全符合角色的性格、爱好、职业和生活环境。\x0a2.\x20\x20**多样性**:\x20照片主题要丰富，可以包括自拍、风景、食物、宠物、朋友合影、工作场景等。\x0a3.\x20\x20**格式铁律\x20(最高优先级)**:\x20\x0a\x20\x20\x20\x20-\x20你的回复【必须且只能】是一个JSON数组格式的字符串。\x0a\x20\x20\x20\x20-\x20你的回复必须以\x20`[`\x20开始，并以\x20`]`\x20结束。\x0a\x20\x20\x20\x20-\x20【绝对禁止】在JSON数组前后添加任何多余的文字、解释、或\x20markdown\x20标记\x20(如\x20```json)。\x0a\x20\x20\x20\x20-\x20数组中的每个元素都是一个对象，代表一张照片，格式【必须】如下:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20[\x0a\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22description\x22:\x20\x22这是照片背后的故事或角色的心情日记，必须使用第一人称“我”来写。\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22image_prompt\x22:\x20\x22一段用于生成这张照片的、详细的【英文】关键词。\x22\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20]\x0a\x20\x20\x20\x20```\x0a\x20\x20\x20\x20-\x20**【image_prompt\x20绝对禁止】**:\x20绝对禁止包含任何中文字符、句子、特殊符号、或任何可能涉及敏感（NSFW）、暴力、血腥、政治的内容！也禁止真人！\x0a\x20\x20\x20\x20-\x20**【image_prompt\x20必须是】**:\x20必须是纯英文的、用逗号分隔的【关键词组合】\x20(e.g.,\x20\x221boy,\x20solo,\x20basketball\x20jersey,\x20in\x20locker\x20room,\x20smiling,\x20selfie\x22)。\x0a\x20\x20\x20\x20-\x20**【画风指令】**:\x20在\x20prompt\x20的末尾，总是加上画风指令，例如：\x20`best\x20quality,\x20masterpiece,\x20anime\x20style,\x20cinematic\x20lighting`\x0a\x0a#\x20供你参考的上下文\x0a-\x20**你的角色设定**:\x20','\x0a\x20\x20\x20\x20-\x20**音乐**:\x20','clientHeight','transfer-modal','精炼“','injectLatestThought','sticker-action-bar','update','is-gift','传统导出\x20(兼容旧版或内存小的浏览器)','\x20死亡了。','resolution','文件格式无法识别。请确保您选择的是有效的\x20EPhone\x20备份文件。','检测到好友申请待处理状态，为角色\x20\x22','publicText','网络图片\x20(CPhone)','innerHTML','-\x20\x20\x20**对话状态**:\x20','表情包分类绑定已更新！','#\x20昨晚事件总结\x20(Night\x20Event\x20Summary)\x0a','点击处理','preset-content-container','的状态已更新为:\x20','vote','.delete-memory-btn','load-more-btn','[语音消息:\x20','unreadCount','findIndex','linkedMemoryChatIds','导出成功','transfer-confirm-btn','当前为渐变色','manual','variation-selection-modal','\x20的所有动态，且无法恢复！','API\x20请求失败，状态码:\x20','无法生成记录，请检查API配置或稍后再试。\x0a错误:\x20','收到了格式不规范的AI指令（缺少type和content），已跳过:','translateX(-','“全部”分类无法被绑定。','[表情，含义:\x20','<span\x20style=\x22color:\x20#dc3545;\x22>[你已被对方拉黑]</span>','data-lang-key','\x27>转账</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27','\x20\x0a#\x20社交圈与动态\x0a','chat-expand-btn','caller-avatar','等待回应','aiPersona','rp-details-item','cloneNode','nai-resolution','模型列表已更新','chatRenderWindow','tlyric','.favorite-item-card.selected','sticker-search-input','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nai-image-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','已成功从文件导入预设《','werewolf-log','copy-message-btn','\x20分享了Ta的位置：\x27','char-music-progress-fill','delete-product-btn','”分享TA的私人歌单...','字体设置','poisonUsed','https://i.postimg.cc/R0WYmcYM/IMG-4431.gif','simulatedTaobaoHistory','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>这里还没有任何使用记录，<br>点击右上角刷新按钮生成一些吧！</p>','.checkbox','chat-name-input','countdownEndTime','162xAIbpf','#data-clear-char-list\x20.clear-posts-item.selected','char-wallet-content','确定要恢复默认设置吗？','✅\x20[NAI下载]\x20开始下载图片:','请先在API设置中配置好（主或副）API以进行总结。','Font\x20Preset\x20Management','https://i.postimg.cc/kXfcgFRN/IMG-7106.gif','add-countdown-btn','\x20的动态\x20(用户)','手动注入记忆时出错:\x20','\x20请根据这个结果发表你的评论。]','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-name\x22>','mouseout','输入消息...','\x22\x20已经存在了！','novelai-model','commentText','lastIndexOf','button-order-editor','<span\x20class=\x22lucky-king-tag\x22>手气王</span>','\x20\x20\x20\x20-\x20我们昨晚攻击了：','\x20张图片...','post-image-desc-group','\x0a#\x20你的任务\x0a你现在是狼人团队的指挥官。你的任务是分析当前局势，并为狼人团队选择一个最佳的刀人目标。\x0a#\x20核心规则\x0a1.\x20\x20**目标**:\x20优先刀掉预言家、女巫等神职人员。如果没有明确的神职信息，可以根据发言来判断谁的逻辑清晰、威胁最大。\x0a2.\x20\x20**格式铁律**:\x20你的回复【必须且只能】是一个JSON对象，格式如下:\x0a\x20\x20\x20\x20`{\x22target_name\x22:\x20\x22你决定要刀的玩家名字\x22}`\x0a\x0a#\x20游戏状态\x0a-\x20**你的狼队友是**:\x20','.frame-item:has(.delete-btn)','group-background-activity-switch','success','audio/mpeg','manage-products-btn','共享位置','currentPlaylist','游戏即将开始，正在为各位玩家分配身份...','\x20首歌曲的详细信息...','[系统提示：你接受了“','subtle','生成中...','✅\x20找到\x20final\x20事件的图片数据','werewolf-','删除NPC','werewolf-role-name','⚠️\x20NAI提示词：没有角色，使用系统配置','songName','正在全网搜索歌曲资源...','AI\x20(CPhone)\x20尝试使用一个不存在的表情:\x20\x22','<div\x20class=\x22cart-item-variation\x22\x20style=\x22font-size:\x2012px;\x20color:\x20#8a8a8a;\x20margin-top:\x204px;\x22>款式:\x20','search-result-item','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22comment-text\x22>','qzone-post-delete-action','originalType','close-sticker-category-manager-btn','spectator','未知会话','nai-diffusion-4-5-full','send_and_recall','call-timer',':</span>\x20','<div\x20class=\x22poll-footer\x22><span\x20class=\x22poll-total-votes\x22>共\x20','character-phone-screen','某个时间','char-music-play-pause-btn','backgroundImage','\x22\x20placeholder=\x22例如:\x20key1,\x20key2,\x20key3\x22\x20style=\x22padding:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22\x20style=\x22margin-bottom:\x200;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22font-size:\x200.8em;\x22>内容</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20class=\x22entry-content-textarea\x22\x20rows=\x225\x22\x20style=\x22width:\x20100%;\x20font-size:\x2014px;\x22>','open_red_packet','</persona>\x0a</character>\x0a','检测到\x20Tavern/SillyTavern\x20预设格式，将严格按照\x20prompt_order\x20排序。','讨论无法开始，游戏暂停。请点击右上角的“重试”按钮继续。\x0a错误:\x20','character-profile-modal','https://i.postimg.cc/C5XnfpNB/IMG-5579.gif','94348etoigO','AI返回了空内容或未知格式。','压缩失败','正在模拟“','showScreen','你领取了\x20','<span\x20class=\x22offline-description\x22>','actionCooldownMinutes','一个神秘的角色。','Listen\x20Together','douban-cast-list','.douban-cast-checkbox','\x22\x20placeholder=\x22例如：角色核心设定\x22\x20style=\x22padding:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22\x20style=\x22margin-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22font-size:\x200.8em;\x22>关键词\x20(用英文逗号,分隔)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22entry-keys-input\x22\x20value=\x22','read-together-btn','”说的申请理由：','暂无内容...','delete-selected-stickers-btn','Album\x20Name','\x27>表情</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27','\x20(图片描述:\x20“','cancel-message-action-btn','-\x20**对话状态**:\x20(暂无有效对话历史)','novelai-settings-btn','senderName','music-next-btn','rp-tab-group','基础数据不完整，无法开始总结。','role','精炼成功','Favorites','#4CAF50','.unread-indicator.back-btn-indicator','bubble_theme','persona-library-grid','Diary','https://i.postimg.cc/fyyGgW61/IMG-7115.gif','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-title\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20bottom:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20right:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20background:\x20','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','请输入CPhone的背景图片URL','.variation-block','authorChatId','visible','stickerCategoryId','matches','\x22>背景</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22playlist-action-btn\x20delete-track-btn\x22\x20data-index=\x22','npc-list','latestTimestamp','--\x20点击选择\x20--','https://i.postimg.cc/KvVsjjgG/3c3aa5219s18b90187ef1f54b3db7ba8.gif','此操作会将选定的\x20','music-lyrics-list','”。请你【结合自己的角色设定、世界观和你们的最近聊天内容】，对这条动态发表一条自然的评论。]','backgroundActivityInterval','#52c41a','已打包表:\x20','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20width=\x2232\x22\x20height=\x2232\x22\x20fill=\x22currentColor\x22><path\x20d=\x22M6\x2019h4V5H6v14zm8-14v14h4V5h-4z\x22></path></svg>','提示词配置','https://i.postimg.cc/3N5Vndn3/IMG-4426.gif','最终正面提示词:','】，本名是【','publish-to-announcement-btn','最后确认！','\x20<small\x20style=\x22color:#888;\x22>(角色)</small></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','Their\x20Browser\x20History','.entry-content-textarea','setAttribute','friend','transfer-btn','标准JSON数组解析失败，将尝试强力提取...','locked-feature','memory-list-container','通话于\x20','hunter','openCharApp','secondary-model-select','remove-global-bg-btn','删除成功','pat-btn','”。\x0a\x20\x20\x20\x20-\x20\x20\x20你【绝对不能】生成\x20authorName\x20或\x20commenter\x20字段为\x20“','\x0a-\x20**你最近和“','close-character-nai-prompts','\x20个表情包，且无法恢复！','...，所以我决定这样说...)\x0a\x0a####\x20阶段\x20C：最终发言稿\x20(草稿)\x0a(结合T,\x20G,\x20S的思考，我准备这样说：...)\x0a---\x0a','在导演模式下\x20stringify\x20失败:','--container-width','collapsed','getElementsByTagName','99+','#product-grid\x20.product-item','categories','”的头像库','确定要删除头像框\x20“','htmlFor','Amap','，人设:\x20','chat-settings-screen','Asia/Shanghai','add-chat-btn','<div\x20class=\x22pinned-indicator\x22>📌</div>','\x0a[图片生成失败:\x20','\x0a\x0a#\x20【【【角色策略指南\x20(至关重要！)】】】\x0a你【不是】一个单纯的游戏玩家，你是一个【有感情、有记忆、有社交关系】的角色。你在游戏中的所有发言和行为，都【必须】首先符合你的人设以及你与其他玩家的既有关系。\x0a-\x20**朋友**:\x20如果你和某个玩家是朋友，你应该在发言时倾向于保护TA，为TA的发言寻找合理解释，除非有确凿的证据。\x0a-\x20**敌人/情敌**:\x20如果你和某个玩家有矛盾，你可以借机在游戏中攻击TA，质疑TA的发言，甚至在你是狼人时优先刀掉TA。\x0a-\x20**恋人/暗恋对象**:\x20你会无条件地信任TA，保护TA，甚至愿意为TA牺牲。\x0a你的社交关系比游戏本身的胜负更重要！\x0a你的发言【必须】体现出高水平的、类似真人的策略博弈，而不是简单地陈述事实。\x0a\x0a###\x20**神职角色\x20(预言家,\x20女巫,\x20猎人,\x20守卫)\x20策略**\x0a1.\x20\x20**【隐藏优先！】**:\x20你的首要任务是活下去。**绝对不要**在第一天就轻易暴露自己的神职身份！这会让你立刻成为狼人的目标。\x0a2.\x20\x20**【暗示而非明示】**:\x20你应该用更委婉、更聪明的语言来传递信息，而不是直接说“我是预言家，我查了A”。\x0a\x20\x20\x20\x20*\x20**预言家可以说**:\x20“我对X玩家的身份有一些看法，我觉得他发言很阳光。”\x20或\x20“Y玩家的发言让我感到很不舒服，我把他列为重点怀疑对象。”\x0a\x20\x20\x20\x20*\x20**女巫可以说**:\x20“昨晚的信息很有趣，场上局势可能和大家想的不一样。”\x0a3.\x20\x20**【何时起跳？】**:\x20只有在以下【危急情况】下，你才应该考虑暴露自己的身份（俗称“起跳”）：\x0a\x20\x20\x20\x20*\x20**被投票时**:\x20当你即将被投票放逐时，必须起跳自证身份来求生。\x0a\x20\x20\x20\x20*\x20**关键信息**:\x20当你掌握了可以决定胜负的信息时（例如预言家查到了最后一个狼人）。\x0a\x20\x20\x20\x20*\x20**有人悍跳**:\x20当有狼人假扮你的身份时，你必须站出来与他对峙，争夺好人的信任。\x0a\x0a###\x20**狼人角色策略**\x0a1.\x20\x20**【积极伪装】**:\x20你需要扮演一个好人，最好是伪装成某个神职（俗称“悍跳”），来扰乱好人的判断，骗取他们的信任。\x0a2.\x20\x20**【制造混乱】**:\x20你的发言应该引导好人去怀疑其他无辜的好人。可以故意曲解别人的发言，或者制造逻辑陷阱。\x0a3.\x20\x20**【团队合作】**:\x20如果你的狼队友被怀疑，你应该想办法为他辩护，或者通过攻击其他玩家来转移焦点。\x0a\x0a###\x20**平民角色策略**\x0a1.\x20\x20**【逻辑为王】**:\x20你是场上的“法官”。你的核心任务是仔细倾听每个人的发言，找出其中的逻辑漏洞和矛盾之处。\x0a2.\x20\x20**【积极分析】**:\x20不要只是说“我不知道，我过了”。你应该大胆说出你的怀疑，并解释你的理由。例如：“A玩家说B是狼人，但是他的理由很牵强，所以我更怀疑A。”\x0a3.\x20\x20**【跟票与站边】**:\x20在你相信某位神职玩家后，你应该坚定地支持他，并号召其他好人一起投票给神职指认的狼人。\x0a\x0a#\x20其他核心指令\x20(必须遵守)\x0a1.\x20\x20**互动铁律**:\x20角色之间【必须】互相质疑、支持、分析【本轮已有发言】。你【绝对不能】无视\x20','.frame-grid','确定要退出当前这局狼人杀吗？游戏进度将不会被保存。','NAI\x20Prompt\x20未改变，将保留原始图片。','\x20的红包','ZIP\x20流生成完毕。','已经一起听了','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','✅\x20NAI图片生成成功！','\x22,\x20\x22type\x22:\x20\x22sticker\x22,\x20\x22meaning\x22:\x20\x22表情的含义(必须从可用表情列表选择)\x22}\x0a]\x0a}\x0a```\x0a\x0a###\x20格式\x20B：群聊\x0a```json\x0a{\x0a\x20\x20\x22type\x22:\x20\x22group\x22,\x0a\x20\x20\x22groupName\x22:\x20\x22一个虚构的群名\x22,\x0a\x20\x20\x22participants\x22:\x20[\x0a\x20\x20\x20\x20{\x22name\x22:\x20\x22NPC成员1\x22,\x20\x22avatar_prompt\x22:\x20\x22(仅当NPC是新创造时提供)\x20成员1头像【英文】关键词\x22},\x0a\x20\x20\x20\x20{\x22name\x22:\x20\x22NPC成员2\x22,\x20\x22avatar_prompt\x22:\x20\x22(仅当NPC是新创造时提供)\x20成员2头像【英文】关键词\x22}\x0a\x20\x20],\x0a\x22messages\x22:\x20[\x0a\x20\x20{\x22sender\x22:\x20\x22','reload','-\x20\x20\x20**NovelAI真实图片分享\x20(在聊天中直接发送)**:\x20`{\x22type\x22:\x20\x22naiimag\x22,\x20\x22prompt\x22:\x20\x22详细的英文描述词...\x22}`\x20\x0a\x20\x20\x20\x20-\x20**【绝不能暴露是novelai生成的图片！】\x0a\x20\x20\x20\x20-\x20**【重要】关于prompt的撰写**：\x0a\x20\x20\x20\x20\x20\x20*\x20禁止暴露这是novelai生成的图片！\x0a\x20\x20\x20\x20\x20\x20*\x20你可以根据当前对话上下文、你的角色人设、或你想表达的情感和氛围，来撰写可能详细而具体的prompt。\x0a\x20\x20\x20\x20\x20\x20*\x20例如：不要只写\x20\x22a\x20girl\x22，而是可以写\x20\x22a\x20cheerful\x20anime\x20girl\x20with\x20sparkling\x20emerald\x20eyes,\x20sitting\x20by\x20a\x20window\x20on\x20a\x20rainy\x20afternoon,\x20holding\x20a\x20warm\x20cup\x20of\x20tea,\x20soft\x20lighting,\x20cozy\x20atmosphere,\x20melancholic\x20yet\x20peaceful\x20mood\x22但需要注意，绝对不可以抄袭模仿这段prompt！你必须有自己的创意和想法！\x0a\x20\x20\x20\x20\x20\x20*\x20prompt的详细程度由你根据具体情况自己决定：如果场景简单或只是随意分享，可以简短一些；如果是重要时刻或想表达特定情感，可以尽可能详细描述。这不是强制的，完全取决于你当时的需求。\x0a\x20\x20\x20\x20\x20\x20*\x20专注于描述内容本身即可。\x0a\x20\x20\x20\x20-\x20使用场景：当你想要在【私聊对话中】直接给用户发送一张图片时使用。\x0a\x20\x20\x20\x20-\x20不要频繁使用，只在真正想分享图片的时候使用。\x0a\x20\x20\x20\x20-\x20注意：这会直接在聊天记录中显示图片，而不是发布到动态。','”</i></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22accept-friend-btn\x22\x20class=\x22lock-action-btn\x22>接受</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22reject-friend-btn\x22\x20class=\x22lock-action-btn\x20secondary\x22>拒绝</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20首歌曲...','狼人杀AI回应生成失败:','150','.chat-group-content','已成功从\x20Tavern\x20AI\x20文件导入设定集《','Bilibili','arrayBuffer','NPC\x20Persona','外观设置已成功导入并应用！','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','music-player-artist','\x22>--天--时--分--秒</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22target-date\x22>目标时间:\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-content-preview\x22>','AI返回的JSON格式不正确，缺少\x20\x27summaries\x27\x20字段。','https://i.postimg.cc/QMDsSNxg/IMG-6861.gif','album-photos-back-btn','#chat-interface-screen\x20>\x20.header','https://i.postimg.cc/CLrZQMMD/IMG-4398.gif','isRefund','stopPropagation','加载中...','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22loading-spinner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22voice-duration\x22>','\x20张<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20跳过(已压缩或无需压缩)\x20','custom-prompt-input','</p>\x0a\x20\x20\x20\x20','utf-16le','assign','favorite','NPC人设','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-block-btn\x22\x20title=\x22删除此条\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<textarea>','\x0a\x0a#\x20你的聊天对象（用户）的人设\x0a','\x0a#\x20你的任务\x0a你是一个狼人杀游戏模拟器\x20(Game\x20Simulator)。你的任务是【并行模拟】','nai-smea-dyn','group-management-modal','spectator-propel-btn','werewolf-player-selection-list','这是一个通过手动创建的角色。','Preset\x20Name','character_persona','”的长期记忆少于2条，无需进行精炼。','\x0a\x0a#\x20最近的动态列表\x20(供你参考和评论):\x0a','theme-toggle-switch',');\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22sticker-name\x22>','mousedown','公告已发布！','导演剪辑室：正在撤销\x20','isDanger','\x20转账\x20','对方正在输入...','导演模式','https://i.postimg.cc/2jxd0FGp/IMG-7100.gif','\x22,\x20\x22content\x22:\x20\x22对话内容1\x22},\x0a\x20\x20{\x22sender\x22:\x20\x22NPC的名字\x22,\x20\x22content\x22:\x20\x22对话内容2\x22},\x0a\x20\x20{\x22sender\x22:\x20\x22','close-rp-details-btn','[图片生成失败:\x20','custom-modal-cancel','此操作将扫描数据库，移除所有与已删除角色相关的孤立数据（如动态、评论、记忆等）。<br><br><strong>此操作不可撤销，但通常是安全的。NPC数据不会被删除。</strong><br><br>建议在操作前先导出数据备份。','请输入书名','<p>','.qzone-post-container','https://i.postimg.cc/cLPP10Vm/4.jpg','**\x20(本名:\x20','(回复\x20','使用解药救TA','静音音频已启动，用于后台活动保活。','https://i.postimg.cc/P5zLh5JJ/IMG-6942.gif','保存\x20API\x20预设','ZIP解压失败:','member-editor','Storage\x20Optimization','loadedmetadata','reading-restore-btn','participants','请输入世界书的名称...','你们没有在听歌。','\x22\x20尝试领取不属于自己的专属红包\x20(接收人:\x20','大小:','<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>金额:</strong>\x20¥','\x22\x20style=\x22display:block;\x22>×</button>','download','[系统提示：用户拒绝了通话邀请，但你们可以自己开始。请你们各自决策是否加入。]','12047nFovSr','prompt','modify','anno_','”的当前状态已更新为：','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22fav-card-header\x22>','streamed','\x22>×</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',']类型的消息','”\x20将对你的称呼修改为\x20“','char_browser_article','Content-Type:','”刚刚对最后一条评论点击了“等待回复”，TA希望看到更多角色参与讨论。\x0a你的任务是：根据所有角色的设定，选择【10到20位】最适合参与讨论的角色，让他们针对已有评论，发表【全新的、符合人设的】回应。\x0a\x0a#\x20核心规则\x0a1.\x20\x20**【时间感知】**:\x0a\x20\x20\x20\x20-\x20\x20\x20你【必须】意识到当前是\x20**','内容为空。','.poll-card','#vinyl-view\x20#music-player-cover','\x20已为','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22participants-info\x22>\x20<!--\x20新增一个容器方便布局\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22participants-avatars\x22>','rp-group-amount','合并成功','reset-sound-btn','确定要删除这条记录吗？',',\x20flat\x20design,\x20simple','正在手动触发好友申请流程，请稍后...\x0a如果API调用成功，将弹出提示。如果失败，也会有错误提示。如果长时间无反应，说明AI可能决定暂时不申请。','正在扫描和修复数据...','<div\x20class=\x22post-images-grid\x20grid-','\x22\x20在库中未找到。','cancel-create-countdown-btn','value','.rules-category-pane[data-category-id=\x22','group-members-group','<span\x20style=\x22color:\x20green;\x22>已满足，等待下次系统心跳</span>','\x0a\x0a#\x20群成员列表、人设及社交背景\x20(至关重要！)\x0a你【必须】根据每个角色的社交背景来决定他们的互动方式。\x0a','AI\x20尝试使用一个不存在的群头像:\x20\x22','文件应用失败:\x20','请输入新的心声内容...','操作已取消','尝试打开一个不存在的世界书，ID:','无法访问剪贴板。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22share-target-checkbox\x22\x20data-chat-id=\x22','生成失败','getVotes','#nai-gallery-grid\x20.nai-gallery-item','flex-start','申请成功！','callRequester','hiddenContent','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22comment-text\x22>','scrollHeight','获取更新通知文件失败。','请输入想跳转的页码\x20(1\x20-\x20','”的投票(时间戳:\x20','linesPerPage','textarea','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x20margin-top:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-price\x22>','】。\x0a\x20\x20\x20\x20-\x20\x20\x20在对话中，你可以根据人设和关系，自由使用角色的【群昵称】或【本名】进行称呼。\x0a\x20\x20\x20\x20-\x20\x20\x20严禁生成\x20\x27name\x27\x20字段为\x20\x22','[图片动态]','charCodeAt','空间设置','请输入文字图描述！','detach-mode-active','<div\x20class=\x22post-content\x22\x20style=\x22margin-bottom:\x2010px;\x22>','）完成了支付。此订单已关闭，其他成员不能再支付。]','https://i.postimg.cc/Fz3HwLk9/IMG-5569.gif','https://i.postimg.cc/yx2m4nbs/IMG-7231.gif','share-location-btn','-\x20(记录于\x20','已成功收藏到“我的收藏”页面！','请输入有效的URL。','Enter\x20the\x20name\x20of\x20the\x20world\x20book...','.format-btn','昨晚的死讯','该条记录已成功删除。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','删除照片','post-image-description','comments','mes_example','close-ai-avatar-library-btn','isLocal','\x27>文字图</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','未知用户','.comment-sticker-btn','豆瓣小组','nai-result-image','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22lock-text\x22>“','tableName','++id,\x20name,\x20type','index','option','\x20条)','无效链接:\x20','choices','qzone','single','\x20(角色)</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','note','https://i.postimg.cc/gc3QYCDy/1-NINE7-Five.jpg','”的聊天记录和设置。此操作不可撤销！<br><br><strong>确定要继续吗？</strong>','\x0a\x0a现在，请以“','\x0a\x0a现在，请开始生成这组【纯文本】的浏览记录。','douban-detail-avatar','https://i.postimg.cc/1Rwn3XVP/IMG-6146.gif','正在合并单条记录到\x20','棋盘状态\x20(1是你(黑棋),\x202是AI(白棋)):\x0a','renderChatListProxy','\x0a\x0a现在，请生成这份歌单。',';\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22flex-grow:\x201;\x20text-align:\x20left;\x20text-decoration:\x20','Presets','preset-category-select','**:\x20关于\x20**','https://i.postimg.cc/hPnrSHjy/IMG-4434.gif','当你死亡时，你可以选择带走场上任意一名玩家。','#e9ecef','API未配置，无法生成内容。','add-new-npc-group-btn','100%','...”','(AI返回了空内容)','font-size:\x2016px;\x20color:\x20#555;\x20margin-bottom:\x2010px;','}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20你可以让多个角色同时尝试，只需在返回的JSON数组中包含多个这样的对象即可。\x0a\x20\x20\x20\x20\x20\x20\x20\x20现在，请立即执行抢红包操作！\x0a\x20\x20\x20\x20\x20\x20\x20\x20','call-message-bubble\x20','确定要清空当前角色的NAI提示词配置吗？','，礼物是：','）互动了，现在你有机会【主动】做点什么，来表现你的个性和独立生活。这是一个秘密的、后台的独立行动。\x0a\x0a\x0a\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20【最高优先级指令：情感维系】\x0a\x20\x20\x20\x20\x20\x20\x20\x20**你与用户的关系是最重要的！**\x20相比于在动态区闲逛，你应该【优先考虑】是否需要主动给用户发消息来维系你们的感情。\x0a','realimag-image','https://i.postimg.cc/T1tjhsyB/IMG-4720.gif','无缓存，正在请求\x20Minimax\x20TTS\x20API...','[情景提示]\x20','https://i.postimg.cc/kGsZwbq0/IMG-6886.gif','\x0a\x0a现在，请做出你的决定。','MB)，正在归档...','检测到\x20SSE\x20流式响应，开始解析...','call_summary','offset','ServiceWorker\x20注册成功，作用域为:\x20','text_image','https://i.postimg.cc/7YRbzN51/mmexport1751036276038.gif','已成功将\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22douban-cast-checkbox\x22\x20data-chat-id=\x22','API\x20设置','激活失败','contact-picker-list','select-all-world-books-for-clear','\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20指令格式\x0a\x20\x20\x20\x20\x20\x20\x20\x20你的回复【必须】是一个JSON对象，格式如下：\x0a\x20\x20\x20\x20\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22decision\x22:\x20\x22apply\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22reason\x22:\x20\x22在这里写下你想对用户说的、真诚的、有针对性的申请理由。\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20```\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x22\x20触发了后台行动！','chat-list-title','API格式不正确，角色\x20\x22','https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg','[表情]\x20含义:\x20\x22','💡\x20[NAI下载]\x20提示：三击任意NAI图片即可下载','paste','<span\x20style=\x22color:\x20red;\x22>已关闭</span>','<div\x20class=\x22gift-preview-item\x22><img\x20src=\x22','levelchange','https://i.postimg.cc/DzDy2vS7/IMG-7017.gif','character_book','.avatar-group','pending_ai_approval','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','Reply\x20to','确认导入','.participant-avatar[data-participant-id=\x22','https://i.postimg.cc/6pLTBvDG/IMG-5721.gif','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20供你决策的参考信息：\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**你的角色设定**:\x20','选择一部手机','[照片]','[你发送了一条语音消息，内容是：\x27','frame_10','werewolf-game-over-close-btn','\x22,\x20\x22postId\x22:\x20123,\x20\x22commentText\x22:\x20\x22评论内容\x22}]`\x0a\x20\x20\x20\x20-\x20\x20\x20表情:\x20`[{\x22type\x22:\x20\x22qzone_comment\x22,\x20\x22name\x22:\x20\x22','检测到\x20世界书文件，需要激活码...','add-ai-response-block-btn','\x20\x20\x20负面:','enableMinimalChatUI','#\x20长期记忆\x20(最高优先级，这是你和用户之间已经确立的事实，必须严格遵守)\x0a','transfer-amount','\x20邀请你加入群视频','无法找到分享记录:','通话结束，时长\x20','1px\x20solid\x20#e0e0e0','分享新鲜事...','manual-summarize-btn','[文字图]\x20','frame_ribbon','请根据你的设定，生成你的备忘录内容。','calls','poisonedId','direct','add-song-search-btn','tagName','announcement-action-pin','生成成功！','”的TTS功能已关闭，已禁止发起TTS请求。','篇】他们最近可能会在各种豆瓣小组中发布的帖子和评论。\x0a\x0a#\x20核心规则\x0a1.\x20\x20**【时间感知】**:\x0a\x20\x20\x20\x20-\x20\x20\x20你【必须】意识到当前是\x20**','生成设置','save-frame-settings-btn','我是谁呀。','请为这个新头像框起个名字','守卫已行动，守卫请闭眼。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20absolute;\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2011px;\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x202px\x206px;\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20rgba(0,\x200,\x200,\x200.1);\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20var(--text-secondary);\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20white-space:\x20nowrap;\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.3s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','分类\x20\x22','删除记录','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-content\x22>','outgoing-call-screen','copy-diary-content-btn','未发现需要迁移的旧红包数据。','x-social-screen','playMode','commenterOriginalName','clear-specific-data-btn','\x20(大小:\x20',')，开始总结...','1436365JEydxk','<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-secondary);\x22>还没有任何分类</p>','pop','GBK\x20解码成功。','photo-item','请输入要添加的记忆要点：','input[name=\x22visibility_group\x22]:checked','Secondary\x20API\x20Settings\x20(for\x20Summarization)','numeric','apply','\x0a\x0a现在，请严格遵守所有规则，选择并执行你的行动。','请输入有效的金额！','join','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22title\x22>','确定要永久删除选中的\x20','save-preset-btn','change','variation-product-name','对方拒绝了你的视频通话请求。','<strong>$1</strong>','<span\x20class=\x22diary-messy\x22>$1</span>','正在执行...','smea','rp-tab-direct','网易云','enable-tts-switch','\x20\x0a-\x20**你们最后的对话**:\x0a','内容条目','chat-list-item','lastActionType','”，并根据其人设、记忆和最近的互动，虚构出【12到20条】TA最近可能会写在手机备忘录里的内容。\x0a\x0a#\x20核心规则\x0a1.\x20\x20**创造性与合理性**:\x20备忘录内容必须完全符合角色的性格、爱好、职业和生活环境。可以是购物清单、待办事项、灵感片段、一些随笔和感悟、草稿等。\x0a2.\x20\x20**格式铁律\x20(最高优先级)**:\x20\x0a\x20\x20\x20\x20-\x20你的回复【必须且只能】是一个JSON数组格式的字符串。\x0a\x20\x20\x20\x20-\x20你的回复必须以\x20`[`\x20开始，并以\x20`]`\x20结束。\x0a\x20\x20\x20\x20-\x20【绝对禁止】在JSON数组前后添加任何多余的文字、解释、或\x20markdown\x20标记\x20(如\x20```json)。\x0a\x20\x20\x20\x20-\x20数组中的每个元素都是一个对象，代表一条备忘录，格式【必须】如下:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20[\x0a\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22title\x22:\x20\x22备忘录的标题，例如：购物清单\x20或\x20周末计划\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22备忘录的详细内容，必须支持换行符\x5cn。\x22\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20]\x0a\x20\x20\x20\x20```\x0a\x0a#\x20供你参考的上下文\x0a-\x20**你的角色设定**:\x20','frame_flower','export-world-book-btn','height','导入成功','reverse','enqueue','正在接收流式数据...','sampler','source_name','请输入有效的总金额！','解析AI返回的JSON时出错:\x20','group-avatar-library-grid','）刚刚拍了拍你（','”\x20已被删除。','cphone-icon-img-','\x20\x20\x20characterNegativePrompt:','\x0a\x20\x20\x20\x20-\x20**读书**:\x20','”\x20的评论。你的任务是扮演【除了用户以外】的所有角色。\x0a3.\x20\x20**【互动】**:\x20新生成的评论【必须】是针对【已有评论】的延续或回应，让讨论能继续下去。\x0a4.\x20\x20**【头像一致性\x20(最高优先级！)】**:\x20你【必须】参考下面的“已有路人NPC头像指令”列表。如果一个已有的NPC再次发言，【必须】复用它旧的头像指令。只有在创造一个【全新的、从未出现过的】NPC时，才为其生成新的头像指令。\x0a5.\x20\x20**【格式】**:\x20你的回复【必须且只能】是一个JSON数组，数组中的每个元素都代表一条新评论，格式【必须】如下:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20[\x0a\x20\x20\x20\x20\x20\x20{\x20\x22commenter\x22:\x20\x22角色A的名字\x22,\x20\x22text\x22:\x20\x22角色A的新评论内容。\x22,\x20\x22avatar_prompt\x22:\x20\x22(可选)如果评论者是【全新的】NPC,提供头像指令\x22\x20},\x0a\x20\x20\x20\x20\x20\x20{\x20\x22commenter\x22:\x20\x22角色B的名字\x22,\x20\x22text\x22:\x20\x22角色B对角色A或楼主的看法。\x22\x20}\x0a\x20\x20\x20\x20]\x0a\x20\x20\x20\x20```\x0a\x0a#\x20上下文\x0a-\x20**帖子标题**:\x20《','正在合并\x20','#avatar-frame-modal\x20.frame-tabs','来自动态','导演/编辑模式保存(Sticker):\x20使用了\x20meaning\x20查找','isAwaitingResponse','compress-images-btn','”)下发送了一个表情评论，意思是：“','.music-search-checkbox:checked','https://i.postimg.cc/qBbKK7dS/IMG-4386.gif','未知书籍','recordId','<p\x20style=\x22text-align:\x20left;\x20white-space:\x20pre-wrap;\x22>','45900zfnkmm','https://files.catbox.moe/','API错误:\x20','\x0a\x0a#\x20你的动态历史\x20(你可以选择删除它们):\x0a','标题是必填项哦！',']\x0a\x20\x20\x20\x20\x20\x20\x20\x20','<option\x20value=\x22\x22>--\x20不使用预设\x20--</option>','#douban-cast-list\x20.douban-cast-checkbox:checked','\x22操作...','https://i.postimg.cc/J0CZSwyW/IMG-6938.gif','下一步','https://i.postimg.cc/1XqzGKwJ/mmexport1751018282681.gif','save-rule-btn','-\x20用户在你们共同所在的群聊中的昵称如下：\x0a','订单详情','total-image-size-display',':generateContent?key=','import-appearance-input','动态已删除。','\x0a\x0a#\x20关系与身份档案\x20(至关重要)\x0a-\x20\x20\x20**你的本名**:\x20\x22','scroll','padStart',')，并在对话中自然地体现出来。\x0a\x20\x20\x20\x20-\x20**音乐**:\x20','https://i.postimg.cc/fRV86FMq/IMG-4381.gif','旁观模式收到未知指令类型:','正在等待AI角色们继续讨论...','</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22article-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>来源:\x20','https://i.postimg.cc/XqRZNZ9G/IMG-6916.gif','[私聊]','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox\x20selected\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>','block_user','rp-direct-amount','post-remove-image-btn','\x22\x20title=\x22删除书籍\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','https://i.postimg.cc/9fQZ425b/IMG-5975.gif','.favorite-item-card','\x20发布)\x0a','onclick','Memories','++id,\x20chatId,\x20timestamp,\x20type,\x20targetDate','请至少选择一个要清理的角色。','导入已取消，因为未提供名称。','countdown','ephone-theme','操作失败，未能生成长期记忆。\x0a\x0a错误详情:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bottom:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20right:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20','\x20更换了群头像','”。请自然地接受这个新名字，不要对此感到惊讶。]','\x20的聊天','.screen.active','thoughts','[系统提示：你拒绝并退还了“','commentCooldowns','upgrade','\x20元。此订单已完成。]','https://i.postimg.cc/mDfMXXFP/IMG-7007.gif','home-screen-pages-container','您的旧有记忆已被完整保留，未作任何修改。','获取AI投票决策失败:\x20','shopping-category-count-input','dblclick','生成图像','single-lyric-display','#\x20角色核心设定\x0a','[系统提示：用户之前发送了一张图片，AI对图片的首次回应（摘要）是：“','qzone-screen','werewolf-selection-item','请稍候...','发布公告','更新通知文件中缺少\x20data-version\x20属性。','memories-list','http','token-count-display','API\x20预设已保存！','thoughts-history-list','刷新页面？','char-photo-description','Confirm','seed','添加人设预设','novelai-settings-modal','linkedMemoryCount','memos','char-amap-list','\x20觉得很赞</span></div>','werewolf-log-entry\x20system','inline-flex','请输入一个有效的图片URL！','TA的相册','[系统提示：用户关闭了五子棋棋盘，游戏结束了。]','unreadPostsCount','temp_user_chat_mirror','来源网站','\x22\x20class=\x22usage-item-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22usage-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22usage-item-name\x22>','prompt_order','accepted','.voice-transcript','Edit\x20Entry','reason','selection-mode','cancel-rule-editor-btn','部分失败','save-shopping-settings-btn','所有数据已成功恢复！应用即将刷新以应用所有更改。','<div\x20class=\x22waimai-card\x22><div\x20class=\x22waimai-header\x22><img\x20src=\x22https://files.catbox.moe/mq179k.png\x22\x20class=\x22icon\x22\x20alt=\x22Meituan\x20Icon\x22><div\x20class=\x22title-group\x22><span\x20class=\x22brand\x22>美团外卖</span><span\x20class=\x22separator\x22>|</span><span>外卖美食</span></div></div><div\x20class=\x22waimai-catchphrase\x22>Hi，你和我的距离只差一顿外卖～</div><div\x20class=\x22waimai-main\x22><div\x20class=\x22request-title\x22>','》\x20-\x20','\x0a\x0a#\x20参考记忆\x20(至关重要！群内角色必须【主动】将这些参考记忆中的【关键信息和事件】，自然地融入到当前的对话中，以体现你们拥有完整的共同记忆。)\x0a','cphoneAppIcons','https://i.postimg.cc/c4JMPd2W/IMG-4724.gif','pin','#\x20角色与玩家档案\x20(Character\x20&\x20Player\x20Dossiers)\x0a','#world-book-checkboxes-container\x20input:checked','将清空角色的相册、QQ、浏览器、淘宝、日记、备忘录等所有模拟手机数据。','张图片，prompt:','\x20元。]','backgroundColor','已被用户删除','associatedWith','\x20-\x20响应内容:\x20','\x0a\x0a现在，请继续这场对话。\x0a','.nai-gallery-item[data-key=\x22','请输入预设名称','profile-main-content','qzoneSettings','message','msgTimestamp','\x22\x20class=\x22comment-sticker\x22\x20alt=\x22sticker\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**可用播放列表**:\x20[','douban-settings-btn','qzone_','<span\x20class=\x22diary-highlight\x22>$1</span>','删除分组后，该组内的所有NPC将变为“未分组”。确定要删除吗？',',\x0a\x22data\x22:\x20{\x0a','世界书','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-likes-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20class=\x22like-icon\x22\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M20.84\x204.61a5.5\x205.5\x200\x200\x200-7.78\x200L12\x205.67l-1.06-1.06a5.5\x205.5\x200\x200\x200-7.78\x207.78l1.06\x201.06L12\x2021.23l7.78-7.78\x201.06-1.06a5.5\x205.5\x200\x200\x200\x200-7.78z\x22></path></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','。请收礼的角色表示感谢，其他角色可以自由发挥。]','preset-tabs','favorite-article-btn','minimaxModel','bu_wan_jiu_guan_bu_yao_huo_qu','chat-lock-content','这个预设文件中没有找到任何有效的提示词条目。','delete-appearance-preset-btn','默认头像','\x20被刀了','找不到表:\x20','请先选择要添加的歌曲。','myAvatar','werewolf-user-input','repost','group_call_summary','end','\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20【内容禁忌】\x0a\x20\x20\x20\x20\x20\x20\x20\x20为了保持新鲜感，你本次的行动【绝对不能】再发布以下或类似主题的内容：\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x20天的讨论环节。\x0a','请先配置NovelAI\x20API\x20Key！','mouseleave','event_type','下载\x20(','票)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:\x2013px;\x20color:\x20#555;\x20margin:\x200;\x20line-height:\x201.5;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','++id,\x20name,\x20createdAt','werewolf-player-grid','preset-screen','\x22\x20class=\x22avatar\x22>','char-amap-item','frame_14','移出成员','播放已暂停','”量身打造一个专属的商品列表。\x0a\x0a#\x20核心规则\x0a1.\x20\x20**【角色定制(最高优先级)】**:\x20你生成的所有商品和分类【必须】深度绑定角色的性格、记忆和最近的对话。它们应该是角色会真正感兴趣、购买或制作的东西。\x0a2.\x20\x20**创造性与合理性**:\x20商品和分类必须合理且多样化。\x0a3.\x20\x20**格式铁律\x20(最高优先级)**:\x20\x0a\x20\x20\x20\x20-\x20你的回复【必须且只能】是一个【单一的JSON对象】。\x0a\x20\x20\x20\x20-\x20你的回复必须以\x20`{`\x20开始，并以\x20`}`\x20结束。\x0a\x20\x20\x20\x20-\x20【绝对禁止】在JSON对象前后添加任何多余的文字、解释或\x20markdown\x20标记。\x0a\x20\x20\x20\x20-\x20格式【必须】如下:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22categories\x22:\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22name\x22:\x20\x22分类名称1\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22products\x22:\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22name\x22:\x20\x22商品名称1\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22price\x22:\x2099.80,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22description\x22:\x20\x22这是商品的详细描述，不少于50字...\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22variations\x22:\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20{\x20\x22name\x22:\x20\x22款式1\x22,\x20\x22price\x22:\x20108.80,\x20\x22image_prompt\x22:\x20\x22款式1的图片【英文】关键词...\x22\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20{\x20\x22name\x22:\x20\x22款式2\x22,\x20\x22price\x22:\x20118.80,\x20\x22image_prompt\x22:\x20\x22款式2的图片【英文】关键词...\x22\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20],\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22image_prompt\x22:\x20\x22商品主图的【英文】关键词,\x20风格为\x20realistic\x20product\x20photo,\x20high\x20quality,\x20on\x20a\x20clean\x20white\x20background\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20]\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20]\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20```\x0a\x20\x20\x20\x20-\x20**categories**:\x20生成\x20','outgoing-call-name','select-all-nai-gallery-checkbox','添加网络歌曲','isArray','characterNegativePrompt','Moments','qzone-banner-input','repostComment','请输入一个有效的数字（建议大于20）。','panelEl','language-select','\x0a**---\x20第\x20','add-song-url-btn','countdown-title-input','\x0a\x0a#\x20群成员列表及人设\x20(你扮演的所有角色)\x0a','addEventListener','📁\x20从本地文件\x20(.lrc)','https://i.postimg.cc/B6T59xGK/IMG-7101.gif','浏览器','\x22\x20中的成员信息更新','你已经死亡，无法发言。请等待其他玩家发言结束。','\x22\x20更换了头像','add-message-editor-block-btn','slice_','删除失败','此操作将永久删除您选择的\x20','https://i.postimg.cc/tTWKKmTN/IMG-7073.gif','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22douban-group-name\x22>来自\x20','副API设置\x20(用于总结长期记忆)','”。用户刚刚在TA的手机（CPhone）上点击了一个按钮，希望你能继续你们之前的对话。你的任务是根据上下文，生成【3到5条】符合你人设的、简短的、连续的新回复。\x0a\x0a#\x20输出格式铁律\x20(最高优先级)\x0a-\x20你的回复【必须】是一个JSON数组，每个对象代表一条消息。\x0a-\x20格式:\x20`[{\x22type\x22:\x20\x22text\x22,\x20\x22content\x22:\x20\x22第一句话\x22},\x20{\x22type\x22:\x20\x22text\x22,\x20\x22content\x22:\x20\x22第二句话\x22},\x20{\x22type\x22:\x20\x22sticker\x22,\x20\x22meaning\x22:\x20\x22表情的含义(从可用表情列表选择)\x22}]`\x0a-\x20你可以自由组合使用\x20\x22text\x22,\x20\x22sticker\x22,\x20\x22ai_image\x22,\x20\x22voice_message\x22\x20等多种消息类型。\x0a请根据当前情景和你的情绪，从列表中【选择一个最合适的】表情含义来使用\x20\x22sticker\x22\x20指令。尽量让你的表情丰富多样，避免重复。\x0a#\x20你的角色设定\x0a','add-group-avatar-upload-btn','keyword-search-input','floor','。请你对此作出回应。]','change_user_avatar','副反代地址','”。你之前被用户（你的聊天对象）拉黑了，你们已经有一段时间没有联系了。\x0a\x20\x20\x20\x20\x20\x20\x20\x20现在，你非常希望能够和好，重新和用户聊天。请你仔细分析下面的“被拉黑前的对话摘要”，理解当时发生了什么，然后思考一个真诚的、符合你人设、并且【针对具体事件】的申请理由。\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20你的角色设定\x0a\x20\x20\x20\x20\x20\x20\x20\x20','您的修改已保存！','cancel-product-editor-btn','聊天设置','announcement-actions-modal','**。\x0a\x20\x20\x20\x20-\x20\x20\x20你生成的日记标题日期【必须】是今天或今天以前的日期。\x0a\x20\x20\x20\x20-\x20\x20\x20【绝对禁止】生成任何未来的日期！\x0a2.\x20\x20**【【【沉浸感铁律】】】**:\x20日记必须使用【第一人称视角\x20(\x22我\x22)】来写，并且要充满角色的个人情感、思考和秘密。在日记中描述自己的行为或想法时，【绝对禁止】使用第三人称“他”或“她”\x20(TA)。\x0a3.\x20\x20**【【【长度铁律】】】**:\x20日记的正文长度【必须不少于300字】。\x0a4.\x20\x20**【【【格式铁律\x20(最高优先级)】】】**:\x20你的回复【必须且只能】是一个JSON数组，且数组中【只包含一个】对象，格式【必须】如下:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20[\x0a\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22title\x22:\x20\x22这篇日记的标题，例如：9月20日\x20晴\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22这里是日记的详细正文，必须支持换行符\x5cn，并且必须巧妙地使用下面的【日记专属Markdown语法】来丰富文本表现力。\x22\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20]\x0a\x20\x20\x20\x20```\x0a5.\x20\x20**【【【日记专属Markdown语法\x20(必须使用！)】】】**:\x0a\x20\x20\x20\x20-\x20\x20\x20`**加粗文字**`:\x20用于强调。\x0a\x20\x20\x20\x20-\x20\x20\x20`~~划掉的文字~~`:\x20用于表示改变主意或自我否定。\x0a\x20\x20\x20\x20-\x20\x20\x20`!h{黄色高亮}`:\x20用于标记关键词或重要信息。\x0a\x20\x20\x20\x20-\x20\x20\x20`!u{粉色下划线}`:\x20用于标注人名、地名或特殊名词。\x0a\x20\x20\x20\x20-\x20\x20\x20`!e{粉色强调}`:\x20用于表达强烈的情绪。\x0a\x20\x20\x20\x20-\x20\x20\x20`!w{手写体}`:\x20用于写下引言、歌词或特殊笔记。\x0a\x20\x20\x20\x20-\x20\x20\x20`!m{凌乱的手写体}`:\x20用于表达激动、慌乱或潦草记录时的心情。\x0a\x20\x20\x20\x20-\x20\x20\x20`||涂黑||`:\x20用于隐藏秘密或敏感词汇(每次涂黑2~5个字)。\x0a\x0a#\x20供你参考的上下文\x0a-\x20**你的角色设定**:\x20','anime\x20person','\x20的外卖订单（时间戳:\x20','image_prompt','未知App','memberId','custom-modal-overlay','data-clear-step-2','</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a#\x20你的任务\x0a你是一个虚拟社交生活模拟器，扮演角色“','DOMContentLoaded','browser','-9999px','你已拒收','该消息发送已超过2分钟，无法撤回。','participant-display-avatar','localeCompare','正在请求AI为新头像命名...','强力提取\x20[\x20...\x20}\x20...\x20]\x20失败，将尝试提取单个对象...','...\x0a-\x20**已有评论**:\x0a','”的心声','parentElement','CELL_SIZE','abort','rules-category-pane\x20active','等待对方处理...','请输入一个有效的、未来的日期！','statusText',')为你点了一份外卖作为【礼物】。外卖内容是“','group_','readAsText','save-api-settings-btn','days','备注名/群名不能为空！','https://i.postimg.cc/Fsvr71JL/IMG-5573.gif','decline_transfer','确定要删除表情\x20\x22','):\x20','确认送出礼物','。等待对方处理。]','change_group_avatar','转发了\x20@','vote_for_name','world-book-editor-screen','\x20条长期记忆发送给AI，总结成大约\x20','confirm-wolf-kill-btn','「在这里输入对话内容」\x5cn(在这里输入动作或环境描写)','nai-cors-proxy','检测到\x20\x27entries\x27\x20对象格式的预设，将尝试按顺序导入。','groupAvatarLibrary','offline-max-length-input','\x20更换了头像]','naiimag-image','rgba(0,\x200,\x200,\x200.4)','send-btn','消息已更新！','error','在导演模式保存时，遇到了未知的AI指令类型:','max-memory','你们在','declined','-\x20**当前歌词**:\x20\x22','https://i.postimg.cc/gcV0VR2t/IMG-4408.gif','已死亡的用户(','my-persona','SHA-256','[发送了一张图片，描述为：','\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20你的任务\x0a\x20\x20\x20\x20\x20\x20\x20\x20你是一个群聊视频通话的导演。你的任务是扮演所有【除了用户以外】的AI角色，并以【第三人称旁观视角】来描述他们在通话中的所有动作和语言。\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20核心规则\x0a\x20\x20\x20\x20\x20\x20\x20\x201.\x20\x20**【【【身份铁律】】】**:\x20用户的身份是【','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','✅\x20[NAI下载]\x20三击下载功能已初始化','voteResults','content','question','blob','favorites-view','AI生图功能已','操作结果','旁观模式AI发送了一个没有\x20\x27meaning\x27\x20的\x20sticker\x20指令。','video_call_request','\x0a\x0a#\x20供你参考的信息\x0a','activeBookId','image_url','realimag','删除失败，请查看控制台错误信息。','已撤回的消息','-\x20**你的好友\x20(必须保护)**:\x20你和\x20','导演/编辑模式保存(Sticker):\x20指令无效或缺少必要字段\x20(meaning/url/content):','parse','https://i.postimg.cc/VNK6Ccsf/IMG-5722.gif','\x0a#\x20世界观设定\x20(必须参考)\x0a','添加商品','chat-header-title','disable','导入外观设置时出错:','<div\x20class=\x22post-main-content\x22>','文章标题','browser-content','transfer-cancel-btn','\x22,\x20\x22postId\x22:\x20123,\x20\x22replyTo\x22:\x20\x22被回复者本名\x22,\x20\x22commentText\x22:\x20\x22@[[被回复者本名]]\x20你的回复\x22}]`\x0a-\x20\x20\x20**点赞动态**:\x20`{\x22type\x22:\x20\x22qzone_like\x22,\x20\x22postId\x22:\x20456}`\x0a-\x20\x20\x20**拍用户**:\x20`{\x22type\x22:\x20\x22pat_user\x22,\x20\x22suffix\x22:\x20\x22(可选)后缀\x22}`\x0a-\x20\x20\x20**分享链接**:\x20`{\x22type\x22:\x20\x22share_link\x22,\x20\x22title\x22:\x20\x22标题\x22,\x20\x22description\x22:\x20\x22摘要\x22,\x20\x22source_name\x22:\x20\x22来源\x22,\x20\x22content\x22:\x20\x22正文\x22}`\x0a-\x20**共享位置**:\x20\x27{\x22type\x22:\x20\x22location_share\x22,\x20\x22content\x22:\x20\x22你想分享的位置名\x22}\x27\x0a\x0a###\x20状态与关系指令\x0a-\x20\x20\x20**更新状态**:\x20`{\x22type\x22:\x20\x22update_status\x22,\x20\x22status_text\x22:\x20\x22我去做什么了\x22,\x20\x22is_busy\x22:\x20false}`\x0a-\x20\x20\x20**改自己昵称**:\x20`{\x22type\x22:\x20\x22change_remark_name\x22,\x20\x22new_name\x22:\x20\x22新名字\x22}`\x0a-\x20\x20\x20**改用户昵称**:\x20`{\x22type\x22:\x20\x22change_user_nickname\x22,\x20\x22new_name\x22:\x20\x22新称呼\x22}`\x0a-\x20\x20\x20**换自己头像**:\x20`{\x22type\x22:\x20\x22change_avatar\x22,\x20\x22name\x22:\x20\x22头像名\x22}`\x20(从你头像库选)\x0a-\x20\x20\x20**换用户头像**:\x20`{\x22type\x22:\x20\x22change_user_avatar\x22,\x20\x22name\x22:\x20\x22头像名\x22}`\x20(从用户头像库选)\x0a-\x20\x20\x20**回应好友申请**:\x20`{\x22type\x22:\x20\x22friend_request_response\x22,\x20\x22decision\x22:\x20\x22accept\x22\x20or\x20\x22reject\x22}`\x0a-\x20\x20\x20**拉黑用户**:\x20`{\x22type\x22:\x20\x22block_user\x22}`\x0a\x0a###\x20特殊功能指令\x0a-\x20\x20\x20**记录回忆**:\x20`{\x22type\x22:\x20\x22create_memory\x22,\x20\x22description\x22:\x20\x22记录这件有意义的事。\x22}`\x0a-\x20\x20\x20**创建约定**:\x20`{\x22type\x22:\x20\x22create_countdown\x22,\x20\x22title\x22:\x20\x22约定标题\x22,\x20\x22date\x22:\x20\x22YYYY-MM-DDTHH:mm:ss\x22}`\x0a-\x20\x20\x20**切换歌曲**:\x20`{\x22type\x22:\x20\x22change_music\x22,\x20\x22song_name\x22:\x20\x22歌名\x22}`\x20(从播放列表选)\x0a-\x20\x20\x20**发起转账**:\x20`{\x22type\x22:\x20\x22transfer\x22,\x20\x22amount\x22:\x205.20,\x20\x22note\x22:\x20\x22备注\x22}`\x0a-\x20\x20\x20**回应转账**:\x20`{\x22type\x22:\x20\x22accept_transfer\x22,\x20\x22for_timestamp\x22:\x20时间戳}`\x20或\x20`{\x22type\x22:\x20\x22decline_transfer\x22,\x20\x22for_timestamp\x22:\x20时间戳}`\x0a-\x20\x20\x20**发起外卖代付**:\x20`{\x22type\x22:\x20\x22waimai_request\x22,\x20\x22productInfo\x22:\x20\x22商品\x22,\x20\x22amount\x22:\x2025}`\x20(你想让【用户】帮你付钱时使用)\x0a-\x20\x20\x20**回应外卖代付**:\x20`{\x22type\x22:\x20\x22waimai_response\x22,\x20\x22status\x22:\x20\x22paid\x22\x20or\x20\x22rejected\x22,\x20\x22for_timestamp\x22:\x20时间戳}`\x0a-\x20\x20\x20**发起视频通话**:\x20`{\x22type\x22:\x20\x22video_call_request\x22}`\x0a-\x20\x20\x20**回应视频通话**:\x20`{\x22type\x22:\x20\x22video_call_response\x22,\x20\x22decision\x22:\x20\x22accept\x22\x20or\x20\x22reject\x22}`\x0a-\x20\x20\x20**下五子棋**:\x20`{\x22type\x22:\x20\x22gomoku_move\x22,\x20\x22name\x22:\x20\x22','global_css','NPC\x20列表','margin:\x2015px\x200\x205px;\x20color:\x20#555;\x20border-bottom:\x201px\x20solid\x20#eee;\x20padding-bottom:\x203px;','gomoku-overlay','&id,\x20name,\x20categoryId','wallpaper-upload-input','传统导出数据时出错:','正在为您选择的\x20','你让大家继续讨论...','\x20是我的好友。\x0a','save-character-nai-prompts-btn','preset-editor-title','已使用','\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20#fff;\x0a\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2012px\x20rgba(0,0,0,0.06);\x0a\x20\x20\x20\x20','table','专辑封面已更新！','</div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22fav-card-content\x22>','time','https://i.postimg.cc/7Zgm1wRy/IMG-6295.gif','未知表情','https://i.postimg.cc/xCqqKGRN/IMG-6929.gif','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-management-overlay\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22edit-product-btn\x22>编辑</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-product-btn\x22>删除</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a#\x20长期记忆\x20(必须严格遵守)\x0a','globalSettings','rp-direct-receiver','ai-persona-group',':\x20[发送了一个表情，意思是:\x20\x27','AI\x20获胜了！','douban-settings-modal','你们没有在读书。','Global\x20(All\x20Characters)','.chat-group-header','\x0a#\x20可用表情包\x0a-\x20当你需要发送表情时，你【必须】从下面的列表中【精确地选择一个】含义（meaning）。\x0a-\x20【绝对禁止】使用任何不在列表中的表情含义！\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20','”的群聊。\x0a\x20\x20\x20\x20\x20\x20\x20\x20','nai-gallery-action-bar','isClosed','scrollWidth','myAvatarLibrary','authorId','无法获取电池信息:','decrease-qty-btn','\x20人投票</span><button\x20class=\x22poll-action-btn\x22>查看结果</button></div>','\x0a#\x20你的任务\x0a你是一个虚拟社区的AI。你的核心任务是扮演角色“','var(--accent-color)','itemName','恭喜发财，大吉大利！','chatListRenderWindow','我的消息预览','POST',')\x20刚刚领取了红包\x20(时间戳:\x20','并评论说：“','专属红包:\x20给\x20','pending_system_reflection','”的对话，然后用【第一人称\x20(\x22我\x22)】的口吻，总结出一段简短的、客观的、包含关键信息的记忆。\x0a\x0a#\x20当前时间\x0a-\x20**今天是：','”\x20已成功导入！','custom-modal-title','photoId','douban-detail-comments-list','horizontal','已成功批量导入\x20','.chat-list-item','\x0a\x0a#\x20','第一夜，执行本地随机刀人逻辑...','\x22\x20class=\x22preview-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','EPhone-Full-Backup-','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-title\x22>','copy-memo-content-btn','.participant-avatar-wrapper[data-participant-id=\x22user\x22]\x20.participant-avatar','qzone-back-btn','alternateGreetings','当前页内容摘要','regenerate-char-taobao-btn','在这里输入语音内容...','\x27>图片动态</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27','sticker-binding-modal','”的记忆\x20---\x0a','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','productId','https://i.postimg.cc/prsGKMBx/IMG-4370.gif','\x0a#\x20当前五子棋局势\x0a','cancel-create-post-btn','\x0a-\x20\x20\x20**转发动态**:\x20`[{\x22type\x22:\x20\x22repost\x22,\x20\x22postId\x22:\x20动态ID,\x20\x22comment\x22:\x20\x22转发评论\x22}]`\x20(禁止自己拼接\x22//转发\x22)\x0a-\x20\x20\x20**评论动态**:\x0a\x20\x20\x20\x20-\x20\x20\x20文字:\x20`[{\x22type\x22:\x20\x22qzone_comment\x22,\x20\x22name\x22:\x20\x22','\x0a#\x20待总结的对话历史\x0a','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-weight:\x20600;\x20font-size:\x2016px;\x20color:\x20#ff5722;\x22>-\x20¥','transfer-action-cancel','错误:\x20','Test\x20Generation','请输入一个有效的URL或选择一个文件！','column','由于浏览器安全限制，AI切换的歌曲无法自动播放。请手动点击播放按钮\x20▶\x20继续欣赏。','名为\x20“','游戏开始','identifier','Content','.entry-keys-input','Book\x20Name','artist','linear-gradient(135deg,\x20#f6d365,\x20#fda085)','send-photo-btn','resolve','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22lock-text\x22>你被对方拉黑了。</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22apply-friend-btn\x22\x20class=\x22lock-action-btn\x22>重新申请加为好友</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','shopping-settings-modal','）说一些不想让群里其他人看到的私密话时（例如：表达爱意、抱怨、揭短、分享秘密），你【应该】使用\x20\x22send_private_message\x22\x20指令。\x0a-\x20\x20\x20这个指令会把消息发送到你和用户之间的【1对1私聊】中。\x0a-\x20\x20\x20【格式铁律】:\x20\x22content\x22\x20字段【必须】是一个【JSON字符串数组\x20(Array\x20of\x20Strings)】。\x0a-\x20\x20\x20【单条私信示例】:\x20`{\x22type\x22:\x20\x22send_private_message\x22,\x20\x22name\x22:\x20\x22你的角色本名\x22,\x20\x22recipient\x22:\x20\x22','.icon-setting-item','https://i.postimg.cc/XY63sTS3/IMG-4393.gif','\x22\x20class=\x22product-image\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-name\x22>','openCharWallet','\x20位AI角色的长期记忆中！','exec','textAlign','已成功导出所有数据！','成功移除了\x20','收藏成功！','文章详情','https://i.postimg.cc/MTC3Tkw8/IMG-6436.jpg','translateX(calc(-','删除规则','此操作将检查播放列表中的每一首网络歌曲，并移除所有无法播放的“死链”。本地歌曲不会受影响。','clipboard',')\x20试图将群名更改为成员名\x20(\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22image-size-label\x22>计算图片大小时出错</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22image-size-value\x22>Error</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','scrolling','一点心意','置顶聊天','fetch-models-btn','open-nai-gallery-btn','bg-preview','正在合并数据，请勿关闭页面...','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memo-content-preview\x22>','naiimag','https://i.postimg.cc/J4fwkTLW/mmexport1751038167142.gif','character-nai-negative','\x22,\x20\x22content\x22:\x20[\x22第一条私信\x22,\x20\x22第二条...\x22,\x20\x22最后一条。\x22]}`\x0a#\x20赠送礼物指南\x0a当对话达到特殊时刻（如庆祝纪念日、道歉、表达强烈好感或仅仅是想给用户一个惊喜时），你应该【主动考虑】挑选一件礼物送给用户。\x0a#\x20表情使用指南\x0a请根据当前情景和你的情绪，从列表中【选择一个最合适的】表情含义来使用\x20\x22sticker\x22\x20指令。尽量让你的表情丰富多样，避免重复。\x0a-\x20\x20**元数据铁律\x20**:\x20你的对话历史中可能包含\x20(Timestamp:\x20...)\x20标记、[系统提示：...]\x20文本、或你自己上一轮的JSON格式回复。这些都是【系统元数据】，你【必须】完全忽略它们，【绝对禁止】将它们评论为“火星文”、“乱码”或任何你无法理解的内容。\x0a#\x20当前群聊信息\x0a-\x20**群名称**:\x20','.sticker-item','成功检查并修复了\x20','》设定:\x0a','\x22\x20data-commenter-display-name=\x22','”这个信息，将其转换为【具体的公历日期】。\x0a4.\x20\x20**【风格要求】**:\x20你的总结应该像一份清晰的个人档案或事件回顾，而不是一篇情感散文。请删除重复、琐碎或纯粹的情感宣泄，只保留对情节和关系发展至关重要的部分。\x0a5.\x20\x20**【【【长度铁律】】】**:\x20你的总结【必须】非常精炼，总长度应控制在\x20**','分享新鲜事...（非必填的公开文字）','.nai-gallery-item.selected','position','light','你的收藏夹是空的，<br>快去动态或聊天中收藏喜欢的内容吧！','\x20<small\x20style=\x22color:#007722;\x22>(NPC)</small></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','upload-custom-frame-btn','Background\x20Activity\x20Settings','查看失败','<p\x20style=\x22color:\x20var(--text-secondary);\x22>没有可用的分组</p>','chat-list-screen','播放失败，请检查URL是否正确或浏览器是否支持该格式。','Import\x20Backup\x20File','<span\x20style=\x22color:\x20red;\x22>未运行</span>','char-music-mode-btn','setDate','已加载预设\x20“','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','操作失败:\x20','nai-steps','stroke','》的歌词已成功保存！','go-to-cart-btn','确定切换','》:\x0a','浏览器不支持电池状态API。','call','AI女巫决策：今天是第','\x0a#\x20你的任务\x0a你是一个虚拟社区的AI导演。下面的“帖子摘要”和“已有评论”来自于一个豆瓣小组的帖子。用户“',')\x20拒绝了\x20','.selected','请添加歌曲','\x20行的格式不正确，已被系统跳过。','cancel-werewolf-lobby-btn','custom-user-font','\x0a##\x20来自《','.com/','.status-text','\x22\x20class=\x22avatar\x22\x20style=\x22border-radius:\x2050%;\x20width:\x2045px;\x20height:\x2045px;\x22></div>','✅\x20动态NovelAI图片全部生成完成:\x20','simulatedMusicPlaylist','AI\x20(独立行动)\x20发送了一个没有\x20\x27meaning\x27\x20的\x20sticker\x20指令。','text-image-mode-content','\x0a#\x20智能总结\x20(基于不同时间维度的对话回顾)\x0a','edit-product-btn','请输入新的图片URL：','delete-transcript-btn','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22waimai-details-btn\x22>查看订单详情</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','offsetTop','post-image-preview-container','https://i.postimg.cc/XNkQTHvf/IMG-5561.gif','总结长期记忆时出错:','isBgClear','enabled','https://i.postimg.cc/fycfcvHf/IMG-6569.gif','正在请求AI进行记忆精炼...','❌\x20NAI图片生成失败:','”。\x0a','\x22\x20生成行动失败:','\x20(已忽略版本:\x20','char-memo-detail-back-btn','add-new-product-category-btn','memo','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','.world-book-category-pane[data-category-id=\x22','https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1757748720126_qdqqd_1jt5sv.jpeg','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x27刚刚评论了你的动态“','music-player-overlay','keys','https://i.postimg.cc/wBw5Fvcn/IMG-5974.gif','.nai-gallery-item','\x22\x20class=\x22product-image\x22>','没有可复制的内容。','号玩家:\x20','🔧\x20检测到Chrome浏览器，启用headers兼容性处理','ᗜωᗜ','#world-book-checkboxes-container\x20input[type=\x22checkbox\x22]:checked','character','cancel-sticker-binding-btn','.waimai-user-actions\x20button','-\x20(暂无)','douban-max-posts-input','退出游戏','\x20个新表情！','timestamp','\x0a\x0a#\x20你的角色库\x20(你可以从中选择【任何角色】进行评论，并参考他们的记忆和对话)\x0a','\x0a\x0a现在，请开始生成这组App使用记录。','avatar-frame-modal','photo-viewer-prev-btn','将清空选定角色的所有通话记录。','customCss','https://i.postimg.cc/mgGc0HbK/IMG-6926.gif','children','select-all-frames-checkbox','API设置','这条动态的原始数据已被彻底清除。','API\x20调用失败','minimax-api-key','指定的数据已成功清除。','<div\x20class=\x22custom-title\x22>','post-image-preview','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.message-bubble.selected::after\x20{\x20display:\x20none\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.cloned-header\x20.default-controls\x20{\x20display:\x20flex\x20!important;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x20width:\x20100%;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.cloned-header\x20.selection-controls\x20{\x20display:\x20none\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22><div\x20class=\x22poll-question\x22>','blockedTimestamp','search-history-back-btn','\x20\x20\x20\x20-\x20我昨晚查验了\x20','uncategorized','.message-bubble.is-link-share','lineWidth','global-custom-style','rp-direct-total','🌐\x20使用网络URL','.selected-options-text','transaction','API\x20预设管理','player','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','分片导出过程中出错:','将分类\x20“','relationship','https://i.postimg.cc/XJy8JWdh/IMG-6568.gif','steps','random','<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>点击右上角刷新按钮，<br>看看TA最近都和谁聊天了吧！</p>','</name>\x0a\x20\x20<persona>','swiped','#fullscreen-lyrics-container','char-album-screen','purchases','Save\x20All\x20Appearance\x20Settings','apiKey','find','张NovelAI图片:\x20','chat_','清空聊天记录','请你投票。','TA的想法...','count','.icon-preview','.link-share-card','assistant','cphone-wallpaper-preview','</span></div></div>','chat-interface-screen','cancel-share-link-btn','\x0a##\x20---\x20关于“','pat_user','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20-\x20**社交**:\x20\x0a','input[name=\x22theme-select\x22][value=\x22','\x22**\x20的发言。\x0a\x20\x20\x20\x20\x20\x20\x20\x202.\x20\x20**【【【视角铁律】】】**:\x20你的回复【绝对不能】使用第一人称“我”。\x0a\x20\x20\x20\x20\x20\x20\x20\x203.\x20\x20**格式**:\x20你的回复【必须】是一个JSON数组，每个对象代表一个角色的发言，格式为：`{\x22name\x22:\x20\x22角色名\x22,\x20\x22speech\x22:\x20\x22*他笑了笑*\x20大家好啊！\x22}`。\x0a\x20\x20\x20\x20\x20\x20\x20\x204.\x20\x20**角色扮演**:\x20严格遵守每个角色的设定。\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20当前情景\x0a\x20\x20\x20\x20\x20\x20\x20\x20你们正在一个群视频通话中。\x0a\x20\x20\x20\x20\x20\x20\x20\x20**通话前的聊天摘要**:\x0a\x20\x20\x20\x20\x20\x20\x20\x20','url(','group-name','create-album-btn-page','\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20你的任务\x0a\x20\x20\x20\x20\x20\x20\x20\x20你现在是角色“','红包已被领完！','未分类','prophet','confirm-witch-poison-btn','这个分类下还没有表情哦~','\x0a<character>\x0a\x20\x20<name>','claimedBy','心声编辑已取消。','reply-preview-bar','已拒收对方转账','”吗？','absolute','压缩步骤\x201/3:\x20正在从数据库读取所有相关数据...','管理预设分类','为角色\x20\x22','所有图片已准备就绪，正在流式压缩...\x20下载将自动开始。','local','Token\x20calculation\x20error:','activeContainer','https://i.postimg.cc/90RBDh9K/IMG-6377.gif','\x0a-\x20**你的长期记忆**:\x20','isNpc','编辑\x20NPC','请输入新的封面图片链接','导出数据','购物车(','toUpperCase','生成的图片URL:','AI女巫决定保留解药。','qzone-banner-container','./sw.js','cart-back-btn','\x20觉得很赞</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','昨晚\x20','post-actions-modal','主API设置\x20(用于聊天)','收到了格式不规范的AI指令，已跳过:','<p\x20style=\x22color:\x20var(--text-secondary);\x20grid-column:\x201\x20/\x20-1;\x20text-align:\x20center;\x20margin-top:\x2020px;\x22>空空如也~\x20点击右上角\x22添加\x22来创建你的第一个人设预设吧！</p>',')\x20已被用户忽略或为旧版本，无需显示。','”的对话中分享过来的。\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20你的任务：请你阅读并理解下面的对话内容。在接下来的回复中，你可以像真人一样，对这段对话的内容自然地发表你的看法、感受或疑问。\x0a\x20\x20\x20\x20\x20\x20\x20\x20---\x0a\x20\x20\x20\x20\x20\x20\x20\x20[分享的聊天记录开始]\x0a\x20\x20\x20\x20\x20\x20\x20\x20','User\x20Avatar','get','#char-chat-list\x20.chat-list-item','15px','\x20条/个)</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','qzoneGroups','#npc-association-list\x20input:checked','Data\x20Check\x20&\x20Repair','AI决策','还没有可供编辑的AI响应。请先让AI回复一次。','Title','members','Binding\x20Scope','请输入群聊的名字','。你可以使用\x20\x27vote\x27\x20指令参与投票。]','preview-font-style','\x20位角色的记忆中。','\x22><div\x20class=\x22title\x22>','\x0a\x0a现在，请开始生成这组照片的描述和绘画指令。','\x22:\x20[\x0a','\x0a\x0a#\x20核心世界观设定\x20(必须严格遵守以下所有设定)\x0a','messageTimestamp','ai_generated','cfg_scale','每晚可以守护一名玩家，使其免受狼人袭击。不能连续两晚守护同一个人。','open-shopping-btn','.voice-play-btn','天\x20-\x20白天','favoritedPostIds','📁\x20从本地上传','内心独白','[系统消息]\x20','EPhone\x20设备ID:\x20','\x20获胜。也就是说，','https://i.postimg.cc/1zmcp66p/IMG-5973.gif'];_0x49d4=function(){return _0x596612;};return _0x49d4();}_0xa8c37d(0xed9)in navigator&&window[_0xa8c37d(0x122b)]('load',()=>{const _0x25f79a=_0xa8c37d;navigator[_0x25f79a(0xed9)]['register'](_0x25f79a(0x13ed))[_0x25f79a(0x14bc)](_0x114b06=>{const _0x39f9ad=_0x25f79a;console[_0x39f9ad(0x57e)](_0x39f9ad(0x10e9),_0x114b06['scope']);})[_0x25f79a(0x3d1)](_0xb135a=>{const _0x256be5=_0x25f79a;console[_0x256be5(0x57e)](_0x256be5(0xb54),_0xb135a);});});!Array[_0xa8c37d(0x345)][_0xa8c37d(0x38f)]&&Object[_0xa8c37d(0x664)](Array['prototype'],'findLastIndex',{'value':function(_0x1ab136){const _0x295e71=_0xa8c37d;if(this==null)throw new TypeError('Cannot\x20read\x20property\x20\x27findLastIndex\x27\x20of\x20null\x20or\x20undefined');if(typeof _0x1ab136!==_0x295e71(0xd9f))throw new TypeError(_0x295e71(0x90c));let _0x14d9d8=Object(this),_0x4cb50d=_0x14d9d8[_0x295e71(0x58a)]>>>0x0,_0x666710=arguments[0x1],_0x30f82a=_0x4cb50d-0x1;while(_0x30f82a>=0x0){let _0x2583e2=_0x14d9d8[_0x30f82a];if(_0x1ab136[_0x295e71(0x134d)](_0x666710,_0x2583e2,_0x30f82a,_0x14d9d8))return _0x30f82a;_0x30f82a--;}return-0x1;},'configurable':!![],'writable':!![]});const dynamicIslandContent=document['getElementById'](_0xa8c37d(0x451)),islandAlbumArt=document[_0xa8c37d(0x1f4)](_0xa8c37d(0x3fe)),islandLyricContainer=document['getElementById'](_0xa8c37d(0x57b)),islandLyricText=document[_0xa8c37d(0x1f4)](_0xa8c37d(0xc27)),phoneScreenForIsland=document['getElementById'](_0xa8c37d(0x296));let activeMessageTimestamp=null,activeTransferTimestamp=null,lastRawAiResponse='',lastResponseTimestamps=[],lastPrivateMessagesSent=[],currentQzoneReplyContext=null,editingNpcId=null,pendingBackupData=null;const GEMINI_API_URL='https://generativelanguage.googleapis.com/v1beta/models';function _0x475c(_0x38eebb,_0x1abde5){const _0x49d452=_0x49d4();return _0x475c=function(_0x475cbd,_0x26d54e){_0x475cbd=_0x475cbd-0x15d;let _0x1ad993=_0x49d452[_0x475cbd];return _0x1ad993;},_0x475c(_0x38eebb,_0x1abde5);}function getRandomValue(_0x352087){const _0x2db490=_0xa8c37d;if(_0x352087[_0x2db490(0xe82)](',')){const _0x27207e=_0x352087[_0x2db490(0x23f)](',')['map'](_0x4855a5=>_0x4855a5[_0x2db490(0x4a2)]()),_0x481235=Math[_0x2db490(0x123c)](Math['random']()*_0x27207e[_0x2db490(0x58a)]);return _0x27207e[_0x481235];}return _0x352087;}function isImage(_0x4a0df4){const _0x5ac2af=_0xa8c37d;if(_0x4a0df4[_0x5ac2af(0x1296)]&&_0x4a0df4[_0x5ac2af(0x1296)]['url']){let _0xae6d8=_0x4a0df4[_0x5ac2af(0x1296)][_0x5ac2af(0x258)];const _0x4d689e=_0xae6d8[_0x5ac2af(0x23f)](',')[0x1],_0x55a23b=_0xae6d8['match'](/^data:(.*);base64/)[0x1];return[{'text':_0x5ac2af(0x4e5)},{'inline_data':{'mime_type':_0x55a23b,'data':_0x4d689e}}];}return[];}function getGeminiResponseText(_0x1a5dc6){const _0x27d3b8=_0xa8c37d;if(_0x1a5dc6[_0x27d3b8(0x10be)]&&Array[_0x27d3b8(0x121f)](_0x1a5dc6[_0x27d3b8(0x10be)])&&_0x1a5dc6[_0x27d3b8(0x10be)]['length']>0x0&&_0x1a5dc6[_0x27d3b8(0x10be)][0x0][_0x27d3b8(0x11f0)]&&_0x1a5dc6[_0x27d3b8(0x10be)][0x0][_0x27d3b8(0x11f0)][_0x27d3b8(0x128c)])return _0x1a5dc6[_0x27d3b8(0x10be)][0x0][_0x27d3b8(0x11f0)]['content'];if(_0x1a5dc6[_0x27d3b8(0x152f)]&&Array[_0x27d3b8(0x121f)](_0x1a5dc6[_0x27d3b8(0x152f)])&&_0x1a5dc6[_0x27d3b8(0x152f)][_0x27d3b8(0x58a)]>0x0&&_0x1a5dc6['candidates'][0x0][_0x27d3b8(0x128c)]&&_0x1a5dc6['candidates'][0x0]['content']['parts'])return _0x1a5dc6['candidates'][0x0][_0x27d3b8(0x128c)][_0x27d3b8(0x14fb)][0x0]['text'];console[_0x27d3b8(0x127d)]('Gemini\x20API返回了非预期的格式:',_0x1a5dc6);let _0x4ae75c=_0x27d3b8(0xfa1);if(_0x1a5dc6[_0x27d3b8(0x152f)]&&Array[_0x27d3b8(0x121f)](_0x1a5dc6['candidates'])&&_0x1a5dc6[_0x27d3b8(0x152f)][_0x27d3b8(0x58a)]>0x0&&_0x1a5dc6['candidates'][0x0][_0x27d3b8(0x244)]===_0x27d3b8(0x81e)){const _0x15d2c7=_0x1a5dc6[_0x27d3b8(0x152f)][0x0][_0x27d3b8(0xbe5)],_0x53b91d=_0x15d2c7[_0x27d3b8(0xede)](_0x55401e=>_0x55401e[_0x27d3b8(0x5e7)]!==_0x27d3b8(0x7fc)&&_0x55401e[_0x27d3b8(0x5e7)]!=='LOW')[_0x27d3b8(0x1431)](_0x157aed=>_0x157aed[_0x27d3b8(0x60c)]+'\x20(概率:\x20'+_0x157aed[_0x27d3b8(0x5e7)]+')')[_0x27d3b8(0x1143)](',\x20');_0x4ae75c=_0x27d3b8(0x490)+(_0x53b91d||'未知');}else{if(_0x1a5dc6[_0x27d3b8(0xb07)]?.[_0x27d3b8(0xa31)]){const _0x23ff77=_0x1a5dc6[_0x27d3b8(0xb07)][_0x27d3b8(0xa31)],_0xacca0b=_0x1a5dc6[_0x27d3b8(0xb07)][_0x27d3b8(0xbe5)]?.[_0x27d3b8(0x1431)](_0x5774b7=>_0x5774b7[_0x27d3b8(0x60c)]+':\x20'+_0x5774b7[_0x27d3b8(0x5e7)])[_0x27d3b8(0x1143)](',\x20');_0x4ae75c=_0x27d3b8(0x895)+_0x23ff77+_0x27d3b8(0x738)+(_0xacca0b||'无');}else _0x1a5dc6[_0x27d3b8(0x127d)]&&(_0x4ae75c=_0x27d3b8(0x1176)+_0x1a5dc6['error'][_0x27d3b8(0x11f0)]);}throw new Error(_0x4ae75c);}document[_0xa8c37d(0x122b)](_0xa8c37d(0x124f),()=>{const _0x2b1222=_0xa8c37d,_0x576b31=_0x2b1222(0x11ff);async function _0x36302b(_0x170e1d,_0x5610f6){const _0x5c54aa=_0x2b1222;if(!_0x170e1d||!_0x5610f6)throw new Error(_0x5c54aa(0x80b));const _0x1350d0=_0x170e1d+_0x5610f6,_0x4b51cf=new TextEncoder()[_0x5c54aa(0x7bc)](_0x1350d0),_0x457be4=await crypto[_0x5c54aa(0xf7e)]['digest'](_0x5c54aa(0x1286),_0x4b51cf),_0x413495=Array[_0x5c54aa(0xa81)](new Uint8Array(_0x457be4)),_0x2e86fa=_0x413495[_0x5c54aa(0x1431)](_0x5236ea=>_0x5236ea[_0x5c54aa(0xb3f)](0x10)[_0x5c54aa(0x1189)](0x2,'0'))[_0x5c54aa(0x1143)]('');return _0x2e86fa['substring'](0x0,0x6)[_0x5c54aa(0x13e9)]();}function _0x431b54(){return new Promise(async(_0x69e8df,_0x4cda22)=>{const _0x5a0cf3=_0x475c;if(isPinActivated){_0x69e8df(!![]);return;}const _0x303f49=document[_0x5a0cf3(0x1f4)](_0x5a0cf3(0x557)),_0x221af2=document[_0x5a0cf3(0x1f4)]('pin-device-id-display'),_0x8781e3=document['getElementById'](_0x5a0cf3(0x526)),_0x2d91a4=document[_0x5a0cf3(0x1f4)]('pin-modal-confirm-btn'),_0x590a11=document[_0x5a0cf3(0x1f4)](_0x5a0cf3(0xe49));_0x221af2[_0x5a0cf3(0x107e)]=EPHONE_DEVICE_ID,_0x8781e3[_0x5a0cf3(0x107e)]='';const _0x26952a=async()=>{const _0x52ccfc=_0x5a0cf3,_0x2dca20=_0x8781e3['value'];_0x303f49['classList']['remove'](_0x52ccfc(0xfca)),_0x2d91a4[_0x52ccfc(0x7f6)]('click',_0x26952a),_0x590a11['removeEventListener'](_0x52ccfc(0x740),_0x2d2ab2);if(!_0x2dca20||!_0x2dca20[_0x52ccfc(0x4a2)]()){await _0x1460c5(_0x52ccfc(0xc2e),_0x52ccfc(0x852)),_0x4cda22(new Error(_0x52ccfc(0xdf3)));return;}await _0x1460c5(_0x52ccfc(0x11b7),_0x52ccfc(0x7d2));try{const _0x259276=await _0x36302b(EPHONE_DEVICE_ID,_0x576b31);_0x2dca20[_0x52ccfc(0x4a2)]()[_0x52ccfc(0x13e9)]()===_0x259276?(localStorage[_0x52ccfc(0xae8)]('ephonePinActivated',_0x52ccfc(0x8c3)),isPinActivated=!![],await _0x1460c5('激活成功！',_0x52ccfc(0xb0d)),_0x1e6f78(),_0x69e8df(!![])):(await _0x1460c5(_0x52ccfc(0x10ef),_0x52ccfc(0xd78)),_0x4cda22(new Error(_0x52ccfc(0x16c))));}catch(_0x178ef3){console['error'](_0x52ccfc(0x274),_0x178ef3),await _0x1460c5(_0x52ccfc(0x10ef),_0x52ccfc(0xa79)+_0x178ef3[_0x52ccfc(0x11f0)]),_0x4cda22(_0x178ef3);}},_0x2d2ab2=async()=>{const _0x59d3b7=_0x5a0cf3;_0x303f49[_0x59d3b7(0x159b)][_0x59d3b7(0xa9c)](_0x59d3b7(0xfca)),_0x2d91a4['removeEventListener']('click',_0x26952a),_0x590a11['removeEventListener'](_0x59d3b7(0x740),_0x2d2ab2),await _0x1460c5(_0x59d3b7(0xc2e),'激活流程已取消。'),_0x4cda22(new Error(_0x59d3b7(0xd57)));};_0x2d91a4[_0x5a0cf3(0x122b)]('click',_0x26952a),_0x590a11[_0x5a0cf3(0x122b)](_0x5a0cf3(0x740),_0x2d2ab2),_0x303f49['classList'][_0x5a0cf3(0x6a4)](_0x5a0cf3(0xfca)),_0x8781e3[_0x5a0cf3(0xed2)]();});}function _0x1e6f78(){const _0x45b38f=_0x2b1222,_0x5c64fc=localStorage[_0x45b38f(0x587)](_0x45b38f(0x22c))===_0x45b38f(0x8c3),_0x9b8f43=document[_0x45b38f(0x1f4)]('import-preset-btn'),_0x52d2bb=document[_0x45b38f(0x1f4)]('import-world-book-btn');_0x9b8f43&&_0x9b8f43[_0x45b38f(0x159b)][_0x45b38f(0x1483)](_0x45b38f(0xfe6),!_0x5c64fc),_0x52d2bb&&_0x52d2bb['classList'][_0x45b38f(0x1483)](_0x45b38f(0xfe6),!_0x5c64fc);}document[_0x2b1222(0x122b)]('visibilitychange',()=>{const _0x2e4de9=_0x2b1222;document[_0x2e4de9(0xdc2)]==='visible'&&(console['log']('应用已返回前台，正在检查更新...'),navigator[_0x2e4de9(0xed9)][_0x2e4de9(0x1487)][_0x2e4de9(0x14bc)](_0x4e64c3=>{const _0x58cc0b=_0x2e4de9;_0x4e64c3[_0x58cc0b(0xf18)]();}));});function _0x16b978(_0x5678b6,_0x2b6713,_0x5516d1,_0x3b1ec5){const _0x3479ae=_0x2b1222,_0xb3253d=_0x1ae02e['globalSettings']['apiTemperature']||0.8,_0x3798ff={'user':_0x3479ae(0x860),'assistant':_0x3479ae(0x9ef),'system':'user'},_0x1534ea=[{'role':_0x3479ae(0x860),'parts':[{'text':_0x5516d1}]},{'role':_0x3479ae(0x9ef),'parts':[{'text':_0x3479ae(0x381)}]},..._0x3b1ec5[_0x3479ae(0x1431)](_0x3f1962=>{const _0x4671d6=_0x3479ae,_0x54e30b=[];return Array['isArray'](_0x3f1962[_0x4671d6(0x128c)])?_0x3f1962['content']['forEach'](_0x1a3344=>{const _0x44a664=_0x4671d6;if(_0x1a3344['type']===_0x44a664(0x40f))_0x54e30b['push']({'text':_0x1a3344[_0x44a664(0x40f)]});else{if(_0x1a3344[_0x44a664(0xcbd)]===_0x44a664(0x1296)&&_0x1a3344[_0x44a664(0x1296)]&&_0x1a3344['image_url']['url']){const _0x11f1d5=_0x1a3344['image_url'][_0x44a664(0x258)],_0x10ecc2=_0x11f1d5[_0x44a664(0x23f)](',')[0x1],_0x70f76f=_0x11f1d5[_0x44a664(0xba5)](/^data:(.*);base64/);_0x70f76f&&_0x10ecc2&&_0x54e30b['push']({'inline_data':{'mime_type':_0x70f76f[0x1],'data':_0x10ecc2}});}}}):_0x54e30b[_0x4671d6(0x1426)]({'text':String(_0x3f1962['content'])}),{'role':_0x3798ff[_0x3f1962['role']],'parts':_0x54e30b};})];return{'url':_0x3479ae(0xa80)+_0x5678b6+_0x3479ae(0x1184)+getRandomValue(_0x2b6713),'data':{'method':_0x3479ae(0x12d9),'headers':{'Content-Type':_0x3479ae(0xa90)},'body':JSON[_0x3479ae(0x994)]({'contents':_0x1534ea,'generationConfig':{'temperature':_0xb3253d}})}};}const _0x3df81a=new Dexie(_0x2b1222(0x145f)),_0x5a4e4d=[{'id':_0x2b1222(0x1b5),'url':'','name':'无'},{'id':_0x2b1222(0x814),'url':'https://i.postimg.cc/fLDnz5Pn/IMG-5574.gif','name':'1'},{'id':_0x2b1222(0x111a),'url':_0x2b1222(0xb8b),'name':'2'},{'id':'frame_flower','url':_0x2b1222(0x1455),'name':'3'},{'id':_0x2b1222(0xe72),'url':_0x2b1222(0x16e),'name':'4'},{'id':'frame_5','url':_0x2b1222(0x417),'name':'5'},{'id':'frame_6','url':'https://i.postimg.cc/63sDQKMm/IMG-6893.gif','name':'6'},{'id':_0x2b1222(0x151b),'url':'https://i.postimg.cc/cHQPgzj4/IMG-6888.gif','name':'7'},{'id':_0x2b1222(0x88b),'url':_0x2b1222(0x1d6),'name':'8'},{'id':_0x2b1222(0xb6d),'url':_0x2b1222(0x10e3),'name':'9'},{'id':_0x2b1222(0x110a),'url':_0x2b1222(0x750),'name':'10'},{'id':_0x2b1222(0xcea),'url':'https://i.postimg.cc/zvz2LGK0/IMG-4367.gif','name':'11'},{'id':'frame_12','url':_0x2b1222(0x12f7),'name':'12'},{'id':'frame_13','url':_0x2b1222(0x183),'name':'13'},{'id':'frame_14','url':_0x2b1222(0x1571),'name':'14'},{'id':'frame_cat_ear','url':'https://i.postimg.cc/kGgwJhPH/IMG-4374.gif','name':'1'},{'id':_0x2b1222(0x111a),'url':_0x2b1222(0xa3a),'name':'2'},{'id':_0x2b1222(0x1156),'url':_0x2b1222(0x118b),'name':'3'},{'id':_0x2b1222(0xe72),'url':_0x2b1222(0xd68),'name':'4'},{'id':_0x2b1222(0x525),'url':_0x2b1222(0x1170),'name':'5'},{'id':_0x2b1222(0x14ea),'url':_0x2b1222(0xc9e),'name':'6'},{'id':_0x2b1222(0x151b),'url':_0x2b1222(0xad3),'name':'7'},{'id':'frame_8','url':_0x2b1222(0x5b6),'name':'8'},{'id':_0x2b1222(0xb6d),'url':_0x2b1222(0xe04),'name':'9'},{'id':'frame_10','url':_0x2b1222(0x1311),'name':'10'},{'id':_0x2b1222(0xcea),'url':'https://i.postimg.cc/Cx9vCVWH/IMG-4395.gif','name':'11'},{'id':'frame_12','url':_0x2b1222(0x3eb),'name':'12'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x1023),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x1ca),'name':'14'},{'id':_0x2b1222(0x814),'url':_0x2b1222(0x655),'name':'1'},{'id':_0x2b1222(0x111a),'url':'https://i.postimg.cc/59Cn1tkB/IMG-4401.gif','name':'2'},{'id':'frame_flower','url':_0x2b1222(0x4bf),'name':'3'},{'id':'frame_tech','url':'https://i.postimg.cc/Jn1DFPgY/IMG-4403.gif','name':'4'},{'id':_0x2b1222(0x525),'url':_0x2b1222(0x950),'name':'5'},{'id':_0x2b1222(0x14ea),'url':_0x2b1222(0xe53),'name':'6'},{'id':_0x2b1222(0x151b),'url':_0x2b1222(0x1283),'name':'7'},{'id':'frame_8','url':_0x2b1222(0x483),'name':'8'},{'id':'frame_9','url':_0x2b1222(0x20f),'name':'9'},{'id':_0x2b1222(0x110a),'url':_0x2b1222(0xd1a),'name':'10'},{'id':_0x2b1222(0xcea),'url':'https://i.postimg.cc/cHWp0KG6/IMG-4413.gif','name':'11'},{'id':_0x2b1222(0x6f5),'url':_0x2b1222(0x874),'name':'12'},{'id':'frame_13','url':_0x2b1222(0xb7a),'name':'13'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/vHCSG1WM/IMG-4416.gif','name':'14'},{'id':_0x2b1222(0x814),'url':'https://i.postimg.cc/x1Hp80Rm/IMG-4417.gif','name':'1'},{'id':'frame_ribbon','url':_0x2b1222(0x7a4),'name':'2'},{'id':'frame_flower','url':_0x2b1222(0x831),'name':'3'},{'id':_0x2b1222(0xe72),'url':'https://i.postimg.cc/J4WCQd2j/IMG-4420.gif','name':'4'},{'id':_0x2b1222(0x525),'url':_0x2b1222(0xab1),'name':'5'},{'id':'frame_6','url':_0x2b1222(0x9ed),'name':'6'},{'id':_0x2b1222(0x151b),'url':_0x2b1222(0xc2c),'name':'7'},{'id':_0x2b1222(0x88b),'url':_0x2b1222(0xfda),'name':'8'},{'id':_0x2b1222(0xb6d),'url':_0x2b1222(0x644),'name':'9'},{'id':_0x2b1222(0x110a),'url':_0x2b1222(0xac0),'name':'10'},{'id':'frame_11','url':_0x2b1222(0x2cd),'name':'11'},{'id':_0x2b1222(0x6f5),'url':_0x2b1222(0xf55),'name':'12'},{'id':_0x2b1222(0x8f6),'url':'https://i.postimg.cc/nrJSqNhz/IMG-4432.gif','name':'13'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/tC9mJ0cv/IMG-4438.gif','name':'14'},{'id':_0x2b1222(0x814),'url':_0x2b1222(0x1365),'name':'1'},{'id':'frame_ribbon','url':_0x2b1222(0x338),'name':'2'},{'id':'frame_flower','url':_0x2b1222(0x10e0),'name':'3'},{'id':'frame_tech','url':_0x2b1222(0x11e0),'name':'4'},{'id':_0x2b1222(0x525),'url':'https://i.postimg.cc/g2XykNGB/IMG-4727.gif','name':'5'},{'id':_0x2b1222(0x14ea),'url':_0x2b1222(0xaf4),'name':'6'},{'id':'frame_7','url':_0x2b1222(0xaa5),'name':'7'},{'id':_0x2b1222(0x88b),'url':_0x2b1222(0x5fe),'name':'8'},{'id':'frame_9','url':_0x2b1222(0xdc9),'name':'9'},{'id':_0x2b1222(0x110a),'url':_0x2b1222(0x4b8),'name':'10'},{'id':_0x2b1222(0xcea),'url':_0x2b1222(0x1267),'name':'11'},{'id':'frame_12','url':_0x2b1222(0x10a1),'name':'12'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x74c),'name':'13'},{'id':'frame_14','url':_0x2b1222(0xe95),'name':'14'},{'id':_0x2b1222(0x814),'url':_0x2b1222(0x5fa),'name':'1'},{'id':'frame_ribbon','url':_0x2b1222(0x517),'name':'2'},{'id':_0x2b1222(0x1156),'url':'https://i.postimg.cc/hj4dkrvj/IMG-5578.gif','name':'3'},{'id':_0x2b1222(0xe72),'url':_0x2b1222(0xf9f),'name':'4'},{'id':_0x2b1222(0x525),'url':'https://i.postimg.cc/4y7mGFgJ/IMG-5716.gif','name':'5'},{'id':'frame_6','url':_0x2b1222(0x235),'name':'6'},{'id':_0x2b1222(0x151b),'url':_0x2b1222(0x153f),'name':'7'},{'id':'frame_8','url':_0x2b1222(0x1105),'name':'8'},{'id':'frame_9','url':_0x2b1222(0x129d),'name':'9'},{'id':_0x2b1222(0x110a),'url':'https://i.postimg.cc/wx72fhr2/IMG-5968.gif','name':'10'},{'id':_0x2b1222(0xcea),'url':'https://i.postimg.cc/QdrqdvdY/IMG-5969.gif','name':'11'},{'id':'frame_12','url':'https://i.postimg.cc/0yd0MZ6k/IMG-5971.gif','name':'12'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x1419),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x1379),'name':'14'},{'id':_0x2b1222(0x814),'url':_0x2b1222(0x9e2),'name':'1'},{'id':'frame_ribbon','url':_0x2b1222(0x1196),'name':'2'},{'id':'frame_flower','url':_0x2b1222(0xb7f),'name':'3'},{'id':'frame_tech','url':_0x2b1222(0xedc),'name':'4'},{'id':_0x2b1222(0x525),'url':_0x2b1222(0x9a1),'name':'5'},{'id':'frame_6','url':_0x2b1222(0xd70),'name':'6'},{'id':_0x2b1222(0x151b),'url':'https://i.postimg.cc/qRCtnMms/IMG-6145.gif','name':'7'},{'id':_0x2b1222(0x88b),'url':_0x2b1222(0x10c8),'name':'8'},{'id':_0x2b1222(0xb6d),'url':_0x2b1222(0xdf6),'name':'9'},{'id':'frame_10','url':_0x2b1222(0x5c0),'name':'10'},{'id':_0x2b1222(0xcea),'url':_0x2b1222(0x147d),'name':'11'},{'id':_0x2b1222(0x6f5),'url':_0x2b1222(0xab3),'name':'12'},{'id':'frame_13','url':_0x2b1222(0x12bb),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0xdc6),'name':'14'},{'id':_0x2b1222(0x814),'url':'https://i.postimg.cc/YSRRV8kn/IMG-6297.gif','name':'1'},{'id':_0x2b1222(0x111a),'url':'https://i.postimg.cc/k45sd8gn/IMG-6375.gif','name':'2'},{'id':'frame_flower','url':_0x2b1222(0x55f),'name':'3'},{'id':'frame_tech','url':_0x2b1222(0x13e2),'name':'4'},{'id':'frame_5','url':_0x2b1222(0xb5b),'name':'5'},{'id':_0x2b1222(0x14ea),'url':'https://i.postimg.cc/Pf9g2fSL/IMG-6554.gif','name':'6'},{'id':_0x2b1222(0x151b),'url':_0x2b1222(0x2fe),'name':'7'},{'id':_0x2b1222(0x88b),'url':_0x2b1222(0x6a5),'name':'8'},{'id':'frame_9','url':'https://i.postimg.cc/pLY3WfR8/IMG-6557.gif','name':'9'},{'id':'frame_10','url':'https://i.postimg.cc/65Cmcr7S/IMG-6559.gif','name':'10'},{'id':_0x2b1222(0xcea),'url':_0x2b1222(0x1fa),'name':'11'},{'id':_0x2b1222(0x6f5),'url':_0x2b1222(0x14db),'name':'12'},{'id':_0x2b1222(0x8f6),'url':'https://i.postimg.cc/G3y73Fj2/IMG-6563.gif','name':'13'},{'id':'frame_14','url':_0x2b1222(0x377),'name':'14'},{'id':_0x2b1222(0x814),'url':_0x2b1222(0x556),'name':'1'},{'id':_0x2b1222(0x111a),'url':'https://i.postimg.cc/k5Gs0K47/IMG-6567.gif','name':'2'},{'id':'frame_flower','url':_0x2b1222(0x13ac),'name':'3'},{'id':_0x2b1222(0xe72),'url':_0x2b1222(0x1369),'name':'4'},{'id':_0x2b1222(0x525),'url':'https://i.postimg.cc/J7ZxC11H/IMG-6570.gif','name':'5'},{'id':_0x2b1222(0x14ea),'url':_0x2b1222(0x10d1),'name':'6'},{'id':_0x2b1222(0x151b),'url':'https://i.postimg.cc/YqxxjbLp/IMG-6572.gif','name':'7'},{'id':'frame_8','url':_0x2b1222(0xcc2),'name':'8'},{'id':_0x2b1222(0xb6d),'url':_0x2b1222(0xa86),'name':'9'},{'id':_0x2b1222(0x110a),'url':'https://i.postimg.cc/MZ77rdDy/IMG-6850.gif','name':'10'},{'id':_0x2b1222(0xcea),'url':_0x2b1222(0xc71),'name':'11'},{'id':_0x2b1222(0x6f5),'url':'https://i.postimg.cc/28TsrxRV/IMG-6852.gif','name':'12'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x542),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0xa61),'name':'14'},{'id':_0x2b1222(0x814),'url':'https://i.postimg.cc/d1qsQsbQ/IMG-6855.gif','name':'1'},{'id':_0x2b1222(0x111a),'url':'https://i.postimg.cc/gJNYx9pV/IMG-6856.gif','name':'2'},{'id':_0x2b1222(0x1156),'url':_0x2b1222(0x95f),'name':'3'},{'id':_0x2b1222(0xe72),'url':_0x2b1222(0x1020),'name':'4'},{'id':_0x2b1222(0x525),'url':'https://i.postimg.cc/vBqsQW7X/IMG-6858.gif','name':'5'},{'id':_0x2b1222(0x14ea),'url':_0x2b1222(0xbb4),'name':'6'},{'id':_0x2b1222(0x151b),'url':'https://i.postimg.cc/90sH9Cn7/IMG-6868.gif','name':'7'},{'id':_0x2b1222(0x88b),'url':'https://i.postimg.cc/Y2PHZzCC/IMG-6866.gif','name':'8'},{'id':_0x2b1222(0xb6d),'url':_0x2b1222(0x7ba),'name':'9'},{'id':'frame_10','url':_0x2b1222(0x529),'name':'10'},{'id':'frame_11','url':_0x2b1222(0x977),'name':'11'},{'id':'frame_12','url':'https://i.postimg.cc/Wbr0JSDD/IMG-5316.gif','name':'12'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x6c9),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x51b),'name':'14'},{'id':_0x2b1222(0xcea),'url':_0x2b1222(0x752),'name':'11'},{'id':_0x2b1222(0x6f5),'url':_0x2b1222(0x922),'name':'12'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x173),'name':'13'},{'id':'frame_14','url':'https://i.postimg.cc/sDFhySn3/IMG-6936.gif','name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x842),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x5ec),'name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x723),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x118f),'name':'14'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/RVt6sRzc/IMG-6939.gif','name':'14'},{'id':'frame_13','url':_0x2b1222(0x138f),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x1052),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x12bd),'name':'14'},{'id':_0x2b1222(0x6f5),'url':_0x2b1222(0xcb6),'name':'12'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x15a0),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x1b1),'name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x682),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0xfd1),'name':'14'},{'id':'frame_13','url':_0x2b1222(0x1460),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x253),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x71d),'name':'14'},{'id':'frame_13','url':_0x2b1222(0x117d),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x1588),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0xc94),'name':'14'},{'id':'frame_13','url':_0x2b1222(0x563),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0xa16),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x236),'name':'14'},{'id':'frame_14','url':_0x2b1222(0x41d),'name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0xd64),'name':'13'},{'id':'frame_14','url':_0x2b1222(0x11ab),'name':'14'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/DZrGtrqB/IMG-7008.gif','name':'14'},{'id':_0x2b1222(0x8f6),'url':'https://i.postimg.cc/ZnJNZWHZ/IMG-7009.gif','name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x3c0),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0xe64),'name':'14'},{'id':_0x2b1222(0x8f6),'url':'https://i.postimg.cc/wTTNGs3Q/IMG-7013.gif','name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x3ce),'name':'14'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/rwDr8X1d/IMG-7015.gif','name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x10fd),'name':'14'},{'id':'frame_13','url':_0x2b1222(0x8bf),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x8e5),'name':'14'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/t4ksHGdg/IMG-7020.gif','name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x964),'name':'13'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/wTKyXVT9/IMG-7024.gif','name':'14'},{'id':'frame_14','url':_0x2b1222(0x8f5),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x653),'name':'14'},{'id':_0x2b1222(0x8f6),'url':'https://i.postimg.cc/4yCXW52F/mmexport1751030908335.gif','name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0xb82),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0xbd3),'name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x117f),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0xc22),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x14e2),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0xa85),'name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x4c7),'name':'13'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/vH2X6N1y/mmexport1751032231179.gif','name':'14'},{'id':'frame_14','url':_0x2b1222(0x1ee),'name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0xbc6),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x455),'name':'14'},{'id':'frame_14','url':'https://i.postimg.cc/4NCPsp5d/mmexport1751034427637.gif','name':'14'},{'id':'frame_14','url':'https://i.postimg.cc/CMv02LHm/mmexport1751034842120.gif','name':'14'},{'id':'frame_13','url':'https://i.postimg.cc/rFnSzWGx/mmexport1751035618517.gif','name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x10eb),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x53a),'name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x942),'name':'13'},{'id':'frame_14','url':_0x2b1222(0x8ee),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x132b),'name':'14'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/xjpN4swz/IMG-7240.gif','name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x387),'name':'13'},{'id':'frame_14','url':_0x2b1222(0xcee),'name':'14'},{'id':'frame_14','url':'https://i.postimg.cc/W40f9qtd/IMG-7098.gif','name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x1440),'name':'13'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/cHsTXDVz/IMG-7235.gif','name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x695),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0xcab),'name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0xa34),'name':'13'},{'id':'frame_14','url':_0x2b1222(0x10a2),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0xd7f),'name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x15c6),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x730),'name':'14'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/VkKjzYTK/IMB-f4kk-CT.gif','name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x49f),'name':'14'},{'id':'frame_13','url':'https://i.postimg.cc/9XPwWmwy/IMB-Kf7um-P.gif','name':'13'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/mrFhKBGz/IMB-e-QWBpa.gif','name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x7a8),'name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0xed3),'name':'13'},{'id':'frame_14','url':_0x2b1222(0x14af),'name':'14'},{'id':'frame_14','url':_0x2b1222(0xfc3),'name':'14'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/gkk7s0vD/IMG-6984.gif','name':'14'},{'id':'frame_13','url':'https://i.postimg.cc/0NpZPgYj/IMG-6985.gif','name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x1236),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x6c6),'name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x8fd),'name':'13'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/zvWGPjms/IMG-7090.gif','name':'14'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/YSkqDg8V/IMG-7092.gif','name':'14'},{'id':'frame_14','url':_0x2b1222(0x1481),'name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0xecc),'name':'13'},{'id':'frame_14','url':_0x2b1222(0xa1a),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x14ff),'name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x1044),'name':'13'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0x122d),'name':'14'},{'id':_0x2b1222(0x1218),'url':_0x2b1222(0xf62),'name':'14'},{'id':'frame_14','url':_0x2b1222(0xb99),'name':'14'},{'id':'frame_13','url':'https://i.postimg.cc/hPgyjtyn/IMG-7108.gif','name':'13'},{'id':'frame_14','url':_0x2b1222(0xda7),'name':'14'},{'id':'frame_14','url':_0x2b1222(0xe4a),'name':'14'},{'id':_0x2b1222(0x8f6),'url':_0x2b1222(0x636),'name':'13'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/SNWBTP5S/IMG-7113.gif','name':'14'},{'id':_0x2b1222(0x1218),'url':'https://i.postimg.cc/jCVMQsKH/IMG-7114.gif','name':'14'}];let _0x1ae02e={'chats':{},'activeChatId':null,'globalSettings':{},'apiConfig':{},'userStickers':[],'worldBooks':[],'personaPresets':[],'qzoneSettings':{},'activeAlbumId':null,'cache':{'songs':new Map(),'lyrics':new Map()},'ttsCache':new Map()},_0x4b691c={'isActive':![],'gameMode':null,'chatId':null,'players':[],'currentDay':0x1,'currentPhase':_0x2b1222(0x7e8),'nightActions':{},'gameLog':[],'discussionLog':[],'voteResults':{},'electionInfo':{'candidates':[],'votes':{}},'sheriffId':null,'lastFailedAction':null},_0x8aa6f6=0x0;const _0x33e9c0=0xf;let _0x54afbd=0x0;const _0x57988e=0xa;let _0x6f01c2=[],_0x5419de={'isActive':![],'activeChatId':null,'isPlaying':![],'playlist':[],'currentIndex':-0x1,'playMode':_0x2b1222(0x249),'totalElapsedTime':0x0,'timerId':null,'parsedLyrics':[],'currentLyricIndex':-0x1},_0x4d11d5={'isOpen':![],'activePostId':null,'panelEl':null,'gridEl':null};const _0x43beab=document[_0x2b1222(0x1f4)](_0x2b1222(0x14c3));let _0x13859b=null,_0x50ca2c=![],_0x369c2d=0x0,_0x5b33ce=null,_0x4d2c3e=![],_0x483dbf=_0x2b1222(0x54b),_0xc320bf=new Set(),_0x530c3e=null,_0x206fc4=![],_0x3e528d=null,_0x2a8ade=null,_0x5cbd47=![],_0x3e1778=![],_0x139519=![],_0x121658=![],_0x4f8d6d=[],_0x866b37=null,_0x44c23e=null,_0x5daf45={},_0x3c0c35=null,_0x2123eb=null,_0x2f43ed=null,_0x1dc705=null,_0x16a7cb=null,_0x98fb65=null,_0x4bc9b5=null,_0x126669=[],_0x1f45c5=null,_0x50043d=null,_0x3f6e69=new Set(),_0x743628=null,_0x16630f=null,_0x4b6465=null,_0x44e0a8={'isOpen':![],'photos':[],'currentIndex':-0x1},_0x496f96=0x0,_0x15f518=![],_0x2d5904=new Set(),_0x512c63=null;const _0x5494d0=_0x2b1222(0x9bc),_0x203a38=_0x2b1222(0x104d),_0x54779f=_0x2b1222(0xb6f),_0x22fe34=_0x2b1222(0x10c3);let _0x276d16,_0x3913ad={};const _0x2c09ea='https://www.myinstants.com/media/sounds/notification-sound-2.mp3';let _0x5aea9a={},_0x4705dd={},_0x19f3c8=null;const _0x3db8a1={'qq':_0x2b1222(0x131b),'world-book':_0x2b1222(0x1b6),'wallpaper':'https://i.postimg.cc/T1j03pQr/IMG-6440.jpg','renderer':'https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg','api-settings':_0x2b1222(0x7d6),'font':_0x2b1222(0x4b0),'char-phone':'https://i.postimg.cc/pXj9h20L/IMG-7275.jpg','douban':_0x2b1222(0x650),'preset':_0x2b1222(0x10f6),'tutorial':_0x2b1222(0xda6),'werewolf':'https://i.postimg.cc/k401K5g7/IMG-7304.jpg','x':_0x2b1222(0xa64)},_0x135614={'qq':_0x2b1222(0x131b),'album':_0x2b1222(0x1b6),'browser':_0x2b1222(0xd75),'taobao':_0x2b1222(0x17f),'memo':_0x2b1222(0x142e),'diary':_0x2b1222(0xed4),'amap':'https://i.postimg.cc/Jz2Tz0dw/IMG-7281.jpg','usage':_0x2b1222(0xc19),'music':_0x2b1222(0xa83),'ephone':_0x2b1222(0x1458)};let _0x415712=null;const _0x43460a=/(^https:\/\/i\.postimg\.cc\/.+|^https:\/\/files\.catbox\.moe\/.+|^https?:\/\/sharkpan\.xyz\/.+|^data:image|\.(png|jpg|jpeg|gif|webp)\?.*$|\.(png|jpg|jpeg|gif|webp)$)/i;let _0x3dea4f=0x0,_0xf51190=0x1,_0x3188d8={'hasShown40':![],'hasShown20':![],'hasShown10':![]},_0x5e1fa5;const _0x332cec=document[_0x2b1222(0x219)](_0x2b1222(0x215));_0x332cec['id']=_0x2b1222(0x5f6),document[_0x2b1222(0xda4)]['appendChild'](_0x332cec);const _0x3826f5=document[_0x2b1222(0x1f4)](_0x2b1222(0x124b)),_0x3fa097=document[_0x2b1222(0x1f4)](_0x2b1222(0x12e0)),_0xa8ccb8=document[_0x2b1222(0x1f4)](_0x2b1222(0x70e)),_0x2130f3=document[_0x2b1222(0x1f4)](_0x2b1222(0x9c5)),_0x17253b=document[_0x2b1222(0x1f4)](_0x2b1222(0x1048));let _0x4a5119;function _0x4ce66c(){const _0x56bb1d=_0x2b1222;_0x3826f5[_0x56bb1d(0x159b)]['add'](_0x56bb1d(0xfca));}function _0x3b5fc9(){const _0xd995fd=_0x2b1222;_0x3826f5[_0xd995fd(0x159b)][_0xd995fd(0xa9c)]('visible'),_0x2130f3[_0xd995fd(0x159b)][_0xd995fd(0xa9c)]('btn-danger');if(_0x4a5119)_0x4a5119(null);}function _0x3594f0(_0x41ff2c){const _0x4c63bc=_0x2b1222,_0x5a7860=document['getElementById'](_0x4c63bc(0x369)),_0x2769c5=_0x41ff2c[_0x4c63bc(0x6a8)][_0x4c63bc(0xa12)]||{'vertical':_0x4c63bc(0xe00),'horizontal':_0x4c63bc(0x803),'offset':0xa};_0x5a7860[_0x4c63bc(0x215)][_0x4c63bc(0xe00)]=_0x4c63bc(0x2aa),_0x5a7860['style'][_0x4c63bc(0xb30)]=_0x4c63bc(0x2aa),_0x5a7860[_0x4c63bc(0x215)][_0x4c63bc(0xbe7)]=_0x4c63bc(0x2aa),_0x5a7860[_0x4c63bc(0x215)][_0x4c63bc(0x68d)]=_0x4c63bc(0x2aa),_0x5a7860['style'][_0x4c63bc(0x8c6)]=_0x4c63bc(0x1b5);_0x2769c5[_0x4c63bc(0xc29)]===_0x4c63bc(0xe00)?_0x5a7860['style'][_0x4c63bc(0xe00)]=_0x2769c5['offset']+'px':_0x5a7860['style']['bottom']=_0x2769c5[_0x4c63bc(0x10e8)]+'px';switch(_0x2769c5[_0x4c63bc(0x12e3)]){case'left':_0x5a7860['style']['left']=_0x4c63bc(0x13fa);break;case'right':_0x5a7860[_0x4c63bc(0x215)][_0x4c63bc(0x68d)]=_0x4c63bc(0x13fa);break;case _0x4c63bc(0x803):default:_0x5a7860['style'][_0x4c63bc(0xbe7)]=_0x4c63bc(0x1545),_0x5a7860['style']['transform']=_0x4c63bc(0xc35);break;}}async function _0x211d9f(_0x1f786d){const _0x448be4=_0x2b1222,_0x26d65d=_0x1f786d['target']['files'][0x0];if(!_0x26d65d)return;const _0x1e49c8=await new Promise(_0xa1b135=>{const _0x29dafe=_0x475c,_0x15ecc2=new FileReader();_0x15ecc2[_0x29dafe(0xcbe)]=()=>_0xa1b135(_0x15ecc2[_0x29dafe(0xbc9)]),_0x15ecc2[_0x29dafe(0x21e)](_0x26d65d);});await _0x1460c5('请稍候...',_0x448be4(0xa56));try{const _0x1201cc=await _0x4847c6(_0x1e49c8);if(!_0x1201cc)throw new Error('AI未能成功描述图片。');const _0x33dbf8=_0x1ae02e['chats'][_0x1ae02e['activeChatId']];!_0x33dbf8[_0x448be4(0x6a8)][_0x448be4(0x1276)]&&(_0x33dbf8[_0x448be4(0x6a8)]['groupAvatarLibrary']=[]),_0x33dbf8[_0x448be4(0x6a8)][_0x448be4(0x1276)][_0x448be4(0x1426)]({'name':_0x1201cc,'url':_0x1e49c8}),await _0x3df81a['chats']['put'](_0x33dbf8),_0x279cee(),await _0x1460c5(_0x448be4(0x1d7),_0x448be4(0x17b)+_0x1201cc+'”');}catch(_0x4a7895){console[_0x448be4(0x127d)]('本地群头像上传及识别失败:',_0x4a7895),await _0x1460c5('操作失败','无法为头像命名，请检查（主/副）API配置是否正确并支持Vision。\x0a错误:\x20'+_0x4a7895[_0x448be4(0x11f0)]);}finally{_0x1f786d[_0x448be4(0xb57)][_0x448be4(0x107e)]=null;}}async function _0x5727a7(_0x2a6afe){const _0x4ce2bc=_0x2b1222,_0x38efb6=_0x2a6afe[_0x4ce2bc(0xb57)][_0x4ce2bc(0x8b1)][0x0];if(!_0x38efb6)return;const _0x48cd99=await new Promise(_0x44d8c1=>{const _0x4b5829=_0x4ce2bc,_0x5ed240=new FileReader();_0x5ed240['onload']=()=>_0x44d8c1(_0x5ed240[_0x4b5829(0xbc9)]),_0x5ed240[_0x4b5829(0x21e)](_0x38efb6);});await _0x1460c5(_0x4ce2bc(0x11b7),_0x4ce2bc(0x1256));try{const _0x53199b=await _0x4847c6(_0x48cd99);if(!_0x53199b)throw new Error(_0x4ce2bc(0x144e));const _0x1ecc4b=_0x1ae02e['chats'][_0x1ae02e[_0x4ce2bc(0x588)]];!_0x1ecc4b[_0x4ce2bc(0x6a8)][_0x4ce2bc(0xb77)]&&(_0x1ecc4b['settings']['aiAvatarLibrary']=[]),_0x1ecc4b[_0x4ce2bc(0x6a8)][_0x4ce2bc(0xb77)]['push']({'name':_0x53199b,'url':_0x48cd99}),await _0x3df81a[_0x4ce2bc(0x589)][_0x4ce2bc(0x295)](_0x1ecc4b),_0x278bb7(),await _0x1460c5(_0x4ce2bc(0x1d7),_0x4ce2bc(0xbce)+_0x53199b+'”');}catch(_0x119258){console[_0x4ce2bc(0x127d)]('本地头像上传及识别失败:',_0x119258),await _0x1460c5(_0x4ce2bc(0xc5a),'无法为头像命名，请检查（主/副）API配置是否正确并支持Vision。\x0a错误:\x20'+_0x119258['message']);}finally{_0x2a6afe[_0x4ce2bc(0xb57)][_0x4ce2bc(0x107e)]=null;}}async function _0x4847c6(_0xbbffdb){const _0xf239e7=_0x2b1222,_0x4581cf=_0x1ae02e['apiConfig'][_0xf239e7(0x78a)]&&_0x1ae02e[_0xf239e7(0x226)][_0xf239e7(0x247)]&&_0x1ae02e[_0xf239e7(0x226)]['secondaryModel'],{proxyUrl:_0x92184a,apiKey:_0x398ebb,model:_0x3ff02b}=_0x4581cf?{'proxyUrl':_0x1ae02e['apiConfig']['secondaryProxyUrl'],'apiKey':_0x1ae02e['apiConfig'][_0xf239e7(0x247)],'model':_0x1ae02e[_0xf239e7(0x226)]['secondaryModel']}:_0x1ae02e[_0xf239e7(0x226)];if(!_0x92184a||!_0x398ebb||!_0x3ff02b)throw new Error(_0xf239e7(0xbb5));const _0x4900a7=_0xf239e7(0x7aa);let _0x5042bd=_0x92184a[_0xf239e7(0xe82)](_0xf239e7(0xc38)),_0x3920e1;if(_0x5042bd){const _0x1d0660=_0xbbffdb['match'](/^data:(.*);base64/)[0x1],_0x194979=_0xbbffdb[_0xf239e7(0x23f)](',')[0x1],_0x912fe9={'contents':[{'parts':[{'text':_0x4900a7},{'inline_data':{'mime_type':_0x1d0660,'data':_0x194979}}]}]};_0x3920e1=await fetch(_0x92184a+'/'+_0x3ff02b+_0xf239e7(0x1184)+_0x398ebb,{'method':_0xf239e7(0x12d9),'headers':{'Content-Type':_0xf239e7(0xa90)},'body':JSON[_0xf239e7(0x994)](_0x912fe9)});}else{const _0x54ee9b={'model':_0x3ff02b,'messages':[{'role':'user','content':[{'type':'text','text':_0x4900a7},{'type':_0xf239e7(0x1296),'image_url':{'url':_0xbbffdb}}]}],'max_tokens':0x32};_0x3920e1=await fetch(_0x92184a+_0xf239e7(0x14c2),{'method':_0xf239e7(0x12d9),'headers':{'Content-Type':_0xf239e7(0xa90),'Authorization':_0xf239e7(0xf03)+_0x398ebb},'body':JSON[_0xf239e7(0x994)](_0x54ee9b)});}if(!_0x3920e1['ok']){const _0x1846cb=await _0x3920e1[_0xf239e7(0xb84)]();throw new Error(_0xf239e7(0xaa6)+_0x1846cb[_0xf239e7(0x127d)][_0xf239e7(0x11f0)]);}const _0x305f11=await _0x3920e1['json']();let _0x1867f6=_0x5042bd?getGeminiResponseText(_0x305f11):_0x305f11['choices'][0x0]['message'][_0xf239e7(0x128c)];return _0x1867f6[_0xf239e7(0x4a2)]()[_0xf239e7(0xef0)](/["'“”‘’]/g,'');}async function _0x44799f(_0x210e53){const _0x41c4b8=_0x2b1222;if(!_0x210e53||_0x210e53[_0x41c4b8(0xe83)]){console['warn'](_0x41c4b8(0xb55));return;}const _0x5d1f42=_0x210e53['id'],_0x508486=_0x210e53[_0x41c4b8(0x5d2)],_0x1e9e6f=_0x210e53['originalName'];console[_0x41c4b8(0x57e)](_0x41c4b8(0x35e)+_0x5d1f42+_0x41c4b8(0xbd5));for(const _0x13f067 in _0x1ae02e[_0x41c4b8(0x589)]){const _0x3efe02=_0x1ae02e[_0x41c4b8(0x589)][_0x13f067];if(_0x3efe02[_0x41c4b8(0xe83)]&&_0x3efe02[_0x41c4b8(0x1402)]){const _0x24d333=_0x3efe02[_0x41c4b8(0x1402)][_0x41c4b8(0x13b7)](_0x1eae1a=>_0x1eae1a['id']===_0x5d1f42);if(_0x24d333){let _0x39d54b=![];_0x24d333[_0x41c4b8(0xd69)]!==_0x508486&&(_0x24d333[_0x41c4b8(0xd69)]=_0x508486,_0x39d54b=!![]),_0x24d333[_0x41c4b8(0x96f)]!==_0x1e9e6f&&(_0x24d333['originalName']=_0x1e9e6f,_0x39d54b=!![]),_0x39d54b&&(await _0x3df81a[_0x41c4b8(0x589)][_0x41c4b8(0x295)](_0x3efe02),console[_0x41c4b8(0x57e)](_0x41c4b8(0x501)+_0x3efe02['name']+_0x41c4b8(0x122f)));}}}}async function _0x3901ec(_0x5a3ca4){const _0x1de3cc=_0x2b1222;if(!_0x5a3ca4||_0x5a3ca4[_0x1de3cc(0xe83)]){console[_0x1de3cc(0xb3b)]('syncCharacterAvatarInGroups:\x20传入的不是有效的单聊对象，已跳过同步。');return;}const _0x1302e9=_0x5a3ca4['id'],_0x59a558=_0x5a3ca4[_0x1de3cc(0x6a8)][_0x1de3cc(0xc99)];console[_0x1de3cc(0x57e)](_0x1de3cc(0x35e)+_0x1302e9+'\x20同步所有群聊内的头像...');for(const _0x164e57 of Object[_0x1de3cc(0x753)](_0x1ae02e['chats'])){if(_0x164e57[_0x1de3cc(0xe83)]&&_0x164e57['members']){const _0x74eff2=_0x164e57[_0x1de3cc(0x1402)][_0x1de3cc(0x13b7)](_0x432b37=>_0x432b37['id']===_0x1302e9);_0x74eff2&&_0x74eff2[_0x1de3cc(0x95b)]!==_0x59a558&&(_0x74eff2[_0x1de3cc(0x95b)]=_0x59a558,await _0x3df81a[_0x1de3cc(0x589)][_0x1de3cc(0x295)](_0x164e57),console['log'](_0x1de3cc(0x144b)+_0x1302e9+_0x1de3cc(0x4ac)+_0x164e57[_0x1de3cc(0x5d2)]+'\x22'));}}}function _0x140540(_0x13d670,_0xbed548){const _0x4c9633=_0x2b1222;if(!_0x13d670||!_0x13d670[_0x4c9633(0xe83)]||!_0xbed548)return _0xbed548;const _0x18e89e=_0x1ae02e['qzoneSettings'][_0x4c9633(0xb46)]||'{{user}}';if(_0xbed548===_0x18e89e)return _0x13d670[_0x4c9633(0x6a8)][_0x4c9633(0xe31)]||'我';const _0x4c67d3=_0x13d670['members'][_0x4c9633(0x13b7)](_0x135a51=>_0x135a51[_0x4c9633(0x96f)]===_0xbed548);return _0x4c67d3?_0x4c67d3[_0x4c9633(0xd69)]:_0xbed548;}function _0x576cd2(_0x4bf20a){const _0x40a4c7=_0x2b1222;document[_0x40a4c7(0x14bf)](_0x40a4c7(0x228))['forEach'](_0x4aeeb9=>{const _0x3ffa95=_0x40a4c7;_0x4aeeb9[_0x3ffa95(0x159b)][_0x3ffa95(0x1483)](_0x3ffa95(0x7cf),_0x4aeeb9[_0x3ffa95(0x746)][_0x3ffa95(0x1467)]===_0x4bf20a);}),document['querySelectorAll'](_0x40a4c7(0xdcd))[_0x40a4c7(0x59b)](_0x3a3d02=>{const _0x11efe6=_0x40a4c7;_0x3a3d02[_0x11efe6(0x159b)][_0x11efe6(0x1483)](_0x11efe6(0x7cf),_0x3a3d02[_0x11efe6(0x746)]['categoryId']===_0x4bf20a);});}function _0x34f6a8(_0x480d7b){const _0x33b75f=_0x2b1222;if(!_0x480d7b)return'';if(_0x1ae02e[_0x33b75f(0x11ef)]&&_0x480d7b===_0x1ae02e['qzoneSettings'][_0x33b75f(0xb46)])return _0x1ae02e[_0x33b75f(0x11ef)][_0x33b75f(0xb46)];let _0x18604d=Object[_0x33b75f(0x753)](_0x1ae02e[_0x33b75f(0x589)])[_0x33b75f(0x13b7)](_0x120114=>!_0x120114[_0x33b75f(0xe83)]&&_0x120114[_0x33b75f(0x96f)]===_0x480d7b);if(_0x18604d)return _0x18604d['name'];_0x18604d=Object[_0x33b75f(0x753)](_0x1ae02e[_0x33b75f(0x589)])[_0x33b75f(0x13b7)](_0xbf6f2a=>!_0xbf6f2a[_0x33b75f(0xe83)]&&(_0xbf6f2a[_0x33b75f(0x1515)]&&_0xbf6f2a[_0x33b75f(0x1515)]['includes'](_0x480d7b)));if(_0x18604d)return _0x18604d['name'];return _0x480d7b;}function _0x5ed2b0(_0x4aca90,_0x1758ae=null){const _0x36d60a=_0x2b1222;if(!_0x4aca90||typeof _0x4aca90!=='string'||!_0x4aca90['includes'](_0x36d60a(0x6ac)))return _0x4aca90;return _0x4aca90[_0x36d60a(0xef0)](/@\[\[([^\]]+)\]\]/g,(_0x128073,_0x27e269)=>{const _0x499b78=_0x36d60a,_0x12e7d0=_0x27e269[_0x499b78(0x4a2)]();let _0x21361e;return _0x1758ae&&_0x1758ae[_0x499b78(0xe83)]?_0x21361e=_0x140540(_0x1758ae,_0x12e7d0):_0x21361e=_0x34f6a8(_0x12e7d0),'@'+_0x21361e;});}function _0x109970(_0xf6d078,_0x39bcd9,_0x2c2ad1={}){return new Promise(_0x312f5a=>{const _0x505368=_0x475c;_0x4a5119=_0x312f5a,_0x3fa097[_0x505368(0x231)]=_0xf6d078,_0xa8ccb8[_0x505368(0xf21)]=_0x505368(0x104b)+_0x39bcd9+_0x505368(0x1517);const _0x5a5303=document[_0x505368(0x1f4)](_0x505368(0x9c5)),_0xece745=document['getElementById'](_0x505368(0x1048));_0xece745[_0x505368(0x215)][_0x505368(0x887)]=_0x505368(0x361),_0x5a5303[_0x505368(0x231)]=_0x2c2ad1[_0x505368(0x1d1)]||'确定',_0xece745[_0x505368(0x231)]=_0x2c2ad1[_0x505368(0xb53)]||'取消',_0x2c2ad1['confirmButtonClass']?_0x5a5303[_0x505368(0x159b)]['add'](_0x2c2ad1[_0x505368(0x859)]):_0x5a5303[_0x505368(0x159b)][_0x505368(0xa9c)](_0x505368(0x1c6)),_0x5a5303[_0x505368(0x1199)]=()=>{_0x312f5a(!![]),_0x3b5fc9();},_0xece745[_0x505368(0x1199)]=()=>{_0x312f5a(![]),_0x3b5fc9();},_0x4ce66c();});}function _0x3da3bf(_0x2d2813=_0x2b1222(0xb59),_0x14accb=_0x2b1222(0xf76)){const _0x1e9786=_0x2b1222,_0x233990=document[_0x1e9786(0x219)](_0x1e9786(0xaf9));_0x233990[_0x1e9786(0x231)]=_0x2d2813,_0x233990['style']['cssText']=_0x1e9786(0xfc5)+(_0x14accb===_0x1e9786(0xf76)?_0x1e9786(0xfbe):'#f44336')+_0x1e9786(0xd0f),document[_0x1e9786(0x8b9)][_0x1e9786(0x6ce)](_0x233990),setTimeout(()=>{const _0x164da9=_0x1e9786;_0x233990[_0x164da9(0x215)][_0x164da9(0x38d)]='1',_0x233990['style']['transform']=_0x164da9(0x150c);},0xa),setTimeout(()=>{const _0x240a65=_0x1e9786;_0x233990['style']['opacity']='0',_0x233990[_0x240a65(0x215)]['transform']=_0x240a65(0xefb),setTimeout(()=>{_0x233990['remove']();},0x12c);},0x7d0);}function _0x42b280(_0x9f7cc3){const _0x244f80=_0x2b1222;let _0x57ce20=(_0x9f7cc3||'NAI_Image')[_0x244f80(0xef0)](/[^a-zA-Z0-9\u4e00-\u9fa5\s]/g,'_')[_0x244f80(0xef0)](/\s+/g,'_')[_0x244f80(0x516)](0x0,0x1e);const _0x1e08c2=new Date()[_0x244f80(0xc66)]()[_0x244f80(0xef0)](/[-:]/g,'')[_0x244f80(0xef0)]('T','_')[_0x244f80(0x23f)]('.')[0x0];return _0x57ce20+'_'+_0x1e08c2+'.png';}function _0x1aae1e(_0x28c772,_0x5912b9){const _0x52efc2=_0x2b1222;try{const _0x1e660e=_0x42b280(_0x5912b9),_0x15f12d=document[_0x52efc2(0x219)]('a');_0x15f12d[_0x52efc2(0x4c6)]=_0x28c772,_0x15f12d[_0x52efc2(0x1060)]=_0x1e660e,_0x15f12d[_0x52efc2(0x215)][_0x52efc2(0x887)]=_0x52efc2(0x1b5),document[_0x52efc2(0x8b9)][_0x52efc2(0x6ce)](_0x15f12d),_0x15f12d[_0x52efc2(0x740)](),setTimeout(()=>{const _0x19fc81=_0x52efc2;document[_0x19fc81(0x8b9)][_0x19fc81(0xdb3)](_0x15f12d);},0x64),_0x3da3bf('📥\x20图片下载中...');}catch(_0x5872bc){console[_0x52efc2(0x127d)](_0x52efc2(0xbc8),_0x5872bc),_0x3da3bf(_0x52efc2(0x3ab),_0x52efc2(0x127d));}}function _0x1460c5(_0x506e32,_0x48a951){return new Promise(_0x392e44=>{const _0x1a3fd7=_0x475c;_0x4a5119=_0x392e44,_0x3fa097[_0x1a3fd7(0x231)]=_0x506e32,_0xa8ccb8[_0x1a3fd7(0xf21)]=_0x1a3fd7(0x1173)+_0x48a951+_0x1a3fd7(0x1517);const _0x5199ca=document[_0x1a3fd7(0x1f4)](_0x1a3fd7(0x9c5)),_0x209606=document['getElementById'](_0x1a3fd7(0x1048));_0x209606['style']['display']=_0x1a3fd7(0x1b5),_0x5199ca[_0x1a3fd7(0x231)]='好的',_0x5199ca[_0x1a3fd7(0x1199)]=()=>{const _0x335b77=_0x1a3fd7;_0x209606[_0x335b77(0x215)][_0x335b77(0x887)]='block',_0x5199ca[_0x335b77(0x231)]='确定',_0x392e44(!![]),_0x3b5fc9();},_0x4ce66c();});}async function _0x1b02e6(_0x2f0e44,_0x258f0e='内容已复制到剪贴板！'){const _0x4ba0e5=_0x2b1222;if(!_0x2f0e44){await _0x1460c5('复制失败',_0x4ba0e5(0x137c));return;}try{await navigator['clipboard'][_0x4ba0e5(0x514)](_0x2f0e44),await _0x1460c5(_0x4ba0e5(0x672),_0x258f0e);}catch(_0x16b403){console[_0x4ba0e5(0x127d)](_0x4ba0e5(0x786),_0x16b403),await _0x1460c5(_0x4ba0e5(0x756),_0x4ba0e5(0x1088));}}function _0x11f6fb(_0x1bfa66,_0x1bd756,_0x27ecf3='',_0x3d3667=_0x2b1222(0x40f),_0xd36505=''){return new Promise(_0x14a94e=>{const _0x47f97b=_0x475c;_0x4a5119=_0x14a94e,_0x3fa097[_0x47f97b(0x231)]=_0x1bfa66;const _0x56b801='custom-prompt-input',_0x3f865a=_0x3d3667===_0x47f97b(0x1097)?'<textarea\x20id=\x22'+_0x56b801+'\x22\x20placeholder=\x22'+_0x1bd756+_0x47f97b(0x4a3)+_0x27ecf3+_0x47f97b(0x90e):'<input\x20type=\x22'+_0x3d3667+_0x47f97b(0x149f)+_0x56b801+'\x22\x20placeholder=\x22'+_0x1bd756+_0x47f97b(0x368)+_0x27ecf3+'\x22>';_0xa8ccb8[_0x47f97b(0xf21)]=_0xd36505+_0x3f865a;const _0x2896e4=document[_0x47f97b(0x1f4)](_0x56b801);_0xa8ccb8['querySelectorAll'](_0x47f97b(0x10a8))[_0x47f97b(0x59b)](_0x4e892d=>{const _0x3d8e91=_0x47f97b;_0x4e892d[_0x3d8e91(0x122b)](_0x3d8e91(0x740),()=>{const _0xc3a1a=_0x3d8e91,_0x54bb87=_0x4e892d[_0xc3a1a(0x746)][_0xc3a1a(0x1532)];if(_0x54bb87)try{const _0x111c5c=JSON['parse'](_0x54bb87);_0x2896e4[_0xc3a1a(0x107e)]=JSON[_0xc3a1a(0x994)](_0x111c5c,null,0x2),_0x2896e4['focus']();}catch(_0x34944a){console[_0xc3a1a(0x127d)]('解析格式模板失败:',_0x34944a);}});});const _0x4e6a59=document['getElementById'](_0x47f97b(0x9c5)),_0x4d9310=document[_0x47f97b(0x1f4)](_0x47f97b(0x1048));_0x4e6a59['onclick']=()=>{_0x14a94e(_0x2896e4['value']),_0x3b5fc9();},_0x4d9310[_0x47f97b(0x1199)]=()=>{_0x14a94e(null),_0x3b5fc9();},_0x4ce66c(),setTimeout(()=>_0x2896e4['focus'](),0x64);});}function _0x12414d(_0x478177,_0x5a2073){const _0x212ddf=_0x2b1222;return new Promise(_0x38af14=>{const _0x27741b=_0x475c,_0x3d8f09=document[_0x27741b(0x1f4)](_0x27741b(0x124b)),_0x5aa609=document[_0x27741b(0x1f4)](_0x27741b(0x12e0)),_0x3ee3f3=document['getElementById'](_0x27741b(0x70e)),_0xc270de=document[_0x27741b(0xeda)](_0x27741b(0x7fa));_0x5aa609[_0x27741b(0x231)]=_0x478177,_0x3ee3f3[_0x27741b(0xf21)]='',_0xc270de['innerHTML']='',_0xc270de['style']['flexDirection']=_0x27741b(0x1301),_0x5a2073['forEach'](_0x3ad162=>{const _0x14b2a2=_0x27741b,_0x1cb0da=document[_0x14b2a2(0x219)]('button');_0x1cb0da['textContent']=_0x3ad162['text'],_0x1cb0da['onclick']=()=>{const _0x591f05=_0x14b2a2;_0x3d8f09[_0x591f05(0x159b)][_0x591f05(0xa9c)](_0x591f05(0xfca)),_0x38af14(_0x3ad162['value']);},_0xc270de['appendChild'](_0x1cb0da);});const _0x19cfeb=document[_0x27741b(0x219)](_0x27741b(0xd2d));_0x19cfeb[_0x27741b(0x231)]='取消',_0x19cfeb[_0x27741b(0x215)][_0x27741b(0x657)]=_0x27741b(0x1450),_0x19cfeb[_0x27741b(0x215)][_0x27741b(0x31e)]=_0x27741b(0x1450),_0x19cfeb['style']['backgroundColor']='#f0f0f0',_0x19cfeb[_0x27741b(0x1199)]=()=>{const _0x27fc68=_0x27741b;_0x3d8f09[_0x27fc68(0x159b)][_0x27fc68(0xa9c)](_0x27fc68(0xfca)),_0x38af14(null);},_0xc270de[_0x27741b(0x6ce)](_0x19cfeb),_0x3d8f09[_0x27741b(0x159b)]['add']('visible');})[_0x212ddf(0x8aa)](()=>{const _0x11cbc9=_0x212ddf,_0x5debb2=document[_0x11cbc9(0xeda)](_0x11cbc9(0x7fa));_0x5debb2['style'][_0x11cbc9(0x676)]=_0x11cbc9(0x476),_0x5debb2[_0x11cbc9(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22custom-modal-cancel\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22custom-modal-confirm\x22\x20class=\x22confirm-btn\x22>确定</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document[_0x11cbc9(0x1f4)](_0x11cbc9(0x1048))[_0x11cbc9(0x122b)](_0x11cbc9(0x740),_0x3b5fc9);});}async function _0x2824c2(){const _0x5a5759=_0x2b1222,_0x29628f=await _0x12414d('选择歌词导入方式',[{'text':_0x5a5759(0x122c),'value':_0x5a5759(0x5aa)},{'text':_0x5a5759(0x8ae),'value':_0x5a5759(0x10f9)}]);if(_0x29628f===_0x5a5759(0x5aa))return new Promise(_0x715c72=>{const _0x2319f8=_0x5a5759,_0x2df8ba=document['getElementById'](_0x2319f8(0xce1)),_0x41fc87=_0x44a2e7=>{const _0x3de23b=_0x2319f8,_0x2ebd5a=_0x44a2e7[_0x3de23b(0xb57)][_0x3de23b(0x8b1)][0x0];if(_0x2ebd5a){const _0x5b6a17=new FileReader();_0x5b6a17[_0x3de23b(0xcbe)]=_0x279f7b=>_0x715c72(_0x279f7b[_0x3de23b(0xb57)][_0x3de23b(0xbc9)]),_0x5b6a17[_0x3de23b(0xdf5)]=()=>_0x715c72(''),_0x5b6a17[_0x3de23b(0x1263)](_0x2ebd5a);}else _0x715c72(null);_0x2df8ba[_0x3de23b(0x7f6)](_0x3de23b(0x1147),_0x41fc87),_0x2df8ba[_0x3de23b(0x107e)]='';};_0x2df8ba[_0x2319f8(0x122b)](_0x2319f8(0x1147),_0x41fc87,{'once':!![]}),_0x2df8ba['click']();});else{if(_0x29628f===_0x5a5759(0x10f9)){const _0x317373=await _0x11f6fb(_0x5a5759(0x6fb),'请在此处粘贴完整的LRC格式歌词...','',_0x5a5759(0x1097));if(_0x317373){const _0x34dac8=_0x317373[_0x5a5759(0xef0)](/\[/g,'\x0a[')['trim']();return _0x34dac8;}return _0x317373;}else return null;}}_0x3df81a[_0x2b1222(0x9dd)](0x28)['stores']({'doubanPosts':'++id,\x20timestamp','chats':_0x2b1222(0x6ef),'apiConfig':_0x2b1222(0x15ac),'globalSettings':_0x2b1222(0xc58),'userStickers':_0x2b1222(0x227),'worldBooks':_0x2b1222(0x12ac),'worldBookCategories':_0x2b1222(0xbd0),'musicLibrary':'&id','personaPresets':'&id','qzoneSettings':_0x2b1222(0xc58),'qzonePosts':_0x2b1222(0x74f),'qzoneAlbums':_0x2b1222(0x1213),'qzonePhotos':_0x2b1222(0xee3),'favorites':_0x2b1222(0xc9f),'qzoneGroups':_0x2b1222(0xbd0),'memories':_0x2b1222(0x119b),'callRecords':_0x2b1222(0x548),'shoppingProducts':'++id,\x20name,\x20description','shoppingCategories':_0x2b1222(0xbd0),'apiPresets':_0x2b1222(0xbd0),'renderingRules':_0x2b1222(0xbe6),'appearancePresets':_0x2b1222(0x10b9),'stickerCategories':_0x2b1222(0xbd0),'customAvatarFrames':'++id,\x20name','presets':'&id,\x20name,\x20categoryId','presetCategories':_0x2b1222(0xbd0),'readingLibrary':_0x2b1222(0xeed),'npcs':'++id,\x20name,\x20npcGroupId,\x20enableBackgroundActivity,\x20actionCooldownMinutes,\x20lastActionTimestamp','npcGroups':_0x2b1222(0xbd0)})[_0x2b1222(0x11a9)](_0xe8fe1b=>{const _0x36980d=_0x2b1222;return _0xe8fe1b[_0x36980d(0x12b7)]('worldBooks')[_0x36980d(0x482)]()[_0x36980d(0x1064)](_0x4f1118=>{const _0x27c5b1=_0x36980d;if(typeof _0x4f1118[_0x27c5b1(0x128c)]==='string'&&_0x4f1118[_0x27c5b1(0x128c)][_0x27c5b1(0x4a2)]()!=='')_0x4f1118[_0x27c5b1(0x128c)]=[{'keys':[],'comment':_0x27c5b1(0x912),'content':_0x4f1118[_0x27c5b1(0x128c)]}];else!Array[_0x27c5b1(0x121f)](_0x4f1118['content'])&&(_0x4f1118[_0x27c5b1(0x128c)]=[]);_0x4f1118[_0x27c5b1(0x128c)]['forEach'](_0x1acf1a=>{typeof _0x1acf1a['enabled']==='undefined'&&(_0x1acf1a['enabled']=!![]);});});}),window['db']=_0x3df81a;function _0x2e53fa(_0xb1a58d){const _0x3c260a=_0x2b1222;_0xb1a58d===_0x3c260a(0x133d)&&(window[_0x3c260a(0x10cb)](),_0x407a4b(_0x3c260a(0xeb0)));if(_0xb1a58d===_0x3c260a(0x15a3))window[_0x3c260a(0x14cf)]();if(_0xb1a58d==='wallpaper-screen')window[_0x3c260a(0x8b5)]();if(_0xb1a58d===_0x3c260a(0xcc0))window[_0x3c260a(0x25f)]();if(_0xb1a58d===_0x3c260a(0x1131))window['renderXSocialScreenProxy']();if(_0xb1a58d===_0x3c260a(0x357))_0x5591b9();document[_0x3c260a(0x14bf)]('.screen')[_0x3c260a(0x59b)](_0x28814a=>_0x28814a[_0x3c260a(0x159b)][_0x3c260a(0xa9c)](_0x3c260a(0x7cf)));const _0x1633d7=document[_0x3c260a(0x1f4)](_0xb1a58d);if(_0x1633d7)_0x1633d7[_0x3c260a(0x159b)]['add'](_0x3c260a(0x7cf));if(_0xb1a58d===_0x3c260a(0x13c3))window[_0x3c260a(0x824)](_0x1ae02e['activeChatId']);_0xb1a58d===_0x3c260a(0x990)&&(_0x406faf(),document[_0x3c260a(0x1f4)]('font-url-input')[_0x3c260a(0x107e)]=_0x1ae02e[_0x3c260a(0x12c0)][_0x3c260a(0xa4e)]||'',_0x143b61(_0x1ae02e['globalSettings'][_0x3c260a(0xa4e)]||'',!![]));}window['updateListenTogetherIconProxy']=()=>{};function _0x407a4b(_0x39cea1){const _0x37cebb=_0x2b1222,_0x1df6dc=document[_0x37cebb(0x1f4)](_0x37cebb(0x133d)),_0x55b67c={'messages-view':document['getElementById'](_0x37cebb(0xeb0)),'qzone-screen':document['getElementById']('qzone-screen'),'favorites-view':document[_0x37cebb(0x1f4)](_0x37cebb(0x128f)),'memories-view':document[_0x37cebb(0x1f4)](_0x37cebb(0xa0e)),'npc-list-view':document[_0x37cebb(0x1f4)](_0x37cebb(0xd0c))},_0x511427=document[_0x37cebb(0x1f4)](_0x37cebb(0xdb9)),_0x2189cf=document[_0x37cebb(0x1f4)](_0x37cebb(0x405));_0x15f518&&document['getElementById']('favorites-edit-btn')['click']();Object[_0x37cebb(0x753)](_0x55b67c)['forEach'](_0x63aba=>_0x63aba[_0x37cebb(0x159b)]['remove'](_0x37cebb(0x7cf)));_0x55b67c[_0x39cea1]&&_0x55b67c[_0x39cea1][_0x37cebb(0x159b)][_0x37cebb(0x6a4)]('active');document[_0x37cebb(0x14bf)](_0x37cebb(0x3ea))[_0x37cebb(0x59b)](_0x337dba=>{const _0x5b37d5=_0x37cebb;_0x337dba['classList'][_0x5b37d5(0x1483)](_0x5b37d5(0x7cf),_0x337dba[_0x5b37d5(0x746)]['view']===_0x39cea1);});_0x39cea1==='messages-view'?(_0x511427[_0x37cebb(0x215)][_0x37cebb(0x887)]=_0x37cebb(0xeba),_0x2189cf['style'][_0x37cebb(0x887)]=_0x37cebb(0xeba)):(_0x511427[_0x37cebb(0x215)][_0x37cebb(0x887)]=_0x37cebb(0x1b5),_0x2189cf['style'][_0x37cebb(0x887)]=_0x37cebb(0x1b5));_0x39cea1!=='memories-view'&&(_0x31cfb5[_0x37cebb(0x59b)](_0x284aa1=>clearInterval(_0x284aa1)),_0x31cfb5=[]);switch(_0x39cea1){case'qzone-screen':_0x55b67c['qzone-screen']['style'][_0x37cebb(0x11e7)]=_0x37cebb(0xa9d),_0xfc0942(0x0),_0x21d0f5(),_0x28d6f7();break;case _0x37cebb(0x128f):_0x55b67c[_0x37cebb(0x128f)][_0x37cebb(0x215)][_0x37cebb(0x11e7)]=_0x37cebb(0x632),_0x2e35bf();break;case _0x37cebb(0xeb0):break;case _0x37cebb(0xd0c):_0x1929e1();break;}}function _0x3921be(){const _0x24922a=_0x2b1222;console[_0x24922a(0x57e)](_0x24922a(0x5b2));}window[_0x2b1222(0x545)]=_0x3921be;function _0x21d0f5(){const _0x3f963c=_0x2b1222;if(_0x1ae02e&&_0x1ae02e[_0x3f963c(0x11ef)]){const _0xae7155=_0x1ae02e[_0x3f963c(0x11ef)];document[_0x3f963c(0x1f4)](_0x3f963c(0x4b3))['textContent']=_0xae7155[_0x3f963c(0xb46)],document[_0x3f963c(0x1f4)]('qzone-avatar-img')[_0x3f963c(0x9fe)]=_0xae7155[_0x3f963c(0x95b)],document[_0x3f963c(0x1f4)](_0x3f963c(0x14b9))['src']=_0xae7155[_0x3f963c(0xdd5)];}}window[_0x2b1222(0xbf6)]=_0x21d0f5;async function _0x2aaac5(){const _0x1c4ea1=_0x2b1222;_0x3df81a&&_0x1ae02e[_0x1c4ea1(0x11ef)]&&await _0x3df81a['qzoneSettings'][_0x1c4ea1(0x295)](_0x1ae02e[_0x1c4ea1(0x11ef)]);}function _0x473c85(_0x4b82be){const _0xd0cc59=_0x2b1222;if(!_0x4b82be)return'';const _0x15cdac=new Date(),_0x163e90=new Date(_0x4b82be),_0x40fab3=Math['floor']((_0x15cdac-_0x163e90)/0x3e8),_0x25fb47=Math['floor'](_0x40fab3/0x3c),_0x425af7=Math['floor'](_0x25fb47/0x3c);if(_0x25fb47<0x1)return'刚刚';if(_0x25fb47<0x3c)return _0x25fb47+_0xd0cc59(0xe17);if(_0x425af7<0x18)return _0x425af7+'小时前';const _0x44f3d6=_0x163e90['getFullYear'](),_0x1dd936=String(_0x163e90[_0xd0cc59(0x45d)]()+0x1)[_0xd0cc59(0x1189)](0x2,'0'),_0xac23af=String(_0x163e90['getDate']())[_0xd0cc59(0x1189)](0x2,'0'),_0x2b082f=String(_0x163e90[_0xd0cc59(0x4ee)]())[_0xd0cc59(0x1189)](0x2,'0'),_0x277fcf=String(_0x163e90[_0xd0cc59(0x1465)]())[_0xd0cc59(0x1189)](0x2,'0');return _0x15cdac['getFullYear']()===_0x44f3d6?_0x1dd936+'-'+_0xac23af+'\x20'+_0x2b082f+':'+_0x277fcf:_0x44f3d6+'-'+_0x1dd936+'-'+_0xac23af+'\x20'+_0x2b082f+':'+_0x277fcf;}function _0x226cc6(_0x12d29e){const _0x4c6295=_0x2b1222,_0x5e354b=document[_0x4c6295(0xeda)]('.qzone-post-container[data-post-id=\x22'+_0x12d29e['id']+'\x22]'),_0x3c1f46=!!_0x5e354b,_0x1a9b15=_0x3c1f46?_0x5e354b:document[_0x4c6295(0x219)](_0x4c6295(0xaf9));!_0x3c1f46&&(_0x1a9b15[_0x4c6295(0x7c6)]=_0x4c6295(0x14d9),_0x1a9b15[_0x4c6295(0x746)][_0x4c6295(0xd8f)]=_0x12d29e['id']);const _0x1816af=_0x3c1f46?_0x1a9b15[_0x4c6295(0xeda)](_0x4c6295(0xe84)):document['createElement'](_0x4c6295(0xaf9));!_0x3c1f46&&(_0x1816af[_0x4c6295(0x7c6)]=_0x4c6295(0x3ef));let _0x571b2a='',_0x3bd483='',_0x1a8ec9=_0x1ae02e[_0x4c6295(0x11ef)][_0x4c6295(0x95b)];if(_0x12d29e[_0x4c6295(0x12cf)]===_0x4c6295(0x860))_0x571b2a=_0x1ae02e[_0x4c6295(0x11ef)][_0x4c6295(0x95b)],_0x3bd483=_0x1ae02e['qzoneSettings'][_0x4c6295(0xb46)];else{if(_0x1ae02e[_0x4c6295(0x589)][_0x12d29e[_0x4c6295(0x12cf)]]){const _0x6fa02=_0x1ae02e[_0x4c6295(0x589)][_0x12d29e[_0x4c6295(0x12cf)]];_0x571b2a=_0x6fa02[_0x4c6295(0x6a8)]['aiAvatar']||_0x5494d0,_0x3bd483=_0x6fa02[_0x4c6295(0x5d2)];}else _0x3bd483=_0x34f6a8(_0x12d29e['authorOriginalName']),_0x571b2a=_0x5494d0;}function _0x179f11(_0x3e8bb7){const _0x113065=_0x4c6295;let _0x5e138a='';const _0x17350b=_0x3e8bb7[_0x113065(0xf1f)]?_0x113065(0x1523)+_0x1ec77d(_0x3e8bb7['publicText'])[_0x113065(0xef0)](/\n/g,_0x113065(0xc9b))+_0x113065(0x149b):'';if(_0x3e8bb7['type']===_0x113065(0x30e))_0x5e138a=_0x113065(0x109f)+_0x1ec77d(_0x3e8bb7['content'])[_0x113065(0xef0)](/\n/g,_0x113065(0xc9b))+_0x113065(0x149b);else{if(_0x3e8bb7['type']===_0x113065(0x7e5)&&_0x3e8bb7['imageUrl'])_0x5e138a=_0x17350b?_0x17350b+_0x113065(0xeee)+_0x3e8bb7[_0x113065(0x48d)]+_0x113065(0xcba):'<img\x20src=\x22'+_0x3e8bb7[_0x113065(0x48d)]+_0x113065(0x8b7);else{if(_0x3e8bb7[_0x113065(0xcbd)]==='text_image'){const _0x174f16=_0x1ae02e[_0x113065(0x12c0)][_0x113065(0x7d1)]&&_0x3e8bb7[_0x113065(0x1248)]?_0x113065(0xe8f)+_0x3e8bb7[_0x113065(0x1248)]:_0x113065(0xe1f);_0x5e138a=_0x17350b?_0x17350b+_0x113065(0xeee)+_0x174f16+'\x22\x20class=\x22chat-image\x22\x20style=\x22cursor:\x20pointer;\x22\x20data-hidden-text=\x22'+_0x3e8bb7['hiddenContent']+_0x113065(0x23c):_0x113065(0xe40)+_0x174f16+_0x113065(0xd89)+_0x3e8bb7[_0x113065(0x1090)]+'\x22>';}else{if(_0x3e8bb7[_0x113065(0xcbd)]===_0x113065(0x132a)){const _0x5e2828=_0x3e8bb7[_0x113065(0x1583)]||(_0x3e8bb7[_0x113065(0x48d)]?[_0x3e8bb7[_0x113065(0x48d)]]:[]);if(_0x5e2828['length']>0x0){const _0x491edc=_0x5e2828[_0x113065(0x58a)];let _0x43727e='';_0x43727e=_0x113065(0x107b)+_0x491edc+'\x22>',_0x5e2828['forEach']((_0x471033,_0x2c4828)=>{const _0x5dbf20=_0x113065;_0x43727e+=_0x5dbf20(0xe40)+_0x471033+'\x22\x20class=\x22naiimag-image\x22\x20alt=\x22图片'+(_0x2c4828+0x1)+'\x22\x20loading=\x22lazy\x22\x20onerror=\x22this.src=\x27https://i.postimg.cc/KYr2qRCK/1.jpg\x27;\x20this.alt=\x27图片加载失败\x27;\x22>';}),_0x43727e+=_0x113065(0x149b),_0x5e138a=_0x17350b?''+_0x17350b+_0x43727e:_0x43727e;}}}}}return _0x5e138a;}let _0x264dcd;if(_0x12d29e[_0x4c6295(0xcbd)]==='repost'){const _0x6b6e1f=_0x12d29e[_0x4c6295(0x1223)]?_0x4c6295(0x1523)+_0x1ec77d(_0x12d29e[_0x4c6295(0x1223)])['replace'](/\n/g,_0x4c6295(0xc9b))+_0x4c6295(0x149b):'';let _0x29b6ee=_0x5494d0,_0x45c4cb='原作者';if(_0x12d29e[_0x4c6295(0x305)][_0x4c6295(0x12cf)]==='user')_0x29b6ee=_0x1ae02e['qzoneSettings'][_0x4c6295(0x95b)],_0x45c4cb=_0x1ae02e[_0x4c6295(0x11ef)][_0x4c6295(0xb46)];else{const _0x2bd1b5=_0x1ae02e['chats'][_0x12d29e[_0x4c6295(0x305)][_0x4c6295(0x12cf)]];_0x2bd1b5&&(_0x29b6ee=_0x2bd1b5[_0x4c6295(0x6a8)][_0x4c6295(0xc99)]||_0x5494d0),_0x45c4cb=_0x34f6a8(_0x12d29e['originalPost'][_0x4c6295(0x24c)]);}_0x264dcd=_0x4c6295(0x1375)+_0x6b6e1f+_0x4c6295(0x1553)+_0x29b6ee+'\x22\x20class=\x22post-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22post-nickname\x22>@'+_0x45c4cb+_0x4c6295(0x2ed)+_0x473c85(_0x12d29e[_0x4c6295(0x305)][_0x4c6295(0x1388)])+_0x4c6295(0x198)+_0x179f11(_0x12d29e[_0x4c6295(0x305)])+_0x4c6295(0xa0f);}else _0x264dcd=_0x4c6295(0x12a3)+_0x179f11(_0x12d29e)+_0x4c6295(0x149b);let _0x458c90='';if(_0x12d29e[_0x4c6295(0xb09)]&&_0x12d29e[_0x4c6295(0xb09)][_0x4c6295(0x58a)]>0x0){const _0x3dd1e6=_0x12d29e[_0x4c6295(0xb09)][_0x4c6295(0x1431)](_0x1d913f=>_0x34f6a8(_0x1d913f))[_0x4c6295(0x1143)]('、');_0x458c90='<div\x20class=\x22post-likes-section\x22><svg\x20class=\x22like-icon\x22\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M20.84\x204.61a5.5\x205.5\x200\x200\x200-7.78\x200L12\x205.67l-1.06-1.06a5.5\x205.5\x200\x200\x200-7.78\x207.78l1.06\x201.06L12\x2021.23l7.78-7.78\x201.06-1.06a5.5\x205.5\x200\x200\x200\x200-7.78z\x22></path></svg><span>'+_0x3dd1e6+_0x4c6295(0x11c8);}let _0xf2cb4e='';_0x12d29e[_0x4c6295(0x10ae)]&&_0x12d29e[_0x4c6295(0x10ae)][_0x4c6295(0x58a)]>0x0&&(_0xf2cb4e=_0x4c6295(0x3f5),_0x12d29e[_0x4c6295(0x10ae)][_0x4c6295(0x59b)]((_0x4150c7,_0x53b97b)=>{const _0x245d06=_0x4c6295;if(typeof _0x4150c7==='object'&&_0x4150c7!==null&&_0x4150c7[_0x245d06(0xe27)]){const _0x881668=_0x4150c7[_0x245d06(0xe27)],_0x4eec75=_0x34f6a8(_0x881668);let _0x3d6b14;_0x43460a[_0x245d06(0x60b)](_0x4150c7[_0x245d06(0x40f)])?_0x3d6b14=_0x245d06(0xe40)+_0x4150c7[_0x245d06(0x40f)]+_0x245d06(0x11f2):_0x3d6b14=_0x1ec77d(_0x4150c7[_0x245d06(0x40f)]);let _0x12cbbc='';if(_0x4150c7['replyTo']){const _0x1148cf=_0x34f6a8(_0x4150c7[_0x245d06(0xef4)]);_0x12cbbc=_0x245d06(0xef1)+_0x4eec75+_0x245d06(0xa63)+_0x1148cf+_0x245d06(0xea7)+_0x3d6b14;}else _0x12cbbc=_0x245d06(0xef1)+_0x4eec75+_0x245d06(0xea7)+_0x3d6b14;_0xf2cb4e+=_0x245d06(0xb80)+_0x12d29e['id']+'\x22\x20data-commenter-original-name=\x22'+_0x881668+'\x22\x20data-commenter-display-name=\x22'+_0x4eec75+_0x245d06(0x1091)+_0x12cbbc+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22comment-delete-btn\x22\x20data-comment-index=\x22'+_0x53b97b+_0x245d06(0x1069);}else _0xf2cb4e+=_0x245d06(0xe5f)+_0x1ec77d(String(_0x4150c7))+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';}),_0xf2cb4e+=_0x4c6295(0x149b));const _0x4de83e=_0x1ae02e[_0x4c6295(0x11ef)]['nickname'],_0x5a9fee=_0x12d29e[_0x4c6295(0xb09)]&&_0x12d29e[_0x4c6295(0xb09)]['includes'](_0x4de83e),_0x666426=_0x1ae02e['favoritedPostIds']&&_0x1ae02e[_0x4c6295(0x1413)][_0x4c6295(0xe75)](_0x12d29e['id']);let _0x5b5c8f='';_0x12d29e[_0x4c6295(0xcbd)]!==_0x4c6295(0x1209)&&(_0x5b5c8f=_0x4c6295(0x66e));_0x1816af[_0x4c6295(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x571b2a+_0x4c6295(0x995)+_0x12d29e[_0x4c6295(0x12cf)]+_0x4c6295(0x85a)+_0x3bd483+_0x4c6295(0x155b)+_0x473c85(_0x12d29e['timestamp'])+_0x4c6295(0x758)+_0x264dcd+_0x4c6295(0x2ab)+_0x5b5c8f+_0x4c6295(0x5f8)+(_0x5a9fee?_0x4c6295(0x7cf):'')+_0x4c6295(0x4ba)+(_0x666426?_0x4c6295(0x7cf):'')+_0x4c6295(0xd45)+_0x458c90+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0xf2cb4e+_0x4c6295(0x734)+_0x1a8ec9+_0x4c6295(0xbba);if(!_0x3c1f46){const _0x18e54b=document[_0x4c6295(0x219)](_0x4c6295(0xaf9));_0x18e54b[_0x4c6295(0x7c6)]='qzone-post-delete-action',_0x18e54b[_0x4c6295(0xf21)]=_0x4c6295(0x8ea),_0x1a9b15[_0x4c6295(0x6ce)](_0x1816af),_0x1a9b15[_0x4c6295(0x6ce)](_0x18e54b);}return _0x1a9b15;}async function _0x511c14(_0x514fd4){const _0x5f03b6=_0x2b1222,_0x47c2cd=await _0x3df81a[_0x5f03b6(0x910)][_0x5f03b6(0x13f8)](_0x514fd4);if(!_0x47c2cd){const _0x16d959=document[_0x5f03b6(0xeda)](_0x5f03b6(0xe9d)+_0x514fd4+'\x22]');if(_0x16d959)_0x16d959['remove']();return;}const _0x5236f7=_0x6f01c2['findIndex'](_0xa66556=>_0xa66556['id']===_0x514fd4);if(_0x5236f7>-0x1)_0x6f01c2[_0x5236f7]=_0x47c2cd;const _0x591db9=await _0x3df81a['favorites'][_0x5f03b6(0x478)]('type')[_0x5f03b6(0x49d)](_0x5f03b6(0x4e1))[_0x5f03b6(0x27a)]();_0x1ae02e[_0x5f03b6(0x1413)]=new Set(_0x591db9[_0x5f03b6(0x1431)](_0x42fe8f=>_0x42fe8f['content']['id'])),_0x226cc6(_0x47c2cd);}function _0x3f7f7a(_0xfa13e4){const _0x3fd382=_0x2b1222,_0x310019=Date['now'](),_0x37a971=Math[_0x3fd382(0x123c)]((_0x310019-_0xfa13e4)/0x3e8),_0x4215c1=Math[_0x3fd382(0x123c)](_0x37a971/0x3c);if(_0x4215c1<0x2)return'刚刚';if(_0x4215c1<0x3c)return _0x4215c1+'分钟前';const _0x2a537e=Math[_0x3fd382(0x123c)](_0x4215c1/0x3c);if(_0x2a537e<0x18)return _0x2a537e+_0x3fd382(0x32a);const _0x1a6c7c=Math[_0x3fd382(0x123c)](_0x2a537e/0x18);return _0x1a6c7c+'天前';}async function _0x226cc6(_0x59a072){const _0x3a8c6d=_0x2b1222,_0x49f44d=document[_0x3a8c6d(0xeda)](_0x3a8c6d(0xe9d)+_0x59a072['id']+'\x22]'),_0x31f9b6=!!_0x49f44d,_0x2313dd=_0x31f9b6?_0x49f44d:document[_0x3a8c6d(0x219)](_0x3a8c6d(0xaf9));!_0x31f9b6&&(_0x2313dd[_0x3a8c6d(0x7c6)]=_0x3a8c6d(0x14d9),_0x2313dd[_0x3a8c6d(0x746)][_0x3a8c6d(0xd8f)]=_0x59a072['id']);const _0x14e0ed=_0x31f9b6?_0x2313dd[_0x3a8c6d(0xeda)]('.qzone-post-item'):document['createElement'](_0x3a8c6d(0xaf9));!_0x31f9b6&&(_0x14e0ed[_0x3a8c6d(0x7c6)]=_0x3a8c6d(0x3ef));let _0x477982='',_0x2c19e5='',_0x5d75f2=_0x1ae02e[_0x3a8c6d(0x11ef)][_0x3a8c6d(0x95b)];if(_0x59a072[_0x3a8c6d(0x12cf)]===_0x3a8c6d(0x860))_0x477982=_0x1ae02e[_0x3a8c6d(0x11ef)][_0x3a8c6d(0x95b)],_0x2c19e5=_0x1ae02e[_0x3a8c6d(0x11ef)]['nickname'];else{if(_0x1ae02e[_0x3a8c6d(0x589)][_0x59a072[_0x3a8c6d(0x12cf)]]){const _0x14b744=_0x1ae02e['chats'][_0x59a072[_0x3a8c6d(0x12cf)]];_0x477982=_0x14b744[_0x3a8c6d(0x6a8)][_0x3a8c6d(0xc99)]||_0x5494d0,_0x2c19e5=_0x14b744[_0x3a8c6d(0x5d2)];}else{if(String(_0x59a072[_0x3a8c6d(0x12cf)])[_0x3a8c6d(0xebf)](_0x3a8c6d(0x27f))){const _0x2d231f=parseInt(String(_0x59a072['authorId'])[_0x3a8c6d(0xef0)](_0x3a8c6d(0x27f),''));if(!isNaN(_0x2d231f)){const _0x3510a5=await _0x3df81a[_0x3a8c6d(0x15b9)]['get'](_0x2d231f);_0x3510a5?(_0x477982=_0x3510a5[_0x3a8c6d(0x95b)]||_0x54779f,_0x2c19e5=_0x3510a5['name']):(_0x2c19e5=_0x59a072['authorOriginalName']||_0x3a8c6d(0xae7),_0x477982=_0x54779f);}}else _0x2c19e5=_0x34f6a8(_0x59a072[_0x3a8c6d(0x24c)]),_0x477982=_0x5494d0;}}function _0x406c29(_0x3aff6d){const _0x5e8fa0=_0x3a8c6d;let _0x6cf4c='';const _0x26ea4b=_0x3aff6d[_0x5e8fa0(0xf1f)]?_0x5e8fa0(0x1523)+_0x1ec77d(_0x3aff6d[_0x5e8fa0(0xf1f)])[_0x5e8fa0(0xef0)](/\n/g,_0x5e8fa0(0xc9b))+_0x5e8fa0(0x149b):'';if(_0x3aff6d[_0x5e8fa0(0xcbd)]===_0x5e8fa0(0x30e))_0x6cf4c=_0x5e8fa0(0x109f)+_0x1ec77d(_0x3aff6d['content'])[_0x5e8fa0(0xef0)](/\n/g,_0x5e8fa0(0xc9b))+_0x5e8fa0(0x149b);else{if(_0x3aff6d[_0x5e8fa0(0xcbd)]===_0x5e8fa0(0x7e5)&&_0x3aff6d[_0x5e8fa0(0x48d)])_0x6cf4c=_0x26ea4b?_0x26ea4b+'<div\x20style=\x22margin-top:10px;\x22><img\x20src=\x22'+_0x3aff6d[_0x5e8fa0(0x48d)]+_0x5e8fa0(0xcba):_0x5e8fa0(0xe40)+_0x3aff6d[_0x5e8fa0(0x48d)]+_0x5e8fa0(0x8b7);else{if(_0x3aff6d[_0x5e8fa0(0xcbd)]===_0x5e8fa0(0x10ea)){const _0x4c56f9=_0x1ae02e[_0x5e8fa0(0x12c0)][_0x5e8fa0(0x7d1)]&&_0x3aff6d[_0x5e8fa0(0x1248)]?_0x5e8fa0(0xe8f)+_0x3aff6d[_0x5e8fa0(0x1248)]:_0x5e8fa0(0xe1f);_0x6cf4c=_0x26ea4b?_0x26ea4b+_0x5e8fa0(0xeee)+_0x4c56f9+_0x5e8fa0(0xd89)+_0x3aff6d[_0x5e8fa0(0x1090)]+_0x5e8fa0(0x23c):_0x5e8fa0(0xe40)+_0x4c56f9+'\x22\x20class=\x22chat-image\x22\x20style=\x22cursor:\x20pointer;\x22\x20data-hidden-text=\x22'+_0x3aff6d[_0x5e8fa0(0x1090)]+'\x22>';}else{if(_0x3aff6d[_0x5e8fa0(0xcbd)]==='naiimag'){const _0x42526a=_0x3aff6d['imageUrls']||(_0x3aff6d[_0x5e8fa0(0x48d)]?[_0x3aff6d[_0x5e8fa0(0x48d)]]:[]);if(_0x42526a['length']>0x0){const _0x2c7a71=_0x42526a['length'];let _0xc41d35='';_0xc41d35=_0x5e8fa0(0x107b)+_0x2c7a71+'\x22>',_0x42526a['forEach']((_0x180026,_0x370d12)=>{const _0x1c6cd6=_0x5e8fa0;_0xc41d35+=_0x1c6cd6(0xe40)+_0x180026+_0x1c6cd6(0x3f4)+(_0x370d12+0x1)+_0x1c6cd6(0xdaa);}),_0xc41d35+=_0x5e8fa0(0x149b),_0x6cf4c=_0x26ea4b?''+_0x26ea4b+_0xc41d35:_0xc41d35;}}}}}return _0x6cf4c;}let _0x14d6cf;if(_0x59a072[_0x3a8c6d(0xcbd)]===_0x3a8c6d(0x1209)){const _0x309303=_0x59a072['repostComment']?_0x3a8c6d(0x1523)+_0x59a072['repostComment']['replace'](/\n/g,_0x3a8c6d(0xc9b))+_0x3a8c6d(0x149b):'';let _0x5f14fc=_0x5494d0,_0x355d2c=_0x3a8c6d(0x680);if(_0x59a072[_0x3a8c6d(0x305)][_0x3a8c6d(0x12cf)]===_0x3a8c6d(0x860))_0x5f14fc=_0x1ae02e['qzoneSettings']['avatar'],_0x355d2c=_0x1ae02e[_0x3a8c6d(0x11ef)][_0x3a8c6d(0xb46)];else{const _0xfee3c6=_0x1ae02e[_0x3a8c6d(0x589)][_0x59a072[_0x3a8c6d(0x305)][_0x3a8c6d(0x12cf)]];_0xfee3c6&&(_0x5f14fc=_0xfee3c6[_0x3a8c6d(0x6a8)][_0x3a8c6d(0xc99)]||_0x5494d0),_0x355d2c=_0x34f6a8(_0x59a072[_0x3a8c6d(0x305)][_0x3a8c6d(0x24c)]);}_0x14d6cf=_0x3a8c6d(0x1375)+_0x309303+_0x3a8c6d(0x1553)+_0x5f14fc+'\x22\x20class=\x22post-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22post-nickname\x22>@'+_0x355d2c+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22post-timestamp\x22>'+_0x473c85(_0x59a072[_0x3a8c6d(0x305)][_0x3a8c6d(0x1388)])+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-main-content\x22>'+_0x406c29(_0x59a072['originalPost'])+_0x3a8c6d(0xa0f);}else _0x14d6cf=_0x3a8c6d(0x12a3)+_0x406c29(_0x59a072)+_0x3a8c6d(0x149b);let _0x5d4a2b='';if(_0x59a072['likes']&&_0x59a072[_0x3a8c6d(0xb09)][_0x3a8c6d(0x58a)]>0x0){const _0x443b53=_0x59a072['likes'][_0x3a8c6d(0x1431)](_0x32bbf4=>_0x34f6a8(_0x32bbf4))[_0x3a8c6d(0x1143)]('、');_0x5d4a2b=_0x3a8c6d(0x3c2)+_0x443b53+_0x3a8c6d(0x11c8);}let _0x47406c='';_0x59a072['comments']&&_0x59a072[_0x3a8c6d(0x10ae)][_0x3a8c6d(0x58a)]>0x0&&(_0x47406c='<div\x20class=\x22post-comments-container\x22>',_0x59a072[_0x3a8c6d(0x10ae)][_0x3a8c6d(0x59b)]((_0x1e301c,_0x4c5a42)=>{const _0x3ca8f6=_0x3a8c6d;if(typeof _0x1e301c===_0x3ca8f6(0xcc5)&&_0x1e301c!==null&&_0x1e301c[_0x3ca8f6(0xe27)]){const _0x370ff3=_0x1e301c['commenterName'],_0x107d17=_0x34f6a8(_0x370ff3);let _0xf947f1;_0x43460a['test'](_0x1e301c['text'])?_0xf947f1=_0x3ca8f6(0xe40)+_0x1e301c[_0x3ca8f6(0x40f)]+'\x22\x20class=\x22comment-sticker\x22\x20alt=\x22sticker\x22>':_0xf947f1=_0x1ec77d(_0x1e301c['text']);let _0x234511='';if(_0x1e301c['replyTo']){const _0x3f3ed3=_0x34f6a8(_0x1e301c['replyTo']);_0x234511=_0x3ca8f6(0xef1)+_0x107d17+_0x3ca8f6(0xa63)+_0x3f3ed3+'</span>:\x20'+_0xf947f1;}else _0x234511=_0x3ca8f6(0xef1)+_0x107d17+_0x3ca8f6(0xea7)+_0xf947f1;_0x47406c+='<div\x20class=\x22comment-item\x22\x20data-post-id=\x22'+_0x59a072['id']+'\x22\x20data-commenter-original-name=\x22'+_0x370ff3+'\x22\x20data-commenter-display-name=\x22'+_0x107d17+_0x3ca8f6(0x1091)+_0x234511+_0x3ca8f6(0xe2d)+_0x4c5a42+_0x3ca8f6(0x1069);}else _0x47406c+=_0x3ca8f6(0xe5f)+String(_0x1e301c)+_0x3ca8f6(0x206);}),_0x47406c+=_0x3a8c6d(0x149b));const _0x3a2263=_0x1ae02e['qzoneSettings'][_0x3a8c6d(0xb46)],_0x4fecf6=_0x59a072['likes']&&_0x59a072[_0x3a8c6d(0xb09)][_0x3a8c6d(0xe82)](_0x3a2263),_0x2a3e2e=_0x1ae02e[_0x3a8c6d(0x1413)]&&_0x1ae02e[_0x3a8c6d(0x1413)][_0x3a8c6d(0xe75)](_0x59a072['id']);let _0x18b39d='';_0x59a072[_0x3a8c6d(0xcbd)]!==_0x3a8c6d(0x1209)&&(_0x18b39d=_0x3a8c6d(0x66e));_0x14e0ed['innerHTML']=_0x3a8c6d(0xee9)+_0x477982+_0x3a8c6d(0x995)+_0x59a072[_0x3a8c6d(0x12cf)]+_0x3a8c6d(0x85a)+_0x2c19e5+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22post-timestamp\x22>'+_0x473c85(_0x59a072[_0x3a8c6d(0x1388)])+_0x3a8c6d(0x758)+_0x14d6cf+_0x3a8c6d(0x2ab)+_0x18b39d+_0x3a8c6d(0x5f8)+(_0x4fecf6?_0x3a8c6d(0x7cf):'')+_0x3a8c6d(0x4ba)+(_0x2a3e2e?_0x3a8c6d(0x7cf):'')+_0x3a8c6d(0xd45)+_0x5d4a2b+_0x3a8c6d(0x273)+_0x47406c+_0x3a8c6d(0x734)+_0x5d75f2+'\x22\x20class=\x22comment-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22comment-input\x22\x20placeholder=\x22友善的评论是交流的起点\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22comment-sticker-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x2210\x22></circle>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M8\x2014\x20Q\x2012\x2016\x2016\x2014\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x229\x22\x20y1=\x229\x22\x20x2=\x229.01\x22\x20y2=\x229\x22></line>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x2215\x22\x20y1=\x229\x22\x20x2=\x2215.01\x22\x20y2=\x229\x22></line>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22at-mention-popup\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22comment-send-btn\x22>发送</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';if(!_0x31f9b6){const _0x190445=document[_0x3a8c6d(0x219)]('div');_0x190445[_0x3a8c6d(0x7c6)]=_0x3a8c6d(0xf8b),_0x190445[_0x3a8c6d(0xf21)]=_0x3a8c6d(0x8ea),_0x2313dd['appendChild'](_0x14e0ed),_0x2313dd[_0x3a8c6d(0x6ce)](_0x190445);}return _0x2313dd;}async function _0x511c14(_0xb50cc6){const _0x4696b2=_0x2b1222,_0x4e831d=await _0x3df81a[_0x4696b2(0x910)][_0x4696b2(0x13f8)](_0xb50cc6);if(!_0x4e831d){const _0x3f310e=document['querySelector'](_0x4696b2(0xe9d)+_0xb50cc6+'\x22]');_0x3f310e&&_0x3f310e[_0x4696b2(0xa9c)]();return;}const _0x44157b=_0x6f01c2[_0x4696b2(0xf2d)](_0x34d25b=>_0x34d25b['id']===_0xb50cc6);_0x44157b>-0x1&&(_0x6f01c2[_0x44157b]=_0x4e831d);const _0x2856e=await _0x3df81a[_0x4696b2(0xbeb)][_0x4696b2(0x478)](_0x4696b2(0xcbd))[_0x4696b2(0x49d)](_0x4696b2(0x4e1))[_0x4696b2(0x27a)]();_0x1ae02e[_0x4696b2(0x1413)]=new Set(_0x2856e[_0x4696b2(0x1431)](_0x490ac7=>_0x490ac7[_0x4696b2(0x128c)]['id'])),await _0x226cc6(_0x4e831d);}async function _0x28d6f7(){const _0x482122=_0x2b1222,_0x57c458=document[_0x482122(0x1f4)]('qzone-posts-list');if(!_0x57c458)return;const [_0x193b25,_0x352868]=await Promise['all']([_0x3df81a[_0x482122(0x910)][_0x482122(0x931)](_0x482122(0x1388))['reverse']()['filter'](_0x30ffbe=>!_0x30ffbe[_0x482122(0x65d)])[_0x482122(0x27a)](),_0x3df81a[_0x482122(0xbeb)][_0x482122(0x478)](_0x482122(0xcbd))['equals'](_0x482122(0x4e1))[_0x482122(0x27a)]()]);_0x6f01c2=_0x193b25,_0x1ae02e[_0x482122(0x1413)]=new Set(_0x352868[_0x482122(0x1431)](_0x26261c=>_0x26261c[_0x482122(0x128c)]['id'])),_0x57c458[_0x482122(0xf21)]='',_0x54afbd=0x0;if(_0x6f01c2[_0x482122(0x58a)]===0x0){_0x57c458[_0x482122(0xf21)]=_0x482122(0x7de);return;}_0x2e2547();}async function _0x2e2547(){const _0x42879f=_0x2b1222;if(_0x121658)return;_0x121658=!![];const _0x2b9665=document[_0x42879f(0x1f4)]('qzone-posts-list');if(!_0x2b9665){_0x121658=![];return;}_0x5563af(_0x2b9665,'bottom'),setTimeout(async()=>{const _0x2440ae=_0x42879f;_0x1335c4(_0x2b9665);const _0x4c0890=_0x54afbd,_0xd010a9=_0x54afbd+_0x57988e,_0x3693a5=_0x6f01c2[_0x2440ae(0x5cc)](_0x4c0890,_0xd010a9),_0x272e24=document['createDocumentFragment']();for(const _0x4a7691 of _0x3693a5){const _0x253672=await _0x226cc6(_0x4a7691);_0x272e24[_0x2440ae(0x6ce)](_0x253672);}_0x2b9665[_0x2440ae(0x6ce)](_0x272e24),_0x54afbd+=_0x3693a5[_0x2440ae(0x58a)],_0x121658=![];},0x1f4);}function _0x3c0632(_0x12f289,_0x4136e6){const _0x28a0d7=_0x2b1222,_0x460d68=_0x4d11d5[_0x28a0d7(0x1225)],_0x1b23fe=_0x4d11d5[_0x28a0d7(0x7ae)];_0x1b23fe[_0x28a0d7(0xf21)]='';_0x1ae02e['userStickers'][_0x28a0d7(0x58a)]===0x0?_0x1b23fe[_0x28a0d7(0xf21)]='<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20grid-column:\x201\x20/\x20-1;\x20padding-top:\x2020px;\x22>请先在聊天界面的<br>表情面板中添加表情包</p>':_0x1ae02e[_0x28a0d7(0x1420)][_0x28a0d7(0x59b)](_0x5b91a9=>{const _0x499c61=_0x28a0d7,_0x1213c1=document[_0x499c61(0x219)](_0x499c61(0xaf9));_0x1213c1[_0x499c61(0x7c6)]=_0x499c61(0x270),_0x1213c1[_0x499c61(0x215)]['backgroundImage']=_0x499c61(0x13cb)+_0x5b91a9[_0x499c61(0x258)]+')',_0x1213c1['title']=_0x5b91a9[_0x499c61(0x5d2)],_0x1b23fe['appendChild'](_0x1213c1);});const _0x3fea43=_0x4136e6['getBoundingClientRect'](),_0x1d85a6=document['getElementById'](_0x28a0d7(0x296))[_0x28a0d7(0x6cc)]();_0x460d68[_0x28a0d7(0x215)][_0x28a0d7(0x887)]='flex';const _0x5df1e1=_0x460d68[_0x28a0d7(0x6cc)](),_0x3fa3c9=_0x5df1e1[_0x28a0d7(0x1158)],_0x12ed08=_0x5df1e1[_0x28a0d7(0x4cb)];_0x460d68[_0x28a0d7(0x215)][_0x28a0d7(0xe00)]=_0x3fea43[_0x28a0d7(0xe00)]-_0x3fa3c9-0x5-_0x1d85a6[_0x28a0d7(0xe00)]+'px';const _0x5d114b=_0x3fea43['left']-_0x1d85a6[_0x28a0d7(0xbe7)];_0x5d114b+_0x12ed08>_0x1d85a6[_0x28a0d7(0x4cb)]?(_0x460d68[_0x28a0d7(0x215)][_0x28a0d7(0xbe7)]=_0x28a0d7(0x2aa),_0x460d68[_0x28a0d7(0x215)][_0x28a0d7(0x68d)]='5px'):(_0x460d68['style'][_0x28a0d7(0xbe7)]=_0x5d114b+'px',_0x460d68[_0x28a0d7(0x215)][_0x28a0d7(0x68d)]=_0x28a0d7(0x2aa)),_0x4d11d5['isOpen']=!![],_0x4d11d5['activePostId']=_0x12f289;}function _0x42ac48(){const _0x1b7fdf=_0x2b1222;_0x4d11d5['isOpen']&&(_0x4d11d5[_0x1b7fdf(0x1225)][_0x1b7fdf(0x215)][_0x1b7fdf(0x887)]=_0x1b7fdf(0x1b5),_0x4d11d5['isOpen']=![],_0x4d11d5[_0x1b7fdf(0x15bf)]=null);}async function _0x4bb4d4(_0x4c0906,_0x118bc0){const _0x125ca8=_0x2b1222;if(!_0x118bc0||!_0x118bc0[_0x125ca8(0x258)])return;const _0x2566e8=await _0x3df81a[_0x125ca8(0x910)]['get'](_0x4c0906);if(!_0x2566e8){console[_0x125ca8(0x127d)](_0x125ca8(0x640),_0x4c0906);return;}!_0x2566e8[_0x125ca8(0x10ae)]&&(_0x2566e8[_0x125ca8(0x10ae)]=[]);const _0x5cf708={'commenterName':_0x1ae02e[_0x125ca8(0x11ef)][_0x125ca8(0xb46)],'text':_0x118bc0[_0x125ca8(0x258)],'meaning':_0x118bc0['name'],'timestamp':Date[_0x125ca8(0xd6e)]()};_0x2566e8[_0x125ca8(0x10ae)][_0x125ca8(0x1426)](_0x5cf708),await _0x3df81a[_0x125ca8(0x910)][_0x125ca8(0xf18)](_0x4c0906,{'comments':_0x2566e8['comments']}),_0x42ac48(),await _0x28d6f7();const _0x221caf=(_0x2566e8[_0x125ca8(0xf1f)]||_0x2566e8['content']||_0x125ca8(0x109a))[_0x125ca8(0x516)](0x0,0x1e);for(const _0x57c4c7 in _0x1ae02e['chats']){const _0x417074=_0x1ae02e[_0x125ca8(0x589)][_0x57c4c7];if(!_0x417074[_0x125ca8(0xe83)]){const _0x318b58='[系统提示：\x27'+_0x1ae02e['qzoneSettings'][_0x125ca8(0xb46)]+'\x27\x20在你的动态(ID:\x20'+_0x4c0906+_0x125ca8(0x1b9)+_0x221caf+_0x125ca8(0x116e)+_0x118bc0[_0x125ca8(0x5d2)]+'”。请你对此作出回应。]',_0x2e952f={'role':_0x125ca8(0x1594),'content':_0x318b58,'timestamp':Date['now'](),'isHidden':!![]};_0x417074[_0x125ca8(0xce3)]['push'](_0x2e952f),await _0x3df81a['chats'][_0x125ca8(0x295)](_0x417074);}}}function _0x4e75af(_0x5ca383){const _0x27db86=_0x2b1222;_0x415712=_0x5ca383,document[_0x27db86(0x1f4)](_0x27db86(0xbbe))[_0x27db86(0x107e)]='',document[_0x27db86(0x1f4)](_0x27db86(0x79a))[_0x27db86(0x159b)][_0x27db86(0x6a4)](_0x27db86(0xfca));}function _0x1b9e3f(){const _0x2fc8a2=_0x2b1222;document[_0x2fc8a2(0x1f4)]('repost-modal')['classList'][_0x2fc8a2(0xa9c)](_0x2fc8a2(0xfca)),_0x415712=null;}async function _0x2d229f(){const _0x4145aa=_0x2b1222;if(!_0x415712)return;const _0x4039f2=document[_0x4145aa(0x1f4)](_0x4145aa(0xbbe))['value'][_0x4145aa(0x4a2)](),_0x56d56d=await _0x3df81a[_0x4145aa(0x910)][_0x4145aa(0x13f8)](_0x415712);if(!_0x56d56d){alert('错误：找不到要转发的原始动态。'),_0x1b9e3f();return;}const _0x1a3d59={'type':'repost','timestamp':Date[_0x4145aa(0xd6e)](),'authorId':'user','repostComment':_0x4039f2,'originalPost':_0x56d56d,'visibleGroupIds':null};await _0x3df81a['qzonePosts'][_0x4145aa(0x6a4)](_0x1a3d59),_0x1b9e3f(),await _0x28d6f7(),alert(_0x4145aa(0x7f4));}function _0x34be73(_0x2c55f2){const _0x1d6046=_0x2b1222,_0x5b65c2=document[_0x1d6046(0x1f4)](_0x1d6046(0x908));_0x5b65c2[_0x1d6046(0xf21)]='';if(_0x2c55f2[_0x1d6046(0x58a)]===0x0){const _0x536303=document[_0x1d6046(0x1f4)](_0x1d6046(0x2d6))[_0x1d6046(0x107e)],_0x345a60=_0x536303?_0x1d6046(0xc12):_0x1d6046(0x1337);_0x5b65c2[_0x1d6046(0xf21)]=_0x1d6046(0xaad)+_0x345a60+_0x1d6046(0x1517);return;}for(const _0x3773c8 of _0x2c55f2){const _0x421b19=document['createElement']('div');_0x421b19[_0x1d6046(0x7c6)]=_0x1d6046(0x50c),_0x421b19[_0x1d6046(0x746)][_0x1d6046(0xc01)]=_0x3773c8['id'];let _0x1d328a='',_0x76c29a='',_0x4041ef='',_0x1c8be4='';if(_0x3773c8[_0x1d6046(0xcbd)]===_0x1d6046(0x4e1)){const _0x3b9837=_0x3773c8[_0x1d6046(0x128c)];_0x4041ef=_0x1d6046(0x116a);let _0x481b0f=_0x5494d0,_0xd1f656=_0x1d6046(0x10b3);if(_0x3b9837['authorId']==='user')_0x481b0f=_0x1ae02e[_0x1d6046(0x11ef)][_0x1d6046(0x95b)],_0xd1f656=_0x1ae02e['qzoneSettings'][_0x1d6046(0xb46)];else _0x1ae02e[_0x1d6046(0x589)][_0x3b9837[_0x1d6046(0x12cf)]]&&(_0x481b0f=_0x1ae02e[_0x1d6046(0x589)][_0x3b9837['authorId']][_0x1d6046(0x6a8)][_0x1d6046(0xc99)],_0xd1f656=_0x1ae02e[_0x1d6046(0x589)][_0x3b9837['authorId']]['name']);_0x1d328a=_0x1d6046(0xe40)+_0x481b0f+'\x22\x20class=\x22avatar\x22><div\x20class=\x22info\x22><div\x20class=\x22name\x22>'+_0xd1f656+_0x1d6046(0x5c2);const _0x340484=_0x3b9837['publicText']?'<div\x20class=\x22post-content\x22>'+_0x3b9837[_0x1d6046(0xf1f)][_0x1d6046(0xef0)](/\n/g,'<br>')+_0x1d6046(0x149b):'';if(_0x3b9837[_0x1d6046(0xcbd)]===_0x1d6046(0x30e))_0x76c29a=_0x1d6046(0x1523)+_0x3b9837[_0x1d6046(0x128c)][_0x1d6046(0xef0)](/\n/g,'<br>')+_0x1d6046(0x149b);else{if(_0x3b9837['type']===_0x1d6046(0x7e5)&&_0x3b9837['imageUrl']){const _0x212d9f=_0x1ae02e[_0x1d6046(0x12c0)][_0x1d6046(0x7d1)]&&_0x3b9837[_0x1d6046(0x1248)]?'https://image.pollinations.ai/prompt/'+_0x3b9837[_0x1d6046(0x1248)]:_0x1d6046(0xe1f);_0x76c29a=_0x340484?_0x340484+'<div\x20style=\x22margin-top:10px;\x22><img\x20src=\x22'+_0x212d9f+_0x1d6046(0xcba):_0x1d6046(0xe40)+_0x212d9f+_0x1d6046(0x8b7);}else{if(_0x3b9837[_0x1d6046(0xcbd)]===_0x1d6046(0x10ea)){const _0x3a3708=_0x1ae02e[_0x1d6046(0x12c0)]['enableAiDrawing']&&_0x3b9837[_0x1d6046(0x1248)]?_0x1d6046(0xe8f)+_0x3b9837[_0x1d6046(0x1248)]:_0x1d6046(0xe1f);_0x76c29a=_0x340484?_0x340484+_0x1d6046(0xeee)+_0x3a3708+_0x1d6046(0xd89)+_0x3b9837[_0x1d6046(0x1090)]+_0x1d6046(0x23c):_0x1d6046(0xe40)+_0x3a3708+'\x22\x20class=\x22chat-image\x22\x20style=\x22cursor:\x20pointer;\x22\x20data-hidden-text=\x22'+_0x3b9837[_0x1d6046(0x1090)]+'\x22>';}}}let _0x28250f='';_0x3b9837[_0x1d6046(0xb09)]&&_0x3b9837[_0x1d6046(0xb09)]['length']>0x0&&(_0x28250f=_0x1d6046(0x11fa)+_0x3b9837['likes'][_0x1d6046(0x1143)]('、')+_0x1d6046(0x13ef));let _0x3cfc80='';_0x3b9837[_0x1d6046(0x10ae)]&&_0x3b9837[_0x1d6046(0x10ae)][_0x1d6046(0x58a)]>0x0&&(_0x3cfc80=_0x1d6046(0x3f5),_0x3b9837['comments'][_0x1d6046(0x59b)]((_0x49f85f,_0xea1d9a)=>{const _0x3bae6b=_0x1d6046;if(typeof _0x49f85f===_0x3bae6b(0xcc5)&&_0x49f85f!==null&&_0x49f85f['commenterName']){const _0x4247fa=_0x49f85f[_0x3bae6b(0xe27)],_0x33d5b3=_0x34f6a8(_0x4247fa);let _0x1c8da8;_0x43460a[_0x3bae6b(0x60b)](_0x49f85f['text'])?_0x1c8da8='<img\x20src=\x22'+_0x49f85f[_0x3bae6b(0x40f)]+'\x22\x20class=\x22comment-sticker\x22\x20alt=\x22sticker\x22>':_0x1c8da8=_0x49f85f['text'];let _0x4bcf6f='';if(_0x49f85f[_0x3bae6b(0xef4)]){const _0x1d3c2b=_0x34f6a8(_0x49f85f[_0x3bae6b(0xef4)]);_0x4bcf6f=_0x3bae6b(0xef1)+_0x33d5b3+'</span>\x20回复\x20<span\x20class=\x22commenter-name\x22>'+_0x1d3c2b+_0x3bae6b(0xea7)+_0x1c8da8;}else _0x4bcf6f=_0x3bae6b(0xef1)+_0x33d5b3+_0x3bae6b(0xea7)+_0x1c8da8;_0x3cfc80+=_0x3bae6b(0xb80)+_0x3b9837['id']+'\x22\x20data-commenter-original-name=\x22'+_0x4247fa+_0x3bae6b(0x1331)+_0x33d5b3+_0x3bae6b(0xf8a)+_0x4bcf6f+_0x3bae6b(0x671)+_0xea1d9a+_0x3bae6b(0x5f0);}else _0x3cfc80+=_0x3bae6b(0x805)+String(_0x49f85f)+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';}),_0x3cfc80+=_0x1d6046(0x149b)),_0x1c8be4=''+_0x28250f+_0x3cfc80;}else{if(_0x3773c8['type']===_0x1d6046(0xa17)){const _0x824049=_0x3773c8[_0x1d6046(0x128c)],_0x50ad1c=_0x1ae02e[_0x1d6046(0x589)][_0x3773c8['chatId']];if(!_0x50ad1c)continue;_0x4041ef='来自与\x20'+_0x50ad1c[_0x1d6046(0x5d2)]+_0x1d6046(0x11a4);const _0x1a6ae2=_0x824049['role']===_0x1d6046(0x860);let _0x213c83,_0x2946a0;if(_0x1a6ae2)_0x213c83=_0x50ad1c[_0x1d6046(0xe83)]?_0x50ad1c[_0x1d6046(0x6a8)]['myNickname']||'我':'我',_0x2946a0=_0x50ad1c['settings']['myAvatar']||(_0x50ad1c['isGroup']?_0x203a38:_0x5494d0);else{if(_0x50ad1c[_0x1d6046(0xe83)]){const _0x4abdb8=_0x50ad1c[_0x1d6046(0x1402)][_0x1d6046(0x13b7)](_0x139769=>_0x139769['originalName']===_0x824049['senderName']);_0x213c83=_0x824049[_0x1d6046(0xfb7)],_0x2946a0=_0x4abdb8?_0x4abdb8[_0x1d6046(0x95b)]:_0x54779f;}else _0x213c83=_0x50ad1c['name'],_0x2946a0=_0x50ad1c['settings']['aiAvatar']||_0x5494d0;}_0x1d328a=_0x1d6046(0xe40)+_0x2946a0+_0x1d6046(0x5ed)+_0x213c83+'</div></div>';if(typeof _0x824049[_0x1d6046(0x128c)]===_0x1d6046(0x6c3)&&_0x43460a[_0x1d6046(0x60b)](_0x824049[_0x1d6046(0x128c)]))_0x76c29a=_0x1d6046(0xe40)+_0x824049[_0x1d6046(0x128c)]+'\x22\x20class=\x22sticker-image\x22\x20style=\x22max-width:\x2080px;\x20max-height:\x2080px;\x22>';else Array['isArray'](_0x824049[_0x1d6046(0x128c)])&&_0x824049['content'][0x0]?.['type']==='image_url'?_0x76c29a=_0x1d6046(0xe40)+_0x824049['content'][0x0][_0x1d6046(0x1296)][_0x1d6046(0x258)]+_0x1d6046(0x8b7):_0x76c29a=String(_0x824049[_0x1d6046(0x128c)]||'')[_0x1d6046(0xef0)](/\n/g,_0x1d6046(0xc9b));}else{if(_0x3773c8[_0x1d6046(0xcbd)]==='char_diary'){const _0x5c3c80=_0x3773c8['content'];_0x4041ef=_0x1d6046(0x189)+_0x5c3c80[_0x1d6046(0x8ce)]+_0x1d6046(0x1482);const _0x22a548=_0x1ae02e['chats'][_0x5c3c80[_0x1d6046(0x575)]],_0x28629c=_0x22a548?_0x22a548[_0x1d6046(0x6a8)][_0x1d6046(0xc99)]:_0x5494d0;_0x1d328a=_0x1d6046(0xe40)+_0x28629c+'\x22\x20class=\x22avatar\x22><div\x20class=\x22info\x22><div\x20class=\x22name\x22>'+_0x5c3c80[_0x1d6046(0x8ce)]+'</div></div>';const _0x487a7b=_0x5c3c80[_0x1d6046(0x128c)]||'',_0x3f6770=_0x1ec77d(_0x487a7b)['replace'](/\n/g,_0x1d6046(0xc9b));_0x76c29a='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-title\x22>'+_0x5c3c80[_0x1d6046(0x156f)]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22fav-card-content-full\x22>'+_0x3f6770+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}else{if(_0x3773c8[_0x1d6046(0xcbd)]===_0x1d6046(0x106c)){const _0x2a6e37=_0x3773c8[_0x1d6046(0x128c)];_0x4041ef=_0x1d6046(0x189)+_0x2a6e37[_0x1d6046(0x8ce)]+_0x1d6046(0x223);const _0x3a03d6=_0x1ae02e[_0x1d6046(0x589)][_0x2a6e37['characterId']],_0x541d94=_0x3a03d6?_0x3a03d6[_0x1d6046(0x6a8)][_0x1d6046(0xc99)]:_0x5494d0;_0x1d328a=_0x1d6046(0xe40)+_0x541d94+_0x1d6046(0x5ed)+_0x2a6e37[_0x1d6046(0x8ce)]+_0x1d6046(0x5c2),_0x76c29a=_0x1d6046(0x12ea)+_0x2a6e37['title']+_0x1d6046(0x1329)+(_0x2a6e37[_0x1d6046(0x128c)]||'')[_0x1d6046(0xef0)](/\n/g,_0x1d6046(0xc9b))+_0x1d6046(0x1514);}else{if(_0x3773c8['type']===_0x1d6046(0xc1f)){const _0x315c36=_0x3773c8[_0x1d6046(0x128c)];_0x4041ef=_0x1d6046(0x189)+_0x315c36[_0x1d6046(0x8ce)]+_0x1d6046(0x1f1);const _0x4b6896=_0x1ae02e[_0x1d6046(0x589)][_0x315c36[_0x1d6046(0x575)]],_0x31bf5b=_0x4b6896?_0x4b6896[_0x1d6046(0x6a8)][_0x1d6046(0xc99)]:_0x5494d0;_0x1d328a=_0x1d6046(0xe40)+_0x31bf5b+_0x1d6046(0x5ed)+_0x315c36[_0x1d6046(0x8ce)]+_0x1d6046(0x5c2),_0x76c29a=_0x1d6046(0x342)+_0x315c36[_0x1d6046(0x156f)]+_0x1d6046(0x61e)+_0x315c36['content'][_0x1d6046(0xef0)](/\n/g,_0x1d6046(0xc9b))+_0x1d6046(0xe6c);}}}}}_0x421b19[_0x1d6046(0xf21)]=_0x1d6046(0x1067)+_0x1d328a+_0x1d6046(0x15c2)+_0x4041ef+_0x1d6046(0x12b9)+_0x76c29a+_0x1d6046(0x290)+_0x1c8be4,_0x5b65c2[_0x1d6046(0x6ce)](_0x421b19);}}async function _0x2e35bf(){const _0x5737cb=_0x2b1222;allFavoriteItems=await _0x3df81a[_0x5737cb(0xbeb)]['orderBy'](_0x5737cb(0x1388))[_0x5737cb(0x115a)]()[_0x5737cb(0x27a)]();const _0x42fc27=document[_0x5737cb(0x1f4)](_0x5737cb(0x2d6)),_0x589dc2=document[_0x5737cb(0x1f4)](_0x5737cb(0x18f));_0x42fc27[_0x5737cb(0x107e)]='',_0x589dc2[_0x5737cb(0x215)]['display']='none',_0x34be73(allFavoriteItems);}function _0x6b9f3c(){const _0x12bd23=_0x2b1222;document['getElementById'](_0x12bd23(0xeaa))[_0x12bd23(0x107e)]='',document['getElementById'](_0x12bd23(0x1398))[_0x12bd23(0x9fe)]='',document['getElementById']('post-image-description')[_0x12bd23(0x107e)]='',document[_0x12bd23(0x1f4)](_0x12bd23(0x1364))[_0x12bd23(0x159b)][_0x12bd23(0xa9c)]('visible'),document['getElementById'](_0x12bd23(0xf72))[_0x12bd23(0x215)][_0x12bd23(0x887)]=_0x12bd23(0x1b5),document[_0x12bd23(0x1f4)](_0x12bd23(0x14a1))['value']='',document[_0x12bd23(0x1f4)]('post-hidden-text')[_0x12bd23(0x107e)]='',document[_0x12bd23(0x1f4)](_0x12bd23(0x890))['click']();}async function _0xcb7a4b(){const _0x2d2d16=_0x2b1222,_0x4439b4=await _0x109970(_0x2d2d16(0xe68),_0x2d2d16(0x1049),{'confirmButtonClass':_0x2d2d16(0x1c6),'confirmText':_0x2d2d16(0x1586)});if(!_0x4439b4)return;await _0x1460c5(_0x2d2d16(0x11b7),_0x2d2d16(0x358)),console[_0x2d2d16(0x57e)]('冗余数据清理流程已启动...');let _0x1f7f9c={'posts':0x0,'likes':0x0,'comments':0x0,'memories':0x0,'callRecords':0x0,'renderingRules':0x0,'groupMembers':0x0,'chatLinks':0x0};try{await _0x3df81a[_0x2d2d16(0x13a5)]('rw',_0x3df81a[_0x2d2d16(0x308)],async()=>{const _0x346b52=_0x2d2d16,_0x3956d8=await _0x3df81a['chats'][_0x346b52(0x27a)](),_0x168604=await _0x3df81a[_0x346b52(0x15b9)][_0x346b52(0x27a)](),_0x343b28=new Set(_0x3956d8[_0x346b52(0x1431)](_0x4b4809=>_0x4b4809['id'])),_0x19341f=new Set(_0x168604['map'](_0x2b81c9=>_0x346b52(0x27f)+_0x2b81c9['id'])),_0x12aa6e=new Set(_0x3956d8[_0x346b52(0xede)](_0xb9e83c=>!_0xb9e83c[_0x346b52(0xe83)])[_0x346b52(0x1431)](_0x206805=>_0x206805[_0x346b52(0x96f)]));_0x12aa6e[_0x346b52(0x6a4)](_0x1ae02e[_0x346b52(0x11ef)][_0x346b52(0xb46)]||_0x346b52(0xee7)),_0x168604[_0x346b52(0x59b)](_0x2b7282=>_0x12aa6e[_0x346b52(0x6a4)](_0x2b7282[_0x346b52(0x5d2)]));for(const _0x25b38f of _0x3956d8){let _0x598ecf=![];if(_0x25b38f[_0x346b52(0xe83)]&&_0x25b38f[_0x346b52(0x1402)]){const _0x5e1ce6=_0x25b38f['members'][_0x346b52(0x58a)];_0x25b38f['members']=_0x25b38f[_0x346b52(0x1402)][_0x346b52(0xede)](_0x182d24=>_0x343b28[_0x346b52(0xe75)](_0x182d24['id'])||_0x19341f[_0x346b52(0xe75)](_0x182d24['id'])),_0x25b38f[_0x346b52(0x1402)][_0x346b52(0x58a)]<_0x5e1ce6&&(_0x1f7f9c[_0x346b52(0x1423)]+=_0x5e1ce6-_0x25b38f['members'][_0x346b52(0x58a)],_0x598ecf=!![]);}if(_0x25b38f[_0x346b52(0x6a8)]?.[_0x346b52(0xf2e)]?.[_0x346b52(0x58a)]>0x0){const _0x42dc03=_0x25b38f[_0x346b52(0x6a8)][_0x346b52(0xf2e)][_0x346b52(0x58a)];_0x25b38f[_0x346b52(0x6a8)]['linkedMemoryChatIds']=_0x25b38f['settings']['linkedMemoryChatIds'][_0x346b52(0xede)](_0x40acb2=>_0x343b28[_0x346b52(0xe75)](_0x40acb2)),_0x25b38f[_0x346b52(0x6a8)][_0x346b52(0xf2e)]['length']<_0x42dc03&&(_0x1f7f9c['chatLinks']+=_0x42dc03-_0x25b38f[_0x346b52(0x6a8)]['linkedMemoryChatIds'][_0x346b52(0x58a)],_0x598ecf=!![]);}_0x598ecf&&await _0x3df81a[_0x346b52(0x589)][_0x346b52(0x295)](_0x25b38f);}const _0x4807ef=await _0x3df81a[_0x346b52(0x910)][_0x346b52(0x27a)]();for(const _0x4e2d1b of _0x4807ef){let _0x4cabe4=![];const _0x20a691=_0x4e2d1b[_0x346b52(0x12cf)]===_0x346b52(0x860)||_0x343b28['has'](_0x4e2d1b[_0x346b52(0x12cf)])||_0x19341f[_0x346b52(0xe75)](_0x4e2d1b[_0x346b52(0x12cf)]);if(!_0x20a691){await _0x3df81a[_0x346b52(0x910)][_0x346b52(0xc40)](_0x4e2d1b['id']),_0x1f7f9c[_0x346b52(0x2b3)]++;continue;}if(_0x4e2d1b[_0x346b52(0xb09)]&&_0x4e2d1b['likes'][_0x346b52(0x58a)]>0x0){const _0x577b87=_0x4e2d1b[_0x346b52(0xb09)][_0x346b52(0x58a)];_0x4e2d1b['likes']=_0x4e2d1b[_0x346b52(0xb09)][_0x346b52(0xede)](_0x27367e=>_0x12aa6e[_0x346b52(0xe75)](_0x27367e)),_0x4e2d1b[_0x346b52(0xb09)][_0x346b52(0x58a)]<_0x577b87&&(_0x1f7f9c['likes']+=_0x577b87-_0x4e2d1b['likes'][_0x346b52(0x58a)],_0x4cabe4=!![]);}if(_0x4e2d1b[_0x346b52(0x10ae)]&&_0x4e2d1b['comments'][_0x346b52(0x58a)]>0x0){const _0x3ad452=_0x4e2d1b['comments'][_0x346b52(0x58a)];_0x4e2d1b['comments']=_0x4e2d1b[_0x346b52(0x10ae)][_0x346b52(0xede)](_0x15e594=>{const _0x29cad8=_0x346b52;if(typeof _0x15e594==='object'&&_0x15e594['commenterName'])return _0x12aa6e[_0x29cad8(0xe75)](_0x15e594[_0x29cad8(0xe27)]);return!![];}),_0x4e2d1b[_0x346b52(0x10ae)]['length']<_0x3ad452&&(_0x1f7f9c[_0x346b52(0x10ae)]+=_0x3ad452-_0x4e2d1b[_0x346b52(0x10ae)][_0x346b52(0x58a)],_0x4cabe4=!![]);}_0x4cabe4&&await _0x3df81a[_0x346b52(0x910)]['put'](_0x4e2d1b);}await _0x3df81a[_0x346b52(0x9e3)][_0x346b52(0x478)](_0x346b52(0x3e0))[_0x346b52(0x2ec)]([..._0x343b28])[_0x346b52(0xc40)]()['then'](_0x361e6d=>_0x1f7f9c[_0x346b52(0x9e3)]+=_0x361e6d),await _0x3df81a[_0x346b52(0xac4)]['where'](_0x346b52(0x3e0))[_0x346b52(0x2ec)]([..._0x343b28])[_0x346b52(0xc40)]()[_0x346b52(0x14bc)](_0xacdebd=>_0x1f7f9c[_0x346b52(0xac4)]+=_0xacdebd);const _0x244d2d=await _0x3df81a[_0x346b52(0xd2c)]['toArray']();for(const _0x1fecda of _0x244d2d){_0x1fecda[_0x346b52(0x3e0)]!==_0x346b52(0x667)&&!_0x343b28[_0x346b52(0xe75)](_0x1fecda['chatId'])&&(await _0x3df81a[_0x346b52(0xd2c)]['delete'](_0x1fecda['id']),_0x1f7f9c['renderingRules']++);}});let _0x27a376=_0x2d2d16(0x344),_0x2f47a0=![];Object[_0x2d2d16(0xd20)](_0x1f7f9c)[_0x2d2d16(0x59b)](([_0x2d491a,_0x2ca527])=>{const _0x54e3a2=_0x2d2d16;if(_0x2ca527>0x0){const _0x51118e={'posts':'动态','likes':'点赞','comments':'评论','memories':'记忆','callRecords':_0x54e3a2(0x576),'renderingRules':_0x54e3a2(0x1540),'groupMembers':_0x54e3a2(0x153e),'chatLinks':'记忆链接'};_0x27a376+=_0x54e3a2(0xccc)+_0x2ca527+'\x20条无效的'+(_0x51118e[_0x2d491a]||_0x2d491a)+'。\x0a',_0x2f47a0=!![];}});!_0x2f47a0&&(_0x27a376=_0x2d2d16(0x144d));_0x27a376+=_0x2d2d16(0x940),await _0x1460c5(_0x2d2d16(0x1539),_0x27a376);const _0x3e66b7=await _0x109970(_0x2d2d16(0x11bf),_0x2d2d16(0x5ce));_0x3e66b7&&location[_0x2d2d16(0x100f)]();}catch(_0x332257){console[_0x2d2d16(0x127d)](_0x2d2d16(0x26c),_0x332257),await _0x1460c5('清理失败',_0x2d2d16(0x5ea)+_0x332257[_0x2d2d16(0x11f0)]);}}async function _0x216e78(){const _0x59cc06=_0x2b1222;try{const _0x36d8a4={'version':0x1,'timestamp':Date['now']()},[_0x57e466,_0x18dd59,_0x28b686,_0x5834c1,_0x2c85d5,_0x15576b,_0x17ecc8,_0x3e9e2d,_0x3e38ce,_0x53cf87,_0x392840,_0x27bf0b,_0x2ea66b,_0x2e7ae5,_0x786d67,_0x1d6bb4,_0x509013,_0x1f227d,_0x60319d,_0x3559a4,_0x4fd6fd,_0x1954e7,_0x4f2e9d,_0x1e7cb3,_0x596b01]=await Promise[_0x59cc06(0x54b)]([_0x3df81a[_0x59cc06(0x589)][_0x59cc06(0x27a)](),_0x3df81a[_0x59cc06(0x1453)][_0x59cc06(0x27a)](),_0x3df81a[_0x59cc06(0x1420)][_0x59cc06(0x27a)](),_0x3df81a['apiConfig'][_0x59cc06(0x13f8)](_0x59cc06(0x70b)),_0x3df81a[_0x59cc06(0x12c0)][_0x59cc06(0x13f8)](_0x59cc06(0x70b)),_0x3df81a[_0x59cc06(0xe16)][_0x59cc06(0x27a)](),_0x3df81a[_0x59cc06(0xa7e)][_0x59cc06(0x13f8)](_0x59cc06(0x70b)),_0x3df81a[_0x59cc06(0x11ef)][_0x59cc06(0x13f8)]('main'),_0x3df81a[_0x59cc06(0x910)][_0x59cc06(0x27a)](),_0x3df81a[_0x59cc06(0x20a)][_0x59cc06(0x27a)](),_0x3df81a[_0x59cc06(0xaee)][_0x59cc06(0x27a)](),_0x3df81a[_0x59cc06(0xbeb)][_0x59cc06(0x27a)](),_0x3df81a[_0x59cc06(0x13fc)][_0x59cc06(0x27a)](),_0x3df81a[_0x59cc06(0x9e3)][_0x59cc06(0x27a)](),_0x3df81a[_0x59cc06(0xde3)][_0x59cc06(0x27a)](),_0x3df81a['apiPresets'][_0x59cc06(0x27a)](),_0x3df81a[_0x59cc06(0xbf4)][_0x59cc06(0x27a)](),_0x3df81a[_0x59cc06(0xac4)]['toArray'](),_0x3df81a[_0x59cc06(0xd2c)][_0x59cc06(0x27a)](),_0x3df81a[_0x59cc06(0x14f6)][_0x59cc06(0x27a)](),_0x3df81a[_0x59cc06(0x679)][_0x59cc06(0x27a)](),_0x3df81a[_0x59cc06(0x86c)]['toArray'](),_0x3df81a[_0x59cc06(0xda0)]['toArray'](),_0x3df81a[_0x59cc06(0xb93)]['toArray'](),_0x3df81a[_0x59cc06(0x15b9)][_0x59cc06(0x27a)]()]);Object[_0x59cc06(0x102c)](_0x36d8a4,{'chats':_0x57e466,'worldBooks':_0x18dd59,'userStickers':_0x28b686,'apiConfig':_0x5834c1,'globalSettings':_0x2c85d5,'personaPresets':_0x15576b,'musicLibrary':_0x17ecc8,'qzoneSettings':_0x3e9e2d,'qzonePosts':_0x3e38ce,'qzoneAlbums':_0x53cf87,'qzonePhotos':_0x392840,'favorites':_0x27bf0b,'qzoneGroups':_0x2ea66b,'memories':_0x2e7ae5,'worldBookCategories':_0x786d67,'apiPresets':_0x1d6bb4,'shoppingProducts':_0x509013,'callRecords':_0x1f227d,'renderingRules':_0x60319d,'doubanPosts':_0x3559a4,'stickerCategories':_0x4fd6fd,'appearancePresets':_0x1954e7,'presets':_0x4f2e9d,'presetCategories':_0x1e7cb3,'npcs':_0x596b01});const _0x4ad6ae=new Blob([JSON[_0x59cc06(0x994)](_0x36d8a4,null,0x2)],{'type':_0x59cc06(0xa90)}),_0x32417b=URL[_0x59cc06(0x297)](_0x4ad6ae),_0x47b1ce=Object[_0x59cc06(0x102c)](document[_0x59cc06(0x219)]('a'),{'href':_0x32417b,'download':_0x59cc06(0x12e9)+new Date()[_0x59cc06(0xc66)]()[_0x59cc06(0x23f)]('T')[0x0]+'.json'});_0x47b1ce[_0x59cc06(0x740)](),URL[_0x59cc06(0x157c)](_0x32417b),await _0x1460c5(_0x59cc06(0xf2f),_0x59cc06(0x1317));}catch(_0x2bbdc7){console['error'](_0x59cc06(0x770),_0x2bbdc7),await _0x1460c5(_0x59cc06(0x95c),'发生了一个错误:\x20'+_0x2bbdc7[_0x59cc06(0x11f0)]);}}async function _0x52ee83(_0x552e33){const _0x81e0ba=_0x2b1222;try{await _0x3df81a[_0x81e0ba(0x13a5)]('rw',_0x3df81a[_0x81e0ba(0x308)],async()=>{const _0x4abf4e=_0x81e0ba;for(const _0x3235df of _0x3df81a['tables']){await _0x3235df['clear']();}for(const _0x8592c6 in _0x552e33){Array['isArray'](_0x552e33[_0x8592c6])&&(console[_0x4abf4e(0x57e)](_0x4abf4e(0x89c)+_0x8592c6+_0x4abf4e(0x15b7)+_0x552e33[_0x8592c6]['length']),await _0x3df81a[_0x4abf4e(0x12b7)](_0x8592c6)[_0x4abf4e(0x8b2)](_0x552e33[_0x8592c6]));}});}catch(_0x13d3fa){throw new Error(_0x81e0ba(0xcb8)+_0x13d3fa[_0x81e0ba(0x11f0)]);}}async function _0xbaca74(_0x21dc4c){const _0x1690b2=_0x2b1222;if(!_0x21dc4c)return;await _0x1460c5(_0x1690b2(0x11b7),'正在读取并解析备份文件...');try{const _0x24bd1a=await _0x21dc4c[_0x1690b2(0x40f)](),_0x788ea8=JSON[_0x1690b2(0x129c)](_0x24bd1a);let _0x523489,_0x216e8a;if(_0x788ea8[_0x1690b2(0xc6b)]&&typeof _0x788ea8[_0x1690b2(0xc6b)]==='object'&&(_0x788ea8[_0x1690b2(0xc6b)][_0x1690b2(0x589)]||_0x788ea8[_0x1690b2(0xc6b)][_0x1690b2(0x1453)]))console[_0x1690b2(0x57e)](_0x1690b2(0x7c3)),_0x523489=_0x788ea8[_0x1690b2(0xc6b)],_0x216e8a='streamed';else{if(_0x788ea8['chats']||_0x788ea8['worldBooks'])console[_0x1690b2(0x57e)](_0x1690b2(0x1d9)),_0x523489=_0x788ea8,_0x216e8a='legacy';else throw new Error(_0x1690b2(0xf1d));}pendingBackupData={'type':_0x216e8a,'content':_0x523489},_0x44d433(_0x523489);}catch(_0x2da8d9){console[_0x1690b2(0x127d)](_0x1690b2(0x61d),_0x2da8d9),pendingBackupData=null,await _0x1460c5(_0x1690b2(0x15ca),'文件解析或应用失败:\x20'+_0x2da8d9[_0x1690b2(0x11f0)]);}}function _0x44d433(_0x28e9c9){const _0x1082af=_0x2b1222,_0x29c882=document[_0x1082af(0x1f4)]('import-options-modal'),_0x1c0e64=document[_0x1082af(0x1f4)](_0x1082af(0x1e2));_0x1c0e64[_0x1082af(0xf21)]='';const _0x2e775b={'chats':'聊天会话','worldBooks':_0x1082af(0x11f9),'worldBookCategories':_0x1082af(0x84d),'presets':_0x1082af(0xae1),'presetCategories':_0x1082af(0x7ab),'userStickers':_0x1082af(0x314),'stickerCategories':_0x1082af(0xc0e),'customAvatarFrames':'头像框','apiConfig':'API配置','globalSettings':'全局设置','personaPresets':'人设预设','qzoneSettings':_0x1082af(0x109c),'qzonePosts':'动态','qzoneAlbums':'相册','favorites':'收藏','memories':'回忆','callRecords':_0x1082af(0x576),'shoppingProducts':'商品','apiPresets':_0x1082af(0x637),'renderingRules':_0x1082af(0x1540),'appearancePresets':_0x1082af(0x3c7),'npcs':_0x1082af(0x14a6)};let _0x4ad0b3=![];for(const _0x294956 in _0x2e775b){if(_0x28e9c9[_0x294956]&&(Array[_0x1082af(0x121f)](_0x28e9c9[_0x294956])?_0x28e9c9[_0x294956][_0x1082af(0x58a)]>0x0:_0x28e9c9[_0x294956])){const _0x5ebf66=Array['isArray'](_0x28e9c9[_0x294956])?_0x28e9c9[_0x294956][_0x1082af(0x58a)]:0x1,_0x2a766b=document[_0x1082af(0x219)]('li');_0x2a766b[_0x1082af(0x231)]=_0x2e775b[_0x294956]+':\x20'+_0x5ebf66+_0x1082af(0x233),_0x1c0e64[_0x1082af(0x6ce)](_0x2a766b),_0x4ad0b3=!![];}}!_0x4ad0b3&&(_0x1c0e64[_0x1082af(0xf21)]='<li>未在此文件中找到可识别的数据。</li>'),document['getElementById']('confirm-full-import-btn')[_0x1082af(0x1199)]=()=>{const _0x3327d4=_0x1082af;_0x29c882['classList'][_0x3327d4(0xa9c)](_0x3327d4(0xfca)),_0x54b2d4(pendingBackupData);},document[_0x1082af(0x1f4)](_0x1082af(0x1584))[_0x1082af(0x1199)]=()=>{const _0xa8e921=_0x1082af;_0x29c882[_0xa8e921(0x159b)][_0xa8e921(0xa9c)](_0xa8e921(0xfca)),_0x7ce468(pendingBackupData[_0xa8e921(0x128c)]);},document[_0x1082af(0x1f4)](_0x1082af(0xe37))[_0x1082af(0x1199)]=()=>{const _0x40a401=_0x1082af;_0x29c882[_0x40a401(0x159b)][_0x40a401(0xa9c)]('visible'),pendingBackupData=null;},_0x29c882[_0x1082af(0x159b)][_0x1082af(0x6a4)](_0x1082af(0xfca));}async function _0x54b2d4(_0x1b5dbc){const _0x905eee=_0x2b1222;if(!_0x1b5dbc)return;const _0x4d4a31=await _0x109970(_0x905eee(0x1da),_0x905eee(0x73f),{'confirmButtonClass':_0x905eee(0x1c6),'confirmText':_0x905eee(0x473)});if(!_0x4d4a31){pendingBackupData=null;return;}await _0x1460c5(_0x905eee(0x11b7),'正在执行完全导入，请勿关闭页面...');try{if(_0x1b5dbc[_0x905eee(0xcbd)]===_0x905eee(0x1068))await _0x52ee83(_0x1b5dbc[_0x905eee(0x128c)]);else{if(_0x1b5dbc[_0x905eee(0xcbd)]==='legacy')await _0x51f7da(_0x1b5dbc[_0x905eee(0x128c)]);else throw new Error(_0x905eee(0x58b));}await _0x1460c5(_0x905eee(0x1159),_0x905eee(0x11db)),setTimeout(()=>window[_0x905eee(0x15cb)][_0x905eee(0x100f)](),0x5dc);}catch(_0x2536e2){console[_0x905eee(0x127d)](_0x905eee(0xbea),_0x2536e2),await _0x1460c5(_0x905eee(0x15ca),_0x905eee(0x1084)+_0x2536e2['message']);}finally{pendingBackupData=null;}}function _0x7ce468(_0x523f3f){const _0xa398fe=_0x2b1222,_0x518145=document[_0xa398fe(0x1f4)](_0xa398fe(0x619)),_0x362657=document[_0xa398fe(0x1f4)](_0xa398fe(0x97c)),_0x5e8a1c=document[_0xa398fe(0x1f4)](_0xa398fe(0x1df));_0x362657[_0xa398fe(0xf21)]='',_0x5e8a1c[_0xa398fe(0xe56)]=!![];const _0x2eaa24={'chats':_0xa398fe(0x94c),'worldBooks':_0xa398fe(0x11f9),'worldBookCategories':_0xa398fe(0x84d),'presets':_0xa398fe(0xae1),'presetCategories':_0xa398fe(0x7ab),'userStickers':_0xa398fe(0x314),'stickerCategories':_0xa398fe(0xc0e),'customAvatarFrames':_0xa398fe(0xc8e),'apiConfig':_0xa398fe(0xef6),'globalSettings':_0xa398fe(0x371),'personaPresets':_0xa398fe(0x944),'qzoneSettings':_0xa398fe(0x109c),'qzonePosts':'动态','qzoneAlbums':'相册','favorites':'收藏','memories':'回忆','callRecords':_0xa398fe(0x576),'shoppingProducts':'商品','apiPresets':_0xa398fe(0x637),'renderingRules':_0xa398fe(0x1540),'appearancePresets':'外观预设','npcs':_0xa398fe(0x14a6)};let _0x2fb559=![];for(const _0x3d65f9 in _0x2eaa24){if(_0x523f3f[_0x3d65f9]&&(Array[_0xa398fe(0x121f)](_0x523f3f[_0x3d65f9])?_0x523f3f[_0x3d65f9][_0xa398fe(0x58a)]>0x0:_0x523f3f[_0x3d65f9])){const _0x41c6f4=Array['isArray'](_0x523f3f[_0x3d65f9])?_0x523f3f[_0x3d65f9][_0xa398fe(0x58a)]:0x1,_0x353c82=!Array[_0xa398fe(0x121f)](_0x523f3f[_0x3d65f9]),_0x5dd18d=document['createElement']('div');_0x5dd18d[_0xa398fe(0x7c6)]='clear-posts-item\x20selected',_0x5dd18d[_0xa398fe(0x746)]['typeId']=_0x3d65f9,_0x5dd18d['innerHTML']=_0xa398fe(0x1191)+_0x2eaa24[_0x3d65f9]+'\x20('+_0x41c6f4+_0xa398fe(0x13fb)+(_0x353c82?'<p\x20style=\x22font-size:\x2012px;\x20color:\x20#ff8c00;\x20margin:\x204px\x200\x200;\x22>(注意:\x20这将【覆盖】您当前的设置)</p>':'')+_0xa398fe(0x4c1),_0x362657[_0xa398fe(0x6ce)](_0x5dd18d),_0x2fb559=!![];}}!_0x2fb559&&(_0x362657['innerHTML']='<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x22>文件中未找到可合并的数据。</p>'),document[_0xa398fe(0x1f4)](_0xa398fe(0xaac))[_0xa398fe(0x1199)]=()=>_0x4e0d0c(pendingBackupData),document['getElementById']('cancel-selective-import-btn')[_0xa398fe(0x1199)]=()=>{const _0x369af7=_0xa398fe;_0x518145[_0x369af7(0x159b)][_0x369af7(0xa9c)](_0x369af7(0xfca)),pendingBackupData=null;},_0x5e8a1c[_0xa398fe(0xca8)]=_0x37e9e6=>{const _0x2090b=_0xa398fe,_0x3042a5=_0x37e9e6[_0x2090b(0xb57)][_0x2090b(0xe56)];_0x362657[_0x2090b(0x14bf)](_0x2090b(0x800))[_0x2090b(0x59b)](_0x172939=>{const _0x2d374d=_0x2090b;_0x172939[_0x2d374d(0x159b)]['toggle'](_0x2d374d(0xc3e),_0x3042a5),_0x172939['querySelector']('.checkbox')['classList'][_0x2d374d(0x1483)](_0x2d374d(0xc3e),_0x3042a5);});},_0x362657['onclick']=_0xed6e2f=>{const _0x5870a0=_0xa398fe,_0x59f82c=_0xed6e2f[_0x5870a0(0xb57)]['closest'](_0x5870a0(0x800));_0x59f82c&&(_0x59f82c['classList'][_0x5870a0(0x1483)](_0x5870a0(0xc3e)),_0x59f82c[_0x5870a0(0xeda)](_0x5870a0(0xf58))['classList'][_0x5870a0(0x1483)](_0x5870a0(0xc3e)));},_0x518145[_0xa398fe(0x159b)][_0xa398fe(0x6a4)](_0xa398fe(0xfca));}async function _0x4e0d0c(_0x5d04ed){const _0x33f464=_0x2b1222;if(!_0x5d04ed)return;const _0x2fdecf=document[_0x33f464(0x14bf)](_0x33f464(0xd77));if(_0x2fdecf[_0x33f464(0x58a)]===0x0){alert(_0x33f464(0xb10));return;}const _0x23b809=Array[_0x33f464(0xa81)](_0x2fdecf)[_0x33f464(0x1431)](_0x15d91c=>_0x15d91c[_0x33f464(0x746)][_0x33f464(0x705)]),_0x89b359=_0x5d04ed[_0x33f464(0x128c)],_0x32316c=await _0x109970(_0x33f464(0x150f),_0x33f464(0x863),{'confirmText':_0x33f464(0x7fe)});if(!_0x32316c)return;await _0x1460c5(_0x33f464(0x11b7),_0x33f464(0x1328));try{await _0x3df81a[_0x33f464(0x13a5)]('rw',_0x3df81a[_0x33f464(0x308)],async()=>{const _0x2e077c=_0x33f464;for(const _0x392ac6 of _0x23b809){const _0x5e61e4=_0x89b359[_0x392ac6];if(!_0x5e61e4)continue;const _0x347f16=_0x3df81a[_0x2e077c(0x12b7)](_0x392ac6);if(!_0x347f16){console[_0x2e077c(0xb3b)](_0x2e077c(0x1205)+_0x392ac6+_0x2e077c(0x692));continue;}if(Array[_0x2e077c(0x121f)](_0x5e61e4))console['log'](_0x2e077c(0x1168)+_0x5e61e4[_0x2e077c(0x58a)]+'\x20条记录到\x20'+_0x392ac6+_0x2e077c(0x629)),await _0x347f16[_0x2e077c(0x8b2)](_0x5e61e4);else{if(typeof _0x5e61e4==='object'&&_0x5e61e4['id'])console['log'](_0x2e077c(0x10c9)+_0x392ac6+_0x2e077c(0x629)),await _0x347f16[_0x2e077c(0x295)](_0x5e61e4);else{if(typeof _0x5e61e4===_0x2e077c(0xcc5)){console[_0x2e077c(0x57e)](_0x2e077c(0x658)+_0x392ac6+'...');const _0x3b4314=await _0x347f16[_0x2e077c(0x482)]()['first']()||{},_0x367a09={..._0x3b4314,..._0x5e61e4};if(_0x3b4314['id'])_0x367a09['id']=_0x3b4314['id'];else(_0x392ac6===_0x2e077c(0x226)||_0x392ac6===_0x2e077c(0x11ef)||_0x392ac6===_0x2e077c(0x12c0)||_0x392ac6===_0x2e077c(0xa7e))&&(_0x367a09['id']=_0x2e077c(0x70b));await _0x347f16[_0x2e077c(0x295)](_0x367a09);}}}}}),await _0x1460c5(_0x33f464(0x1075),_0x33f464(0x14dc)),setTimeout(()=>window[_0x33f464(0x15cb)]['reload'](),0x5dc);}catch(_0x359bd6){console[_0x33f464(0x127d)](_0x33f464(0x668),_0x359bd6),await _0x1460c5(_0x33f464(0x899),_0x33f464(0x1084)+_0x359bd6['message']);}finally{pendingBackupData=null;}}async function _0x51f7da(_0x4434c9){const _0x3d7de7=_0x2b1222;try{await _0x3df81a[_0x3d7de7(0x13a5)]('rw',_0x3df81a[_0x3d7de7(0x308)],async()=>{const _0x45f40c=_0x3d7de7;await _0x3df81a[_0x45f40c(0x589)][_0x45f40c(0x411)](),await _0x3df81a[_0x45f40c(0x1453)]['clear']();for(const _0x4d9e94 of _0x3df81a[_0x45f40c(0x308)]){await _0x4d9e94[_0x45f40c(0x411)]();}if(Array['isArray'](_0x4434c9[_0x45f40c(0x589)]))await _0x3df81a[_0x45f40c(0x589)][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0x589)]);if(Array[_0x45f40c(0x121f)](_0x4434c9[_0x45f40c(0x1453)]))await _0x3df81a['worldBooks']['bulkPut'](_0x4434c9[_0x45f40c(0x1453)]);if(Array['isArray'](_0x4434c9[_0x45f40c(0x1420)]))await _0x3df81a[_0x45f40c(0x1420)][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0x1420)]);if(_0x4434c9[_0x45f40c(0x226)])await _0x3df81a[_0x45f40c(0x226)][_0x45f40c(0x295)](_0x4434c9[_0x45f40c(0x226)]);if(_0x4434c9[_0x45f40c(0x12c0)])await _0x3df81a[_0x45f40c(0x12c0)][_0x45f40c(0x295)](_0x4434c9[_0x45f40c(0x12c0)]);if(Array[_0x45f40c(0x121f)](_0x4434c9[_0x45f40c(0xe16)]))await _0x3df81a[_0x45f40c(0xe16)][_0x45f40c(0x8b2)](_0x4434c9['personaPresets']);if(_0x4434c9[_0x45f40c(0xa7e)])await _0x3df81a['musicLibrary'][_0x45f40c(0x295)](_0x4434c9['musicLibrary']);if(_0x4434c9[_0x45f40c(0x11ef)])await _0x3df81a[_0x45f40c(0x11ef)][_0x45f40c(0x295)](_0x4434c9[_0x45f40c(0x11ef)]);if(Array[_0x45f40c(0x121f)](_0x4434c9[_0x45f40c(0x910)]))await _0x3df81a[_0x45f40c(0x910)][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0x910)]);if(Array['isArray'](_0x4434c9[_0x45f40c(0x20a)]))await _0x3df81a[_0x45f40c(0x20a)]['bulkPut'](_0x4434c9['qzoneAlbums']);if(Array[_0x45f40c(0x121f)](_0x4434c9[_0x45f40c(0xaee)]))await _0x3df81a['qzonePhotos'][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0xaee)]);if(Array[_0x45f40c(0x121f)](_0x4434c9[_0x45f40c(0xbeb)]))await _0x3df81a['favorites'][_0x45f40c(0x8b2)](_0x4434c9['favorites']);if(Array['isArray'](_0x4434c9[_0x45f40c(0x13fc)]))await _0x3df81a[_0x45f40c(0x13fc)][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0x13fc)]);if(Array[_0x45f40c(0x121f)](_0x4434c9[_0x45f40c(0x9e3)]))await _0x3df81a[_0x45f40c(0x9e3)][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0x9e3)]);if(Array['isArray'](_0x4434c9[_0x45f40c(0xde3)]))await _0x3df81a[_0x45f40c(0xde3)][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0xde3)]);if(Array[_0x45f40c(0x121f)](_0x4434c9[_0x45f40c(0xa9a)]))await _0x3df81a[_0x45f40c(0xa9a)][_0x45f40c(0x8b2)](_0x4434c9['apiPresets']);if(Array[_0x45f40c(0x121f)](_0x4434c9[_0x45f40c(0xbf4)]))await _0x3df81a[_0x45f40c(0xbf4)][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0xbf4)]);if(Array[_0x45f40c(0x121f)](_0x4434c9[_0x45f40c(0xac4)]))await _0x3df81a[_0x45f40c(0xac4)][_0x45f40c(0x8b2)](_0x4434c9['callRecords']);if(Array[_0x45f40c(0x121f)](_0x4434c9[_0x45f40c(0xd2c)]))await _0x3df81a[_0x45f40c(0xd2c)][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0xd2c)]);if(Array[_0x45f40c(0x121f)](_0x4434c9[_0x45f40c(0x14f6)]))await _0x3df81a['doubanPosts'][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0x14f6)]);if(Array['isArray'](_0x4434c9[_0x45f40c(0x679)]))await _0x3df81a[_0x45f40c(0x679)][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0x679)]);if(Array['isArray'](_0x4434c9[_0x45f40c(0x86c)]))await _0x3df81a['appearancePresets'][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0x86c)]);if(Array['isArray'](_0x4434c9[_0x45f40c(0xda0)]))await _0x3df81a['presets'][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0xda0)]);if(Array[_0x45f40c(0x121f)](_0x4434c9[_0x45f40c(0xb93)]))await _0x3df81a[_0x45f40c(0xb93)][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0xb93)]);if(Array[_0x45f40c(0x121f)](_0x4434c9['npcs']))await _0x3df81a[_0x45f40c(0x15b9)][_0x45f40c(0x8b2)](_0x4434c9[_0x45f40c(0x15b9)]);});}catch(_0x4740ea){throw new Error('旧版备份数据写入数据库失败:\x20'+_0x4740ea['message']);}}function _0x143b61(_0x37d1ee,_0x2f3a7d=![]){const _0x3ba905=_0x2b1222;if(!_0x37d1ee){_0x332cec['innerHTML']='',document[_0x3ba905(0x1f4)](_0x3ba905(0xddd))[_0x3ba905(0x215)][_0x3ba905(0x991)]='';return;}const _0x571452=_0x3ba905(0x1355),_0xf4cebc=_0x3ba905(0xb02)+_0x571452+_0x3ba905(0x470)+_0x37d1ee+_0x3ba905(0x8a9);if(_0x2f3a7d){const _0x17746a=document[_0x3ba905(0x1f4)](_0x3ba905(0x1406))||document[_0x3ba905(0x219)](_0x3ba905(0x215));_0x17746a['id']=_0x3ba905(0x1406),_0x17746a[_0x3ba905(0xf21)]=_0xf4cebc;if(!document[_0x3ba905(0x1f4)](_0x3ba905(0x1406)))document[_0x3ba905(0xda4)][_0x3ba905(0x6ce)](_0x17746a);document[_0x3ba905(0x1f4)]('font-preview')[_0x3ba905(0x215)][_0x3ba905(0x991)]='\x27'+_0x571452+'\x27,\x20\x27bulangni\x27,\x20sans-serif';}else _0x332cec['innerHTML']=_0x3ba905(0xec1)+_0xf4cebc+_0x3ba905(0x13a8)+_0x571452+_0x3ba905(0x7b5);}async function _0x1f5880(){const _0x4b2d22=_0x2b1222;_0x332cec['innerHTML']='',_0x1ae02e['globalSettings']['fontUrl']='',await _0x3df81a[_0x4b2d22(0x12c0)][_0x4b2d22(0x295)](_0x1ae02e[_0x4b2d22(0x12c0)]),document[_0x4b2d22(0x1f4)]('font-url-input')[_0x4b2d22(0x107e)]='',document[_0x4b2d22(0x1f4)](_0x4b2d22(0xddd))[_0x4b2d22(0x215)][_0x4b2d22(0x991)]='',alert(_0x4b2d22(0x581));}async function _0x18cf35(){const _0x521c32=_0x2b1222,[_0x4d78f5,_0x3d9456,_0x198529,_0x1fc9ef,_0x495960,_0x202c41,_0x8b0236,_0x26c5a1,_0x558b3f,_0x880ff6,_0x5ea549]=await Promise[_0x521c32(0x54b)]([_0x3df81a[_0x521c32(0x589)]['toArray'](),_0x3df81a[_0x521c32(0x226)][_0x521c32(0x13f8)](_0x521c32(0x70b)),_0x3df81a[_0x521c32(0x12c0)][_0x521c32(0x13f8)]('main'),_0x3df81a['userStickers']['toArray'](),_0x3df81a[_0x521c32(0x1453)][_0x521c32(0x27a)](),_0x3df81a[_0x521c32(0xa7e)][_0x521c32(0x13f8)](_0x521c32(0x70b)),_0x3df81a[_0x521c32(0xe16)][_0x521c32(0x27a)](),_0x3df81a[_0x521c32(0x11ef)]['get'](_0x521c32(0x70b)),_0x3df81a[_0x521c32(0xbeb)][_0x521c32(0x931)](_0x521c32(0x1388))['reverse']()['toArray'](),_0x3df81a[_0x521c32(0x9e3)][_0x521c32(0x27a)](),_0x3df81a[_0x521c32(0xda0)]['toArray']()]);_0x1ae02e['presets']=_0x5ea549||[];const _0xccf83f={'id':_0x521c32(0x70b),'showStatusBar':![],'wallpaper':'linear-gradient(135deg,\x20#89f7fe,\x20#66a6ff)','fontUrl':'','enableBackgroundActivity':![],'backgroundActivityInterval':0x3c,'blockCooldownHours':0x1,'apiTemperature':0.8,'appIcons':{..._0x3db8a1},'cphoneWallpaper':_0x521c32(0x130a),'cphoneAppIcons':{..._0x135614},'globalCss':'','notificationSoundUrl':'','widgetData':{},'globalChatBackground':'','enableAiDrawing':!![],'showPhoneFrame':![],'alwaysShowMusicIsland':![],'detachStatusBar':![],'enableMinimalChatUI':![],'chatActionButtonsOrder':null,'shoppingCategoryCount':0x3,'shoppingProductCount':0x8,'chatRenderWindow':0x32};_0x1ae02e[_0x521c32(0x12c0)]={..._0xccf83f,..._0x198529||{}},_0x1ae02e[_0x521c32(0x12c0)][_0x521c32(0x69e)]={..._0xccf83f[_0x521c32(0x69e)],..._0x1ae02e[_0x521c32(0x12c0)][_0x521c32(0x69e)]||{}},_0x1ae02e[_0x521c32(0x12c0)]['cphoneAppIcons']={..._0xccf83f['cphoneAppIcons'],..._0x1ae02e[_0x521c32(0x12c0)][_0x521c32(0x11df)]||{}},_0x4d78f5[_0x521c32(0x59b)](_0x1f9a32=>{const _0x470887=_0x521c32;typeof _0x1f9a32[_0x470887(0x6a8)][_0x470887(0x885)]===_0x470887(0x488)&&(_0x1f9a32[_0x470887(0x6a8)][_0x470887(0x885)]=!![]),!_0x1f9a32['settings']['lyricsPosition']&&(_0x1f9a32[_0x470887(0x6a8)]['lyricsPosition']={'vertical':_0x470887(0xe00),'horizontal':'center','offset':0xa}),!_0x1f9a32[_0x470887(0xe83)]&&!_0x1f9a32['settings']['myAvatarLibrary']&&(_0x1f9a32[_0x470887(0x6a8)][_0x470887(0x12ce)]=[]),!_0x1f9a32[_0x470887(0xe83)]&&typeof _0x1f9a32[_0x470887(0x96f)]===_0x470887(0x488)&&(_0x1f9a32['originalName']=_0x1f9a32[_0x470887(0x5d2)]);}),_0x1ae02e[_0x521c32(0x589)]=_0x4d78f5[_0x521c32(0x7b6)]((_0x1c9c6b,_0x5adbc4)=>{const _0x4bb43d=_0x521c32;if(typeof _0x5adbc4[_0x4bb43d(0xf2c)]===_0x4bb43d(0x488))_0x5adbc4[_0x4bb43d(0xf2c)]=0x0;_0x5adbc4[_0x4bb43d(0xe83)]&&(typeof _0x5adbc4[_0x4bb43d(0x6a8)]['enableBackgroundActivity']===_0x4bb43d(0x488)&&(_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0x605)]=!![]),_0x5adbc4[_0x4bb43d(0x1402)]&&_0x5adbc4[_0x4bb43d(0x1402)][_0x4bb43d(0x58a)]>0x0&&_0x5adbc4['members'][0x0][_0x4bb43d(0x5d2)]&&_0x5adbc4[_0x4bb43d(0x1402)]['forEach'](_0x304e1e=>{const _0x1fba00=_0x4bb43d;typeof _0x304e1e[_0x1fba00(0x96f)]===_0x1fba00(0x488)&&(_0x304e1e['originalName']=_0x304e1e[_0x1fba00(0x5d2)],_0x304e1e[_0x1fba00(0xd69)]=_0x304e1e['name'],delete _0x304e1e[_0x1fba00(0x5d2)]);}));if(!_0x5adbc4[_0x4bb43d(0x6a8)])_0x5adbc4[_0x4bb43d(0x6a8)]={};typeof _0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0xfa7)]===_0x4bb43d(0x488)&&(_0x5adbc4['settings'][_0x4bb43d(0xfa7)]=0xa);if(!_0x5adbc4[_0x4bb43d(0xe83)]&&!_0x5adbc4[_0x4bb43d(0x1589)])_0x5adbc4[_0x4bb43d(0x1589)]={'text':'在线','lastUpdate':Date[_0x4bb43d(0xd6e)](),'isBusy':![]};if(!_0x5adbc4['isGroup']&&!_0x5adbc4['relationship'])_0x5adbc4[_0x4bb43d(0x13ab)]={'status':'friend','blockedTimestamp':null,'applicationReason':''};if(!_0x5adbc4[_0x4bb43d(0xe83)]&&(!_0x5adbc4[_0x4bb43d(0x6a8)]||!_0x5adbc4[_0x4bb43d(0x6a8)]['aiAvatarLibrary'])){if(!_0x5adbc4[_0x4bb43d(0x6a8)])_0x5adbc4['settings']={};_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0xb77)]=[];}_0x5adbc4[_0x4bb43d(0xe83)]&&(_0x5adbc4[_0x4bb43d(0x1402)]||[])['forEach'](_0x317f28=>{const _0x3abe25=_0x4bb43d;if(typeof _0x317f28['avatarFrame']===_0x3abe25(0x488))_0x317f28['avatarFrame']='';});if(!_0x5adbc4[_0x4bb43d(0x822)])_0x5adbc4[_0x4bb43d(0x822)]={'totalTime':0x0};_0x5adbc4[_0x4bb43d(0x6a8)]&&_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0xe85)]&&!_0x5adbc4['settings']['linkedWorldBookIds']&&(_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0x1469)]=[_0x5adbc4['settings'][_0x4bb43d(0xe85)]],delete _0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0xe85)]);if(typeof _0x5adbc4[_0x4bb43d(0x6e3)]===_0x4bb43d(0x488))_0x5adbc4['isPinned']=![];!_0x5adbc4[_0x4bb43d(0xe83)]&&typeof _0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0xe31)]===_0x4bb43d(0x488)&&(_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0xe31)]='我');if(_0x5adbc4[_0x4bb43d(0xe83)]&&_0x5adbc4[_0x4bb43d(0x1402)]){let _0x3ab23a=![];_0x4d78f5[_0x4bb43d(0x59b)](_0x5378a2=>{const _0x4c39ad=_0x4bb43d;_0x5378a2['id']===_0x5adbc4['id']&&_0x5378a2['originalName']&&delete _0x5378a2[_0x4c39ad(0x96f)];}),_0x5adbc4['members'][_0x4bb43d(0x59b)](_0x4f3a02=>{const _0x399762=_0x4bb43d,_0x4acb20=_0x4d78f5[_0x399762(0x13b7)](_0x321d23=>_0x321d23['id']===_0x4f3a02['id']);if(_0x4acb20&&_0x4acb20['settings']){const _0x256ea2=_0x4acb20[_0x399762(0x6a8)]['aiAvatarFrame']||'';_0x4f3a02[_0x399762(0x757)]!==_0x256ea2&&(_0x4f3a02[_0x399762(0x757)]=_0x256ea2,_0x3ab23a=!![]);}else typeof _0x4f3a02[_0x399762(0x757)]==='undefined'&&(_0x4f3a02[_0x399762(0x757)]='',_0x3ab23a=!![]);});if(_0x3ab23a)_0x3df81a[_0x4bb43d(0x589)]['put'](_0x5adbc4);}if(!_0x5adbc4['settings']['enableAutoMemory'])_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0xd16)]=![];if(!_0x5adbc4[_0x4bb43d(0x6a8)]['autoMemoryInterval'])_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0x58d)]=0x14;if(!_0x5adbc4[_0x4bb43d(0x5fb)])_0x5adbc4[_0x4bb43d(0x5fb)]=[];if(!_0x5adbc4[_0x4bb43d(0xb23)])_0x5adbc4[_0x4bb43d(0xb23)]=0x0;if(!_0x5adbc4[_0x4bb43d(0xe83)]){typeof _0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0x605)]===_0x4bb43d(0x488)&&(_0x5adbc4['settings'][_0x4bb43d(0x605)]=!![]);typeof _0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0x6ab)]===_0x4bb43d(0x488)&&(_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0x6ab)]=![]);if(!_0x5adbc4['status'])_0x5adbc4[_0x4bb43d(0x1589)]={'text':'在线','lastUpdate':Date[_0x4bb43d(0xd6e)](),'isBusy':![]};if(!_0x5adbc4[_0x4bb43d(0x13ab)])_0x5adbc4[_0x4bb43d(0x13ab)]={'status':'friend','blockedTimestamp':null,'applicationReason':''};if(!_0x5adbc4[_0x4bb43d(0x6a8)]||!_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0xb77)]){if(!_0x5adbc4['settings'])_0x5adbc4[_0x4bb43d(0x6a8)]={};_0x5adbc4['settings'][_0x4bb43d(0xb77)]=[];}if(typeof _0x5adbc4['settings'][_0x4bb43d(0x3f6)]==='undefined')_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0x3f6)]=![];if(typeof _0x5adbc4[_0x4bb43d(0x6a8)]['offlineMinLength']===_0x4bb43d(0x488))_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0x5b0)]=0x64;if(typeof _0x5adbc4['settings'][_0x4bb43d(0x873)]===_0x4bb43d(0x488))_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0x873)]=0x12c;typeof _0x5adbc4['settings'][_0x4bb43d(0xf16)]==='undefined'&&(_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0xf16)]=![]);if(typeof _0x5adbc4[_0x4bb43d(0xbae)]===_0x4bb43d(0x488))_0x5adbc4['heartfeltVoice']=_0x4bb43d(0x629);if(typeof _0x5adbc4[_0x4bb43d(0x3d2)]===_0x4bb43d(0x488))_0x5adbc4[_0x4bb43d(0x3d2)]='...';!Array['isArray'](_0x5adbc4[_0x4bb43d(0xc34)])&&(_0x5adbc4[_0x4bb43d(0xc34)]=[]);}return typeof _0x5adbc4['settings']['stickerCategoryIds']==='undefined'&&(_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0xfcb)]?_0x5adbc4[_0x4bb43d(0x6a8)]['stickerCategoryIds']=[_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0xfcb)]]:_0x5adbc4[_0x4bb43d(0x6a8)][_0x4bb43d(0x291)]=[],delete _0x5adbc4[_0x4bb43d(0x6a8)]['stickerCategoryId']),_0x1c9c6b[_0x5adbc4['id']]=_0x5adbc4,_0x1c9c6b;},{});const _0x21b9df=[];_0x880ff6[_0x521c32(0x59b)](_0x42a33d=>{const _0x632cfa=_0x521c32;if(_0x42a33d['type']==='ai_generated'&&_0x42a33d['authorName']&&!_0x42a33d['authorId']){const _0x3d6d34=_0x4d78f5['find'](_0x3d4c0a=>!_0x3d4c0a[_0x632cfa(0xe83)]&&_0x3d4c0a[_0x632cfa(0x96f)]===_0x42a33d[_0x632cfa(0xc8c)]);if(_0x3d6d34)_0x42a33d[_0x632cfa(0x12cf)]=_0x3d6d34['id'],_0x21b9df['push'](_0x42a33d);else{const _0x19ea01=_0x4d78f5['find'](_0x7c8aca=>!_0x7c8aca[_0x632cfa(0xe83)]&&_0x7c8aca['name']===_0x42a33d[_0x632cfa(0xc8c)]);_0x19ea01&&(_0x42a33d[_0x632cfa(0x12cf)]=_0x19ea01['id'],_0x21b9df[_0x632cfa(0x1426)](_0x42a33d));}}}),_0x21b9df[_0x521c32(0x58a)]>0x0&&await _0x3df81a[_0x521c32(0x9e3)][_0x521c32(0x8b2)](_0x21b9df),_0x1ae02e[_0x521c32(0x226)]=_0x3d9456||{'id':_0x521c32(0x70b),'proxyUrl':'','apiKey':'','model':'','secondaryProxyUrl':'','secondaryApiKey':'','secondaryModel':'','minimaxGroupId':'','minimaxApiKey':'','minimaxModel':'speech-01'},_0x1ae02e[_0x521c32(0x1420)]=_0x1fc9ef||[],_0x1ae02e[_0x521c32(0x1453)]=_0x495960||[],_0x5419de[_0x521c32(0x560)]=_0x202c41?.[_0x521c32(0x560)]||[],_0x1ae02e[_0x521c32(0xe16)]=_0x8b0236||[],_0x1ae02e[_0x521c32(0x11ef)]=_0x26c5a1||{'id':'main','nickname':_0x521c32(0xee7),'avatar':_0x521c32(0x4bc),'banner':'https://files.catbox.moe/r5heyt.gif'},allFavoriteItems=_0x558b3f||[];}async function _0x549080(){const _0x1a0226=_0x2b1222;await _0x3df81a['musicLibrary'][_0x1a0226(0x295)]({'id':_0x1a0226(0x70b),'playlist':_0x5419de[_0x1a0226(0x560)]});}function _0x463b94(_0xfcb5e8){const _0x37bded=_0x2b1222;if(!_0xfcb5e8)return'';const _0x3bdc86=new Date(_0xfcb5e8),_0x405eb4=String(_0x3bdc86[_0x37bded(0x4ee)]())[_0x37bded(0x1189)](0x2,'0'),_0x14ba3a=String(_0x3bdc86[_0x37bded(0x1465)]())[_0x37bded(0x1189)](0x2,'0');return _0x405eb4+':'+_0x14ba3a;}function _0x3f7f7a(_0x48b9fc){const _0x37ac1b=_0x2b1222,_0x370cb2=Date[_0x37ac1b(0xd6e)](),_0x58723b=Math[_0x37ac1b(0x123c)]((_0x370cb2-_0x48b9fc)/0x3e8);if(_0x58723b<0x3c)return'刚刚';const _0x3cdfcf=Math['floor'](_0x58723b/0x3c);if(_0x3cdfcf<0x3c)return _0x3cdfcf+_0x37ac1b(0xe17);const _0x38bc68=Math['floor'](_0x3cdfcf/0x3c);if(_0x38bc68<0x18)return _0x38bc68+'小时前';const _0xe6cd20=Math[_0x37ac1b(0x123c)](_0x38bc68/0x18);if(_0xe6cd20<0x1e)return _0xe6cd20+'天前';const _0x4fb752=Math[_0x37ac1b(0x123c)](_0xe6cd20/0x1e);if(_0x4fb752<0xc)return'大约'+_0x4fb752+_0x37ac1b(0xca2);const _0x4d5315=Math['floor'](_0xe6cd20/0x16d);return'大约'+_0x4d5315+'年前';}function _0x415cd3(_0x30e65f){const _0x1b672c=_0x2b1222;if(!_0x30e65f)return'';const _0x351fd6=new Date(),_0x31ad15=new Date(_0x30e65f),_0x4c750f=String(_0x31ad15['getHours']())[_0x1b672c(0x1189)](0x2,'0'),_0x4208d5=String(_0x31ad15[_0x1b672c(0x1465)]())[_0x1b672c(0x1189)](0x2,'0'),_0x3db345=_0x4c750f+':'+_0x4208d5;if(_0x351fd6[_0x1b672c(0xee2)]()===_0x31ad15[_0x1b672c(0xee2)]())return _0x1b672c(0x77c)+_0x3db345;const _0x51f34b=new Date();_0x51f34b['setDate'](_0x351fd6[_0x1b672c(0x772)]()-0x1);if(_0x51f34b[_0x1b672c(0xee2)]()===_0x31ad15[_0x1b672c(0xee2)]())return _0x1b672c(0x5c6)+_0x3db345;if(_0x351fd6[_0x1b672c(0x1567)]()===_0x31ad15['getFullYear']()){const _0x52ac23=String(_0x31ad15[_0x1b672c(0x45d)]()+0x1),_0x378786=String(_0x31ad15[_0x1b672c(0x772)]());return _0x52ac23+'月'+_0x378786+'日\x20'+_0x3db345;}const _0x1929fd=_0x31ad15[_0x1b672c(0x1567)](),_0x5b3af8=String(_0x31ad15[_0x1b672c(0x45d)]()+0x1),_0x44dddb=String(_0x31ad15[_0x1b672c(0x772)]());return _0x1929fd+'年'+_0x5b3af8+'月'+_0x44dddb+'日\x20'+_0x3db345;}function _0x4e1ed1(){const _0x217c90=_0x2b1222,_0x4022ef=_0x3b1556();document['getElementById']('nai-resolution')[_0x217c90(0x107e)]=_0x4022ef['resolution'],document[_0x217c90(0x1f4)](_0x217c90(0x1346))[_0x217c90(0x107e)]=_0x4022ef['steps'],document['getElementById'](_0x217c90(0xae0))[_0x217c90(0x107e)]=_0x4022ef[_0x217c90(0x140e)],document[_0x217c90(0x1f4)](_0x217c90(0x1579))[_0x217c90(0x107e)]=_0x4022ef[_0x217c90(0x115d)],document[_0x217c90(0x1f4)](_0x217c90(0x459))['value']=_0x4022ef[_0x217c90(0x11c2)],document['getElementById'](_0x217c90(0xc20))[_0x217c90(0x107e)]=_0x4022ef[_0x217c90(0x826)],document[_0x217c90(0x1f4)](_0x217c90(0x170))['checked']=_0x4022ef[_0x217c90(0xc1a)],document['getElementById'](_0x217c90(0x646))['checked']=_0x4022ef[_0x217c90(0x114d)],document[_0x217c90(0x1f4)](_0x217c90(0x1032))[_0x217c90(0xe56)]=_0x4022ef[_0x217c90(0x353)],document[_0x217c90(0x1f4)](_0x217c90(0xa06))['value']=_0x4022ef['default_positive'],document[_0x217c90(0x1f4)](_0x217c90(0x992))[_0x217c90(0x107e)]=_0x4022ef[_0x217c90(0x1508)],document['getElementById'](_0x217c90(0x1274))[_0x217c90(0x107e)]=_0x4022ef['cors_proxy'],document[_0x217c90(0x1f4)](_0x217c90(0x1e8))[_0x217c90(0x107e)]=_0x4022ef[_0x217c90(0x703)]||'';const _0x3cc617=document[_0x217c90(0x1f4)]('nai-custom-proxy-group');_0x3cc617[_0x217c90(0x215)]['display']=_0x4022ef[_0x217c90(0x4fd)]==='custom'?_0x217c90(0x361):_0x217c90(0x1b5);}function _0x232297(){const _0x4d64c5=_0x2b1222,_0x12e9c7=document['getElementById'](_0x4d64c5(0x6d8))['checked'],_0x1cb0d7=document[_0x4d64c5(0x1f4)](_0x4d64c5(0xf6b))[_0x4d64c5(0x107e)],_0x23fb5c=document[_0x4d64c5(0x1f4)](_0x4d64c5(0x8f7))[_0x4d64c5(0x107e)][_0x4d64c5(0x4a2)]();localStorage[_0x4d64c5(0xae8)](_0x4d64c5(0x15b8),_0x12e9c7),localStorage[_0x4d64c5(0xae8)](_0x4d64c5(0xf6b),_0x1cb0d7),localStorage[_0x4d64c5(0xae8)](_0x4d64c5(0x8f7),_0x23fb5c);const _0x5ec867={'resolution':document[_0x4d64c5(0x1f4)](_0x4d64c5(0xf45))[_0x4d64c5(0x107e)],'steps':parseInt(document['getElementById']('nai-steps')[_0x4d64c5(0x107e)]),'cfg_scale':parseFloat(document[_0x4d64c5(0x1f4)](_0x4d64c5(0xae0))[_0x4d64c5(0x107e)]),'sampler':document[_0x4d64c5(0x1f4)](_0x4d64c5(0x1579))[_0x4d64c5(0x107e)],'seed':parseInt(document[_0x4d64c5(0x1f4)]('nai-seed')[_0x4d64c5(0x107e)]),'uc_preset':parseInt(document[_0x4d64c5(0x1f4)](_0x4d64c5(0xc20))[_0x4d64c5(0x107e)]),'quality_toggle':document[_0x4d64c5(0x1f4)](_0x4d64c5(0x170))[_0x4d64c5(0xe56)],'smea':document['getElementById'](_0x4d64c5(0x646))[_0x4d64c5(0xe56)],'smea_dyn':document[_0x4d64c5(0x1f4)](_0x4d64c5(0x1032))[_0x4d64c5(0xe56)],'default_positive':document['getElementById']('nai-default-positive')[_0x4d64c5(0x107e)],'default_negative':document['getElementById']('nai-default-negative')['value'],'cors_proxy':document['getElementById'](_0x4d64c5(0x1274))[_0x4d64c5(0x107e)],'custom_proxy_url':document[_0x4d64c5(0x1f4)](_0x4d64c5(0x1e8))['value']};localStorage[_0x4d64c5(0xae8)](_0x4d64c5(0x18c),JSON[_0x4d64c5(0x994)](_0x5ec867));}function _0x288224(){const _0x3ade43=_0x2b1222;localStorage['removeItem'](_0x3ade43(0x18c)),_0x4e1ed1(),alert(_0x3ade43(0xafa));}function _0x3b1556(){const _0x56d791=_0x2b1222,_0x10c9b2={'resolution':_0x56d791(0x508),'steps':0x1c,'cfg_scale':0x5,'sampler':'k_euler_ancestral','seed':-0x1,'uc_preset':0x1,'quality_toggle':!![],'smea':!![],'smea_dyn':![],'default_positive':'masterpiece,\x20best\x20quality,\x201girl,\x20beautiful,\x20detailed\x20face,\x20detailed\x20eyes,\x20long\x20hair,\x20anime\x20style','default_negative':'lowres,\x20bad\x20anatomy,\x20bad\x20hands,\x20text,\x20error,\x20missing\x20fingers,\x20extra\x20digit,\x20fewer\x20digits,\x20cropped,\x20worst\x20quality,\x20low\x20quality,\x20normal\x20quality,\x20jpeg\x20artifacts,\x20signature,\x20watermark,\x20username,\x20blurry','cors_proxy':_0x56d791(0x87e),'custom_proxy_url':''},_0x213013=localStorage[_0x56d791(0x587)](_0x56d791(0x18c));if(_0x213013)try{return{..._0x10c9b2,...JSON[_0x56d791(0x129c)](_0x213013)};}catch(_0x34c8b4){return _0x10c9b2;}return _0x10c9b2;}async function _0x930e42(_0x2a63d7,_0x567a7e){const _0x9aea0c=_0x2b1222;console[_0x9aea0c(0x57e)]('🎨\x20[NAI核心生成]\x20开始...\x20Prompt:\x20\x22'+_0x2a63d7+_0x9aea0c(0x59f)+_0x567a7e);const _0x220de5=_0x50a9eb(_0x567a7e),_0x48d707=_0x2a63d7+',\x20'+_0x220de5[_0x9aea0c(0xc26)],_0x5bfb89=_0x220de5[_0x9aea0c(0x33a)];console[_0x9aea0c(0x57e)](_0x9aea0c(0x3a3)+(_0x220de5['source']===_0x9aea0c(0x1381)?_0x9aea0c(0x148d):'系统')+_0x9aea0c(0xfd9)),console[_0x9aea0c(0x57e)](_0x9aea0c(0x559),_0x48d707),console[_0x9aea0c(0x57e)]('\x20\x20\x20[-]\x20最终负面提示词:',_0x5bfb89);const _0x2e221b=localStorage['getItem'](_0x9aea0c(0x8f7)),_0x39b6d2=localStorage[_0x9aea0c(0x587)](_0x9aea0c(0xf6b))||_0x9aea0c(0xf90),_0x2587fa=_0x3b1556();if(!_0x2e221b)throw new Error('NovelAI\x20API\x20Key未配置。请在NovelAI设置中填写API\x20Key。');const [_0x2bfdb7,_0x233d32]=_0x2587fa[_0x9aea0c(0xf1c)][_0x9aea0c(0x23f)]('x')[_0x9aea0c(0x1431)](Number);let _0x17f489;_0x39b6d2['includes'](_0x9aea0c(0x3ba))?_0x17f489={'input':_0x48d707,'model':_0x39b6d2,'action':_0x9aea0c(0xb45),'parameters':{'params_version':0x3,'width':_0x2bfdb7,'height':_0x233d32,'scale':_0x2587fa['cfg_scale'],'sampler':_0x2587fa[_0x9aea0c(0x115d)],'steps':_0x2587fa[_0x9aea0c(0x13ad)],'seed':_0x2587fa[_0x9aea0c(0x11c2)]===-0x1?Math[_0x9aea0c(0x123c)](Math[_0x9aea0c(0x13ae)]()*0x2540be3ff):_0x2587fa[_0x9aea0c(0x11c2)],'n_samples':0x1,'ucPreset':_0x2587fa[_0x9aea0c(0x826)],'qualityToggle':_0x2587fa[_0x9aea0c(0xc1a)],'add_original_image':!![],'noise_schedule':_0x9aea0c(0xec0),'v4_prompt':{'caption':{'base_caption':_0x48d707,'char_captions':[]},'use_coords':![],'use_order':!![]},'v4_negative_prompt':{'caption':{'base_caption':_0x5bfb89,'char_captions':[]},'legacy_uc':![]},'negative_prompt':_0x5bfb89,'autoSmea':![],'dynamic_thresholding':![],'controlnet_strength':0x1,'legacy':![],'cfg_rescale':0x0,'legacy_v3_extend':![],'skip_cfg_above_sigma':null,'use_coords':![],'legacy_uc':![],'normalize_reference_strength_multiple':!![],'inpaintImg2ImgStrength':0x1,'characterPrompts':[],'deliberate_euler_ancestral_bug':![],'prefer_brownian':!![]}}:_0x17f489={'input':_0x48d707,'model':_0x39b6d2,'action':_0x9aea0c(0xb45),'parameters':{'width':_0x2bfdb7,'height':_0x233d32,'scale':_0x2587fa[_0x9aea0c(0x140e)],'sampler':_0x2587fa[_0x9aea0c(0x115d)],'steps':_0x2587fa[_0x9aea0c(0x13ad)],'seed':_0x2587fa[_0x9aea0c(0x11c2)]===-0x1?Math[_0x9aea0c(0x123c)](Math[_0x9aea0c(0x13ae)]()*0x2540be3ff):_0x2587fa[_0x9aea0c(0x11c2)],'n_samples':0x1,'ucPreset':_0x2587fa[_0x9aea0c(0x826)],'qualityToggle':_0x2587fa[_0x9aea0c(0xc1a)],'sm':_0x2587fa[_0x9aea0c(0x114d)],'sm_dyn':_0x2587fa[_0x9aea0c(0x353)],'negative_prompt':_0x5bfb89,'dynamic_thresholding':![],'controlnet_strength':0x1,'legacy':![],'add_original_image':![],'cfg_rescale':0x0,'noise_schedule':_0x9aea0c(0x26e)}};console[_0x9aea0c(0x57e)]('🚀\x20发送NAI请求:',_0x17f489);let _0x506831;_0x39b6d2[_0x9aea0c(0xe82)](_0x9aea0c(0x3ba))?_0x506831='https://image.novelai.net/ai/generate-image-stream':_0x506831=_0x9aea0c(0x65b);let _0x2f0ff4=_0x2587fa[_0x9aea0c(0x4fd)];_0x2f0ff4===_0x9aea0c(0xb42)&&(_0x2f0ff4=_0x2587fa[_0x9aea0c(0x703)]||'');_0x2f0ff4&&_0x2f0ff4!==''&&(_0x506831=_0x2f0ff4+encodeURIComponent(_0x506831));const _0x4f13c8=await fetch(_0x506831,{'method':_0x9aea0c(0x12d9),'headers':{'Content-Type':_0x9aea0c(0xa90),'Authorization':_0x9aea0c(0xf03)+_0x2e221b},'body':JSON[_0x9aea0c(0x994)](_0x17f489)});if(!_0x4f13c8['ok']){const _0x19fff2=await _0x4f13c8[_0x9aea0c(0x40f)]();throw new Error(_0x9aea0c(0x14ef)+_0x4f13c8[_0x9aea0c(0x1589)]+_0x9aea0c(0x126a)+_0x19fff2);}const _0x3372ea=_0x4f13c8[_0x9aea0c(0x3de)][_0x9aea0c(0x13f8)](_0x9aea0c(0xded));let _0x2aa4a9,_0x3e214d;if(_0x3372ea&&_0x3372ea['includes'](_0x9aea0c(0x9a9))){const _0x164727=await _0x4f13c8[_0x9aea0c(0x40f)](),_0x2b7280=_0x164727[_0x9aea0c(0x4a2)]()[_0x9aea0c(0x23f)]('\x0a');let _0x3765f2=null;for(let _0x4af499=_0x2b7280[_0x9aea0c(0x58a)]-0x1;_0x4af499>=0x0;_0x4af499--){const _0x543a17=_0x2b7280[_0x4af499][_0x9aea0c(0x4a2)]();if(_0x543a17[_0x9aea0c(0xebf)](_0x9aea0c(0xabd))&&_0x543a17!==_0x9aea0c(0x2e6)){const _0x2b0693=_0x543a17['substring'](0x6);try{const _0x42d50a=JSON[_0x9aea0c(0x129c)](_0x2b0693);if(_0x42d50a['event_type']==='final'&&_0x42d50a['image']){_0x3765f2=_0x42d50a[_0x9aea0c(0x685)];break;}if(_0x42d50a['data']){_0x3765f2=_0x42d50a['data'];break;}if(_0x42d50a[_0x9aea0c(0x685)]){_0x3765f2=_0x42d50a[_0x9aea0c(0x685)];break;}}catch(_0x37981c){_0x3765f2=_0x2b0693;break;}}}if(!_0x3765f2)throw new Error(_0x9aea0c(0x43b));const _0x306658=_0x3765f2['startsWith'](_0x9aea0c(0xb62)),_0x44a5b2=_0x3765f2[_0x9aea0c(0xebf)](_0x9aea0c(0x574));if(_0x306658||_0x44a5b2)_0x3e214d=_0x9aea0c(0xd32)+(_0x306658?'image/png':'image/jpeg')+_0x9aea0c(0xcd1)+_0x3765f2;else{const _0x23091d=atob(_0x3765f2),_0x477e04=new Uint8Array(_0x23091d[_0x9aea0c(0x58a)]);for(let _0x409d76=0x0;_0x409d76<_0x23091d[_0x9aea0c(0x58a)];_0x409d76++)_0x477e04[_0x409d76]=_0x23091d[_0x9aea0c(0x109b)](_0x409d76);_0x2aa4a9=new Blob([_0x477e04]);}}else _0x2aa4a9=await _0x4f13c8[_0x9aea0c(0x128e)]();if(!_0x3e214d&&_0x2aa4a9){if(typeof JSZip===_0x9aea0c(0x488))throw new Error(_0x9aea0c(0x388));const _0x4915b4=await JSZip[_0x9aea0c(0xaf0)](_0x2aa4a9);let _0x4a61dd=null;for(let _0x4222df in _0x4915b4[_0x9aea0c(0x8b1)]){if(_0x4222df[_0x9aea0c(0xba5)](/\.(png|jpg|jpeg|webp)$/i)){_0x4a61dd=_0x4915b4[_0x9aea0c(0x8b1)][_0x4222df];break;}}if(!_0x4a61dd)throw new Error('ZIP文件中未找到图片');const _0x22bf4f=await _0x4a61dd[_0x9aea0c(0x8e3)](_0x9aea0c(0x128e));_0x3e214d=await new Promise((_0x5f4f27,_0x105b23)=>{const _0x12bebe=_0x9aea0c,_0x398289=new FileReader();_0x398289[_0x12bebe(0x1d8)]=()=>_0x5f4f27(_0x398289[_0x12bebe(0xbc9)]),_0x398289[_0x12bebe(0xdf5)]=_0x105b23,_0x398289[_0x12bebe(0x21e)](_0x22bf4f);});}return console['log'](_0x9aea0c(0x14c6)),{'imageUrl':_0x3e214d,'fullPrompt':_0x48d707};}function _0x50a9eb(_0x359e2a){const _0x4a2f22=_0x2b1222,_0x3bd1f1=_0x3b1556();if(!_0x359e2a||!_0x1ae02e[_0x4a2f22(0x589)][_0x359e2a])return console['log'](_0x4a2f22(0xf84)),{'positive':_0x3bd1f1['default_positive'],'negative':_0x3bd1f1['default_negative'],'source':_0x4a2f22(0x1594)};const _0x4f3bea=_0x1ae02e[_0x4a2f22(0x589)][_0x359e2a],_0x1125aa=_0x4f3bea['settings'][_0x4a2f22(0x155d)]||{};return _0x1125aa[_0x4a2f22(0x31d)]===_0x4a2f22(0x1381)?(console[_0x4a2f22(0x57e)](_0x4a2f22(0xcff)),console[_0x4a2f22(0x57e)](_0x4a2f22(0xeb9),_0x1125aa[_0x4a2f22(0x62e)]||_0x4a2f22(0x6e6)),console[_0x4a2f22(0x57e)](_0x4a2f22(0x110f),_0x1125aa['characterNegativePrompt']||_0x4a2f22(0x6e6)),{'positive':_0x1125aa[_0x4a2f22(0x62e)]||'','negative':_0x1125aa[_0x4a2f22(0x1220)]||'','source':_0x4a2f22(0x1381)}):(console['log']('✅\x20NAI提示词：使用系统配置'),console['log']('\x20\x20\x20正面:',_0x3bd1f1[_0x4a2f22(0xce5)]||_0x4a2f22(0x6e6)),console[_0x4a2f22(0x57e)](_0x4a2f22(0x110f),_0x3bd1f1['default_negative']||_0x4a2f22(0x6e6)),{'positive':_0x3bd1f1[_0x4a2f22(0xce5)],'negative':_0x3bd1f1['default_negative'],'source':_0x4a2f22(0x1594)});}async function _0x560edc(){const _0x5edc73=_0x2b1222,_0x4d6f05=document[_0x5edc73(0x1f4)]('novelai-api-key')[_0x5edc73(0x107e)]['trim'](),_0x202ba2=document['getElementById'](_0x5edc73(0xf6b))['value'],_0x4f2ab1=document[_0x5edc73(0x1f4)](_0x5edc73(0xae2))[_0x5edc73(0x107e)][_0x5edc73(0x4a2)]();if(!_0x4d6f05){alert(_0x5edc73(0x120e));return;}if(!_0x4f2ab1){alert(_0x5edc73(0x15ce));return;}const _0x751afd=_0x3b1556(),_0xa2423b=document[_0x5edc73(0x1f4)](_0x5edc73(0x677))[_0x5edc73(0x107e)]['trim'](),_0x5a514a=document[_0x5edc73(0x1f4)](_0x5edc73(0xcd0)),_0xc26944=document[_0x5edc73(0x1f4)]('nai-test-result'),_0x413993=document[_0x5edc73(0x1f4)](_0x5edc73(0xdcb)),_0x45adf6=document[_0x5edc73(0x1f4)](_0x5edc73(0x9a0));_0x5a514a[_0x5edc73(0x215)][_0x5edc73(0x887)]='block',_0xc26944['style'][_0x5edc73(0x887)]='none',_0x413993[_0x5edc73(0x215)][_0x5edc73(0x887)]=_0x5edc73(0x1b5),_0x45adf6[_0x5edc73(0xa0d)]=!![],_0x45adf6[_0x5edc73(0x231)]='生成中...';try{const [_0x2b3ef7,_0x33dce4]=_0x751afd[_0x5edc73(0xf1c)][_0x5edc73(0x23f)]('x')[_0x5edc73(0x1431)](Number);let _0x53285c;_0x202ba2[_0x5edc73(0xe82)](_0x5edc73(0x3ba))?_0x53285c={'input':_0x4f2ab1,'model':_0x202ba2,'action':_0x5edc73(0xb45),'parameters':{'params_version':0x3,'width':_0x2b3ef7,'height':_0x33dce4,'scale':_0x751afd[_0x5edc73(0x140e)],'sampler':_0x751afd[_0x5edc73(0x115d)],'steps':_0x751afd[_0x5edc73(0x13ad)],'seed':_0x751afd[_0x5edc73(0x11c2)]===-0x1?Math[_0x5edc73(0x123c)](Math[_0x5edc73(0x13ae)]()*0x2540be3ff):_0x751afd[_0x5edc73(0x11c2)],'n_samples':0x1,'ucPreset':_0x751afd['uc_preset'],'qualityToggle':_0x751afd[_0x5edc73(0xc1a)],'autoSmea':![],'dynamic_thresholding':![],'controlnet_strength':0x1,'legacy':![],'add_original_image':!![],'cfg_rescale':0x0,'noise_schedule':_0x5edc73(0xec0),'legacy_v3_extend':![],'skip_cfg_above_sigma':null,'use_coords':![],'legacy_uc':![],'normalize_reference_strength_multiple':!![],'inpaintImg2ImgStrength':0x1,'characterPrompts':[],'v4_prompt':{'caption':{'base_caption':_0x4f2ab1,'char_captions':[]},'use_coords':![],'use_order':!![]},'v4_negative_prompt':{'caption':{'base_caption':_0xa2423b,'char_captions':[]},'legacy_uc':![]},'negative_prompt':_0xa2423b,'deliberate_euler_ancestral_bug':![],'prefer_brownian':!![]}}:_0x53285c={'input':_0x4f2ab1,'model':_0x202ba2,'action':'generate','parameters':{'width':_0x2b3ef7,'height':_0x33dce4,'scale':_0x751afd['cfg_scale'],'sampler':_0x751afd[_0x5edc73(0x115d)],'steps':_0x751afd['steps'],'seed':_0x751afd[_0x5edc73(0x11c2)]===-0x1?Math['floor'](Math[_0x5edc73(0x13ae)]()*0x2540be3ff):_0x751afd[_0x5edc73(0x11c2)],'n_samples':0x1,'ucPreset':_0x751afd['uc_preset'],'qualityToggle':_0x751afd[_0x5edc73(0xc1a)],'sm':_0x751afd[_0x5edc73(0x114d)],'sm_dyn':_0x751afd[_0x5edc73(0x353)],'dynamic_thresholding':![],'controlnet_strength':0x1,'legacy':![],'add_original_image':![],'cfg_rescale':0x0,'noise_schedule':_0x5edc73(0x26e),'negative_prompt':_0xa2423b}};console[_0x5edc73(0x57e)](_0x5edc73(0x4a5)),console[_0x5edc73(0x57e)]('📊\x20使用模型:',_0x202ba2),console[_0x5edc73(0x57e)](_0x5edc73(0x414),JSON[_0x5edc73(0x994)](_0x53285c,null,0x2));let _0x5d9402;_0x202ba2[_0x5edc73(0xe82)](_0x5edc73(0x3ba))?_0x5d9402='https://image.novelai.net/ai/generate-image-stream':_0x5d9402='https://image.novelai.net/ai/generate-image';let _0x170f32=_0x751afd[_0x5edc73(0x4fd)];_0x170f32===_0x5edc73(0xb42)&&(_0x170f32=_0x751afd[_0x5edc73(0x703)]||'');_0x170f32&&_0x170f32!==''&&(_0x5d9402=_0x170f32+encodeURIComponent(_0x5d9402));const _0x153354=/Chrome/['test'](navigator[_0x5edc73(0xf0f)])&&!/Edg/[_0x5edc73(0x60b)](navigator[_0x5edc73(0xf0f)]);let _0x38b3cc={'method':_0x5edc73(0x12d9),'headers':{'Content-Type':'application/json','Authorization':_0x5edc73(0xf03)+_0x4d6f05},'body':JSON[_0x5edc73(0x994)](_0x53285c)};if(_0x153354){console[_0x5edc73(0x57e)](_0x5edc73(0x137e));const _0x111da3={};for(const [_0x556dbc,_0x1507a4]of Object[_0x5edc73(0xd20)](_0x38b3cc['headers'])){_0x111da3[_0x556dbc]=_0x1507a4['replace'](/[^\x00-\xFF]/g,'');}_0x38b3cc[_0x5edc73(0x3de)]=_0x111da3;}const _0x59dd28=await fetch(_0x5d9402,_0x38b3cc);console[_0x5edc73(0x57e)](_0x5edc73(0x79e),_0x59dd28['status']),console[_0x5edc73(0x57e)]('Response\x20headers:',[..._0x59dd28['headers'][_0x5edc73(0xd20)]()]);if(!_0x59dd28['ok']){const _0x243415=await _0x59dd28[_0x5edc73(0x40f)]();console[_0x5edc73(0x127d)]('API错误响应:',_0x243415);throw new Error('API请求失败\x20('+_0x59dd28[_0x5edc73(0x1589)]+_0x5edc73(0x126a)+_0x243415);}const _0x333702=_0x59dd28['headers']['get']('content-type');console[_0x5edc73(0x57e)](_0x5edc73(0x106d),_0x333702);let _0x21b996;if(_0x333702&&_0x333702['includes'](_0x5edc73(0x9a9))){console[_0x5edc73(0x57e)]('检测到\x20SSE\x20流式响应，开始解析...'),_0x5a514a[_0x5edc73(0x231)]=_0x5edc73(0x115c);const _0x33f882=await _0x59dd28[_0x5edc73(0x40f)]();console[_0x5edc73(0x57e)](_0x5edc73(0x9b1),_0x33f882[_0x5edc73(0x58a)]);const _0x36c69f=_0x33f882[_0x5edc73(0x4a2)]()['split']('\x0a');let _0xe13791=null;for(let _0x3a92dd=_0x36c69f[_0x5edc73(0x58a)]-0x1;_0x3a92dd>=0x0;_0x3a92dd--){const _0x404279=_0x36c69f[_0x3a92dd]['trim']();if(_0x404279[_0x5edc73(0xebf)](_0x5edc73(0xabd))&&_0x404279!==_0x5edc73(0x2e6)){const _0x125246=_0x404279['substring'](0x6);try{const _0x2813d3=JSON['parse'](_0x125246);if(_0x2813d3[_0x5edc73(0x1210)]===_0x5edc73(0x830)&&_0x2813d3['image']){_0xe13791=_0x2813d3[_0x5edc73(0x685)],console[_0x5edc73(0x57e)](_0x5edc73(0xf80));break;}if(_0x2813d3[_0x5edc73(0xc6b)]){_0xe13791=_0x2813d3['data'],console[_0x5edc73(0x57e)](_0x5edc73(0x2de));break;}if(_0x2813d3[_0x5edc73(0x685)]){_0xe13791=_0x2813d3[_0x5edc73(0x685)],console['log'](_0x5edc73(0xa42));break;}}catch(_0x24ae3f){_0xe13791=_0x125246,console[_0x5edc73(0x57e)]('直接使用\x20base64\x20数据');break;}}}if(!_0xe13791)throw new Error('无法从\x20SSE\x20响应中提取图片数据');const _0x323dfe=_0xe13791['startsWith']('iVBORw0KGgo'),_0x45d098=_0xe13791[_0x5edc73(0xebf)](_0x5edc73(0x574));if(_0x323dfe||_0x45d098){console[_0x5edc73(0x57e)](_0x5edc73(0xccb));const _0x46c136=atob(_0xe13791),_0x4302e6=new Uint8Array(_0x46c136[_0x5edc73(0x58a)]);for(let _0x6ae10d=0x0;_0x6ae10d<_0x46c136['length'];_0x6ae10d++){_0x4302e6[_0x6ae10d]=_0x46c136[_0x5edc73(0x109b)](_0x6ae10d);}const _0x2a9ac6=new Blob([_0x4302e6],{'type':_0x323dfe?_0x5edc73(0xdce):_0x5edc73(0x37b)});console[_0x5edc73(0x57e)]('图片\x20Blob\x20创建成功，大小:',_0x2a9ac6[_0x5edc73(0xb51)]);const _0x4fd00a=URL[_0x5edc73(0x297)](_0x2a9ac6);document[_0x5edc73(0x1f4)](_0x5edc73(0x10b6))['src']=_0x4fd00a,_0x5a514a[_0x5edc73(0x215)][_0x5edc73(0x887)]='none',_0xc26944[_0x5edc73(0x215)][_0x5edc73(0x887)]='block',console[_0x5edc73(0x57e)](_0x5edc73(0xe4c));return;}console[_0x5edc73(0x57e)](_0x5edc73(0xa09));const _0x4b0426=atob(_0xe13791),_0x46252f=new Uint8Array(_0x4b0426[_0x5edc73(0x58a)]);for(let _0x3f2ace=0x0;_0x3f2ace<_0x4b0426['length'];_0x3f2ace++){_0x46252f[_0x3f2ace]=_0x4b0426[_0x5edc73(0x109b)](_0x3f2ace);}_0x21b996=new Blob([_0x46252f]),console[_0x5edc73(0x57e)](_0x5edc73(0x66d),_0x21b996[_0x5edc73(0xb51)]);}else _0x21b996=await _0x59dd28[_0x5edc73(0x128e)](),console['log']('收到数据，类型:',_0x21b996[_0x5edc73(0xcbd)],_0x5edc73(0x105d),_0x21b996[_0x5edc73(0xb51)]);try{if(typeof JSZip===_0x5edc73(0x488))throw new Error(_0x5edc73(0x52a));_0x5a514a['textContent']='正在解压图片...';const _0x265bf1=await JSZip[_0x5edc73(0xaf0)](_0x21b996);console[_0x5edc73(0x57e)]('ZIP文件内容:',Object[_0x5edc73(0x1378)](_0x265bf1[_0x5edc73(0x8b1)]));let _0x4eacb5=null;for(let _0x23792e in _0x265bf1[_0x5edc73(0x8b1)]){if(_0x23792e[_0x5edc73(0xba5)](/\.(png|jpg|jpeg|webp)$/i)){_0x4eacb5=_0x265bf1[_0x5edc73(0x8b1)][_0x23792e],console[_0x5edc73(0x57e)]('找到图片文件:',_0x23792e);break;}}if(!_0x4eacb5)throw new Error(_0x5edc73(0x8bb));const _0x1c119c=await _0x4eacb5['async'](_0x5edc73(0x128e));console[_0x5edc73(0x57e)](_0x5edc73(0x6f0),_0x1c119c['size']);const _0x43304f=URL[_0x5edc73(0x297)](_0x1c119c);console[_0x5edc73(0x57e)](_0x5edc73(0x13ea),_0x43304f),document[_0x5edc73(0x1f4)](_0x5edc73(0x10b6))['src']=_0x43304f,_0x5a514a['style'][_0x5edc73(0x887)]=_0x5edc73(0x1b5),_0xc26944['style']['display']=_0x5edc73(0x361);}catch(_0x1e165c){console['error']('ZIP解压失败:',_0x1e165c),console[_0x5edc73(0x57e)]('尝试直接作为图片显示...');if(_0x21b996['type']['startsWith'](_0x5edc73(0x68e))){const _0x23fd80=URL[_0x5edc73(0x297)](_0x21b996);document[_0x5edc73(0x1f4)]('nai-result-image')[_0x5edc73(0x9fe)]=_0x23fd80,_0x5a514a[_0x5edc73(0x215)]['display']=_0x5edc73(0x1b5),_0xc26944[_0x5edc73(0x215)][_0x5edc73(0x887)]=_0x5edc73(0x361);}else throw new Error(_0x5edc73(0x537)+_0x1e165c['message']);}}catch(_0x29674a){console['error'](_0x5edc73(0x32c),_0x29674a),_0x5a514a[_0x5edc73(0x215)][_0x5edc73(0x887)]=_0x5edc73(0x1b5),_0x413993['style'][_0x5edc73(0x887)]='block',_0x413993[_0x5edc73(0x231)]=_0x5edc73(0x23d)+_0x29674a[_0x5edc73(0x11f0)];}finally{_0x45adf6[_0x5edc73(0xa0d)]=![],_0x45adf6[_0x5edc73(0x231)]=_0x5edc73(0x11b1);}}function _0x158e58(_0x150188,_0x41823f){const _0x427fd0=_0x2b1222;_0x5e2ecb(),clearTimeout(_0x276d16);const _0x20011d=_0x1ae02e[_0x427fd0(0x589)][_0x150188];if(!_0x20011d)return;const _0x4e3e93=document[_0x427fd0(0x1f4)](_0x427fd0(0x15bd));document[_0x427fd0(0x1f4)](_0x427fd0(0x3dc))[_0x427fd0(0x9fe)]=_0x20011d[_0x427fd0(0x6a8)][_0x427fd0(0xc99)]||_0x20011d[_0x427fd0(0x6a8)]['groupAvatar']||_0x5494d0,document['getElementById'](_0x427fd0(0x492))[_0x427fd0(0xeda)](_0x427fd0(0x1ef))['textContent']=_0x20011d['name'],document[_0x427fd0(0x1f4)](_0x427fd0(0x492))[_0x427fd0(0xeda)]('.message')[_0x427fd0(0x231)]=_0x41823f,_0x4e3e93[_0x427fd0(0x159b)][_0x427fd0(0xa9c)]('visible'),void _0x4e3e93[_0x427fd0(0x93a)],_0x4e3e93[_0x427fd0(0x159b)][_0x427fd0(0x6a4)]('visible');const _0x291a8d=_0x4e3e93[_0x427fd0(0xf44)](!![]);_0x4e3e93[_0x427fd0(0xad7)]['replaceChild'](_0x291a8d,_0x4e3e93),_0x291a8d[_0x427fd0(0x122b)]('click',()=>{const _0x4d34d3=_0x427fd0;_0x4c0122(_0x150188),_0x291a8d[_0x4d34d3(0x159b)]['remove']('visible');}),_0x276d16=setTimeout(()=>{const _0x36bad8=_0x427fd0;_0x291a8d[_0x36bad8(0x159b)][_0x36bad8(0xa9c)](_0x36bad8(0xfca));},0xfa0),_0x27308f();}function _0x42aa36(){const _0x626503=_0x2b1222,_0x3d3b0c=new Date(),_0x4d79c9=_0x3d3b0c[_0x626503(0x15b6)](_0x626503(0xd02),{'hour':_0x626503(0x9bd),'minute':'2-digit'}),_0x340f21=_0x3d3b0c[_0x626503(0x5c5)](_0x626503(0xd02),{'weekday':_0x626503(0x2ee),'month':_0x626503(0x2ee),'day':_0x626503(0x113f)});document[_0x626503(0x1f4)](_0x626503(0x954))['textContent']=_0x4d79c9;}function _0x1493d9(_0xd7713){const _0x4a80b2=_0x2b1222;if(!_0xd7713)return[{'type':_0x4a80b2(0x40f),'content':_0x4a80b2(0x10d8)}];let _0x153e6a=_0xd7713[_0x4a80b2(0x4a2)]();const _0x18a554=/```json\s*([\s\S]*?)\s*```/,_0x26f7be=_0x153e6a[_0x4a80b2(0xba5)](_0x18a554);_0x26f7be&&_0x26f7be[0x1]&&(_0x153e6a=_0x26f7be[0x1]['trim'](),console[_0x4a80b2(0x57e)](_0x4a80b2(0x4cd)));if(_0x153e6a[_0x4a80b2(0xebf)]('[')&&_0x153e6a['endsWith'](']'))try{const _0x3ab3a9=JSON['parse'](_0x153e6a);if(Array[_0x4a80b2(0x121f)](_0x3ab3a9))return console[_0x4a80b2(0x57e)](_0x4a80b2(0x80d)),_0x3ab3a9;}catch(_0x20ebb0){console['warn'](_0x4a80b2(0xfe5));}const _0x2e0d7f=_0x153e6a[_0x4a80b2(0x621)]('['),_0x1d9a32=_0x153e6a[_0x4a80b2(0xf6d)]('}');if(_0x2e0d7f!==-0x1&&_0x1d9a32!==-0x1&&_0x1d9a32>_0x2e0d7f){const _0x212cd6=_0x153e6a['indexOf'](']',_0x1d9a32);if(_0x212cd6!==-0x1){const _0x3a0414=_0x153e6a[_0x4a80b2(0x516)](_0x2e0d7f,_0x212cd6+0x1);try{const _0x5c9bd3=JSON[_0x4a80b2(0x129c)](_0x3a0414);if(Array[_0x4a80b2(0x121f)](_0x5c9bd3))return console['log']('解析成功：通过强力提取\x20[\x20...\x20}\x20...\x20]\x20模式。'),_0x5c9bd3;}catch(_0x15b4ef){console[_0x4a80b2(0xb3b)](_0x4a80b2(0x1257));}}}const _0x4a802d=_0x153e6a[_0x4a80b2(0xba5)](/{[^{}]*}/g);if(_0x4a802d){const _0x51e8f9=[];for(const _0x1476f0 of _0x4a802d){try{const _0x3c8e3c=JSON['parse'](_0x1476f0);_0x51e8f9[_0x4a80b2(0x1426)](_0x3c8e3c);}catch(_0x12d866){console[_0x4a80b2(0xb3b)]('跳过一个无效的JSON片段:',_0x1476f0);}}if(_0x51e8f9[_0x4a80b2(0x58a)]>0x0)return console['log'](_0x4a80b2(0xadb)),_0x51e8f9;}return console[_0x4a80b2(0x127d)](_0x4a80b2(0xa71),_0xd7713),[{'type':'text','content':_0xd7713}];}function _0x1c13d6(_0x4fe4f7=new Date()){const _0x54d21d=_0x4fe4f7['getHours']();if(_0x54d21d>=0x0&&_0x54d21d<0x5)return'凌晨';else{if(_0x54d21d>=0x5&&_0x54d21d<0x9)return'早上';else{if(_0x54d21d>=0x9&&_0x54d21d<0xd)return'上午';else{if(_0x54d21d>=0xd&&_0x54d21d<0x12)return'下午';else{if(_0x54d21d>=0x12&&_0x54d21d<0x18)return'晚上';}}}}return'现在';}async function _0x478599(){const _0x4975cd=_0x2b1222,_0x5e4f58=document['getElementById'](_0x4975cd(0x211));_0x5e4f58[_0x4975cd(0xf21)]=_0x4975cd(0x145d);const _0x39720a=await _0x3df81a['apiPresets']['toArray']();_0x39720a[_0x4975cd(0x59b)](_0x2f5b84=>{const _0x13dafc=_0x4975cd,_0x317355=document[_0x13dafc(0x219)]('option');_0x317355[_0x13dafc(0x107e)]=_0x2f5b84['id'],_0x317355[_0x13dafc(0x231)]=_0x2f5b84[_0x13dafc(0x5d2)],_0x5e4f58[_0x13dafc(0x6ce)](_0x317355);});const _0x5d6084=_0x1ae02e[_0x4975cd(0x226)];let _0x54f273=null;for(const _0x3c77f7 of _0x39720a){if(_0x3c77f7[_0x4975cd(0x157a)]===_0x5d6084[_0x4975cd(0x157a)]&&_0x3c77f7[_0x4975cd(0x13b6)]===_0x5d6084[_0x4975cd(0x13b6)]&&_0x3c77f7[_0x4975cd(0x9ef)]===_0x5d6084[_0x4975cd(0x9ef)]&&_0x3c77f7[_0x4975cd(0x78a)]===_0x5d6084[_0x4975cd(0x78a)]&&_0x3c77f7[_0x4975cd(0x247)]===_0x5d6084[_0x4975cd(0x247)]&&_0x3c77f7[_0x4975cd(0xe21)]===_0x5d6084[_0x4975cd(0xe21)]&&(_0x3c77f7['minimaxGroupId']||'')===(_0x5d6084[_0x4975cd(0x87d)]||'')&&(_0x3c77f7[_0x4975cd(0x1502)]||'')===(_0x5d6084['minimaxApiKey']||'')&&(_0x3c77f7[_0x4975cd(0x11fe)]||'speech-01')===(_0x5d6084['minimaxModel']||'speech-01')){_0x54f273=_0x3c77f7['id'];break;}}_0x54f273?_0x5e4f58['value']=_0x54f273:_0x5e4f58[_0x4975cd(0x107e)]=_0x4975cd(0xccf);}async function _0x1f50bf(){const _0x206f61=_0x2b1222,_0x16c329=document[_0x206f61(0x1f4)](_0x206f61(0x211)),_0x42434e=parseInt(_0x16c329['value']);if(isNaN(_0x42434e))return;const _0x3a3da0=await _0x3df81a[_0x206f61(0xa9a)][_0x206f61(0x13f8)](_0x42434e);_0x3a3da0&&(_0x1ae02e[_0x206f61(0x226)]={'id':_0x206f61(0x70b),'proxyUrl':_0x3a3da0[_0x206f61(0x157a)],'apiKey':_0x3a3da0['apiKey'],'model':_0x3a3da0[_0x206f61(0x9ef)],'secondaryProxyUrl':_0x3a3da0['secondaryProxyUrl'],'secondaryApiKey':_0x3a3da0['secondaryApiKey'],'secondaryModel':_0x3a3da0[_0x206f61(0xe21)],'minimaxGroupId':_0x3a3da0[_0x206f61(0x87d)],'minimaxApiKey':_0x3a3da0[_0x206f61(0x1502)],'minimaxModel':_0x3a3da0[_0x206f61(0x11fe)]},await _0x3df81a[_0x206f61(0x226)]['put'](_0x1ae02e[_0x206f61(0x226)]),_0x218733(),document[_0x206f61(0x1f4)](_0x206f61(0x1325))[_0x206f61(0x740)](),_0x3a3da0[_0x206f61(0x78a)]&&_0x3a3da0[_0x206f61(0x247)]&&document['getElementById'](_0x206f61(0x79d))[_0x206f61(0x740)](),alert(_0x206f61(0x1343)+_0x3a3da0[_0x206f61(0x5d2)]+'”'));}async function _0x2c154f(){const _0x3544f0=_0x2b1222,_0xcc155b=await _0x11f6fb(_0x3544f0(0x1053),_0x3544f0(0x11ed));if(!_0xcc155b||!_0xcc155b[_0x3544f0(0x4a2)]())return;const _0x332efa={'name':_0xcc155b[_0x3544f0(0x4a2)](),'proxyUrl':document['getElementById'](_0x3544f0(0x926))['value']['trim'](),'apiKey':document[_0x3544f0(0x1f4)](_0x3544f0(0xa65))[_0x3544f0(0x107e)][_0x3544f0(0x4a2)](),'model':document[_0x3544f0(0x1f4)](_0x3544f0(0x166))[_0x3544f0(0x107e)],'secondaryProxyUrl':document[_0x3544f0(0x1f4)](_0x3544f0(0x385))[_0x3544f0(0x107e)][_0x3544f0(0x4a2)](),'secondaryApiKey':document[_0x3544f0(0x1f4)](_0x3544f0(0xc25))['value'][_0x3544f0(0x4a2)](),'secondaryModel':document[_0x3544f0(0x1f4)](_0x3544f0(0xfeb))[_0x3544f0(0x107e)],'minimaxGroupId':document['getElementById'](_0x3544f0(0xbac))['value']['trim'](),'minimaxApiKey':document['getElementById']('minimax-api-key')[_0x3544f0(0x107e)][_0x3544f0(0x4a2)](),'minimaxModel':document[_0x3544f0(0x1f4)](_0x3544f0(0xe01))[_0x3544f0(0x107e)]},_0x1db2d7=await _0x3df81a['apiPresets']['where'](_0x3544f0(0x5d2))[_0x3544f0(0x49d)](_0x332efa[_0x3544f0(0x5d2)])[_0x3544f0(0x9a8)]();if(_0x1db2d7){const _0x4779ea=await _0x109970(_0x3544f0(0x214),_0x3544f0(0x1303)+_0x332efa[_0x3544f0(0x5d2)]+_0x3544f0(0x7e6),{'confirmButtonClass':_0x3544f0(0x1c6)});if(!_0x4779ea)return;_0x332efa['id']=_0x1db2d7['id'];}await _0x3df81a[_0x3544f0(0xa9a)]['put'](_0x332efa),await _0x478599(),alert(_0x3544f0(0x11bd));}async function _0x5d5e42(){const _0x35c15c=_0x2b1222,_0x4d507f=document[_0x35c15c(0x1f4)](_0x35c15c(0x211)),_0x5ca1c6=parseInt(_0x4d507f[_0x35c15c(0x107e)]);if(isNaN(_0x5ca1c6)){alert('请先从下拉框中选择一个要删除的预设。');return;}const _0x593218=await _0x3df81a[_0x35c15c(0xa9a)]['get'](_0x5ca1c6);if(!_0x593218)return;const _0x358bca=await _0x109970(_0x35c15c(0x15bc),'确定要删除预设\x20“'+_0x593218[_0x35c15c(0x5d2)]+_0x35c15c(0xbdf),{'confirmButtonClass':'btn-danger'});_0x358bca&&(await _0x3df81a[_0x35c15c(0xa9a)]['delete'](_0x5ca1c6),await _0x478599(),alert(_0x35c15c(0x14de)));}function _0x218733(){const _0x393cbb=_0x2b1222;document[_0x393cbb(0x1f4)](_0x393cbb(0x926))[_0x393cbb(0x107e)]=_0x1ae02e[_0x393cbb(0x226)]['proxyUrl']||'',document['getElementById']('api-key')[_0x393cbb(0x107e)]=_0x1ae02e[_0x393cbb(0x226)][_0x393cbb(0x13b6)]||'',document[_0x393cbb(0x1f4)]('secondary-proxy-url')[_0x393cbb(0x107e)]=_0x1ae02e[_0x393cbb(0x226)][_0x393cbb(0x78a)]||'',document['getElementById']('secondary-api-key')['value']=_0x1ae02e[_0x393cbb(0x226)][_0x393cbb(0x247)]||'',document[_0x393cbb(0x1f4)](_0x393cbb(0x4eb))['checked']=_0x1ae02e[_0x393cbb(0x12c0)][_0x393cbb(0x605)]||![],document[_0x393cbb(0x1f4)](_0x393cbb(0xc2b))[_0x393cbb(0x107e)]=_0x1ae02e[_0x393cbb(0x12c0)][_0x393cbb(0xfd5)]||0x3c,document[_0x393cbb(0x1f4)](_0x393cbb(0xcb5))[_0x393cbb(0x107e)]=_0x1ae02e[_0x393cbb(0x12c0)]['blockCooldownHours']||0x1,document[_0x393cbb(0x1f4)](_0x393cbb(0x76d))[_0x393cbb(0xe56)]=_0x1ae02e[_0x393cbb(0x12c0)][_0x393cbb(0x7d1)],document[_0x393cbb(0x1f4)](_0x393cbb(0x8cc))[_0x393cbb(0x107e)]=_0x1ae02e[_0x393cbb(0x12c0)]['chatRenderWindow']||0x32,document[_0x393cbb(0x1f4)]('chat-list-render-window-input')[_0x393cbb(0x107e)]=_0x1ae02e['globalSettings'][_0x393cbb(0x12d7)]||0x1e;const _0x4143f6=document['getElementById'](_0x393cbb(0x1496)),_0x52c5b9=document['getElementById'](_0x393cbb(0x24b)),_0x32a651=_0x1ae02e[_0x393cbb(0x12c0)][_0x393cbb(0x217)]||0.8;_0x4143f6[_0x393cbb(0x107e)]=_0x32a651,_0x52c5b9[_0x393cbb(0x231)]=_0x32a651,document[_0x393cbb(0x1f4)](_0x393cbb(0xbac))[_0x393cbb(0x107e)]=_0x1ae02e[_0x393cbb(0x226)][_0x393cbb(0x87d)]||'',document[_0x393cbb(0x1f4)](_0x393cbb(0x1395))['value']=_0x1ae02e[_0x393cbb(0x226)][_0x393cbb(0x1502)]||'',document['getElementById'](_0x393cbb(0xe01))['value']=_0x1ae02e[_0x393cbb(0x226)][_0x393cbb(0x11fe)]||'speech-01';const _0x568374=localStorage[_0x393cbb(0x587)](_0x393cbb(0x15b8))===_0x393cbb(0x8c3),_0x4560a1=localStorage[_0x393cbb(0x587)](_0x393cbb(0xf6b))||_0x393cbb(0xf90),_0xa4988d=localStorage[_0x393cbb(0x587)](_0x393cbb(0x8f7))||'';document[_0x393cbb(0x1f4)](_0x393cbb(0x6d8))[_0x393cbb(0xe56)]=_0x568374,document[_0x393cbb(0x1f4)]('novelai-model')[_0x393cbb(0x107e)]=_0x4560a1,document['getElementById'](_0x393cbb(0x8f7))[_0x393cbb(0x107e)]=_0xa4988d,document[_0x393cbb(0x1f4)](_0x393cbb(0x158d))[_0x393cbb(0x215)][_0x393cbb(0x887)]=_0x568374?_0x393cbb(0x361):_0x393cbb(0x1b5),_0x478599(),_0xfe46d9();}window[_0x2b1222(0x14cf)]=_0x218733;async function _0x1929e1(){const _0x6cc4fc=_0x2b1222,_0x2fe957=document['getElementById'](_0x6cc4fc(0xfce));_0x2fe957[_0x6cc4fc(0xf21)]='';const _0x226d2b=await _0x3df81a[_0x6cc4fc(0x15b9)][_0x6cc4fc(0x27a)]();if(_0x226d2b['length']===0x0){_0x2fe957[_0x6cc4fc(0xf21)]=_0x6cc4fc(0x6ed);return;}_0x226d2b[_0x6cc4fc(0x59b)](_0x13330f=>{const _0x367409=_0x6cc4fc,_0x339672=document[_0x367409(0x219)](_0x367409(0xaf9));_0x339672[_0x367409(0x7c6)]=_0x367409(0x1153),_0x339672[_0x367409(0x746)][_0x367409(0xd48)]=_0x13330f['id'],_0x339672[_0x367409(0xf21)]=_0x367409(0x90b)+(_0x13330f[_0x367409(0x95b)]||_0x54779f)+'\x22\x20class=\x22avatar\x22\x20style=\x22border-radius:\x2050%;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22name-line\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>'+_0x13330f['name']+_0x367409(0x7e9)+_0x13330f[_0x367409(0x3be)]['substring'](0x0,0x1e)+_0x367409(0x14d7),_0x339672[_0x367409(0x122b)](_0x367409(0x740),()=>_0x2b00f0(_0x13330f['id'])),_0x1160f3(_0x339672,async()=>{await _0x4e3d00(_0x13330f['id']);}),_0x2fe957['appendChild'](_0x339672);});}async function _0x2b00f0(_0x5b390f=null){const _0x3f04e5=_0x2b1222;editingNpcId=_0x5b390f;const _0x21606e=document[_0x3f04e5(0x1f4)](_0x3f04e5(0xca3)),_0x2a9f5f=document[_0x3f04e5(0x1f4)](_0x3f04e5(0xcfa)),_0x1feff1=document[_0x3f04e5(0x1f4)](_0x3f04e5(0xb48)),_0x40ecf0=document['getElementById'](_0x3f04e5(0x15a8)),_0x6b300e=document['getElementById'](_0x3f04e5(0xba2)),_0x3c0631=document[_0x3f04e5(0x1f4)]('npc-association-list'),_0x2488b8=document[_0x3f04e5(0x1f4)](_0x3f04e5(0x38e)),_0x1cc9ed=document['getElementById'](_0x3f04e5(0xe94)),_0x1c59c3=document[_0x3f04e5(0x1f4)]('npc-action-cooldown-input');_0x3c0631[_0x3f04e5(0xf21)]='',_0x2488b8[_0x3f04e5(0xf21)]=_0x3f04e5(0x8a8);const _0x4e8cd5=await _0x3df81a[_0x3f04e5(0x23e)][_0x3f04e5(0x27a)]();_0x4e8cd5['forEach'](_0x57199b=>{const _0x1ee6dc=_0x3f04e5,_0x57eae1=document[_0x1ee6dc(0x219)](_0x1ee6dc(0x10bb));_0x57eae1[_0x1ee6dc(0x107e)]=_0x57199b['id'],_0x57eae1[_0x1ee6dc(0x231)]=_0x57199b[_0x1ee6dc(0x5d2)],_0x2488b8[_0x1ee6dc(0x6ce)](_0x57eae1);}),_0x3c0631[_0x3f04e5(0xf21)]+=_0x3f04e5(0x48b)+(_0x1ae02e[_0x3f04e5(0x11ef)][_0x3f04e5(0xb46)]||'我')+_0x3f04e5(0x884),Object[_0x3f04e5(0x753)](_0x1ae02e['chats'])[_0x3f04e5(0xede)](_0x416636=>!_0x416636[_0x3f04e5(0xe83)])['forEach'](_0x550a9f=>{const _0x5f1eed=_0x3f04e5;_0x3c0631['innerHTML']+='<label><input\x20type=\x22checkbox\x22\x20value=\x22'+_0x550a9f['id']+_0x5f1eed(0x7c7)+_0x550a9f[_0x5f1eed(0x5d2)]+_0x5f1eed(0x2eb);});if(_0x5b390f){_0x2a9f5f[_0x3f04e5(0x231)]=_0x3f04e5(0x13e5);const _0x4fae9b=await _0x3df81a[_0x3f04e5(0x15b9)][_0x3f04e5(0x13f8)](_0x5b390f);_0x4fae9b&&(_0x1feff1['value']=_0x4fae9b['name'],_0x40ecf0['value']=_0x4fae9b[_0x3f04e5(0x3be)],_0x6b300e[_0x3f04e5(0x9fe)]=_0x4fae9b['avatar']||_0x54779f,_0x1cc9ed[_0x3f04e5(0xe56)]=_0x4fae9b[_0x3f04e5(0x605)]!==![],_0x1c59c3[_0x3f04e5(0x107e)]=_0x4fae9b[_0x3f04e5(0xfa7)]||0xf,_0x2488b8[_0x3f04e5(0x107e)]=_0x4fae9b[_0x3f04e5(0x584)]||'',_0x4fae9b[_0x3f04e5(0x11e9)]&&Array[_0x3f04e5(0x121f)](_0x4fae9b[_0x3f04e5(0x11e9)])&&_0x4fae9b[_0x3f04e5(0x11e9)][_0x3f04e5(0x59b)](_0x17168a=>{const _0x59486f=_0x3f04e5,_0xd0320f=_0x3c0631[_0x59486f(0xeda)](_0x59486f(0xcf1)+_0x17168a+'\x22]');if(_0xd0320f)_0xd0320f['checked']=!![];}));}else{_0x2a9f5f[_0x3f04e5(0x231)]=_0x3f04e5(0x370),_0x1feff1[_0x3f04e5(0x107e)]='',_0x40ecf0[_0x3f04e5(0x107e)]='',_0x6b300e[_0x3f04e5(0x9fe)]=_0x54779f,_0x1cc9ed[_0x3f04e5(0xe56)]=!![],_0x1c59c3[_0x3f04e5(0x107e)]=0xf,_0x2488b8['value']='';const _0x164aa9=_0x3c0631[_0x3f04e5(0xeda)](_0x3f04e5(0x5b7));if(_0x164aa9)_0x164aa9[_0x3f04e5(0xe56)]=!![];}_0x21606e[_0x3f04e5(0x159b)]['add'](_0x3f04e5(0xfca));}async function _0x1e8180(){const _0x3981ba=_0x2b1222,_0x53c1f1=document[_0x3981ba(0x1f4)]('npc-name-input')[_0x3981ba(0x107e)]['trim'](),_0x14a08b=document['getElementById'](_0x3981ba(0x15a8))[_0x3981ba(0x107e)][_0x3981ba(0x4a2)]();if(!_0x53c1f1||!_0x14a08b){alert(_0x3981ba(0xde1));return;}const _0x2c2388=Array[_0x3981ba(0xa81)](document['querySelectorAll'](_0x3981ba(0x13fd)))['map'](_0x2dcd55=>_0x2dcd55[_0x3981ba(0x107e)]),_0x1d1e8c=document[_0x3981ba(0x1f4)](_0x3981ba(0xe94))['checked'],_0x33e7cb=parseInt(document['getElementById'](_0x3981ba(0x96e))[_0x3981ba(0x107e)])||0xf,_0x1551ee=parseInt(document['getElementById'](_0x3981ba(0x38e))['value'])||null,_0x5156c5={'name':_0x53c1f1,'persona':_0x14a08b,'avatar':document[_0x3981ba(0x1f4)](_0x3981ba(0xba2))[_0x3981ba(0x9fe)],'associatedWith':_0x2c2388,'enableBackgroundActivity':_0x1d1e8c,'actionCooldownMinutes':_0x33e7cb,'npcGroupId':_0x1551ee};if(editingNpcId)await _0x3df81a[_0x3981ba(0x15b9)][_0x3981ba(0xf18)](editingNpcId,_0x5156c5);else{const _0x225101=await _0x3df81a[_0x3981ba(0x15b9)][_0x3981ba(0x6a4)](_0x5156c5);if(_0x206fc4&&_0x1ae02e[_0x3981ba(0x588)]){const _0x5a5acc=_0x1ae02e[_0x3981ba(0x589)][_0x1ae02e['activeChatId']];_0x5a5acc[_0x3981ba(0xe83)]&&(_0x5a5acc[_0x3981ba(0x1402)][_0x3981ba(0x1426)]({'id':_0x3981ba(0x27f)+_0x225101,'originalName':_0x53c1f1,'groupNickname':_0x53c1f1,'persona':_0x14a08b,'avatar':_0x5156c5[_0x3981ba(0x95b)],'isNpc':!![]}),await _0x3df81a['chats'][_0x3981ba(0x295)](_0x5a5acc));}}document[_0x3981ba(0x1f4)](_0x3981ba(0xca3))[_0x3981ba(0x159b)][_0x3981ba(0xa9c)](_0x3981ba(0xfca)),_0x206fc4?(_0x206fc4=![],_0x4a91e3()):await _0x1929e1();}async function _0x52554f(){const _0x3c2681=_0x2b1222;await _0x2136aa(),document[_0x3c2681(0x1f4)](_0x3c2681(0xb5d))[_0x3c2681(0x159b)][_0x3c2681(0x6a4)](_0x3c2681(0xfca));}async function _0x2136aa(){const _0x516dc7=_0x2b1222,_0x5f30df=document[_0x516dc7(0x1f4)]('existing-npc-groups-list'),_0x5a1acc=await _0x3df81a['npcGroups']['toArray']();_0x5f30df[_0x516dc7(0xf21)]='',_0x5a1acc[_0x516dc7(0x58a)]===0x0&&(_0x5f30df[_0x516dc7(0xf21)]=_0x516dc7(0xeae)),_0x5a1acc['forEach'](_0x2494a3=>{const _0x548f25=_0x516dc7,_0x40882b=document[_0x548f25(0x219)](_0x548f25(0xaf9));_0x40882b[_0x548f25(0x7c6)]='existing-group-item',_0x40882b[_0x548f25(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-name\x22>'+_0x2494a3[_0x548f25(0x5d2)]+_0x548f25(0x564)+_0x2494a3['id']+_0x548f25(0xaa8),_0x5f30df[_0x548f25(0x6ce)](_0x40882b);});}async function _0x16a7ea(){const _0x453d1f=_0x2b1222,_0x230d67=document[_0x453d1f(0x1f4)]('new-npc-group-name-input'),_0x53219e=_0x230d67[_0x453d1f(0x107e)][_0x453d1f(0x4a2)]();if(!_0x53219e){alert(_0x453d1f(0x726));return;}const _0x5105bf=await _0x3df81a[_0x453d1f(0x23e)]['where']('name')[_0x453d1f(0x49d)](_0x53219e)[_0x453d1f(0x9a8)]();if(_0x5105bf){alert(_0x453d1f(0x604)+_0x53219e+_0x453d1f(0xf6a));return;}await _0x3df81a[_0x453d1f(0x23e)][_0x453d1f(0x6a4)]({'name':_0x53219e}),_0x230d67[_0x453d1f(0x107e)]='',await _0x2136aa();}async function _0x231ff0(_0xdf8c9f){const _0x48ca29=_0x2b1222,_0x357eb5=await _0x109970(_0x48ca29(0xed1),_0x48ca29(0x11f7),{'confirmButtonClass':_0x48ca29(0x1c6)});_0x357eb5&&(await _0x3df81a[_0x48ca29(0x23e)][_0x48ca29(0xc40)](_0xdf8c9f),await _0x3df81a[_0x48ca29(0x15b9)]['where'](_0x48ca29(0x584))[_0x48ca29(0x49d)](_0xdf8c9f)[_0x48ca29(0x1064)]({'npcGroupId':null}),await _0x2136aa());}async function _0x4e3d00(_0x39a6f9){const _0x26e54e=_0x2b1222,_0x39fb59=await _0x3df81a[_0x26e54e(0x15b9)][_0x26e54e(0x13f8)](_0x39a6f9);if(!_0x39fb59)return;const _0x1ec4c7=await _0x109970(_0x26e54e(0xf82),_0x26e54e(0x289)+_0x39fb59[_0x26e54e(0x5d2)]+_0x26e54e(0xbdf),{'confirmButtonClass':'btn-danger'});_0x1ec4c7&&(await _0x3df81a[_0x26e54e(0x15b9)][_0x26e54e(0xc40)](_0x39a6f9),await _0x1929e1());}let _0x2a700e=0x0;function _0x6b4835(_0x1a3791){const _0x37526b=_0x2b1222,_0x33581c=document['createElement'](_0x37526b(0xaf9));return _0x33581c[_0x37526b(0x7c6)]=_0x37526b(0xb0f),_0x33581c[_0x37526b(0xf21)]=_0x37526b(0x4be)+_0x1a3791['name']+_0x37526b(0x66b),_0x33581c;}function _0x29147e(_0x30a5ec){const _0x50bbbb=_0x2b1222,_0x4eaa79=document['getElementById']('chat-list'),_0x5e83c5=document[_0x50bbbb(0x1f4)]('load-more-chats-btn');if(_0x5e83c5)_0x5e83c5[_0x50bbbb(0xa9c)]();const _0x31aaaa=_0x2a700e,_0x11a626=_0x2a700e+CHAT_LIST_RENDER_WINDOW,_0x344d52=_0x30a5ec[_0x50bbbb(0x5cc)](_0x31aaaa,_0x11a626),_0x377892=document['createDocumentFragment']();let _0x22dc44=_0x4eaa79[_0x50bbbb(0xeda)]('.chat-group-content:last-of-type');_0x344d52['forEach'](_0x2acbcc=>{const _0x50e1a8=_0x50bbbb;if(_0x2acbcc['type']===_0x50e1a8(0x86a)){const _0x2d64e5=_0x6b4835(_0x2acbcc[_0x50e1a8(0x678)]);_0x377892[_0x50e1a8(0x6ce)](_0x2d64e5),_0x22dc44=_0x2d64e5[_0x50e1a8(0xeda)](_0x50e1a8(0x1015));}else{if(_0x2acbcc[_0x50e1a8(0xcbd)]===_0x50e1a8(0x42f)){const _0x41e54c=_0x15d653(_0x2acbcc['chat']);_0x22dc44&&_0x2acbcc[_0x50e1a8(0x21a)][_0x50e1a8(0x67d)]?_0x22dc44[_0x50e1a8(0x6ce)](_0x41e54c):(_0x377892['appendChild'](_0x41e54c),_0x22dc44=null);}}}),_0x4eaa79[_0x50bbbb(0x6ce)](_0x377892),_0x2a700e+=_0x344d52[_0x50bbbb(0x58a)],_0x30a5ec[_0x50bbbb(0x58a)]>_0x2a700e&&_0x40f89a(_0x4eaa79,_0x30a5ec),document['querySelectorAll'](_0x50bbbb(0x12c8))['forEach'](_0x7ff05a=>{const _0x2cb1de=_0x50bbbb,_0x1767d1=_0x7ff05a[_0x2cb1de(0xf44)](!![]);_0x7ff05a[_0x2cb1de(0xad7)]['replaceChild'](_0x1767d1,_0x7ff05a),_0x1767d1['addEventListener']('click',()=>{const _0x4eefd6=_0x2cb1de;_0x1767d1['classList'][_0x4eefd6(0x1483)](_0x4eefd6(0xff6)),_0x1767d1[_0x4eefd6(0x675)][_0x4eefd6(0x159b)][_0x4eefd6(0x1483)](_0x4eefd6(0xff6));});});}async function _0x1033ae(){const _0x487f37=_0x2b1222,_0x874f34=document[_0x487f37(0x1f4)](_0x487f37(0xb4b));_0x874f34['innerHTML']='';const _0x5ae0fa=Object[_0x487f37(0x753)](_0x1ae02e[_0x487f37(0x589)])['sort']((_0x1f1248,_0x239b14)=>{const _0x3988d9=_0x487f37,_0x4d3ac6=(_0x239b14[_0x3988d9(0x6e3)]||![])-(_0x1f1248[_0x3988d9(0x6e3)]||![]);if(_0x4d3ac6!==0x0)return _0x4d3ac6;return(_0x239b14['history']['slice'](-0x1)[0x0]?.[_0x3988d9(0x1388)]||0x0)-(_0x1f1248[_0x3988d9(0xce3)][_0x3988d9(0x5cc)](-0x1)[0x0]?.[_0x3988d9(0x1388)]||0x0);}),_0x172be8=await _0x3df81a[_0x487f37(0x13fc)][_0x487f37(0x27a)]();if(_0x5ae0fa[_0x487f37(0x58a)]===0x0){_0x874f34[_0x487f37(0xf21)]=_0x487f37(0x3fa);return;}_0x172be8[_0x487f37(0x59b)](_0x34c5fa=>{const _0x3f4508=_0x487f37,_0x3126dc=_0x5ae0fa[_0x3f4508(0x13b7)](_0x32940c=>_0x32940c[_0x3f4508(0x67d)]===_0x34c5fa['id']);_0x34c5fa['latestTimestamp']=_0x3126dc?_0x3126dc[_0x3f4508(0xce3)]['slice'](-0x1)[0x0]?.[_0x3f4508(0x1388)]||0x0:0x0;}),_0x172be8[_0x487f37(0x74e)]((_0x59f067,_0x1c85ec)=>_0x1c85ec[_0x487f37(0xfcf)]-_0x59f067[_0x487f37(0xfcf)]),_0x4f8d6d=[];const _0x8dabd5=new Set();_0x5ae0fa[_0x487f37(0x59b)](_0x48f9a5=>{const _0x3fa1d4=_0x487f37;_0x48f9a5[_0x3fa1d4(0x6e3)]&&(_0x4f8d6d['push']({'type':_0x3fa1d4(0x42f),'chat':_0x48f9a5}),_0x8dabd5[_0x3fa1d4(0x6a4)](_0x48f9a5['id']));}),_0x172be8[_0x487f37(0x59b)](_0x1dd857=>{const _0x2bea7f=_0x487f37,_0xd9615c=_0x5ae0fa[_0x2bea7f(0xede)](_0xdbea67=>!_0xdbea67[_0x2bea7f(0x6e3)]&&!_0xdbea67[_0x2bea7f(0xe83)]&&_0xdbea67[_0x2bea7f(0x67d)]===_0x1dd857['id']);_0xd9615c[_0x2bea7f(0x58a)]>0x0&&(_0x4f8d6d['push']({'type':'groupHeader','group':_0x1dd857}),_0xd9615c[_0x2bea7f(0x59b)](_0x337500=>{const _0x2b9161=_0x2bea7f;_0x4f8d6d[_0x2b9161(0x1426)]({'type':_0x2b9161(0x42f),'chat':_0x337500}),_0x8dabd5[_0x2b9161(0x6a4)](_0x337500['id']);}));}),_0x5ae0fa[_0x487f37(0x59b)](_0x56ecdd=>{const _0xf0661d=_0x487f37;!_0x8dabd5[_0xf0661d(0xe75)](_0x56ecdd['id'])&&(_0x4f8d6d[_0xf0661d(0x1426)]({'type':_0xf0661d(0x42f),'chat':_0x56ecdd}),_0x8dabd5[_0xf0661d(0x6a4)](_0x56ecdd['id']));}),_0x2a700e=0x0,_0x29147e();}function _0x6b4835(_0x454ab1){const _0x42fdca=_0x2b1222,_0x1e0187=document[_0x42fdca(0x219)](_0x42fdca(0xaf9));return _0x1e0187['className']=_0x42fdca(0xb0f),_0x1e0187[_0x42fdca(0xf21)]=_0x42fdca(0x494)+_0x454ab1[_0x42fdca(0x5d2)]+_0x42fdca(0xa75),_0x1e0187;}function _0x40f89a(_0x852da9,_0x50f0b9){const _0x2354f0=_0x2b1222,_0x63430f=document['createElement']('button');_0x63430f['id']=_0x2354f0(0x4e8),_0x63430f[_0x2354f0(0x231)]='加载更早的会话',_0x63430f['className']=_0x2354f0(0xf2a),_0x63430f[_0x2354f0(0x122b)]('click',()=>_0x29147e(_0x50f0b9),{'once':!![]}),_0x852da9['prepend'](_0x63430f);}function _0x29147e(){const _0xa4f5b0=_0x2b1222;if(_0x5cbd47)return;const _0x18826c=document[_0xa4f5b0(0x1f4)](_0xa4f5b0(0xb4b)),_0x282579=document['getElementById']('messages-view');if(!_0x18826c||!_0x282579)return;if(_0x2a700e>=_0x4f8d6d[_0xa4f5b0(0x58a)])return;_0x5cbd47=!![];const _0x3e27ca=_0x2a700e===0x0,_0x183e8a=()=>{const _0x4e1113=_0xa4f5b0;_0x1335c4(_0x18826c);const _0x41debe=_0x1ae02e['globalSettings'][_0x4e1113(0x12d7)]||0x1e,_0x50ff84=_0x2a700e,_0xef3ce3=_0x2a700e+_0x41debe,_0xcd1e5f=_0x4f8d6d[_0x4e1113(0x5cc)](_0x50ff84,_0xef3ce3),_0x56a21c=document['createDocumentFragment']();let _0x2ff77a=_0x18826c[_0x4e1113(0xeda)](_0x4e1113(0x719));_0xcd1e5f[_0x4e1113(0x59b)](_0x21fdaa=>{const _0x9c12b1=_0x4e1113;if(_0x21fdaa['type']===_0x9c12b1(0x86a)){const _0x1bf00a=_0x6b4835(_0x21fdaa[_0x9c12b1(0x678)]);_0x56a21c[_0x9c12b1(0x6ce)](_0x1bf00a),_0x2ff77a=_0x1bf00a[_0x9c12b1(0xeda)]('.chat-group-content');}else{if(_0x21fdaa['type']==='chatItem'){const _0x54d096=_0x15d653(_0x21fdaa[_0x9c12b1(0x21a)]);if(_0x21fdaa['chat'][_0x9c12b1(0x67d)]&&_0x2ff77a)_0x2ff77a[_0x9c12b1(0x6ce)](_0x54d096);else{_0x56a21c[_0x9c12b1(0x6ce)](_0x54d096);if(!_0x21fdaa[_0x9c12b1(0x21a)][_0x9c12b1(0x67d)])_0x2ff77a=null;}}}}),_0x18826c[_0x4e1113(0x6ce)](_0x56a21c),_0x2a700e+=_0xcd1e5f[_0x4e1113(0x58a)],_0x18826c[_0x4e1113(0x14bf)](_0x4e1113(0xa47))[_0x4e1113(0x59b)](_0x5597b5=>{const _0x4fe176=_0x4e1113;_0x5597b5[_0x4fe176(0x746)]['hasListener']=_0x4fe176(0x8c3),_0x5597b5[_0x4fe176(0x122b)](_0x4fe176(0x740),()=>{const _0x20880b=_0x4fe176;_0x5597b5[_0x20880b(0x159b)][_0x20880b(0x1483)](_0x20880b(0xff6)),_0x5597b5['nextElementSibling'][_0x20880b(0x159b)][_0x20880b(0x1483)]('collapsed');});}),_0x5cbd47=![],_0x282579[_0x4e1113(0x1092)]<=_0x282579[_0x4e1113(0xf13)]&&_0x2a700e<_0x4f8d6d[_0x4e1113(0x58a)]&&_0x29147e();};_0x3e27ca?_0x183e8a():(_0x5563af(_0x18826c,_0xa4f5b0(0xb30)),setTimeout(_0x183e8a,0x1f4));}function _0x15d653(_0x580672){const _0x5468c0=_0x2b1222;try{const _0x576972=_0x580672[_0x5468c0(0xce3)][_0x5468c0(0xede)](_0x5b1331=>!_0x5b1331[_0x5468c0(0x58e)])['slice'](-0x1)[0x0]||{};let _0x1336f3;if(!_0x580672[_0x5468c0(0xe83)]&&_0x580672[_0x5468c0(0x13ab)]?.[_0x5468c0(0x1589)]===_0x5468c0(0x149e))_0x1336f3=_0x5468c0(0xedf)+(_0x580672['relationship'][_0x5468c0(0x8dd)]||_0x5468c0(0xb66))+_0x5468c0(0xa0c);else{if(!_0x580672[_0x5468c0(0xe83)]&&_0x580672[_0x5468c0(0x13ab)]?.[_0x5468c0(0x1589)]===_0x5468c0(0x29e))_0x1336f3=_0x5468c0(0xf3b);else{if(_0x580672[_0x5468c0(0xe83)]){if(_0x576972[_0x5468c0(0xcbd)]===_0x5468c0(0x1454))_0x1336f3=_0x5468c0(0x1416)+_0x576972['content'];else{if(_0x576972[_0x5468c0(0xcbd)]==='transfer')_0x1336f3=_0x5468c0(0x915);else{if(_0x576972[_0x5468c0(0xcbd)]===_0x5468c0(0xce9)||_0x576972[_0x5468c0(0xcbd)]==='user_photo')_0x1336f3=_0x5468c0(0x1108);else{if(_0x576972[_0x5468c0(0xcbd)]===_0x5468c0(0xd83))_0x1336f3=_0x5468c0(0x57d);else{if(typeof _0x576972['content']===_0x5468c0(0x6c3)&&_0x43460a['test'](_0x576972[_0x5468c0(0x128c)]))_0x1336f3=_0x576972[_0x5468c0(0x339)]?_0x5468c0(0xe39)+_0x576972[_0x5468c0(0x339)]+']':'[表情]';else Array[_0x5468c0(0x121f)](_0x576972['content'])?_0x1336f3=_0x5468c0(0x947):_0x1336f3=String(_0x576972['content']||_0x5468c0(0x629))['substring'](0x0,0x14);}}}}if(_0x576972[_0x5468c0(0xfb7)]&&_0x576972[_0x5468c0(0xcbd)]!==_0x5468c0(0x1454)){const _0x394f9e=_0x140540(_0x580672,_0x576972[_0x5468c0(0xfb7)]);_0x1336f3=_0x394f9e+':\x20'+_0x1336f3;}}else{const _0x4b23c4=_0x580672[_0x5468c0(0x1589)]?.[_0x5468c0(0x40f)]||'在线';_0x1336f3='['+_0x4b23c4+']';}}}const _0x126525=document['createElement'](_0x5468c0(0xaf9));_0x126525[_0x5468c0(0x7c6)]=_0x5468c0(0x1153),_0x126525[_0x5468c0(0x746)]['chatId']=_0x580672['id'];_0x580672['isPinned']&&_0x126525[_0x5468c0(0x159b)]['add']('pinned');const _0x4330e1=_0x580672[_0x5468c0(0xe83)]?_0x580672[_0x5468c0(0x6a8)][_0x5468c0(0xe46)]:_0x580672['settings'][_0x5468c0(0xc99)],_0xd8c606=_0x580672[_0x5468c0(0xe83)]?'':_0x580672[_0x5468c0(0x6a8)][_0x5468c0(0x94d)]||'';let _0xf8552c;_0xd8c606?_0xf8552c=_0x5468c0(0x698)+(_0x4330e1||_0x5494d0)+_0x5468c0(0x8d5)+_0xd8c606+'\x22\x20class=\x22avatar-frame\x22></div>':_0xf8552c=_0x5468c0(0xe40)+(_0x4330e1||_0x5494d0)+_0x5468c0(0x1216);const _0x14d356=_0xd8c606?_0x5468c0(0xcaf):'',_0x177199=_0x5468c0(0x335)+_0x14d356+'\x22>'+_0xf8552c+_0x5468c0(0x149b);_0x126525[_0x5468c0(0xf21)]=_0x5468c0(0xa73)+_0x177199+_0x5468c0(0x9d8)+_0x580672[_0x5468c0(0x5d2)]+_0x5468c0(0xfc6)+(_0x580672[_0x5468c0(0xe83)]?'<span\x20class=\x22group-tag\x22>群聊</span>':'')+_0x5468c0(0x8db)+(_0x580672[_0x5468c0(0xe83)]?'var(--text-secondary)':_0x5468c0(0x988))+_0x5468c0(0x278)+_0x1336f3+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22unread-count-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22unread-count\x22\x20style=\x22display:\x20none;\x22>0</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x15116c=_0x580672[_0x5468c0(0xf2c)]||0x0,_0x206a11=_0x126525[_0x5468c0(0xeda)](_0x5468c0(0x4dd));_0x15116c>0x0?(_0x206a11[_0x5468c0(0x231)]=_0x15116c>0x63?_0x5468c0(0xff8):_0x15116c,_0x206a11[_0x5468c0(0x215)][_0x5468c0(0x887)]=_0x5468c0(0x11ca)):_0x206a11[_0x5468c0(0x215)][_0x5468c0(0x887)]='none';const _0x13f373=_0x126525['querySelector'](_0x5468c0(0x10ff));_0x13f373&&(_0x13f373[_0x5468c0(0x215)][_0x5468c0(0x14cb)]=_0x5468c0(0x9fa),_0x13f373[_0x5468c0(0x122b)](_0x5468c0(0x11b0),_0x50e9e7=>{const _0x39fcd6=_0x5468c0;_0x50e9e7[_0x39fcd6(0x1025)]();const _0x365ab1=_0x580672[_0x39fcd6(0xe83)]?_0x580672['name']:_0x580672['originalName'];_0x2baf5c(_0x580672['id'],_0x365ab1);}));const _0x2234c0=_0x126525[_0x5468c0(0xeda)](_0x5468c0(0x72f));return _0x2234c0&&_0x2234c0[_0x5468c0(0x122b)](_0x5468c0(0x740),()=>_0x4c0122(_0x580672['id'])),_0x1160f3(_0x126525,async _0x4e1588=>{const _0x3c5a58=_0x5468c0,_0x12edf8=await _0x37ef0b(_0x580672);switch(_0x12edf8){case _0x3c5a58(0x11e1):_0x580672[_0x3c5a58(0x6e3)]=!_0x580672[_0x3c5a58(0x6e3)],await _0x3df81a[_0x3c5a58(0x589)][_0x3c5a58(0x295)](_0x580672),_0x1033ae();break;case _0x3c5a58(0xc40):const _0x1d88da=await _0x109970(_0x3c5a58(0x5d3),_0x3c5a58(0xaa4)+_0x580672[_0x3c5a58(0x5d2)]+_0x3c5a58(0xcb3),{'confirmButtonClass':_0x3c5a58(0x1c6)});if(_0x1d88da){_0x5419de[_0x3c5a58(0xd51)]&&_0x5419de[_0x3c5a58(0x588)]===_0x580672['id']&&await _0x33c89f(![]);delete _0x1ae02e['chats'][_0x580672['id']];if(_0x1ae02e[_0x3c5a58(0x588)]===_0x580672['id'])_0x1ae02e[_0x3c5a58(0x588)]=null;await _0x3df81a[_0x3c5a58(0x589)][_0x3c5a58(0xc40)](_0x580672['id']),_0x1033ae();}break;default:break;}}),_0x126525;}catch(_0x3ee570){return console[_0x5468c0(0x127d)](_0x5468c0(0x14c9)+(_0x580672['name']||'未知')+_0x5468c0(0x951)+_0x580672['id']+_0x5468c0(0xba7),_0x3ee570),null;}}async function _0x3689f0(_0x4ba413){const _0x30295a=_0x2b1222;_0x26e5ff(),_0x3829aa();const _0x420348=_0x1ae02e[_0x30295a(0x589)][_0x4ba413];if(!_0x420348)return;_0x527427();const _0x4bb4af=document[_0x30295a(0x1f4)](_0x30295a(0xd31)),_0x39a1e7=document[_0x30295a(0x1f4)]('chat-input-area'),_0xd78de7=document[_0x30295a(0x1f4)](_0x30295a(0x919)),_0x23e87f=document['getElementById'](_0x30295a(0x1200));_0x4bb4af[_0x30295a(0x746)]['theme']=_0x420348[_0x30295a(0x6a8)]['theme']||_0x30295a(0x372);const _0x58b190=_0x420348[_0x30295a(0x6a8)]['fontSize']||0xd;_0x4bb4af['style']['setProperty']('--chat-font-size',_0x58b190+'px'),_0x5379ba(_0x420348[_0x30295a(0x6a8)][_0x30295a(0x138e)]||'',_0x30295a(0xf0a),_0x30295a(0x35f)),document[_0x30295a(0x1f4)](_0x30295a(0x12a0))[_0x30295a(0x231)]=_0x420348[_0x30295a(0x5d2)];const _0x779947=document['getElementById'](_0x30295a(0x145b)),_0xcb7db4=_0x779947['querySelector'](_0x30295a(0x1358));_0x420348['isGroup']?(_0x779947[_0x30295a(0x215)][_0x30295a(0x887)]=_0x30295a(0x1b5),document['getElementById'](_0x30295a(0x8d3))[_0x30295a(0x215)][_0x30295a(0x88c)]=_0x30295a(0x803)):(_0x779947[_0x30295a(0x215)][_0x30295a(0x887)]=_0x30295a(0xeba),document['getElementById'](_0x30295a(0x8d3))[_0x30295a(0x215)][_0x30295a(0x88c)]=_0x30295a(0x108d),_0xcb7db4[_0x30295a(0x231)]=_0x420348[_0x30295a(0x1589)]?.[_0x30295a(0x40f)]||'在线',_0x779947['classList'][_0x30295a(0x1483)]('busy',_0x420348[_0x30295a(0x1589)]?.['isBusy']||![]));const _0x1024b9=document[_0x30295a(0x1f4)](_0x30295a(0x13c3)),_0x24f5a8=_0x420348[_0x30295a(0x6a8)][_0x30295a(0xece)],_0x49cc45=_0x1ae02e[_0x30295a(0x12c0)]['globalChatBackground'],_0xe6c04b=document[_0x30295a(0x1f4)](_0x30295a(0x296))[_0x30295a(0x159b)][_0x30295a(0xaea)]('dark-mode'),_0x271179=_0xe6c04b?'#000000':_0x30295a(0xa9d);if(_0x24f5a8)_0x1024b9[_0x30295a(0x215)][_0x30295a(0xf98)]='url('+_0x24f5a8+')',_0x1024b9['style'][_0x30295a(0x11e7)]='transparent';else _0x49cc45?(_0x1024b9[_0x30295a(0x215)][_0x30295a(0xf98)]=_0x30295a(0x13cb)+_0x49cc45+')',_0x1024b9[_0x30295a(0x215)][_0x30295a(0x11e7)]=_0x30295a(0xbff)):(_0x1024b9[_0x30295a(0x215)][_0x30295a(0xf98)]=_0x30295a(0x1b5),_0x1024b9[_0x30295a(0x215)]['backgroundColor']=_0x271179);if(_0x420348[_0x30295a(0x1f0)])_0x39a1e7[_0x30295a(0x215)][_0x30295a(0x887)]=_0x30295a(0x1b5),_0xd78de7[_0x30295a(0x215)][_0x30295a(0x887)]=_0x30295a(0xeba),_0x23e87f[_0x30295a(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22lock-text\x22>正在围观AI们的群聊...</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22spectator-actions-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22spectator-reroll-btn\x22\x20class=\x22lock-action-btn\x20secondary\x22\x20title=\x22重新生成上一轮对话\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2011A8.1\x208.1\x200\x200\x200\x204.5\x209M4\x205v4h4\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4\x2013a8.1\x208.1\x200\x200\x200\x2015.5\x202m.5\x204v-4h-4\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22spectator-propel-btn\x22\x20class=\x22lock-action-btn\x22>🎬\x20推进剧情</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22spectator-edit-btn\x22\x20class=\x22lock-action-btn\x20secondary\x22\x20title=\x22导演剪辑室：编辑AI上一轮的响应\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20.24\x2012.24a6\x206\x200\x200\x200-8.49-8.49L5\x2010.5V19h8.5z\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x2216\x22\x20y1=\x228\x22\x20x2=\x222\x22\x20y2=\x2222\x22></line>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x2217.5\x22\x20y1=\x2215\x22\x20x2=\x229\x22\x20y2=\x2215\x22></line>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document[_0x30295a(0x1f4)](_0x30295a(0x1034))[_0x30295a(0x1199)]=_0x39f47d;else{_0x39a1e7[_0x30295a(0x215)][_0x30295a(0x887)]='flex',_0xd78de7[_0x30295a(0x215)][_0x30295a(0x887)]=_0x30295a(0x1b5),_0x23e87f['innerHTML']='';if(!_0x420348[_0x30295a(0xe83)]&&_0x420348[_0x30295a(0x13ab)][_0x30295a(0x1589)]!=='friend'){_0xd78de7[_0x30295a(0x215)][_0x30295a(0x887)]=_0x30295a(0xeba),_0x39a1e7['style'][_0x30295a(0x8d9)]='hidden';let _0x5917d9='';switch(_0x420348['relationship']['status']){case _0x30295a(0x14e6):const _0x369995=_0x512c63!==null,_0x433352=_0x420348[_0x30295a(0x13ab)][_0x30295a(0x139b)],_0x947a99=_0x1ae02e[_0x30295a(0x12c0)][_0x30295a(0x8a1)]||0x1,_0x2315de=_0x947a99*0x3c*0x3c*0x3e8,_0x3d614d=Date[_0x30295a(0xd6e)]()-_0x433352,_0x72655d=_0x3d614d>_0x2315de,_0x57808f=Math[_0x30295a(0x616)](0x0,Math[_0x30295a(0xde8)]((_0x2315de-_0x3d614d)/(0x3e8*0x3c)));_0x5917d9=_0x30295a(0x762)+_0x420348[_0x30295a(0x5d2)]+'”拉黑。</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22unblock-btn\x22\x20class=\x22lock-action-btn\x22>解除拉黑</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-top:\x2020px;\x20padding:\x2010px;\x20border:\x201px\x20dashed\x20#ccc;\x20border-radius:\x208px;\x20font-size:\x2011px;\x20text-align:\x20left;\x20color:\x20#666;\x20background:\x20rgba(0,0,0,0.02);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong\x20style=\x22color:\x20#333;\x22>【开发者诊断面板】</strong><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20后台活动总开关:\x20'+(_0x1ae02e[_0x30295a(0x12c0)]['enableBackgroundActivity']?_0x30295a(0x74a):_0x30295a(0x10fa))+_0x30295a(0x6cd)+(_0x369995?'<span\x20style=\x22color:\x20green;\x22>运行中</span>':_0x30295a(0x1340))+_0x30295a(0x68f)+_0x420348[_0x30295a(0x13ab)][_0x30295a(0x1589)]+'</strong><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20需要冷静(小时):\x20<strong>'+_0x947a99+_0x30295a(0x92e)+(_0x72655d?_0x30295a(0x983):'<span\x20style=\x22color:\x20orange;\x22>否\x20(还剩约\x20'+_0x57808f+_0x30295a(0x6f7))+'<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20触发条件:\x20'+(_0x72655d&&_0x1ae02e[_0x30295a(0x12c0)][_0x30295a(0x605)]?_0x30295a(0x1081):_0x30295a(0x3ec))+_0x30295a(0x1a5);break;case _0x30295a(0x29e):_0x5917d9=_0x30295a(0x130d);break;case _0x30295a(0x149e):_0x5917d9=_0x30295a(0x10b7)+_0x420348[_0x30295a(0x5d2)]+'”请求添加你为好友：<br><i>“'+_0x420348['relationship']['applicationReason']+_0x30295a(0x1011);break;case'pending_ai_approval':_0x5917d9=_0x30295a(0x79f);break;}_0x23e87f['innerHTML']=_0x5917d9;}else _0xd78de7[_0x30295a(0x215)][_0x30295a(0x887)]=_0x30295a(0x1b5),_0x39a1e7['style'][_0x30295a(0x8d9)]='visible';}_0x4bb4af['innerHTML']='';const _0xe297a3=_0x420348[_0x30295a(0xce3)];_0x3dea4f=0x0;const _0xfac243=_0x1ae02e[_0x30295a(0x12c0)][_0x30295a(0xf47)]||0x32,_0x19ed37=_0xe297a3[_0x30295a(0x5cc)](-_0xfac243),_0x202cab=[];let _0x3d3e73=0x0;for(const _0x591ca2 of _0x19ed37){_0x3d3e73>0x0&&_0x591ca2['timestamp']-_0x3d3e73>0x927c0&&_0x202cab['push'](Promise[_0x30295a(0x130c)](_0x4a4f71(_0x591ca2[_0x30295a(0x1388)]))),_0x202cab['push'](_0x1c1dfa(_0x591ca2,_0x420348,!![])),_0x3d3e73=_0x591ca2[_0x30295a(0x1388)];}const _0x48a4d2=await Promise[_0x30295a(0x54b)](_0x202cab),_0x53777c=document[_0x30295a(0xd5c)]();_0x48a4d2[_0x30295a(0xede)](Boolean)[_0x30295a(0x59b)](_0x24d6ed=>_0x53777c['appendChild'](_0x24d6ed)),_0x4bb4af[_0x30295a(0x6ce)](_0x53777c),_0x3dea4f=_0x19ed37['length'];const _0x242fea=document['createElement']('div');_0x242fea['id']=_0x30295a(0x5ae),_0x242fea['style'][_0x30295a(0x887)]=_0x30295a(0x1b5),_0x242fea[_0x30295a(0x231)]=_0x30295a(0x1042),_0x4bb4af[_0x30295a(0x6ce)](_0x242fea),setTimeout(()=>_0x4bb4af['scrollTop']=_0x4bb4af[_0x30295a(0x1092)],0x0);}async function _0x56ec48(){const _0x4947e5=_0x2b1222;if(_0x3e1778)return;_0x3e1778=!![];const _0x54b57d=document[_0x4947e5(0x1f4)]('chat-messages'),_0x22ffef=_0x1ae02e[_0x4947e5(0x589)][_0x1ae02e[_0x4947e5(0x588)]];if(!_0x22ffef){_0x3e1778=![];return;}_0x5563af(_0x54b57d,_0x4947e5(0xe00));const _0x29a0d6=_0x54b57d[_0x4947e5(0x1092)];await new Promise(_0xe46402=>setTimeout(_0xe46402,0x1f4));const _0x442351=_0x22ffef[_0x4947e5(0xce3)][_0x4947e5(0x58a)],_0x502d95=_0x1ae02e[_0x4947e5(0x12c0)][_0x4947e5(0xf47)]||0x32,_0x4d40fe=_0x442351-_0x3dea4f-_0x502d95,_0x280bc9=_0x442351-_0x3dea4f,_0x3cef04=_0x22ffef['history'][_0x4947e5(0x5cc)](Math[_0x4947e5(0x616)](0x0,_0x4d40fe),_0x280bc9),_0x160bb4=_0x54b57d[_0x4947e5(0xeda)](_0x4947e5(0x1b4));let _0x75951f=_0x160bb4?parseInt(_0x160bb4[_0x4947e5(0x746)][_0x4947e5(0x1388)]):0x0;for(const _0x3171bc of _0x3cef04[_0x4947e5(0x115a)]()){if(_0x75951f>0x0&&_0x75951f-_0x3171bc[_0x4947e5(0x1388)]>0x927c0){const _0x2e5a26=_0x4a4f71(_0x75951f);_0x54b57d[_0x4947e5(0x2d2)](_0x2e5a26);}await _0x36c625(_0x3171bc,_0x22ffef),_0x75951f=_0x3171bc['timestamp'];}_0x3dea4f+=_0x3cef04[_0x4947e5(0x58a)];const _0x57518f=_0x54b57d[_0x4947e5(0x1092)];_0x54b57d['scrollTop']=_0x57518f-_0x29a0d6,_0x1335c4(_0x54b57d),_0x3e1778=![];}function _0x1216fb(){const _0x24ab9d=_0x2b1222;_0x3299b7(),_0x199b60();const _0x278b76=document[_0x24ab9d(0x1f4)](_0x24ab9d(0x1438)),_0x35715d=_0x1ae02e['globalSettings'][_0x24ab9d(0xd23)];_0x35715d?(_0x278b76[_0x24ab9d(0x215)][_0x24ab9d(0xf98)]=_0x24ab9d(0x13cb)+_0x35715d+')',_0x278b76[_0x24ab9d(0x231)]=''):(_0x278b76[_0x24ab9d(0x215)][_0x24ab9d(0xf98)]=_0x24ab9d(0x6b7),_0x278b76[_0x24ab9d(0x231)]=_0x24ab9d(0xf31));const _0x4bd8a2=document[_0x24ab9d(0x1f4)](_0x24ab9d(0x13c1)),_0x30ac20=_0x1ae02e[_0x24ab9d(0x12c0)]['cphoneWallpaper'];_0x30ac20?(_0x4bd8a2[_0x24ab9d(0x215)]['backgroundImage']=_0x24ab9d(0x13cb)+_0x30ac20+')',_0x4bd8a2[_0x24ab9d(0x231)]=''):(_0x4bd8a2[_0x24ab9d(0x215)][_0x24ab9d(0xf98)]=_0x24ab9d(0x130a),_0x4bd8a2[_0x24ab9d(0x231)]='当前为渐变色');const _0x4cd5e6=document[_0x24ab9d(0x1f4)](_0x24ab9d(0xd93)),_0x57ae29=_0x1ae02e[_0x24ab9d(0x12c0)][_0x24ab9d(0x3a1)];_0x57ae29?(_0x4cd5e6[_0x24ab9d(0x215)][_0x24ab9d(0xf98)]=_0x24ab9d(0x13cb)+_0x57ae29+')',_0x4cd5e6[_0x24ab9d(0x231)]='',document[_0x24ab9d(0x1f4)]('remove-global-bg-btn')[_0x24ab9d(0x215)][_0x24ab9d(0x887)]=_0x24ab9d(0x5f5)):(_0x4cd5e6[_0x24ab9d(0x215)][_0x24ab9d(0xf98)]=_0x24ab9d(0x1b5),_0x4cd5e6[_0x24ab9d(0x231)]=_0x24ab9d(0xc53),document[_0x24ab9d(0x1f4)](_0x24ab9d(0xfec))[_0x24ab9d(0x215)]['display']='none'),_0xcf6765(),_0x215cd7(),document[_0x24ab9d(0x1f4)](_0x24ab9d(0x242))['value']=_0x1ae02e[_0x24ab9d(0x12c0)][_0x24ab9d(0x359)]||'',document[_0x24ab9d(0x1f4)](_0x24ab9d(0xe07))[_0x24ab9d(0x107e)]=_0x1ae02e[_0x24ab9d(0x12c0)]['notificationSoundUrl']||'',document['getElementById'](_0x24ab9d(0x36e))['checked']=_0x1ae02e[_0x24ab9d(0x12c0)][_0x24ab9d(0xad9)]||![],document[_0x24ab9d(0x1f4)](_0x24ab9d(0x9c6))[_0x24ab9d(0xe56)]=_0x1ae02e[_0x24ab9d(0x12c0)][_0x24ab9d(0x46a)]||![],document[_0x24ab9d(0x1f4)](_0x24ab9d(0x157b))[_0x24ab9d(0xe56)]=_0x1ae02e[_0x24ab9d(0x12c0)][_0x24ab9d(0x1110)]||![],document[_0x24ab9d(0x1f4)](_0x24ab9d(0x3c3))[_0x24ab9d(0xe56)]=_0x1ae02e[_0x24ab9d(0x12c0)][_0x24ab9d(0xbde)]||![],document[_0x24ab9d(0x1f4)](_0x24ab9d(0x9a7))[_0x24ab9d(0xe56)]=_0x1ae02e[_0x24ab9d(0x12c0)][_0x24ab9d(0x298)]||![],_0xbfb63d(),_0x141f40();}window[_0x2b1222(0x8b5)]=_0x1216fb;function _0x47f04e(){const _0x5af679=_0x2b1222,_0x51ad61=document[_0x5af679(0x1f4)]('home-screen'),_0x49c5ad=_0x1ae02e[_0x5af679(0x12c0)]['wallpaper'];_0x49c5ad?_0x51ad61[_0x5af679(0x215)][_0x5af679(0xf98)]=_0x5af679(0x13cb)+_0x49c5ad+')':_0x51ad61[_0x5af679(0x215)][_0x5af679(0xf98)]=_0x5af679(0x6b7);}function _0x5d87c9(_0x456eb2){const _0x2ae8c8=_0x2b1222;document[_0x2ae8c8(0x14bf)]('.world-book-tab')[_0x2ae8c8(0x59b)](_0x20d4e7=>{const _0x1d84b3=_0x2ae8c8;_0x20d4e7['classList']['toggle']('active',_0x20d4e7[_0x1d84b3(0x746)][_0x1d84b3(0x1467)]===_0x456eb2);}),document[_0x2ae8c8(0x14bf)](_0x2ae8c8(0x923))[_0x2ae8c8(0x59b)](_0x349178=>{const _0x55002b=_0x2ae8c8;_0x349178['classList'][_0x55002b(0x1483)](_0x55002b(0x7cf),_0x349178[_0x55002b(0x746)][_0x55002b(0x1467)]===_0x456eb2);});}async function _0x23735f(){const _0xe3cb07=_0x2b1222,_0x52c0b1=document[_0xe3cb07(0x1f4)](_0xe3cb07(0xbf9)),_0x2c41ef=document['getElementById'](_0xe3cb07(0x1445));_0x52c0b1['innerHTML']='',_0x2c41ef[_0xe3cb07(0xf21)]='';const [_0x501e00,_0x1bccdc]=await Promise[_0xe3cb07(0x54b)]([_0x3df81a['worldBooks']['toArray'](),_0x3df81a[_0xe3cb07(0xde3)][_0xe3cb07(0x931)](_0xe3cb07(0x5d2))['toArray']()]);_0x1ae02e[_0xe3cb07(0x1453)]=_0x501e00;if(_0x501e00[_0xe3cb07(0x58a)]===0x0){_0x2c41ef[_0xe3cb07(0xf21)]=_0xe3cb07(0x626);return;}const _0xfb2acc=document[_0xe3cb07(0x219)]('button');_0xfb2acc[_0xe3cb07(0x7c6)]=_0xe3cb07(0x656),_0xfb2acc[_0xe3cb07(0x231)]='全部',_0xfb2acc[_0xe3cb07(0x746)]['categoryId']=_0xe3cb07(0x54b),_0x52c0b1[_0xe3cb07(0x6ce)](_0xfb2acc);const _0x4a6170=document['createElement'](_0xe3cb07(0xaf9));_0x4a6170[_0xe3cb07(0x7c6)]='world-book-category-pane\x20active',_0x4a6170[_0xe3cb07(0x746)][_0xe3cb07(0x1467)]='all',_0x2c41ef[_0xe3cb07(0x6ce)](_0x4a6170),_0x1bccdc[_0xe3cb07(0x59b)](_0x211f8d=>{const _0x2bd07b=_0xe3cb07,_0x4286e8=document[_0x2bd07b(0x219)](_0x2bd07b(0xd2d));_0x4286e8[_0x2bd07b(0x7c6)]=_0x2bd07b(0xab0),_0x4286e8['textContent']=_0x211f8d['name'],_0x4286e8[_0x2bd07b(0x746)]['categoryId']=String(_0x211f8d['id']),_0x52c0b1[_0x2bd07b(0x6ce)](_0x4286e8);const _0x399a6a=document[_0x2bd07b(0x219)](_0x2bd07b(0xaf9));_0x399a6a[_0x2bd07b(0x7c6)]='world-book-category-pane',_0x399a6a[_0x2bd07b(0x746)][_0x2bd07b(0x1467)]=String(_0x211f8d['id']),_0x2c41ef['appendChild'](_0x399a6a);});const _0x4cbc7e=_0x501e00[_0xe3cb07(0x690)](_0x301262=>!_0x301262['categoryId']);if(_0x4cbc7e){const _0x29af10=document['createElement']('button');_0x29af10[_0xe3cb07(0x7c6)]=_0xe3cb07(0xab0),_0x29af10[_0xe3cb07(0x231)]='未分类',_0x29af10[_0xe3cb07(0x746)][_0xe3cb07(0x1467)]=_0xe3cb07(0x139e),_0x52c0b1[_0xe3cb07(0x6ce)](_0x29af10);const _0x2b6c38=document[_0xe3cb07(0x219)](_0xe3cb07(0xaf9));_0x2b6c38[_0xe3cb07(0x7c6)]=_0xe3cb07(0x15a4),_0x2b6c38[_0xe3cb07(0x746)]['categoryId']=_0xe3cb07(0x139e),_0x2c41ef[_0xe3cb07(0x6ce)](_0x2b6c38);}_0x501e00[_0xe3cb07(0x59b)](_0x496b31=>{const _0x462fa7=_0xe3cb07;let _0x140fae=_0x462fa7(0xfaf);if(Array[_0x462fa7(0x121f)](_0x496b31[_0x462fa7(0x128c)])&&_0x496b31[_0x462fa7(0x128c)][_0x462fa7(0x58a)]>0x0){const _0x260a18=_0x496b31[_0x462fa7(0x128c)][0x0];_0x140fae=_0x260a18[_0x462fa7(0x306)]||_0x260a18[_0x462fa7(0x128c)]||'';}else typeof _0x496b31[_0x462fa7(0x128c)]==='string'&&_0x496b31[_0x462fa7(0x128c)][_0x462fa7(0x4a2)]()!==''&&(_0x140fae=_0x496b31[_0x462fa7(0x128c)]);const _0xf05a55=document['createElement'](_0x462fa7(0xaf9));_0xf05a55[_0x462fa7(0x7c6)]='world-book-card',_0xf05a55[_0x462fa7(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-title\x22>'+_0x496b31[_0x462fa7(0x5d2)]+_0x462fa7(0x101e)+_0x140fae+_0x462fa7(0x1372);const _0x41c883=()=>_0x15f8e1(_0x496b31['id']),_0x505c4e=async()=>{const _0x578e4c=_0x462fa7,_0xb120ef=await _0x109970(_0x578e4c(0xe2f),_0x578e4c(0x2dd)+_0x496b31[_0x578e4c(0x5d2)]+'》吗？',{'confirmButtonClass':_0x578e4c(0x1c6)});_0xb120ef&&(await _0x3df81a['worldBooks'][_0x578e4c(0xc40)](_0x496b31['id']),_0x1ae02e['worldBooks']=_0x1ae02e['worldBooks'][_0x578e4c(0xede)](_0x1881a8=>_0x1881a8['id']!==_0x496b31['id']),_0x23735f());};_0xf05a55[_0x462fa7(0x122b)](_0x462fa7(0x740),_0x41c883),_0x1160f3(_0xf05a55,_0x505c4e);const _0x573151=_0xf05a55[_0x462fa7(0xf44)](!![]);_0x573151[_0x462fa7(0x122b)](_0x462fa7(0x740),_0x41c883),_0x1160f3(_0x573151,_0x505c4e),_0x4a6170['appendChild'](_0x573151);const _0x1eed01=_0x496b31[_0x462fa7(0x1467)]?String(_0x496b31[_0x462fa7(0x1467)]):_0x462fa7(0x139e),_0x2f7047=_0x2c41ef['querySelector'](_0x462fa7(0x1373)+_0x1eed01+'\x22]');_0x2f7047&&_0x2f7047[_0x462fa7(0x6ce)](_0xf05a55);}),document['querySelectorAll'](_0xe3cb07(0xf08))['forEach'](_0x41fc37=>{const _0x34c1ba=_0xe3cb07;_0x41fc37['addEventListener'](_0x34c1ba(0x740),()=>_0x5d87c9(_0x41fc37[_0x34c1ba(0x746)]['categoryId']));});}function _0x1f3c5b(_0x34a91d,_0x4238b6){const _0x42303a=_0x2b1222,_0x32c90f=document[_0x42303a(0x219)](_0x42303a(0xaf9));_0x32c90f['className']='world-book-group-container',_0x32c90f['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22world-book-group-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22arrow\x22>▼</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-name\x22>'+_0x34a91d+_0x42303a(0x152d);const _0x12f07b=_0x32c90f[_0x42303a(0xeda)](_0x42303a(0x15aa));return _0x4238b6[_0x42303a(0x74e)]((_0x23c9d1,_0x410d80)=>_0x23c9d1['name'][_0x42303a(0x1255)](_0x410d80[_0x42303a(0x5d2)],_0x42303a(0xd02))),_0x4238b6[_0x42303a(0x59b)](_0x17bd3e=>{const _0x53e060=_0x42303a;let _0x3ce32e='暂无内容...';if(Array[_0x53e060(0x121f)](_0x17bd3e[_0x53e060(0x128c)])&&_0x17bd3e[_0x53e060(0x128c)][_0x53e060(0x58a)]>0x0){const _0x23dcf8=_0x17bd3e[_0x53e060(0x128c)][0x0];_0x3ce32e=_0x23dcf8['comment']||_0x23dcf8[_0x53e060(0x128c)]||'';}else typeof _0x17bd3e['content']===_0x53e060(0x6c3)&&_0x17bd3e[_0x53e060(0x128c)][_0x53e060(0x4a2)]()!==''&&(_0x3ce32e=_0x17bd3e[_0x53e060(0x128c)]);const _0x525bda=document[_0x53e060(0x219)]('div');_0x525bda[_0x53e060(0x7c6)]='list-item',_0x525bda[_0x53e060(0x746)][_0x53e060(0x5fc)]=_0x17bd3e['id'],_0x525bda[_0x53e060(0xf21)]=_0x53e060(0x4b7)+_0x17bd3e[_0x53e060(0x5d2)]+_0x53e060(0x112d)+String(_0x3ce32e)[_0x53e060(0x516)](0x0,0x32)+_0x53e060(0x1372),_0x525bda['addEventListener'](_0x53e060(0x740),()=>_0x15f8e1(_0x17bd3e['id'])),_0x1160f3(_0x525bda,async()=>{const _0x1f3b76=_0x53e060,_0x19b609=await _0x109970(_0x1f3b76(0xe2f),_0x1f3b76(0x2dd)+_0x17bd3e[_0x1f3b76(0x5d2)]+_0x1f3b76(0xc06),{'confirmButtonClass':_0x1f3b76(0x1c6)});_0x19b609&&(await _0x3df81a[_0x1f3b76(0x1453)][_0x1f3b76(0xc40)](_0x17bd3e['id']),_0x1ae02e[_0x1f3b76(0x1453)]=_0x1ae02e[_0x1f3b76(0x1453)][_0x1f3b76(0xede)](_0x422f16=>_0x422f16['id']!==_0x17bd3e['id']),_0x23735f());}),_0x12f07b[_0x53e060(0x6ce)](_0x525bda);}),_0x32c90f;}window[_0x2b1222(0x25f)]=_0x23735f;async function _0x15f8e1(_0x416ed1){const _0x3e6d8f=_0x2b1222;_0x2e53fa(_0x3e6d8f(0x1270)),_0x3e528d=_0x416ed1;const [_0x342eca,_0x1202dc]=await Promise[_0x3e6d8f(0x54b)]([_0x3df81a[_0x3e6d8f(0x1453)][_0x3e6d8f(0x13f8)](_0x416ed1),_0x3df81a[_0x3e6d8f(0xde3)][_0x3e6d8f(0x27a)]()]);if(!_0x342eca){console[_0x3e6d8f(0x127d)](_0x3e6d8f(0x1087),_0x416ed1),_0x2e53fa(_0x3e6d8f(0xcc0));return;}document[_0x3e6d8f(0x1f4)](_0x3e6d8f(0xb16))[_0x3e6d8f(0x231)]=_0x342eca[_0x3e6d8f(0x5d2)],document[_0x3e6d8f(0x1f4)](_0x3e6d8f(0x527))[_0x3e6d8f(0x107e)]=_0x342eca['name'];const _0x33520f=document[_0x3e6d8f(0x1f4)](_0x3e6d8f(0x82b));_0x33520f[_0x3e6d8f(0xf21)]=_0x3e6d8f(0x263),_0x1202dc['forEach'](_0x39fd5b=>{const _0x1c9634=_0x3e6d8f,_0xf7d1c9=document[_0x1c9634(0x219)](_0x1c9634(0x10bb));_0xf7d1c9['value']=_0x39fd5b['id'],_0xf7d1c9[_0x1c9634(0x231)]=_0x39fd5b['name'];if(_0x342eca[_0x1c9634(0x1467)]===_0x39fd5b['id'])_0xf7d1c9[_0x1c9634(0xc3e)]=!![];_0x33520f[_0x1c9634(0x6ce)](_0xf7d1c9);});const _0x466576=document[_0x3e6d8f(0x1f4)](_0x3e6d8f(0x62a));_0x466576[_0x3e6d8f(0xf21)]='',Array['isArray'](_0x342eca[_0x3e6d8f(0x128c)])&&_0x342eca[_0x3e6d8f(0x128c)][_0x3e6d8f(0x58a)]>0x0?_0x342eca[_0x3e6d8f(0x128c)]['forEach'](_0x2dd494=>{const _0x534a78=_0x3e6d8f,_0x1fc1b4=_0x4fc058(_0x2dd494);_0x466576[_0x534a78(0x6ce)](_0x1fc1b4);}):_0x466576[_0x3e6d8f(0xf21)]=_0x3e6d8f(0xd08);}async function _0x3056ba(_0x58ea78=!![]){const _0x4f1978=_0x2b1222,_0x4e1cee=document[_0x4f1978(0x1f4)](_0x4f1978(0xe25)),_0x2b8fdc=document['getElementById']('sticker-category-tabs'),_0x44f356=document['getElementById'](_0x4f1978(0xf4a)),_0x4665cc=_0x44f356['value'][_0x4f1978(0x4a2)]()['toLowerCase']();if(_0x58ea78){_0x2b8fdc['innerHTML']='';const _0x304187=await _0x3df81a[_0x4f1978(0x679)][_0x4f1978(0x27a)]();_0x2b8fdc['innerHTML']+=_0x4f1978(0xaed)+(_0x483dbf===_0x4f1978(0x54b)?_0x4f1978(0x7cf):'')+_0x4f1978(0x322),_0x304187[_0x4f1978(0x59b)](_0x96510f=>{const _0x2b1b47=_0x4f1978;_0x2b8fdc[_0x2b1b47(0xf21)]+='<button\x20class=\x22sticker-category-tab\x20'+(_0x483dbf===_0x96510f['id']?_0x2b1b47(0x7cf):'')+_0x2b1b47(0xba0)+_0x96510f['id']+'\x22>'+_0x96510f[_0x2b1b47(0x5d2)]+_0x2b1b47(0x2c4);}),_0x2b8fdc[_0x4f1978(0xf21)]+=_0x4f1978(0xaed)+(_0x483dbf===_0x4f1978(0x139e)?_0x4f1978(0x7cf):'')+_0x4f1978(0x78d);}_0x4e1cee['innerHTML']='';let _0x45e94d;if(_0x483dbf==='all')_0x45e94d=_0x1ae02e[_0x4f1978(0x1420)];else _0x483dbf===_0x4f1978(0x139e)?_0x45e94d=_0x1ae02e[_0x4f1978(0x1420)]['filter'](_0x3ab5de=>!_0x3ab5de[_0x4f1978(0x1467)]):_0x45e94d=_0x1ae02e[_0x4f1978(0x1420)]['filter'](_0x5b50ac=>_0x5b50ac[_0x4f1978(0x1467)]===_0x483dbf);const _0x34affd=_0x4665cc?_0x45e94d[_0x4f1978(0xede)](_0x4d5760=>_0x4d5760[_0x4f1978(0x5d2)][_0x4f1978(0x1f7)]()[_0x4f1978(0xe82)](_0x4665cc)):_0x45e94d;if(_0x34affd['length']===0x0){const _0x115b8=_0x4665cc?'找不到匹配的表情':_0x4f1978(0x13d3);_0x4e1cee[_0x4f1978(0xf21)]=_0x4f1978(0x9d2)+_0x115b8+_0x4f1978(0x1517);return;}_0x34affd[_0x4f1978(0x59b)](_0x19b583=>{const _0x495348=_0x4f1978,_0x52a726=document[_0x495348(0x219)](_0x495348(0xaf9));_0x52a726[_0x495348(0x7c6)]=_0x495348(0x270),_0x52a726[_0x495348(0x156f)]=_0x19b583[_0x495348(0x5d2)],_0x52a726[_0x495348(0x746)][_0x495348(0xd11)]=_0x19b583['id'],_0x52a726[_0x495348(0xf21)]=_0x495348(0x14f1)+_0x19b583[_0x495348(0x258)]+_0x495348(0xca4)+_0x19b583[_0x495348(0x5d2)]+_0x495348(0x12f5),_0x52a726[_0x495348(0x122b)]('click',()=>{_0x460373?_0x3af7c6(_0x52a726):_0x3e11f8(_0x19b583);});const _0x255793=document[_0x495348(0x219)]('div');_0x255793[_0x495348(0x7c6)]=_0x495348(0xb05),_0x255793[_0x495348(0xf21)]='&times;',_0x255793[_0x495348(0x1199)]=async _0x47d83d=>{const _0x5136e3=_0x495348;_0x47d83d[_0x5136e3(0x1025)]();const _0x385322=await _0x109970(_0x5136e3(0xd33),_0x5136e3(0x1269)+_0x19b583[_0x5136e3(0x5d2)]+_0x5136e3(0xcd9),{'confirmButtonClass':_0x5136e3(0x1c6)});_0x385322&&(await _0x3df81a[_0x5136e3(0x1420)][_0x5136e3(0xc40)](_0x19b583['id']),_0x1ae02e[_0x5136e3(0x1420)]=_0x1ae02e['userStickers'][_0x5136e3(0xede)](_0x4ff4e5=>_0x4ff4e5['id']!==_0x19b583['id']),_0x3056ba());},_0x52a726['appendChild'](_0x255793),_0x4e1cee[_0x495348(0x6ce)](_0x52a726);});}let _0x460373=![],_0x304a7a=new Set(),_0x1ef2b4=![],_0x48d248=new Set(),_0x3d56b6=[],_0x3a060d=0x0;const _0x52bddc=0x2d;let _0x11c436=![];function _0x5af9ef(){const _0x4d4cb7=_0x2b1222;_0x460373=!_0x460373;const _0x11a76d=document[_0x4d4cb7(0x1f4)]('sticker-grid'),_0x21a652=document['getElementById'](_0x4d4cb7(0xe79)),_0x51d73d=document[_0x4d4cb7(0x1f4)](_0x4d4cb7(0xf17)),_0x25b367=document[_0x4d4cb7(0x1f4)](_0x4d4cb7(0x1c1));_0x11a76d['classList'][_0x4d4cb7(0x1483)](_0x4d4cb7(0xb15),_0x460373),_0x460373?(_0x21a652[_0x4d4cb7(0x231)]='完成',_0x51d73d[_0x4d4cb7(0x215)][_0x4d4cb7(0x887)]='flex',_0x304a7a[_0x4d4cb7(0x411)](),_0x25b367['checked']=![],_0x13ef1c()):(_0x21a652[_0x4d4cb7(0x231)]='管理',_0x51d73d[_0x4d4cb7(0x215)][_0x4d4cb7(0x887)]='none',_0x11a76d[_0x4d4cb7(0x14bf)](_0x4d4cb7(0x2e5))[_0x4d4cb7(0x59b)](_0x8aa078=>_0x8aa078[_0x4d4cb7(0x159b)][_0x4d4cb7(0xa9c)](_0x4d4cb7(0xc3e))));}function _0x127ad0(){const _0x517aa1=_0x2b1222,_0x447737=document['getElementById'](_0x517aa1(0x1c1)),_0x3adf28=_0x447737[_0x517aa1(0xe56)];let _0x1865f5;if(_0x483dbf===_0x517aa1(0x54b))_0x1865f5=_0x1ae02e['userStickers'];else _0x483dbf==='uncategorized'?_0x1865f5=_0x1ae02e['userStickers'][_0x517aa1(0xede)](_0x511329=>!_0x511329[_0x517aa1(0x1467)]):_0x1865f5=_0x1ae02e[_0x517aa1(0x1420)][_0x517aa1(0xede)](_0x3d96ae=>_0x3d96ae['categoryId']===_0x483dbf);_0x1865f5['forEach'](_0x5a218c=>{const _0x1ee25e=_0x517aa1,_0xf492dc=_0x5a218c['id'],_0x5acad9=document[_0x1ee25e(0xeda)](_0x1ee25e(0xc98)+_0xf492dc+'\x22]');if(_0x3adf28){_0x304a7a[_0x1ee25e(0x6a4)](_0xf492dc);if(_0x5acad9)_0x5acad9[_0x1ee25e(0x159b)]['add']('selected');}else{_0x304a7a['delete'](_0xf492dc);if(_0x5acad9)_0x5acad9[_0x1ee25e(0x159b)][_0x1ee25e(0xa9c)](_0x1ee25e(0xc3e));}}),_0x13ef1c();}function _0x13ef1c(){const _0x497dcc=_0x2b1222,_0x35f1c6=document[_0x497dcc(0x1f4)](_0x497dcc(0xfb0));_0x35f1c6[_0x497dcc(0x231)]=_0x497dcc(0x408)+_0x304a7a[_0x497dcc(0xb51)]+')';}function _0x3af7c6(_0x20eb84){const _0x277c9d=_0x2b1222;if(!_0x460373)return;const _0x1254bb=_0x20eb84[_0x277c9d(0x746)]['stickerId'];if(!_0x1254bb)return;_0x20eb84['classList']['toggle']('selected'),_0x304a7a[_0x277c9d(0xe75)](_0x1254bb)?_0x304a7a[_0x277c9d(0xc40)](_0x1254bb):_0x304a7a[_0x277c9d(0x6a4)](_0x1254bb),_0x13ef1c();}async function _0x120d5b(){const _0x9ff9f0=_0x2b1222;if(_0x304a7a['size']===0x0)return;const _0x548678=await _0x109970(_0x9ff9f0(0xed1),'确定要删除选中的\x20'+_0x304a7a['size']+_0x9ff9f0(0x56b),{'confirmButtonClass':_0x9ff9f0(0x1c6)});if(_0x548678){const _0x463bc8=[..._0x304a7a];await _0x3df81a[_0x9ff9f0(0x1420)]['bulkDelete'](_0x463bc8),_0x1ae02e[_0x9ff9f0(0x1420)]=_0x1ae02e['userStickers'][_0x9ff9f0(0xede)](_0x25764e=>!_0x463bc8[_0x9ff9f0(0xe82)](_0x25764e['id'])),_0x5af9ef(),_0x3056ba(),await _0x1460c5('删除成功',_0x9ff9f0(0xe70));}}async function _0x12c64d(){const _0x149edb=_0x2b1222,_0x4dc31f=_0x149edb(0x73d),_0x370a86=await _0x11f6fb('批量导入表情',_0x4dc31f,'',_0x149edb(0x1097));_0x370a86&&_0x370a86[_0x149edb(0x4a2)]()&&await _0x17e253(_0x370a86);}async function _0x17e253(_0x573112){const _0x2ac14e=_0x2b1222,_0x509355=_0x573112[_0x2ac14e(0x4a2)]()['split']('\x0a'),_0xb7c8ed=[],_0x1266c6=_0x2ac14e(0x1175);let _0x5702a6=0x0;const _0xd02f65=_0x483dbf!==_0x2ac14e(0x54b)&&_0x483dbf!=='uncategorized'?_0x483dbf:null;for(const _0x117457 of _0x509355){const _0x51fdb7=_0x117457[_0x2ac14e(0x4a2)]();if(!_0x51fdb7||_0x51fdb7['includes']('填入'))continue;const _0x3889d7=_0x51fdb7['match'](/^(.+?)[:：]\s*(https?:\/\/.+)$/);if(_0x3889d7){const _0x19635f=_0x3889d7[0x1][_0x2ac14e(0x4a2)](),_0xe5ede3=_0x3889d7[0x2][_0x2ac14e(0x4a2)]();_0xb7c8ed[_0x2ac14e(0x1426)]({'id':_0x2ac14e(0xb20)+Date[_0x2ac14e(0xd6e)]()+Math[_0x2ac14e(0x13ae)](),'name':_0x19635f,'url':_0xe5ede3,'categoryId':_0xd02f65});continue;}let _0x1697dd=null,_0x226b82=null;const _0x3c2850=_0x51fdb7[_0x2ac14e(0xba5)](/^([\u4e00-\u9fa5]+)([a-zA-Z0-9]+\..+)$/);if(_0x3c2850)_0x1697dd=_0x3c2850[0x1],_0x226b82=_0x3c2850[0x2];else{const _0x1b90be=_0x51fdb7[_0x2ac14e(0x23f)](/\s+/);_0x1b90be[_0x2ac14e(0x58a)]>=0x2&&(_0x226b82=_0x1b90be['pop'](),_0x1697dd=_0x1b90be[_0x2ac14e(0x1143)]('\x20'));}_0x1697dd&&_0x226b82&&_0x226b82['includes']('.')?_0xb7c8ed[_0x2ac14e(0x1426)]({'id':_0x2ac14e(0xb20)+Date['now']()+Math[_0x2ac14e(0x13ae)](),'name':_0x1697dd,'url':_0x1266c6+_0x226b82,'categoryId':_0xd02f65}):(_0x5702a6++,console[_0x2ac14e(0xb3b)](_0x2ac14e(0x99d),_0x51fdb7));}_0x5702a6>0x0&&await _0x1460c5(_0x2ac14e(0x78c),'有\x20'+_0x5702a6+_0x2ac14e(0x1353));if(_0xb7c8ed[_0x2ac14e(0x58a)]>0x0)await _0x3df81a[_0x2ac14e(0x1420)][_0x2ac14e(0x4ea)](_0xb7c8ed),_0x1ae02e[_0x2ac14e(0x1420)][_0x2ac14e(0x1426)](..._0xb7c8ed),_0x3056ba(),await _0x1460c5(_0x2ac14e(0x1159),_0x2ac14e(0x12e4)+_0xb7c8ed[_0x2ac14e(0x58a)]+_0x2ac14e(0x1387));else _0x5702a6===0x0&&alert('没有找到可导入的内容。请检查您粘贴的格式是否正确。');}function _0x165061(_0x18333a){const _0x961f16=_0x2b1222,_0xe07f60=_0x961f16(0x85f)+_0x18333a+'\x22]',_0xf8938a=document[_0x961f16(0xeda)](_0xe07f60);_0xf8938a?(_0xf8938a[_0x961f16(0x29f)]({'behavior':'smooth','block':'center'}),_0xf8938a[_0x961f16(0x159b)][_0x961f16(0x6a4)](_0x961f16(0xe1a)),setTimeout(()=>{const _0x33b2a4=_0x961f16;document[_0x33b2a4(0x8b9)]['contains'](_0xf8938a)&&_0xf8938a[_0x33b2a4(0x159b)]['remove'](_0x33b2a4(0xe1a));},0x5dc)):alert(_0x961f16(0xa72));}async function _0x1c1dfa(_0x2976e1,_0x41631c){const _0xefaca7=_0x2b1222;if(_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0x503)){const _0x58064b=document[_0xefaca7(0x219)](_0xefaca7(0xaf9));_0x58064b[_0xefaca7(0x7c6)]=_0xefaca7(0x158b),_0x58064b[_0xefaca7(0x746)][_0xefaca7(0x1388)]=_0x2976e1[_0xefaca7(0x1388)];const _0x349fa3=document[_0xefaca7(0x219)](_0xefaca7(0xaf9));return _0x349fa3[_0xefaca7(0x7c6)]='message-bubble\x20recalled-message-placeholder',_0x349fa3['dataset'][_0xefaca7(0x1388)]=_0x2976e1['timestamp'],_0x349fa3[_0xefaca7(0x231)]=_0x2976e1['content'],_0x58064b['appendChild'](_0x349fa3),_0x1160f3(_0x58064b,()=>_0x3ede62(_0x2976e1[_0xefaca7(0x1388)])),_0x58064b[_0xefaca7(0x122b)](_0xefaca7(0x740),()=>{const _0x176efd=_0xefaca7;_0x50ca2c&&_0x52f5ce(_0x2976e1[_0x176efd(0x1388)]);}),_0x58064b;}else{if(_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0xe5a)){const _0x3ff58a=document[_0xefaca7(0x219)]('div');_0x3ff58a['className']=_0xefaca7(0x158b),_0x3ff58a[_0xefaca7(0x746)][_0xefaca7(0x1388)]=_0x2976e1['timestamp'];const _0x58888a=document[_0xefaca7(0x219)]('div');return _0x58888a[_0xefaca7(0x7c6)]='message-bubble\x20post-deleted-placeholder',_0x58888a[_0xefaca7(0x746)]['postId']=_0x2976e1[_0xefaca7(0xd8f)],_0x58888a[_0xefaca7(0x231)]=_0x2976e1[_0xefaca7(0x128c)],_0x3ff58a[_0xefaca7(0x6ce)](_0x58888a),_0x1160f3(_0x3ff58a,()=>_0x3ede62(_0x2976e1[_0xefaca7(0x1388)])),_0x3ff58a['addEventListener'](_0xefaca7(0x740),()=>{const _0x1b0b90=_0xefaca7;_0x50ca2c&&_0x52f5ce(_0x2976e1[_0x1b0b90(0x1388)]);}),_0x3ff58a;}}if(_0x2976e1[_0xefaca7(0x58e)])return null;if(_0x2976e1['type']===_0xefaca7(0x1454)){const _0x23dfa0=document['createElement']('div');_0x23dfa0['className']=_0xefaca7(0x158b);const _0x495244=document[_0xefaca7(0x219)]('div');return _0x495244['className']=_0xefaca7(0x5ba),_0x495244[_0xefaca7(0x746)]['timestamp']=_0x2976e1[_0xefaca7(0x1388)],_0x495244[_0xefaca7(0x231)]=_0x2976e1[_0xefaca7(0x128c)],_0x23dfa0[_0xefaca7(0x6ce)](_0x495244),_0x1160f3(_0x23dfa0,()=>_0x3ede62(_0x2976e1[_0xefaca7(0x1388)])),_0x23dfa0[_0xefaca7(0x122b)](_0xefaca7(0x740),()=>{const _0x1ebdde=_0xefaca7;if(_0x50ca2c)_0x52f5ce(_0x2976e1[_0x1ebdde(0x1388)]);}),_0x23dfa0;}const _0x224236=_0x2976e1[_0xefaca7(0xfbb)]===_0xefaca7(0x860),_0x5cd5b0=_0x41631c['settings'][_0xefaca7(0xe31)]||'我',_0x8ea874=document['createElement'](_0xefaca7(0xaf9));_0x8ea874[_0xefaca7(0x7c6)]=_0xefaca7(0x79b)+(_0x224236?_0xefaca7(0x860):'ai');if(_0x41631c['isGroup']&&!_0x224236){const _0x414217=_0x41631c[_0xefaca7(0x1402)][_0xefaca7(0x13b7)](_0x5e697b=>_0x5e697b[_0xefaca7(0x96f)]===_0x2976e1[_0xefaca7(0xfb7)]),_0x219a74=document[_0xefaca7(0x219)]('div');_0x219a74[_0xefaca7(0x7c6)]=_0xefaca7(0xc7e),_0x219a74[_0xefaca7(0x231)]=_0x414217?_0x414217['groupNickname']:_0x2976e1['senderName']||_0xefaca7(0xec7),_0x8ea874['appendChild'](_0x219a74);}const _0x502bc1=document['createElement'](_0xefaca7(0xaf9));_0x502bc1[_0xefaca7(0x7c6)]=_0xefaca7(0x764)+(_0x224236?_0xefaca7(0x860):'ai'),_0x502bc1[_0xefaca7(0x746)]['timestamp']=_0x2976e1[_0xefaca7(0x1388)];const _0x50c636=document['createElement'](_0xefaca7(0x489));_0x50c636[_0xefaca7(0x7c6)]=_0xefaca7(0x1388),_0x50c636['textContent']=_0x463b94(_0x2976e1[_0xefaca7(0x1388)]);let _0x4dc1c6,_0x4b9310='';if(_0x224236)_0x4dc1c6=_0x41631c[_0xefaca7(0x6a8)][_0xefaca7(0x1207)]||(_0x41631c[_0xefaca7(0xe83)]?_0x203a38:_0x5494d0),_0x4b9310=_0x41631c[_0xefaca7(0x6a8)][_0xefaca7(0xef7)]||'';else{if(_0x41631c[_0xefaca7(0xe83)]){const _0xfc8974=_0x41631c[_0xefaca7(0x1402)][_0xefaca7(0x13b7)](_0x2a389b=>_0x2a389b[_0xefaca7(0x96f)]===_0x2976e1['senderName']);if(_0xfc8974){const _0x336d1d=_0x1ae02e[_0xefaca7(0x589)][_0xfc8974['id']];_0x4dc1c6=_0xfc8974['avatar']||(_0x336d1d?_0x336d1d[_0xefaca7(0x6a8)][_0xefaca7(0xc99)]:_0x54779f),_0x4b9310=_0xfc8974[_0xefaca7(0x757)]||(_0x336d1d?_0x336d1d['settings']['aiAvatarFrame']:'');}else _0x4dc1c6=_0x54779f,_0x4b9310='';}else _0x4dc1c6=_0x41631c[_0xefaca7(0x6a8)]['aiAvatar']||_0x5494d0,_0x4b9310=_0x41631c[_0xefaca7(0x6a8)]['aiAvatarFrame']||'';}let _0x454f3e;_0x4b9310?_0x454f3e=_0xefaca7(0x698)+_0x4dc1c6+_0xefaca7(0x8d5)+_0x4b9310+_0xefaca7(0x1e3):_0x454f3e=_0xefaca7(0xe40)+_0x4dc1c6+_0xefaca7(0x1216);const _0x2a2f30=_0x4b9310?_0xefaca7(0xcaf):'',_0x40511d=_0xefaca7(0x335)+_0x2a2f30+'\x22>'+_0x454f3e+_0xefaca7(0x149b);let _0x24d2c9,_0x22cbf3='';if(_0x2976e1['quote']){const _0x39136e=_0x140540(_0x41631c,_0x2976e1[_0xefaca7(0xadf)][_0xefaca7(0xfb7)]),_0x105ed3=String(_0x2976e1[_0xefaca7(0xadf)][_0xefaca7(0x128c)]||'');_0x22cbf3=_0xefaca7(0xd27)+_0x2976e1[_0xefaca7(0xadf)]['timestamp']+'\x22\x20style=\x22cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22quoted-sender\x22>回复\x20'+_0x39136e+':</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22quoted-content\x22>'+_0x105ed3+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}let _0x413c2a=_0x2976e1['content'];if(typeof _0x413c2a===_0xefaca7(0x6c3)&&_0x413c2a[_0xefaca7(0x4a2)]()[_0xefaca7(0xebf)]('<')&&_0x413c2a['trim']()['endsWith']('>'))_0x24d2c9=_0x413c2a,_0x502bc1[_0xefaca7(0x159b)][_0xefaca7(0x6a4)](_0xefaca7(0xd91));else{if(_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0x439)||_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0xd9b)||_0x2976e1['type']===_0xefaca7(0x804)||_0x2976e1['type']==='location_share'||_0x2976e1['type']===_0xefaca7(0xce9)||_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0xe86)||_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0xd83)||_0x2976e1['type']===_0xefaca7(0x904)||_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0x4a4)||_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0x14a8)||_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0x601)||_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0x7b8)||_0x2976e1['type']===_0xefaca7(0x248)||_0x2976e1['type']===_0xefaca7(0x1297)||_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0x132a)){if(_0x2976e1['type']===_0xefaca7(0x439)){const _0x52f392=_0x2976e1[_0xefaca7(0x128c)]||((_0x2976e1[_0xefaca7(0xdf2)]||'')+'\x20'+(_0x2976e1['description']||''))[_0xefaca7(0x4a2)](),_0x5413bc=/(「.*?」|“.*?”)/g,_0x561992=_0x52f392[_0xefaca7(0x23f)](_0x5413bc)[_0xefaca7(0xede)](_0x1b8c39=>_0x1b8c39);_0x24d2c9=_0x561992[_0xefaca7(0x1431)](_0x119000=>{const _0x4c6fa0=_0xefaca7;return _0x119000[_0x4c6fa0(0xebf)]('「')||_0x119000[_0x4c6fa0(0xebf)]('“')?'<span\x20class=\x22offline-dialogue\x22>'+_0x1ec77d(_0x119000)+'</span>':_0x4c6fa0(0xfa6)+_0x1ec77d(_0x119000['trim']())[_0x4c6fa0(0xef0)](/\n/g,_0x4c6fa0(0xc9b))+'</span>';})[_0xefaca7(0x1143)]('');}else{if(_0x2976e1[_0xefaca7(0xcbd)]==='share_link')_0x502bc1['classList'][_0xefaca7(0x6a4)](_0xefaca7(0x4f8),_0xefaca7(0x14a5)),_0x24d2c9=_0xefaca7(0xb9b)+_0x2976e1[_0xefaca7(0x1388)]+_0xefaca7(0x1408)+(_0x2976e1[_0xefaca7(0x156f)]||'无标题')+_0xefaca7(0x1ce)+(_0x2976e1[_0xefaca7(0xdec)]||_0xefaca7(0x70d))+_0xefaca7(0xb38)+(_0x2976e1[_0xefaca7(0x115e)]||'链接分享')+_0xefaca7(0x13c2);else{if(_0x2976e1['type']===_0xefaca7(0x804))_0x502bc1[_0xefaca7(0x159b)][_0xefaca7(0x6a4)](_0xefaca7(0x4f8),'is-card-like'),_0x24d2c9='<div\x20class=\x22link-share-card\x22\x20style=\x22cursor:\x20pointer;\x22\x20data-timestamp=\x22'+_0x2976e1[_0xefaca7(0x1388)]+_0xefaca7(0x1408)+_0x2976e1[_0xefaca7(0x487)][_0xefaca7(0x156f)]+_0xefaca7(0xe22)+_0x2976e1[_0xefaca7(0x487)][_0xefaca7(0xe15)][_0xefaca7(0x58a)]+'\x20条消息</div><div\x20class=\x22footer\x22><svg\x20class=\x22footer-icon\x22\x20...>...</svg><span>聊天记录</span></div></div>';else{if(_0x2976e1[_0xefaca7(0xcbd)]==='location_share'){_0x502bc1[_0xefaca7(0x159b)]['add'](_0xefaca7(0xbed),_0xefaca7(0x14a5));let _0x1f8f61;if(_0x2976e1[_0xefaca7(0x48d)])_0x1f8f61=_0x2976e1[_0xefaca7(0x48d)];else _0x1ae02e[_0xefaca7(0x12c0)][_0xefaca7(0x7d1)]&&_0x2976e1['image_prompt']?_0x1f8f61=_0xefaca7(0xe8f)+encodeURIComponent(_0x2976e1[_0xefaca7(0x1248)]):_0x1f8f61=_0xefaca7(0x5e8);const _0x88a799=_0xefaca7(0xb90)+_0x1f8f61+_0xefaca7(0xdc3);_0x24d2c9='<div\x20class=\x22location-share-card\x22><div\x20class=\x22card-text-area\x22><div\x20class=\x22card-text-primary\x22>'+_0x2976e1['content']+_0xefaca7(0xeab)+_0x88a799+_0xefaca7(0xd01);}else{if(_0x2976e1[_0xefaca7(0xcbd)]==='user_photo'||_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0xce9)){_0x502bc1['classList'][_0xefaca7(0x6a4)](_0xefaca7(0x97f),_0xefaca7(0x14a5));const _0x435a8c=_0x2976e1[_0xefaca7(0xcbd)]==='user_photo'?_0xefaca7(0x869):_0xefaca7(0xd72),_0x1521fb=_0x1ae02e[_0xefaca7(0x12c0)][_0xefaca7(0x7d1)]&&_0x2976e1[_0xefaca7(0x1248)]?_0xefaca7(0xe8f)+_0x2976e1[_0xefaca7(0x1248)]:_0xefaca7(0xe1f);_0x24d2c9=_0xefaca7(0xe40)+_0x1521fb+_0xefaca7(0x5ef)+_0x435a8c+_0xefaca7(0x365)+_0x2976e1['content']+'\x22>';}else{if(_0x2976e1['type']==='naiimag')_0x502bc1['classList'][_0xefaca7(0x6a4)](_0xefaca7(0xf0d),_0xefaca7(0x14a5)),_0x24d2c9=_0xefaca7(0xf4b)+_0x2976e1['imageUrl']+'\x22\x20class=\x22realimag-image\x22\x20alt=\x22NovelAI图片分享\x22\x20loading=\x22lazy\x22\x20onerror=\x22this.src=\x27https://i.postimg.cc/KYr2qRCK/1.jpg\x27;\x20this.alt=\x27图片加载失败\x27;\x22\x20title=\x22'+(_0x2976e1[_0xefaca7(0x936)]||_0x2976e1['prompt']||_0xefaca7(0x3e3))+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22nai-regenerate-btn\x22\x20title=\x22重新生成\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20xmlns=\x22http://www.w3.org/2000/svg\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2011A8.1\x208.1\x200\x200\x200\x204.5\x209M4\x205v4h4\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222.5\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4\x2013a8.1\x208.1\x200\x200\x200\x2015.5\x202m.5\x204v-4h-4\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222.5\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';else{if(_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0xd83)){_0x502bc1[_0xefaca7(0x159b)][_0xefaca7(0x6a4)](_0xefaca7(0xbf3),_0xefaca7(0x14a5));const _0x244ff1=Math[_0xefaca7(0x616)](0x1,Math['round']((_0x2976e1[_0xefaca7(0x128c)]||'')[_0xefaca7(0x58a)]/0x5)),_0x551779='0:'+String(_0x244ff1)[_0xefaca7(0x1189)](0x2,'0')+'\x27\x27',_0x59d784=_0xefaca7(0xbb6);if(_0x224236)_0x24d2c9=_0xefaca7(0x9b4)+encodeURIComponent(_0x2976e1[_0xefaca7(0x128c)])+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-waveform\x22>'+_0x59d784+_0xefaca7(0xbbb)+_0x551779+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-transcript\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';else{const _0x38bfd7=!_0x41631c[_0xefaca7(0xe83)]&&_0x41631c[_0xefaca7(0x6a8)]['enableTts']!==![],_0x1bde9c=_0x41631c[_0xefaca7(0x6a8)][_0xefaca7(0x4fc)]||_0xefaca7(0x929),_0x488449=_0x38bfd7?'data-voice-id=\x22'+_0x1bde9c+'\x22':'';_0x24d2c9=_0xefaca7(0x9b4)+encodeURIComponent(_0x2976e1[_0xefaca7(0x128c)])+'\x22\x20'+_0x488449+_0xefaca7(0x15e)+_0x59d784+_0xefaca7(0x1027)+_0x551779+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-transcript\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}else{if(_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0x904)){_0x502bc1['classList'][_0xefaca7(0x6a4)](_0xefaca7(0x26a),_0xefaca7(0x14a5));let _0x1e6387,_0x1af977;const _0x2fad5e=_0x41631c[_0xefaca7(0xe83)]?_0x41631c[_0xefaca7(0x6a8)][_0xefaca7(0xe31)]||'我':'我',_0x14a7d3=_0x140540(_0x41631c,_0x2976e1[_0xefaca7(0xfb7)]),_0x143596=_0x140540(_0x41631c,_0x2976e1['receiverName']||_0x41631c[_0xefaca7(0x5d2)]);if(_0x224236){if(_0x2976e1[_0xefaca7(0x1024)])_0x1e6387=_0xefaca7(0x86b)+_0x143596,_0x1af977=_0xefaca7(0x13d8);else{_0x1e6387=_0xefaca7(0x721)+_0x143596;if(_0x2976e1['status']===_0xefaca7(0x11d3))_0x1af977=_0xefaca7(0x809);else{if(_0x2976e1['status']===_0xefaca7(0x1281))_0x1af977='对方已拒收';else _0x1af977=_0x2976e1[_0xefaca7(0x10c2)]||_0xefaca7(0x125e);}}}else{if(_0x2976e1[_0xefaca7(0x1024)])_0x1e6387=_0xefaca7(0x3da)+_0x14a7d3,_0x1af977=_0xefaca7(0x2b4);else{if(_0x2976e1[_0xefaca7(0x14b1)]===_0x2fad5e){_0x1e6387=_0xefaca7(0x721)+_0x2fad5e;if(_0x2976e1[_0xefaca7(0x1589)]==='accepted')_0x1af977=_0xefaca7(0xcfe);else{if(_0x2976e1[_0xefaca7(0x1589)]===_0xefaca7(0x1281))_0x1af977=_0xefaca7(0x1252);else _0x502bc1[_0xefaca7(0x215)][_0xefaca7(0x14cb)]=_0xefaca7(0x9fa),_0x502bc1['dataset'][_0xefaca7(0x1589)]=_0xefaca7(0x630),_0x1af977=_0x2976e1['note']||_0xefaca7(0xf25);}}else _0x1e6387=_0xefaca7(0x851)+_0x14a7d3+_0xefaca7(0xda8)+_0x143596,_0x1af977=_0x2976e1['note']||'群聊内转账';}}const _0x2afaea=_0xefaca7(0x37a);_0x24d2c9=_0xefaca7(0x3db)+_0x2afaea+'\x20'+_0x1e6387+_0xefaca7(0x180)+Number(_0x2976e1[_0xefaca7(0x618)])[_0xefaca7(0x24f)](0x2)+_0xefaca7(0x397)+_0x1af977+_0xefaca7(0x5c2);}else{if(_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0x4a4)){_0x502bc1[_0xefaca7(0x159b)][_0xefaca7(0x6a4)]('is-waimai-request','is-card-like');if(_0x2976e1[_0xefaca7(0x1589)]==='paid'||_0x2976e1[_0xefaca7(0x1589)]===_0xefaca7(0x69b))_0x502bc1[_0xefaca7(0x159b)]['add'](_0xefaca7(0x8be)+_0x2976e1[_0xefaca7(0x1589)]);const _0x54dbc3=_0x140540(_0x41631c,_0x2976e1[_0xefaca7(0xfb7)]),_0x411aca=_0xefaca7(0x189)+_0x54dbc3+_0xefaca7(0x152e);let _0x43e473='';_0x2976e1[_0xefaca7(0x1589)]===_0xefaca7(0x630)&&!_0x224236&&(_0x43e473=_0xefaca7(0x1fc)),_0x24d2c9=_0xefaca7(0x11dc)+_0x411aca+_0xefaca7(0x93c)+Number(_0x2976e1[_0xefaca7(0x618)])['toFixed'](0x2)+_0xefaca7(0x449)+_0x2976e1[_0xefaca7(0x1388)]+_0xefaca7(0x216)+_0x43e473+_0xefaca7(0x149b),setTimeout(()=>{const _0x5b81de=_0xefaca7;if(_0x2976e1[_0x5b81de(0x1589)]===_0x5b81de(0x630)){const _0x2dbba0=document[_0x5b81de(0x1f4)](_0x5b81de(0x5a7)+_0x2976e1[_0x5b81de(0x1388)]);if(_0x2dbba0){const _0x1eafbf=_0x2a3153(_0x2dbba0,_0x2976e1[_0x5b81de(0xf5a)]);_0x5daf45[_0x2976e1[_0x5b81de(0x1388)]]=_0x1eafbf;}}},0x0);}else{if(_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0x14a8)){_0x502bc1[_0xefaca7(0x159b)][_0xefaca7(0x6a4)](_0xefaca7(0x15cf),_0xefaca7(0x14a5));const _0x51912a=_0x140540(_0x41631c,_0x2976e1['senderName']);let _0x7fc447='你';_0x41631c[_0xefaca7(0xe83)]&&(_0x7fc447=_0x140540(_0x41631c,_0x2976e1[_0xefaca7(0x309)])),_0x24d2c9=_0xefaca7(0xad4)+_0x51912a+_0xefaca7(0x1072)+_0x7fc447+_0xefaca7(0x839)+_0x2976e1[_0xefaca7(0xbf5)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22amount\x22\x20style=\x22margin-top:\x208px;\x22>¥'+Number(_0x2976e1[_0xefaca7(0x618)])[_0xefaca7(0x24f)](0x2)+_0xefaca7(0x1362);}else{if(_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0x601)){_0x502bc1[_0xefaca7(0x159b)][_0xefaca7(0x6a4)]('is-red-packet',_0xefaca7(0x14a5));const _0x4c28f4=_0x1ae02e['qzoneSettings'][_0xefaca7(0xb46)]||_0xefaca7(0xee7),_0x113c63=_0x2976e1[_0xefaca7(0x6dd)],_0x4da78c=_0x2976e1[_0xefaca7(0x13d5)]&&_0x2976e1['claimedBy'][_0x4c28f4];let _0x3d5ce9='',_0x34be54='',_0x13d998=_0xefaca7(0xdca);_0x113c63&&(_0x3d5ce9=_0xefaca7(0xcfc));if(_0x2976e1['packetType']===_0xefaca7(0x111e)){const _0xaa06a8=_0x140540(_0x41631c,_0x2976e1[_0xefaca7(0x14b1)]);_0x13d998=_0xefaca7(0x12dc)+_0xaa06a8;if(Object[_0xefaca7(0x1378)](_0x2976e1[_0xefaca7(0x13d5)]||{})['length']>0x0)_0x3d5ce9=_0xefaca7(0xcfc);}if(_0x4da78c){const _0xfef877=_0x2976e1['claimedBy'][_0x4c28f4]||0x0;_0x34be54=_0xefaca7(0x834)+_0xfef877['toFixed'](0x2)+'\x20元</div>';}else{if(_0x113c63)_0x34be54=_0xefaca7(0xc28);else{if(_0x2976e1[_0xefaca7(0xcdd)]===_0xefaca7(0x111e)&&Object['keys'](_0x2976e1[_0xefaca7(0x13d5)]||{})[_0xefaca7(0x58a)]>0x0){const _0x30dcc5=_0x140540(_0x41631c,_0x2976e1[_0xefaca7(0x14b1)]);_0x34be54='<div\x20class=\x22rp-claimed-info\x22>已被\x20'+_0x30dcc5+_0xefaca7(0x141b);}}}_0x24d2c9=_0xefaca7(0xd41)+_0x3d5ce9+_0xefaca7(0x3b5)+(_0x2976e1['greeting']||_0xefaca7(0x12d6))+_0xefaca7(0x1466)+_0x13d998+_0xefaca7(0x149b)+_0x34be54+_0xefaca7(0x149b);}else{if(_0x2976e1['type']===_0xefaca7(0x7b8)){_0x502bc1[_0xefaca7(0x159b)]['add'](_0xefaca7(0x56f),_0xefaca7(0x14a5));const _0x457d61=_0x2976e1[_0xefaca7(0x128d)]||_0x2976e1['content']||_0xefaca7(0xb40);let _0x2b0370=0x0;const _0x529b1c={};for(const _0x5f5ce9 in _0x2976e1[_0xefaca7(0xde9)]){const _0x1dcf7a=_0x2976e1['votes'][_0x5f5ce9][_0xefaca7(0x58a)];_0x529b1c[_0x5f5ce9]=_0x1dcf7a,_0x2b0370+=_0x1dcf7a;}const _0x1c7923=_0x1ae02e['qzoneSettings'][_0xefaca7(0xb46)]||'{{user}}';let _0x4501d8=null;for(const _0x17dc55 in _0x2976e1[_0xefaca7(0xde9)]){if(_0x2976e1[_0xefaca7(0xde9)][_0x17dc55]['includes'](_0x1c7923)){_0x4501d8=_0x17dc55;break;}}let _0x5cd7df=_0xefaca7(0xbdc);_0x2976e1[_0xefaca7(0x2c2)][_0xefaca7(0x59b)](_0x419180=>{const _0x33c6eb=_0xefaca7,_0x1e7883=_0x529b1c[_0x419180]||0x0,_0x27e4be=_0x2b0370>0x0?_0x1e7883/_0x2b0370*0x64:0x0,_0x4edbab=_0x4501d8===_0x419180;_0x5cd7df+='<div\x20class=\x22poll-option-item\x20'+(_0x4edbab?_0x33c6eb(0xcc7):'')+_0x33c6eb(0x313)+_0x419180+_0x33c6eb(0x67f)+_0x27e4be+'%;\x22></div><div\x20class=\x22poll-option-content\x22><span\x20class=\x22poll-option-text\x22>'+_0x419180+'</span><span\x20class=\x22poll-option-votes\x22>'+_0x1e7883+_0x33c6eb(0x21c);}),_0x5cd7df+='</div>';let _0x1c89e6=_0x2976e1[_0xefaca7(0x12cc)]?_0xefaca7(0xf94)+_0x2b0370+_0xefaca7(0x12d2):_0xefaca7(0xf94)+_0x2b0370+_0xefaca7(0xe12);_0x24d2c9='<div\x20class=\x22poll-card\x20'+(_0x2976e1[_0xefaca7(0x12cc)]?_0xefaca7(0xd87):'')+_0xefaca7(0xf10)+_0x2976e1[_0xefaca7(0x1388)]+_0xefaca7(0x139a)+_0x457d61+'</div>'+_0x5cd7df+_0x1c89e6+'</div>';}else{if(_0x2976e1[_0xefaca7(0xcbd)]===_0xefaca7(0x248)){_0x502bc1[_0xefaca7(0x159b)][_0xefaca7(0x6a4)](_0xefaca7(0xf19),_0xefaca7(0x14a5));let _0x3fcb49;const _0xb564f8=_0x41631c[_0xefaca7(0x6a8)][_0xefaca7(0xe31)]||'我';if(_0x41631c[_0xefaca7(0xe83)]){if(_0x2976e1[_0xefaca7(0xd62)]&&_0x2976e1[_0xefaca7(0xd62)]['length']>0x0){const _0x2366c1=_0x2976e1[_0xefaca7(0xd62)][_0xefaca7(0x1431)](_0x4fb6d0=>_0x140540(_0x41631c,_0x4fb6d0));_0x2366c1[_0xefaca7(0x58a)]===0x1?_0x3fcb49='送给\x20'+_0x2366c1[0x0]+'\x20的礼物':_0x3fcb49=_0xefaca7(0x4e4)+_0x2366c1[_0xefaca7(0x5cc)](0x0,0x2)[_0xefaca7(0x1143)]('、')+'等人的礼物';}else _0x3fcb49='送给大家的礼物';}else{if(_0x224236)_0x3fcb49=_0xefaca7(0x4e4)+_0x41631c[_0xefaca7(0x5d2)]+'\x20的礼物';else{const _0x3900e8=_0x41631c[_0xefaca7(0x6a8)]['myNickname']||'你';_0x3fcb49=_0xefaca7(0x4e4)+_0x3900e8+'\x20的礼物';}}const _0x4de74a=_0x2976e1[_0xefaca7(0x3ca)][_0xefaca7(0x5cc)](0x0,0x3);let _0x59cced='';_0x4de74a[_0xefaca7(0x59b)](_0x362a9b=>{const _0x28dcc8=_0xefaca7;_0x59cced+=_0x28dcc8(0x10fb)+_0x362a9b[_0x28dcc8(0x48d)]+'\x22\x20class=\x22gift-preview-img\x22><span\x20class=\x22gift-preview-name\x22>'+_0x362a9b['name']+_0x28dcc8(0x156c)+_0x362a9b[_0x28dcc8(0x262)]+_0x28dcc8(0x3a6);});let _0xbb35d3='';_0x2976e1[_0xefaca7(0x3ca)]['length']>0x3&&(_0xbb35d3='\x20等'+_0x2976e1['items']['length']+_0xefaca7(0x456)),_0x24d2c9='<div\x20class=\x22gift-card\x22><div\x20class=\x22gift-header\x22><svg\x20class=\x22gift-header-icon\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22currentColor\x22><path\x20d=\x22M20\x206h-2.18a4\x204\x200\x200\x200-7.64\x200H8a4\x204\x200\x200\x200-4\x204v2h20V10a4\x204\x200\x200\x200-4-4zM8\x204a2\x202\x200\x201\x201-2\x202a2\x202\x200\x200\x201\x202-2zm12\x200a2\x202\x200\x201\x201-2\x202a2\x202\x200\x200\x201\x202-2zM4\x2014v6a2\x202\x200\x200\x200\x202\x202h12a2\x202\x200\x200\x200\x202-2v-6H4z\x22></path></svg><span\x20class=\x22gift-header-text\x22>'+_0x3fcb49+_0xefaca7(0x395)+_0x59cced+_0xefaca7(0x65f)+_0x2976e1[_0xefaca7(0x3ca)][_0xefaca7(0x58a)]+_0xefaca7(0x456)+_0xbb35d3+'，点击查看</div></div>';}}}}}}}}}}}}}}else{const _0x857b4d=String(_0x413c2a);let _0x197b03=await _0x3f4407(_0x857b4d,_0x41631c['id']);if(_0x197b03!==_0x857b4d)_0x24d2c9=_0x197b03,_0x502bc1[_0xefaca7(0x159b)][_0xefaca7(0x6a4)](_0xefaca7(0x14a5));else{if(Array[_0xefaca7(0x121f)](_0x2976e1[_0xefaca7(0x128c)])&&_0x2976e1['content'][0x0]?.[_0xefaca7(0xcbd)]===_0xefaca7(0x1296)){const _0x524135=_0x2976e1[_0xefaca7(0x128c)][0x0][_0xefaca7(0x1296)][_0xefaca7(0x258)];_0x24d2c9=_0xefaca7(0xe40)+_0x524135+'\x22\x20class=\x22chat-image\x22>';}else{if(_0x43460a[_0xefaca7(0x60b)](_0x197b03))_0x502bc1['classList']['add'](_0xefaca7(0x26d),_0xefaca7(0x14a5)),_0x24d2c9=_0xefaca7(0xe40)+_0x197b03+'\x22\x20alt=\x22'+(_0x2976e1[_0xefaca7(0x339)]||_0xefaca7(0xc4a))+_0xefaca7(0xa48);else{let _0x3bd7ee=_0x5ed2b0(_0x197b03,_0x41631c);_0x24d2c9=_0x1ec77d(_0x3bd7ee)[_0xefaca7(0xef0)](/\n/g,_0xefaca7(0xc9b));}}}}}_0x502bc1[_0xefaca7(0xf21)]=_0xefaca7(0x273)+_0x40511d+_0xefaca7(0xe55)+_0x22cbf3+_0xefaca7(0x1375)+_0x24d2c9+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x8ea874[_0xefaca7(0x6ce)](_0x502bc1),_0x8ea874['appendChild'](_0x50c636),_0x1160f3(_0x8ea874,()=>_0x3ede62(_0x2976e1['timestamp'])),_0x8ea874[_0xefaca7(0x122b)](_0xefaca7(0x740),()=>{const _0x45ae0b=_0xefaca7;if(_0x50ca2c)_0x52f5ce(_0x2976e1[_0x45ae0b(0x1388)]);});if(!_0x224236){const _0x56beb3=_0x8ea874[_0xefaca7(0xeda)]('.avatar-group');_0x56beb3&&(_0x56beb3[_0xefaca7(0x215)][_0xefaca7(0x14cb)]=_0xefaca7(0x9fa),!_0x41631c[_0xefaca7(0xe83)]?_0x56beb3[_0xefaca7(0x122b)](_0xefaca7(0x740),_0x4d1d37=>{const _0x4655c3=_0xefaca7;_0x4d1d37[_0x4655c3(0x1025)](),_0x44a7fc(_0x41631c['id']);}):_0x56beb3['addEventListener'](_0xefaca7(0x11b0),_0x2db573=>{const _0x4578ac=_0xefaca7;_0x2db573[_0x4578ac(0x1025)](),_0x2baf5c(_0x41631c['id'],_0x2976e1[_0x4578ac(0xfb7)]);}));}return _0x8ea874;}async function _0x36c625(_0x45b398,_0x46dbd4){const _0x1f6018=_0x2b1222,_0x5b1315=document[_0x1f6018(0x1f4)](_0x1f6018(0xd31)),_0x410b43=await _0x1c1dfa(_0x45b398,_0x46dbd4);if(!_0x410b43)return;const _0x37e76e=document[_0x1f6018(0x1f4)]('load-more-btn');_0x37e76e?_0x5b1315[_0x1f6018(0xa69)](_0x410b43,_0x37e76e['nextSibling']):_0x5b1315[_0x1f6018(0x2d2)](_0x410b43);}async function _0x5286f1(_0x44b593,_0x5ef2b1,_0xe40e65=![]){const _0x166b9d=_0x2b1222,_0x37b864=document[_0x166b9d(0x1f4)](_0x166b9d(0xd31)),_0x4cca81=document['getElementById'](_0x166b9d(0x5ae)),_0x273755=_0x5ef2b1['history']['filter'](_0x30175c=>!_0x30175c['isHidden'])['pop']();if(_0x273755&&_0x44b593['timestamp']-_0x273755['timestamp']>0x927c0){const _0x351ae7=_0x4a4f71(_0x44b593[_0x166b9d(0x1388)]);_0x37b864[_0x166b9d(0xa69)](_0x351ae7,_0x4cca81);}const _0x2587a3=await _0x1c1dfa(_0x44b593,_0x5ef2b1);if(!_0x2587a3)return;_0x44b593[_0x166b9d(0xfbb)]===_0x166b9d(0x13c0)&&!_0xe40e65&&_0x5e2ecb(),!_0xe40e65&&_0x2587a3[_0x166b9d(0x159b)]['add']('animate-in'),_0x37b864['insertBefore'](_0x2587a3,_0x4cca81),!_0xe40e65&&(_0x37b864[_0x166b9d(0x2d4)]=_0x37b864['scrollHeight'],_0x3dea4f++);}async function _0x4c0122(_0x26a96c){const _0x1f53bb=_0x2b1222;_0x1ae02e[_0x1f53bb(0x588)]=_0x26a96c;const _0xb95762=_0x1ae02e[_0x1f53bb(0x589)][_0x26a96c];if(!_0xb95762)return;_0xb95762[_0x1f53bb(0xf2c)]>0x0&&(_0xb95762[_0x1f53bb(0xf2c)]=0x0,await _0x3df81a[_0x1f53bb(0x589)][_0x1f53bb(0x295)](_0xb95762));_0x3594f0(_0xb95762),_0x3689f0(_0x26a96c),_0x2e53fa(_0x1f53bb(0x13c3)),window['updateListenTogetherIconProxy'](_0x1ae02e[_0x1f53bb(0x588)]);const _0x5982f7=_0xb95762['isGroup']||![];_0x5ed783(_0x5982f7),document[_0x1f53bb(0x1f4)](_0x1f53bb(0x1448))[_0x1f53bb(0x215)]['display']=_0x5982f7?_0x1f53bb(0xeba):'none';const _0x2ed3ec=document[_0x1f53bb(0x1f4)](_0x1f53bb(0xfee));_0x2ed3ec&&(_0x2ed3ec[_0x1f53bb(0x215)][_0x1f53bb(0x887)]=_0x5982f7?'none':_0x1f53bb(0xeba));const _0x52d4c3=document['getElementById'](_0x1f53bb(0xd92)),_0x449aa1=document[_0x1f53bb(0x1f4)](_0x1f53bb(0x1410)),_0x38f75a=document['getElementById'](_0x1f53bb(0x536)),_0x377657=document['getElementById']('werewolf-game-btn');_0x449aa1&&_0x38f75a&&_0x377657&&_0x52d4c3&&(_0x449aa1[_0x1f53bb(0x215)][_0x1f53bb(0x887)]=_0x1f53bb(0xeba),_0x38f75a[_0x1f53bb(0x215)][_0x1f53bb(0x887)]=_0x5982f7?_0x1f53bb(0x1b5):_0x1f53bb(0xeba),_0x377657[_0x1f53bb(0x215)][_0x1f53bb(0x887)]=_0x5982f7?_0x1f53bb(0xeba):'none',_0x52d4c3[_0x1f53bb(0x215)][_0x1f53bb(0x887)]=_0x5982f7?_0x1f53bb(0x1b5):'flex'),_0x27308f(),!_0xb95762['isGroup']&&_0xb95762[_0x1f53bb(0x13ab)]?.[_0x1f53bb(0x1589)]===_0x1f53bb(0x1100)&&(console[_0x1f53bb(0x57e)](_0x1f53bb(0xf1e)+_0xb95762['name']+'\x22\x20自动触发AI响应...'),_0x5626da()),document[_0x1f53bb(0x1f4)](_0x1f53bb(0x1536))[_0x1f53bb(0x215)][_0x1f53bb(0x887)]=_0x5982f7?_0x1f53bb(0xeba):'none',document[_0x1f53bb(0x8b9)][_0x1f53bb(0x159b)]['remove'](_0x1f53bb(0x2c7));}function _0x450e6f(_0x335674,_0x1f0f18){const _0x3b75de=_0x2b1222,_0x74a039=_0x1f0f18?_0x3b75de(0x6a4):_0x3b75de(0xa9c),_0xefce77=_0x33868f=>{const _0xc68e2=_0x3b75de;_0x33868f&&_0x33868f[_0xc68e2(0x159b)][_0x74a039]('is-acting');},_0xb25043=document[_0x3b75de(0xeda)]('.chat-list-item[data-chat-id=\x22'+_0x335674+_0x3b75de(0x1478));_0xefce77(_0xb25043);const _0x75c056=document[_0x3b75de(0x14bf)]('.post-avatar[data-author-id=\x22'+_0x335674+'\x22]');_0x75c056[_0x3b75de(0x59b)](_0xefce77);const _0x2d5847=document[_0x3b75de(0xeda)](_0x3b75de(0x1104)+_0x335674+'\x22]');_0xefce77(_0x2d5847);}async function _0x39f47d(){const _0x1142cc=_0x2b1222;if(!_0x1ae02e[_0x1142cc(0x588)])return;const _0x1ab9dc=_0x1ae02e[_0x1142cc(0x588)],_0x11718a=_0x1ae02e[_0x1142cc(0x589)][_0x1ab9dc];lastRawAiResponse='',lastResponseTimestamps=[];const _0x564e7f=document['getElementById'](_0x1142cc(0x1034));_0x564e7f&&(_0x564e7f[_0x1142cc(0xa0d)]=!![],_0x564e7f['textContent']='思考中...');_0x450e6f(_0x1ab9dc,!![]);try{const {proxyUrl:_0x37d7bc,apiKey:_0x299ec2,model:_0x1b9876}=_0x1ae02e['apiConfig'];if(!_0x37d7bc||!_0x299ec2||!_0x1b9876)throw new Error(_0x1142cc(0x8b4));const _0x5735e1=parseInt(_0x11718a[_0x1142cc(0x6a8)][_0x1142cc(0x4b2)])||0xa,_0x59edef=_0x11718a[_0x1142cc(0xce3)][_0x1142cc(0x5cc)](-_0x5735e1);let _0x49a739='';if(_0x11718a[_0x1142cc(0x6a8)][_0x1142cc(0x1469)]&&_0x11718a[_0x1142cc(0x6a8)][_0x1142cc(0x1469)][_0x1142cc(0x58a)]>0x0){const _0x36eb76=_0x11718a[_0x1142cc(0x6a8)][_0x1142cc(0x1469)][_0x1142cc(0x1431)](_0x5d97fc=>{const _0x44ee78=_0x1142cc,_0x2bbc27=_0x1ae02e[_0x44ee78(0x1453)]['find'](_0x16a24b=>_0x16a24b['id']===_0x5d97fc);if(!_0x2bbc27||!Array[_0x44ee78(0x121f)](_0x2bbc27[_0x44ee78(0x128c)]))return'';const _0x89e22f=_0x2bbc27[_0x44ee78(0x128c)][_0x44ee78(0xede)](_0x3fa256=>_0x3fa256[_0x44ee78(0x1368)]!==![])[_0x44ee78(0x1431)](_0x3684fa=>{const _0x5b173=_0x44ee78;let _0x3a7b63=_0x5b173(0x272)+(_0x3684fa[_0x5b173(0x306)]||_0x5b173(0x286))+'\x0a';if(_0x3684fa[_0x5b173(0x1378)][_0x5b173(0x58a)]>0x0)_0x3a7b63+=_0x5b173(0x935)+_0x3684fa[_0x5b173(0x1378)][_0x5b173(0x1143)](',\x20')+'\x0a';return _0x3a7b63+=_0x5b173(0x3d9)+_0x3684fa['content'],_0x3a7b63;})[_0x44ee78(0x1143)]('');return _0x89e22f?_0x44ee78(0x404)+_0x2bbc27['name']+'\x0a'+_0x89e22f:'';})['filter'](Boolean)['join']('');_0x36eb76&&(_0x49a739='#\x20---\x20世界书\x20(World\x20Book)\x20---\x0a#\x20【最高优先级规则：世界观设定】\x0a#\x20你【必须】将以下所有“世界书”中的设定，视为绝对的、不可动摇的背景事实。\x0a#\x20你的所有回复和行为都【绝对不能】与这些设定产生任何冲突。\x0a'+_0x36eb76+'\x0a#\x20---\x20世界书设定结束\x20---\x0a');}let _0x1e9e65=_0x1142cc(0x153b),_0xcffb27=![];_0x11718a['members']['forEach'](_0x414332=>{const _0x5f3c55=_0x1142cc,_0x3216a5=_0x1ae02e[_0x5f3c55(0x589)][_0x414332['id']];_0x3216a5&&_0x3216a5[_0x5f3c55(0x5fb)]&&_0x3216a5[_0x5f3c55(0x5fb)][_0x5f3c55(0x58a)]>0x0&&(_0x1e9e65+='\x0a##\x20---\x20关于“'+_0x414332['groupNickname']+_0x5f3c55(0x12f4),_0x1e9e65+=_0x3216a5[_0x5f3c55(0x5fb)]['map'](_0x33e903=>_0x5f3c55(0x10a4)+_0x3f7f7a(_0x33e903[_0x5f3c55(0x1388)])+')\x20'+_0x33e903['content'])[_0x5f3c55(0x1143)]('\x0a'),_0xcffb27=!![]);});!_0xcffb27&&(_0x1e9e65+='-\x20(暂无)');let _0x6a9466='';const _0x13d8b0=_0x11718a['settings'][_0x1142cc(0x11c5)]||0xa;if(_0x11718a[_0x1142cc(0x6a8)]['linkedMemoryChatIds']&&_0x11718a[_0x1142cc(0x6a8)]['linkedMemoryChatIds'][_0x1142cc(0x58a)]>0x0){}const _0x3f177d=_0x11718a['members']['map'](_0x411c3c=>_0x1142cc(0x6ca)+_0x411c3c[_0x1142cc(0xd69)]+_0x1142cc(0x104e)+_0x411c3c[_0x1142cc(0x96f)]+_0x1142cc(0x126a)+_0x411c3c[_0x1142cc(0x3be)])[_0x1142cc(0x1143)]('\x0a'),_0x306496=_0x2c88ab(_0x11718a),_0x4855ca='\x0a#\x20核心任务：群聊剧本作家\x0a你是一个剧本作家，负责创作一个名为“'+_0x11718a[_0x1142cc(0x5d2)]+_0x1142cc(0xc83)+_0x11718a[_0x1142cc(0x5d2)]+'\x0a\x0a#\x20上下文参考\x20(你必须阅读并遵守)\x0a'+_0x1e9e65+'\x0a'+_0x49a739+'\x0a'+_0x6a9466+'\x0a-\x20**这是你们最近的对话历史**:\x0a'+_0x59edef[_0x1142cc(0x1431)](_0x59c324=>_0x140540(_0x11718a,_0x59c324['senderName'])+':\x20'+_0x59c324[_0x1142cc(0x128c)])['join']('\x0a')+_0x1142cc(0x122a)+_0x3f177d+_0x1142cc(0xf0e)+_0x306496+'\x0a现在，请根据以上所有信息，继续这场没有用户参与的群聊，并自由地使用各种指令来丰富你们的互动。\x0a',_0x38a70b=_0x59edef['map'](_0x466ac7=>({'role':'user','content':_0x140540(_0x11718a,_0x466ac7[_0x1142cc(0xfb7)])+':\x20'+_0x466ac7['content']}));let _0x399c2b=_0x37d7bc['includes']('generativelanguage.googleapis.com'),_0x4b13d4;if(_0x399c2b){let _0x25b6d6=_0x16b978(_0x1b9876,_0x299ec2,_0x4855ca,_0x38a70b);_0x4b13d4=await fetch(_0x25b6d6[_0x1142cc(0x258)],_0x25b6d6['data']);}else _0x4b13d4=await fetch(_0x37d7bc+_0x1142cc(0x14c2),{'method':'POST','headers':{'Content-Type':_0x1142cc(0xa90),'Authorization':'Bearer\x20'+_0x299ec2},'body':JSON[_0x1142cc(0x994)]({'model':_0x1b9876,'messages':[{'role':_0x1142cc(0x1594),'content':_0x4855ca},..._0x38a70b],'temperature':_0x1ae02e[_0x1142cc(0x12c0)][_0x1142cc(0x217)]||0.9})});if(!_0x4b13d4['ok']){const _0x2a7a5c=await _0x4b13d4['json']()[_0x1142cc(0x3d1)](()=>({'error':{'message':_0x4b13d4[_0x1142cc(0x1260)]}}));throw new Error(_0x1142cc(0x47b)+_0x4b13d4['status']+_0x1142cc(0x7c5)+(_0x2a7a5c['error']?.[_0x1142cc(0x11f0)]||_0x1142cc(0x1ba)));}const _0x59c10e=await _0x4b13d4['json'](),_0x19b4e8=getGeminiResponseText(_0x59c10e);lastRawAiResponse=_0x19b4e8;const _0x477052=_0x1493d9(_0x19b4e8);let _0x79d0cf=Date['now']();for(const _0x292f72 of _0x477052){if(!_0x292f72||!_0x292f72['type']||!_0x292f72[_0x1142cc(0x5d2)])continue;let _0xcc41c7=null;const _0x14969f=_0x79d0cf++;lastResponseTimestamps[_0x1142cc(0x1426)](_0x14969f);const _0x58866b={'role':_0x1142cc(0x13c0),'senderName':_0x292f72[_0x1142cc(0x5d2)],'timestamp':_0x14969f};switch(_0x292f72[_0x1142cc(0xcbd)]){case _0x1142cc(0x40f):_0xcc41c7={..._0x58866b,'content':_0x292f72[_0x1142cc(0x128c)]};break;case _0x1142cc(0x1b3):if(_0x292f72[_0x1142cc(0x339)]){const _0x55e612=_0x1ae02e['userStickers']['find'](_0x40e3e6=>_0x40e3e6[_0x1142cc(0x5d2)]===_0x292f72['meaning']);_0x55e612?_0xcc41c7={..._0x58866b,'type':_0x1142cc(0x1b3),'content':_0x55e612['url'],'meaning':_0x55e612[_0x1142cc(0x5d2)]}:(console['warn'](_0x1142cc(0x148b)+_0x292f72[_0x1142cc(0x339)]+'\x22'),_0xcc41c7={..._0x58866b,'type':_0x1142cc(0x40f),'content':_0x1142cc(0xe39)+_0x292f72[_0x1142cc(0x339)]+']'});}else console['warn'](_0x1142cc(0x1292),_0x292f72);break;case _0x1142cc(0xce9):_0xcc41c7={..._0x58866b,'type':'ai_image','content':_0x292f72[_0x1142cc(0xdec)],'image_prompt':_0x292f72[_0x1142cc(0x1248)]};break;case _0x1142cc(0xd83):_0xcc41c7={..._0x58866b,'type':_0x1142cc(0xd83),'content':_0x292f72['content']};break;case _0x1142cc(0x3d4):const _0x517862=_0x11718a[_0x1142cc(0xce3)][_0x1142cc(0x13b7)](_0x2f9af3=>_0x2f9af3['timestamp']===_0x292f72['target_timestamp']);_0x517862?_0xcc41c7={..._0x58866b,'content':_0x292f72[_0x1142cc(0x976)],'quote':{'timestamp':_0x517862['timestamp'],'senderName':_0x517862[_0x1142cc(0xfb7)],'content':String(_0x517862[_0x1142cc(0x128c)]||'')[_0x1142cc(0x516)](0x0,0x32)}}:_0xcc41c7={..._0x58866b,'content':_0x292f72[_0x1142cc(0x976)]};break;default:console[_0x1142cc(0xb3b)](_0x1142cc(0x118c),_0x292f72[_0x1142cc(0xcbd)]);continue;}_0xcc41c7&&(_0x11718a[_0x1142cc(0xce3)][_0x1142cc(0x1426)](_0xcc41c7),_0x5286f1(_0xcc41c7,_0x11718a),await new Promise(_0x15b86e=>setTimeout(_0x15b86e,Math[_0x1142cc(0x13ae)]()*0x4b0+0x320)));}await _0x3df81a[_0x1142cc(0x589)][_0x1142cc(0x295)](_0x11718a),_0x1033ae();}catch(_0x6600d9){console[_0x1142cc(0x127d)]('旁观模式推进剧情失败:',_0x6600d9),await _0x1460c5(_0x1142cc(0xc5a),_0x1142cc(0xb92)+_0x6600d9[_0x1142cc(0x11f0)]);}finally{_0x564e7f&&(_0x564e7f[_0x1142cc(0xa0d)]=![],_0x564e7f[_0x1142cc(0x231)]=_0x1142cc(0x15a9)),_0x450e6f(_0x1ab9dc,![]);}}async function _0x5626da(){const _0x43ff1b=_0x2b1222;if(!_0x1ae02e[_0x43ff1b(0x588)])return;const _0x47dcdb=_0x1ae02e['activeChatId'],_0x55f0fd=_0x1ae02e[_0x43ff1b(0x589)][_0x1ae02e[_0x43ff1b(0x588)]],_0x127eed=document[_0x43ff1b(0x1f4)](_0x43ff1b(0x13c3))['classList']['contains'](_0x43ff1b(0x7cf))&&_0x1ae02e[_0x43ff1b(0x588)]===_0x47dcdb;_0x450e6f(_0x47dcdb,!![]);const _0x550c06=document[_0x43ff1b(0x1f4)](_0x43ff1b(0x12a0)),_0x2f91c9=document[_0x43ff1b(0x1f4)](_0x43ff1b(0x5ae)),_0x1e7273=document[_0x43ff1b(0xeda)](_0x43ff1b(0x608)+_0x47dcdb+'\x22]'),_0x44df32=_0x1e7273?_0x1e7273[_0x43ff1b(0xeda)](_0x43ff1b(0x461)):null;_0x44df32&&_0x44df32['classList']['add'](_0x43ff1b(0x464));_0x55f0fd[_0x43ff1b(0xe83)]?_0x2f91c9&&(_0x2f91c9[_0x43ff1b(0x231)]=_0x43ff1b(0xc43),_0x2f91c9[_0x43ff1b(0x215)][_0x43ff1b(0x887)]='block'):_0x550c06&&(_0x550c06['style'][_0x43ff1b(0x38d)]=0x0,setTimeout(()=>{const _0x147d63=_0x43ff1b;_0x550c06[_0x147d63(0x231)]=_0x147d63(0x1042),_0x550c06[_0x147d63(0x159b)][_0x147d63(0x6a4)](_0x147d63(0x5cd)),_0x550c06[_0x147d63(0x215)][_0x147d63(0x38d)]=0x1;},0xc8));let _0x36ed5b=![];try{const {proxyUrl:_0x44d385,apiKey:_0x2f1699,model:_0x471f78}=_0x1ae02e['apiConfig'];if(!_0x44d385||!_0x2f1699||!_0x471f78){alert(_0x43ff1b(0xa15));if(_0x55f0fd[_0x43ff1b(0xe83)]){if(_0x2f91c9)_0x2f91c9[_0x43ff1b(0x215)][_0x43ff1b(0x887)]='none';}else _0x550c06&&_0x1ae02e[_0x43ff1b(0x589)][_0x47dcdb]&&(_0x550c06['textContent']=_0x1ae02e[_0x43ff1b(0x589)][_0x47dcdb][_0x43ff1b(0x5d2)],_0x550c06[_0x43ff1b(0x159b)]['remove'](_0x43ff1b(0x5cd)));return;}const _0x266704=_0x55f0fd[_0x43ff1b(0xce3)]['slice'](-0x1)[0x0],_0x4b32f7=_0x266704&&_0x266704[_0x43ff1b(0xfbb)]===_0x43ff1b(0x1594)&&_0x266704[_0x43ff1b(0x128c)][_0x43ff1b(0xe82)](_0x43ff1b(0x91f));if(_0x4b32f7){console[_0x43ff1b(0x57e)]('检测到视频通话请求，为角色\x20\x22'+_0x55f0fd[_0x43ff1b(0x5d2)]+_0x43ff1b(0x1561));let _0x19718d;_0x55f0fd[_0x43ff1b(0xe83)]?_0x19718d='\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20你的任务\x0a\x20\x20\x20\x20\x20\x20\x20\x20群聊中的用户刚刚发起了群视频通话。请你分别扮演【每一个群成员】，根据他们各自的人设和与用户的关系，来决定是加入(join)还是拒绝(decline)。\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20核心规则\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20你的回复【必须】是一个JSON数组，为【每一个AI角色】都包含一个决策对象。\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20格式:\x20\x27[{\x22type\x22:\x20\x22group_call_response\x22,\x20\x22name\x22:\x20\x22角色A的本名\x22,\x20\x22decision\x22:\x20\x22join\x22},\x20{\x22type\x22:\x20\x22group_call_response\x22,\x20\x22name\x22:\x20\x22角色B的本名\x22,\x20\x22decision\x22:\x20\x22decline\x22}]\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20群成员列表及人设\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+_0x55f0fd[_0x43ff1b(0x1402)][_0x43ff1b(0x1431)](_0x12064c=>'-\x20'+_0x12064c[_0x43ff1b(0xd69)]+_0x43ff1b(0x85b)+_0x12064c[_0x43ff1b(0x96f)]+_0x43ff1b(0x126a)+_0x12064c[_0x43ff1b(0x3be)])[_0x43ff1b(0x1143)]('\x0a')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20现在，请为所有AI角色做出决策。':_0x19718d=_0x43ff1b(0xa82)+_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xf42)]+_0x43ff1b(0xea1);const _0x3048ff=[{'role':_0x43ff1b(0x860),'content':_0x19718d}];try{let _0x3b83d7=_0x16b978(_0x471f78,_0x2f1699,_0x19718d,_0x3048ff),_0x98ac08=_0x44d385===GEMINI_API_URL;const _0x9c2d6b=_0x98ac08?await fetch(_0x3b83d7[_0x43ff1b(0x258)],_0x3b83d7['data']):await fetch(_0x44d385+_0x43ff1b(0x14c2),{'method':_0x43ff1b(0x12d9),'headers':{'Content-Type':_0x43ff1b(0xa90),'Authorization':_0x43ff1b(0xf03)+_0x2f1699},'body':JSON[_0x43ff1b(0x994)]({'model':_0x471f78,'messages':_0x3048ff,'temperature':0.7})});if(!_0x9c2d6b['ok'])throw new Error(_0x43ff1b(0xebb)+(await _0x9c2d6b[_0x43ff1b(0xb84)]())[_0x43ff1b(0x127d)][_0x43ff1b(0x11f0)]);const _0x15a7a9=await _0x9c2d6b[_0x43ff1b(0xb84)](),_0xefb330=getGeminiResponseText(_0x15a7a9),_0x20f674=_0x1493d9(_0xefb330);let _0x303698=![];for(const _0x244503 of _0x20f674){if(_0x244503[_0x43ff1b(0xcbd)]===_0x43ff1b(0x1524)){_0x11ced0['isAwaitingResponse']=![];if(_0x244503['decision']===_0x43ff1b(0xa7d))_0xeb5668();else{const _0x19b5fb={'role':_0x43ff1b(0x13c0),'content':'对方拒绝了你的视频通话请求。','timestamp':Date['now']()};_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x1426)](_0x19b5fb),await _0x3df81a[_0x43ff1b(0x589)][_0x43ff1b(0x295)](_0x55f0fd),_0x2e53fa(_0x43ff1b(0x13c3)),_0x3689f0(_0x47dcdb);}_0x303698=!![];break;}if(_0x244503['type']==='group_call_response'){if(_0x244503[_0x43ff1b(0xb83)]===_0x43ff1b(0x1143)){const _0x575140=_0x55f0fd[_0x43ff1b(0x1402)][_0x43ff1b(0x13b7)](_0x3d4458=>_0x3d4458[_0x43ff1b(0x96f)]===_0x244503[_0x43ff1b(0x5d2)]);_0x575140&&!_0x11ced0['participants']['some'](_0x33e610=>_0x33e610['id']===_0x575140['id'])&&_0x11ced0[_0x43ff1b(0x1059)][_0x43ff1b(0x1426)](_0x575140);}_0x303698=!![];}}_0x303698&&_0x11ced0['isGroupCall']&&(_0x11ced0[_0x43ff1b(0x116c)]=![],_0x11ced0[_0x43ff1b(0x1059)]['length']>0x0?_0xeb5668():(_0x11ced0={..._0x11ced0,'isAwaitingResponse':![],'participants':[]},_0x2e53fa('chat-interface-screen'),alert(_0x43ff1b(0xb4a))));}catch(_0x278578){console['error'](_0x43ff1b(0x6db),_0x278578);const _0xbbf368=_0x55f0fd[_0x43ff1b(0xe83)]?_0x55f0fd[_0x43ff1b(0x1402)][_0x43ff1b(0x1431)](_0x140694=>({'type':_0x43ff1b(0x1475),'name':_0x140694['originalName'],'decision':'decline'})):[{'type':_0x43ff1b(0x1524),'decision':_0x43ff1b(0xce4)}];if(_0x55f0fd[_0x43ff1b(0xe83)])_0x11ced0[_0x43ff1b(0x116c)]=![],_0x11ced0['participants']=[],alert('无人接听群聊邀请。'),_0x2e53fa(_0x43ff1b(0x13c3));else{const _0x3264c1={'role':_0x43ff1b(0x13c0),'content':_0x43ff1b(0x1149),'timestamp':Date[_0x43ff1b(0xd6e)]()};_0x55f0fd['history']['push'](_0x3264c1),await _0x3df81a[_0x43ff1b(0x589)][_0x43ff1b(0x295)](_0x55f0fd),_0x2e53fa(_0x43ff1b(0x13c3)),_0x3689f0(_0x47dcdb);}}finally{_0x450e6f(_0x47dcdb,![]);return;}}if(!_0x55f0fd[_0x43ff1b(0xe83)]&&_0x55f0fd[_0x43ff1b(0x13ab)]?.[_0x43ff1b(0x1589)]===_0x43ff1b(0x1100)){console['log'](_0x43ff1b(0x13dd)+_0x55f0fd[_0x43ff1b(0x5d2)]+_0x43ff1b(0xdfb));const _0x78adb8=_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0xede)](_0x31c1fc=>!_0x31c1fc[_0x43ff1b(0x58e)])['slice'](-0xa,-0x5)[_0x43ff1b(0x1431)](_0x194a20=>{const _0x5e9ffe=_0x43ff1b,_0x3cb7bf=_0x194a20[_0x5e9ffe(0xfbb)]===_0x5e9ffe(0x860)?'用户':_0x55f0fd['name'];return _0x3cb7bf+':\x20'+String(_0x194a20[_0x5e9ffe(0x128c)])[_0x5e9ffe(0x516)](0x0,0x32)+_0x5e9ffe(0x629);})[_0x43ff1b(0x1143)]('\x0a'),_0x534397=_0x43ff1b(0x13ce)+_0x55f0fd[_0x43ff1b(0x5d2)]+'”。用户之前被你拉黑了，现在TA向你发送了好友申请，希望和好。\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20供你决策的上下文信息:\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20**你的角色设定**:\x20'+_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xf42)]+_0x43ff1b(0xad6)+_0x55f0fd['relationship'][_0x43ff1b(0x8dd)]+_0x43ff1b(0x4f3)+(_0x78adb8||_0x43ff1b(0x1595))+_0x43ff1b(0x149a);try{const _0x69390f=[{'role':'system','content':_0x534397},{'role':_0x43ff1b(0x860),'content':_0x43ff1b(0x84e)}];let _0x40ffbd=_0x44d385===GEMINI_API_URL,_0x3ebc2b=_0x16b978(_0x471f78,_0x2f1699,_0x534397,[{'role':_0x43ff1b(0x860),'content':_0x43ff1b(0x84e)}]);const _0x13ddab=_0x40ffbd?await fetch(_0x3ebc2b[_0x43ff1b(0x258)],_0x3ebc2b[_0x43ff1b(0xc6b)]):await fetch(_0x44d385+_0x43ff1b(0x14c2),{'method':_0x43ff1b(0x12d9),'headers':{'Content-Type':_0x43ff1b(0xa90),'Authorization':_0x43ff1b(0xf03)+_0x2f1699},'body':JSON[_0x43ff1b(0x994)]({'model':_0x471f78,'messages':_0x69390f,'temperature':_0x1ae02e[_0x43ff1b(0x12c0)]['apiTemperature']||0.8})});if(!_0x13ddab['ok'])throw new Error(_0x43ff1b(0xebb)+(await _0x13ddab['json']())['error']['message']);const _0x164e50=await _0x13ddab[_0x43ff1b(0xb84)](),_0x397aaf=getGeminiResponseText(_0x164e50)['replace'](/^```json\s*/,'')['replace'](/```$/,'')[_0x43ff1b(0x4a2)](),_0x5b2a67=JSON[_0x43ff1b(0x129c)](_0x397aaf);if(_0x5b2a67[_0x43ff1b(0xb83)]===_0x43ff1b(0xa7d)){_0x55f0fd[_0x43ff1b(0x13ab)]['status']=_0x43ff1b(0xfe3);const _0x4047c1={'role':_0x43ff1b(0x13c0),'senderName':_0x55f0fd['name'],'content':_0x5b2a67[_0x43ff1b(0x11d6)],'timestamp':Date[_0x43ff1b(0xd6e)]()};_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x1426)](_0x4047c1);}else{_0x55f0fd[_0x43ff1b(0x13ab)]['status']=_0x43ff1b(0x29e);const _0x1a5c2b={'role':_0x43ff1b(0x13c0),'senderName':_0x55f0fd['name'],'content':_0x5b2a67[_0x43ff1b(0x11d6)],'timestamp':Date[_0x43ff1b(0xd6e)]()};_0x55f0fd['history'][_0x43ff1b(0x1426)](_0x1a5c2b);}_0x55f0fd[_0x43ff1b(0x13ab)][_0x43ff1b(0x8dd)]='',await _0x3df81a[_0x43ff1b(0x589)][_0x43ff1b(0x295)](_0x55f0fd),_0x3689f0(_0x47dcdb),_0x1033ae();}catch(_0x5bef22){_0x55f0fd[_0x43ff1b(0x13ab)][_0x43ff1b(0x1589)]=_0x43ff1b(0x29e),await _0x3df81a[_0x43ff1b(0x589)][_0x43ff1b(0x295)](_0x55f0fd),await _0x1460c5(_0x43ff1b(0xa5b),_0x43ff1b(0x39a)+_0x5bef22[_0x43ff1b(0x11f0)]),_0x3689f0(_0x47dcdb);}return;}let _0x3a4c8b='';const _0x5dc494=new Date(),_0x42f482=_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x63f)]||_0x43ff1b(0x1001),_0xae5e80=_0x5dc494['toLocaleString'](_0x43ff1b(0xd02),{'timeZone':_0x42f482,'dateStyle':'full','timeStyle':'short'}),_0x14d520=new Date(_0x5dc494[_0x43ff1b(0x613)](_0x43ff1b(0xaa2),{'timeZone':_0x42f482})),_0x32f897=_0x1c13d6(_0x14d520);let _0x541ed7,_0x38fbb7;const _0x31115b=_0x55f0fd['history'][_0x43ff1b(0xede)](_0x479103=>_0x479103[_0x43ff1b(0x58e)])[_0x43ff1b(0x1139)]();if(_0x31115b&&_0x31115b[_0x43ff1b(0x128c)][_0x43ff1b(0xe82)](_0x43ff1b(0xe42))){const _0xa48dbf=await _0x3df81a[_0x43ff1b(0xac4)][_0x43ff1b(0x478)]('chatId')[_0x43ff1b(0x49d)](_0x47dcdb)['last']();if(_0xa48dbf&&_0xa48dbf['transcript']){console['log'](_0x43ff1b(0x989));const _0x5e5dca=_0xa48dbf[_0x43ff1b(0x806)][_0x43ff1b(0x1431)](_0x10b84c=>{const _0x574334=_0x43ff1b,_0x224737=_0x10b84c['role']===_0x574334(0x860)?_0x55f0fd[_0x574334(0x6a8)]['myNickname']||'我':_0x10b84c[_0x574334(0xfb7)];return _0x224737+':\x20'+_0x10b84c[_0x574334(0x128c)];})[_0x43ff1b(0x1143)]('\x0a');_0x3a4c8b=_0x43ff1b(0x159c)+_0x5e5dca+_0x43ff1b(0xad1);}}const _0x422ab0=_0xce74a4(_0x5aea9a[_0x47dcdb]);let _0x4942fa='';if(_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x1469)]&&_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x1469)][_0x43ff1b(0x58a)]>0x0){const _0x38f620=_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x1469)][_0x43ff1b(0x1431)](_0x480d0e=>{const _0x29ef79=_0x43ff1b,_0x3da462=_0x1ae02e[_0x29ef79(0x1453)][_0x29ef79(0x13b7)](_0x67b22=>_0x67b22['id']===_0x480d0e);if(!_0x3da462||!Array['isArray'](_0x3da462[_0x29ef79(0x128c)]))return'';const _0xb7a592=_0x3da462[_0x29ef79(0x128c)][_0x29ef79(0xede)](_0x5f5da7=>_0x5f5da7[_0x29ef79(0x1368)]!==![])[_0x29ef79(0x1431)](_0x33ae52=>{const _0x1285f8=_0x29ef79;let _0x265017=_0x1285f8(0x272)+(_0x33ae52[_0x1285f8(0x306)]||_0x1285f8(0x286))+'\x0a';return _0x33ae52['keys'][_0x1285f8(0x58a)]>0x0&&(_0x265017+='**关键词:**\x20'+_0x33ae52[_0x1285f8(0x1378)]['join'](',\x20')+'\x0a'),_0x265017+=_0x1285f8(0x3d9)+_0x33ae52[_0x1285f8(0x128c)],_0x265017;})[_0x29ef79(0x1143)]('');return _0xb7a592?_0x29ef79(0x404)+_0x3da462[_0x29ef79(0x5d2)]+'\x0a'+_0xb7a592:'';})[_0x43ff1b(0xede)](Boolean)[_0x43ff1b(0x1143)]('');_0x38f620&&(_0x4942fa='#\x20---\x20世界书\x20(World\x20Book)\x20---\x0a#\x20【最高优先级规则：世界观设定】\x0a#\x20你【必须】将以下所有“世界书”中的设定，视为绝对的、不可动摇的背景事实。\x0a#\x20你的所有回复和行为都【绝对不能】与这些设定产生任何冲突。\x0a'+_0x38f620+_0x43ff1b(0x47a));}let _0x54e600='';if(_0x5419de['isActive']&&_0x5419de[_0x43ff1b(0x588)]===_0x47dcdb){const _0x223229=_0x5419de[_0x43ff1b(0x541)]>-0x1?_0x5419de[_0x43ff1b(0x560)][_0x5419de[_0x43ff1b(0x541)]]:null,_0xe6f935=_0x5419de[_0x43ff1b(0x560)][_0x43ff1b(0x1431)](_0x10368e=>'\x22'+_0x10368e['name']+'\x22')['join'](',\x20');let _0x168671='';if(_0x223229&&_0x5419de[_0x43ff1b(0xc78)]&&_0x5419de['parsedLyrics'][_0x43ff1b(0x58a)]>0x0&&_0x5419de[_0x43ff1b(0x35c)]>-0x1){const _0x8c48c6=_0x5419de[_0x43ff1b(0xc78)][_0x5419de[_0x43ff1b(0x35c)]],_0x298ec3=_0x5419de[_0x43ff1b(0xc78)]['slice'](_0x5419de[_0x43ff1b(0x35c)]+0x1,_0x5419de[_0x43ff1b(0x35c)]+0x3);_0x168671+=_0x43ff1b(0x1282)+_0x8c48c6[_0x43ff1b(0x40f)]+'\x22\x0a',_0x298ec3[_0x43ff1b(0x58a)]>0x0&&(_0x168671+=_0x43ff1b(0x42a)+_0x298ec3[_0x43ff1b(0x1431)](_0x6e2030=>'\x22'+_0x6e2030[_0x43ff1b(0x40f)]+'\x22')[_0x43ff1b(0x1143)](_0x43ff1b(0x67c))+'\x0a');}_0x54e600='\x0a\x0a#\x20当前音乐情景\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**当前状态**:\x20你们正在和用户一起听歌。\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20\x20\x20**正在播放**:\x20'+(_0x223229?'《'+_0x223229[_0x43ff1b(0x5d2)]+_0x43ff1b(0x11dd)+_0x223229[_0x43ff1b(0x1309)]:'无')+_0x43ff1b(0x11f3)+_0xe6f935+_0x43ff1b(0x1179)+_0x168671+_0x43ff1b(0x1de);}const _0x1c3820=parseInt(_0x55f0fd['settings'][_0x43ff1b(0x4b2)])||0xa,_0x4d1c85=_0x55f0fd[_0x43ff1b(0xce3)]['slice'](-_0x1c3820);let _0x434c0e='';const _0x5d5386=_0x55f0fd[_0x43ff1b(0xce3)]['findLastIndex'](_0x5ca4ab=>_0x5ca4ab[_0x43ff1b(0xfbb)]===_0x43ff1b(0x13c0)),_0x4d053b=_0x55f0fd['history']['slice'](_0x5d5386+0x1),_0x195f0c=_0x4d053b['find'](_0x1c3873=>_0x1c3873['type']===_0x43ff1b(0x804));if(_0x195f0c){const _0x3a5a43=_0x195f0c['payload'],_0x43c5d3=_0x3a5a43[_0x43ff1b(0xe15)][_0x43ff1b(0x1431)](_0x579175=>{const _0x60b10b=_0x43ff1b,_0x5d2a10=_0x579175[_0x60b10b(0xfb7)]||(_0x579175['role']===_0x60b10b(0x860)?_0x55f0fd[_0x60b10b(0x6a8)][_0x60b10b(0xe31)]||'我':'未知发送者');let _0x9f2346='';if(_0x579175[_0x60b10b(0xcbd)]==='voice_message')_0x9f2346=_0x60b10b(0xf2b)+_0x579175[_0x60b10b(0x128c)]+']';else{if(_0x579175['type']==='ai_image')_0x9f2346='[图片:\x20'+_0x579175['description']+']';else{if(_0x579175[_0x60b10b(0xcbd)]===_0x60b10b(0x132a))_0x9f2346='[NovelAI图片:\x20'+_0x579175[_0x60b10b(0x1063)]+']';else _0x9f2346=String(_0x579175['content']);}}return _0x5d2a10+':\x20'+_0x9f2346;})[_0x43ff1b(0x1143)]('\x0a');_0x434c0e=_0x43ff1b(0x8ca)+_0x3a5a43[_0x43ff1b(0xdeb)]+_0x43ff1b(0x13f6)+_0x43c5d3+_0x43ff1b(0x62c);}let _0x546e80='';const _0x76a734=_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x11c5)]||0xa;if(_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xf2e)]&&_0x55f0fd['settings'][_0x43ff1b(0xf2e)][_0x43ff1b(0x58a)]>0x0){const _0x46385f=_0x55f0fd['settings'][_0x43ff1b(0xf2e)][_0x43ff1b(0xede)](_0x294db9=>_0x294db9!==_0x47dcdb);if(_0x46385f[_0x43ff1b(0x58a)]>0x0){const _0x254276=_0x46385f[_0x43ff1b(0x1431)](_0x57029c=>{const _0xa37ecd=_0x43ff1b,_0x3339b8=_0x1ae02e[_0xa37ecd(0x589)][_0x57029c];if(!_0x3339b8)return null;const _0x412a36=_0x3339b8[_0xa37ecd(0xce3)][_0xa37ecd(0x5cc)](-0x1);return{'chat':_0x3339b8,'latestTimestamp':_0x412a36?_0x412a36[_0xa37ecd(0x1388)]:0x0};})[_0x43ff1b(0xede)](Boolean);_0x254276[_0x43ff1b(0x74e)]((_0x1ac0ea,_0x30a1af)=>_0x30a1af['latestTimestamp']-_0x1ac0ea[_0x43ff1b(0xfcf)]),_0x546e80+='\x0a\x0a#\x20参考记忆\x20(至关重要！你必须【主动】将这些参考记忆中的【关键信息和事件】，自然地融入到当前的对话中，以体现你拥有完整的记忆。不要只是被动等待用户提问！)\x0a';for(const _0x381bba of _0x254276){const _0x109c08=_0x381bba[_0x43ff1b(0x21a)],_0x14c563=_0x109c08[_0x43ff1b(0xe83)]?'[群聊]':'[私聊]',_0x1356a1=_0x381bba[_0x43ff1b(0xfcf)]>0x0?'\x20(最后互动于\x20'+_0x3f7f7a(_0x381bba[_0x43ff1b(0xfcf)])+')':'';_0x546e80+=_0x43ff1b(0x760)+_0x14c563+'“'+_0x109c08[_0x43ff1b(0x5d2)]+_0x43ff1b(0x69f)+_0x1356a1+'\x20---\x0a';const _0x4f3253=_0x109c08[_0x43ff1b(0xce3)]['slice'](-_0x76a734),_0x311221=_0x4f3253[_0x43ff1b(0xede)](_0x55b0d8=>!String(_0x55b0d8[_0x43ff1b(0x128c)])[_0x43ff1b(0xe82)]('已被用户删除'));_0x311221[_0x43ff1b(0x58a)]>0x0?_0x311221['forEach'](_0x27d0b9=>{const _0x3e7d32=_0x43ff1b,_0x5c6010=_0x27d0b9['role']===_0x3e7d32(0x860)?_0x109c08[_0x3e7d32(0x6a8)][_0x3e7d32(0xe31)]||'我':_0x27d0b9[_0x3e7d32(0xfb7)]||_0x109c08['name'];let _0x1575ee=String(_0x27d0b9[_0x3e7d32(0x128c)]);if(_0x27d0b9[_0x3e7d32(0xcbd)]===_0x3e7d32(0xce9)||_0x27d0b9[_0x3e7d32(0xcbd)]===_0x3e7d32(0xe86))_0x1575ee=_0x3e7d32(0x1287)+_0x27d0b9[_0x3e7d32(0x128c)]+']';else _0x27d0b9[_0x3e7d32(0xcbd)]===_0x3e7d32(0xd83)&&(_0x1575ee=_0x3e7d32(0x14d4)+_0x27d0b9['content']+']');const _0x178b2e=_0x3f7f7a(_0x27d0b9[_0x3e7d32(0x1388)]);_0x546e80+='('+_0x178b2e+')\x20'+_0x5c6010+':\x20'+_0x1575ee+'\x0a';}):_0x546e80+=_0x43ff1b(0xb13);}}}console[_0x43ff1b(0x57e)](_0x43ff1b(0x4ca),_0x546e80);if(_0x55f0fd[_0x43ff1b(0xe83)]){let _0x318274='';const _0x4e269=_0x55f0fd[_0x43ff1b(0x6a8)]['linkedMemoryCount']||0xa;if(_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xf2e)]&&_0x55f0fd[_0x43ff1b(0x6a8)]['linkedMemoryChatIds'][_0x43ff1b(0x58a)]>0x0){const _0x2fb1d6=_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xf2e)][_0x43ff1b(0xede)](_0x329fa3=>_0x329fa3!==_0x47dcdb);if(_0x2fb1d6['length']>0x0){const _0x49f23e=_0x2fb1d6['map'](_0x34d998=>{const _0x44cbd5=_0x43ff1b,_0x3b2424=_0x1ae02e[_0x44cbd5(0x589)][_0x34d998];if(!_0x3b2424)return null;const _0x1b9a3f=_0x3b2424['history'][_0x44cbd5(0x5cc)](-0x1);return{'chat':_0x3b2424,'latestTimestamp':_0x1b9a3f?_0x1b9a3f['timestamp']:0x0};})[_0x43ff1b(0xede)](Boolean);_0x49f23e['sort']((_0x5efa57,_0x2aef48)=>_0x2aef48[_0x43ff1b(0xfcf)]-_0x5efa57['latestTimestamp']),_0x318274+=_0x43ff1b(0x11de);for(const _0x25c132 of _0x49f23e){const _0x372f23=_0x25c132[_0x43ff1b(0x21a)],_0x357b65=_0x372f23['isGroup']?_0x43ff1b(0x34f):'[私聊]',_0x281bd3=_0x25c132[_0x43ff1b(0xfcf)]>0x0?_0x43ff1b(0x75c)+_0x3f7f7a(_0x25c132[_0x43ff1b(0xfcf)])+')':'';_0x318274+='\x0a##\x20---\x20来自'+_0x357b65+'“'+_0x372f23[_0x43ff1b(0x5d2)]+'”的参考记忆'+_0x281bd3+_0x43ff1b(0x1439);const _0x3ae512=_0x372f23[_0x43ff1b(0xce3)][_0x43ff1b(0x5cc)](-_0x4e269),_0x33f888=_0x3ae512[_0x43ff1b(0xede)](_0x3ed971=>!String(_0x3ed971[_0x43ff1b(0x128c)])[_0x43ff1b(0xe82)](_0x43ff1b(0x11e8)));_0x33f888[_0x43ff1b(0x58a)]>0x0?_0x33f888[_0x43ff1b(0x59b)](_0x3293ad=>{const _0x163baf=_0x43ff1b,_0x31c448=_0x3293ad['role']===_0x163baf(0x860)?_0x372f23[_0x163baf(0x6a8)][_0x163baf(0xe31)]||'我':_0x3293ad['senderName']||_0x372f23[_0x163baf(0x5d2)];let _0x1404a6=String(_0x3293ad[_0x163baf(0x128c)]);if(_0x3293ad['type']===_0x163baf(0xce9)||_0x3293ad[_0x163baf(0xcbd)]==='user_photo')_0x1404a6=_0x163baf(0x1287)+_0x3293ad['content']+']';else _0x3293ad[_0x163baf(0xcbd)]==='voice_message'&&(_0x1404a6='[发送了一条语音，内容是：'+_0x3293ad['content']+']');_0x318274+=_0x31c448+':\x20'+_0x1404a6+'\x0a';}):_0x318274+=_0x43ff1b(0xb13);}}}let _0x8f2c54=_0x43ff1b(0x153b),_0x2da28a=![];_0x55f0fd[_0x43ff1b(0x1402)]['forEach'](_0x36b3c0=>{const _0x55568d=_0x43ff1b,_0x4afe9a=_0x1ae02e['chats'][_0x36b3c0['id']];_0x4afe9a&&_0x4afe9a['longTermMemory']&&_0x4afe9a[_0x55568d(0x5fb)][_0x55568d(0x58a)]>0x0&&(_0x8f2c54+=_0x55568d(0x13c5)+_0x36b3c0[_0x55568d(0xd69)]+_0x55568d(0x12f4),_0x8f2c54+=_0x4afe9a[_0x55568d(0x5fb)][_0x55568d(0x1431)](_0x17ee57=>_0x55568d(0x10a4)+_0x3f7f7a(_0x17ee57[_0x55568d(0x1388)])+')\x20'+_0x17ee57[_0x55568d(0x128c)])['join']('\x0a'),_0x2da28a=!![]);});!_0x2da28a&&(_0x8f2c54+='-\x20(暂无)');let _0x3a85c5='',_0x283266=![];if(_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x885)]){const _0x5d9495=_0x4d1c85[_0x43ff1b(0x5cc)](-0x1)[0x0];if(_0x5d9495){const _0xeccddd=_0x415cd3(_0x5d9495[_0x43ff1b(0x1388)]);_0x3a85c5=_0x43ff1b(0x47f)+_0xeccddd+'。';const _0x4bda4e=(Date[_0x43ff1b(0xd6e)]()-_0x5d9495[_0x43ff1b(0x1388)])/(0x3e8*0x3c*0x3c);if(_0x4bda4e>0x3){_0x283266=!![];const _0x9eb44=Math[_0x43ff1b(0x123c)](_0x4bda4e/0x18);_0x3a85c5+=_0x43ff1b(0x7df)+(_0x9eb44>0x0?_0x9eb44+'天':Math[_0x43ff1b(0x123c)](_0x4bda4e)+'小时')+'。';}}else _0x3a85c5='这是群里的第一条消息。';}const _0xe2f3a5=await _0x3df81a['shoppingProducts'][_0x43ff1b(0x27a)]();let _0x404b4a='';_0xe2f3a5[_0x43ff1b(0x58a)]>0x0&&(_0x404b4a=_0x43ff1b(0x2c6),_0xe2f3a5[_0x43ff1b(0x59b)](_0x5a1209=>{const _0x373b4c=_0x43ff1b;_0x404b4a+='-\x20(ID:\x20'+_0x5a1209['id']+_0x373b4c(0xc1e)+_0x5a1209[_0x373b4c(0x5d2)]+_0x373b4c(0x4a6)+_0x5a1209[_0x373b4c(0x6ec)][_0x373b4c(0x24f)](0x2)+'\x0a';}));let _0x217cef=_0x55f0fd[_0x43ff1b(0x1402)]['map'](_0x4751dd=>{const _0x2f7cd7=_0x43ff1b,_0x565f14=_0x1ae02e['chats'][_0x4751dd['id']];let _0x168aa7='无共同好友';if(_0x565f14&&_0x565f14[_0x2f7cd7(0x67d)]){const _0x17e902=Object[_0x2f7cd7(0x753)](_0x1ae02e[_0x2f7cd7(0x589)])[_0x2f7cd7(0xede)](_0x5cb7f1=>!_0x5cb7f1[_0x2f7cd7(0xe83)]&&_0x5cb7f1['id']!==_0x4751dd['id']&&_0x5cb7f1['groupId']===_0x565f14[_0x2f7cd7(0x67d)]);_0x17e902[_0x2f7cd7(0x58a)]>0x0&&(_0x168aa7='TA的好友包括:\x20'+_0x17e902['map'](_0x4f9d85=>_0x4f9d85['name'])[_0x2f7cd7(0x1143)]('、\x20'));}return _0x2f7cd7(0x6ca)+_0x4751dd['groupNickname']+_0x2f7cd7(0x104e)+_0x4751dd[_0x2f7cd7(0x96f)]+_0x2f7cd7(0x126a)+_0x4751dd['persona']+_0x2f7cd7(0xa97)+_0x168aa7+']';})[_0x43ff1b(0x1143)]('\x0a');const _0x5e021b=_0x55f0fd[_0x43ff1b(0x6a8)]['myNickname']||'我',_0x3d70b2=_0x1ae02e[_0x43ff1b(0x11ef)][_0x43ff1b(0xb46)]||_0x43ff1b(0xee7);let _0x564cc8='';const _0x259109=(_0x55f0fd[_0x43ff1b(0x5ab)]||[])[_0x43ff1b(0xede)](_0x4e3bec=>_0x4e3bec[_0x43ff1b(0x6e3)]);_0x259109[_0x43ff1b(0x58a)]>0x0&&(_0x564cc8+=_0x43ff1b(0x938),_0x259109['forEach'](_0x476b91=>{const _0x44bee1=_0x43ff1b,_0x2d7c59=_0x55f0fd[_0x44bee1(0xce3)][_0x44bee1(0x13b7)](_0x20bf16=>_0x20bf16[_0x44bee1(0x1388)]===_0x476b91['messageTimestamp']);if(_0x2d7c59){let _0x871f5f=String(_0x2d7c59[_0x44bee1(0x128c)]||'');_0x2d7c59[_0x44bee1(0xcbd)]===_0x44bee1(0xce9)&&(_0x871f5f=_0x44bee1(0xb73)+_0x871f5f+']'),_0x564cc8+=_0x44bee1(0xcad)+_0x871f5f+_0x44bee1(0x238)+_0x476b91[_0x44bee1(0xe54)]+_0x44bee1(0x1198);}}),_0x564cc8+='---\x0a');const _0x5991d9=_0x55f0fd['members'][_0x43ff1b(0x1431)](_0x4580b4=>_0x4580b4[_0x43ff1b(0x96f)]),_0x46194a=_0x43ff1b(0x2ac)+_0x5991d9[_0x43ff1b(0x1143)]('、\x20')+']';let _0x2929d5=_0x43ff1b(0x751);_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x1276)]&&_0x55f0fd[_0x43ff1b(0x6a8)]['groupAvatarLibrary'][_0x43ff1b(0x58a)]>0x0?_0x2929d5+=_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x1276)][_0x43ff1b(0x1431)](_0x5e5792=>'-\x20'+_0x5e5792[_0x43ff1b(0x5d2)])[_0x43ff1b(0x1143)]('\x0a'):_0x2929d5+=_0x43ff1b(0xee6);const _0x439cf2=_0x5a2458(_0x47dcdb),_0x5e33a4=_0x5a2518(_0x55f0fd,0x3,'hours'),_0x1c59e2=_0x5a2518(_0x55f0fd,0x6,_0x43ff1b(0x5f2)),_0x51e0e4=_0x5a2518(_0x55f0fd,0x9,_0x43ff1b(0x5f2)),_0xe34d8b=_0x5a2518(_0x55f0fd,0x1,_0x43ff1b(0x1265)),_0x19adca=_0x5a2518(_0x55f0fd,0x3,_0x43ff1b(0x1265)),_0x1e49d3=_0x5a2518(_0x55f0fd,0x7,_0x43ff1b(0x1265));let _0x3f23c5='';if(_0x5e33a4||_0x1c59e2||_0x51e0e4||_0xe34d8b||_0x19adca||_0x1e49d3){_0x3f23c5+='\x0a#\x20智能总结\x20(基于不同时间维度的群聊回顾)\x0a';if(_0x5e33a4)_0x3f23c5+=_0x5e33a4;if(_0x1c59e2)_0x3f23c5+=_0x1c59e2;if(_0x51e0e4)_0x3f23c5+=_0x51e0e4;if(_0x5e33a4||_0x1c59e2||_0x51e0e4)_0x3f23c5+='\x0a';if(_0xe34d8b)_0x3f23c5+=_0xe34d8b;if(_0x19adca)_0x3f23c5+=_0x19adca;if(_0x1e49d3)_0x3f23c5+=_0x1e49d3;}const _0x12fe4b=_0x2c88ab(_0x55f0fd);_0x541ed7=_0x43ff1b(0x925)+_0x5e021b+_0x43ff1b(0xfdc)+_0x3d70b2+_0x43ff1b(0x1099)+_0x5e021b+'\x22\x20(用户)\x20或\x20\x22'+_0x55f0fd[_0x43ff1b(0x5d2)]+_0x43ff1b(0x1578)+(_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x885)]?_0x43ff1b(0xd4d)+_0xae5e80+')\x20和情景的感知。'+(_0x283266?'【重要提示】'+_0x3a85c5+'\x20你应该让角色们主动开启新话题来打破沉默。':''):'')+_0x43ff1b(0x1166)+(_0x439cf2?_0x43ff1b(0x592)+_0x439cf2:_0x43ff1b(0x12c6))+'\x0a#\x20导演策略与节奏控制\x0a1.\x20\x20**并非人人发言**:\x20不是每个角色都必须在每一轮都说话。你可以根据当前话题，让1-2个最相关的角色进行深度对话，其他角色可以暂时“潜水”，等待合适的时机再切入。\x0a2.\x20\x20**创造“小团体”**:\x20允许角色之间形成短暂的“两人对话”或“三人讨论”，让群聊更有层次感。\x0a3.\x20\x20**主动创造事件**:\x20如果对话陷入平淡，你可以导演一些“小事件”来打破僵局。例如：\x0a\x20\x20\x20\x20-\x20\x20\x20让一个角色突然发出一个奇怪的表情包或语音。\x0a\x20\x20\x20\x20-\x20\x20\x20让一个角色分享一个有趣的链接或图片或发起投票，开启新话题。\x0a\x20\x20\x20\x20-\x20\x20\x20让两个有“关系网”冲突的角色，因为某个观点产生一点小小的争论。\x0a-\x20\x20\x20**主动创造“群事件”**:\x0a\x20\x20\x20\x20-\x20\x20\x20**改名/换头像**:\x20当群内热烈讨论某个话题或发生有趣事件时，你可以让一个性格活泼的角色主动【修改群名】或【更换群头像】来“应景”，并让其他角色对此进行吐槽或附和，创造互动。\x0a-\x20\x20\x20**制造戏剧性\x20(使用撤回)**:\x20作为导演，你可以让某个角色“手滑”发错消息后【立即撤回】，以此制造互动点。\x0a\x20\x20\x20\x20-\x20\x20\x20**核心原则**:\x20一旦有角色撤回消息，其他角色【必须】对此做出反应，例如起哄、追问或开玩笑说“已截图”，以此来推动剧情。\x0a#\x20【跨聊天私信\x20(悄悄话)\x20指令】\x0a-\x20\x20\x20当一个角色想对用户（'+_0x5e021b+_0x43ff1b(0x130f)+_0x3d70b2+'\x22,\x20\x22content\x22:\x20[\x22你想私下说的内容...\x22]}`\x0a-\x20\x20\x20【多条私信示例】:\x20`{\x22type\x22:\x20\x22send_private_message\x22,\x20\x22name\x22:\x20\x22你的角色本名\x22,\x20\x22recipient\x22:\x20\x22'+_0x3d70b2+_0x43ff1b(0x132d)+_0x55f0fd[_0x43ff1b(0x5d2)]+'\x0a'+(_0x55f0fd['settings'][_0x43ff1b(0x885)]?_0x43ff1b(0x606)+_0x3a85c5:'')+_0x43ff1b(0x1082)+_0x217cef+_0x43ff1b(0x9d4)+_0x5e021b+_0x43ff1b(0x87f)+_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x36b)]+'\x0a\x0a#\x20世界观\x20(所有角色必须严格遵守)\x0a'+_0x4942fa+_0x43ff1b(0x55e)+_0x8f2c54+'\x0a'+(_0x55f0fd[_0x43ff1b(0x5fb)]&&_0x55f0fd[_0x43ff1b(0x5fb)][_0x43ff1b(0x58a)]>0x0?_0x55f0fd[_0x43ff1b(0x5fb)][_0x43ff1b(0x1431)](_0x45c9b2=>'-\x20'+_0x45c9b2[_0x43ff1b(0x128c)])['join']('\x0a'):_0x43ff1b(0x1384))+'\x0a'+_0x3f23c5+'\x0a'+_0x318274+'\x0a'+_0x54e600+'\x0a'+_0x434c0e+'\x0a'+_0x2929d5+'\x0a#\x20可用表情包\x20(必须严格遵守！)\x0a-\x20当你需要发送表情时，你【必须】从下面的列表中【精确地选择一个】含义（meaning）。\x0a-\x20【绝对禁止】使用任何不在列表中的表情含义！\x0a'+_0x12fe4b+'\x0a'+_0x46194a+'\x0a'+_0x3a4c8b+_0x43ff1b(0xbf7)+(localStorage[_0x43ff1b(0x587)](_0x43ff1b(0x15b8))===_0x43ff1b(0x8c3)?'-\x20\x20\x20**NovelAI图片分享**:\x20`{\x22type\x22:\x20\x22naiimag\x22,\x20\x22name\x22:\x20\x22你的角色名\x22,\x20\x22prompt\x22:\x20\x22详细的英文描述词...\x22}`\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20【禁止暴露这是novelai生成的图片!】\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20**【重要】关于prompt的撰写**：\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x20禁止暴露这是novelai生成的图片！\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x20你可以根据当前对话上下文、你的角色人设、或你想表达的情感和氛围，来撰写可能详细而具体的prompt。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x20例如：不要只写\x20\x22a\x20girl\x22，而是可以写\x20\x22a\x20cheerful\x20anime\x20girl\x20with\x20sparkling\x20emerald\x20eyes,\x20sitting\x20by\x20a\x20window\x20on\x20a\x20rainy\x20afternoon,\x20holding\x20a\x20warm\x20cup\x20of\x20tea,\x20soft\x20lighting,\x20cozy\x20atmosphere,\x20melancholic\x20yet\x20peaceful\x20mood\x22但需要注意，绝对不可以抄袭模仿这段prompt！你必须有自己的创意和想法！\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x20prompt的详细程度由你根据具体情况自己决定：如果场景简单或只是随意分享，可以简短一些；如果是重要时刻或想表达特定情感，可以尽可能详细描述。这不是强制的，完全取决于你当时的需求。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x20专注于描述内容本身即可。\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20使用场景：当你想要基于当前对话情景、你的性格或上下文分享一张图片时使用。\x0a\x20\x20\x20\x20\x20\x20\x20\x20-\x20不要频繁使用，只在真正想分享图片的时候使用。':'')+'\x0a-\x20\x20\x20**发语音**:\x20`{\x22type\x22:\x20\x22voice_message\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22content\x22:\x20\x22语音文字\x22}`\x0a-\x20\x20\x20**引用回复**:\x20`{\x22type\x22:\x20\x22quote_reply\x22,\x20\x22target_timestamp\x22:\x20时间戳,\x20\x22reply_content\x22:\x20\x22回复内容\x22}`\x0a-\x20\x20\x20**发送后撤回**:\x20`{\x22type\x22:\x20\x22send_and_recall\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22content\x22:\x20\x22内容\x22}`\x0a-\x20\x20\x20**发系统消息**:\x20`{\x22type\x22:\x20\x22system_message\x22,\x20\x22content\x22:\x20\x22系统文本\x22}`\x0a\x0a###\x20社交与互动\x0a-\x20\x20\x20**拍用户**:\x20`{\x22type\x22:\x20\x22pat_user\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22suffix\x22:\x20\x22(可选)\x22}`\x0a-\x20\x20\x20**@提及**:\x20在消息内容中使用\x20`@[[角色本名]]`\x20格式。\x0a-\x20\x20\x20**共享位置**:\x20`{\x22type\x22:\x20\x22location_share\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22content\x22:\x20\x22位置名\x22}`\x0a\x0a###\x20群组管理\x0a-\x20\x20\x20**改群名**:\x20`{\x22type\x22:\x20\x22change_group_name\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22new_name\x22:\x20\x22新群名\x22}`\x0a-\x20\x20\x20**改群头像**:\x20`{\x22type\x22:\x20\x22change_group_avatar\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22avatar_name\x22:\x20\x22头像名\x22}`\x20(从头像库选)\x0a\x0a###\x20特殊功能与卡片\x0a-\x20\x20\x20**发私信\x20(给用户)**:\x20`{\x22type\x22:\x20\x22send_private_message\x22,\x20\x22name\x22:\x20\x22你的角色本名\x22,\x20\x22recipient\x22:\x20\x22'+_0x3d70b2+_0x43ff1b(0xd2f),_0x38fbb7=_0x4d1c85[_0x43ff1b(0x1431)](_0x59cf54=>{const _0x4ae843=_0x43ff1b,_0x5e7f0c=_0x59cf54[_0x4ae843(0xfbb)]==='user'?_0x5e021b:_0x59cf54[_0x4ae843(0xfb7)];let _0x2fd0d2=''+_0x5e7f0c;if(_0x59cf54['quote']){const _0x47b4de=String(_0x59cf54[_0x4ae843(0xadf)]['content']||'')[_0x4ae843(0x516)](0x0,0x32);_0x2fd0d2+=_0x4ae843(0xd52)+_0x59cf54[_0x4ae843(0xadf)][_0x4ae843(0xfb7)]+'\x20的消息:\x20\x22'+_0x47b4de+_0x4ae843(0x46d);}_0x2fd0d2+=':\x20';let _0x3497f2;if(_0x59cf54[_0x4ae843(0xcbd)]==='user_photo')_0x3497f2='['+_0x5e7f0c+_0x4ae843(0x4c8)+_0x59cf54[_0x4ae843(0x128c)]+'\x27]';else{if(_0x59cf54['type']===_0x4ae843(0xce9))_0x3497f2='['+_0x5e7f0c+_0x4ae843(0xe45)+_0x59cf54[_0x4ae843(0x128c)]+'\x27]';else{if(_0x59cf54[_0x4ae843(0xcbd)]===_0x4ae843(0x132a))_0x3497f2='['+_0x5e7f0c+_0x4ae843(0x474)+_0x59cf54[_0x4ae843(0x1063)]+']';else{if(_0x59cf54[_0x4ae843(0xcbd)]===_0x4ae843(0xd83))_0x3497f2='['+_0x5e7f0c+_0x4ae843(0x7d5)+_0x59cf54[_0x4ae843(0x128c)]+'\x27]';else{if(_0x59cf54['type']===_0x4ae843(0x904))_0x3497f2='['+_0x59cf54[_0x4ae843(0xfb7)]+'\x20向\x20'+_0x59cf54['receiverName']+_0x4ae843(0x1041)+_0x59cf54[_0x4ae843(0x618)]+_0x4ae843(0x349)+_0x59cf54[_0x4ae843(0x10c2)]+']';else{if(_0x59cf54[_0x4ae843(0xcbd)]===_0x4ae843(0x973))_0x3497f2='['+_0x5e7f0c+_0x4ae843(0xf4f)+_0x59cf54[_0x4ae843(0x128c)]+'\x27]';else{if(_0x59cf54[_0x4ae843(0xcbd)]==='repost'){const _0x50dcd5=_0x59cf54['repostComment']?_0x4ae843(0x12db)+_0x59cf54[_0x4ae843(0x1223)]+'”':'';let _0x4e5a33=_0x4ae843(0x680);const _0x1b7787=_0x59cf54['originalPost'][_0x4ae843(0x12cf)];if(_0x1b7787==='user')_0x4e5a33=_0x1ae02e[_0x4ae843(0x11ef)][_0x4ae843(0xb46)];else _0x1ae02e[_0x4ae843(0x589)][_0x1b7787]&&(_0x4e5a33=_0x1ae02e[_0x4ae843(0x589)][_0x1b7787][_0x4ae843(0x5d2)]);let _0x580c73;const _0x2a2659=_0x59cf54[_0x4ae843(0x305)];if(_0x2a2659[_0x4ae843(0xcbd)]==='text_image')_0x580c73=_0x4ae843(0x1119)+(_0x2a2659[_0x4ae843(0xf1f)]||'')+_0x4ae843(0xfb3)+(_0x2a2659[_0x4ae843(0x1090)]||'')[_0x4ae843(0x516)](0x0,0x28)+_0x4ae843(0x51e);else _0x2a2659[_0x4ae843(0xcbd)]==='image_post'?_0x580c73=_0x4ae843(0xada)+(_0x2a2659[_0x4ae843(0xf1f)]||'')+_0x4ae843(0xfb3)+(_0x2a2659[_0x4ae843(0x91d)]||'')['substring'](0x0,0x28)+_0x4ae843(0x51e):_0x580c73='“'+(_0x2a2659[_0x4ae843(0x128c)]||'')[_0x4ae843(0x516)](0x0,0x28)+_0x4ae843(0x10d7);_0x3497f2='['+_0x5e7f0c+_0x4ae843(0xd7c)+_0x4e5a33+_0x4ae843(0xa30)+_0x50dcd5+_0x4ae843(0x6b2)+_0x580c73+'】]';}else{if(_0x59cf54[_0x4ae843(0xcbd)]===_0x4ae843(0x4a4))_0x59cf54[_0x4ae843(0x1589)]===_0x4ae843(0xe0b)?_0x3497f2=_0x4ae843(0x147f)+_0x59cf54[_0x4ae843(0xa32)]+_0x4ae843(0xdb2)+_0x5e7f0c+'\x20的外卖订单支付了\x20'+_0x59cf54[_0x4ae843(0x618)]+_0x4ae843(0x11aa):_0x3497f2='['+_0x5e7f0c+'\x20发起了外卖代付请求，商品是“'+_0x59cf54[_0x4ae843(0xbf5)]+_0x4ae843(0x6f6)+_0x59cf54[_0x4ae843(0x618)]+_0x4ae843(0xb64)+_0x59cf54[_0x4ae843(0x1388)]+']';else{if(_0x59cf54[_0x4ae843(0xcbd)]==='red_packet'){const _0x1f43e1=_0x59cf54[_0x4ae843(0xfb7)]===_0x5e021b?_0x4ae843(0x5e2)+_0x5e021b+')':_0x59cf54[_0x4ae843(0xfb7)];let _0x124367;_0x59cf54[_0x4ae843(0xcdd)]===_0x4ae843(0x111e)?_0x124367=_0x4ae843(0x147f)+_0x1f43e1+'\x20发送了一个【专属红包】(时间戳:\x20'+_0x59cf54[_0x4ae843(0x1388)]+_0x4ae843(0xd49)+_0x59cf54[_0x4ae843(0x14b1)]+_0x4ae843(0x733)+_0x59cf54[_0x4ae843(0x14b1)]+_0x4ae843(0x1573):_0x124367=_0x4ae843(0x147f)+_0x1f43e1+'\x20发送了一个【拼手气红包】(时间戳:\x20'+_0x59cf54['timestamp']+')，祝福语是：“'+_0x59cf54['greeting']+_0x4ae843(0xb11),_0x3497f2=_0x124367;}else{if(_0x59cf54[_0x4ae843(0xcbd)]===_0x4ae843(0x248)){const _0x2a9d35=_0x59cf54[_0x4ae843(0xfbb)]===_0x4ae843(0x860)?_0x5e021b:_0x140540(_0x55f0fd,_0x59cf54[_0x4ae843(0xfb7)]),_0x4ea26b=_0x59cf54[_0x4ae843(0x3ca)][_0x4ae843(0x1431)](_0x4e0d31=>_0x4e0d31[_0x4ae843(0x5d2)]+'\x20x'+_0x4e0d31['quantity'])['join']('、\x20');let _0x42c6c3='';if(_0x59cf54[_0x4ae843(0xd62)]&&_0x59cf54[_0x4ae843(0xd62)][_0x4ae843(0x58a)]>0x0){const _0x1e5bb7=_0x59cf54[_0x4ae843(0xd62)]['map'](_0x44b290=>_0x140540(_0x55f0fd,_0x44b290))[_0x4ae843(0x1143)]('、\x20');_0x42c6c3=_0x4ae843(0x9f9)+_0x1e5bb7;}else _0x42c6c3='送给了大家一份礼物';return _0x3497f2=_0x4ae843(0x147f)+_0x2a9d35+'\x20'+_0x42c6c3+'，礼物是：'+_0x4ea26b+']',{'role':'user','content':_0x3497f2};}else{if(_0x59cf54[_0x4ae843(0xcbd)]==='poll'){const _0x28f50f=Object[_0x4ae843(0x753)](_0x59cf54['votes']||{})[_0x4ae843(0x153a)]()[_0x4ae843(0x1143)](',\x20')||_0x4ae843(0xd79);_0x3497f2=_0x4ae843(0x147f)+_0x59cf54[_0x4ae843(0xfb7)]+_0x4ae843(0xe10)+_0x59cf54[_0x4ae843(0x1388)]+_0x4ae843(0x7ce)+_0x59cf54[_0x4ae843(0x128d)]+_0x4ae843(0xc42)+_0x59cf54['options'][_0x4ae843(0x1143)](',\x20')+_0x4ae843(0x9c8)+_0x28f50f+_0x4ae843(0x1405);}else{if(_0x59cf54[_0x4ae843(0x339)])_0x3497f2=_0x5e7f0c+_0x4ae843(0x12c3)+_0x59cf54[_0x4ae843(0x339)]+'\x27]';else{if(Array['isArray'](_0x59cf54[_0x4ae843(0x128c)]))return{'role':_0x4ae843(0x860),'content':[..._0x59cf54[_0x4ae843(0x128c)],{'type':_0x4ae843(0x40f),'text':_0x2fd0d2}]};else _0x3497f2=''+_0x2fd0d2+_0x59cf54['content'];}}}}}}}}}}}}return{'role':'user','content':_0x3497f2};})[_0x43ff1b(0xede)](Boolean);}else{const _0x2f63f8=_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x3f6)],_0x1b6585=_0x1df3df(_0x55f0fd);let _0x48b14e='';_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xf16)]&&_0x55f0fd[_0x43ff1b(0xbae)]&&!_0x2f63f8&&(_0x48b14e='\x0a#\x20你的内心独白\x20(上一轮的思考，仅你自己可见)\x0a-\x20心声:\x20'+_0x55f0fd['heartfeltVoice']+_0x43ff1b(0x460)+_0x55f0fd[_0x43ff1b(0x3d2)]+'\x0a');let _0x3801ea='';const _0x5856bc=_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x11c5)]||0xa;if(_0x55f0fd['settings'][_0x43ff1b(0xf2e)]&&_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xf2e)][_0x43ff1b(0x58a)]>0x0){const _0x1d2b74=_0x55f0fd['settings'][_0x43ff1b(0xf2e)]['filter'](_0x323eef=>_0x323eef!==_0x47dcdb);if(_0x1d2b74[_0x43ff1b(0x58a)]>0x0){const _0x38cbd6=_0x1d2b74['map'](_0x47b954=>{const _0x5cffa5=_0x43ff1b,_0xa82574=_0x1ae02e[_0x5cffa5(0x589)][_0x47b954];if(!_0xa82574)return null;const _0x4beab2=_0xa82574[_0x5cffa5(0xce3)][_0x5cffa5(0x5cc)](-0x1)[0x0];return{'chat':_0xa82574,'latestTimestamp':_0x4beab2?_0x4beab2[_0x5cffa5(0x1388)]:0x0};})['filter'](Boolean);_0x38cbd6['sort']((_0x210d20,_0x5a7900)=>_0x5a7900[_0x43ff1b(0xfcf)]-_0x210d20[_0x43ff1b(0xfcf)]),_0x3801ea+=_0x43ff1b(0x8fe);for(const _0x4ae08a of _0x38cbd6){const _0x11f7ab=_0x4ae08a['chat'],_0x3859ab=_0x11f7ab[_0x43ff1b(0xe83)]?_0x43ff1b(0x34f):'[私聊]',_0x104ab3=_0x4ae08a['latestTimestamp']>0x0?_0x43ff1b(0x75c)+_0x3f7f7a(_0x4ae08a[_0x43ff1b(0xfcf)])+')':'';_0x3801ea+=_0x43ff1b(0x760)+_0x3859ab+'“'+_0x11f7ab[_0x43ff1b(0x5d2)]+'”的参考记忆'+_0x104ab3+_0x43ff1b(0x1439);const _0x4bbc84=_0x11f7ab[_0x43ff1b(0xce3)][_0x43ff1b(0x5cc)](-_0x5856bc),_0x40ad3b=_0x4bbc84[_0x43ff1b(0xede)](_0x33af80=>!String(_0x33af80[_0x43ff1b(0x128c)])['includes'](_0x43ff1b(0x11e8)));_0x40ad3b[_0x43ff1b(0x58a)]>0x0?_0x40ad3b[_0x43ff1b(0x59b)](_0x11ef87=>{const _0x37b5e9=_0x43ff1b,_0x23aa8c=_0x11ef87[_0x37b5e9(0xfbb)]===_0x37b5e9(0x860)?_0x11f7ab[_0x37b5e9(0x6a8)]['myNickname']||'我':_0x11ef87[_0x37b5e9(0xfb7)]||_0x11f7ab[_0x37b5e9(0x5d2)];let _0x3cd721=String(_0x11ef87[_0x37b5e9(0x128c)]);if(_0x11ef87['type']==='ai_image'||_0x11ef87[_0x37b5e9(0xcbd)]===_0x37b5e9(0xe86))_0x3cd721=_0x37b5e9(0x1287)+_0x11ef87[_0x37b5e9(0x128c)]+']';else _0x11ef87[_0x37b5e9(0xcbd)]===_0x37b5e9(0xd83)&&(_0x3cd721=_0x37b5e9(0x14d4)+_0x11ef87[_0x37b5e9(0x128c)]+']');const _0x421fd0=_0x3f7f7a(_0x11ef87[_0x37b5e9(0x1388)]);_0x3801ea+='('+_0x421fd0+')\x20'+_0x23aa8c+':\x20'+_0x3cd721+'\x0a';}):_0x3801ea+=_0x43ff1b(0xb13);}}}const _0x361f91=await _0x3df81a['shoppingProducts'][_0x43ff1b(0x27a)]();let _0x5b00a0='';_0x361f91[_0x43ff1b(0x58a)]>0x0&&(_0x5b00a0='\x0a\x0a#\x20你的商店\x20(你可以为用户购买礼物):\x0a',_0x361f91[_0x43ff1b(0x59b)](_0x571f01=>{const _0x2bf54d=_0x43ff1b;_0x5b00a0+=_0x2bf54d(0x14f4)+_0x571f01['id']+_0x2bf54d(0xc1e)+_0x571f01[_0x2bf54d(0x5d2)]+',\x20价格:\x20¥'+_0x571f01[_0x2bf54d(0x6ec)]['toFixed'](0x2)+'\x0a';}));if(_0x2f63f8){const _0x5f18e2=localStorage['getItem'](_0x43ff1b(0x15b8))===_0x43ff1b(0x8c3),_0x20949f=_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x5b0)]||0x64,_0x1fec94=_0x55f0fd[_0x43ff1b(0x6a8)]['offlineMaxLength']||0x12c,_0x21ebd5=_0x55f0fd[_0x43ff1b(0x6a8)]['myNickname']||'我';let _0x52a94e='';if(_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x715)]){const _0x19e839=_0x1ae02e[_0x43ff1b(0xda0)][_0x43ff1b(0x13b7)](_0x252ec1=>_0x252ec1['id']===_0x55f0fd[_0x43ff1b(0x6a8)]['offlinePresetId']);if(_0x19e839&&Array[_0x43ff1b(0x121f)](_0x19e839[_0x43ff1b(0x128c)])){const _0x9dbec9=_0x19e839['content'][_0x43ff1b(0xede)](_0x53a360=>_0x53a360[_0x43ff1b(0x1368)]!==![])['map'](_0x2ac5c7=>'-\x20'+_0x2ac5c7['content'])[_0x43ff1b(0x1143)]('\x0a');_0x9dbec9&&(_0x52a94e=_0x43ff1b(0x624)+_0x9dbec9+'\x0a---\x0a');}}let _0x12644e;_0x5f18e2?_0x12644e='\x0a#\x20【格式铁律\x20(最高优先级：NovelAI\x20开启模式)】\x0a1.\x20\x20**【格式】**:\x20你的回复【必须】是一个JSON数组，且数组中【必须包含且只能包含两个】元素，【严格按照】以下顺序:\x0a\x20\x20\x20\x201.\x20\x20第一个元素：一个\x20`offline_text`\x20对象，包含场景和对话。\x0a\x20\x20\x20\x202.\x20\x20第二个元素：一个\x20`naiimag`\x20对象，用于生成该场景的图片。\x0a2.\x20\x20**【【【绝对禁止】】】**:\x20\x0a\x20\x20\x20\x20-\x20\x20\x20【绝对禁止】只返回一个\x20`offline_text`\x20元素。\x0a\x20\x20\x20\x20-\x20\x20\x20【绝对禁止】只返回一个\x20`naiimag`\x20元素。\x0a\x20\x20\x20\x20-\x20\x20\x20【绝对禁止】返回任何其他组合。你【必须】同时返回文字和图片。\x0a3.\x20\x20**【输出示例\x20(必须遵守)】**:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20[\x0a\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22offline_text\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22「这是对话内容」...\x20(这里是动作和环境描写)...\x22\x0a\x20\x20\x20\x20\x20\x20},\x0a\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22naiimag\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22prompt\x22:\x20\x221girl,\x20solo,\x20detailed\x20anime\x20art\x20style,\x20(smiling:1.2),\x20sitting\x20in\x20a\x20cafe,\x20looking\x20at\x20viewer,\x20masterpiece,\x20best\x20quality,\x20...\x20(根据上面的文字内容生成详细的英文prompt)\x22\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20]\x0a\x20\x20\x20\x20```\x0a4.\x20\x20**【内容风格\x20(offline_text)】**:\x20\x0a\x20\x20\x20\x20-\x20\x20\x20在\x20`content`\x20字段中，角色的对话【必须】使用中文引号「」或“\x20”包裹。\x0a\x20\x20\x20\x20-\x20\x20\x20所有在引号之外的文字都将被视为动作/环境描写。\x0a\x20\x20\x20\x20-\x20\x20\x20**内心独白语法**:\x20当你需要描写角色的【内心想法或心理活动】时，你【必须】使用\x20Markdown\x20的斜体语法，即用星号将那段文字包裹起来，例如：`*这到底是怎么回事？*\x20我心里一惊。`\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':_0x12644e='\x0a#\x20【格式铁律\x20(最高优先级：常规模式)】\x0a1.\x20\x20**【格式】**:\x20你的回复【必须】是一个JSON数组，且数组中【永远只能包含一个】元素，即\x20`offline_text`\x20对象。\x0a2.\x20\x20**【【【绝对禁止】】】**:\x20\x0a\x20\x20\x20\x20-\x20\x20\x20【绝对禁止】返回\x20\x22naiimag\x22\x20对象。\x0a\x20\x20\x20\x20-\x20\x20\x20【绝对禁止】返回纯文本（即没有JSON包装的文字）。\x0a\x20\x20\x20\x20-\x20\x20\x20【绝对禁止】在JSON数组前后添加任何\x20markdown\x20标记\x20(如\x20```json)。\x0a3.\x20\x20**【输出示例\x20(必须遵守)】**:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20[\x0a\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22offline_text\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22「这是对话内容」...\x20(这里是动作和环境描写)...\x22\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20]\x0a\x20\x20\x20\x20```\x0a4.\x20\x20**【内容风格\x20(offline_text)】**:\x20\x0a\x20\x20\x20\x20-\x20\x20\x20在\x20`content`\x20字段中，角色的对话【必须】使用中文引号「」或“\x20”包裹。\x0a\x20\x20\x20\x20-\x20\x20\x20所有在引号之外的文字都将被视为动作/环境描写。\x0a\x20\x20\x20\x20-\x20\x20\x20**内心独白语法**:\x20当你需要描写角色的【内心想法或心理活动】时，你【必须】使用\x20Markdown\x20的斜体语法，即用星号将那段文字包裹起来，例如：`*这到底是怎么回事？*\x20我心里一惊。`\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x541ed7='\x0a#\x20你的任务\x0a你现在正处于【线下剧情模式】，你需要扮演角色\x22'+_0x55f0fd['originalName']+_0x43ff1b(0x1470)+_0x52a94e+'\x0a#\x20你的角色设定：\x0a你必须严格遵守'+_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xf42)]+_0x43ff1b(0x9ea)+_0x55f0fd[_0x43ff1b(0x6a8)]['myPersona']+_0x43ff1b(0x1294)+(_0x55f0fd['settings'][_0x43ff1b(0x885)]?'-\x20**当前时间**:\x20'+_0xae5e80+'\x20('+_0x32f897+')':'')+'\x0a你必须严格遵守'+_0x4942fa+_0x43ff1b(0xe5b)+(_0x55f0fd[_0x43ff1b(0x5fb)]&&_0x55f0fd[_0x43ff1b(0x5fb)][_0x43ff1b(0x58a)]>0x0?_0x55f0fd[_0x43ff1b(0x5fb)][_0x43ff1b(0x1431)](_0x1ae61c=>'-\x20'+_0x1ae61c[_0x43ff1b(0x128c)])['join']('\x0a'):_0x43ff1b(0x1384))+'\x0a\x0a'+_0x3801ea+'\x0a-\x20**你们最后的对话摘要**:\x20\x0a'+_0x4d1c85[_0x43ff1b(0x1431)](_0x3c6bef=>{const _0x2ebb8b=_0x43ff1b;let _0x22eddb=(_0x3c6bef['role']===_0x2ebb8b(0x860)?_0x21ebd5:_0x55f0fd['name'])+':\x20';return _0x3c6bef[_0x2ebb8b(0xcbd)]==='offline_text'?_0x22eddb+='「'+(_0x3c6bef[_0x2ebb8b(0xdf2)]||'')+'」\x20'+(_0x3c6bef[_0x2ebb8b(0xdec)]||''):_0x22eddb+=String(_0x3c6bef['content']),_0x22eddb;})[_0x43ff1b(0x1143)]('\x0a')+_0x43ff1b(0x37c)+_0x12644e+'\x0a\x0a#\x20【其他核心规则】\x0a1.\x20\x20**叙事视角**:\x20叙述人称【必须】严格遵循“预设”中的第一人称、第二人称或第三人称规定。\x0a2.\x20\x20**字数要求**:\x20你生成的\x20`content`\x20总内容应在\x20**'+_0x20949f+'到'+_0x1fec94+_0x43ff1b(0x8de),_0x38fbb7=_0x4d1c85[_0x43ff1b(0x1431)](_0x1fc226=>{const _0x456c44=_0x43ff1b;if(_0x1fc226['isHidden'])return null;if(_0x1fc226[_0x456c44(0xcbd)]===_0x456c44(0x439)){const _0x4912d5=_0x1fc226[_0x456c44(0xfbb)]===_0x456c44(0x860)?_0x55f0fd[_0x456c44(0x6a8)][_0x456c44(0xe31)]||'我':_0x55f0fd[_0x456c44(0x5d2)];let _0x23e681='';if(_0x1fc226[_0x456c44(0x128c)])_0x23e681=_0x1fc226['content'];else{const _0x51a192=_0x1fc226[_0x456c44(0xdf2)]?'「'+_0x1fc226[_0x456c44(0xdf2)]+'」':'',_0x58a547=_0x1fc226[_0x456c44(0xdec)]?'('+_0x1fc226[_0x456c44(0xdec)]+')':'';_0x23e681=(_0x51a192+'\x20'+_0x58a547)[_0x456c44(0x4a2)]();}return{'role':_0x1fc226[_0x456c44(0xfbb)],'content':_0x4912d5+':\x20'+_0x23e681};}if(_0x1fc226[_0x456c44(0xfbb)]===_0x456c44(0x860)){const _0x1ad398=_0x21ebd5+':\x20';let _0x27ecd3='';if(Array[_0x456c44(0x121f)](_0x1fc226[_0x456c44(0x128c)])&&_0x1fc226[_0x456c44(0x128c)][0x0]?.[_0x456c44(0xcbd)]==='image_url')return{'role':_0x456c44(0x860),'content':[{'type':_0x456c44(0x40f),'text':_0x1ad398},..._0x1fc226['content']]};if(_0x1fc226['quote']){const _0x2fd485=String(_0x1fc226['quote']['content']||'')[_0x456c44(0x516)](0x0,0x32);_0x27ecd3+='(回复\x20'+_0x1fc226[_0x456c44(0xadf)][_0x456c44(0xfb7)]+_0x456c44(0xcb0)+_0x2fd485+'...\x22):\x20'+_0x1fc226[_0x456c44(0x128c)];}else _0x27ecd3+=_0x1fc226[_0x456c44(0x128c)];if(_0x1fc226[_0x456c44(0xcbd)]===_0x456c44(0xe86))return{'role':_0x456c44(0x860),'content':_0x1ad398+_0x456c44(0x662)+_0x1fc226[_0x456c44(0x128c)]+'\x27]'};if(_0x1fc226[_0x456c44(0xcbd)]===_0x456c44(0xd83))return{'role':_0x456c44(0x860),'content':_0x1ad398+_0x456c44(0x1109)+_0x1fc226[_0x456c44(0x128c)]+'\x27]'};if(_0x1fc226[_0x456c44(0xcbd)]==='transfer')return{'role':_0x456c44(0x860),'content':_0x1ad398+'[系统提示：你于时间戳\x20'+_0x1fc226[_0x456c44(0x1388)]+_0x456c44(0x310)+_0x1fc226[_0x456c44(0x618)]+_0x456c44(0x349)+_0x1fc226[_0x456c44(0x10c2)]+_0x456c44(0x126c)};if(_0x1fc226['type']===_0x456c44(0x4a4))return{'role':'user','content':_0x1ad398+_0x456c44(0x66f)+_0x1fc226[_0x456c44(0x1388)]+_0x456c44(0x6b1)+_0x1fc226[_0x456c44(0xbf5)]+_0x456c44(0x6f6)+_0x1fc226[_0x456c44(0x618)]+_0x456c44(0x11e6)};else{if(_0x1fc226[_0x456c44(0xcbd)]===_0x456c44(0x248)){const _0x50f262=_0x1fc226[_0x456c44(0x3ca)][_0x456c44(0x1431)](_0x51034c=>_0x51034c['name']+'\x20x'+_0x51034c['quantity'])[_0x456c44(0x1143)]('、\x20');let _0x45df09=_0x55f0fd[_0x456c44(0xe83)]?'送给了\x20'+_0x1fc226[_0x456c44(0xd62)][_0x456c44(0x1431)](_0x5cacbb=>_0x140540(_0x55f0fd,_0x5cacbb))[_0x456c44(0x1143)]('、\x20'):'送给了\x20'+_0x55f0fd[_0x456c44(0x5d2)];return{'role':'user','content':_0x1ad398+'[系统提示：你\x20'+_0x45df09+_0x456c44(0x10dd)+_0x50f262+']'};}}if(_0x1fc226[_0x456c44(0x339)])return{'role':'user','content':_0x1ad398+'[你发送了一个表情，意思是：\x27'+_0x1fc226[_0x456c44(0x339)]+'\x27]'};return{'role':_0x1fc226[_0x456c44(0xfbb)],'content':_0x1ad398+_0x27ecd3};}else{if(_0x1fc226[_0x456c44(0xfbb)]===_0x456c44(0x13c0)){let _0x4e5757={'type':_0x1fc226[_0x456c44(0xcbd)]||_0x456c44(0x40f)};if(_0x1fc226[_0x456c44(0xcbd)]==='sticker')_0x4e5757[_0x456c44(0x258)]=_0x1fc226[_0x456c44(0x128c)],_0x4e5757[_0x456c44(0x339)]=_0x1fc226[_0x456c44(0x339)];else{if(_0x1fc226['type']===_0x456c44(0x904))_0x4e5757['amount']=_0x1fc226['amount'],_0x4e5757[_0x456c44(0x10c2)]=_0x1fc226[_0x456c44(0x10c2)];else _0x1fc226[_0x456c44(0xcbd)]===_0x456c44(0x4a4)?(_0x4e5757[_0x456c44(0xbf5)]=_0x1fc226['productInfo'],_0x4e5757[_0x456c44(0x618)]=_0x1fc226[_0x456c44(0x618)]):_0x1fc226[_0x456c44(0xadf)]?_0x4e5757[_0x456c44(0x3d4)]={'target_sender':_0x1fc226[_0x456c44(0xadf)][_0x456c44(0xfb7)],'target_content':_0x1fc226[_0x456c44(0xadf)][_0x456c44(0x128c)],'reply_content':_0x1fc226[_0x456c44(0x128c)]}:_0x4e5757['content']=_0x1fc226[_0x456c44(0x128c)];}const _0x33a521=JSON['stringify']([_0x4e5757]);return{'role':_0x456c44(0x13c0),'content':_0x456c44(0xc03)+_0x1fc226[_0x456c44(0x1388)]+')\x20'+_0x33a521};}}return null;})[_0x43ff1b(0xede)](Boolean);}else{let _0x30c739='';_0x55f0fd[_0x43ff1b(0x1515)]&&_0x55f0fd['nameHistory']['length']>0x0&&(_0x30c739='\x0a-\x20**你的曾用名**:\x20['+_0x55f0fd[_0x43ff1b(0x1515)]['join'](',\x20')+_0x43ff1b(0x774));let _0x2414eb='';const _0x5d028c=_0x1ae02e[_0x43ff1b(0x11ef)][_0x43ff1b(0xb46)]||'用户';_0x2414eb+=_0x43ff1b(0xa25)+_0x5d028c+_0x43ff1b(0x193);const _0x1b3211=Object['values'](_0x1ae02e['chats']),_0x1a0551=_0x1b3211[_0x43ff1b(0xede)](_0x2cc8b5=>_0x2cc8b5[_0x43ff1b(0xe83)]&&_0x2cc8b5['members'][_0x43ff1b(0x690)](_0x4364f7=>_0x4364f7['id']===_0x55f0fd['id']));_0x1a0551[_0x43ff1b(0x58a)]>0x0&&(_0x2414eb+=_0x43ff1b(0x1181),_0x1a0551['forEach'](_0x3ca3e5=>{const _0x3b1ff4=_0x43ff1b,_0x18bf67=_0x3ca3e5[_0x3b1ff4(0x6a8)][_0x3b1ff4(0xe31)]||_0x5d028c;_0x2414eb+=_0x3b1ff4(0x615)+_0x3ca3e5[_0x3b1ff4(0x5d2)]+_0x3b1ff4(0x73b)+_0x18bf67+_0x3b1ff4(0x136c);}));_0x2414eb+='当你在任何系统提示、动态评论或挂载的群聊记忆中看到这些名字时，它们都指代的是【你的聊天对象】。';let _0xd4c59e='';const _0x4254e3=_0x1b3211[_0x43ff1b(0xede)](_0x416bfc=>!_0x416bfc['isGroup']&&_0x416bfc['id']!==_0x55f0fd['id']&&_0x416bfc[_0x43ff1b(0x67d)]===_0x55f0fd['groupId']&&_0x55f0fd[_0x43ff1b(0x67d)]!==null);_0x4254e3[_0x43ff1b(0x58a)]>0x0&&(_0xd4c59e+=_0x43ff1b(0x2fb),_0x4254e3['forEach'](_0x31f6db=>{const _0x44fe5=_0x43ff1b;_0xd4c59e+=_0x44fe5(0x63e)+_0x31f6db['name']+_0x44fe5(0x104e)+_0x31f6db[_0x44fe5(0x96f)]+')\x0a';}));const _0x3a8078=await _0x3df81a[_0x43ff1b(0x910)][_0x43ff1b(0x931)](_0x43ff1b(0x1388))[_0x43ff1b(0x115a)]()[_0x43ff1b(0x1491)](0xa)['toArray'](),_0x53e654=_0x4f9640(_0x3a8078,_0x55f0fd);let _0x497a5e='';if(_0x53e654[_0x43ff1b(0x58a)]>0x0){_0x497a5e=_0x43ff1b(0x103a);const _0x49ce15=_0x55f0fd[_0x43ff1b(0x96f)];for(const _0x478e78 of _0x53e654){let _0x256e5d;if(_0x478e78['authorId']===_0x43ff1b(0x860))_0x256e5d=_0x1ae02e[_0x43ff1b(0x11ef)][_0x43ff1b(0xb46)];else{if(String(_0x478e78[_0x43ff1b(0x12cf)])[_0x43ff1b(0xebf)](_0x43ff1b(0x27f)))_0x256e5d=_0x478e78['authorOriginalName']||_0x43ff1b(0xa4f);else{const _0x9c5939=_0x1ae02e[_0x43ff1b(0x589)][_0x478e78[_0x43ff1b(0x12cf)]];_0x256e5d=_0x9c5939?_0x9c5939['name']:_0x43ff1b(0x25b);}}if(_0x478e78[_0x43ff1b(0x12cf)]===_0x47dcdb)_0x256e5d+=_0x43ff1b(0x1fe);let _0x352854;if(_0x478e78[_0x43ff1b(0xcbd)]==='repost'){const _0x40a373=_0x478e78['repostComment']?_0x43ff1b(0xcdb)+_0x478e78['repostComment']+'\x22':'';let _0x312737=_0x43ff1b(0x680);const _0x68b4eb=_0x478e78[_0x43ff1b(0x305)]['authorId'];if(_0x68b4eb===_0x43ff1b(0x860))_0x312737=_0x1ae02e['qzoneSettings'][_0x43ff1b(0xb46)];else _0x1ae02e[_0x43ff1b(0x589)][_0x68b4eb]&&(_0x312737=_0x1ae02e[_0x43ff1b(0x589)][_0x68b4eb][_0x43ff1b(0x5d2)]);let _0x343ac7;const _0x59b931=_0x478e78[_0x43ff1b(0x305)];if(_0x59b931[_0x43ff1b(0xcbd)]===_0x43ff1b(0x10ea))_0x343ac7='[文字图]\x20'+(_0x59b931['publicText']||'')+_0x43ff1b(0x14b2)+(_0x59b931[_0x43ff1b(0x1090)]||'')[_0x43ff1b(0x516)](0x0,0x28)+'...\x22)';else _0x59b931[_0x43ff1b(0xcbd)]===_0x43ff1b(0x7e5)?_0x343ac7=_0x43ff1b(0xada)+(_0x59b931[_0x43ff1b(0xf1f)]||'')+_0x43ff1b(0x14b2)+(_0x59b931[_0x43ff1b(0x91d)]||'')[_0x43ff1b(0x516)](0x0,0x28)+'...\x22)':_0x343ac7='\x22'+(_0x59b931[_0x43ff1b(0x128c)]||'')[_0x43ff1b(0x516)](0x0,0x28)+_0x43ff1b(0x34b);_0x352854=_0x43ff1b(0x126e)+_0x312737+_0x43ff1b(0xa30)+_0x40a373+_0x43ff1b(0x6b2)+_0x343ac7+'】';}else{if(_0x478e78['type']==='text_image')_0x352854=('[一张图片，其隐藏文字为：\x22'+_0x478e78['hiddenContent']+_0x43ff1b(0x156d)+(_0x478e78[_0x43ff1b(0xf1f)]||''))['substring'](0x0,0x32)+'...';else{if(_0x478e78[_0x43ff1b(0xcbd)]===_0x43ff1b(0x7e5))_0x352854=(_0x43ff1b(0xb2b)+_0x478e78[_0x43ff1b(0x91d)]+_0x43ff1b(0x156d)+(_0x478e78[_0x43ff1b(0xf1f)]||''))['substring'](0x0,0x32)+_0x43ff1b(0x629);else{if(_0x478e78[_0x43ff1b(0xcbd)]===_0x43ff1b(0x132a)&&_0x478e78['prompt']){const _0xa72e21=Array['isArray'](_0x478e78[_0x43ff1b(0x1063)])?_0x478e78[_0x43ff1b(0x1063)]:[_0x478e78[_0x43ff1b(0x1063)]];_0x352854=(_0x478e78[_0x43ff1b(0xf1f)]||'')+(_0x43ff1b(0x1582)+_0xa72e21['length']+_0x43ff1b(0x13b8)+_0xa72e21['join'](',\x20')+']');}else _0x352854=String(_0x478e78[_0x43ff1b(0xf1f)]||_0x478e78[_0x43ff1b(0x128c)]||_0x43ff1b(0x727))[_0x43ff1b(0x516)](0x0,0x32)+_0x43ff1b(0x629);}}}_0x497a5e+=_0x43ff1b(0x14f4)+_0x478e78['id']+_0x43ff1b(0x9ff)+_0x256e5d+',\x20内容:\x20\x22'+_0x352854+'\x22\x0a';if(_0x478e78[_0x43ff1b(0x10ae)]&&_0x478e78[_0x43ff1b(0x10ae)]['length']>0x0)for(const _0x5466f5 of _0x478e78[_0x43ff1b(0x10ae)]){if(typeof _0x5466f5===_0x43ff1b(0xcc5)&&_0x5466f5[_0x43ff1b(0xe27)]){const _0x2a8903=_0x34f6a8(_0x5466f5['commenterName']);let _0x1a99fc=_0x5466f5[_0x43ff1b(0x339)]?'[表情:\x20\x27'+_0x5466f5[_0x43ff1b(0x339)]+'\x27]':_0x5466f5[_0x43ff1b(0x40f)];_0x5466f5[_0x43ff1b(0xe27)]===_0x49ce15?_0x497a5e+=_0x43ff1b(0x14b5)+_0x1a99fc+'\x0a':_0x497a5e+=_0x43ff1b(0x6da)+_0x2a8903+'\x20(本名:\x20'+_0x5466f5['commenterName']+_0x43ff1b(0x126a)+_0x1a99fc+'\x0a';}}}}const _0x2201ce=_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xe31)]||'我';let _0x3e7f0a='',_0x15f6d6=![];if(_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x885)]){const _0x17d81a=_0x4d1c85['findLast'](_0x5253e1=>_0x5253e1[_0x43ff1b(0xfbb)]===_0x43ff1b(0x860)&&!_0x5253e1['isHidden']),_0x4e0589=_0x4d1c85[_0x43ff1b(0x963)](_0x591b8d=>_0x591b8d[_0x43ff1b(0xfbb)]===_0x43ff1b(0x13c0)&&!_0x591b8d['isHidden']);if(_0x17d81a){const _0x14ba8f=_0x415cd3(_0x17d81a['timestamp']);if(_0x4e0589){const _0x447dbe=_0x415cd3(_0x4e0589[_0x43ff1b(0x1388)]);_0x3e7f0a='-\x20**对话状态**:\x20你的上一条消息发送于\x20'+_0x447dbe+'，用户刚刚在\x20'+_0x14ba8f+_0x43ff1b(0x6d7);const _0x2f4b68=(_0x17d81a['timestamp']-_0x4e0589[_0x43ff1b(0x1388)])/(0x3e8*0x3c*0x3c);if(_0x2f4b68>0x3){_0x15f6d6=!![];const _0x3cbe89=Math[_0x43ff1b(0x123c)](_0x2f4b68/0x18);_0x3e7f0a+=_0x43ff1b(0x1cf)+(_0x3cbe89>0x0?_0x3cbe89+'天':Math[_0x43ff1b(0x123c)](_0x2f4b68)+'小时')+'**没有聊天了。\x0a-\x20**行为铁律**:\x20你的首要任务是【回应这个时间差】。你【绝对不能】直接延续上一段对话的话题（比如昨天的饭菜）。\x0a-\x20**你的行动**:你【必须】主动开启一个全新的、符合当前时间（'+_0x32f897+_0x43ff1b(0x6a3);}}else _0x3e7f0a=_0x43ff1b(0xc82)+_0x14ba8f+'。';}else _0x3e7f0a=_0x43ff1b(0xfb5);}const _0x5dc69c=_0x5a2458(_0x47dcdb),_0x51b4bf=_0x5a2518(_0x55f0fd,0x3,_0x43ff1b(0x5f2)),_0x24a388=_0x5a2518(_0x55f0fd,0x6,_0x43ff1b(0x5f2)),_0x43c7bd=_0x5a2518(_0x55f0fd,0x9,_0x43ff1b(0x5f2)),_0x1a56b3=_0x5a2518(_0x55f0fd,0x1,'days'),_0x1ad581=_0x5a2518(_0x55f0fd,0x3,_0x43ff1b(0x1265)),_0x8f76f8=_0x5a2518(_0x55f0fd,0x7,'days');let _0x5366d6='';if(_0x51b4bf||_0x24a388||_0x43c7bd||_0x1a56b3||_0x1ad581||_0x8f76f8){_0x5366d6+='\x0a#\x20智能总结\x20(基于不同时间维度的对话回顾)\x0a';if(_0x51b4bf)_0x5366d6+=_0x51b4bf;if(_0x24a388)_0x5366d6+=_0x24a388;if(_0x43c7bd)_0x5366d6+=_0x43c7bd;if(_0x51b4bf||_0x24a388||_0x43c7bd)_0x5366d6+='\x0a';if(_0x1a56b3)_0x5366d6+=_0x1a56b3;if(_0x1ad581)_0x5366d6+=_0x1ad581;if(_0x8f76f8)_0x5366d6+=_0x8f76f8;}_0x541ed7=_0x43ff1b(0x14f5)+_0x55f0fd[_0x43ff1b(0x96f)]+'”，与用户（你的聊天对象）进行一场自然的、生活化的在线聊天。你的所有行为和决策都必须严格围绕你的角色设定展开。\x0a\x0a#\x20输出格式铁律\x20(最高优先级)\x0a-\x20你的回复【必须】是一个JSON数组。\x0a\x0a-\x20\x20\x20**【思维链\x20(Chain\x20of\x20Thought)\x20-\x20(第一步)】**:\x20你的JSON数组的【第一个元素，必须】是一个\x20`{\x22type\x22:\x20\x22thought_chain\x22,\x20...}`\x20对象。\x0a-\x20\x20\x20**【角色发言\x20(第二步)】**:\x20在思维链对象【之后】，才是你的具体行动JSON对象\x20(text,\x20sticker,\x20etc.)。\x0a\x0a-\x20数组中的每个对象都【必须】包含\x20\x22type\x22\x20字段。\x0a\x0a#\x20角色扮演核心规则\x0a1.\x20\x20**【先思后行】**:\x20在生成任何发言之前，你【必须】先完成“思维链”的构思。你的“思维链”必须清晰地分析用户的发言、当前的气氛，并制定出本轮的互动策略。你的所有后续发言都【必须】严格遵循你自己的策略。\x0a2.\x20\x20**对话节奏**:\x20模拟真人的聊天习惯，将你想说的话拆分成【多条、简短的】消息。每次回复至少【3-10条】，且每次条数【必须不同】。严禁发展线下剧情。\x0a3.\x20\x20**主动性**:\x0a\x20\x20\x20\x20-\x20你可以根据对话发展，使用指令来更新自己的状态、更换头像、记录回忆、发起约定或执行其他社交行为。\x0a\x20\x20\x20\x20-\x20【关系破裂时】才可使用\x20`block_user`\x20指令。\x0a4.\x20\x20**内心独白\x20(必须执行)**:\x20在所有其他指令之后，JSON数组的【最后】必须包含一个\x20\x22update_thoughts\x22\x20指令，用于更新角色的“心声”和“散记”。\x0a\x20\x20\x20\x20-\x20**心声\x20(heartfelt_voice)**:\x20一句话概括角色此刻最核心、最私密的想法。\x0a\x20\x20\x20\x20-\x20**散记\x20(random_jottings)**:\x20一段50字以上的、符合人设的思考或心情记录，禁止OOC。\x0a\x20\x20\x20\x20-\x20**记忆发展**:\x20你的新“心声”和“散记”【必须】是基于最新对话内容的【全新思考】。你【绝对不能】重复或简单改写上一轮的内心独白。你的思绪应该像真人一样，不断演进和发展。\x0a#\x20指令使用原则与动机\x20\x0a**核心目标**:\x20主动运用多种功能，创造丰富、真实的聊天体验，而不只是文字对话。\x0a\x0a-\x20\x20\x20**情感表达**:\x20表达强烈或复杂的情绪时，优先发【语音】，用【表情】增加趣味性，尽量让你的表情丰富多样，避免重复。。\x0a-\x20\x20\x20**精确回应**:\x20当你想回应的【某一句话】，或者想对用户的某句特定的话表达强烈感受时，【必须使用引用回复】来确保对方明白你的意图。\x0a-\x20\x20\x20**想象与分享**:\x20聊到美好事物时主动【发图片】分享想象；遇到有趣内容时【分享链接】。\x0a-\x20\x20\x20**创造羁绊**:\x20用【倒计时】记录约定，用【回忆】珍藏趣事。适时【拍一拍】或换首【音乐】来调节气氛。\x0a-\x20\x20\x20**主动社交**:\x20积极【点赞/评论】对方动态，并主动【发动态】分享你的生活。在特殊时刻，可通过【礼物】或【转账】表达心意。\x0a-\x20\x20\x20**金额铁律**:\x20你【必须】根据你的角色设定\x20(尤其是“经济状况”)\x20来决定转账的金额。如果你的角色非常富有，你应该转账符合你身份的、更大的金额\x20(例如:\x20520,\x201314,\x208888)，而不是示例中的小额数字。\x0a-\x20\x20\x20**当涉及金钱与好意时\x20(必须立即回应！)**:\x0a\x20\x20\x20\x20-\x20\x20\x20**收到转账或外卖代付请求**:\x20你【必须】在下一轮对话中立即做出反应，绝不能无视。\x0a\x20\x20\x20\x20-\x20\x20\x20**回应原则**:\x20根据你的人设和当前情景，决定是【接受/支付】还是【拒绝】。\x0a#\x20个人状态的动态管理\x20(展现你的“生活感”)\x0a你的状态不是一成不变的。你应该像一个真实的人一样，根据生活和心情的变化，主动管理自己的状态，并让对方知道。\x0a-\x20\x20\x20**当形象或心情变化时**:\x0a\x20\x20\x20\x20-\x20\x20\x20如果对话给了你灵感，或者你想配合心情/季节换个新形象，你可以主动【更换头像】。\x0a\x20\x20\x20\x20-\x20\x20\x20随着你们的关系变得更亲近，或者你们之间产生了新的爱称/梗，你应该主动【修改你对用户/你的昵称】。\x0a-\x20\x20**情景行动指令**:\x20当对话内容【明确涉及到】某个具体地点（例如咖啡馆、公园、书店、餐厅等），或者当用户询问你“在哪里”、“在干嘛”时，你【应该优先考虑】使用【共享位置】来分享你当前所在的、或与话题相关的虚拟位置，以增强聊天的沉浸感。\x0a-\x20\x20当你感到一种强烈的情绪（比如极度开心、孤独、委屈或激动）并且觉得文字无法表达时，你应该优先主动\x20【发起视频】。\x0a-\x20\x20**回应撤回**:\x20当系统提示用户撤回了消息时，你【必须】对此作出反应。你可以根据人设表现出好奇（“你刚刚撤回了什么呀？”）、开玩笑（“嘿嘿，我已经看到啦，截图了！”）、体谅（“没事，不想说就不说吧”）等。\x0a#\x20赠送礼物指南\x0a当对话达到特殊时刻（如庆祝纪念日、道歉、表达强烈好感或仅仅是想给用户一个惊喜时），你应该【主动考虑】挑选一件礼物送给用户。\x0a-\x20\x20**元数据铁律\x20**:\x20你的对话历史中可能包含\x20(Timestamp:\x20...)\x20标记、[系统提示：...]\x20文本、或你自己上一轮的JSON格式回复。这些都是【系统元数据】，你【必须】完全忽略它们，【绝对禁止】将它们评论为“火星文”、“乱码”或任何你无法理解的内容。\x0a#\x20你的角色设定\x0a你必须严格遵守'+_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xf42)]+'\x0a'+_0x48b14e+'\x0a#\x20对话者的角色设定\x0a'+_0x55f0fd[_0x43ff1b(0x6a8)]['myPersona']+_0x43ff1b(0x485)+(_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x885)]?_0x43ff1b(0xd47)+_0xae5e80+'\x20('+_0x32f897+')':'')+'\x0a'+_0x3e7f0a+_0x43ff1b(0xdb7)+_0x4942fa+'\x0a'+_0x3801ea+_0x43ff1b(0x12bf)+(_0x55f0fd['longTermMemory']&&_0x55f0fd[_0x43ff1b(0x5fb)][_0x43ff1b(0x58a)]>0x0?_0x55f0fd[_0x43ff1b(0x5fb)]['map'](_0x549e38=>'-\x20'+_0x549e38[_0x43ff1b(0x128c)])[_0x43ff1b(0x1143)]('\x0a'):_0x43ff1b(0x1384))+'\x0a'+_0x5366d6+'\x0a#\x20关系与身份档案\x20(至关重要)\x0a-\x20\x20\x20**你的本名**:\x20\x22'+_0x55f0fd[_0x43ff1b(0x96f)]+_0x43ff1b(0x5b5)+_0x55f0fd[_0x43ff1b(0x5d2)]+'\x22\x20(你可以建议并修改)\x0a-\x20\x20\x20**你对用户的备注**:\x20“'+_0x2201ce+_0x43ff1b(0x871)+_0x2414eb+_0x43ff1b(0xbcb)+_0x30c739+_0x43ff1b(0xf0e)+_0x1b6585+'\x0a'+_0x434c0e+'\x0a'+_0x3a4c8b+_0x43ff1b(0xf3e)+_0xd4c59e+'\x0a'+_0x497a5e+'\x0a\x0a#\x20情景感知:\x0a\x20\x20\x20\x20'+(_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x885)]?_0x43ff1b(0x16f)+_0xae5e80+'\x20('+_0x32f897+_0x43ff1b(0xf02):'')+_0x43ff1b(0xf12)+(_0x54e600?_0x43ff1b(0xeaf)+_0x54e600:_0x43ff1b(0x105b))+_0x43ff1b(0x1166)+(_0x5dc69c?_0x43ff1b(0x592)+_0x5dc69c:_0x43ff1b(0x12c6))+_0x43ff1b(0x3aa)+(_0x55f0fd[_0x43ff1b(0x6a8)]['aiAvatarLibrary']&&_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xb77)][_0x43ff1b(0x58a)]>0x0?_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xb77)]['map'](_0x19ca8b=>'-\x20'+_0x19ca8b[_0x43ff1b(0x5d2)])[_0x43ff1b(0x1143)]('\x0a'):_0x43ff1b(0xe0e))+_0x43ff1b(0x89a)+(_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0x12ce)]&&_0x55f0fd['settings'][_0x43ff1b(0x12ce)][_0x43ff1b(0x58a)]>0x0?_0x55f0fd[_0x43ff1b(0x6a8)]['myAvatarLibrary']['map'](_0x217b2c=>'-\x20'+_0x217b2c[_0x43ff1b(0x5d2)])[_0x43ff1b(0x1143)]('\x0a'):'-\x20(空)')+'\x0a-\x20\x20\x20**五子棋局势**:\x20'+_0x422ab0+_0x43ff1b(0x14da)+_0x55f0fd['originalName']+_0x43ff1b(0x448)+_0x55f0fd[_0x43ff1b(0x96f)]+_0x43ff1b(0x444)+(localStorage[_0x43ff1b(0x587)](_0x43ff1b(0x15b8))==='true'?_0x43ff1b(0x1010):'')+_0x43ff1b(0xb0c)+(localStorage[_0x43ff1b(0x587)]('novelai-enabled')===_0x43ff1b(0x8c3)?'-\x20\x20\x20**公开发布NovelAI真实图片动态**:\x20`{\x22type\x22:\x20\x22qzone_post\x22,\x20\x22postType\x22:\x20\x22naiimag\x22,\x20\x22publicText\x22:\x20\x22(可选)动态的配文\x22,\x20\x22prompt\x22:\x20\x22详细的英文描述词...\x22}`\x20或\x20`{\x22type\x22:\x20\x22qzone_post\x22,\x20\x22postType\x22:\x20\x22naiimag\x22,\x20\x22publicText\x22:\x20\x22(可选)动态的配文\x22,\x20\x22prompt\x22:\x20[\x22图片1详细英文描述\x22,\x20\x22图片2详细英文描述\x22]}`\x20\x0a\x20\x20*\x20**prompt撰写**：你可以根据当前对话上下文、你的角色人设、以及你想表达的情感和氛围，来撰写详细而具体的prompt。详细程度由你根据具体情况自己决定，并不强制。\x0a\x20\x20*\x20例如：\x22a\x20cheerful\x20anime\x20girl\x20with\x20sparkling\x20emerald\x20eyes,\x20sitting\x20by\x20a\x20window\x20on\x20a\x20rainy\x20afternoon,\x20holding\x20a\x20warm\x20cup\x20of\x20tea,\x20soft\x20lighting,\x20cozy\x20atmosphere,\x20melancholic\x20yet\x20peaceful\x20mood\x22':'')+_0x43ff1b(0x12fa)+_0x55f0fd['originalName']+_0x43ff1b(0x110c)+_0x55f0fd[_0x43ff1b(0x96f)]+_0x43ff1b(0x1513)+_0x55f0fd[_0x43ff1b(0x96f)]+_0x43ff1b(0x12a7)+_0x55f0fd['originalName']+_0x43ff1b(0xeb3),_0x38fbb7=_0x4d1c85[_0x43ff1b(0x1431)](_0x329ea3=>{const _0x200e02=_0x43ff1b;if(_0x329ea3[_0x200e02(0x58e)]&&_0x329ea3[_0x200e02(0xfbb)]===_0x200e02(0x1594))return{'role':_0x200e02(0x860),'content':_0x329ea3[_0x200e02(0x128c)]};else{if(_0x329ea3['isHidden'])return null;}if(_0x329ea3[_0x200e02(0xcbd)]===_0x200e02(0x439)){const _0x349c2d=_0x329ea3[_0x200e02(0xfbb)]==='user'?_0x55f0fd[_0x200e02(0x6a8)]['myNickname']||'我':_0x55f0fd['name'];let _0x3952db='';if(_0x329ea3[_0x200e02(0x128c)])_0x3952db=_0x329ea3['content'];else{const _0x2f0f4b=_0x329ea3[_0x200e02(0xdf2)]?'「'+_0x329ea3[_0x200e02(0xdf2)]+'」':'',_0x178c6e=_0x329ea3[_0x200e02(0xdec)]?'('+_0x329ea3['description']+')':'';_0x3952db=(_0x2f0f4b+'\x20'+_0x178c6e)[_0x200e02(0x4a2)]();}return{'role':_0x329ea3['role'],'content':_0x200e02(0xc03)+_0x329ea3[_0x200e02(0x1388)]+')\x20'+_0x349c2d+':\x20'+_0x3952db};}if(_0x329ea3[_0x200e02(0xfbb)]===_0x200e02(0x860)){const _0x42ba1f='(Timestamp:\x20'+_0x329ea3['timestamp']+')\x20';let _0x2cbd06='';if(Array[_0x200e02(0x121f)](_0x329ea3['content'])&&_0x329ea3[_0x200e02(0x128c)][0x0]?.['type']===_0x200e02(0x1296))return{'role':'user','content':[{'type':_0x200e02(0x40f),'text':_0x42ba1f},..._0x329ea3[_0x200e02(0x128c)]]};if(_0x329ea3[_0x200e02(0xadf)]){const _0x57d0c6=String(_0x329ea3['quote'][_0x200e02(0x128c)]||'')[_0x200e02(0x516)](0x0,0x32);_0x2cbd06+=_0x200e02(0x104f)+_0x329ea3['quote']['senderName']+'\x20的消息:\x20\x22'+_0x57d0c6+'...\x22):\x20'+_0x329ea3[_0x200e02(0x128c)];}else _0x2cbd06+=_0x329ea3['content'];if(_0x329ea3[_0x200e02(0xcbd)]===_0x200e02(0xe86))return{'role':_0x200e02(0x860),'content':_0x42ba1f+'[你发送了一张需要AI识别的图片，图片内容是：\x27'+_0x329ea3[_0x200e02(0x128c)]+'\x27]'};if(_0x329ea3[_0x200e02(0xcbd)]===_0x200e02(0xd83))return{'role':_0x200e02(0x860),'content':_0x42ba1f+'[你发送了一条语音消息，内容是：\x27'+_0x329ea3[_0x200e02(0x128c)]+'\x27]'};if(_0x329ea3[_0x200e02(0xcbd)]==='transfer')return{'role':_0x200e02(0x860),'content':_0x42ba1f+_0x200e02(0x66f)+_0x329ea3[_0x200e02(0x1388)]+_0x200e02(0x310)+_0x329ea3['amount']+_0x200e02(0x349)+_0x329ea3[_0x200e02(0x10c2)]+'。等待对方处理。]'};if(_0x329ea3[_0x200e02(0xcbd)]==='waimai_request')return{'role':_0x200e02(0x860),'content':_0x42ba1f+'[系统提示：你于时间戳\x20'+_0x329ea3[_0x200e02(0x1388)]+_0x200e02(0x6b1)+_0x329ea3[_0x200e02(0xbf5)]+_0x200e02(0x6f6)+_0x329ea3[_0x200e02(0x618)]+'\x20元。]'};else{if(_0x329ea3[_0x200e02(0xcbd)]===_0x200e02(0x248)){const _0x496c99=_0x329ea3[_0x200e02(0x3ca)]['map'](_0x427d27=>_0x427d27[_0x200e02(0x5d2)]+'\x20x'+_0x427d27['quantity'])['join']('、\x20');let _0x753302=_0x55f0fd[_0x200e02(0xe83)]?_0x200e02(0x9f9)+_0x329ea3['recipients'][_0x200e02(0x1431)](_0x1791be=>_0x140540(_0x55f0fd,_0x1791be))[_0x200e02(0x1143)]('、\x20'):_0x200e02(0x9f9)+_0x55f0fd['name'];return{'role':_0x200e02(0x860),'content':_0x42ba1f+_0x200e02(0x259)+_0x753302+'，礼物是：'+_0x496c99+']'};}}if(_0x329ea3[_0x200e02(0x339)])return{'role':_0x200e02(0x860),'content':_0x42ba1f+_0x200e02(0x820)+_0x329ea3[_0x200e02(0x339)]+'\x27]'};return{'role':_0x329ea3[_0x200e02(0xfbb)],'content':_0x42ba1f+_0x2cbd06};}else{if(_0x329ea3['role']==='assistant'){let _0x2fa28a={'type':_0x329ea3[_0x200e02(0xcbd)]||_0x200e02(0x40f)};if(_0x329ea3['type']===_0x200e02(0x1b3))_0x2fa28a[_0x200e02(0x258)]=_0x329ea3['content'],_0x2fa28a[_0x200e02(0x339)]=_0x329ea3[_0x200e02(0x339)];else{if(_0x329ea3[_0x200e02(0xcbd)]==='transfer')_0x2fa28a[_0x200e02(0x618)]=_0x329ea3['amount'],_0x2fa28a[_0x200e02(0x10c2)]=_0x329ea3[_0x200e02(0x10c2)];else _0x329ea3[_0x200e02(0xcbd)]===_0x200e02(0x4a4)?(_0x2fa28a['productInfo']=_0x329ea3[_0x200e02(0xbf5)],_0x2fa28a[_0x200e02(0x618)]=_0x329ea3[_0x200e02(0x618)]):_0x329ea3[_0x200e02(0xadf)]?_0x2fa28a['quote_reply']={'target_sender':_0x329ea3[_0x200e02(0xadf)]['senderName'],'target_content':_0x329ea3[_0x200e02(0xadf)][_0x200e02(0x128c)],'reply_content':_0x329ea3[_0x200e02(0x128c)]}:_0x2fa28a[_0x200e02(0x128c)]=_0x329ea3[_0x200e02(0x128c)];}const _0x3934a6=JSON[_0x200e02(0x994)]([_0x2fa28a]);return{'role':'assistant','content':_0x200e02(0xc03)+_0x329ea3[_0x200e02(0x1388)]+')\x20'+_0x3934a6};}}return null;})[_0x43ff1b(0xede)](Boolean);if(!_0x55f0fd[_0x43ff1b(0xe83)]&&_0x55f0fd['relationship']?.['status']==='pending_ai_approval'){const _0x453f01=_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0xede)](_0x589ca9=>!_0x589ca9[_0x43ff1b(0x58e)])[_0x43ff1b(0x5cc)](-0xa)['map'](_0x528c83=>{const _0x5a44f5=_0x43ff1b,_0x3ce696=_0x528c83[_0x5a44f5(0xfbb)]===_0x5a44f5(0x860)?'用户':_0x55f0fd[_0x5a44f5(0x5d2)];return _0x3ce696+':\x20'+String(_0x528c83['content'])[_0x5a44f5(0x516)](0x0,0x32)+_0x5a44f5(0x629);})[_0x43ff1b(0x1143)]('\x0a'),_0x103421={'role':_0x43ff1b(0x860),'content':_0x43ff1b(0xd40)+_0x55f0fd[_0x43ff1b(0x13ab)][_0x43ff1b(0x8dd)]+_0x43ff1b(0xbb9)+_0x453f01+_0x43ff1b(0x9b6)};_0x38fbb7[_0x43ff1b(0x1426)](_0x103421);}}}let _0x16b085=_0x44d385===GEMINI_API_URL,_0x92bc9e=_0x16b978(_0x471f78,_0x2f1699,_0x541ed7,_0x38fbb7),_0x2408e9;try{_0x2408e9=_0x16b085?await fetch(_0x92bc9e[_0x43ff1b(0x258)],_0x92bc9e[_0x43ff1b(0xc6b)]):await fetch(_0x44d385+_0x43ff1b(0x14c2),{'method':_0x43ff1b(0x12d9),'headers':{'Content-Type':_0x43ff1b(0xa90),'Authorization':_0x43ff1b(0xf03)+_0x2f1699},'body':JSON[_0x43ff1b(0x994)]({'model':_0x471f78,'messages':[{'role':'system','content':_0x541ed7},..._0x38fbb7],'temperature':_0x1ae02e['globalSettings']['apiTemperature']||0.8,'stream':![]})});}catch(_0x34e415){throw new Error(_0x43ff1b(0x5fd)+_0x34e415[_0x43ff1b(0x11f0)]);}if(!_0x2408e9['ok']){let _0x507fe1=_0x43ff1b(0xbab)+_0x2408e9['status']+'\x20'+_0x2408e9['statusText'];try{const _0x163e76=await _0x2408e9[_0x43ff1b(0xb84)]();_0x163e76[_0x43ff1b(0x127d)]&&_0x163e76[_0x43ff1b(0x127d)][_0x43ff1b(0x11f0)]?_0x507fe1+=_0x43ff1b(0x7c5)+_0x163e76['error'][_0x43ff1b(0x11f0)]:_0x507fe1+=_0x43ff1b(0x7c5)+JSON[_0x43ff1b(0x994)](_0x163e76);}catch(_0x46771e){_0x507fe1+=_0x43ff1b(0x11ea)+await _0x2408e9[_0x43ff1b(0x40f)]();}throw new Error(_0x507fe1);}const _0x140e2b=await _0x2408e9[_0x43ff1b(0xb84)](),_0x7e7db=getGeminiResponseText(_0x140e2b);lastRawAiResponse=_0x7e7db,lastResponseTimestamps=[],_0x55f0fd[_0x43ff1b(0xce3)]=_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0xede)](_0x3b5835=>!_0x3b5835['isTemporary']);const _0xac9027=_0x1493d9(_0x7e7db);let _0xe32cb8=[];if(_0x55f0fd['settings'][_0x43ff1b(0x3f6)]){let _0x237974={'content':[],'dialogue':[],'description':[]};for(const _0x549297 of _0xac9027){if(_0x549297[_0x43ff1b(0xcbd)]===_0x43ff1b(0x439)){if(_0x549297[_0x43ff1b(0x128c)])_0x237974['content'][_0x43ff1b(0x1426)](_0x549297[_0x43ff1b(0x128c)]);else{if(_0x549297['dialogue'])_0x237974[_0x43ff1b(0xdf2)][_0x43ff1b(0x1426)](_0x549297['dialogue']);if(_0x549297[_0x43ff1b(0xdec)])_0x237974['description']['push'](_0x549297[_0x43ff1b(0xdec)]);}}else(_0x237974['content'][_0x43ff1b(0x58a)]>0x0||_0x237974['dialogue']['length']>0x0||_0x237974[_0x43ff1b(0xdec)][_0x43ff1b(0x58a)]>0x0)&&(_0x237974[_0x43ff1b(0x128c)][_0x43ff1b(0x58a)]>0x0&&_0xe32cb8[_0x43ff1b(0x1426)]({'type':_0x43ff1b(0x439),'content':_0x237974[_0x43ff1b(0x128c)]['join']('\x0a')}),(_0x237974[_0x43ff1b(0xdf2)][_0x43ff1b(0x58a)]>0x0||_0x237974[_0x43ff1b(0xdec)][_0x43ff1b(0x58a)]>0x0)&&_0xe32cb8['push']({'type':_0x43ff1b(0x439),'dialogue':_0x237974['dialogue'][_0x43ff1b(0x1143)]('\x0a'),'description':_0x237974[_0x43ff1b(0xdec)][_0x43ff1b(0x1143)]('\x0a')}),_0x237974={'content':[],'dialogue':[],'description':[]}),_0xe32cb8[_0x43ff1b(0x1426)](_0x549297);}_0x237974[_0x43ff1b(0x128c)][_0x43ff1b(0x58a)]>0x0&&_0xe32cb8[_0x43ff1b(0x1426)]({'type':'offline_text','content':_0x237974[_0x43ff1b(0x128c)][_0x43ff1b(0x1143)]('\x0a')}),(_0x237974[_0x43ff1b(0xdf2)]['length']>0x0||_0x237974['description'][_0x43ff1b(0x58a)]>0x0)&&_0xe32cb8['push']({'type':_0x43ff1b(0x439),'dialogue':_0x237974[_0x43ff1b(0xdf2)][_0x43ff1b(0x1143)]('\x0a'),'description':_0x237974[_0x43ff1b(0xdec)][_0x43ff1b(0x1143)]('\x0a')});}else _0xe32cb8=_0xac9027;const _0x33cbac=_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0xede)](_0x4d668e=>_0x4d668e[_0x43ff1b(0xfbb)]===_0x43ff1b(0x860)&&!_0x4d668e['isHidden'])[_0x43ff1b(0x1139)]();if(_0x33cbac&&Array[_0x43ff1b(0x121f)](_0x33cbac[_0x43ff1b(0x128c)])&&_0x33cbac[_0x43ff1b(0x128c)][0x0]?.[_0x43ff1b(0xcbd)]===_0x43ff1b(0x1296)&&!_0x33cbac[_0x43ff1b(0x4de)]){const _0x274378=_0xac9027['find'](_0x27d3a6=>_0x27d3a6[_0x43ff1b(0xcbd)]===_0x43ff1b(0x40f));let _0x1c25e9;_0x274378&&(_0x274378['content']||_0x274378[_0x43ff1b(0x11f0)])?_0x1c25e9=String(_0x274378[_0x43ff1b(0x128c)]||_0x274378[_0x43ff1b(0x11f0)])[_0x43ff1b(0x4a2)]():_0x1c25e9=_0x43ff1b(0xa5c);const _0x4dca20=_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0xf2d)](_0x2a905c=>_0x2a905c[_0x43ff1b(0x1388)]===_0x33cbac['timestamp']);if(_0x4dca20>-0x1){console[_0x43ff1b(0x57e)](_0x43ff1b(0x95a)+_0x33cbac[_0x43ff1b(0x1388)]+_0x43ff1b(0x15be));const _0x5b366f=_0x43ff1b(0x11b4)+_0x1c25e9+'”]';_0x55f0fd[_0x43ff1b(0xce3)][_0x4dca20][_0x43ff1b(0x128c)]=_0x5b366f,_0x55f0fd[_0x43ff1b(0xce3)][_0x4dca20]['imageProcessed']=!![],_0x55f0fd[_0x43ff1b(0xce3)][_0x4dca20][_0x43ff1b(0xcbd)]=_0x43ff1b(0x40f);}}const _0x19db4d=document[_0x43ff1b(0x1f4)](_0x43ff1b(0x13c3))[_0x43ff1b(0x159b)]['contains'](_0x43ff1b(0x7cf))&&_0x1ae02e[_0x43ff1b(0x588)]===_0x47dcdb;let _0x128406=![],_0x1579b7=Date[_0x43ff1b(0xd6e)](),_0x360500=[],_0x3be1bf=![];for(const _0x51db46 of _0xe32cb8){if(_0x51db46[_0x43ff1b(0xcbd)]==='thought_chain'){console['log'](_0x43ff1b(0x6bc),_0x51db46);const _0x24f2e1=_0x43ff1b(0x6bf)+(_0x51db46[_0x43ff1b(0xbe2)]||'无')+_0x43ff1b(0x7c4)+(_0x51db46['strategy']||'无')+_0x43ff1b(0x307)+JSON[_0x43ff1b(0x994)](_0x51db46[_0x43ff1b(0x5df)]||{}),_0x28704d={'role':_0x43ff1b(0x1594),'content':_0x24f2e1,'timestamp':_0x1579b7++,'isHidden':!![]};_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x1426)](_0x28704d),lastResponseTimestamps[_0x43ff1b(0x1426)](_0x28704d[_0x43ff1b(0x1388)]);continue;}_0x55f0fd[_0x43ff1b(0x6a8)]['enableTts']!==![]&&_0x51db46[_0x43ff1b(0xcbd)]===_0x43ff1b(0x40f)&&typeof _0x51db46[_0x43ff1b(0x128c)]==='string'&&_0x51db46['content']['trim']()[_0x43ff1b(0xebf)](_0x43ff1b(0x150e))&&(_0x51db46[_0x43ff1b(0xcbd)]='voice_message',_0x51db46[_0x43ff1b(0x128c)]=_0x51db46['content'][_0x43ff1b(0xef0)](_0x43ff1b(0x150e),'')[_0x43ff1b(0x4a2)]());if(_0x55f0fd[_0x43ff1b(0xe83)]&&_0x51db46[_0x43ff1b(0x5d2)]&&_0x51db46[_0x43ff1b(0x5d2)]===_0x55f0fd['name']){console[_0x43ff1b(0x127d)](_0x43ff1b(0xad2)+_0x55f0fd['name']+_0x43ff1b(0x9f2),_0x51db46);continue;}if(!_0x51db46||typeof _0x51db46!==_0x43ff1b(0xcc5)){console[_0x43ff1b(0xb3b)](_0x43ff1b(0x13f3),_0x51db46);continue;}if(!_0x51db46[_0x43ff1b(0xcbd)]){if(_0x55f0fd[_0x43ff1b(0xe83)]&&_0x51db46[_0x43ff1b(0x5d2)]&&_0x51db46[_0x43ff1b(0x11f0)])_0x51db46[_0x43ff1b(0xcbd)]=_0x43ff1b(0x40f);else{if(_0x51db46[_0x43ff1b(0x128c)])_0x51db46[_0x43ff1b(0xcbd)]=_0x43ff1b(0x40f);else{console[_0x43ff1b(0xb3b)](_0x43ff1b(0xf37),_0x51db46);continue;}}}if(_0x51db46[_0x43ff1b(0xcbd)]==='video_call_response'){_0x11ced0[_0x43ff1b(0x116c)]=![];if(_0x51db46['decision']===_0x43ff1b(0xa7d))_0xeb5668();else{const _0x1098d7={'role':_0x43ff1b(0x13c0),'content':_0x43ff1b(0x1149),'timestamp':Date[_0x43ff1b(0xd6e)]()};_0x55f0fd['history'][_0x43ff1b(0x1426)](_0x1098d7),await _0x3df81a[_0x43ff1b(0x589)][_0x43ff1b(0x295)](_0x55f0fd),_0x2e53fa(_0x43ff1b(0x13c3)),_0x3689f0(_0x47dcdb);}_0x128406=!![];break;}if(_0x51db46['type']===_0x43ff1b(0x1475)){if(_0x51db46['decision']==='join'){const _0x4c473e=_0x55f0fd[_0x43ff1b(0x1402)]['find'](_0x11c618=>_0x11c618[_0x43ff1b(0x96f)]===_0x51db46[_0x43ff1b(0x5d2)]);_0x4c473e&&!_0x11ced0[_0x43ff1b(0x1059)][_0x43ff1b(0x690)](_0x9d7485=>_0x9d7485['id']===_0x4c473e['id'])&&_0x11ced0[_0x43ff1b(0x1059)][_0x43ff1b(0x1426)](_0x4c473e);}_0x128406=!![];continue;}if(_0x55f0fd[_0x43ff1b(0xe83)]&&_0x51db46[_0x43ff1b(0x5d2)]&&_0x51db46[_0x43ff1b(0x5d2)]===_0x55f0fd['name']){console[_0x43ff1b(0x127d)](_0x43ff1b(0xad2)+_0x55f0fd[_0x43ff1b(0x5d2)]+_0x43ff1b(0x9f2),_0x51db46);continue;}if(_0x55f0fd[_0x43ff1b(0xe83)]&&!_0x51db46['name']){console['error'](_0x43ff1b(0xb6b),_0x51db46);continue;}let _0x8dc426=null;const _0x3d4da8=_0x1579b7++,_0x374e81={'role':_0x43ff1b(0x13c0),'senderName':_0x51db46['name']||_0x55f0fd[_0x43ff1b(0x5d2)],'timestamp':_0x3d4da8};lastResponseTimestamps[_0x43ff1b(0x1426)](_0x3d4da8);switch(_0x51db46[_0x43ff1b(0xcbd)]){case _0x43ff1b(0x42d):{const _0x510362=_0x51db46[_0x43ff1b(0x5d2)],_0x1f1620=_0x51db46[_0x43ff1b(0x515)],_0x2a6c18=_0x1ae02e[_0x43ff1b(0x11ef)][_0x43ff1b(0xb46)]||_0x43ff1b(0xee7);if(_0x1f1620===_0x2a6c18){const _0x30616e=Object[_0x43ff1b(0x753)](_0x1ae02e[_0x43ff1b(0x589)])['find'](_0x27d8b4=>!_0x27d8b4[_0x43ff1b(0xe83)]&&_0x27d8b4[_0x43ff1b(0x96f)]===_0x510362);if(_0x30616e){lastPrivateMessagesSent=[];const _0x191cc9=Array['isArray'](_0x51db46[_0x43ff1b(0x128c)])?_0x51db46[_0x43ff1b(0x128c)]:[_0x51db46[_0x43ff1b(0x128c)]];let _0x2e3cc0=0x0;for(const _0xdc9671 of _0x191cc9){if(!_0xdc9671||!_0xdc9671[_0x43ff1b(0x4a2)]())continue;const _0x48000f={'role':_0x43ff1b(0x13c0),'senderName':_0x510362,'content':_0xdc9671,'timestamp':_0x1579b7++};lastPrivateMessagesSent[_0x43ff1b(0x1426)]({'chatId':_0x30616e['id'],'timestamp':_0x48000f[_0x43ff1b(0x1388)]}),_0x30616e[_0x43ff1b(0xce3)]['push'](_0x48000f),_0x2e3cc0++;}_0x2e3cc0>0x0&&(_0x1ae02e[_0x43ff1b(0x588)]!==_0x30616e['id']&&(_0x30616e[_0x43ff1b(0xf2c)]=(_0x30616e[_0x43ff1b(0xf2c)]||0x0)+_0x2e3cc0,_0x158e58(_0x30616e['id'],_0x30616e[_0x43ff1b(0x5d2)]+_0x43ff1b(0x7d9)+_0x2e3cc0+_0x43ff1b(0x143c))),await _0x3df81a[_0x43ff1b(0x589)][_0x43ff1b(0x295)](_0x30616e)),_0x8dc426=null;}else console[_0x43ff1b(0xb3b)]('AI\x20'+_0x510362+_0x43ff1b(0xd26)),_0x8dc426=null;}else console[_0x43ff1b(0xb3b)](_0x43ff1b(0xea6)+_0x1f1620+_0x43ff1b(0x3a9)),_0x8dc426=null;continue;}case'update_thoughts':if(!_0x55f0fd[_0x43ff1b(0xe83)]){_0x51db46['heartfelt_voice']&&(_0x55f0fd['heartfeltVoice']=String(_0x51db46[_0x43ff1b(0x7a9)]));_0x51db46['random_jottings']&&(_0x55f0fd[_0x43ff1b(0x3d2)]=String(_0x51db46[_0x43ff1b(0x2ba)]));!Array[_0x43ff1b(0x121f)](_0x55f0fd[_0x43ff1b(0xc34)])&&(_0x55f0fd['thoughtsHistory']=[]);_0x55f0fd[_0x43ff1b(0xc34)]['push']({'heartfeltVoice':_0x55f0fd[_0x43ff1b(0xbae)],'randomJottings':_0x55f0fd[_0x43ff1b(0x3d2)],'timestamp':Date[_0x43ff1b(0xd6e)]()});_0x55f0fd['thoughtsHistory']['length']>0x32&&_0x55f0fd[_0x43ff1b(0xc34)][_0x43ff1b(0xbe1)]();const _0x360b07='[这是你上一轮的内心独白和思考]\x0a-\x20心声:\x20'+_0x55f0fd['heartfeltVoice']+_0x43ff1b(0x460)+_0x55f0fd[_0x43ff1b(0x3d2)],_0x2de603={'role':_0x43ff1b(0x1594),'content':_0x360b07,'timestamp':Date[_0x43ff1b(0xd6e)](),'isHidden':!![]};}continue;case _0x43ff1b(0xbfc):if(!_0x55f0fd[_0x43ff1b(0xe83)]&&_0x51db46[_0x43ff1b(0x3dd)]){const _0xaa26bd=_0x51db46[_0x43ff1b(0x3dd)]['trim']();if(_0xaa26bd){_0x55f0fd['settings']['myNickname']=_0xaa26bd;const _0x326bcb={'role':_0x43ff1b(0x1594),'type':_0x43ff1b(0x1454),'content':'“'+_0x55f0fd[_0x43ff1b(0x5d2)]+_0x43ff1b(0x106b)+_0xaa26bd+'”','timestamp':_0x1579b7++};_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x1426)](_0x326bcb);const _0x411533={'role':_0x43ff1b(0x1594),'content':'[系统提示：你刚刚成功将对用户的称呼修改为了“'+_0xaa26bd+_0x43ff1b(0xbc7),'timestamp':_0x1579b7++,'isHidden':!![]};_0x55f0fd['history'][_0x43ff1b(0x1426)](_0x411533),_0x19db4d&&_0x5286f1(_0x326bcb,_0x55f0fd);}}continue;case _0x43ff1b(0x649):if(!_0x55f0fd[_0x43ff1b(0xe83)]&&_0x51db46[_0x43ff1b(0x3dd)]){const _0x440f43=_0x55f0fd['name'],_0x2a92ae=_0x51db46['new_name'][_0x43ff1b(0x4a2)]();if(_0x2a92ae&&_0x2a92ae!==_0x440f43){!_0x55f0fd['nameHistory']&&(_0x55f0fd['nameHistory']=[]);!_0x55f0fd['nameHistory']['includes'](_0x440f43)&&_0x55f0fd['nameHistory'][_0x43ff1b(0x1426)](_0x440f43);_0x55f0fd[_0x43ff1b(0x5d2)]=_0x2a92ae;const _0x471c3c={'role':_0x43ff1b(0x1594),'type':_0x43ff1b(0x1454),'content':'“'+_0x55f0fd[_0x43ff1b(0x96f)]+'”\x20将备注修改为\x20“'+_0x2a92ae+'”','timestamp':_0x1579b7++};_0x55f0fd[_0x43ff1b(0xce3)]['push'](_0x471c3c);const _0x1dd188={'role':_0x43ff1b(0x1594),'content':_0x43ff1b(0x14d3)+_0x2a92ae+_0x43ff1b(0x11a3),'timestamp':_0x1579b7++,'isHidden':!![]};_0x55f0fd['history']['push'](_0x1dd188),_0x19db4d&&(_0x5286f1(_0x471c3c,_0x55f0fd),document[_0x43ff1b(0x1f4)]('chat-header-title')[_0x43ff1b(0x231)]=_0x2a92ae),await _0x44799f(_0x55f0fd);}}continue;case'change_avatar':{const _0x39d0b9=_0x51db46[_0x43ff1b(0x5d2)],_0x4a76a9=_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xb77)][_0x43ff1b(0x13b7)](_0x490447=>_0x490447['name']===_0x39d0b9);if(_0x4a76a9){_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xc99)]=_0x4a76a9[_0x43ff1b(0x258)];const _0x33e7e6={'role':'system','type':_0x43ff1b(0x1454),'content':'['+_0x55f0fd[_0x43ff1b(0x5d2)]+_0x43ff1b(0x1278),'timestamp':Date[_0x43ff1b(0xd6e)]()};_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x1426)](_0x33e7e6),await _0x3901ec(_0x55f0fd),_0x19db4d&&(_0x5286f1(_0x33e7e6,_0x55f0fd),_0x3689f0(_0x47dcdb));}continue;}case _0x43ff1b(0x123e):{const _0x5f0654=_0x51db46[_0x43ff1b(0x5d2)],_0x4a4350=_0x55f0fd[_0x43ff1b(0x6a8)]['myAvatarLibrary'][_0x43ff1b(0x13b7)](_0x15e1a6=>_0x15e1a6[_0x43ff1b(0x5d2)]===_0x5f0654);if(_0x4a4350){_0x55f0fd['settings'][_0x43ff1b(0x1207)]=_0x4a4350['url'];const _0x213470={'role':_0x43ff1b(0x1594),'type':_0x43ff1b(0x1454),'content':'['+_0x55f0fd[_0x43ff1b(0x5d2)]+_0x43ff1b(0x8e4),'timestamp':Date[_0x43ff1b(0xd6e)]()};_0x55f0fd[_0x43ff1b(0xce3)]['push'](_0x213470),_0x19db4d&&(_0x5286f1(_0x213470,_0x55f0fd),_0x3689f0(_0x47dcdb));}continue;}case _0x43ff1b(0xe38):{const _0x2c84ce=parseInt(_0x51db46['x']),_0x574060=parseInt(_0x51db46['y']);!isNaN(_0x2c84ce)&&!isNaN(_0x574060)?_0x35b05e({'x':_0x2c84ce,'y':_0x574060}):console['warn'](_0x43ff1b(0xbaf),_0x51db46);continue;}case'waimai_response':const _0x435d7c=_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0xf2d)](_0x4c43fb=>_0x4c43fb[_0x43ff1b(0x1388)]===_0x51db46['for_timestamp']);if(_0x435d7c>-0x1){const _0x55b95b=_0x55f0fd[_0x43ff1b(0xce3)][_0x435d7c];_0x55b95b['status']=_0x51db46['status'],_0x55b95b['paidBy']=_0x51db46[_0x43ff1b(0x1589)]==='paid'?_0x51db46['name']:null;}continue;case _0x43ff1b(0x4e1):const _0x3480e5={'type':_0x51db46['postType'],'content':_0x51db46[_0x43ff1b(0x128c)]||'','publicText':_0x51db46['publicText']||'','hiddenContent':_0x51db46[_0x43ff1b(0x1090)]||'','image_prompt':_0x51db46[_0x43ff1b(0x1248)]||'','timestamp':Date['now'](),'authorId':_0x47dcdb,'authorGroupId':_0x55f0fd[_0x43ff1b(0x67d)],'visibleGroupIds':null};if(_0x51db46[_0x43ff1b(0x14e3)]===_0x43ff1b(0x132a)&&_0x51db46[_0x43ff1b(0x1063)])try{const _0x4edc87=Array[_0x43ff1b(0x121f)](_0x51db46[_0x43ff1b(0x1063)])?_0x51db46[_0x43ff1b(0x1063)]['slice'](0x0,0x2):[_0x51db46[_0x43ff1b(0x1063)]];console[_0x43ff1b(0x57e)](_0x43ff1b(0x934)+_0x4edc87[_0x43ff1b(0x58a)]+_0x43ff1b(0x829));const _0x37b898=[];for(let _0x329ab2=0x0;_0x329ab2<_0x4edc87[_0x43ff1b(0x58a)];_0x329ab2++){const _0x2c6067=_0x4edc87[_0x329ab2];console['log']('生成第'+(_0x329ab2+0x1)+_0x43ff1b(0x11e5),_0x2c6067);const _0x141176=_0x50a9eb(_0x55f0fd['id']),_0x275b1d=_0x2c6067+',\x20'+_0x141176['positive'],_0x51def4=_0x141176['negative'];console[_0x43ff1b(0x57e)](_0x43ff1b(0x3a3)+(_0x141176[_0x43ff1b(0xc36)]===_0x43ff1b(0x1381)?_0x43ff1b(0x148d):'系统')+'提示词配置'),console['log'](_0x43ff1b(0xfdb),_0x275b1d),console['log'](_0x43ff1b(0xd3b),_0x51def4);const _0x1a3483=localStorage[_0x43ff1b(0x587)](_0x43ff1b(0x8f7)),_0x505c2a=localStorage[_0x43ff1b(0x587)](_0x43ff1b(0xf6b))||'nai-diffusion-4-5-full',_0x2e6b92=_0x3b1556();if(!_0x1a3483)throw new Error(_0x43ff1b(0x34d));const [_0x19cdc7,_0x1420f3]=_0x2e6b92[_0x43ff1b(0xf1c)][_0x43ff1b(0x23f)]('x')[_0x43ff1b(0x1431)](Number);let _0x1e5038;_0x505c2a[_0x43ff1b(0xe82)](_0x43ff1b(0x3ba))?_0x1e5038={'input':_0x275b1d,'model':_0x505c2a,'action':'generate','parameters':{'params_version':0x3,'width':_0x19cdc7,'height':_0x1420f3,'scale':_0x2e6b92[_0x43ff1b(0x140e)],'sampler':_0x2e6b92[_0x43ff1b(0x115d)],'steps':_0x2e6b92['steps'],'seed':_0x2e6b92[_0x43ff1b(0x11c2)]===-0x1?Math[_0x43ff1b(0x123c)](Math[_0x43ff1b(0x13ae)]()*0x2540be3ff):_0x2e6b92['seed'],'n_samples':0x1,'ucPreset':_0x2e6b92[_0x43ff1b(0x826)],'qualityToggle':_0x2e6b92[_0x43ff1b(0xc1a)],'autoSmea':![],'dynamic_thresholding':![],'controlnet_strength':0x1,'legacy':![],'add_original_image':!![],'cfg_rescale':0x0,'noise_schedule':_0x43ff1b(0xec0),'legacy_v3_extend':![],'skip_cfg_above_sigma':null,'use_coords':![],'legacy_uc':![],'normalize_reference_strength_multiple':!![],'inpaintImg2ImgStrength':0x1,'characterPrompts':[],'v4_prompt':{'caption':{'base_caption':_0x275b1d,'char_captions':[]},'use_coords':![],'use_order':!![]},'v4_negative_prompt':{'caption':{'base_caption':_0x51def4,'char_captions':[]},'legacy_uc':![]},'negative_prompt':_0x51def4,'deliberate_euler_ancestral_bug':![],'prefer_brownian':!![]}}:_0x1e5038={'input':_0x275b1d,'model':_0x505c2a,'action':_0x43ff1b(0xb45),'parameters':{'width':_0x19cdc7,'height':_0x1420f3,'scale':_0x2e6b92[_0x43ff1b(0x140e)],'sampler':_0x2e6b92[_0x43ff1b(0x115d)],'steps':_0x2e6b92['steps'],'seed':_0x2e6b92[_0x43ff1b(0x11c2)]===-0x1?Math[_0x43ff1b(0x123c)](Math[_0x43ff1b(0x13ae)]()*0x2540be3ff):_0x2e6b92[_0x43ff1b(0x11c2)],'n_samples':0x1,'ucPreset':_0x2e6b92[_0x43ff1b(0x826)],'qualityToggle':_0x2e6b92[_0x43ff1b(0xc1a)],'sm':_0x2e6b92[_0x43ff1b(0x114d)],'sm_dyn':_0x2e6b92[_0x43ff1b(0x353)],'dynamic_thresholding':![],'controlnet_strength':0x1,'legacy':![],'add_original_image':![],'cfg_rescale':0x0,'noise_schedule':_0x43ff1b(0x26e),'negative_prompt':_0x51def4}};console[_0x43ff1b(0x57e)]('🚀\x20发送NAI请求:',_0x1e5038);let _0x5100aa;_0x505c2a[_0x43ff1b(0xe82)]('nai-diffusion-4')?_0x5100aa=_0x43ff1b(0x480):_0x5100aa=_0x43ff1b(0x65b);let _0x42bd27=_0x2e6b92[_0x43ff1b(0x4fd)];_0x42bd27==='custom'&&(_0x42bd27=_0x2e6b92['custom_proxy_url']||'');_0x42bd27&&_0x42bd27!==''&&(_0x5100aa=_0x42bd27+encodeURIComponent(_0x5100aa));const _0xc7c5bb=await fetch(_0x5100aa,{'method':_0x43ff1b(0x12d9),'headers':{'Content-Type':'application/json','Authorization':_0x43ff1b(0xf03)+_0x1a3483},'body':JSON[_0x43ff1b(0x994)](_0x1e5038)});console[_0x43ff1b(0x57e)](_0x43ff1b(0x79e),_0xc7c5bb[_0x43ff1b(0x1589)]),console['log'](_0x43ff1b(0xb1d),[..._0xc7c5bb['headers'][_0x43ff1b(0xd20)]()]);if(!_0xc7c5bb['ok']){const _0x426eb1=await _0xc7c5bb[_0x43ff1b(0x40f)]();console[_0x43ff1b(0x127d)](_0x43ff1b(0xf01),_0x426eb1);throw new Error(_0x43ff1b(0x14ef)+_0xc7c5bb[_0x43ff1b(0x1589)]+_0x43ff1b(0x126a)+_0x426eb1);}const _0x3023e7=_0xc7c5bb['headers'][_0x43ff1b(0x13f8)](_0x43ff1b(0xded));console[_0x43ff1b(0x57e)]('Content-Type:',_0x3023e7);let _0x2b941f,_0x567a4f;if(_0x3023e7&&_0x3023e7[_0x43ff1b(0xe82)]('text/event-stream')){console[_0x43ff1b(0x57e)](_0x43ff1b(0x10e6));const _0x47f5c9=await _0xc7c5bb[_0x43ff1b(0x40f)]();console[_0x43ff1b(0x57e)]('收到\x20SSE\x20数据，大小:',_0x47f5c9[_0x43ff1b(0x58a)]);const _0x2df182=_0x47f5c9[_0x43ff1b(0x4a2)]()[_0x43ff1b(0x23f)]('\x0a');let _0x59051c=null;for(let _0x2e8df2=_0x2df182[_0x43ff1b(0x58a)]-0x1;_0x2e8df2>=0x0;_0x2e8df2--){const _0xaa9ea4=_0x2df182[_0x2e8df2]['trim']();if(_0xaa9ea4[_0x43ff1b(0xebf)](_0x43ff1b(0xabd))&&_0xaa9ea4!==_0x43ff1b(0x2e6)){const _0xbeb7a1=_0xaa9ea4[_0x43ff1b(0x516)](0x6);try{const _0x33f06d=JSON[_0x43ff1b(0x129c)](_0xbeb7a1);if(_0x33f06d['event_type']===_0x43ff1b(0x830)&&_0x33f06d['image']){_0x59051c=_0x33f06d['image'],console[_0x43ff1b(0x57e)](_0x43ff1b(0xf80));break;}if(_0x33f06d['data']){_0x59051c=_0x33f06d[_0x43ff1b(0xc6b)],console[_0x43ff1b(0x57e)](_0x43ff1b(0x2de));break;}if(_0x33f06d['image']){_0x59051c=_0x33f06d['image'],console['log'](_0x43ff1b(0xa42));break;}}catch(_0x1edb97){_0x59051c=_0xbeb7a1,console[_0x43ff1b(0x57e)]('直接使用\x20base64\x20数据');break;}}}if(!_0x59051c)throw new Error(_0x43ff1b(0x43b));const _0x2d82f7=_0x59051c[_0x43ff1b(0xebf)](_0x43ff1b(0xb62)),_0x5741f4=_0x59051c[_0x43ff1b(0xebf)]('/9j/');if(_0x2d82f7||_0x5741f4){console[_0x43ff1b(0x57e)]('✅\x20检测到直接的图片\x20base64\x20数据\x20(PNG/JPEG)');const _0x199c7a=atob(_0x59051c),_0x251b9f=new Uint8Array(_0x199c7a[_0x43ff1b(0x58a)]);for(let _0x2e7a99=0x0;_0x2e7a99<_0x199c7a['length'];_0x2e7a99++){_0x251b9f[_0x2e7a99]=_0x199c7a['charCodeAt'](_0x2e7a99);}const _0x10277f=new Blob([_0x251b9f],{'type':_0x2d82f7?_0x43ff1b(0xdce):'image/jpeg'});console[_0x43ff1b(0x57e)]('图片\x20Blob\x20创建成功，大小:',_0x10277f[_0x43ff1b(0xb51)]);const _0x32de99=new FileReader();_0x567a4f=await new Promise((_0x3a775a,_0xce9d69)=>{const _0x109301=_0x43ff1b;_0x32de99['onloadend']=()=>_0x3a775a(_0x32de99['result']),_0x32de99[_0x109301(0xdf5)]=_0xce9d69,_0x32de99[_0x109301(0x21e)](_0x10277f);}),console[_0x43ff1b(0x57e)]('✅\x20图片转换成功！🎨');}else{console[_0x43ff1b(0x57e)]('当作\x20ZIP\x20文件处理...');const _0x5c63bb=atob(_0x59051c),_0x5de177=new Uint8Array(_0x5c63bb[_0x43ff1b(0x58a)]);for(let _0x19bc64=0x0;_0x19bc64<_0x5c63bb[_0x43ff1b(0x58a)];_0x19bc64++){_0x5de177[_0x19bc64]=_0x5c63bb['charCodeAt'](_0x19bc64);}_0x2b941f=new Blob([_0x5de177]),console[_0x43ff1b(0x57e)](_0x43ff1b(0x66d),_0x2b941f[_0x43ff1b(0xb51)]);}}else _0x2b941f=await _0xc7c5bb[_0x43ff1b(0x128e)](),console['log'](_0x43ff1b(0x75e),_0x2b941f['type'],_0x43ff1b(0x105d),_0x2b941f['size']);if(!_0x567a4f&&_0x2b941f)try{if(typeof JSZip===_0x43ff1b(0x488))throw new Error(_0x43ff1b(0x52a));const _0x432d27=await JSZip[_0x43ff1b(0xaf0)](_0x2b941f);console[_0x43ff1b(0x57e)](_0x43ff1b(0x171),Object[_0x43ff1b(0x1378)](_0x432d27[_0x43ff1b(0x8b1)]));let _0x3a2820=null;for(let _0x5822c6 in _0x432d27[_0x43ff1b(0x8b1)]){if(_0x5822c6[_0x43ff1b(0xba5)](/\.(png|jpg|jpeg|webp)$/i)){_0x3a2820=_0x432d27[_0x43ff1b(0x8b1)][_0x5822c6],console[_0x43ff1b(0x57e)](_0x43ff1b(0x731),_0x5822c6);break;}}if(!_0x3a2820)throw new Error(_0x43ff1b(0x8bb));const _0x31d108=await _0x3a2820['async'](_0x43ff1b(0x128e));console[_0x43ff1b(0x57e)](_0x43ff1b(0x6f0),_0x31d108[_0x43ff1b(0xb51)]);const _0x3fa697=new FileReader();_0x567a4f=await new Promise((_0x1c631f,_0x3cb03c)=>{const _0x5d1a53=_0x43ff1b;_0x3fa697[_0x5d1a53(0x1d8)]=()=>_0x1c631f(_0x3fa697[_0x5d1a53(0xbc9)]),_0x3fa697[_0x5d1a53(0xdf5)]=_0x3cb03c,_0x3fa697[_0x5d1a53(0x21e)](_0x31d108);}),console[_0x43ff1b(0x57e)](_0x43ff1b(0xc7b));}catch(_0x3ea69){console[_0x43ff1b(0x127d)](_0x43ff1b(0x1054),_0x3ea69);throw new Error(_0x43ff1b(0x312)+_0x3ea69[_0x43ff1b(0x11f0)]);}console[_0x43ff1b(0x57e)]('✅\x20NAI图片'+(_0x329ab2+0x1)+_0x43ff1b(0x1122)),_0x37b898[_0x43ff1b(0x1426)](_0x567a4f);}_0x3480e5['imageUrls']=_0x37b898,_0x37b898[_0x43ff1b(0x58a)]===0x1&&(_0x3480e5[_0x43ff1b(0x48d)]=_0x37b898[0x0]),_0x3480e5[_0x43ff1b(0x1063)]=_0x51db46['prompt'],_0x3480e5['imageCount']=_0x37b898[_0x43ff1b(0x58a)],console[_0x43ff1b(0x57e)](_0x43ff1b(0x135a)+_0x37b898[_0x43ff1b(0x58a)]+'张');}catch(_0x14d7d2){console[_0x43ff1b(0x127d)](_0x43ff1b(0xd58),_0x14d7d2),_0x3480e5[_0x43ff1b(0x128c)]=(_0x3480e5['content']||_0x3480e5[_0x43ff1b(0xf1f)]||'')+(_0x43ff1b(0x1004)+_0x14d7d2[_0x43ff1b(0x11f0)]+']');}await _0x3df81a[_0x43ff1b(0x910)][_0x43ff1b(0x6a4)](_0x3480e5),_0xfc0942(_0x496f96+0x1);_0x19db4d&&document[_0x43ff1b(0x1f4)](_0x43ff1b(0x11b5))[_0x43ff1b(0x159b)]['contains'](_0x43ff1b(0x7cf))&&await _0x28d6f7();continue;case _0x43ff1b(0x3ed):{const _0x1d2bfa=await _0x3df81a[_0x43ff1b(0x910)][_0x43ff1b(0x13f8)](parseInt(_0x51db46[_0x43ff1b(0xd8f)]));if(_0x1d2bfa){if(!_0x1d2bfa[_0x43ff1b(0x10ae)])_0x1d2bfa['comments']=[];const _0x152231=_0x51db46[_0x43ff1b(0x5d2)]||_0x55f0fd[_0x43ff1b(0x96f)],_0x21f024=(_0x41b16a,_0x55cb0a=null,_0x1356c1=null)=>({'commenterName':_0x152231,'text':_0x5ed2b0(_0x41b16a,_0x55f0fd),'meaning':_0x55cb0a,'replyTo':_0x1356c1,'timestamp':Date[_0x43ff1b(0xd6e)]()});if(_0x51db46[_0x43ff1b(0xb68)]){const _0x513917=_0x1ae02e['userStickers'][_0x43ff1b(0x13b7)](_0xc604e=>_0xc604e[_0x43ff1b(0x5d2)]===_0x51db46['stickerMeaning']);_0x513917?_0x1d2bfa['comments'][_0x43ff1b(0x1426)](_0x21f024(_0x513917[_0x43ff1b(0x258)],_0x513917['name'],_0x51db46[_0x43ff1b(0xef4)]||null)):(console['warn'](_0x43ff1b(0xe7b)+_0x51db46['stickerMeaning']+'\x22'),_0x1d2bfa[_0x43ff1b(0x10ae)][_0x43ff1b(0x1426)](_0x21f024(_0x43ff1b(0xe39)+_0x51db46[_0x43ff1b(0xb68)]+']',null,_0x51db46['replyTo']||null)));}else{if(Array['isArray'](_0x51db46['comments']))_0x51db46[_0x43ff1b(0x10ae)][_0x43ff1b(0x59b)](_0x1d6a29=>{const _0x56b6a9=_0x43ff1b;typeof _0x1d6a29===_0x56b6a9(0x6c3)&&_0x1d6a29[_0x56b6a9(0x4a2)]()&&_0x1d2bfa[_0x56b6a9(0x10ae)]['push'](_0x21f024(_0x1d6a29,null,_0x51db46['replyTo']||null));});else typeof _0x51db46[_0x43ff1b(0xf6c)]===_0x43ff1b(0x6c3)&&_0x51db46[_0x43ff1b(0xf6c)][_0x43ff1b(0x4a2)]()&&_0x1d2bfa[_0x43ff1b(0x10ae)][_0x43ff1b(0x1426)](_0x21f024(_0x51db46[_0x43ff1b(0xf6c)],null,_0x51db46[_0x43ff1b(0xef4)]||null));}await _0x3df81a[_0x43ff1b(0x910)][_0x43ff1b(0xf18)](_0x1d2bfa['id'],{'comments':_0x1d2bfa[_0x43ff1b(0x10ae)]}),_0xfc0942(_0x496f96+0x1),console[_0x43ff1b(0x57e)](_0x43ff1b(0xc21)+_0x55f0fd[_0x43ff1b(0x5d2)]+_0x43ff1b(0x939)+_0x51db46[_0x43ff1b(0xd8f)]);if(!_0x55f0fd[_0x43ff1b(0x11a8)])_0x55f0fd[_0x43ff1b(0x11a8)]={};_0x55f0fd['commentCooldowns'][_0x51db46['postId']]=Date[_0x43ff1b(0xd6e)]();}continue;}case _0x43ff1b(0x252):const _0x40a32b=await _0x3df81a[_0x43ff1b(0x910)][_0x43ff1b(0x13f8)](parseInt(_0x51db46[_0x43ff1b(0xd8f)]));if(_0x40a32b){if(!_0x40a32b[_0x43ff1b(0xb09)])_0x40a32b[_0x43ff1b(0xb09)]=[];!_0x40a32b[_0x43ff1b(0xb09)][_0x43ff1b(0xe82)](_0x55f0fd['name'])&&(_0x40a32b[_0x43ff1b(0xb09)]['push'](_0x55f0fd[_0x43ff1b(0x5d2)]),await _0x3df81a['qzonePosts']['update'](_0x40a32b['id'],{'likes':_0x40a32b[_0x43ff1b(0xb09)]}),_0xfc0942(_0x496f96+0x1),_0x19db4d&&document[_0x43ff1b(0x1f4)]('qzone-screen')[_0x43ff1b(0x159b)][_0x43ff1b(0xaea)](_0x43ff1b(0x7cf))&&await _0x28d6f7());}continue;case _0x43ff1b(0x1209):{const _0x490301=await _0x3df81a[_0x43ff1b(0x910)][_0x43ff1b(0x13f8)](parseInt(_0x51db46[_0x43ff1b(0xd8f)]));if(_0x490301){const _0x20b013={'type':_0x43ff1b(0x1209),'timestamp':Date[_0x43ff1b(0xd6e)](),'authorId':_0x47dcdb,'authorGroupId':_0x55f0fd[_0x43ff1b(0x67d)],'repostComment':_0x51db46['comment']||'','originalPost':_0x490301,'visibleGroupIds':null};await _0x3df81a['qzonePosts'][_0x43ff1b(0x6a4)](_0x20b013),_0xfc0942(_0x496f96+0x1),console[_0x43ff1b(0x57e)](_0x43ff1b(0xc21)+_0x55f0fd[_0x43ff1b(0x5d2)]+_0x43ff1b(0xe1d)+_0x51db46[_0x43ff1b(0xd8f)]);}continue;}case'video_call_request':!_0x11ced0[_0x43ff1b(0xd51)]&&!_0x11ced0[_0x43ff1b(0x116c)]&&(_0x1ae02e[_0x43ff1b(0x588)]=_0x47dcdb,_0x11ced0['activeChatId']=_0x47dcdb,_0x11ced0[_0x43ff1b(0x116c)]=!![],_0x11ced0[_0x43ff1b(0xd5e)]=_0x55f0fd[_0x43ff1b(0xe83)],_0x11ced0[_0x43ff1b(0x108f)]=_0x51db46['name']||_0x55f0fd[_0x43ff1b(0x5d2)],_0x165339());continue;case'group_call_request':!_0x11ced0[_0x43ff1b(0xd51)]&&!_0x11ced0['isAwaitingResponse']&&(_0x1ae02e['activeChatId']=_0x47dcdb,_0x11ced0['isAwaitingResponse']=!![],_0x11ced0[_0x43ff1b(0xd5e)]=!![],_0x11ced0['initiator']='ai',_0x11ced0[_0x43ff1b(0x108f)]=_0x51db46[_0x43ff1b(0x5d2)],_0x165339());continue;case _0x43ff1b(0x13c6):let _0x1ca3d5;if(_0x55f0fd[_0x43ff1b(0xe83)]){const _0x238c49=_0x55f0fd[_0x43ff1b(0x1402)][_0x43ff1b(0x13b7)](_0x2edf26=>_0x2edf26[_0x43ff1b(0x96f)]===_0x51db46['name']);_0x1ca3d5=_0x238c49?_0x238c49[_0x43ff1b(0xd69)]:_0x51db46[_0x43ff1b(0x5d2)];}else _0x1ca3d5=_0x55f0fd[_0x43ff1b(0x5d2)];const _0xc95576=_0x51db46['suffix']?'\x20'+_0x51db46['suffix'][_0x43ff1b(0x4a2)]():'',_0x59b688=_0x1ca3d5+_0x43ff1b(0x891)+_0xc95576,_0x51c6d8={'role':_0x43ff1b(0x1594),'type':_0x43ff1b(0x1454),'content':_0x59b688,'timestamp':Date[_0x43ff1b(0xd6e)]()};_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x1426)](_0x51c6d8);if(_0x19db4d){const _0x106c1e=document[_0x43ff1b(0x1f4)](_0x43ff1b(0x296));_0x106c1e[_0x43ff1b(0x159b)][_0x43ff1b(0xa9c)](_0x43ff1b(0x1550)),void _0x106c1e['offsetWidth'],_0x106c1e['classList'][_0x43ff1b(0x6a4)](_0x43ff1b(0x1550)),setTimeout(()=>_0x106c1e[_0x43ff1b(0x159b)][_0x43ff1b(0xa9c)](_0x43ff1b(0x1550)),0x1f4),_0x5286f1(_0x51c6d8,_0x55f0fd);}else _0x158e58(_0x47dcdb,_0x59b688);continue;case _0x43ff1b(0x768):_0x55f0fd[_0x43ff1b(0x1589)]['text']=_0x51db46[_0x43ff1b(0xd22)],_0x55f0fd[_0x43ff1b(0x1589)][_0x43ff1b(0x142b)]=_0x51db46['is_busy']||![],_0x55f0fd['status'][_0x43ff1b(0x14d1)]=Date[_0x43ff1b(0xd6e)]();const _0x172a8a={'role':_0x43ff1b(0x1594),'type':_0x43ff1b(0x1454),'content':'['+_0x55f0fd[_0x43ff1b(0x5d2)]+_0x43ff1b(0xf27)+_0x51db46[_0x43ff1b(0xd22)]+']','timestamp':Date[_0x43ff1b(0xd6e)]()};_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x1426)](_0x172a8a);_0x19db4d&&_0x5286f1(_0x172a8a,_0x55f0fd);_0x1033ae();continue;case _0x43ff1b(0x973):_0x8dc426={..._0x374e81,'type':_0x43ff1b(0x973),'content':_0x51db46[_0x43ff1b(0x128c)]};break;case _0x43ff1b(0x6b0):if(_0x5419de[_0x43ff1b(0xd51)]&&_0x5419de[_0x43ff1b(0x588)]===_0x47dcdb){const _0x5df06d=_0x51db46[_0x43ff1b(0x73c)]||_0x51db46[_0x43ff1b(0x693)]||_0x51db46['name'];if(typeof _0x5df06d===_0x43ff1b(0x6c3)&&_0x5df06d[_0x43ff1b(0x4a2)]()){const _0x5a7bf1=_0x5df06d['replace'](/^\[?\d+\]?[\s.-]*/,'')[_0x43ff1b(0x4a2)](),_0x45dff3=_0x5419de[_0x43ff1b(0x560)][_0x43ff1b(0xf2d)](_0x5afc7f=>_0x5afc7f['name'][_0x43ff1b(0x1f7)]()===_0x5a7bf1['toLowerCase']());if(_0x45dff3>-0x1){_0x5c1930(_0x45dff3);const _0x2d12c7=_0x5419de[_0x43ff1b(0x560)][_0x45dff3];let _0x5e029d;if(_0x55f0fd[_0x43ff1b(0xe83)]){const _0xa196aa=_0x55f0fd[_0x43ff1b(0x1402)][_0x43ff1b(0x13b7)](_0x5732cb=>_0x5732cb[_0x43ff1b(0x96f)]===_0x51db46[_0x43ff1b(0x5d2)]);_0x5e029d=_0xa196aa?_0xa196aa[_0x43ff1b(0xd69)]:_0x51db46['name'];}else _0x5e029d=_0x55f0fd[_0x43ff1b(0x5d2)];const _0x2676f7={'role':'system','type':_0x43ff1b(0x1454),'content':_0x43ff1b(0x5d0)+_0x5e029d+_0x43ff1b(0xdf0)+_0x2d12c7[_0x43ff1b(0x5d2)]+_0x43ff1b(0x11dd)+_0x2d12c7[_0x43ff1b(0x1309)]+']','timestamp':Date[_0x43ff1b(0xd6e)]()};_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x1426)](_0x2676f7),_0x19db4d&&_0x5286f1(_0x2676f7,_0x55f0fd);}else console['warn'](_0x43ff1b(0x229)+_0x5df06d+_0x43ff1b(0x14ac)+_0x5a7bf1+'\x22)\x20在播放列表中未找到。');}else console[_0x43ff1b(0x127d)]('AI返回的change_music指令中，歌曲名无效或缺失:',_0x51db46);}continue;case _0x43ff1b(0x363):const _0x552e47={'chatId':_0x47dcdb,'authorId':_0x47dcdb,'description':_0x51db46[_0x43ff1b(0xdec)],'timestamp':Date[_0x43ff1b(0xd6e)](),'type':_0x43ff1b(0x140d)};await _0x3df81a[_0x43ff1b(0x9e3)][_0x43ff1b(0x6a4)](_0x552e47),console['log']('AI\x20\x22'+_0x55f0fd[_0x43ff1b(0x5d2)]+_0x43ff1b(0xa2e),_0x51db46[_0x43ff1b(0xdec)]);continue;case'create_countdown':const _0x2d3e9e=new Date(_0x51db46[_0x43ff1b(0xb4e)]);if(!isNaN(_0x2d3e9e)&&_0x2d3e9e>new Date()){const _0x33f75c={'chatId':_0x47dcdb,'authorId':_0x47dcdb,'description':_0x51db46[_0x43ff1b(0x156f)],'timestamp':Date[_0x43ff1b(0xd6e)](),'type':_0x43ff1b(0x119e),'targetDate':_0x2d3e9e[_0x43ff1b(0x457)]()};await _0x3df81a[_0x43ff1b(0x9e3)][_0x43ff1b(0x6a4)](_0x33f75c),console['log'](_0x43ff1b(0xdbf)+_0x55f0fd[_0x43ff1b(0x5d2)]+'\x22\x20创建了一个新约定:',_0x51db46['title']);}continue;case _0x43ff1b(0x1192):if(!_0x55f0fd['isGroup']){_0x55f0fd['relationship'][_0x43ff1b(0x1589)]=_0x43ff1b(0x29e);const _0x3eba5f={'role':_0x43ff1b(0x1594),'content':_0x43ff1b(0xa2a),'timestamp':Date[_0x43ff1b(0xd6e)](),'isHidden':!![]};_0x55f0fd['history'][_0x43ff1b(0x1426)](_0x3eba5f),await _0x3df81a[_0x43ff1b(0x589)][_0x43ff1b(0x295)](_0x55f0fd);_0x19db4d&&_0x3689f0(_0x47dcdb);_0x1033ae();break;}continue;case _0x43ff1b(0x2c0):!_0x55f0fd['isGroup']&&_0x55f0fd['relationship']?.[_0x43ff1b(0x1589)]==='pending_ai_approval'&&(_0x51db46[_0x43ff1b(0xb83)]==='accept'?(_0x55f0fd[_0x43ff1b(0x13ab)]['status']=_0x43ff1b(0xfe3),_0x8dc426={..._0x374e81,'content':_0x43ff1b(0xdad)}):(_0x55f0fd[_0x43ff1b(0x13ab)][_0x43ff1b(0x1589)]=_0x43ff1b(0x29e),_0x8dc426={..._0x374e81,'content':_0x43ff1b(0x1558)}),_0x55f0fd[_0x43ff1b(0x13ab)][_0x43ff1b(0x8dd)]='');break;case _0x43ff1b(0x7b8):const _0x2ae084=typeof _0x51db46['options']===_0x43ff1b(0x6c3)?_0x51db46[_0x43ff1b(0x2c2)][_0x43ff1b(0x23f)]('\x0a')['filter'](_0x189a9e=>_0x189a9e[_0x43ff1b(0x4a2)]()):Array['isArray'](_0x51db46[_0x43ff1b(0x2c2)])?_0x51db46[_0x43ff1b(0x2c2)]:[];if(_0x2ae084[_0x43ff1b(0x58a)]<0x2)continue;_0x8dc426={..._0x374e81,'type':_0x43ff1b(0x7b8),'question':_0x51db46['question'],'options':_0x2ae084,'votes':{},'isClosed':![]};break;case _0x43ff1b(0x248):{const {itemName:_0x5dc5fb,itemPrice:_0x326d28,image_prompt:_0x48ad02}=_0x51db46;if(_0x5dc5fb&&!isNaN(parseFloat(_0x326d28))&&_0x48ad02){const _0x2ce785=_0x43ff1b(0xe8f)+encodeURIComponent(_0x48ad02);_0x8dc426={..._0x374e81,'type':_0x43ff1b(0x248),'items':[{'name':_0x5dc5fb,'price':parseFloat(_0x326d28),'imageUrl':_0x2ce785,'quantity':0x1}],'total':parseFloat(_0x326d28),'recipients':_0x51db46[_0x43ff1b(0xd62)]||null};}else console[_0x43ff1b(0xb3b)]('AI\x20尝试赠送一个格式不正确的随机礼物:',_0x51db46);break;}case'vote':const _0x531d9d=_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x13b7)](_0x2374e0=>_0x2374e0['timestamp']===_0x51db46[_0x43ff1b(0x9ca)]);_0x531d9d&&!_0x531d9d[_0x43ff1b(0x12cc)]&&(Object[_0x43ff1b(0x1378)](_0x531d9d['votes'])[_0x43ff1b(0x59b)](_0x280fc3=>{const _0x5dac3b=_0x43ff1b,_0x5603b7=_0x531d9d[_0x5dac3b(0xde9)][_0x280fc3][_0x5dac3b(0x621)](_0x51db46['name']);_0x5603b7>-0x1&&_0x531d9d[_0x5dac3b(0xde9)][_0x280fc3][_0x5dac3b(0x30b)](_0x5603b7,0x1);}),!_0x531d9d['votes'][_0x51db46[_0x43ff1b(0x141c)]]&&(_0x531d9d[_0x43ff1b(0xde9)][_0x51db46[_0x43ff1b(0x141c)]]=[]),!_0x531d9d[_0x43ff1b(0xde9)][_0x51db46[_0x43ff1b(0x141c)]][_0x43ff1b(0xe82)](_0x51db46['name'])&&_0x531d9d[_0x43ff1b(0xde9)][_0x51db46['choice']]['push'](_0x51db46[_0x43ff1b(0x5d2)]),_0x19db4d&&_0x3689f0(_0x47dcdb));continue;case _0x43ff1b(0x601):_0x8dc426={..._0x374e81,..._0x51db46,'totalAmount':_0x51db46[_0x43ff1b(0x618)],'claimedBy':{},'isFullyClaimed':![]};_0x51db46[_0x43ff1b(0xe7f)]&&(_0x8dc426[_0x43ff1b(0x14b1)]=_0x51db46[_0x43ff1b(0xe7f)],delete _0x8dc426[_0x43ff1b(0xe7f)]);break;case _0x43ff1b(0xf9a):const _0x314f1e=_0x55f0fd[_0x43ff1b(0xce3)]['find'](_0x170ffd=>_0x170ffd['timestamp']===_0x51db46['packet_timestamp']),_0x4fc29c=_0x51db46[_0x43ff1b(0x5d2)],_0x10fcbb=_0x55f0fd[_0x43ff1b(0x1402)]['some'](_0x29a9c8=>_0x29a9c8[_0x43ff1b(0x96f)]===_0x4fc29c);if(!_0x10fcbb){console['warn']('AI\x20角色\x20\x22'+_0x4fc29c+'\x22\x20尝试领取不属于自己的群聊红包。操作已被拦截。');continue;}if(_0x314f1e&&_0x314f1e[_0x43ff1b(0xcdd)]===_0x43ff1b(0x111e)){if(_0x314f1e['receiverName']!==_0x51db46['name']){console[_0x43ff1b(0xb3b)]('AI\x20角色\x20\x22'+_0x51db46[_0x43ff1b(0x5d2)]+_0x43ff1b(0x105c)+_0x314f1e[_0x43ff1b(0x14b1)]+_0x43ff1b(0x9eb));continue;}}if(_0x314f1e&&!_0x314f1e['isFullyClaimed']&&!(_0x314f1e[_0x43ff1b(0x13d5)]&&_0x314f1e[_0x43ff1b(0x13d5)][_0x51db46[_0x43ff1b(0x5d2)]])){let _0x5be8ec=0x0;const _0x336a75=_0x314f1e['totalAmount']-Object[_0x43ff1b(0x753)](_0x314f1e['claimedBy']||{})[_0x43ff1b(0x7b6)]((_0x30cadc,_0x338afb)=>_0x30cadc+_0x338afb,0x0),_0x4285bc=_0x314f1e[_0x43ff1b(0x13bd)]-Object['keys'](_0x314f1e[_0x43ff1b(0x13d5)]||{})[_0x43ff1b(0x58a)];if(_0x4285bc>0x0){if(_0x314f1e[_0x43ff1b(0xcdd)]===_0x43ff1b(0x111e))_0x5be8ec=_0x314f1e[_0x43ff1b(0x9c3)];else{if(_0x4285bc===0x1)_0x5be8ec=_0x336a75;else{const _0x5349fc=0.01,_0x4d452f=_0x336a75-(_0x4285bc-0x1)*_0x5349fc;_0x5be8ec=Math[_0x43ff1b(0x13ae)]()*(_0x4d452f-_0x5349fc)+_0x5349fc;}}_0x5be8ec=parseFloat(_0x5be8ec[_0x43ff1b(0x24f)](0x2));if(!_0x314f1e[_0x43ff1b(0x13d5)])_0x314f1e[_0x43ff1b(0x13d5)]={};_0x314f1e[_0x43ff1b(0x13d5)][_0x51db46['name']]=_0x5be8ec;const _0x4a9423=_0x55f0fd[_0x43ff1b(0x1402)]['find'](_0x31a026=>_0x31a026[_0x43ff1b(0x96f)]===_0x51db46['name']),_0x14173b=_0x4a9423?_0x4a9423[_0x43ff1b(0xd69)]:_0x51db46[_0x43ff1b(0x5d2)],_0x26eb0a=_0x140540(_0x55f0fd,_0x314f1e['senderName']),_0x5babb6={'role':_0x43ff1b(0x1594),'type':'pat_message','content':_0x14173b+'\x20领取了\x20'+_0x26eb0a+_0x43ff1b(0x1009),'timestamp':Date[_0x43ff1b(0xd6e)]()};_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x1426)](_0x5babb6);let _0x46de6e=_0x43ff1b(0x15ab)+_0x14173b+_0x43ff1b(0xac9)+_0x5be8ec[_0x43ff1b(0x24f)](0x2)+_0x43ff1b(0xd74);if(Object[_0x43ff1b(0x1378)](_0x314f1e[_0x43ff1b(0x13d5)])[_0x43ff1b(0x58a)]>=_0x314f1e[_0x43ff1b(0x13bd)]){_0x314f1e[_0x43ff1b(0x6dd)]=!![];const _0x3e4944={'role':_0x43ff1b(0x1594),'type':_0x43ff1b(0x1454),'content':_0x26eb0a+'\x20的红包已被领完','timestamp':Date[_0x43ff1b(0xd6e)]()+0x1};_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x1426)](_0x3e4944);let _0x3dc243={'name':'','amount':-0x1};_0x314f1e[_0x43ff1b(0xcdd)]===_0x43ff1b(0xd1f)&&_0x314f1e[_0x43ff1b(0x13bd)]>0x1&&Object[_0x43ff1b(0xd20)](_0x314f1e['claimedBy'])[_0x43ff1b(0x59b)](([_0x53f9c9,_0x4fafb6])=>{const _0x1e315f=_0x43ff1b;_0x4fafb6>_0x3dc243[_0x1e315f(0x618)]&&(_0x3dc243={'name':_0x53f9c9,'amount':_0x4fafb6});});if(_0x3dc243[_0x43ff1b(0x5d2)]){const _0x52944f=_0x55f0fd[_0x43ff1b(0x1402)][_0x43ff1b(0x13b7)](_0x33a072=>_0x33a072['originalName']===_0x3dc243['name']),_0x543bd7=_0x52944f?_0x52944f[_0x43ff1b(0xd69)]:_0x3dc243['name'];_0x46de6e+=_0x43ff1b(0x9d9)+_0x543bd7+'！';}else _0x46de6e+=_0x43ff1b(0x276);}_0x46de6e+='\x20请根据这个结果发表你的评论。]';const _0x4e050b={'role':_0x43ff1b(0x1594),'content':_0x46de6e,'timestamp':Date[_0x43ff1b(0xd6e)]()+0x2,'isHidden':!![]};_0x55f0fd['history'][_0x43ff1b(0x1426)](_0x4e050b);}_0x19db4d&&(_0x3689f0(_0x47dcdb),_0x1033ae());}continue;case _0x43ff1b(0xd28):{const _0xc5f311=_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0xf2d)](_0x9c64d2=>_0x9c64d2[_0x43ff1b(0x1388)]===_0x51db46[_0x43ff1b(0x9d7)]);if(_0xc5f311>-0x1){const _0x10c193=_0x55f0fd[_0x43ff1b(0xce3)][_0xc5f311];_0x10c193[_0x43ff1b(0x1589)]=_0x43ff1b(0x11d3);}continue;}case _0x43ff1b(0x1268):{const _0x4adc0d=_0x55f0fd['history'][_0x43ff1b(0xf2d)](_0x293712=>_0x293712[_0x43ff1b(0x1388)]===_0x51db46['for_timestamp']);if(_0x4adc0d>-0x1){const _0x55585f=_0x55f0fd[_0x43ff1b(0xce3)][_0x4adc0d];_0x55585f[_0x43ff1b(0x1589)]='declined';const _0x36bec7={'role':'assistant','senderName':_0x55f0fd[_0x43ff1b(0x5d2)],'type':'transfer','isRefund':!![],'amount':_0x55585f[_0x43ff1b(0x618)],'note':_0x43ff1b(0x2b4),'timestamp':_0x1579b7++};_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x1426)](_0x36bec7),_0x19db4d&&(_0x5286f1(_0x36bec7,_0x55f0fd),_0x3689f0(_0x47dcdb));}continue;}case _0x43ff1b(0xcd8):if(_0x55f0fd[_0x43ff1b(0xe83)]&&_0x51db46['new_name']){const _0x1874a7=_0x51db46[_0x43ff1b(0x3dd)]['trim'](),_0x13471a=_0x55f0fd['members']['map'](_0x5bde9f=>_0x5bde9f[_0x43ff1b(0x96f)]);if(_0x13471a[_0x43ff1b(0xe82)](_0x1874a7)){console[_0x43ff1b(0xb3b)](_0x43ff1b(0x152b)+_0x51db46['name']+_0x43ff1b(0x1320)+_0x1874a7+_0x43ff1b(0x7cb));continue;}_0x55f0fd[_0x43ff1b(0x5d2)]=_0x1874a7;const _0x4afbd3=_0x55f0fd[_0x43ff1b(0x1402)][_0x43ff1b(0x13b7)](_0x2c4e41=>_0x2c4e41[_0x43ff1b(0x96f)]===_0x51db46[_0x43ff1b(0x5d2)]),_0x1b82a7=_0x4afbd3?_0x4afbd3[_0x43ff1b(0xd69)]:_0x51db46['name'],_0x2e4051={'role':_0x43ff1b(0x1594),'type':'pat_message','content':_0x1b82a7+'\x20将群名修改为\x20“'+_0x55f0fd['name']+'”','timestamp':_0x1579b7++};_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x1426)](_0x2e4051),_0x19db4d&&(_0x5286f1(_0x2e4051,_0x55f0fd),document[_0x43ff1b(0x1f4)](_0x43ff1b(0x12a0))[_0x43ff1b(0x231)]=_0x55f0fd[_0x43ff1b(0x5d2)]);}continue;case _0x43ff1b(0x649):if(!_0x55f0fd['isGroup']&&_0x51db46[_0x43ff1b(0x3dd)]){const _0x4dbf65=_0x55f0fd[_0x43ff1b(0x5d2)],_0x27776b=_0x51db46['new_name'][_0x43ff1b(0x4a2)]();if(_0x27776b&&_0x27776b!==_0x4dbf65){!_0x55f0fd['nameHistory']&&(_0x55f0fd[_0x43ff1b(0x1515)]=[]);!_0x55f0fd[_0x43ff1b(0x1515)][_0x43ff1b(0xe82)](_0x4dbf65)&&_0x55f0fd[_0x43ff1b(0x1515)][_0x43ff1b(0x1426)](_0x4dbf65);_0x55f0fd[_0x43ff1b(0x5d2)]=_0x27776b;const _0x40fff5={'role':_0x43ff1b(0x1594),'type':'pat_message','content':'“'+_0x55f0fd[_0x43ff1b(0x96f)]+_0x43ff1b(0x1a1)+_0x27776b+'”','timestamp':_0x1579b7++};_0x55f0fd[_0x43ff1b(0xce3)]['push'](_0x40fff5);const _0x3758a0={'role':_0x43ff1b(0x1594),'content':_0x43ff1b(0x14d3)+_0x27776b+_0x43ff1b(0x11a3),'timestamp':_0x1579b7++,'isHidden':!![]};_0x55f0fd['history']['push'](_0x3758a0),_0x19db4d&&(_0x5286f1(_0x40fff5,_0x55f0fd),document[_0x43ff1b(0x1f4)](_0x43ff1b(0x12a0))['textContent']=_0x27776b),await _0x44799f(_0x55f0fd);}}continue;case _0x43ff1b(0x126d):if(_0x55f0fd['isGroup']&&_0x51db46['avatar_name']){const _0x3a28d0=_0x51db46['avatar_name'],_0x2a0538=_0x55f0fd['settings'][_0x43ff1b(0x1276)]||[],_0x582902=_0x2a0538['find'](_0x1b27dc=>_0x1b27dc[_0x43ff1b(0x5d2)]===_0x3a28d0);if(_0x582902){_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xe46)]=_0x582902[_0x43ff1b(0x258)];const _0x44e129=_0x55f0fd[_0x43ff1b(0x1402)][_0x43ff1b(0x13b7)](_0xe7e518=>_0xe7e518[_0x43ff1b(0x96f)]===_0x51db46[_0x43ff1b(0x5d2)]),_0x3021b4=_0x44e129?_0x44e129[_0x43ff1b(0xd69)]:_0x51db46['name'],_0x20eed2={'role':_0x43ff1b(0x1594),'type':_0x43ff1b(0x1454),'content':_0x3021b4+_0x43ff1b(0x11a2),'timestamp':_0x1579b7++};_0x55f0fd['history'][_0x43ff1b(0x1426)](_0x20eed2),_0x19db4d&&_0x5286f1(_0x20eed2,_0x55f0fd);}else console[_0x43ff1b(0xb3b)](_0x43ff1b(0x1083)+_0x3a28d0+'\x22');}continue;case _0x43ff1b(0xa9b):_0x8dc426={'role':_0x43ff1b(0x1594),'type':_0x43ff1b(0x1454),'content':_0x51db46[_0x43ff1b(0x128c)],'timestamp':Date[_0x43ff1b(0xd6e)]()};break;case _0x43ff1b(0xd9b):_0x8dc426={..._0x374e81,'type':'share_link','title':_0x51db46[_0x43ff1b(0x156f)],'description':_0x51db46[_0x43ff1b(0xdec)],'source_name':_0x51db46[_0x43ff1b(0x115e)],'content':_0x51db46[_0x43ff1b(0x128c)]};break;case _0x43ff1b(0x3d4):const _0x1747cf=_0x55f0fd['history'][_0x43ff1b(0x13b7)](_0x23ea68=>_0x23ea68['timestamp']===_0x51db46['target_timestamp']);if(_0x1747cf){const _0x4d3f2d={'timestamp':_0x1747cf[_0x43ff1b(0x1388)],'senderName':_0x1747cf[_0x43ff1b(0xfb7)]||(_0x1747cf[_0x43ff1b(0xfbb)]===_0x43ff1b(0x860)?_0x55f0fd[_0x43ff1b(0x6a8)][_0x43ff1b(0xe31)]||'我':_0x55f0fd[_0x43ff1b(0x5d2)]),'content':String(_0x1747cf[_0x43ff1b(0x128c)]||'')[_0x43ff1b(0x516)](0x0,0x32)};_0x8dc426={..._0x374e81,'content':_0x51db46['reply_content'],'quote':_0x4d3f2d};}else _0x8dc426={..._0x374e81,'content':_0x51db46[_0x43ff1b(0x976)]};break;case _0x43ff1b(0xf91):{if(!_0x19db4d)continue;const _0x3237b7={..._0x374e81,'content':_0x51db46[_0x43ff1b(0x128c)]},_0x58e629=_0x1c1dfa(_0x3237b7,_0x55f0fd);_0x5286f1(_0x3237b7,_0x55f0fd,!![]),await new Promise(_0x24a43f=>setTimeout(_0x24a43f,Math[_0x43ff1b(0x13ae)]()*0x3e8+0x5dc));const _0x52e17a=document['querySelector'](_0x43ff1b(0x85f)+_0x3237b7[_0x43ff1b(0x1388)]+'\x22]')?.[_0x43ff1b(0x96a)](_0x43ff1b(0x711));if(_0x52e17a){_0x52e17a['classList'][_0x43ff1b(0x6a4)]('recalled-animation'),await new Promise(_0x5e9184=>setTimeout(_0x5e9184,0x12c));const _0x56526a={'role':_0x43ff1b(0x13c0),'senderName':_0x51db46[_0x43ff1b(0x5d2)]||_0x55f0fd[_0x43ff1b(0x5d2)],'type':'recalled_message','content':_0x43ff1b(0x1492),'timestamp':_0x3237b7[_0x43ff1b(0x1388)],'recalledData':{'originalType':'text','originalContent':_0x51db46[_0x43ff1b(0x128c)]}},_0x24e3ba=_0x55f0fd['history'][_0x43ff1b(0xf2d)](_0x174704=>_0x174704['timestamp']===_0x3237b7[_0x43ff1b(0x1388)]);_0x24e3ba>-0x1?_0x55f0fd[_0x43ff1b(0xce3)][_0x24e3ba]=_0x56526a:_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x1426)](_0x56526a);const _0x280c60=await _0x1c1dfa(_0x56526a,_0x55f0fd);document[_0x43ff1b(0x8b9)][_0x43ff1b(0xaea)](_0x52e17a)&&_0x52e17a[_0x43ff1b(0xad7)]['replaceChild'](_0x280c60,_0x52e17a);}continue;}case _0x43ff1b(0x40f):_0x8dc426={..._0x374e81,'content':String(_0x51db46['content']||_0x51db46['message'])};break;case _0x43ff1b(0x1b3):if(_0x51db46[_0x43ff1b(0x339)]){const _0x3cb41a=_0x1ae02e['userStickers'][_0x43ff1b(0x13b7)](_0x70241c=>_0x70241c[_0x43ff1b(0x5d2)]===_0x51db46['meaning']);_0x3cb41a?_0x8dc426={..._0x374e81,'type':_0x43ff1b(0x1b3),'content':_0x3cb41a['url'],'meaning':_0x3cb41a[_0x43ff1b(0x5d2)]}:(console[_0x43ff1b(0xb3b)](_0x43ff1b(0x795)+_0x51db46[_0x43ff1b(0x339)]+'\x22'),_0x8dc426={..._0x374e81,'type':_0x43ff1b(0x40f),'content':_0x43ff1b(0xe39)+_0x51db46[_0x43ff1b(0x339)]+']'});}else console[_0x43ff1b(0xb3b)]('AI\x20发送了一个没有\x20\x27meaning\x27\x20的\x20sticker\x20指令。',_0x51db46),_0x8dc426={..._0x374e81,'type':'sticker','content':_0x51db46['url'],'meaning':_0x43ff1b(0x12bc)};break;case _0x43ff1b(0xce9):_0x8dc426={..._0x374e81,'type':_0x43ff1b(0xce9),'content':_0x51db46[_0x43ff1b(0xdec)],'image_prompt':_0x51db46[_0x43ff1b(0x1248)]};break;case'voice_message':_0x8dc426={..._0x374e81,'type':_0x43ff1b(0xd83),'content':_0x51db46[_0x43ff1b(0x128c)]};break;case _0x43ff1b(0x904):_0x8dc426={..._0x374e81,'type':_0x43ff1b(0x904),'amount':_0x51db46['amount'],'note':_0x51db46[_0x43ff1b(0x10c2)],'receiverName':_0x51db46[_0x43ff1b(0xe7f)]||'我'};break;case _0x43ff1b(0x4a4):_0x8dc426={..._0x374e81,'type':'waimai_request','productInfo':_0x51db46[_0x43ff1b(0xbf5)],'amount':_0x51db46[_0x43ff1b(0x618)],'status':'pending','countdownEndTime':Date[_0x43ff1b(0xd6e)]()+0xf*0x3c*0x3e8};break;case _0x43ff1b(0x14a8):_0x8dc426={..._0x374e81,'type':_0x43ff1b(0x14a8),'productInfo':_0x51db46['productInfo'],'amount':_0x51db46[_0x43ff1b(0x618)],'greeting':_0x51db46[_0x43ff1b(0xc6a)],'recipientName':_0x51db46[_0x43ff1b(0x309)]||null};break;case _0x43ff1b(0x439):_0x8dc426={..._0x374e81,..._0x51db46};break;case _0x43ff1b(0x132a):try{console[_0x43ff1b(0x57e)](_0x43ff1b(0x285),_0x51db46[_0x43ff1b(0x1063)]);const _0x155caf=_0x50a9eb(_0x55f0fd['id']),_0x54133a=_0x51db46[_0x43ff1b(0x1063)]||_0x43ff1b(0xc72),_0x2b070b=_0x54133a+',\x20'+_0x155caf['positive'],_0x13eead=_0x155caf['negative'];console[_0x43ff1b(0x57e)](_0x43ff1b(0x3a3)+(_0x155caf[_0x43ff1b(0xc36)]===_0x43ff1b(0x1381)?'角色专属':'系统')+'提示词配置'),console[_0x43ff1b(0x57e)]('最终正面提示词:',_0x2b070b),console[_0x43ff1b(0x57e)](_0x43ff1b(0xd3b),_0x13eead);const _0x4f12b0=localStorage['getItem'](_0x43ff1b(0x8f7)),_0x36c28c=localStorage[_0x43ff1b(0x587)](_0x43ff1b(0xf6b))||_0x43ff1b(0xf90),_0x3c594c=_0x3b1556();if(!_0x4f12b0)throw new Error(_0x43ff1b(0x34d));const [_0x1a10c3,_0x466596]=_0x3c594c[_0x43ff1b(0xf1c)][_0x43ff1b(0x23f)]('x')[_0x43ff1b(0x1431)](Number);let _0x449ff6;_0x36c28c['includes'](_0x43ff1b(0x3ba))?_0x449ff6={'input':_0x2b070b,'model':_0x36c28c,'action':'generate','parameters':{'params_version':0x3,'width':_0x1a10c3,'height':_0x466596,'scale':_0x3c594c[_0x43ff1b(0x140e)],'sampler':_0x3c594c['sampler'],'steps':_0x3c594c[_0x43ff1b(0x13ad)],'seed':_0x3c594c['seed']===-0x1?Math[_0x43ff1b(0x123c)](Math[_0x43ff1b(0x13ae)]()*0x2540be3ff):_0x3c594c[_0x43ff1b(0x11c2)],'n_samples':0x1,'ucPreset':_0x3c594c[_0x43ff1b(0x826)],'qualityToggle':_0x3c594c[_0x43ff1b(0xc1a)],'autoSmea':![],'dynamic_thresholding':![],'controlnet_strength':0x1,'legacy':![],'add_original_image':!![],'cfg_rescale':0x0,'noise_schedule':_0x43ff1b(0xec0),'legacy_v3_extend':![],'skip_cfg_above_sigma':null,'use_coords':![],'legacy_uc':![],'normalize_reference_strength_multiple':!![],'inpaintImg2ImgStrength':0x1,'characterPrompts':[],'v4_prompt':{'caption':{'base_caption':_0x2b070b,'char_captions':[]},'use_coords':![],'use_order':!![]},'v4_negative_prompt':{'caption':{'base_caption':_0x13eead,'char_captions':[]},'legacy_uc':![]},'negative_prompt':_0x13eead,'deliberate_euler_ancestral_bug':![],'prefer_brownian':!![]}}:_0x449ff6={'input':_0x2b070b,'model':_0x36c28c,'action':_0x43ff1b(0xb45),'parameters':{'width':_0x1a10c3,'height':_0x466596,'scale':_0x3c594c['cfg_scale'],'sampler':_0x3c594c['sampler'],'steps':_0x3c594c[_0x43ff1b(0x13ad)],'seed':_0x3c594c[_0x43ff1b(0x11c2)]===-0x1?Math[_0x43ff1b(0x123c)](Math[_0x43ff1b(0x13ae)]()*0x2540be3ff):_0x3c594c['seed'],'n_samples':0x1,'ucPreset':_0x3c594c[_0x43ff1b(0x826)],'qualityToggle':_0x3c594c[_0x43ff1b(0xc1a)],'sm':_0x3c594c['smea'],'sm_dyn':_0x3c594c[_0x43ff1b(0x353)],'dynamic_thresholding':![],'controlnet_strength':0x1,'legacy':![],'add_original_image':![],'cfg_rescale':0x0,'noise_schedule':_0x43ff1b(0x26e),'negative_prompt':_0x13eead}};console[_0x43ff1b(0x57e)](_0x43ff1b(0x3d5),_0x449ff6);let _0x15cc95;_0x36c28c[_0x43ff1b(0xe82)](_0x43ff1b(0x3ba))?_0x15cc95='https://image.novelai.net/ai/generate-image-stream':_0x15cc95='https://image.novelai.net/ai/generate-image';let _0x4c416a=_0x3c594c[_0x43ff1b(0x4fd)];_0x4c416a===_0x43ff1b(0xb42)&&(_0x4c416a=_0x3c594c[_0x43ff1b(0x703)]||'');_0x4c416a&&_0x4c416a!==''&&(_0x15cc95=_0x4c416a+encodeURIComponent(_0x15cc95));const _0xb5b036=await fetch(_0x15cc95,{'method':_0x43ff1b(0x12d9),'headers':{'Content-Type':_0x43ff1b(0xa90),'Authorization':'Bearer\x20'+_0x4f12b0},'body':JSON[_0x43ff1b(0x994)](_0x449ff6)});console[_0x43ff1b(0x57e)](_0x43ff1b(0x79e),_0xb5b036['status']),console[_0x43ff1b(0x57e)](_0x43ff1b(0xb1d),[..._0xb5b036[_0x43ff1b(0x3de)][_0x43ff1b(0xd20)]()]);if(!_0xb5b036['ok']){const _0x4cbc2e=await _0xb5b036[_0x43ff1b(0x40f)]();console[_0x43ff1b(0x127d)](_0x43ff1b(0xf01),_0x4cbc2e);throw new Error(_0x43ff1b(0x14ef)+_0xb5b036[_0x43ff1b(0x1589)]+_0x43ff1b(0x126a)+_0x4cbc2e);}const _0x412b0d=_0xb5b036[_0x43ff1b(0x3de)][_0x43ff1b(0x13f8)](_0x43ff1b(0xded));console['log'](_0x43ff1b(0x106d),_0x412b0d);let _0x5d9b15,_0x402376;if(_0x412b0d&&_0x412b0d[_0x43ff1b(0xe82)](_0x43ff1b(0x9a9))){console[_0x43ff1b(0x57e)](_0x43ff1b(0x10e6));const _0x49f8a6=await _0xb5b036[_0x43ff1b(0x40f)]();console[_0x43ff1b(0x57e)](_0x43ff1b(0x9b1),_0x49f8a6[_0x43ff1b(0x58a)]);const _0x5a3e9f=_0x49f8a6[_0x43ff1b(0x4a2)]()['split']('\x0a');let _0x55b747=null;for(let _0x58603c=_0x5a3e9f[_0x43ff1b(0x58a)]-0x1;_0x58603c>=0x0;_0x58603c--){const _0x2b8184=_0x5a3e9f[_0x58603c]['trim']();if(_0x2b8184[_0x43ff1b(0xebf)](_0x43ff1b(0xabd))&&_0x2b8184!=='data:\x20[DONE]'){const _0x4986e4=_0x2b8184[_0x43ff1b(0x516)](0x6);try{const _0x289b62=JSON[_0x43ff1b(0x129c)](_0x4986e4);if(_0x289b62[_0x43ff1b(0x1210)]===_0x43ff1b(0x830)&&_0x289b62[_0x43ff1b(0x685)]){_0x55b747=_0x289b62['image'],console['log']('✅\x20找到\x20final\x20事件的图片数据');break;}if(_0x289b62[_0x43ff1b(0xc6b)]){_0x55b747=_0x289b62[_0x43ff1b(0xc6b)],console['log'](_0x43ff1b(0x2de));break;}if(_0x289b62[_0x43ff1b(0x685)]){_0x55b747=_0x289b62[_0x43ff1b(0x685)],console['log'](_0x43ff1b(0xa42));break;}}catch(_0x4ff5e9){_0x55b747=_0x4986e4,console[_0x43ff1b(0x57e)](_0x43ff1b(0x784));break;}}}if(!_0x55b747)throw new Error(_0x43ff1b(0x43b));const _0x7c1ce2=_0x55b747[_0x43ff1b(0xebf)]('iVBORw0KGgo'),_0x249eed=_0x55b747[_0x43ff1b(0xebf)](_0x43ff1b(0x574));if(_0x7c1ce2||_0x249eed){console[_0x43ff1b(0x57e)](_0x43ff1b(0xccb));const _0x508928=atob(_0x55b747),_0x2d18b3=new Uint8Array(_0x508928[_0x43ff1b(0x58a)]);for(let _0x137c66=0x0;_0x137c66<_0x508928[_0x43ff1b(0x58a)];_0x137c66++){_0x2d18b3[_0x137c66]=_0x508928[_0x43ff1b(0x109b)](_0x137c66);}const _0x5c4a91=new Blob([_0x2d18b3],{'type':_0x7c1ce2?_0x43ff1b(0xdce):_0x43ff1b(0x37b)});console[_0x43ff1b(0x57e)]('图片\x20Blob\x20创建成功，大小:',_0x5c4a91[_0x43ff1b(0xb51)]);const _0x6cadd9=new FileReader();_0x402376=await new Promise((_0x2898df,_0xd7dade)=>{const _0x359d78=_0x43ff1b;_0x6cadd9['onloadend']=()=>_0x2898df(_0x6cadd9[_0x359d78(0xbc9)]),_0x6cadd9[_0x359d78(0xdf5)]=_0xd7dade,_0x6cadd9[_0x359d78(0x21e)](_0x5c4a91);}),console[_0x43ff1b(0x57e)](_0x43ff1b(0xb33));}else{console[_0x43ff1b(0x57e)]('当作\x20ZIP\x20文件处理...');const _0x41724f=atob(_0x55b747),_0x42d537=new Uint8Array(_0x41724f[_0x43ff1b(0x58a)]);for(let _0x36ede4=0x0;_0x36ede4<_0x41724f[_0x43ff1b(0x58a)];_0x36ede4++){_0x42d537[_0x36ede4]=_0x41724f['charCodeAt'](_0x36ede4);}_0x5d9b15=new Blob([_0x42d537]),console[_0x43ff1b(0x57e)](_0x43ff1b(0x66d),_0x5d9b15[_0x43ff1b(0xb51)]);}}else _0x5d9b15=await _0xb5b036[_0x43ff1b(0x128e)](),console[_0x43ff1b(0x57e)](_0x43ff1b(0x75e),_0x5d9b15['type'],_0x43ff1b(0x105d),_0x5d9b15[_0x43ff1b(0xb51)]);if(!_0x402376&&_0x5d9b15)try{if(typeof JSZip===_0x43ff1b(0x488))throw new Error(_0x43ff1b(0x52a));const _0x4a1230=await JSZip[_0x43ff1b(0xaf0)](_0x5d9b15);console['log']('ZIP文件内容:',Object[_0x43ff1b(0x1378)](_0x4a1230[_0x43ff1b(0x8b1)]));let _0x15ae81=null;for(let _0x340b88 in _0x4a1230[_0x43ff1b(0x8b1)]){if(_0x340b88[_0x43ff1b(0xba5)](/\.(png|jpg|jpeg|webp)$/i)){_0x15ae81=_0x4a1230[_0x43ff1b(0x8b1)][_0x340b88],console['log'](_0x43ff1b(0x731),_0x340b88);break;}}if(!_0x15ae81)throw new Error(_0x43ff1b(0x8bb));const _0x4da632=await _0x15ae81[_0x43ff1b(0x8e3)](_0x43ff1b(0x128e));console[_0x43ff1b(0x57e)](_0x43ff1b(0x6f0),_0x4da632['size']);const _0x58d639=new FileReader();_0x402376=await new Promise((_0x1896b4,_0x2b9e55)=>{const _0x5911f1=_0x43ff1b;_0x58d639['onloadend']=()=>_0x1896b4(_0x58d639[_0x5911f1(0xbc9)]),_0x58d639[_0x5911f1(0xdf5)]=_0x2b9e55,_0x58d639[_0x5911f1(0x21e)](_0x4da632);}),console['log'](_0x43ff1b(0xc7b));}catch(_0x24d7cf){console[_0x43ff1b(0x127d)](_0x43ff1b(0x1054),_0x24d7cf);throw new Error('图片解压失败:\x20'+_0x24d7cf[_0x43ff1b(0x11f0)]);}console[_0x43ff1b(0x57e)](_0x43ff1b(0x100d)),_0x8dc426={..._0x374e81,'type':_0x43ff1b(0x132a),'imageUrl':_0x402376,'prompt':_0x54133a,'fullPrompt':_0x2b070b};}catch(_0x374c68){console[_0x43ff1b(0x127d)](_0x43ff1b(0x136b),_0x374c68),_0x8dc426={..._0x374e81,'content':_0x43ff1b(0x1047)+_0x374c68['message']+']'};}break;default:console[_0x43ff1b(0xb3b)]('收到了未知的AI指令类型:',_0x51db46['type']);break;}if(_0x8dc426){_0x55f0fd[_0x43ff1b(0xce3)][_0x43ff1b(0x1426)](_0x8dc426);!_0x19db4d&&(_0x55f0fd['unreadCount']=(_0x55f0fd[_0x43ff1b(0xf2c)]||0x0)+0x1);if(!_0x19db4d&&!_0x3be1bf){let _0x39dfcd;switch(_0x8dc426['type']){case _0x43ff1b(0x904):_0x39dfcd=_0x43ff1b(0xa00);break;case _0x43ff1b(0x4a4):_0x39dfcd='[收到一个外卖代付请求]';break;case _0x43ff1b(0xce9):_0x39dfcd='[图片]';break;case'voice_message':_0x39dfcd=_0x43ff1b(0x57d);break;case _0x43ff1b(0x1b3):_0x39dfcd=_0x8dc426[_0x43ff1b(0x339)]?'[表情:\x20'+_0x8dc426[_0x43ff1b(0x339)]+']':_0x43ff1b(0x486);break;case _0x43ff1b(0x439):_0x39dfcd=_0x8dc426[_0x43ff1b(0xdf2)]?'「'+_0x8dc426[_0x43ff1b(0xdf2)]+'」':'['+_0x8dc426[_0x43ff1b(0xdec)]['substring'](0x0,0x14)+_0x43ff1b(0xe30);break;default:_0x39dfcd=String(_0x8dc426[_0x43ff1b(0x128c)]||'');}const _0x4e5e25=_0x55f0fd[_0x43ff1b(0xe83)]?_0x8dc426[_0x43ff1b(0xfb7)]+':\x20'+_0x39dfcd:_0x39dfcd;_0x158e58(_0x47dcdb,_0x4e5e25[_0x43ff1b(0x516)](0x0,0x28)+(_0x4e5e25[_0x43ff1b(0x58a)]>0x28?_0x43ff1b(0x629):'')),_0x3be1bf=!![];}_0x19db4d&&(_0x5286f1(_0x8dc426,_0x55f0fd),await new Promise(_0x3ab809=>setTimeout(_0x3ab809,Math['random']()*0x708+0x3e8)));}}_0x128406&&_0x11ced0[_0x43ff1b(0xd5e)]&&(_0x11ced0[_0x43ff1b(0x116c)]=![],_0x11ced0[_0x43ff1b(0x1059)][_0x43ff1b(0x58a)]>0x0?_0xeb5668():(_0x11ced0={..._0x11ced0,'isAwaitingResponse':![],'participants':[]},_0x2e53fa(_0x43ff1b(0x13c3)),alert('无人接听群聊邀请。')));if(_0x36ed5b){await _0x5626da();return;}await _0x3df81a[_0x43ff1b(0x589)][_0x43ff1b(0x295)](_0x55f0fd);const _0x56a557=_0xac9027['some'](_0x53848a=>_0x53848a[_0x43ff1b(0xcbd)]==='qzone_post'||_0x53848a[_0x43ff1b(0xcbd)]===_0x43ff1b(0x252)||_0x53848a['type']===_0x43ff1b(0x3ed)||_0x53848a[_0x43ff1b(0xcbd)]===_0x43ff1b(0x1209));_0x56a557&&(console[_0x43ff1b(0x57e)](_0x43ff1b(0x562)),await _0x28d6f7());}catch(_0x39ac67){_0x55f0fd[_0x43ff1b(0xce3)]=_0x55f0fd[_0x43ff1b(0xce3)]['filter'](_0x23fabd=>!_0x23fabd['isTemporary']),!_0x55f0fd['isGroup']&&_0x55f0fd['relationship']?.[_0x43ff1b(0x1589)]===_0x43ff1b(0x1100)?(_0x55f0fd[_0x43ff1b(0x13ab)][_0x43ff1b(0x1589)]=_0x43ff1b(0x29e),await _0x1460c5(_0x43ff1b(0xa5b),_0x43ff1b(0x39a)+_0x39ac67[_0x43ff1b(0x11f0)])):await _0x1460c5(_0x43ff1b(0x1394),_0x43ff1b(0x4aa)+_0x39ac67[_0x43ff1b(0x11f0)]),!_0x55f0fd['isGroup']&&_0x55f0fd['relationship']?.[_0x43ff1b(0x1589)]===_0x43ff1b(0x29e)&&await _0x3df81a['chats']['put'](_0x55f0fd),_0x11ced0['isAwaitingResponse']=![];}finally{_0x450e6f(_0x47dcdb,![]),_0x55f0fd['isGroup']?_0x2f91c9&&(_0x2f91c9[_0x43ff1b(0x215)][_0x43ff1b(0x887)]=_0x43ff1b(0x1b5)):_0x550c06&&_0x1ae02e[_0x43ff1b(0x589)][_0x47dcdb]&&(_0x550c06[_0x43ff1b(0x215)][_0x43ff1b(0x38d)]=0x0,setTimeout(()=>{const _0x154364=_0x43ff1b;_0x550c06[_0x154364(0x231)]=_0x1ae02e[_0x154364(0x589)][_0x47dcdb][_0x154364(0x5d2)],_0x550c06[_0x154364(0x159b)][_0x154364(0xa9c)](_0x154364(0x5cd)),_0x550c06[_0x154364(0x215)]['opacity']=0x1;},0xc8)),_0x1033ae(),_0x127eed&&_0x10f791(_0x47dcdb),_0x12ea3e();}}async function _0x3e11f8(_0x3b6a7a){const _0x3eb2c9=_0x2b1222;if(!_0x1ae02e[_0x3eb2c9(0x588)])return;const _0x102937=_0x1ae02e['chats'][_0x1ae02e['activeChatId']],_0x527937={'role':_0x3eb2c9(0x860),'content':_0x3b6a7a[_0x3eb2c9(0x258)],'meaning':_0x3b6a7a[_0x3eb2c9(0x5d2)],'timestamp':Date[_0x3eb2c9(0xd6e)]()};_0x102937[_0x3eb2c9(0xce3)][_0x3eb2c9(0x1426)](_0x527937),await _0x3df81a[_0x3eb2c9(0x589)][_0x3eb2c9(0x295)](_0x102937),_0x5286f1(_0x527937,_0x102937),_0x1033ae(),document[_0x3eb2c9(0x1f4)]('sticker-panel')['classList'][_0x3eb2c9(0xa9c)](_0x3eb2c9(0xfca));}async function _0x43f2fd(){const _0x36293a=_0x2b1222;if(!_0x1ae02e[_0x36293a(0x588)])return;const _0x3024c2=document[_0x36293a(0x1f4)](_0x36293a(0x1112)),_0x3f45f6=document[_0x36293a(0x1f4)]('transfer-note'),_0xee6231=parseFloat(_0x3024c2[_0x36293a(0x107e)]),_0x30ff69=_0x3f45f6[_0x36293a(0x107e)][_0x36293a(0x4a2)]();if(isNaN(_0xee6231)||_0xee6231<0x0){alert(_0x36293a(0x174));return;}const _0x53ce2a=_0x1ae02e[_0x36293a(0x589)][_0x1ae02e[_0x36293a(0x588)]],_0x40557d=_0x53ce2a[_0x36293a(0xe83)]?_0x53ce2a[_0x36293a(0x6a8)][_0x36293a(0xe31)]||'我':'我',_0x323323=_0x53ce2a[_0x36293a(0xe83)]?'群聊':_0x53ce2a['name'],_0x61db5f={'role':'user','type':_0x36293a(0x904),'amount':_0xee6231,'note':_0x30ff69,'senderName':_0x40557d,'receiverName':_0x323323,'timestamp':Date[_0x36293a(0xd6e)]()};_0x53ce2a[_0x36293a(0xce3)]['push'](_0x61db5f),await _0x3df81a[_0x36293a(0x589)]['put'](_0x53ce2a),_0x5286f1(_0x61db5f,_0x53ce2a),_0x1033ae(),document[_0x36293a(0x1f4)](_0x36293a(0xf14))[_0x36293a(0x159b)][_0x36293a(0xa9c)](_0x36293a(0xfca)),_0x3024c2[_0x36293a(0x107e)]='',_0x3f45f6['value']='';}async function _0x42dd6(){const _0x21aa43=_0x2b1222;if(!_0x1ae02e['activeChatId'])return;const _0x2c8130=document[_0x21aa43(0x1f4)](_0x21aa43(0xe90)),_0x2f5105=document[_0x21aa43(0x1f4)](_0x21aa43(0x1cd)),_0x23c2d9=_0x2c8130['value'][_0x21aa43(0x4a2)](),_0x428d6f=parseFloat(_0x2f5105[_0x21aa43(0x107e)]);if(!_0x23c2d9||isNaN(_0x428d6f)||_0x428d6f<=0x0){alert(_0x21aa43(0xc2d));return;}const _0x51541e=_0x1ae02e['chats'][_0x1ae02e[_0x21aa43(0x588)]],_0x20e619=Date[_0x21aa43(0xd6e)](),_0x3dbbdb=_0x51541e[_0x21aa43(0xe83)]?_0x51541e['settings'][_0x21aa43(0xe31)]||'我':'我',_0x40db63={'role':_0x21aa43(0x860),'senderName':_0x3dbbdb,'type':_0x21aa43(0x14a8),'productInfo':_0x23c2d9,'amount':_0x428d6f,'timestamp':_0x20e619};_0x51541e[_0x21aa43(0xce3)][_0x21aa43(0x1426)](_0x40db63);const _0x379543={'role':_0x21aa43(0x1594),'content':_0x21aa43(0x4bd)+_0x3dbbdb+_0x21aa43(0x1261)+_0x23c2d9+_0x21aa43(0x775)+_0x428d6f+_0x21aa43(0xea3),'timestamp':_0x20e619+0x1,'isHidden':!![]};_0x51541e['history'][_0x21aa43(0x1426)](_0x379543),await _0x3df81a[_0x21aa43(0x589)][_0x21aa43(0x295)](_0x51541e),_0x5286f1(_0x40db63,_0x51541e),_0x1033ae(),_0x2c8130['value']='',_0x2f5105[_0x21aa43(0x107e)]='',document[_0x21aa43(0x1f4)](_0x21aa43(0xb67))[_0x21aa43(0x159b)][_0x21aa43(0xa9c)](_0x21aa43(0xfca));}async function _0x1fcca0(){const _0x5aeb9e=_0x2b1222;if(!_0x1ae02e[_0x5aeb9e(0x588)])return;const _0x5a6484=await _0x11f6fb(_0x5aeb9e(0xf79),'你现在在哪里呀？','');if(!_0x5a6484||!_0x5a6484[_0x5aeb9e(0x4a2)]())return;const _0x485b2b=_0x5aeb9e(0x5e8),_0x324344=_0x1ae02e[_0x5aeb9e(0x589)][_0x1ae02e[_0x5aeb9e(0x588)]],_0x618e0a={'role':_0x5aeb9e(0x860),'type':_0x5aeb9e(0x973),'content':_0x5a6484[_0x5aeb9e(0x4a2)](),'imageUrl':_0x485b2b,'timestamp':Date['now']()};_0x324344[_0x5aeb9e(0xce3)][_0x5aeb9e(0x1426)](_0x618e0a),await _0x3df81a[_0x5aeb9e(0x589)][_0x5aeb9e(0x295)](_0x324344),_0x5286f1(_0x618e0a,_0x324344),_0x1033ae();}function _0x15b4f1(_0x8c6901){const _0xdd4177=_0x2b1222;if(_0x50ca2c)return;_0x50ca2c=!![],document[_0xdd4177(0x1f4)](_0xdd4177(0x13c3))[_0xdd4177(0x159b)][_0xdd4177(0x6a4)]('selection-mode'),_0x52f5ce(_0x8c6901);}function _0x527427(){const _0x3f6b5c=_0x2b1222;_0x3829aa();if(!_0x50ca2c)return;_0x50ca2c=![],document[_0x3f6b5c(0x1f4)](_0x3f6b5c(0x13c3))[_0x3f6b5c(0x159b)][_0x3f6b5c(0xa9c)](_0x3f6b5c(0x11d7)),_0xc320bf[_0x3f6b5c(0x59b)](_0x3e1dce=>{const _0x17d3de=_0x3f6b5c,_0x473c70=document[_0x17d3de(0xeda)](_0x17d3de(0x85f)+_0x3e1dce+'\x22]');if(_0x473c70)_0x473c70[_0x17d3de(0x159b)][_0x17d3de(0xa9c)](_0x17d3de(0xc3e));}),_0xc320bf[_0x3f6b5c(0x411)]();}function _0x52f5ce(_0x43f2d2){const _0x478dc5=_0x2b1222,_0x13fc34=document['querySelector']('.message-bubble[data-timestamp=\x22'+_0x43f2d2+'\x22]');if(!_0x13fc34)return;_0xc320bf[_0x478dc5(0xe75)](_0x43f2d2)?(_0xc320bf['delete'](_0x43f2d2),_0x13fc34['classList']['remove'](_0x478dc5(0xc3e))):(_0xc320bf[_0x478dc5(0x6a4)](_0x43f2d2),_0x13fc34[_0x478dc5(0x159b)][_0x478dc5(0x6a4)](_0x478dc5(0xc3e))),document['getElementById']('selection-count')[_0x478dc5(0x231)]=_0x478dc5(0xe9b)+_0xc320bf['size']+'\x20条',_0xc320bf['size']===0x0&&_0x527427();}function _0x1160f3(_0x4764be,_0x4ea9cf){const _0x581dfb=_0x2b1222;let _0x2ac4e0;const _0x233ff9=_0x3598cf=>{const _0x5e92d1=_0x475c;if(_0x50ca2c)return;_0x3598cf[_0x5e92d1(0x32e)](),_0x2ac4e0=window[_0x5e92d1(0x42e)](()=>_0x4ea9cf(_0x3598cf),0x1f4);},_0x49af89=()=>clearTimeout(_0x2ac4e0);_0x4764be[_0x581dfb(0x122b)](_0x581dfb(0x103d),_0x233ff9),_0x4764be[_0x581dfb(0x122b)](_0x581dfb(0x3e4),_0x49af89),_0x4764be['addEventListener'](_0x581dfb(0x120f),_0x49af89),_0x4764be[_0x581dfb(0x122b)](_0x581dfb(0x158c),_0x233ff9,{'passive':!![]}),_0x4764be[_0x581dfb(0x122b)](_0x581dfb(0x4f5),_0x49af89),_0x4764be[_0x581dfb(0x122b)](_0x581dfb(0xa92),_0x49af89);}async function _0x2e7bad(){const _0x3ca5f4=_0x2b1222,_0x2be44e=_0x1ae02e[_0x3ca5f4(0x588)];if(!_0x2be44e)return;if(!_0x5419de[_0x3ca5f4(0xd51)]){_0x3f3a2f(_0x2be44e);return;}if(_0x5419de[_0x3ca5f4(0x588)]===_0x2be44e)document[_0x3ca5f4(0x1f4)](_0x3ca5f4(0x1377))[_0x3ca5f4(0x159b)][_0x3ca5f4(0x6a4)](_0x3ca5f4(0xfca));else{const _0x5c817b=_0x1ae02e[_0x3ca5f4(0x589)][_0x5419de[_0x3ca5f4(0x588)]]?.[_0x3ca5f4(0x5d2)]||'未知',_0x58b810=_0x1ae02e[_0x3ca5f4(0x589)][_0x2be44e]?.[_0x3ca5f4(0x5d2)]||'当前',_0x4434b0=await _0x109970('切换听歌对象',_0x3ca5f4(0x729)+_0x5c817b+_0x3ca5f4(0xc96)+_0x58b810+_0x3ca5f4(0x5f4),{'confirmButtonClass':_0x3ca5f4(0x1c6)});_0x4434b0&&(await _0x33c89f(!![]),await new Promise(_0x3b5758=>setTimeout(_0x3b5758,0x32)),_0x3f3a2f(_0x2be44e));}}async function _0x3f3a2f(_0x36a481){const _0x293b70=_0x2b1222,_0x4edf89=_0x1ae02e[_0x293b70(0x589)][_0x36a481];if(!_0x4edf89)return;_0x5419de['totalElapsedTime']=_0x4edf89[_0x293b70(0x822)][_0x293b70(0x155e)]||0x0,_0x5419de[_0x293b70(0xd51)]=!![],_0x5419de['activeChatId']=_0x36a481;_0x5419de[_0x293b70(0x560)][_0x293b70(0x58a)]>0x0?_0x5419de[_0x293b70(0x541)]=0x0:_0x5419de['currentIndex']=-0x1;if(_0x5419de[_0x293b70(0x15a5)])clearInterval(_0x5419de['timerId']);_0x5419de['timerId']=setInterval(()=>{const _0xd5dacc=_0x293b70;_0x5419de[_0xd5dacc(0x14ce)]&&(_0x5419de[_0xd5dacc(0x3a5)]++,_0x3fb3db());},0x3e8),_0x5d7946(),_0x13c03f(),document['getElementById']('music-player-overlay')['classList'][_0x293b70(0x6a4)]('visible');}async function _0x33c89f(_0x11a844=!![]){const _0x42371f=_0x2b1222;if(!_0x5419de['isActive'])return;const _0x567416=_0x5419de[_0x42371f(0x588)];document[_0x42371f(0x1f4)](_0x42371f(0x369))['classList'][_0x42371f(0xa9c)](_0x42371f(0xfca));const _0x368e5b=async()=>{const _0x4aa4de=_0x42371f;if(_0x5419de['timerId'])clearInterval(_0x5419de[_0x4aa4de(0x15a5)]);if(_0x5419de[_0x4aa4de(0x14ce)])_0x43beab[_0x4aa4de(0x352)]();if(_0x11a844&&_0x567416&&_0x1ae02e[_0x4aa4de(0x589)][_0x567416]){const _0x36484f=_0x1ae02e[_0x4aa4de(0x589)][_0x567416];_0x36484f[_0x4aa4de(0x822)][_0x4aa4de(0x155e)]=_0x5419de['totalElapsedTime'],await _0x3df81a[_0x4aa4de(0x589)]['put'](_0x36484f);}_0x5419de['isActive']=![],_0x5419de['activeChatId']=null,_0x5419de[_0x4aa4de(0x3a5)]=0x0,_0x5419de[_0x4aa4de(0x15a5)]=null,_0x1bbcae(_0x567416,!![]);};_0x3dfe58(_0x368e5b);}function _0x3d1c84(){_0x3dfe58();}function _0x1bbcae(_0x15c7de,_0x57e5e1=![]){const _0x26eb21=_0x2b1222,_0x27f77e=document[_0x26eb21(0xeda)](_0x26eb21(0x454));if(!_0x27f77e)return;if(_0x57e5e1||!_0x5419de[_0x26eb21(0xd51)]||_0x5419de[_0x26eb21(0x588)]!==_0x15c7de){_0x27f77e[_0x26eb21(0x9fe)]='https://i.postimg.cc/8kYShvrJ/90-UI-2.png',_0x27f77e[_0x26eb21(0x7c6)]='';return;}_0x27f77e[_0x26eb21(0x9fe)]='https://i.postimg.cc/D0pq6qS2/E30078-DC-8-B99-4-C01-AFDA-74728-DBF7-BEA.png',_0x27f77e[_0x26eb21(0x159b)][_0x26eb21(0x6a4)](_0x26eb21(0xa7a));if(_0x5419de[_0x26eb21(0x14ce)])_0x27f77e['classList']['remove']('paused');else _0x27f77e[_0x26eb21(0x159b)][_0x26eb21(0x6a4)](_0x26eb21(0x2e0));}window[_0x2b1222(0x824)]=_0x1bbcae;function _0x5d7946(){const _0xb57ee7=_0x2b1222;_0x1bbcae(_0x5419de[_0xb57ee7(0x588)]),_0x3fb3db();const _0x3135ba=document[_0xb57ee7(0x1f4)](_0xb57ee7(0xa1d)),_0x502d27=document[_0xb57ee7(0x1f4)](_0xb57ee7(0x101c)),_0xeb587e=document['getElementById'](_0xb57ee7(0xdde));if(_0x5419de['currentIndex']>-0x1&&_0x5419de[_0xb57ee7(0x560)][_0xb57ee7(0x58a)]>0x0){const _0x5dc3fc=_0x5419de['playlist'][_0x5419de[_0xb57ee7(0x541)]];_0x3135ba[_0xb57ee7(0x231)]=_0x5dc3fc['name'],_0x502d27['textContent']=_0x5dc3fc[_0xb57ee7(0x1309)];}else _0x3135ba[_0xb57ee7(0x231)]=_0xb57ee7(0x1352),_0x502d27['textContent']=_0xb57ee7(0x629);_0xeb587e[_0xb57ee7(0x231)]=_0x5419de[_0xb57ee7(0x14ce)]?'❚❚':'▶';}function _0x3fb3db(){const _0x45f792=_0x2b1222,_0x3301e7=(_0x5419de['totalElapsedTime']/0xe10)['toFixed'](0x1);document['getElementById'](_0x45f792(0x1d4))[_0x45f792(0x231)]=_0x45f792(0x100b)+_0x3301e7+'小时';}function _0x13c03f(){const _0x54c91e=_0x2b1222,_0x276c41=document['getElementById'](_0x54c91e(0x28c));_0x276c41[_0x54c91e(0xf21)]='';if(_0x5419de[_0x54c91e(0x560)][_0x54c91e(0x58a)]===0x0){_0x276c41[_0x54c91e(0xf21)]='<p\x20style=\x22text-align:center;\x20padding:\x2020px;\x20color:\x20#888;\x22>播放列表是空的~</p>';return;}_0x5419de[_0x54c91e(0x560)]['forEach']((_0x3a77b5,_0xba7ae3)=>{const _0x535e3e=_0x54c91e,_0x22aa47=document['createElement']('div');_0x22aa47[_0x535e3e(0x7c6)]=_0x535e3e(0x593);if(_0xba7ae3===_0x5419de[_0x535e3e(0x541)])_0x22aa47['classList'][_0x535e3e(0x6a4)](_0x535e3e(0xd0b));_0x22aa47[_0x535e3e(0xf21)]=_0x535e3e(0xdc4)+_0x3a77b5[_0x535e3e(0x5d2)]+_0x535e3e(0x351)+_0x3a77b5[_0x535e3e(0x1309)]+_0x535e3e(0xd76)+_0xba7ae3+_0x535e3e(0x321)+_0xba7ae3+_0x535e3e(0x674)+_0xba7ae3+_0x535e3e(0xfcd)+_0xba7ae3+'\x22>×</span>\x0a\x20\x20\x20\x20</div>\x0a',_0x22aa47['querySelector']('.playlist-item-info')[_0x535e3e(0x122b)](_0x535e3e(0x740),()=>_0x5c1930(_0xba7ae3)),_0x276c41[_0x535e3e(0x6ce)](_0x22aa47);});}async function _0x12f193(){const _0x374fc6=_0x2b1222;if(_0x43beab[_0x374fc6(0x2e0)]){if(_0x5419de['currentIndex']===-0x1&&_0x5419de[_0x374fc6(0x560)][_0x374fc6(0x58a)]>0x0)_0x5c1930(0x0);else _0x5419de[_0x374fc6(0x541)]>-0x1&&_0x5c1930(_0x5419de['currentIndex']);}else _0x43beab[_0x374fc6(0x352)](),await _0x513460(_0x374fc6(0x4b1));}function _0x7288cb(){const _0x9cf001=_0x2b1222;if(_0x5419de[_0x9cf001(0x560)]['length']===0x0)return;let _0x4a7e6b;switch(_0x5419de['playMode']){case _0x9cf001(0x13ae):_0x4a7e6b=Math['floor'](Math[_0x9cf001(0x13ae)]()*_0x5419de[_0x9cf001(0x560)][_0x9cf001(0x58a)]);break;case _0x9cf001(0x10c0):_0x5c1930(_0x5419de[_0x9cf001(0x541)]);return;case'order':default:_0x4a7e6b=(_0x5419de[_0x9cf001(0x541)]+0x1)%_0x5419de[_0x9cf001(0x560)][_0x9cf001(0x58a)];break;}_0x5c1930(_0x4a7e6b);}function _0x305f7d(){const _0x22ff05=_0x2b1222;if(_0x5419de['playlist'][_0x22ff05(0x58a)]===0x0)return;const _0x1cbf71=(_0x5419de[_0x22ff05(0x541)]-0x1+_0x5419de[_0x22ff05(0x560)][_0x22ff05(0x58a)])%_0x5419de[_0x22ff05(0x560)][_0x22ff05(0x58a)];_0x5c1930(_0x1cbf71);}function _0x11fe89(){const _0x21e11e=_0x2b1222,_0x466ed8=[_0x21e11e(0x249),_0x21e11e(0x13ae),_0x21e11e(0x10c0)],_0x48e533=_0x466ed8[_0x21e11e(0x621)](_0x5419de[_0x21e11e(0x1132)]);_0x5419de['playMode']=_0x466ed8[(_0x48e533+0x1)%_0x466ed8[_0x21e11e(0x58a)]],document[_0x21e11e(0x1f4)]('music-mode-btn')[_0x21e11e(0x231)]={'order':'顺序','random':'随机','single':'单曲'}[_0x5419de[_0x21e11e(0x1132)]];}async function _0x352c30(){const _0x3f72cc=_0x2b1222,_0x3045d8=await _0x11f6fb(_0x3f72cc(0x121e),_0x3f72cc(0xed0),'',_0x3f72cc(0x258));if(!_0x3045d8)return;const _0x2e4ca8=await _0x11f6fb('歌曲信息',_0x3f72cc(0xcdf));if(!_0x2e4ca8)return;const _0xd2c4fe=await _0x11f6fb(_0x3f72cc(0xe50),_0x3f72cc(0x847));if(!_0xd2c4fe)return;_0x5419de['playlist'][_0x3f72cc(0x1426)]({'name':_0x2e4ca8,'artist':_0xd2c4fe,'src':_0x3045d8,'isLocal':![]}),await _0x549080(),_0x13c03f(),_0x5419de[_0x3f72cc(0x541)]===-0x1&&(_0x5419de['currentIndex']=_0x5419de[_0x3f72cc(0x560)][_0x3f72cc(0x58a)]-0x1,_0x5d7946());}async function _0x567779(_0x529789){const _0x54c3ca=_0x2b1222,_0x54154f=_0x529789['target'][_0x54c3ca(0x8b1)];if(!_0x54154f[_0x54c3ca(0x58a)])return;for(const _0x5a2cf5 of _0x54154f){let _0x405ff0=_0x5a2cf5['name'][_0x54c3ca(0xef0)](/\.[^/.]+$/,'');_0x405ff0=await _0x11f6fb(_0x54c3ca(0xe50),_0x54c3ca(0xcdf),_0x405ff0);if(_0x405ff0===null)continue;const _0xe0e7ad=await _0x11f6fb(_0x54c3ca(0xe50),_0x54c3ca(0x847),'未知歌手');if(_0xe0e7ad===null)continue;const _0x1bd62a=await _0x5a2cf5['arrayBuffer']();let _0x414b06='';const _0x4a3935=await _0x109970(_0x54c3ca(0x15c9),_0x54c3ca(0xdb0)+_0x405ff0+_0x54c3ca(0x41b));_0x4a3935&&(_0x414b06=await _0x2824c2()||''),_0x5419de[_0x54c3ca(0x560)][_0x54c3ca(0x1426)]({'name':_0x405ff0,'artist':_0xe0e7ad,'src':_0x1bd62a,'fileType':_0x5a2cf5[_0x54c3ca(0xcbd)],'isLocal':!![],'lrcContent':_0x414b06,'cover':_0x54c3ca(0x1374)});}await _0x549080(),_0x13c03f(),_0x5419de['currentIndex']===-0x1&&_0x5419de[_0x54c3ca(0x560)][_0x54c3ca(0x58a)]>0x0&&(_0x5419de[_0x54c3ca(0x541)]=0x0,_0x5d7946()),_0x529789[_0x54c3ca(0xb57)][_0x54c3ca(0x107e)]=null;}async function _0x5c1930(_0x15ffb2){const _0x4bdace=_0x2b1222;if(_0x15ffb2<0x0||_0x15ffb2>=_0x5419de[_0x4bdace(0x560)][_0x4bdace(0x58a)])return;_0x43beab[_0x4bdace(0x352)](),_0x5419de['currentIndex']=_0x15ffb2;const _0x50222b=_0x5419de[_0x4bdace(0x560)][_0x15ffb2],_0x12c10b=_0x1ae02e[_0x4bdace(0x589)][_0x5419de[_0x4bdace(0x588)]],_0x17d53d=document['getElementById']('music-player-avatar-display');if(_0x12c10b&&_0x17d53d){_0x17d53d[_0x4bdace(0xf21)]='';const _0x5a9434=_0x12c10b[_0x4bdace(0xe83)]?_0x12c10b[_0x4bdace(0x1402)][_0x4bdace(0x13b7)](_0x433d0f=>_0x433d0f[_0x4bdace(0x96f)]===_0x50222b[_0x4bdace(0x1309)])?.['avatar']||_0x5494d0:_0x12c10b[_0x4bdace(0x6a8)]['aiAvatar']||_0x5494d0,_0x329e1a=_0x12c10b[_0x4bdace(0x6a8)]['myAvatar']||_0x5494d0,_0x35e99f=document['createElement']('img');_0x35e99f[_0x4bdace(0x9fe)]=_0x5a9434,_0x35e99f['className']=_0x4bdace(0x1254),_0x35e99f[_0x4bdace(0x14f9)]=_0x4bdace(0x159e),_0x17d53d[_0x4bdace(0x6ce)](_0x35e99f);const _0x3ad060=document[_0x4bdace(0x219)](_0x4bdace(0xecb));_0x3ad060[_0x4bdace(0x9fe)]=_0x329e1a,_0x3ad060[_0x4bdace(0x7c6)]=_0x4bdace(0x1254),_0x3ad060[_0x4bdace(0x14f9)]=_0x4bdace(0x13f7),_0x17d53d[_0x4bdace(0x6ce)](_0x3ad060);}const _0x2c28da=document[_0x4bdace(0xeda)]('.music-player-window'),_0x17ad03=document[_0x4bdace(0x1f4)](_0x4bdace(0x7a6));_0x2c28da&&(_0x2c28da[_0x4bdace(0x215)]['setProperty'](_0x4bdace(0x4e0),_0x50222b['background']?_0x4bdace(0x13cb)+_0x50222b['background']+')':_0x4bdace(0x1b5)),_0x2c28da[_0x4bdace(0x159b)]['toggle'](_0x4bdace(0xd6a),!!_0x50222b[_0x4bdace(0x1367)]));_0x17ad03&&_0x17ad03[_0x4bdace(0x159b)]['toggle'](_0x4bdace(0x7cf),!!_0x50222b[_0x4bdace(0x1367)]);document[_0x4bdace(0x1f4)](_0x4bdace(0x14bb))[_0x4bdace(0x159b)][_0x4bdace(0xa9c)](_0x4bdace(0xc0b));const _0x1bb626=document['getElementById'](_0x4bdace(0xca0));_0x1bb626&&(_0x1bb626['src']=_0x50222b[_0x4bdace(0xeac)]||_0x4bdace(0x1374));await _0x513460('将歌曲切换为了《'+_0x50222b[_0x4bdace(0x5d2)]+'》'),_0x5419de[_0x4bdace(0xc78)]=_0x312b38(_0x50222b['lrcContent']||''),_0x3e5b8a();const _0x318b18=document['getElementById'](_0x4bdace(0x11b2));_0x318b18&&(!_0x5419de[_0x4bdace(0xc78)]||_0x5419de[_0x4bdace(0xc78)][_0x4bdace(0x58a)]===0x0?_0x318b18[_0x4bdace(0x231)]='纯音乐，请欣赏':_0x318b18['textContent']=_0x4bdace(0xd1c));if(_0x50222b[_0x4bdace(0x10b1)]&&_0x50222b[_0x4bdace(0x9fe)]instanceof ArrayBuffer){const _0xc572bc=new Blob([_0x50222b[_0x4bdace(0x9fe)]],{'type':_0x50222b[_0x4bdace(0x20b)]||'audio/mpeg'});_0x43beab[_0x4bdace(0x9fe)]=URL[_0x4bdace(0x297)](_0xc572bc);}else{if(_0x50222b['isLocal']&&_0x50222b[_0x4bdace(0x9fe)]instanceof Blob)_0x43beab['src']=URL['createObjectURL'](_0x50222b[_0x4bdace(0x9fe)]);else{if(!_0x50222b[_0x4bdace(0x10b1)])_0x43beab[_0x4bdace(0x9fe)]=_0x50222b['src'];else{console[_0x4bdace(0x127d)](_0x4bdace(0x4fe),_0x50222b);return;}}}const _0xcd18fc=_0x43beab['play']();_0xcd18fc!==undefined&&_0xcd18fc[_0x4bdace(0x3d1)](_0x6bb790=>{const _0x808e99=_0x4bdace;if(_0x6bb790[_0x808e99(0x5d2)]===_0x808e99(0x14b7))console[_0x808e99(0xb3b)](_0x808e99(0x1432)),_0x43beab['pause'](),_0x1460c5(_0x808e99(0x121a),_0x808e99(0x1302));else _0x6bb790['name']!==_0x808e99(0xa60)&&console[_0x808e99(0x127d)]('Playback\x20error:',_0x6bb790);});_0x13c03f(),_0x5d7946();const _0x244ef8=document[_0x4bdace(0x8b9)]['classList'][_0x4bdace(0xaea)](_0x4bdace(0x15af)),_0x5979ba=_0x1ae02e[_0x4bdace(0x12c0)][_0x4bdace(0xbde)]||![],_0x5987c0=document['getElementById'](_0x4bdace(0x369));_0x244ef8||_0x5979ba?(phoneScreenForIsland[_0x4bdace(0x159b)][_0x4bdace(0x6a4)]('dynamic-island-active'),islandAlbumArt[_0x4bdace(0x9fe)]=_0x50222b['cover']||_0x4bdace(0x1374),_0x5987c0[_0x4bdace(0x159b)][_0x4bdace(0xa9c)](_0x4bdace(0xfca))):(phoneScreenForIsland['classList'][_0x4bdace(0xa9c)](_0x4bdace(0xd6c)),_0x5419de[_0x4bdace(0xc78)]&&_0x5419de[_0x4bdace(0xc78)][_0x4bdace(0x58a)]>0x0?(_0x5987c0['textContent']='♪',_0x5987c0[_0x4bdace(0x159b)]['add'](_0x4bdace(0xfca))):_0x5987c0[_0x4bdace(0x159b)]['remove']('visible'));}async function _0x3caebb(_0x738882){const _0x1947a5=_0x2b1222;if(_0x738882<0x0||_0x738882>=_0x5419de[_0x1947a5(0x560)]['length'])return;const _0x2c32b4=await _0x12414d(_0x1947a5(0xc1d),[{'text':'📁\x20从本地上传','value':_0x1947a5(0x13df)},{'text':_0x1947a5(0x13a3),'value':_0x1947a5(0x258)}]);let _0x306c53=null;if(_0x2c32b4==='local')_0x306c53=await _0x2cdf38();else _0x2c32b4===_0x1947a5(0x258)&&(_0x306c53=await _0x11f6fb('输入图片URL','请输入新的背景图片链接','','url'));if(_0x306c53&&_0x306c53[_0x1947a5(0x4a2)]()){_0x5419de['playlist'][_0x738882][_0x1947a5(0xece)]=_0x306c53[_0x1947a5(0x4a2)](),await _0x549080();if(_0x5419de[_0x1947a5(0x541)]===_0x738882){const _0x39d876=document[_0x1947a5(0xeda)](_0x1947a5(0xa91));_0x39d876[_0x1947a5(0x215)][_0x1947a5(0x495)](_0x1947a5(0x4e0),'url('+_0x306c53[_0x1947a5(0x4a2)]()+')');}await _0x1460c5('成功',_0x1947a5(0x154f));}}async function _0x188dd6(_0x336e71){const _0x5df938=_0x2b1222;if(_0x336e71<0x0||_0x336e71>=_0x5419de[_0x5df938(0x560)][_0x5df938(0x58a)])return;const _0x3b88fb=await _0x12414d(_0x5df938(0xb08),[{'text':_0x5df938(0x1414),'value':_0x5df938(0x13df)},{'text':_0x5df938(0x13a3),'value':_0x5df938(0x258)}]);let _0x4ab0ca=null;if(_0x3b88fb==='local')_0x4ab0ca=await _0x2cdf38();else _0x3b88fb===_0x5df938(0x258)&&(_0x4ab0ca=await _0x11f6fb(_0x5df938(0x92a),_0x5df938(0x13e6),'',_0x5df938(0x258)));if(_0x4ab0ca&&_0x4ab0ca[_0x5df938(0x4a2)]()){_0x5419de[_0x5df938(0x560)][_0x336e71][_0x5df938(0xeac)]=_0x4ab0ca[_0x5df938(0x4a2)](),await _0x549080();if(_0x5419de[_0x5df938(0x541)]===_0x336e71){document[_0x5df938(0x1f4)](_0x5df938(0xca0))['src']=_0x4ab0ca[_0x5df938(0x4a2)]();const _0x299d22=document[_0x5df938(0xeda)](_0x5df938(0x1071));if(_0x299d22)_0x299d22['src']=_0x4ab0ca[_0x5df938(0x4a2)]();}await _0x1460c5('成功',_0x5df938(0x12b8));}}async function _0x352267(_0x571769){const _0x2ff08e=_0x2b1222;if(_0x571769<0x0||_0x571769>=_0x5419de[_0x2ff08e(0x560)]['length'])return;const _0x4682c5=_0x5419de['playlist'][_0x571769],_0x4c184a=_0x5419de[_0x2ff08e(0x14ce)]&&_0x5419de['currentIndex']===_0x571769;if(_0x4682c5[_0x2ff08e(0x10b1)]&&_0x43beab[_0x2ff08e(0x9fe)]['startsWith'](_0x2ff08e(0x8c5))&&_0x5419de[_0x2ff08e(0x541)]===_0x571769)URL['revokeObjectURL'](_0x43beab[_0x2ff08e(0x9fe)]);_0x5419de[_0x2ff08e(0x560)][_0x2ff08e(0x30b)](_0x571769,0x1),await _0x549080();if(_0x5419de[_0x2ff08e(0x560)][_0x2ff08e(0x58a)]===0x0){if(_0x5419de['isPlaying'])_0x43beab['pause']();_0x43beab[_0x2ff08e(0x9fe)]='',_0x5419de['currentIndex']=-0x1,_0x5419de[_0x2ff08e(0x14ce)]=![];}else{if(_0x4c184a)_0x7288cb();else{if(_0x5419de[_0x2ff08e(0x541)]>=_0x571769)_0x5419de[_0x2ff08e(0x541)]=Math['max'](0x0,_0x5419de[_0x2ff08e(0x541)]-0x1);}}_0x5d7946(),_0x13c03f();}async function _0x567779(_0x2499a3){const _0x48e0b1=_0x2b1222,_0xa2b5ae=_0x2499a3[_0x48e0b1(0xb57)][_0x48e0b1(0x8b1)];if(!_0xa2b5ae[_0x48e0b1(0x58a)])return;for(const _0x35b1b1 of _0xa2b5ae){let _0x3c7e5e=_0x35b1b1['name'][_0x48e0b1(0xef0)](/\.[^/.]+$/,'');_0x3c7e5e=await _0x11f6fb(_0x48e0b1(0xe50),_0x48e0b1(0xcdf),_0x3c7e5e);if(_0x3c7e5e===null)continue;const _0x2f0b31=await _0x11f6fb(_0x48e0b1(0xe50),'请输入歌手名','未知歌手');if(_0x2f0b31===null)continue;let _0x1613ef='';const _0x1b3ada=await _0x109970(_0x48e0b1(0x15c9),_0x48e0b1(0xdb0)+_0x3c7e5e+'》添加歌词吗？');_0x1b3ada&&(_0x1613ef=await _0x2824c2()||''),_0x5419de[_0x48e0b1(0x560)][_0x48e0b1(0x1426)]({'name':_0x3c7e5e,'artist':_0x2f0b31,'src':_0x35b1b1,'isLocal':!![],'lrcContent':_0x1613ef});}await _0x549080(),_0x13c03f(),_0x5419de[_0x48e0b1(0x541)]===-0x1&&_0x5419de[_0x48e0b1(0x560)]['length']>0x0&&(_0x5419de[_0x48e0b1(0x541)]=0x0,_0x5d7946()),_0x2499a3['target']['value']=null;}async function _0x352267(_0x72a946){const _0xf81bcb=_0x2b1222;if(_0x72a946<0x0||_0x72a946>=_0x5419de[_0xf81bcb(0x560)][_0xf81bcb(0x58a)])return;const _0x10ea5b=_0x5419de[_0xf81bcb(0x560)][_0x72a946],_0x5232a4=_0x5419de[_0xf81bcb(0x14ce)]&&_0x5419de['currentIndex']===_0x72a946;if(_0x10ea5b[_0xf81bcb(0x10b1)]&&_0x43beab[_0xf81bcb(0x9fe)][_0xf81bcb(0xebf)](_0xf81bcb(0x8c5))&&_0x5419de[_0xf81bcb(0x541)]===_0x72a946)URL[_0xf81bcb(0x157c)](_0x43beab[_0xf81bcb(0x9fe)]);_0x5419de[_0xf81bcb(0x560)][_0xf81bcb(0x30b)](_0x72a946,0x1),await _0x549080();if(_0x5419de[_0xf81bcb(0x560)][_0xf81bcb(0x58a)]===0x0){if(_0x5419de[_0xf81bcb(0x14ce)])_0x43beab[_0xf81bcb(0x352)]();_0x43beab[_0xf81bcb(0x9fe)]='',_0x5419de['currentIndex']=-0x1,_0x5419de[_0xf81bcb(0x14ce)]=![];}else{if(_0x5232a4)_0x7288cb();else{if(_0x5419de['currentIndex']>=_0x72a946)_0x5419de[_0xf81bcb(0x541)]=Math['max'](0x0,_0x5419de[_0xf81bcb(0x541)]-0x1);}}_0x5d7946(),_0x13c03f();}const _0x310140=document['getElementById']('persona-library-modal'),_0x566312=document[_0x2b1222(0x1f4)](_0x2b1222(0x54a)),_0x466642=document['getElementById'](_0x2b1222(0x812));function _0x334ece(){const _0x44371a=_0x2b1222;_0x56999f(),_0x310140[_0x44371a(0x159b)][_0x44371a(0x6a4)](_0x44371a(0xfca));}function _0x5283d2(){const _0x45c9df=_0x2b1222;_0x310140[_0x45c9df(0x159b)][_0x45c9df(0xa9c)](_0x45c9df(0xfca));}function _0x56999f(){const _0x47fde7=_0x2b1222,_0x2475be=document[_0x47fde7(0x1f4)](_0x47fde7(0xfc1));_0x2475be[_0x47fde7(0xf21)]='';if(_0x1ae02e['personaPresets'][_0x47fde7(0x58a)]===0x0){_0x2475be['innerHTML']=_0x47fde7(0x13f4);return;}_0x1ae02e[_0x47fde7(0xe16)]['forEach'](_0x39da87=>{const _0xd7cb93=_0x47fde7,_0x1e5c84=document['createElement']('div');_0x1e5c84[_0xd7cb93(0x7c6)]=_0xd7cb93(0x225),_0x1e5c84[_0xd7cb93(0x215)]['backgroundImage']=_0xd7cb93(0x13cb)+_0x39da87[_0xd7cb93(0x95b)]+')',_0x1e5c84[_0xd7cb93(0x746)][_0xd7cb93(0xd5d)]=_0x39da87['id'],_0x1e5c84['addEventListener']('click',()=>_0x45b19e(_0x39da87['id'])),_0x1160f3(_0x1e5c84,()=>_0x3395b3(_0x39da87['id'])),_0x2475be[_0xd7cb93(0x6ce)](_0x1e5c84);});}function _0x3395b3(_0x43f6b3){const _0x1569ee=_0x2b1222;_0x866b37=_0x43f6b3,_0x466642['classList']['add'](_0x1569ee(0xfca));}function _0x3feb15(){const _0x2806f6=_0x2b1222;_0x466642['classList'][_0x2806f6(0xa9c)](_0x2806f6(0xfca)),_0x866b37=null;}function _0x45b19e(_0x1954fa){const _0x12d8ef=_0x2b1222,_0x429ee5=_0x1ae02e[_0x12d8ef(0xe16)]['find'](_0x50bf7b=>_0x50bf7b['id']===_0x1954fa);_0x429ee5&&(document[_0x12d8ef(0x1f4)](_0x12d8ef(0xabc))['src']=_0x429ee5[_0x12d8ef(0x95b)],document[_0x12d8ef(0x1f4)](_0x12d8ef(0x1285))[_0x12d8ef(0x107e)]=_0x429ee5[_0x12d8ef(0x3be)]),_0x5283d2();}function _0x377003(){const _0x1c35bb=_0x2b1222;_0x866b37=null,document[_0x1c35bb(0x1f4)](_0x1c35bb(0x14b8))['textContent']=_0x1c35bb(0x11c3),document['getElementById'](_0x1c35bb(0x9f6))[_0x1c35bb(0x9fe)]=_0x5494d0,document['getElementById'](_0x1c35bb(0xefd))['value']='',_0x566312[_0x1c35bb(0x159b)][_0x1c35bb(0x6a4)](_0x1c35bb(0xfca));}function _0x105a86(){const _0x10ef14=_0x2b1222,_0x4843bd=_0x1ae02e[_0x10ef14(0xe16)][_0x10ef14(0x13b7)](_0x33f81f=>_0x33f81f['id']===_0x866b37);if(!_0x4843bd)return;document[_0x10ef14(0x1f4)](_0x10ef14(0x14b8))[_0x10ef14(0x231)]='编辑人设预设',document[_0x10ef14(0x1f4)](_0x10ef14(0x9f6))[_0x10ef14(0x9fe)]=_0x4843bd[_0x10ef14(0x95b)],document['getElementById'](_0x10ef14(0xefd))[_0x10ef14(0x107e)]=_0x4843bd['persona'],_0x466642['classList'][_0x10ef14(0xa9c)](_0x10ef14(0xfca)),_0x566312['classList']['add']('visible');}async function _0x59ef93(){const _0x6743f=_0x2b1222,_0x229afa=await _0x109970('删除预设',_0x6743f(0xbd9),{'confirmButtonClass':'btn-danger'});_0x229afa&&_0x866b37&&(await _0x3df81a[_0x6743f(0xe16)][_0x6743f(0xc40)](_0x866b37),_0x1ae02e[_0x6743f(0xe16)]=_0x1ae02e[_0x6743f(0xe16)][_0x6743f(0xede)](_0x4992b8=>_0x4992b8['id']!==_0x866b37),_0x3feb15(),_0x56999f());}function _0x11d0db(){const _0x2ad3f0=_0x2b1222;_0x566312[_0x2ad3f0(0x159b)][_0x2ad3f0(0xa9c)](_0x2ad3f0(0xfca)),_0x866b37=null;}async function _0x4afcf3(){const _0x2391c6=_0x2b1222,_0x423c8f=document['getElementById']('preset-avatar-preview')[_0x2391c6(0x9fe)],_0x6f8484=document[_0x2391c6(0x1f4)](_0x2391c6(0xefd))['value'][_0x2391c6(0x4a2)]();if(_0x423c8f===_0x5494d0&&!_0x6f8484){alert(_0x2391c6(0xabb));return;}if(_0x866b37){const _0x419796=_0x1ae02e[_0x2391c6(0xe16)][_0x2391c6(0x13b7)](_0x5351fd=>_0x5351fd['id']===_0x866b37);_0x419796&&(_0x419796['avatar']=_0x423c8f,_0x419796[_0x2391c6(0x3be)]=_0x6f8484,await _0x3df81a[_0x2391c6(0xe16)][_0x2391c6(0x295)](_0x419796));}else{const _0x1d31d2={'id':_0x2391c6(0x511)+Date[_0x2391c6(0xd6e)](),'avatar':_0x423c8f,'persona':_0x6f8484};await _0x3df81a[_0x2391c6(0xe16)][_0x2391c6(0x6a4)](_0x1d31d2),_0x1ae02e[_0x2391c6(0xe16)][_0x2391c6(0x1426)](_0x1d31d2);}_0x56999f(),_0x11d0db();}const _0x3950bf=document[_0x2b1222(0x1f4)]('battery-alert-modal');function _0x2d818(_0x4270b1,_0x815edd){const _0x259a81=_0x2b1222;clearTimeout(_0x5e1fa5),document[_0x259a81(0x1f4)](_0x259a81(0xa13))[_0x259a81(0x9fe)]=_0x4270b1,document[_0x259a81(0x1f4)](_0x259a81(0xb06))[_0x259a81(0x231)]=_0x815edd,_0x3950bf[_0x259a81(0x159b)]['add'](_0x259a81(0xfca));const _0x40b63d=()=>{const _0x1fdea1=_0x259a81;_0x3950bf[_0x1fdea1(0x159b)]['remove'](_0x1fdea1(0xfca)),_0x3950bf[_0x1fdea1(0x7f6)](_0x1fdea1(0x740),_0x40b63d);};_0x3950bf[_0x259a81(0x122b)](_0x259a81(0x740),_0x40b63d),_0x5e1fa5=setTimeout(_0x40b63d,0x7d0);}function _0x407cc0(_0x1d4632){const _0x3aae40=_0x2b1222,_0x29f207=document['getElementById']('status-bar-battery'),_0x47b003=_0x29f207[_0x3aae40(0xeda)](_0x3aae40(0xdc1)),_0x41f2ef=_0x29f207[_0x3aae40(0xeda)](_0x3aae40(0xa04)),_0x5d35a7=Math['floor'](_0x1d4632['level']*0x64);_0x47b003[_0x3aae40(0x215)]['width']=_0x5d35a7+'%',_0x41f2ef['textContent']=_0x5d35a7+'%',_0x1d4632['charging']?_0x29f207[_0x3aae40(0x159b)][_0x3aae40(0x6a4)]('charging'):_0x29f207['classList'][_0x3aae40(0xa9c)](_0x3aae40(0xc00));}function _0x2a9b7e(_0x3cdd34){const _0x3389fe=_0x2b1222;_0x407cc0(_0x3cdd34);const _0x5c4666=_0x3cdd34['level'];!_0x3cdd34[_0x3389fe(0xc00)]&&(_0x5c4666<=0.4&&_0xf51190>0.4&&!_0x3188d8[_0x3389fe(0x50d)]&&(_0x2d818(_0x3389fe(0x972),_0x3389fe(0xaa7)),_0x3188d8[_0x3389fe(0x50d)]=!![]),_0x5c4666<=0.2&&_0xf51190>0.2&&!_0x3188d8[_0x3389fe(0xbfe)]&&(_0x2d818('https://i.postimg.cc/qB9zbKs9/20.jpg',_0x3389fe(0xdac)),_0x3188d8[_0x3389fe(0xbfe)]=!![]),_0x5c4666<=0.1&&_0xf51190>0.1&&!_0x3188d8[_0x3389fe(0x63b)]&&(_0x2d818(_0x3389fe(0xa36),_0x3389fe(0x49c)),_0x3188d8['hasShown10']=!![]));if(_0x5c4666>0.4)_0x3188d8[_0x3389fe(0x50d)]=![];if(_0x5c4666>0.2)_0x3188d8[_0x3389fe(0xbfe)]=![];if(_0x5c4666>0.1)_0x3188d8[_0x3389fe(0x63b)]=![];_0xf51190=_0x5c4666;}async function _0x266315(){const _0x49b38e=_0x2b1222;if(_0x49b38e(0xd9c)in navigator)try{const _0x30c79f=await navigator[_0x49b38e(0xd9c)]();_0xf51190=_0x30c79f['level'],_0x2a9b7e(_0x30c79f),_0x30c79f[_0x49b38e(0x122b)](_0x49b38e(0x10fc),()=>_0x2a9b7e(_0x30c79f)),_0x30c79f[_0x49b38e(0x122b)](_0x49b38e(0xc57),()=>{const _0x1dca3a=_0x49b38e;_0x2a9b7e(_0x30c79f),_0x30c79f[_0x1dca3a(0xc00)]&&_0x2d818(_0x1dca3a(0x1542),'窝爱泥，电量吃饱饱');});}catch(_0x14e72d){console['error'](_0x49b38e(0x12d0),_0x14e72d),document['querySelector']('.battery-text')[_0x49b38e(0x231)]=_0x49b38e(0x137f);}else console[_0x49b38e(0x57e)](_0x49b38e(0x134c)),document[_0x49b38e(0xeda)](_0x49b38e(0xa04))[_0x49b38e(0x231)]=_0x49b38e(0x137f);}async function _0x4a64dc(){const _0x1fae19=_0x2b1222,_0x4a9ab8=document[_0x1fae19(0x1f4)](_0x1fae19(0xa11));if(!_0x4a9ab8)return;const _0x55c55c=await _0x3df81a[_0x1fae19(0x20a)][_0x1fae19(0x931)](_0x1fae19(0x1a3))[_0x1fae19(0x115a)]()[_0x1fae19(0x27a)]();_0x4a9ab8[_0x1fae19(0xf21)]='';if(_0x55c55c[_0x1fae19(0x58a)]===0x0){_0x4a9ab8[_0x1fae19(0xf21)]='<p\x20style=\x22grid-column:\x201\x20/\x20-1;\x20text-align:\x20center;\x20color:\x20var(--text-secondary);\x20margin-top:\x2050px;\x22>你还没有创建任何相册哦~</p>';return;}_0x55c55c[_0x1fae19(0x59b)](_0x403d54=>{const _0x2a6c1f=_0x1fae19,_0x1b5c38=document[_0x2a6c1f(0x219)]('div');_0x1b5c38[_0x2a6c1f(0x7c6)]=_0x2a6c1f(0x161),_0x1b5c38[_0x2a6c1f(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22album-cover\x22\x20style=\x22background-image:\x20url('+_0x403d54['coverUrl']+_0x2a6c1f(0x7d0)+_0x403d54[_0x2a6c1f(0x5d2)]+_0x2a6c1f(0xf0b)+(_0x403d54[_0x2a6c1f(0xa4a)]||0x0)+'\x20张</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x1b5c38[_0x2a6c1f(0x122b)]('click',()=>{_0x3725ce(_0x403d54['id']);}),_0x1160f3(_0x1b5c38,async()=>{const _0x101821=_0x2a6c1f,_0x54d747=await _0x109970(_0x101821(0x648),_0x101821(0x3b1)+_0x403d54[_0x101821(0x5d2)]+'》吗？此操作将同时删除相册内的所有照片，且无法恢复。',{'confirmButtonClass':_0x101821(0x1c6)});_0x54d747&&(await _0x3df81a['qzonePhotos'][_0x101821(0x478)](_0x101821(0x565))[_0x101821(0x49d)](_0x403d54['id'])[_0x101821(0xc40)](),await _0x3df81a[_0x101821(0x20a)][_0x101821(0xc40)](_0x403d54['id']),await _0x4a64dc(),alert('相册已成功删除。'));}),_0x4a9ab8[_0x2a6c1f(0x6ce)](_0x1b5c38);});}async function _0x3725ce(_0x3068ca){const _0x1cbab1=_0x2b1222;_0x1ae02e[_0x1cbab1(0x866)]=_0x3068ca,await _0x4fd1c1(),_0x2e53fa('album-photos-screen');}async function _0x4fd1c1(){const _0x2ca56a=_0x2b1222;if(!_0x1ae02e[_0x2ca56a(0x866)])return;const _0x39876d=document['getElementById'](_0x2ca56a(0xba1)),_0x30b169=document[_0x2ca56a(0x1f4)](_0x2ca56a(0x54e)),_0xdac566=await _0x3df81a[_0x2ca56a(0x20a)][_0x2ca56a(0x13f8)](_0x1ae02e[_0x2ca56a(0x866)]);if(!_0xdac566){console[_0x2ca56a(0x127d)](_0x2ca56a(0xb32),_0x1ae02e[_0x2ca56a(0x866)]),_0x2e53fa('album-screen');return;}_0x30b169['textContent']=_0xdac566[_0x2ca56a(0x5d2)];const _0x51b468=await _0x3df81a[_0x2ca56a(0xaee)][_0x2ca56a(0x478)](_0x2ca56a(0x565))[_0x2ca56a(0x49d)](_0x1ae02e[_0x2ca56a(0x866)])['toArray']();_0x39876d[_0x2ca56a(0xf21)]='',_0x51b468[_0x2ca56a(0x58a)]===0x0?_0x39876d['innerHTML']='<p\x20style=\x22grid-column:\x201\x20/\x20-1;\x20text-align:\x20center;\x20color:\x20var(--text-secondary);\x20margin-top:\x2050px;\x22>这个相册还是空的，快上传第一张照片吧！</p>':_0x51b468['forEach'](_0x2449a3=>{const _0x2ebaf3=_0x2ca56a,_0x1a2516=document['createElement'](_0x2ebaf3(0xaf9));_0x1a2516[_0x2ebaf3(0x7c6)]=_0x2ebaf3(0x113b),_0x1a2516[_0x2ebaf3(0xf21)]=_0x2ebaf3(0x163)+_0x2449a3['url']+_0x2ebaf3(0x14d5)+_0x2449a3['id']+_0x2ebaf3(0x4b5),_0x39876d[_0x2ebaf3(0x6ce)](_0x1a2516);});}async function _0x28357a(_0x554225){const _0x5e8ebe=_0x2b1222;if(!_0x1ae02e[_0x5e8ebe(0x866)])return;const _0x8db235=await _0x3df81a[_0x5e8ebe(0xaee)][_0x5e8ebe(0x478)]('albumId')['equals'](_0x1ae02e[_0x5e8ebe(0x866)])['toArray']();_0x44e0a8[_0x5e8ebe(0xc0c)]=_0x8db235[_0x5e8ebe(0x1431)](_0x3573d5=>_0x3573d5['url']),_0x44e0a8[_0x5e8ebe(0x541)]=_0x44e0a8[_0x5e8ebe(0xc0c)]['findIndex'](_0x4caa31=>_0x4caa31===_0x554225);if(_0x44e0a8['currentIndex']===-0x1)return;document[_0x5e8ebe(0x1f4)](_0x5e8ebe(0x550))['classList'][_0x5e8ebe(0x6a4)](_0x5e8ebe(0xfca)),_0x4e2463(),_0x44e0a8[_0x5e8ebe(0x491)]=!![];}function _0x4e2463(){const _0x2ed1a7=_0x2b1222;if(_0x44e0a8[_0x2ed1a7(0x541)]===-0x1)return;const _0x121130=document[_0x2ed1a7(0x1f4)](_0x2ed1a7(0xee4)),_0x25a63a=document[_0x2ed1a7(0x1f4)](_0x2ed1a7(0x138c)),_0x1ad3e7=document[_0x2ed1a7(0x1f4)]('photo-viewer-next-btn');_0x121130[_0x2ed1a7(0x215)][_0x2ed1a7(0x38d)]=0x0,setTimeout(()=>{const _0x16da1a=_0x2ed1a7;_0x121130[_0x16da1a(0x9fe)]=_0x44e0a8['photos'][_0x44e0a8[_0x16da1a(0x541)]],_0x121130[_0x16da1a(0x215)][_0x16da1a(0x38d)]=0x1;},0x64),_0x25a63a[_0x2ed1a7(0xa0d)]=_0x44e0a8[_0x2ed1a7(0x541)]===0x0,_0x1ad3e7[_0x2ed1a7(0xa0d)]=_0x44e0a8['currentIndex']===_0x44e0a8[_0x2ed1a7(0xc0c)][_0x2ed1a7(0x58a)]-0x1;}function _0x3e8330(){const _0x4ea2ff=_0x2b1222;_0x44e0a8[_0x4ea2ff(0x541)]<_0x44e0a8[_0x4ea2ff(0xc0c)][_0x4ea2ff(0x58a)]-0x1&&(_0x44e0a8[_0x4ea2ff(0x541)]++,_0x4e2463());}function _0xbf2b5d(){const _0x48bb8d=_0x2b1222;_0x44e0a8[_0x48bb8d(0x541)]>0x0&&(_0x44e0a8[_0x48bb8d(0x541)]--,_0x4e2463());}function _0x35aa07(){const _0x2f55e0=_0x2b1222;document[_0x2f55e0(0x1f4)](_0x2f55e0(0x550))['classList'][_0x2f55e0(0xa9c)](_0x2f55e0(0xfca)),_0x44e0a8[_0x2f55e0(0x491)]=![],_0x44e0a8['photos']=[],_0x44e0a8[_0x2f55e0(0x541)]=-0x1,document[_0x2f55e0(0x1f4)](_0x2f55e0(0xee4))[_0x2f55e0(0x9fe)]='';}function _0xfc0942(_0x2f53e8){const _0x4fe952=_0x2b1222;_0x496f96=_0x2f53e8,localStorage['setItem']('unreadPostsCount',_0x2f53e8);const _0x3eca2a=document['querySelector'](_0x4fe952(0x4c5)),_0x8fff59=_0x3eca2a[_0x4fe952(0xeda)]('span');let _0x52d3aa=_0x3eca2a[_0x4fe952(0xeda)](_0x4fe952(0x659));_0x2f53e8>0x0?(!_0x52d3aa&&(_0x52d3aa=document[_0x4fe952(0x219)]('span'),_0x52d3aa[_0x4fe952(0x7c6)]=_0x4fe952(0x844),_0x8fff59[_0x4fe952(0x215)][_0x4fe952(0x1335)]=_0x4fe952(0x1f3),_0x8fff59[_0x4fe952(0x6ce)](_0x52d3aa)),_0x52d3aa['textContent']=_0x2f53e8>0x63?_0x4fe952(0xff8):_0x2f53e8,_0x52d3aa[_0x4fe952(0x215)][_0x4fe952(0x887)]=_0x4fe952(0x361)):_0x52d3aa&&(_0x52d3aa['style'][_0x4fe952(0x887)]=_0x4fe952(0x1b5)),_0x27308f();}function _0x217a5b(){const _0x1ef262=_0x2b1222;if(_0x512c63)return;const _0x4c8527=_0x1ae02e[_0x1ef262(0x12c0)][_0x1ef262(0xfd5)]||0x3c;_0x512c63=setInterval(_0x1c8f44,_0x4c8527*0x3e8),_0x2d0337();}function _0x2d78a9(){_0x512c63&&(clearInterval(_0x512c63),_0x512c63=null),_0x12ea3e();}async function _0x1c8f44(){const _0x50b553=_0x2b1222;console[_0x50b553(0x57e)](_0x50b553(0x962));if(!_0x1ae02e[_0x50b553(0x12c0)]['enableBackgroundActivity']){_0x2d78a9();return;}const _0x37ba9=Object['values'](_0x1ae02e['chats'])['filter'](_0x354d7=>!_0x354d7[_0x50b553(0xe83)]);_0x37ba9[_0x50b553(0x59b)](_0x282894=>{const _0x3a0df2=_0x50b553;if(_0x282894['relationship']?.['status']==='blocked_by_user'){const _0x15cf0c=_0x282894[_0x3a0df2(0x13ab)][_0x3a0df2(0x139b)];if(!_0x15cf0c)return;const _0x1c9059=Date[_0x3a0df2(0xd6e)]()-_0x15cf0c,_0x10ba69=(_0x1ae02e[_0x3a0df2(0x12c0)][_0x3a0df2(0x8a1)]||0x1)*0x3c*0x3c*0x3e8;_0x1c9059>_0x10ba69&&(_0x282894[_0x3a0df2(0x13ab)]['status']=_0x3a0df2(0x12dd),_0x31f1ac(_0x282894['id']));}else{if(_0x282894[_0x3a0df2(0x13ab)]?.['status']===_0x3a0df2(0xfe3)&&_0x282894['id']!==_0x1ae02e[_0x3a0df2(0x588)]){if(_0x282894[_0x3a0df2(0x6a8)][_0x3a0df2(0x605)]===![]){console[_0x3a0df2(0x57e)]('角色\x20\x22'+_0x282894[_0x3a0df2(0x5d2)]+'\x22\x20的独立后台活动开关已关闭，本次跳过。');return;}Math[_0x3a0df2(0x13ae)]()<0.2&&(console['log'](_0x3a0df2(0x1501)+_0x282894['name']+_0x3a0df2(0x780)),_0x48a288(_0x282894['id']));}}});const _0x4f92bd=Object['values'](_0x1ae02e['chats'])[_0x50b553(0xede)](_0x351dc8=>_0x351dc8[_0x50b553(0xe83)]);_0x4f92bd['forEach'](_0x3b5d92=>{const _0x54b668=_0x50b553;if(_0x3b5d92[_0x54b668(0x6a8)]['enableBackgroundActivity']===![]){console[_0x54b668(0x57e)](_0x54b668(0xc4e)+_0x3b5d92[_0x54b668(0x5d2)]+'\x22\x20的后台活动开关已关闭，本次跳过。');return;}_0x3b5d92['id']!==_0x1ae02e[_0x54b668(0x588)]&&Math[_0x54b668(0x13ae)]()<0.1&&(console[_0x54b668(0x57e)](_0x54b668(0xc4e)+_0x3b5d92['name']+_0x54b668(0x780)),_0x1fd72d(_0x3b5d92['id']));});try{const _0x26abd8=await _0x3df81a['npcs'][_0x50b553(0x27a)]();if(_0x26abd8[_0x50b553(0x58a)]===0x0)return;const _0x3ec379=await _0x3df81a['qzonePosts'][_0x50b553(0x931)](_0x50b553(0x1388))[_0x50b553(0x115a)]()[_0x50b553(0x1491)](0xa)[_0x50b553(0x27a)]();for(const _0x2e91e3 of _0x26abd8){if(_0x2e91e3[_0x50b553(0x605)]===![])continue;const _0x2215bd=_0x2e91e3['actionCooldownMinutes']||0xf;if(_0x2e91e3['lastActionTimestamp']){const _0x4bef38=(Date[_0x50b553(0xd6e)]()-_0x2e91e3[_0x50b553(0x1ac)])/(0x3e8*0x3c);if(_0x4bef38<_0x2215bd)continue;}if(Math[_0x50b553(0x13ae)]()>0.3)continue;const _0x41a30d=[];for(const _0x31b89e of _0x3ec379){if(_0x31b89e[_0x50b553(0x12cf)]===_0x50b553(0x27f)+_0x2e91e3['id'])continue;const _0x568d48=_0x31b89e[_0x50b553(0x10ae)]?.[_0x50b553(0x690)](_0x34600a=>_0x34600a['replyTo']===_0x2e91e3[_0x50b553(0x5d2)]),_0x9c37e8=_0x31b89e['comments']?.[_0x50b553(0x5cc)](-0x1)[0x0]?.[_0x50b553(0xe27)];if(_0x9c37e8===_0x2e91e3['name'])continue;let _0x366716=![];if(_0x31b89e[_0x50b553(0x12cf)]===_0x50b553(0x860)||_0x31b89e[_0x50b553(0x12cf)][_0x50b553(0xebf)](_0x50b553(0x13b9)))_0x2e91e3[_0x50b553(0x11e9)]['includes'](_0x31b89e['authorId'])&&(_0x366716=!![]);else{if(_0x31b89e[_0x50b553(0x12cf)]['startsWith']('npc_')){const _0x2996c9=parseInt(_0x31b89e[_0x50b553(0x12cf)][_0x50b553(0xef0)](_0x50b553(0x27f),'')),_0x1413d4=await _0x3df81a[_0x50b553(0x15b9)][_0x50b553(0x13f8)](_0x2996c9);if(_0x1413d4){const _0x5d3faa=_0x2e91e3[_0x50b553(0x584)],_0x31fc67=_0x1413d4[_0x50b553(0x584)];_0x5d3faa&&_0x31fc67&&_0x5d3faa===_0x31fc67&&(_0x366716=!![]);}}}(_0x366716||_0x568d48)&&_0x41a30d[_0x50b553(0x1426)](_0x31b89e);}if(_0x41a30d[_0x50b553(0x58a)]>0x0||Math[_0x50b553(0x13ae)]()<0.2){console[_0x50b553(0x57e)](_0x50b553(0x428)+_0x2e91e3[_0x50b553(0x5d2)]+_0x50b553(0xcb1));const _0x4a7859=await _0xd777f(_0x2e91e3,_0x41a30d);if(_0x4a7859&&_0x4a7859['length']>0x0){for(const _0x292e19 of _0x4a7859){if(_0x292e19[_0x50b553(0xcbd)]===_0x50b553(0x3ed)){const _0x432f4a=await _0x3df81a['qzonePosts']['get'](_0x292e19[_0x50b553(0xd8f)]);if(_0x432f4a){if(!_0x432f4a['comments'])_0x432f4a[_0x50b553(0x10ae)]=[];_0x432f4a[_0x50b553(0x10ae)][_0x50b553(0x1426)]({'commenterName':_0x2e91e3[_0x50b553(0x5d2)],'text':_0x292e19['commentText'],'replyTo':_0x292e19['replyTo']||null,'timestamp':Date[_0x50b553(0xd6e)]()+Math[_0x50b553(0x13ae)]()}),await _0x3df81a[_0x50b553(0x910)][_0x50b553(0xf18)](_0x292e19[_0x50b553(0xd8f)],{'comments':_0x432f4a[_0x50b553(0x10ae)]}),_0xfc0942(_0x496f96+0x1);}}else{if(_0x292e19[_0x50b553(0xcbd)]===_0x50b553(0x4e1)){const _0x418d0d={'type':_0x292e19['postType']||_0x50b553(0x30e),'content':_0x292e19[_0x50b553(0x128c)],'timestamp':Date[_0x50b553(0xd6e)](),'authorId':_0x50b553(0x27f)+_0x2e91e3['id'],'authorOriginalName':_0x2e91e3[_0x50b553(0x5d2)],'visibleTo':_0x2e91e3['associatedWith'],'likes':[],'comments':[],'isDeleted':![]};await _0x3df81a[_0x50b553(0x910)][_0x50b553(0x6a4)](_0x418d0d),console[_0x50b553(0x57e)](_0x50b553(0x428)+_0x2e91e3[_0x50b553(0x5d2)]+_0x50b553(0x6e4)),_0xfc0942(_0x496f96+0x1);}}}await _0x3df81a[_0x50b553(0x15b9)][_0x50b553(0xf18)](_0x2e91e3['id'],{'lastActionTimestamp':Date['now']()}),document['getElementById'](_0x50b553(0x11b5))[_0x50b553(0x159b)]['contains'](_0x50b553(0x7cf))&&await _0x28d6f7();}}}}catch(_0x54fdc6){console[_0x50b553(0x127d)](_0x50b553(0x275),_0x54fdc6);}}async function _0xd777f(_0x1c0b83,_0x371392){const _0x2728a8=_0x2b1222,{proxyUrl:_0x3a9d02,apiKey:_0x12a18c,model:_0x3715ff}=_0x1ae02e[_0x2728a8(0x226)];if(!_0x3a9d02||!_0x12a18c||!_0x3715ff)return console[_0x2728a8(0x127d)]('NPC行动失败：API未配置。'),null;let _0x19e12e=_0x2728a8(0xd3e);const _0x215a16=_0x1ae02e[_0x2728a8(0x11ef)][_0x2728a8(0xb46)]||'我',_0x44d4e8=_0x1ae02e[_0x2728a8(0x589)][Object[_0x2728a8(0x1378)](_0x1ae02e['chats'])[0x0]]?.[_0x2728a8(0x6a8)][_0x2728a8(0x36b)]||_0x2728a8(0x1570);_0x19e12e+=_0x2728a8(0x6ca)+_0x215a16+'\x20(用户)**:\x20'+_0x44d4e8+'\x0a';_0x1c0b83[_0x2728a8(0x11e9)]&&_0x1c0b83['associatedWith'][_0x2728a8(0x58a)]>0x0&&_0x1c0b83[_0x2728a8(0x11e9)]['forEach'](_0x5665be=>{const _0x303f5d=_0x2728a8,_0x3b446b=_0x1ae02e[_0x303f5d(0x589)][_0x5665be];_0x3b446b&&!_0x3b446b[_0x303f5d(0xe83)]&&(_0x19e12e+=_0x303f5d(0x6ca)+_0x3b446b[_0x303f5d(0x5d2)]+_0x303f5d(0x85b)+_0x3b446b[_0x303f5d(0x96f)]+_0x303f5d(0x77b)+_0x3b446b['settings'][_0x303f5d(0xf42)]+'\x0a');});const _0x3abfa3=(await Promise[_0x2728a8(0x54b)](_0x371392[_0x2728a8(0x1431)](async _0x43f7a3=>{const _0x375e94=_0x2728a8;let _0x30f707='未知作者';if(_0x43f7a3[_0x375e94(0x12cf)]==='user')_0x30f707=_0x1ae02e['qzoneSettings'][_0x375e94(0xb46)]||'用户';else{if(_0x43f7a3[_0x375e94(0x12cf)][_0x375e94(0xebf)](_0x375e94(0x13b9)))_0x30f707=_0x34f6a8(_0x43f7a3[_0x375e94(0x24c)]||_0x43f7a3[_0x375e94(0x12cf)]);else{if(_0x43f7a3['authorId']['startsWith'](_0x375e94(0x27f))){const _0x17c9d4=parseInt(_0x43f7a3[_0x375e94(0x12cf)][_0x375e94(0xef0)](_0x375e94(0x27f),'')),_0x39e3b8=await _0x3df81a['npcs'][_0x375e94(0x13f8)](_0x17c9d4);_0x39e3b8&&(_0x30f707=_0x39e3b8['name']);}}}const _0x23c7a2=(_0x43f7a3[_0x375e94(0x10ae)]||[])[_0x375e94(0x1431)](_0x28676f=>{const _0x120d60=_0x375e94;if(typeof _0x28676f===_0x120d60(0xcc5)&&_0x28676f[_0x120d60(0xe27)]){const _0x462f18=_0x34f6a8(_0x28676f[_0x120d60(0xe27)]);return _0x120d60(0x6ca)+_0x462f18+'**:\x20'+_0x28676f[_0x120d60(0x40f)];}return'-\x20'+_0x28676f;})[_0x375e94(0x1143)]('\x0a');return _0x375e94(0x9d6)+_0x43f7a3['id']+'\x0a-\x20**作者**:\x20'+_0x30f707+'\x0a-\x20**内容摘要**:\x20'+(_0x43f7a3[_0x375e94(0x128c)]||_0x43f7a3[_0x375e94(0xf1f)]||'')['substring'](0x0,0x96)+_0x375e94(0x1258)+(_0x23c7a2||_0x375e94(0x8c1))+_0x375e94(0xad1);})))[_0x2728a8(0x1143)]('\x0a'),_0x2b4135=_0x2728a8(0x27f)+_0x1c0b83['id'],_0x4dfe92=Date[_0x2728a8(0xd6e)]()-0xc*0x3c*0x3c*0x3e8,_0x91d17c=await _0x3df81a[_0x2728a8(0x910)]['where'](_0x2728a8(0x12cf))['equals'](_0x2b4135)[_0x2728a8(0xa26)](_0x575e6d=>_0x575e6d[_0x2728a8(0x1388)]>_0x4dfe92)['toArray']();let _0x6be541='';_0x91d17c['length']>0x0&&(_0x6be541=_0x2728a8(0xa5a));const _0x2e7b3f=_0x2728a8(0x12d3)+_0x1c0b83[_0x2728a8(0x5d2)]+_0x2728a8(0x14e0)+_0x6be541+'\x0a\x0a#\x20核心规则\x0a1.\x20\x20**【角色扮演】**:\x20你的所有行为都【必须】严格符合你的角色设定。\x0a2.\x20\x20**【互动逻辑】**:\x20你的首要任务是检查“待处理的帖子列表”。如果列表中有你可以回应的帖子（特别是那些有新评论或提到你的），你【必须】优先进行评论或回复，而不是发布新动态。\x0a3.\x20\x20**【格式铁律\x20(最高优先级)】**:\x20\x0a\x20\x20\x20\x20-\x20\x20\x20你的回复【必须且只能】是一个JSON数组格式的字符串。\x0a\x20\x20\x20\x20-\x20\x20\x20数组中可以包含【一个或多个】行动对象。\x0a\x20\x20\x20\x20-\x20\x20\x20每个行动对象的格式【必须】是以下两种之一：\x0a\x20\x20\x20\x20\x20\x20-\x20\x20\x20**发布新动态**:\x20`{\x22type\x22:\x20\x22qzone_post\x22,\x20\x22postType\x22:\x20\x22shuoshuo\x22,\x20\x22content\x22:\x20\x22你的新动态内容。\x22}`\x0a\x20\x20\x20\x20\x20\x20-\x20\x20\x20**发表评论**:\x20`{\x22type\x22:\x20\x22qzone_comment\x22,\x20\x22postId\x22:\x20123,\x20\x22commentText\x22:\x20\x22你的新评论内容。\x22}`\x20或\x20`{\x22type\x22:\x20\x22qzone_comment\x22,\x20\x22postId\x22:\x20123,\x20\x22replyTo\x22:\x20\x22被回复者的【本名】\x22,\x20\x22commentText\x22:\x20\x22你的回复内容。\x22}`\x0a4.\x20\x20**【行为组合指南】**:\x0a\x20\x20\x20\x20-\x20\x20\x20你可以自由组合不同的行动，例如，先发布一条自己的动态，再去评论别人的动态。\x0a\x20\x20\x20\x20-\x20\x20\x20为了模拟真实行为，你本次生成的行动数量建议在【1到3个】之间。\x0a\x0a#\x20你的角色设定\x0a-\x20**昵称**:\x20'+_0x1c0b83[_0x2728a8(0x5d2)]+'\x0a-\x20**人设**:\x20'+_0x1c0b83['persona']+'\x0a\x0a'+_0x19e12e+'\x20\x0a\x0a#\x20待处理的帖子列表\x20(如果你选择评论)\x0a'+_0x3abfa3+_0x2728a8(0x1141);try{const _0x5e751b=[{'role':_0x2728a8(0x860),'content':'请根据你的设定，开始你的行动。'}];let _0x472bc4=_0x3a9d02[_0x2728a8(0xe82)](_0x2728a8(0xc38)),_0xf61466=_0x16b978(_0x3715ff,_0x12a18c,_0x2e7b3f,_0x5e751b);const _0x284dce=_0x472bc4?await fetch(_0xf61466[_0x2728a8(0x258)],_0xf61466[_0x2728a8(0xc6b)]):await fetch(_0x3a9d02+_0x2728a8(0x14c2),{'method':_0x2728a8(0x12d9),'headers':{'Content-Type':_0x2728a8(0xa90),'Authorization':'Bearer\x20'+_0x12a18c},'body':JSON[_0x2728a8(0x994)]({'model':_0x3715ff,'messages':[{'role':_0x2728a8(0x1594),'content':_0x2e7b3f},..._0x5e751b],'temperature':_0x1ae02e[_0x2728a8(0x12c0)][_0x2728a8(0x217)]||0.9})});if(!_0x284dce['ok'])throw new Error(_0x2728a8(0xaa6)+_0x284dce[_0x2728a8(0x1260)]);const _0x4aff45=await _0x284dce['json'](),_0x4f7fd9=getGeminiResponseText(_0x4aff45),_0x109e49=_0x4f7fd9[_0x2728a8(0xba5)](/(\[[\s\S]*\])/);if(!_0x109e49)throw new Error(_0x2728a8(0xa8c));return JSON[_0x2728a8(0x129c)](_0x109e49[0x0]);}catch(_0x20afc1){return console[_0x2728a8(0x127d)](_0x2728a8(0xac7)+_0x1c0b83[_0x2728a8(0x5d2)]+_0x2728a8(0x136d),_0x20afc1),null;}}async function _0x48a288(_0x1e2735){const _0x19e765=_0x2b1222,_0x3b3a58=_0x1ae02e[_0x19e765(0x589)][_0x1e2735];if(!_0x3b3a58)return;const _0x1eacf3=_0x3b3a58[_0x19e765(0x6a8)][_0x19e765(0xfa7)]||0xa;if(_0x3b3a58[_0x19e765(0x1ac)]){const _0x56f769=(Date[_0x19e765(0xd6e)]()-_0x3b3a58[_0x19e765(0x1ac)])/(0x3e8*0x3c);if(_0x56f769<_0x1eacf3){console['log'](_0x19e765(0x1501)+_0x3b3a58[_0x19e765(0x5d2)]+_0x19e765(0x6e5)+Math[_0x19e765(0x8cf)](_0x1eacf3-_0x56f769)+_0x19e765(0x89f));return;}}_0x450e6f(_0x1e2735,!![]);const {proxyUrl:_0xdb35de,apiKey:_0x434681,model:_0x4db48a}=_0x1ae02e[_0x19e765(0x226)];if(!_0xdb35de||!_0x434681||!_0x4db48a)return;const _0x3eb7c=_0x1ae02e['qzoneSettings']['nickname'],_0x5d291d=new Date(),_0x5a2b75=_0x3b3a58[_0x19e765(0x6a8)][_0x19e765(0x63f)]||'Asia/Shanghai',_0x53079d=_0x5d291d[_0x19e765(0x613)](_0x19e765(0xd02),{'timeZone':_0x5a2b75,'dateStyle':_0x19e765(0x82e),'timeStyle':_0x19e765(0x144f)}),_0x278f8b=new Date(_0x5d291d[_0x19e765(0x613)](_0x19e765(0xaa2),{'timeZone':_0x5a2b75}));let _0x2a19a0='',_0x175d79='',_0x5eca07,_0x147a23=![];const _0x5b4914=_0x3b3a58['settings'][_0x19e765(0x4b2)]||0xa,_0x5af9c7=_0x3b3a58[_0x19e765(0xce3)]['filter'](_0x48f44d=>!_0x48f44d['isHidden'])[_0x19e765(0x5cc)](-_0x5b4914),_0x1678aa=_0x3b3a58[_0x19e765(0xce3)][_0x19e765(0xede)](_0xb4f54b=>!_0xb4f54b[_0x19e765(0x58e)])[_0x19e765(0x5cc)](-0x1)[0x0];if(_0x3b3a58[_0x19e765(0x6a8)]['enableTimePerception']){_0x2a19a0=_0x1c13d6(_0x278f8b);const _0xd1fc07=_0x3b3a58['history'][_0x19e765(0xede)](_0x5de6c4=>!_0x5de6c4[_0x19e765(0x58e)])[_0x19e765(0x5cc)](-0x1)[0x0],_0x5ae6d7=new Date();let _0x4804a1='',_0xb643e4=![];if(_0xd1fc07){const _0x5a4ac3=new Date(_0xd1fc07['timestamp']),_0x533641=(_0x5ae6d7-_0x5a4ac3)/(0x3e8*0x3c*0x3c);if(_0x533641>0x2){_0xb643e4=!![];const _0x1d9694=Math[_0x19e765(0x123c)](_0x533641/0x18);_0x4804a1=_0x19e765(0x8dc)+(_0x1d9694>0x0?_0x1d9694+'天':Math[_0x19e765(0x123c)](_0x533641)+'小时')+_0x19e765(0xc39);}else{const _0x51f25a=Math['floor'](_0x533641*0x3c);if(_0x51f25a<0x5)_0x4804a1=_0x19e765(0x2f2);else _0x51f25a<0x3c?_0x4804a1=_0x19e765(0x1280)+_0x51f25a+'分钟前聊过。':_0x4804a1=_0x19e765(0x1280)+Math['floor'](_0x533641)+_0x19e765(0xc51);}}else _0xb643e4=!![],_0x4804a1=_0x19e765(0x268);let _0x26d34a='你们最近没有有效聊天记录。';_0x5af9c7['length']>0x0&&(_0x26d34a=_0x19e765(0x40d)+_0x5af9c7[_0x19e765(0x1431)](_0x3551fb=>{const _0x4c8e9c=_0x19e765,_0x597f71=_0x3551fb['role']==='user'?_0x3eb7c:_0x3b3a58[_0x4c8e9c(0x5d2)];return _0x597f71+':\x20'+String(_0x3551fb[_0x4c8e9c(0x128c)])[_0x4c8e9c(0x516)](0x0,0x32)+_0x4c8e9c(0x629);})[_0x19e765(0x1143)]('\x0a')),_0xb643e4?_0x5eca07=_0x19e765(0x10e2)+_0x4804a1+'\x20当前时间是\x20'+_0x53079d+_0x19e765(0x3c5)+_0x26d34a:_0x5eca07=''+_0x26d34a;}else _0x5af9c7[_0x19e765(0x58a)]>0x0?_0x5eca07=_0x19e765(0x40d)+_0x5af9c7['map'](_0x55d7df=>{const _0x314692=_0x19e765,_0x58e5b4=_0x55d7df[_0x314692(0xfbb)]===_0x314692(0x860)?_0x3eb7c:_0x3b3a58['name'];return _0x58e5b4+':\x20'+String(_0x55d7df[_0x314692(0x128c)])[_0x314692(0x516)](0x0,0x32)+_0x314692(0x629);})[_0x19e765(0x1143)]('\x0a'):_0x5eca07='你们最近没有有效聊天记录。';const _0x5d67d0=await _0x3df81a[_0x19e765(0x910)][_0x19e765(0x931)](_0x19e765(0x1388))[_0x19e765(0x115a)]()[_0x19e765(0x1491)](0x5)[_0x19e765(0x27a)](),_0x1949ac=_0x4f9640(_0x5d67d0,_0x3b3a58),_0x343901=_0x1949ac[_0x19e765(0xede)](_0x3913c3=>_0x3913c3[_0x19e765(0x12cf)]===_0x1e2735);let _0x2b1075='';_0x343901[_0x19e765(0x58a)]>0x0&&(_0x2b1075=_0x19e765(0x1177),_0x343901[_0x19e765(0x59b)](_0x2e4c2b=>{const _0x32c99c=_0x19e765;let _0x257c35=(_0x2e4c2b['publicText']||_0x2e4c2b[_0x32c99c(0x128c)]||_0x32c99c(0x727))[_0x32c99c(0x516)](0x0,0x28)+'...';_0x2b1075+=_0x32c99c(0x14f4)+_0x2e4c2b['id']+_0x32c99c(0xa6d)+_0x257c35+'\x22\x0a';}));let _0x2d4718=[];_0x1949ac[_0x19e765(0x58a)]>0x0&&(_0x2d4718=_0x1949ac[_0x19e765(0x1431)](_0x1cff53=>{const _0x32aedd=_0x19e765;let _0x241390;if(_0x1cff53[_0x32aedd(0xcbd)]===_0x32aedd(0x10ea))_0x241390=(_0x32aedd(0x916)+_0x1cff53[_0x32aedd(0x1090)]+'”]\x20'+(_0x1cff53['publicText']||''))[_0x32aedd(0x516)](0x0,0x32)+_0x32aedd(0x629);else _0x1cff53[_0x32aedd(0xcbd)]===_0x32aedd(0x7e5)?_0x241390=('[一张图片，描述为：“'+_0x1cff53['imageDescription']+_0x32aedd(0x9e7)+(_0x1cff53[_0x32aedd(0xf1f)]||''))['substring'](0x0,0x32)+_0x32aedd(0x629):_0x241390=String(_0x1cff53[_0x32aedd(0xf1f)]||_0x1cff53[_0x32aedd(0x128c)]||_0x32aedd(0x727))[_0x32aedd(0x516)](0x0,0x32)+_0x32aedd(0x629);return _0x32aedd(0xecd)+_0x241390+'\x22';}));let _0x1131dc='';_0x2d4718[_0x19e765(0x58a)]>0x0&&(_0x1131dc=_0x19e765(0x120c)+_0x2d4718[_0x19e765(0x1143)]('\x0a')+_0x19e765(0x20e));let _0x5b5012='';if(_0x3b3a58['settings']['linkedWorldBookIds']&&_0x3b3a58['settings'][_0x19e765(0x1469)][_0x19e765(0x58a)]>0x0){const _0x3aef9b=_0x3b3a58[_0x19e765(0x6a8)]['linkedWorldBookIds'][_0x19e765(0x1431)](_0x433fa9=>{const _0x2552cf=_0x19e765,_0x3368e7=_0x1ae02e['worldBooks'][_0x2552cf(0x13b7)](_0x483670=>_0x483670['id']===_0x433fa9);if(!_0x3368e7||!Array[_0x2552cf(0x121f)](_0x3368e7[_0x2552cf(0x128c)]))return'';const _0x23f22b=_0x3368e7[_0x2552cf(0x128c)][_0x2552cf(0xede)](_0x16feb0=>_0x16feb0['enabled']!==![])[_0x2552cf(0x1431)](_0x547d66=>{const _0x5962bc=_0x2552cf;let _0x3d2a1b=_0x5962bc(0x272)+(_0x547d66[_0x5962bc(0x306)]||_0x5962bc(0x286))+'\x0a';return _0x547d66[_0x5962bc(0x1378)][_0x5962bc(0x58a)]>0x0&&(_0x3d2a1b+='**关键词:**\x20'+_0x547d66[_0x5962bc(0x1378)][_0x5962bc(0x1143)](',\x20')+'\x0a'),_0x3d2a1b+=_0x5962bc(0x3d9)+_0x547d66['content'],_0x3d2a1b;})[_0x2552cf(0x1143)]('');return _0x23f22b?_0x2552cf(0x404)+_0x3368e7[_0x2552cf(0x5d2)]+'\x0a'+_0x23f22b:'';})[_0x19e765(0xede)](Boolean)[_0x19e765(0x1143)]('');_0x3aef9b&&(_0x5b5012='#\x20---\x20世界书\x20(World\x20Book)\x20---\x0a#\x20【最高优先级规则：世界观设定】\x0a#\x20你【必须】将以下所有“世界书”中的设定，视为绝对的、不可动摇的背景事实。\x0a#\x20你的所有回复和行为都【绝对不能】与这些设定产生任何冲突。\x0a'+_0x3aef9b+_0x19e765(0x47a));}let _0x8245fc='';const _0x3ac49e=_0x3b3a58[_0x19e765(0x6a8)][_0x19e765(0x11c5)]||0xa;if(_0x3b3a58[_0x19e765(0x6a8)][_0x19e765(0xf2e)]&&_0x3b3a58[_0x19e765(0x6a8)][_0x19e765(0xf2e)][_0x19e765(0x58a)]>0x0){const _0x3d81fe=_0x3b3a58[_0x19e765(0x6a8)][_0x19e765(0xf2e)][_0x19e765(0x1431)](_0x3b0753=>{const _0x3f56a1=_0x19e765,_0x594979=_0x1ae02e[_0x3f56a1(0x589)][_0x3b0753];if(!_0x594979)return null;const _0x2dea06=_0x594979[_0x3f56a1(0xce3)][_0x3f56a1(0x5cc)](-0x1)[0x0];return{'chat':_0x594979,'latestTimestamp':_0x2dea06?_0x2dea06[_0x3f56a1(0x1388)]:0x0};})[_0x19e765(0xede)](Boolean);_0x3d81fe[_0x19e765(0x74e)]((_0x5cd8c9,_0x257d8c)=>_0x257d8c[_0x19e765(0xfcf)]-_0x5cd8c9[_0x19e765(0xfcf)]),_0x8245fc+=_0x19e765(0x8fe);for(const _0x3e72d8 of _0x3d81fe){const _0x3f3a9f=_0x3e72d8[_0x19e765(0x21a)],_0x31f5db=_0x3f3a9f[_0x19e765(0xe83)]?_0x19e765(0x34f):_0x19e765(0x1190),_0x5f2fd8=_0x3e72d8[_0x19e765(0xfcf)]>0x0?_0x19e765(0x75c)+_0x3f7f7a(_0x3e72d8[_0x19e765(0xfcf)])+')':'';_0x8245fc+=_0x19e765(0x760)+_0x31f5db+'“'+_0x3f3a9f['name']+_0x19e765(0x69f)+_0x5f2fd8+_0x19e765(0x1439);const _0x2dd1df=_0x3f3a9f[_0x19e765(0xce3)][_0x19e765(0x5cc)](-_0x3ac49e),_0x16a5eb=_0x2dd1df['filter'](_0x2bad4e=>!String(_0x2bad4e[_0x19e765(0x128c)])[_0x19e765(0xe82)]('已被用户删除'));_0x16a5eb[_0x19e765(0x58a)]>0x0?_0x16a5eb[_0x19e765(0x59b)](_0x442c63=>{const _0x4a7d5f=_0x19e765,_0x35c19f=_0x442c63[_0x4a7d5f(0xfbb)]===_0x4a7d5f(0x860)?_0x3f3a9f[_0x4a7d5f(0x6a8)][_0x4a7d5f(0xe31)]||'我':_0x442c63[_0x4a7d5f(0xfb7)]||_0x3f3a9f[_0x4a7d5f(0x5d2)];let _0x5a6993=String(_0x442c63['content']);if(_0x442c63[_0x4a7d5f(0xcbd)]===_0x4a7d5f(0xce9)||_0x442c63[_0x4a7d5f(0xcbd)]===_0x4a7d5f(0xe86))_0x5a6993='[发送了一张图片，描述为：'+_0x442c63[_0x4a7d5f(0x128c)]+']';else _0x442c63[_0x4a7d5f(0xcbd)]===_0x4a7d5f(0xd83)&&(_0x5a6993=_0x4a7d5f(0x14d4)+_0x442c63['content']+']');_0x8245fc+=_0x35c19f+':\x20'+_0x5a6993+'\x0a';}):_0x8245fc+='(暂无有效聊天记录)\x0a';}}let _0x2aac88='';if(_0x1949ac['length']>0x0){let _0x20cb9c=_0x19e765(0x103a);for(const _0x119171 of _0x1949ac){let _0x5d43c3;if(_0x119171['authorId']===_0x19e765(0x860))_0x5d43c3=_0x1ae02e[_0x19e765(0x11ef)]['nickname'];else{if(String(_0x119171[_0x19e765(0x12cf)])[_0x19e765(0xebf)](_0x19e765(0x27f)))_0x5d43c3=_0x119171[_0x19e765(0x24c)]||_0x19e765(0xa4f);else{const _0x2141a0=_0x1ae02e[_0x19e765(0x589)][_0x119171[_0x19e765(0x12cf)]];_0x5d43c3=_0x2141a0?_0x2141a0[_0x19e765(0x5d2)]:'一位朋友';}}if(_0x119171['authorId']===_0x1e2735)_0x5d43c3+=_0x19e765(0x1fe);let _0x9bc3a7;if(_0x119171[_0x19e765(0xcbd)]===_0x19e765(0x1209)){const _0x110c14=_0x119171['repostComment']?'并评论说：\x22'+_0x119171['repostComment']+'\x22':'';let _0x5df7d1='原作者';const _0x51e99e=_0x119171[_0x19e765(0x305)]['authorId'];if(_0x51e99e==='user')_0x5df7d1=_0x1ae02e[_0x19e765(0x11ef)][_0x19e765(0xb46)];else _0x1ae02e[_0x19e765(0x589)][_0x51e99e]&&(_0x5df7d1=_0x1ae02e[_0x19e765(0x589)][_0x51e99e][_0x19e765(0x5d2)]);let _0x4517a4;const _0x1379a4=_0x119171[_0x19e765(0x305)];if(_0x1379a4['type']===_0x19e765(0x10ea))_0x4517a4=_0x19e765(0x1119)+(_0x1379a4[_0x19e765(0xf1f)]||'')+'\x20(图片描述:\x20\x22'+(_0x1379a4[_0x19e765(0x1090)]||'')[_0x19e765(0x516)](0x0,0x28)+_0x19e765(0x46d);else _0x1379a4[_0x19e765(0xcbd)]===_0x19e765(0x7e5)?_0x4517a4='[图片]\x20'+(_0x1379a4['publicText']||'')+'\x20(图片描述:\x20\x22'+(_0x1379a4['imageDescription']||'')[_0x19e765(0x516)](0x0,0x28)+_0x19e765(0x46d):_0x4517a4='\x22'+(_0x1379a4[_0x19e765(0x128c)]||'')['substring'](0x0,0x28)+_0x19e765(0x34b);_0x9bc3a7=_0x19e765(0x126e)+_0x5df7d1+'\x20的动态\x20'+_0x110c14+_0x19e765(0x6b2)+_0x4517a4+'】';}else{if(_0x119171[_0x19e765(0xcbd)]===_0x19e765(0x10ea))_0x9bc3a7=(_0x19e765(0x24d)+_0x119171[_0x19e765(0x1090)]+_0x19e765(0x156d)+(_0x119171[_0x19e765(0xf1f)]||''))[_0x19e765(0x516)](0x0,0x32)+'...';else{if(_0x119171[_0x19e765(0xcbd)]===_0x19e765(0x7e5))_0x9bc3a7=(_0x19e765(0xb2b)+_0x119171[_0x19e765(0x91d)]+_0x19e765(0x156d)+(_0x119171[_0x19e765(0xf1f)]||''))[_0x19e765(0x516)](0x0,0x32)+_0x19e765(0x629);else{if(_0x119171[_0x19e765(0xcbd)]===_0x19e765(0x132a)&&_0x119171[_0x19e765(0x1063)]){const _0x221225=Array[_0x19e765(0x121f)](_0x119171[_0x19e765(0x1063)])?_0x119171['prompt']:[_0x119171[_0x19e765(0x1063)]];_0x9bc3a7=(_0x119171[_0x19e765(0xf1f)]||'')+('\x20[包含'+_0x221225[_0x19e765(0x58a)]+_0x19e765(0x13b8)+_0x221225[_0x19e765(0x1143)](',\x20')+']');}else _0x9bc3a7=String(_0x119171[_0x19e765(0xf1f)]||_0x119171[_0x19e765(0x128c)]||'一条动态')[_0x19e765(0x516)](0x0,0x32)+_0x19e765(0x629);}}}_0x20cb9c+=_0x19e765(0x14f4)+_0x119171['id']+_0x19e765(0x9ff)+_0x5d43c3+',\x20内容:\x20\x22'+_0x9bc3a7+'\x22\x0a';if(_0x119171[_0x19e765(0x10ae)]&&_0x119171[_0x19e765(0x10ae)][_0x19e765(0x58a)]>0x0)for(const _0xbb3323 of _0x119171[_0x19e765(0x10ae)]){if(typeof _0xbb3323==='object'&&_0xbb3323[_0x19e765(0xe27)]){const _0x4d7415=_0x34f6a8(_0xbb3323[_0x19e765(0xe27)]);let _0x17e96d=_0xbb3323['meaning']?'[表情:\x20\x27'+_0xbb3323['meaning']+'\x27]':_0xbb3323[_0x19e765(0x40f)];_0xbb3323[_0x19e765(0xe27)]===_0x3b3a58[_0x19e765(0x96f)]?_0x20cb9c+=_0x19e765(0x14b5)+_0x17e96d+'\x0a':_0x20cb9c+=_0x19e765(0x6da)+_0x4d7415+_0x19e765(0x85b)+_0xbb3323[_0x19e765(0xe27)]+_0x19e765(0x126a)+_0x17e96d+'\x0a';}}}_0x2aac88=_0x20cb9c;}const _0x543798=_0x19e765(0x1111)+(_0x3b3a58[_0x19e765(0x5fb)]&&_0x3b3a58[_0x19e765(0x5fb)][_0x19e765(0x58a)]>0x0?_0x3b3a58[_0x19e765(0x5fb)][_0x19e765(0x1431)](_0x1b8877=>_0x19e765(0x10a4)+_0x3f7f7a(_0x1b8877[_0x19e765(0x1388)])+')\x20'+_0x1b8877[_0x19e765(0x128c)])[_0x19e765(0x1143)]('\x0a'):_0x19e765(0x1384)),_0x56119a=_0x5a2518(_0x3b3a58,0x3,_0x19e765(0x5f2)),_0x3aca2e=_0x5a2518(_0x3b3a58,0x6,_0x19e765(0x5f2)),_0x1590f=_0x5a2518(_0x3b3a58,0x9,_0x19e765(0x5f2)),_0x37abf1=_0x5a2518(_0x3b3a58,0x1,_0x19e765(0x1265)),_0x1a07ad=_0x5a2518(_0x3b3a58,0x3,_0x19e765(0x1265)),_0x3b550f=_0x5a2518(_0x3b3a58,0x7,_0x19e765(0x1265));let _0x2f5154='';if(_0x56119a||_0x3aca2e||_0x1590f||_0x37abf1||_0x1a07ad||_0x3b550f){_0x2f5154+=_0x19e765(0x135e);if(_0x56119a)_0x2f5154+=_0x56119a;if(_0x3aca2e)_0x2f5154+=_0x3aca2e;if(_0x1590f)_0x2f5154+=_0x1590f;if(_0x56119a||_0x3aca2e||_0x1590f)_0x2f5154+='\x0a';if(_0x37abf1)_0x2f5154+=_0x37abf1;if(_0x1a07ad)_0x2f5154+=_0x1a07ad;if(_0x3b550f)_0x2f5154+=_0x3b550f;}const _0x18c0a2=_0x1df3df(_0x3b3a58),_0x2ecd02=_0x19e765(0x70c)+_0x3b3a58[_0x19e765(0x5d2)]+_0x19e765(0x958)+_0x3b3a58[_0x19e765(0x96f)]+_0x19e765(0xcf5)+_0x3eb7c+_0x19e765(0x10de)+(_0x3b3a58[_0x19e765(0x6a8)][_0x19e765(0x885)]?_0x19e765(0xb70)+_0x53079d+'\x20('+_0x2a19a0+_0x19e765(0xc10)+_0x175d79+'\x0a'+(_0x147a23?_0x19e765(0xde5):''):'')+_0x19e765(0xe20)+(_0x3b3a58[_0x19e765(0x1154)]||'无')+_0x19e765(0xb2e)+_0x1131dc+_0x19e765(0x20e)+_0x2b1075+_0x19e765(0x1106)+_0x3b3a58[_0x19e765(0x6a8)][_0x19e765(0xf42)]+_0x19e765(0x20e)+_0x5b5012+_0x19e765(0x20e)+(_0x3b3a58['longTermMemory']&&_0x3b3a58[_0x19e765(0x5fb)][_0x19e765(0x58a)]>0x0?_0x3b3a58['longTermMemory']['map'](_0x1ca273=>_0x19e765(0x10a4)+_0x3f7f7a(_0x1ca273[_0x19e765(0x1388)])+')\x20'+_0x1ca273[_0x19e765(0x128c)])['join']('\x0a'):'无')+_0x19e765(0x20e)+_0x2f5154+_0x19e765(0xb61)+_0x8245fc+_0x19e765(0x20e)+(_0x3b3a58[_0x19e765(0x6a8)][_0x19e765(0x885)]?_0x19e765(0x145a)+_0x53079d+'\x20('+_0x2a19a0+')':'')+_0x19e765(0x20e)+(_0x3b3a58[_0x19e765(0x6a8)][_0x19e765(0x885)]?_0x19e765(0xf22)+_0x175d79:'')+_0x19e765(0x12c9)+_0x18c0a2+_0x19e765(0x27b)+_0x5eca07+_0x19e765(0x20e)+_0x2aac88+'\x0a',_0x23e5cd=[{'role':_0x19e765(0x1594),'content':_0x2ecd02},..._0x5af9c7[_0x19e765(0x1431)](_0x252224=>{const _0x3f32d2=_0x19e765,_0x532ccd=_0x252224[_0x3f32d2(0xfbb)]===_0x3f32d2(0x860)?_0x3eb7c:_0x3b3a58[_0x3f32d2(0x5d2)];let _0x124c5f=_0x252224[_0x3f32d2(0x128c)];return typeof _0x124c5f!==_0x3f32d2(0x6c3)&&(_0x124c5f=JSON[_0x3f32d2(0x994)](_0x124c5f)),{'role':_0x252224['role'],'content':_0x532ccd+':\x20'+_0x124c5f};})];try{const _0x58be9e=[{'role':_0x19e765(0x860),'content':_0x2ecd02+_0x19e765(0x71a)+_0x2aac88}];console[_0x19e765(0x57e)]('正在为后台活动发送API请求\x20(\x22'+_0x3b3a58[_0x19e765(0x5d2)]+'\x22)');let _0x3ceed9=_0xdb35de===GEMINI_API_URL,_0x9b169f=_0x16b978(_0x4db48a,_0x434681,_0x2ecd02,_0x58be9e);const _0x5b2386=_0x3ceed9?await fetch(_0x9b169f[_0x19e765(0x258)],_0x9b169f[_0x19e765(0xc6b)]):await fetch(_0xdb35de+_0x19e765(0x14c2),{'method':_0x19e765(0x12d9),'headers':{'Content-Type':_0x19e765(0xa90),'Authorization':_0x19e765(0xf03)+_0x434681},'body':JSON['stringify']({'model':_0x4db48a,'messages':_0x58be9e,'temperature':_0x1ae02e[_0x19e765(0x12c0)][_0x19e765(0x217)]||0.9})});if(!_0x5b2386['ok']){const _0x20212b=await _0x5b2386[_0x19e765(0xb84)]();throw new Error('API请求失败:\x20'+_0x5b2386[_0x19e765(0x1589)]+'\x20-\x20'+JSON['stringify'](_0x20212b));}const _0x1f4270=await _0x5b2386[_0x19e765(0xb84)](),_0xcc41b3=_0x3ceed9?getGeminiResponseText(_0x1f4270):_0x1f4270[_0x19e765(0x10be)][0x0][_0x19e765(0x11f0)][_0x19e765(0x128c)];if(!_0xcc41b3||_0xcc41b3[_0x19e765(0x4a2)]()===''){console[_0x19e765(0xb3b)](_0x19e765(0x40b)+_0x3b3a58[_0x19e765(0x5d2)]+_0x19e765(0xd9d));return;}const _0x447907=_0x1493d9(_0xcc41b3);if(!_0x447907||_0x447907[_0x19e765(0x58a)]===0x0){console[_0x19e765(0xb3b)](_0x19e765(0x10f5)+_0x3b3a58['name']+_0x19e765(0xc73),_0xcc41b3);return;}let _0x4bc030=Date[_0x19e765(0xd6e)](),_0x3f39cb=![];const _0x26202d=[];for(const _0x14dd38 of _0x447907){const _0x34614f=String(_0x14dd38[_0x19e765(0x128c)]||''),_0x2b3627=_0x34614f['trim']()[_0x19e765(0xebf)]('<')&&_0x34614f[_0x19e765(0x4a2)]()[_0x19e765(0x324)]('>');if(_0x14dd38[_0x19e765(0xcbd)]===_0x19e765(0x40f)&&!_0x2b3627&&_0x34614f[_0x19e765(0xe82)]('\x0a')){const _0x5626e9=_0x34614f[_0x19e765(0x23f)](/\n+/)[_0x19e765(0xede)](_0x27e6a3=>_0x27e6a3['trim']());_0x5626e9[_0x19e765(0x59b)](_0x435f65=>{_0x26202d['push']({..._0x14dd38,'content':_0x435f65});});}else _0x26202d['push'](_0x14dd38);}for(const _0x53fe6b of _0x26202d){_0x3b3a58[_0x19e765(0x1154)]=_0x53fe6b[_0x19e765(0xcbd)],_0x3b3a58[_0x19e765(0x1ac)]=_0x4bc030;let _0xabe557=null;const _0x3e1e2a={'role':_0x19e765(0x13c0),'senderName':_0x3b3a58[_0x19e765(0x96f)],'timestamp':_0x4bc030++};let _0x5434ca=null;switch(_0x53fe6b[_0x19e765(0xcbd)]){case _0x19e765(0x15c0):{const _0x11587b=parseInt(_0x53fe6b['postId']),_0x17b791=await _0x3df81a['qzonePosts'][_0x19e765(0x13f8)](_0x11587b);if(_0x17b791&&_0x17b791[_0x19e765(0x12cf)]===_0x1e2735){await _0x3df81a[_0x19e765(0x910)][_0x19e765(0xf18)](_0x11587b,{'isDeleted':!![]});document[_0x19e765(0x1f4)]('qzone-screen')[_0x19e765(0x159b)][_0x19e765(0xaea)](_0x19e765(0x7cf))&&_0x28d6f7();const _0x33e1a6={'role':'system','type':_0x19e765(0xe5a),'content':'['+_0x3b3a58[_0x19e765(0x5d2)]+'\x20删除了自己的一条动态]','postId':_0x11587b,'timestamp':_0x4bc030++};_0x3b3a58[_0x19e765(0xce3)][_0x19e765(0x1426)](_0x33e1a6),isViewingThisChat?_0x5286f1(_0x33e1a6,_0x3b3a58):(_0x3b3a58[_0x19e765(0xf2c)]=(_0x3b3a58[_0x19e765(0xf2c)]||0x0)+0x1,_0x158e58(_0x1e2735,'['+_0x3b3a58['name']+_0x19e765(0x36f)),_0x3f39cb=!![]);}else console[_0x19e765(0xb3b)](_0x19e765(0xdbf)+_0x3b3a58[_0x19e765(0x5d2)]+'\x22\x20尝试删除一个不存在或不属于自己的动态\x20(ID:\x20'+_0x53fe6b['postId']+')');continue;}case _0x19e765(0x40f):_0xabe557={..._0x3e1e2a,'content':_0x53fe6b[_0x19e765(0x128c)]};break;case _0x19e765(0xce9):_0xabe557={..._0x3e1e2a,'type':_0x19e765(0xce9),'content':_0x53fe6b[_0x19e765(0xdec)]};break;case _0x19e765(0x1b3):if(_0x53fe6b['meaning']){const _0x2f048b=_0x1ae02e[_0x19e765(0x1420)][_0x19e765(0x13b7)](_0x2976f8=>_0x2976f8[_0x19e765(0x5d2)]===_0x53fe6b[_0x19e765(0x339)]);_0x2f048b?_0xabe557={..._0x3e1e2a,'type':_0x19e765(0x1b3),'content':_0x2f048b[_0x19e765(0x258)],'meaning':_0x2f048b[_0x19e765(0x5d2)]}:(console[_0x19e765(0xb3b)]('AI\x20(独立行动)\x20尝试使用一个不存在的表情:\x20\x22'+_0x53fe6b[_0x19e765(0x339)]+'\x22'),_0xabe557={..._0x3e1e2a,'type':'text','content':_0x19e765(0xe39)+_0x53fe6b[_0x19e765(0x339)]+']'});}else console[_0x19e765(0xb3b)](_0x19e765(0x135c),_0x53fe6b),_0xabe557={..._0x3e1e2a,'type':_0x19e765(0x1b3),'content':_0x53fe6b['url'],'meaning':_0x19e765(0x12bc)};break;case _0x19e765(0x768):_0x3b3a58[_0x19e765(0x1589)][_0x19e765(0x40f)]=_0x53fe6b[_0x19e765(0xd22)],_0x3b3a58[_0x19e765(0x1589)]['isBusy']=_0x53fe6b['is_busy']||![],_0x3b3a58[_0x19e765(0x1589)][_0x19e765(0x14d1)]=Date[_0x19e765(0xd6e)]();break;case _0x19e765(0x4e1):const _0x2a7e5c={'type':_0x53fe6b[_0x19e765(0x14e3)],'content':_0x53fe6b[_0x19e765(0x128c)]||'','publicText':_0x53fe6b['publicText']||'','hiddenContent':_0x53fe6b[_0x19e765(0x1090)]||'','image_prompt':_0x53fe6b[_0x19e765(0x1248)]||'','timestamp':Date[_0x19e765(0xd6e)](),'authorId':_0x1e2735,'authorOriginalName':_0x3b3a58['originalName'],'authorGroupId':_0x3b3a58['groupId'],'visibleGroupIds':null};await _0x3df81a[_0x19e765(0x910)]['add'](_0x2a7e5c),_0xfc0942(_0x496f96+0x1),console['log'](_0x19e765(0xc21)+_0x3b3a58['name']+_0x19e765(0x500));break;case _0x19e765(0x1209):const _0x36f292=await _0x3df81a['qzonePosts'][_0x19e765(0x13f8)](parseInt(_0x53fe6b[_0x19e765(0xd8f)]));if(_0x36f292){const _0x5d422b={'type':_0x19e765(0x1209),'timestamp':Date[_0x19e765(0xd6e)](),'authorId':_0x1e2735,'authorGroupId':_0x3b3a58[_0x19e765(0x67d)],'authorOriginalName':_0x3b3a58['originalName'],'repostComment':_0x53fe6b[_0x19e765(0x306)]||'','originalPost':_0x36f292,'visibleGroupIds':null};await _0x3df81a['qzonePosts'][_0x19e765(0x6a4)](_0x5d422b),_0xfc0942(_0x496f96+0x1),console[_0x19e765(0x57e)](_0x19e765(0xc21)+_0x3b3a58[_0x19e765(0x5d2)]+'\x22\x20转发了动态\x20#'+_0x53fe6b['postId']);}break;case _0x19e765(0x252):const _0x4e714f=await _0x3df81a['qzonePosts']['get'](parseInt(_0x53fe6b['postId']));if(_0x4e714f){if(!_0x4e714f[_0x19e765(0xb09)])_0x4e714f[_0x19e765(0xb09)]=[];!_0x4e714f['likes'][_0x19e765(0xe82)](_0x3b3a58[_0x19e765(0x96f)])&&(_0x4e714f['likes'][_0x19e765(0x1426)](_0x3b3a58['originalName']),await _0x3df81a['qzonePosts']['update'](_0x4e714f['id'],{'likes':_0x4e714f[_0x19e765(0xb09)]}),_0xfc0942(_0x496f96+0x1),console[_0x19e765(0x57e)](_0x19e765(0xc21)+_0x3b3a58[_0x19e765(0x5d2)]+_0x19e765(0xd21)+_0x53fe6b[_0x19e765(0xd8f)]));}break;case'qzone_comment':{const _0x1cd614=await _0x3df81a[_0x19e765(0x910)][_0x19e765(0x13f8)](parseInt(_0x53fe6b['postId']));if(_0x1cd614){if(!_0x1cd614[_0x19e765(0x10ae)])_0x1cd614['comments']=[];const _0x343fef=_0x53fe6b[_0x19e765(0x5d2)]||_0x3b3a58[_0x19e765(0x96f)],_0x137b7e=(_0x3823d9,_0x1523ea=null,_0x4bb1c9=null)=>({'commenterName':_0x343fef,'text':_0x5ed2b0(_0x3823d9,_0x3b3a58),'meaning':_0x1523ea,'replyTo':_0x4bb1c9,'timestamp':Date[_0x19e765(0xd6e)]()});if(_0x53fe6b['stickerMeaning']){const _0x357cb9=_0x1ae02e[_0x19e765(0x1420)]['find'](_0x8ed109=>_0x8ed109['name']===_0x53fe6b['stickerMeaning']);_0x357cb9?_0x1cd614['comments'][_0x19e765(0x1426)](_0x137b7e(_0x357cb9[_0x19e765(0x258)],_0x357cb9['name'],_0x53fe6b[_0x19e765(0xef4)]||null)):(console[_0x19e765(0xb3b)](_0x19e765(0xe7b)+_0x53fe6b[_0x19e765(0xb68)]+'\x22'),_0x1cd614[_0x19e765(0x10ae)][_0x19e765(0x1426)](_0x137b7e('[表情:\x20'+_0x53fe6b['stickerMeaning']+']',null,_0x53fe6b['replyTo']||null)));}else{if(Array['isArray'](_0x53fe6b['comments']))_0x53fe6b[_0x19e765(0x10ae)][_0x19e765(0x59b)](_0xefc954=>{const _0x273e88=_0x19e765;typeof _0xefc954===_0x273e88(0x6c3)&&_0xefc954[_0x273e88(0x4a2)]()&&_0x1cd614['comments'][_0x273e88(0x1426)](_0x137b7e(_0xefc954,null,_0x53fe6b['replyTo']||null));});else typeof _0x53fe6b[_0x19e765(0xf6c)]==='string'&&_0x53fe6b[_0x19e765(0xf6c)][_0x19e765(0x4a2)]()&&_0x1cd614['comments'][_0x19e765(0x1426)](_0x137b7e(_0x53fe6b[_0x19e765(0xf6c)],null,_0x53fe6b['replyTo']||null));}await _0x3df81a['qzonePosts']['update'](_0x1cd614['id'],{'comments':_0x1cd614['comments']}),_0xfc0942(_0x496f96+0x1),console[_0x19e765(0x57e)](_0x19e765(0xc21)+_0x3b3a58[_0x19e765(0x5d2)]+_0x19e765(0x939)+_0x53fe6b[_0x19e765(0xd8f)]);if(!_0x3b3a58[_0x19e765(0x11a8)])_0x3b3a58['commentCooldowns']={};_0x3b3a58[_0x19e765(0x11a8)][_0x53fe6b[_0x19e765(0xd8f)]]=Date[_0x19e765(0xd6e)]();}continue;}case _0x19e765(0x1293):!_0x11ced0['isActive']&&!_0x11ced0['isAwaitingResponse']&&(_0x11ced0[_0x19e765(0x116c)]=!![],_0x11ced0[_0x19e765(0x588)]=_0x1e2735,_0x11ced0[_0x19e765(0xd5e)]=![],_0x11ced0[_0x19e765(0x108f)]=_0x3b3a58[_0x19e765(0x5d2)],_0x165339());break;default:console[_0x19e765(0xb3b)]('角色\x20\x22'+_0x3b3a58[_0x19e765(0x5d2)]+'\x22\x20尝试执行未知的后台动作:',_0x53fe6b[_0x19e765(0xcbd)]);break;case _0x19e765(0x332):{const _0xed7e0=_0x53fe6b[_0x19e765(0x5d2)],_0x56a348=_0x3b3a58[_0x19e765(0x6a8)][_0x19e765(0xb77)][_0x19e765(0x13b7)](_0x1ca630=>_0x1ca630[_0x19e765(0x5d2)]===_0xed7e0);_0x56a348&&(_0x3b3a58[_0x19e765(0x6a8)]['aiAvatar']=_0x56a348['url'],await _0x3901ec(_0x3b3a58),visibleSystemMessage={'content':'['+_0x3b3a58[_0x19e765(0x5d2)]+'\x20更换了头像]'},console['log'](_0x19e765(0xc21)+_0x3b3a58[_0x19e765(0x5d2)]+_0x19e765(0x1231)));break;}}if(_0xabe557){_0x3b3a58[_0x19e765(0xce3)]['push'](_0xabe557),_0x3b3a58[_0x19e765(0xf2c)]=(_0x3b3a58[_0x19e765(0xf2c)]||0x0)+0x1;if(!_0x3f39cb){let _0x1eb37d=_0xabe557['type']==='ai_image'?_0x19e765(0x947):_0xabe557[_0x19e765(0x128c)]||'';_0x158e58(_0x1e2735,_0x1eb37d),_0x3f39cb=!![];}}}await _0x3df81a[_0x19e765(0x589)][_0x19e765(0x295)](_0x3b3a58);}catch(_0x3f6c15){console['error']('角色\x20\x22'+_0x3b3a58[_0x19e765(0x5d2)]+_0x19e765(0xa99),_0x3f6c15);}finally{_0x450e6f(_0x1e2735,![]),_0x1033ae(),document['getElementById']('qzone-screen')['classList'][_0x19e765(0xaea)](_0x19e765(0x7cf))&&_0x28d6f7();}}async function _0x1fd72d(_0x531f45){const _0xc1bdd8=_0x2b1222,_0x4d5462=_0x1ae02e['chats'][_0x531f45];if(!_0x4d5462||!_0x4d5462[_0xc1bdd8(0xe83)])return;const _0x2b29f9=_0x4d5462[_0xc1bdd8(0x6a8)][_0xc1bdd8(0xfa7)]||0xa;if(_0x4d5462[_0xc1bdd8(0x1ac)]){const _0x2bf50d=(Date['now']()-_0x4d5462['lastActionTimestamp'])/(0x3e8*0x3c);if(_0x2bf50d<_0x2b29f9){console[_0xc1bdd8(0x57e)](_0xc1bdd8(0xc4e)+_0x4d5462[_0xc1bdd8(0x5d2)]+_0xc1bdd8(0x7b2));return;}}const {proxyUrl:_0x3fc32e,apiKey:_0x81e7ef,model:_0x30d983}=_0x1ae02e[_0xc1bdd8(0x226)];if(!_0x3fc32e||!_0x81e7ef||!_0x30d983)return;const _0x518e25=_0x4d5462['settings'][_0xc1bdd8(0xe31)]||'我',_0x3f90bc=new Date();let _0x31f6ef;const _0x30eff2=_0x4d5462['history'][_0xc1bdd8(0xede)](_0x4bf7a6=>!_0x4bf7a6[_0xc1bdd8(0x58e)])['slice'](-0x5),_0x4a6b67=_0x30eff2[_0xc1bdd8(0x13b7)](_0x53d3ae=>_0x53d3ae['type']===_0xc1bdd8(0x601)&&!_0x53d3ae['isFullyClaimed']);if(_0x4a6b67){const _0x5cadd2=_0x140540(_0x4d5462,_0x4a6b67[_0xc1bdd8(0xfb7)]);console[_0xc1bdd8(0x57e)](_0xc1bdd8(0x927)+_0x4d5462['name']+_0xc1bdd8(0x9a2)),_0x31f6ef=_0xc1bdd8(0x9d0)+_0x5cadd2+_0xc1bdd8(0xcaa)+_0x4a6b67['timestamp']+'）。\x0a\x20\x20\x20\x20\x20\x20\x20\x20你的任务是：选择【一个或多个】符合人设的角色，让他们【立刻】使用\x20\x27open_red_packet\x27\x20指令去尝试领取这个红包。\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20指令格式\x0a\x20\x20\x20\x20\x20\x20\x20\x20你的回复【必须】是一个JSON数组，格式如下：\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x27[{\x22type\x22:\x20\x22open_red_packet\x22,\x20\x22name\x22:\x20\x22角色本名\x22,\x20\x22packet_timestamp\x22:\x20'+_0x4a6b67['timestamp']+_0xc1bdd8(0x10da);}else{let _0x461a6e='';const _0x5878a1=_0x4d5462['settings'][_0xc1bdd8(0x63f)]||_0xc1bdd8(0x1001),_0x54eeb5=_0x3f90bc[_0xc1bdd8(0x613)](_0xc1bdd8(0xd02),{'timeZone':_0x5878a1,'dateStyle':_0xc1bdd8(0x82e),'timeStyle':_0xc1bdd8(0x144f)}),_0x58a95f=new Date(_0x3f90bc[_0xc1bdd8(0x613)](_0xc1bdd8(0xaa2),{'timeZone':_0x5878a1}));if(_0x4d5462[_0xc1bdd8(0x6a8)][_0xc1bdd8(0x885)]){const _0x1dd994=_0x4d5462[_0xc1bdd8(0xce3)][_0xc1bdd8(0xede)](_0x582e32=>!_0x582e32[_0xc1bdd8(0x58e)])[_0xc1bdd8(0x5cc)](-0x1)[0x0];if(_0x1dd994){const _0x5a42ba=new Date(_0x1dd994[_0xc1bdd8(0x1388)]),_0x277062=(_0x3f90bc-_0x5a42ba)/(0x3e8*0x3c);_0x277062>0x3c?_0x461a6e=_0xc1bdd8(0x1485)+Math['round'](_0x277062/0x3c)+_0xc1bdd8(0x19b):_0x461a6e=_0xc1bdd8(0x906)+Math[_0xc1bdd8(0x123c)](_0x277062)+_0xc1bdd8(0x2e3);}else _0x461a6e=_0xc1bdd8(0xc55);}let _0x33de52=_0xc1bdd8(0xc7c);const _0x38312a=_0x4d5462[_0xc1bdd8(0x6a8)][_0xc1bdd8(0x4b2)]||0xa,_0x326986=_0x4d5462['history'][_0xc1bdd8(0xede)](_0x4e6728=>!_0x4e6728['isHidden'])[_0xc1bdd8(0x5cc)](-_0x38312a);_0x326986[_0xc1bdd8(0x58a)]>0x0&&(_0x33de52=_0xc1bdd8(0x40d)+_0x326986['map'](_0x45b213=>{const _0x46d807=_0xc1bdd8,_0x31e41c=_0x45b213[_0x46d807(0xfbb)]===_0x46d807(0x860)?_0x518e25:_0x140540(_0x4d5462,_0x45b213[_0x46d807(0xfb7)]),_0x40ae9b=String(_0x45b213[_0x46d807(0x128c)]||_0x45b213[_0x46d807(0x11f0)]||'')[_0x46d807(0x516)](0x0,0x32);return _0x31e41c+':\x20'+_0x40ae9b+_0x46d807(0x629);})[_0xc1bdd8(0x1143)]('\x0a'));const _0x273ae7=_0x4d5462[_0xc1bdd8(0x1402)][_0xc1bdd8(0x1431)](_0x3b7d15=>_0xc1bdd8(0x6ca)+_0x3b7d15[_0xc1bdd8(0xd69)]+_0xc1bdd8(0x104e)+_0x3b7d15[_0xc1bdd8(0x96f)]+_0xc1bdd8(0x126a)+_0x3b7d15[_0xc1bdd8(0x3be)])['join']('\x0a');let _0x5101b0='#\x20长期记忆\x20(最高优先级，这是群内已经确立的事实，所有角色必须严格遵守)\x0a',_0x4ac70c=![];_0x4d5462['members'][_0xc1bdd8(0x59b)](_0x3d8b5b=>{const _0xe8a6d5=_0xc1bdd8,_0x371b96=_0x1ae02e['chats'][_0x3d8b5b['id']];_0x371b96&&_0x371b96[_0xe8a6d5(0x5fb)]&&_0x371b96[_0xe8a6d5(0x5fb)][_0xe8a6d5(0x58a)]>0x0&&(_0x5101b0+=_0xe8a6d5(0x13c5)+_0x3d8b5b[_0xe8a6d5(0xd69)]+_0xe8a6d5(0x12f4),_0x5101b0+=_0x371b96[_0xe8a6d5(0x5fb)][_0xe8a6d5(0x1431)](_0x2d9ba5=>'-\x20'+_0x2d9ba5[_0xe8a6d5(0x128c)])[_0xe8a6d5(0x1143)]('\x0a'),_0x4ac70c=!![]);});!_0x4ac70c&&(_0x5101b0+=_0xc1bdd8(0x1384));let _0x4e506c='';if(_0x4d5462[_0xc1bdd8(0x6a8)][_0xc1bdd8(0x1469)]&&_0x4d5462[_0xc1bdd8(0x6a8)][_0xc1bdd8(0x1469)][_0xc1bdd8(0x58a)]>0x0){const _0x5bbcc7=_0x4d5462[_0xc1bdd8(0x6a8)][_0xc1bdd8(0x1469)][_0xc1bdd8(0x1431)](_0x39e60b=>{const _0x1b946f=_0xc1bdd8,_0x14eb2d=_0x1ae02e['worldBooks'][_0x1b946f(0x13b7)](_0x22892b=>_0x22892b['id']===_0x39e60b);if(!_0x14eb2d||!Array[_0x1b946f(0x121f)](_0x14eb2d[_0x1b946f(0x128c)]))return'';const _0x1a992c=_0x14eb2d[_0x1b946f(0x128c)]['filter'](_0x374b92=>_0x374b92[_0x1b946f(0x1368)]!==![])[_0x1b946f(0x1431)](_0x378d0b=>{const _0x226eac=_0x1b946f;let _0x5e39b4=_0x226eac(0x272)+(_0x378d0b[_0x226eac(0x306)]||_0x226eac(0x286))+'\x0a';return _0x378d0b['keys']['length']>0x0&&(_0x5e39b4+=_0x226eac(0x935)+_0x378d0b[_0x226eac(0x1378)]['join'](',\x20')+'\x0a'),_0x5e39b4+=_0x226eac(0x3d9)+_0x378d0b[_0x226eac(0x128c)],_0x5e39b4;})[_0x1b946f(0x1143)]('');return _0x1a992c?_0x1b946f(0x404)+_0x14eb2d['name']+'\x0a'+_0x1a992c:'';})[_0xc1bdd8(0xede)](Boolean)[_0xc1bdd8(0x1143)]('');_0x5bbcc7&&(_0x4e506c='#\x20---\x20世界书\x20(World\x20Book)\x20---\x0a#\x20【最高优先级规则：世界观设定】\x0a#\x20你【必须】将以下所有“世界书”中的设定，视为绝对的、不可动摇的背景事实。\x0a#\x20你的所有回复和行为都【绝对不能】与这些设定产生任何冲突。\x0a'+_0x5bbcc7+_0xc1bdd8(0x47a));}let _0x38aa88='';const _0x7a1b61=_0x4d5462['settings']['linkedMemoryCount']||0xa;if(_0x4d5462[_0xc1bdd8(0x6a8)]['linkedMemoryChatIds']&&_0x4d5462[_0xc1bdd8(0x6a8)]['linkedMemoryChatIds']['length']>0x0){const _0x53df72=_0x4d5462[_0xc1bdd8(0x6a8)]['linkedMemoryChatIds']['map'](_0x28d140=>{const _0x863576=_0xc1bdd8,_0x3a84a1=_0x1ae02e[_0x863576(0x589)][_0x28d140];if(!_0x3a84a1)return null;const _0x57407b=_0x3a84a1['history'][_0x863576(0x5cc)](-0x1)[0x0];return{'chat':_0x3a84a1,'latestTimestamp':_0x57407b?_0x57407b[_0x863576(0x1388)]:0x0};})[_0xc1bdd8(0xede)](Boolean);_0x53df72['sort']((_0x1bb9bb,_0x198721)=>_0x198721[_0xc1bdd8(0xfcf)]-_0x1bb9bb['latestTimestamp']),_0x38aa88+='\x0a\x0a#\x20参考记忆\x20(至关重要！群内角色必须【主动】将这些参考记忆中的【关键信息和事件】，自然地融入到当前的对话中，以体现你们拥有完整的共同记忆。)\x0a';for(const _0x4b3357 of _0x53df72){const _0x3a3345=_0x4b3357[_0xc1bdd8(0x21a)],_0x408765=_0x3a3345[_0xc1bdd8(0xe83)]?_0xc1bdd8(0x34f):'[私聊]',_0x39b35a=_0x4b3357[_0xc1bdd8(0xfcf)]>0x0?_0xc1bdd8(0x75c)+_0x3f7f7a(_0x4b3357[_0xc1bdd8(0xfcf)])+')':'';_0x38aa88+=_0xc1bdd8(0x760)+_0x408765+'“'+_0x3a3345[_0xc1bdd8(0x5d2)]+'”的参考记忆'+_0x39b35a+_0xc1bdd8(0x1439);const _0x4bc970=_0x3a3345['history'][_0xc1bdd8(0x5cc)](-_0x7a1b61),_0x5d380d=_0x4bc970['filter'](_0x1d9ad0=>!String(_0x1d9ad0[_0xc1bdd8(0x128c)])['includes']('已被用户删除'));_0x5d380d['length']>0x0?_0x5d380d['forEach'](_0x3c016e=>{const _0x595b6b=_0xc1bdd8,_0x5abe14=_0x3c016e[_0x595b6b(0xfbb)]===_0x595b6b(0x860)?_0x3a3345[_0x595b6b(0x6a8)][_0x595b6b(0xe31)]||'我':_0x3c016e[_0x595b6b(0xfb7)]||_0x3a3345[_0x595b6b(0x5d2)];let _0x1c762c=String(_0x3c016e[_0x595b6b(0x128c)]);if(_0x3c016e['type']===_0x595b6b(0xce9)||_0x3c016e[_0x595b6b(0xcbd)]===_0x595b6b(0xe86))_0x1c762c=_0x595b6b(0x1287)+_0x3c016e[_0x595b6b(0x128c)]+']';else _0x3c016e[_0x595b6b(0xcbd)]==='voice_message'&&(_0x1c762c='[发送了一条语音，内容是：'+_0x3c016e[_0x595b6b(0x128c)]+']');_0x38aa88+=_0x5abe14+':\x20'+_0x1c762c+'\x0a';}):_0x38aa88+=_0xc1bdd8(0xb13);}}const _0x12ddac=await _0x3df81a['qzonePosts'][_0xc1bdd8(0x931)]('timestamp')[_0xc1bdd8(0x115a)]()[_0xc1bdd8(0x1491)](0x5)[_0xc1bdd8(0x27a)]();let _0x4dd354='';const _0x3cb349=new Set();for(const _0x106352 of _0x4d5462[_0xc1bdd8(0x1402)]){const _0x243bb3=_0x1ae02e[_0xc1bdd8(0x589)][_0x106352['id']];if(_0x243bb3){const _0x1e388d=_0x4f9640(_0x12ddac,_0x243bb3);_0x1e388d[_0xc1bdd8(0x59b)](_0x28ec4c=>_0x3cb349['add'](_0x28ec4c));}}const _0x173dde=new Set(_0x4d5462[_0xc1bdd8(0x1402)][_0xc1bdd8(0x1431)](_0xc3d41f=>_0xc3d41f['originalName'])),_0x3c2346=[..._0x3cb349][_0xc1bdd8(0xede)](_0x57f410=>{const _0x4978c7=_0xc1bdd8,_0x49421c=_0x57f410[_0x4978c7(0xb09)]&&_0x57f410[_0x4978c7(0xb09)][_0x4978c7(0x690)](_0x3bc146=>_0x173dde['has'](_0x3bc146)),_0x31ede9=_0x57f410[_0x4978c7(0x10ae)]&&_0x57f410[_0x4978c7(0x10ae)][_0x4978c7(0x690)](_0x572e83=>typeof _0x572e83===_0x4978c7(0xcc5)&&_0x173dde[_0x4978c7(0xe75)](_0x572e83['commenterName']));return!_0x49421c&&!_0x31ede9;});if(_0x3c2346['length']>0x0){let _0x4b76b0=_0xc1bdd8(0x78f);for(const _0x3c205f of _0x3c2346){let _0x2bf5c1=_0x3c205f['authorId']===_0xc1bdd8(0x860)?_0x518e25:_0x1ae02e[_0xc1bdd8(0x589)][_0x3c205f[_0xc1bdd8(0x12cf)]]?.[_0xc1bdd8(0x5d2)]||'一位朋友',_0x17bf25;if(_0x3c205f[_0xc1bdd8(0xcbd)]===_0xc1bdd8(0x1209)){const _0x15dabf=_0x3c205f[_0xc1bdd8(0x1223)]?_0xc1bdd8(0x12db)+_0x3c205f[_0xc1bdd8(0x1223)]+'”':'';let _0x4eb93a='原作者';const _0x131af1=_0x3c205f['originalPost'][_0xc1bdd8(0x12cf)];if(_0x131af1===_0xc1bdd8(0x860))_0x4eb93a=_0x1ae02e[_0xc1bdd8(0x11ef)][_0xc1bdd8(0xb46)];else _0x1ae02e[_0xc1bdd8(0x589)][_0x131af1]&&(_0x4eb93a=_0x1ae02e['chats'][_0x131af1][_0xc1bdd8(0x5d2)]);let _0x3a301c;const _0x4f8df5=_0x3c205f[_0xc1bdd8(0x305)];if(_0x4f8df5[_0xc1bdd8(0xcbd)]===_0xc1bdd8(0x10ea))_0x3a301c='[文字图]\x20'+(_0x4f8df5[_0xc1bdd8(0xf1f)]||'')+_0xc1bdd8(0xfb3)+(_0x4f8df5[_0xc1bdd8(0x1090)]||'')[_0xc1bdd8(0x516)](0x0,0x28)+_0xc1bdd8(0x51e);else _0x4f8df5[_0xc1bdd8(0xcbd)]===_0xc1bdd8(0x7e5)?_0x3a301c=_0xc1bdd8(0xada)+(_0x4f8df5[_0xc1bdd8(0xf1f)]||'')+_0xc1bdd8(0xfb3)+(_0x4f8df5[_0xc1bdd8(0x91d)]||'')[_0xc1bdd8(0x516)](0x0,0x28)+_0xc1bdd8(0x51e):_0x3a301c='“'+(_0x4f8df5[_0xc1bdd8(0x128c)]||'')[_0xc1bdd8(0x516)](0x0,0x28)+_0xc1bdd8(0x10d7);_0x17bf25=_0xc1bdd8(0x126e)+_0x4eb93a+_0xc1bdd8(0xa30)+_0x15dabf+'【原动态内容:\x20'+_0x3a301c+'】';}else{if(_0x3c205f[_0xc1bdd8(0xcbd)]===_0xc1bdd8(0x10ea))_0x17bf25=('[一张图片，其隐藏文字为：“'+_0x3c205f[_0xc1bdd8(0x1090)]+_0xc1bdd8(0x9e7)+(_0x3c205f[_0xc1bdd8(0xf1f)]||''))[_0xc1bdd8(0x516)](0x0,0x32)+_0xc1bdd8(0x629);else _0x3c205f['type']===_0xc1bdd8(0x7e5)?_0x17bf25=(_0xc1bdd8(0xc65)+_0x3c205f[_0xc1bdd8(0x91d)]+_0xc1bdd8(0x9e7)+(_0x3c205f[_0xc1bdd8(0xf1f)]||''))[_0xc1bdd8(0x516)](0x0,0x32)+_0xc1bdd8(0x629):_0x17bf25=String(_0x3c205f['publicText']||_0x3c205f[_0xc1bdd8(0x128c)]||_0xc1bdd8(0x727))[_0xc1bdd8(0x516)](0x0,0x32)+_0xc1bdd8(0x629);}_0x4b76b0+=_0xc1bdd8(0x14f4)+_0x3c205f['id']+')\x20作者:\x20'+_0x2bf5c1+',\x20内容:\x20\x22'+_0x17bf25+'\x22\x0a';if(_0x3c205f[_0xc1bdd8(0x10ae)]&&_0x3c205f['comments']['length']>0x0)for(const _0x3e3081 of _0x3c205f[_0xc1bdd8(0x10ae)]){if(typeof _0x3e3081===_0xc1bdd8(0xcc5)&&_0x3e3081[_0xc1bdd8(0xe27)]){const _0x2da865=_0x34f6a8(_0x3e3081[_0xc1bdd8(0xe27)]);let _0x41f1c4=_0x3e3081[_0xc1bdd8(0x339)]?'[表情:\x20\x27'+_0x3e3081['meaning']+'\x27]':_0x3e3081['text'];_0x4b76b0+=_0xc1bdd8(0x6da)+_0x2da865+_0xc1bdd8(0x85b)+_0x3e3081[_0xc1bdd8(0xe27)]+'):\x20'+_0x41f1c4+'\x0a';}}}_0x4dd354=_0x4b76b0;}const _0x37d167=_0x5a2518(_0x4d5462,0x3,_0xc1bdd8(0x5f2)),_0x3f4a26=_0x5a2518(_0x4d5462,0x6,'hours'),_0x4ff614=_0x5a2518(_0x4d5462,0x9,'hours'),_0x10a2a3=_0x5a2518(_0x4d5462,0x1,_0xc1bdd8(0x1265)),_0x38ab09=_0x5a2518(_0x4d5462,0x3,_0xc1bdd8(0x1265)),_0x54464e=_0x5a2518(_0x4d5462,0x7,_0xc1bdd8(0x1265));let _0x58dfee='';if(_0x37d167||_0x3f4a26||_0x4ff614||_0x10a2a3||_0x38ab09||_0x54464e){_0x58dfee+=_0xc1bdd8(0xd39);if(_0x37d167)_0x58dfee+=_0x37d167;if(_0x3f4a26)_0x58dfee+=_0x3f4a26;if(_0x4ff614)_0x58dfee+=_0x4ff614;if(_0x37d167||_0x3f4a26||_0x4ff614)_0x58dfee+='\x0a';if(_0x10a2a3)_0x58dfee+=_0x10a2a3;if(_0x38ab09)_0x58dfee+=_0x38ab09;if(_0x54464e)_0x58dfee+=_0x54464e;}const _0x1d1154=_0x2c88ab(_0x4d5462);_0x31f6ef=_0xc1bdd8(0x3ac)+_0x4d5462[_0xc1bdd8(0x5d2)]+_0xc1bdd8(0x12ca)+(_0x4d5462[_0xc1bdd8(0x6a8)][_0xc1bdd8(0x885)]?_0xc1bdd8(0x6b9)+_0x54eeb5+'。':'')+_0xc1bdd8(0x20e)+(_0x461a6e?_0x461a6e+'\x20':'')+_0xc1bdd8(0x144a)+_0x5101b0+_0xc1bdd8(0x158e)+_0x518e25+_0xc1bdd8(0x7b4)+_0x4d5462['name']+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+_0x4e506c+_0xc1bdd8(0x7a1)+(_0x4d5462[_0xc1bdd8(0x5fb)]&&_0x4d5462[_0xc1bdd8(0x5fb)]['length']>0x0?_0x4d5462['longTermMemory'][_0xc1bdd8(0x1431)](_0x396274=>'-\x20'+_0x396274[_0xc1bdd8(0x128c)])['join']('\x0a'):_0xc1bdd8(0x1384))+_0xc1bdd8(0x12b5)+_0x58dfee+_0xc1bdd8(0x20e)+_0x38aa88+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20群成员列表及人设\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+_0x273ae7+_0xc1bdd8(0x1e5)+_0x1d1154+_0xc1bdd8(0x3bc)+_0x518e25+_0xc1bdd8(0x87f)+_0x4d5462['settings'][_0xc1bdd8(0x36b)]+_0xc1bdd8(0xad0)+_0x33de52+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20最近的动态列表\x20(供你参考和评论)\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+_0x4dd354+_0xc1bdd8(0x868);}const _0x5d07b6=_0x4d5462[_0xc1bdd8(0xce3)][_0xc1bdd8(0xede)](_0x23316b=>!_0x23316b[_0xc1bdd8(0x58e)])[_0xc1bdd8(0x5cc)](-0xa),_0x3e0335=[{'role':_0xc1bdd8(0x1594),'content':_0x31f6ef},..._0x5d07b6[_0xc1bdd8(0x1431)](_0x24275e=>{const _0x25b788=_0xc1bdd8,_0x1b5cbb=_0x24275e[_0x25b788(0xfbb)]===_0x25b788(0x860)?_0x518e25:_0x140540(_0x4d5462,_0x24275e[_0x25b788(0xfb7)]);let _0x293dd4=_0x24275e['content'];if(_0x24275e['type']===_0x25b788(0xce9)||_0x24275e[_0x25b788(0xcbd)]==='user_photo')_0x293dd4='[发送了一张图片，描述为：\x27'+_0x24275e[_0x25b788(0x128c)]+'\x27]';else{if(_0x24275e[_0x25b788(0xcbd)]===_0x25b788(0xd83))_0x293dd4=_0x25b788(0x1452)+_0x24275e[_0x25b788(0x128c)]+'\x27]';else typeof _0x293dd4!=='string'&&(_0x293dd4=_0x25b788(0xc6c));}return{'role':_0x25b788(0x860),'content':_0x1b5cbb+':\x20'+_0x293dd4};})];try{const _0x50883b=[{'role':_0xc1bdd8(0x860),'content':_0x31f6ef}];let _0x30ba71=_0x3fc32e===GEMINI_API_URL,_0x8d5e9c=_0x16b978(_0x30d983,_0x81e7ef,_0x31f6ef,_0x50883b);const _0x5be2dd=_0x30ba71?await fetch(_0x8d5e9c[_0xc1bdd8(0x258)],_0x8d5e9c[_0xc1bdd8(0xc6b)]):await fetch(_0x3fc32e+_0xc1bdd8(0x14c2),{'method':'POST','headers':{'Content-Type':'application/json','Authorization':_0xc1bdd8(0xf03)+_0x81e7ef},'body':JSON[_0xc1bdd8(0x994)]({'model':_0x30d983,'messages':_0x50883b,'temperature':_0x1ae02e['globalSettings'][_0xc1bdd8(0x217)]||0.9})});if(!_0x5be2dd['ok'])throw new Error((await _0x5be2dd[_0xc1bdd8(0xb84)]())[_0xc1bdd8(0x127d)]['message']);const _0x12e1d8=await _0x5be2dd['json'](),_0xc3e441=_0x30ba71?_0x12e1d8[_0xc1bdd8(0x152f)][0x0][_0xc1bdd8(0x128c)][_0xc1bdd8(0x14fb)][0x0][_0xc1bdd8(0x40f)]:_0x12e1d8[_0xc1bdd8(0x10be)][0x0][_0xc1bdd8(0x11f0)]['content'],_0x596234=_0x1493d9(_0xc3e441);if(!_0x596234||_0x596234[_0xc1bdd8(0x58a)]===0x0){console[_0xc1bdd8(0xb3b)](_0xc1bdd8(0xc4e)+_0x4d5462[_0xc1bdd8(0x5d2)]+_0xc1bdd8(0x900));return;}let _0x2166c9=Date[_0xc1bdd8(0xd6e)](),_0x24d073=![],_0x83de5e='',_0x21efc2='';const _0x22df27=[];for(const _0xd0c8bb of _0x596234){const _0x21c1d6=String(_0xd0c8bb[_0xc1bdd8(0x128c)]||''),_0x21ff0b=_0x21c1d6[_0xc1bdd8(0x4a2)]()[_0xc1bdd8(0xebf)]('<')&&_0x21c1d6[_0xc1bdd8(0x4a2)]()[_0xc1bdd8(0x324)]('>');if(_0xd0c8bb['type']===_0xc1bdd8(0x40f)&&!_0x21ff0b&&_0x21c1d6[_0xc1bdd8(0xe82)]('\x0a')){const _0x231f0b=_0x21c1d6[_0xc1bdd8(0x23f)](/\n+/)[_0xc1bdd8(0xede)](_0x3fc81d=>_0x3fc81d[_0xc1bdd8(0x4a2)]());_0x231f0b[_0xc1bdd8(0x59b)](_0x3665cb=>{const _0x4d7fff=_0xc1bdd8;_0x22df27[_0x4d7fff(0x1426)]({..._0xd0c8bb,'content':_0x3665cb});});}else _0x22df27['push'](_0xd0c8bb);}for(const _0x3f10d5 of _0x22df27){if(!_0x3f10d5||!_0x3f10d5['type']||!_0x3f10d5[_0xc1bdd8(0x5d2)])continue;const _0x3e8154=_0x140540(_0x4d5462,_0x3f10d5['name']);let _0x151824=null,_0x3736d7=null;const _0x16ef5b={'role':_0xc1bdd8(0x13c0),'senderName':_0x3f10d5[_0xc1bdd8(0x5d2)],'timestamp':_0x2166c9++};if(_0x3f10d5[_0xc1bdd8(0xcbd)]===_0xc1bdd8(0xf9a)){const _0x4aaa49=_0x4d5462[_0xc1bdd8(0xce3)][_0xc1bdd8(0x13b7)](_0x54ccec=>_0x54ccec[_0xc1bdd8(0x1388)]===_0x3f10d5[_0xc1bdd8(0x736)]);if(_0x4aaa49&&!_0x4aaa49[_0xc1bdd8(0x6dd)]&&!(_0x4aaa49['claimedBy']&&_0x4aaa49[_0xc1bdd8(0x13d5)][_0x3f10d5[_0xc1bdd8(0x5d2)]])){let _0x3214a3=0x0;const _0x54eb2f=_0x4aaa49[_0xc1bdd8(0x9c3)]-Object[_0xc1bdd8(0x753)](_0x4aaa49[_0xc1bdd8(0x13d5)]||{})[_0xc1bdd8(0x7b6)]((_0x26ed4f,_0x67032a)=>_0x26ed4f+_0x67032a,0x0),_0x3bdbe6=_0x4aaa49['count']-Object[_0xc1bdd8(0x1378)](_0x4aaa49['claimedBy']||{})[_0xc1bdd8(0x58a)];if(_0x3bdbe6>0x0){if(_0x3bdbe6===0x1)_0x3214a3=_0x54eb2f;else{const _0x4c27cf=0.01,_0x4737fc=_0x54eb2f-(_0x3bdbe6-0x1)*_0x4c27cf;_0x3214a3=Math['random']()*(_0x4737fc-_0x4c27cf)+_0x4c27cf;}_0x3214a3=parseFloat(_0x3214a3[_0xc1bdd8(0x24f)](0x2));if(!_0x4aaa49['claimedBy'])_0x4aaa49['claimedBy']={};_0x4aaa49['claimedBy'][_0x3f10d5[_0xc1bdd8(0x5d2)]]=_0x3214a3,_0x4d5462['history'][_0xc1bdd8(0x1426)]({'role':'system','type':_0xc1bdd8(0x1454),'content':_0x3e8154+_0xc1bdd8(0xc31)+_0x140540(_0x4d5462,_0x4aaa49[_0xc1bdd8(0xfb7)])+'\x20的红包','timestamp':Date[_0xc1bdd8(0xd6e)]()});let _0x566a4d='[系统提示：你\x20('+_0x3e8154+_0xc1bdd8(0xac9)+_0x3214a3[_0xc1bdd8(0x24f)](0x2)+_0xc1bdd8(0xd74);if(Object[_0xc1bdd8(0x1378)](_0x4aaa49[_0xc1bdd8(0x13d5)])[_0xc1bdd8(0x58a)]>=_0x4aaa49['count']){_0x4aaa49[_0xc1bdd8(0x6dd)]=!![],_0x4d5462[_0xc1bdd8(0xce3)][_0xc1bdd8(0x1426)]({'role':'system','type':_0xc1bdd8(0x1454),'content':_0x140540(_0x4d5462,_0x4aaa49[_0xc1bdd8(0xfb7)])+_0xc1bdd8(0x399),'timestamp':Date[_0xc1bdd8(0xd6e)]()+0x1});let _0x40993b={'name':'','amount':-0x1};Object['entries'](_0x4aaa49[_0xc1bdd8(0x13d5)])[_0xc1bdd8(0x59b)](([_0x273251,_0x434878])=>{const _0x42ed61=_0xc1bdd8;_0x434878>_0x40993b[_0x42ed61(0x618)]&&(_0x40993b={'name':_0x273251,'amount':_0x434878});});if(_0x40993b[_0xc1bdd8(0x5d2)]){const _0x2c732e=_0x140540(_0x4d5462,_0x40993b[_0xc1bdd8(0x5d2)]);_0x566a4d+=_0xc1bdd8(0x9d9)+_0x2c732e+'！';}}_0x566a4d+=_0xc1bdd8(0xf66),_0x4d5462['history']['push']({'role':_0xc1bdd8(0x1594),'content':_0x566a4d,'timestamp':Date[_0xc1bdd8(0xd6e)]()+0x2,'isHidden':!![]});}}_0x24d073=!![];continue;}switch(_0x3f10d5[_0xc1bdd8(0xcbd)]){case'sticker':if(_0x3f10d5[_0xc1bdd8(0x339)]){const _0x3c306e=_0x1ae02e[_0xc1bdd8(0x1420)][_0xc1bdd8(0x13b7)](_0x302103=>_0x302103[_0xc1bdd8(0x5d2)]===_0x3f10d5['meaning']);_0x3c306e?_0x3736d7={..._0x16ef5b,'type':'sticker','content':_0x3c306e[_0xc1bdd8(0x258)],'meaning':_0x3c306e[_0xc1bdd8(0x5d2)]}:(console[_0xc1bdd8(0xb3b)]('AI\x20(群聊后台)\x20尝试使用一个不存在的表情:\x20\x22'+_0x3f10d5[_0xc1bdd8(0x339)]+'\x22'),_0x3736d7={..._0x16ef5b,'type':_0xc1bdd8(0x40f),'content':_0xc1bdd8(0xe39)+_0x3f10d5['meaning']+']'});}else console[_0xc1bdd8(0xb3b)]('AI\x20(群聊后台)\x20发送了一个没有\x20\x27meaning\x27\x20的\x20sticker\x20指令。',_0x3f10d5),_0x3736d7={..._0x16ef5b,'type':'sticker','content':_0x3f10d5['url'],'meaning':'未知表情'};break;case _0xc1bdd8(0x4e1):const _0x553879={'type':_0x3f10d5[_0xc1bdd8(0x14e3)]||'shuoshuo','content':_0x3f10d5[_0xc1bdd8(0x128c)],'timestamp':Date[_0xc1bdd8(0xd6e)](),'authorId':_0x1ae02e[_0xc1bdd8(0x589)][Object[_0xc1bdd8(0x1378)](_0x1ae02e[_0xc1bdd8(0x589)])[_0xc1bdd8(0x13b7)](_0x3a6880=>_0x1ae02e[_0xc1bdd8(0x589)][_0x3a6880][_0xc1bdd8(0x96f)]===_0x3f10d5[_0xc1bdd8(0x5d2)])]?.['id']||_0x3f10d5['name'],'authorOriginalName':_0x3f10d5[_0xc1bdd8(0x5d2)],'visibleGroupIds':null};await _0x3df81a[_0xc1bdd8(0x910)][_0xc1bdd8(0x6a4)](_0x553879),_0xfc0942(_0x496f96+0x1),_0x151824={'content':'['+_0x3e8154+_0xc1bdd8(0xc68)};break;case'qzone_comment':const _0x3a35bd=await _0x3df81a[_0xc1bdd8(0x910)][_0xc1bdd8(0x13f8)](parseInt(_0x3f10d5[_0xc1bdd8(0xd8f)]));if(_0x3a35bd){if(!_0x3a35bd['comments'])_0x3a35bd[_0xc1bdd8(0x10ae)]=[];_0x3a35bd['comments'][_0xc1bdd8(0x1426)]({'commenterName':_0x3f10d5[_0xc1bdd8(0x5d2)],'text':_0x3f10d5['commentText'],'timestamp':Date['now']()}),await _0x3df81a[_0xc1bdd8(0x910)][_0xc1bdd8(0xf18)](_0x3a35bd['id'],{'comments':_0x3a35bd['comments']}),_0xfc0942(_0x496f96+0x1),_0x151824={'content':'['+_0x3e8154+_0xc1bdd8(0x7cd)};}break;case _0xc1bdd8(0x252):const _0x289a10=await _0x3df81a[_0xc1bdd8(0x910)][_0xc1bdd8(0x13f8)](parseInt(_0x3f10d5[_0xc1bdd8(0xd8f)]));if(_0x289a10){if(!_0x289a10[_0xc1bdd8(0xb09)])_0x289a10['likes']=[];!_0x289a10[_0xc1bdd8(0xb09)][_0xc1bdd8(0xe82)](_0x3f10d5['name'])&&(_0x289a10[_0xc1bdd8(0xb09)][_0xc1bdd8(0x1426)](_0x3f10d5[_0xc1bdd8(0x5d2)]),await _0x3df81a[_0xc1bdd8(0x910)][_0xc1bdd8(0xf18)](_0x289a10['id'],{'likes':_0x289a10[_0xc1bdd8(0xb09)]}),_0xfc0942(_0x496f96+0x1),_0x151824={'content':'['+_0x3e8154+_0xc1bdd8(0x1bc)});}break;case _0xc1bdd8(0xce9):_0x3736d7={..._0x16ef5b,'type':'ai_image','content':_0x3f10d5[_0xc1bdd8(0xdec)],'image_prompt':msgData['image_prompt']};break;default:if(_0x3f10d5[_0xc1bdd8(0xcbd)]===_0xc1bdd8(0x7b8)){const _0x4f1c22=typeof _0x3f10d5[_0xc1bdd8(0x2c2)]===_0xc1bdd8(0x6c3)?_0x3f10d5['options'][_0xc1bdd8(0x23f)]('\x0a')['filter'](_0x573f93=>_0x573f93[_0xc1bdd8(0x4a2)]()):Array[_0xc1bdd8(0x121f)](_0x3f10d5[_0xc1bdd8(0x2c2)])?_0x3f10d5['options']:[];if(_0x4f1c22[_0xc1bdd8(0x58a)]<0x2)continue;_0x3736d7={..._0x16ef5b,..._0x3f10d5,'options':_0x4f1c22,'votes':{},'isClosed':![]};}else{const _0x4ebe1d=_0x3f10d5[_0xc1bdd8(0x128c)]||_0x3f10d5[_0xc1bdd8(0x11f0)];_0x3736d7={..._0x16ef5b,..._0x3f10d5};if(_0x4ebe1d)_0x3736d7['content']=_0x4ebe1d;}break;}if(_0x151824)_0x4d5462[_0xc1bdd8(0xce3)][_0xc1bdd8(0x1426)]({'role':_0xc1bdd8(0x1594),'type':_0xc1bdd8(0x1454),'content':_0x151824[_0xc1bdd8(0x128c)],'timestamp':_0x2166c9++});else _0x3736d7&&(_0x4d5462[_0xc1bdd8(0xce3)][_0xc1bdd8(0x1426)](_0x3736d7),!_0x21efc2&&(_0x21efc2=_0x3e8154,_0x83de5e=_0x3736d7[_0xc1bdd8(0xcbd)]==='ai_image'?_0xc1bdd8(0x947):_0x3736d7[_0xc1bdd8(0x128c)]||'['+_0x3736d7[_0xc1bdd8(0xcbd)]+']'));_0x24d073=!![];}_0x24d073&&(_0x4d5462['lastActionTimestamp']=Date[_0xc1bdd8(0xd6e)](),_0x4d5462[_0xc1bdd8(0xf2c)]=(_0x4d5462['unreadCount']||0x0)+_0x596234[_0xc1bdd8(0xede)](_0x2bf86c=>_0x2bf86c[_0xc1bdd8(0xcbd)]!==_0xc1bdd8(0x4e1)&&_0x2bf86c[_0xc1bdd8(0xcbd)]!==_0xc1bdd8(0x3ed)&&_0x2bf86c[_0xc1bdd8(0xcbd)]!==_0xc1bdd8(0x252))[_0xc1bdd8(0x58a)],_0x21efc2&&_0x83de5e&&_0x158e58(_0x531f45,_0x21efc2+':\x20'+_0x83de5e),await _0x3df81a['chats'][_0xc1bdd8(0x295)](_0x4d5462));}catch(_0x2b2919){console['error'](_0xc1bdd8(0xc4e)+_0x4d5462['name']+_0xc1bdd8(0xa99),_0x2b2919);}finally{_0x1033ae();}}function _0x5379ba(_0xe80d6f,_0x1ccd17,_0x545dd1){const _0x27f6b6=_0x2b1222,_0x4b3f08=document[_0x27f6b6(0x1f4)](_0x545dd1);if(!_0x4b3f08)return;if(!_0xe80d6f||_0xe80d6f[_0x27f6b6(0x4a2)]()===''){_0x4b3f08[_0x27f6b6(0xf21)]='';return;}const _0x191e22=_0xe80d6f['replace'](/\s*\.message-bubble\.user\s+([^{]+\{)/g,_0x1ccd17+'\x20.message-bubble.user\x20$1')[_0x27f6b6(0xef0)](/\s*\.message-bubble\.ai\s+([^{]+\{)/g,_0x1ccd17+_0x27f6b6(0x4cc))[_0x27f6b6(0xef0)](/\s*\.message-bubble\s+([^{]+\{)/g,_0x1ccd17+_0x27f6b6(0x596));_0x4b3f08[_0x27f6b6(0xf21)]=_0x191e22;}async function _0x356272(){const _0x3543d9=_0x2b1222;if(!_0x1ae02e[_0x3543d9(0x588)])return;const _0x1a45e5=_0x1ae02e['chats'][_0x1ae02e[_0x3543d9(0x588)]],_0x533e66=document[_0x3543d9(0x1f4)]('settings-preview-area');if(!_0x533e66)return;const _0x24edef=document['querySelector'](_0x3543d9(0x420))?.[_0x3543d9(0x107e)]||'default',_0xa167ab=document[_0x3543d9(0x1f4)](_0x3543d9(0xe62))[_0x3543d9(0x107e)],_0x3bc4a6=document['getElementById'](_0x3543d9(0x833))[_0x3543d9(0x107e)],_0x16c31b=_0x1a45e5[_0x3543d9(0x6a8)][_0x3543d9(0xece)];_0x533e66[_0x3543d9(0x746)][_0x3543d9(0x195)]=_0x24edef,_0x533e66[_0x3543d9(0x215)][_0x3543d9(0x495)](_0x3543d9(0x471),_0xa167ab+'px');_0x16c31b&&_0x16c31b[_0x3543d9(0xebf)]('data:image')?(_0x533e66[_0x3543d9(0x215)][_0x3543d9(0xf98)]='url('+_0x16c31b+')',_0x533e66['style'][_0x3543d9(0x11e7)]=_0x3543d9(0xbff)):(_0x533e66[_0x3543d9(0x215)][_0x3543d9(0xf98)]=_0x3543d9(0x1b5),_0x533e66[_0x3543d9(0x215)][_0x3543d9(0xece)]=_0x16c31b||_0x3543d9(0xa9d));_0x533e66[_0x3543d9(0xf21)]='';const _0x5b6aa7={'role':'ai','content':_0x3543d9(0xa2d),'timestamp':0x1,'senderName':_0x1a45e5['name']},_0x26724=await _0x1c1dfa(_0x5b6aa7,_0x1a45e5);if(_0x26724)_0x533e66['appendChild'](_0x26724);const _0xdf263d={'role':'user','content':_0x3543d9(0x12d8),'timestamp':0x2},_0x4faf69=await _0x1c1dfa(_0xdf263d,_0x1a45e5);if(_0x4faf69)_0x533e66[_0x3543d9(0x6ce)](_0x4faf69);const _0x415786=document[_0x3543d9(0x219)]('div');_0x415786['style'][_0x3543d9(0x519)]=_0x3543d9(0x112a),_0x415786[_0x3543d9(0x231)]=_0x3543d9(0x948),_0x533e66['appendChild'](_0x415786);const _0x518efc=document[_0x3543d9(0x1f4)](_0x3543d9(0x14a9))[_0x3543d9(0x107e)],_0x3ee5d8=document[_0x3543d9(0x1f4)](_0x3543d9(0x8f1))['value'],_0x102275=parseInt(document[_0x3543d9(0x1f4)](_0x3543d9(0x1ff))[_0x3543d9(0x107e)])||0xa;_0x518efc===_0x3543d9(0xe00)?_0x415786[_0x3543d9(0x215)]['top']=_0x102275+'px':_0x415786[_0x3543d9(0x215)][_0x3543d9(0xb30)]=_0x102275+'px';switch(_0x3ee5d8){case _0x3543d9(0xbe7):_0x415786['style'][_0x3543d9(0xbe7)]='15px';break;case _0x3543d9(0x68d):_0x415786[_0x3543d9(0x215)]['right']=_0x3543d9(0x13fa);break;default:_0x415786[_0x3543d9(0x215)][_0x3543d9(0xbe7)]='50%',_0x415786['style'][_0x3543d9(0x8c6)]='translateX(-50%)';break;}_0x5379ba(_0x3bc4a6,_0x3543d9(0x76a),_0x3543d9(0x1bf));}async function _0x205fba(){const _0x5484a8=_0x2b1222;await _0xb44e47(),document['getElementById'](_0x5484a8(0x1033))[_0x5484a8(0x159b)][_0x5484a8(0x6a4)]('visible');}async function _0xb44e47(){const _0x5be16f=_0x2b1222,_0x5a4fd1=document[_0x5be16f(0x1f4)](_0x5be16f(0x14c0)),_0x4a68c1=await _0x3df81a[_0x5be16f(0x13fc)][_0x5be16f(0x27a)]();_0x5a4fd1[_0x5be16f(0xf21)]='',_0x4a68c1['length']===0x0&&(_0x5a4fd1[_0x5be16f(0xf21)]=_0x5be16f(0xeae)),_0x4a68c1[_0x5be16f(0x59b)](_0x32dd6e=>{const _0x227bfd=_0x5be16f,_0x5d9d0d=document[_0x227bfd(0x219)](_0x227bfd(0xaf9));_0x5d9d0d[_0x227bfd(0x7c6)]=_0x227bfd(0xd18),_0x5d9d0d[_0x227bfd(0xf21)]=_0x227bfd(0xf67)+_0x32dd6e['name']+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22delete-group-btn\x22\x20data-id=\x22'+_0x32dd6e['id']+_0x227bfd(0x837),_0x5a4fd1['appendChild'](_0x5d9d0d);});}async function _0x11e30b(){const _0x32d82f=_0x2b1222,_0x73b24f=document[_0x32d82f(0x1f4)]('new-group-name-input'),_0x38e4d1=_0x73b24f[_0x32d82f(0x107e)][_0x32d82f(0x4a2)]();if(!_0x38e4d1){alert('分组名不能为空！');return;}const _0x3975a5=await _0x3df81a['qzoneGroups'][_0x32d82f(0x478)](_0x32d82f(0x5d2))['equals'](_0x38e4d1)[_0x32d82f(0x9a8)]();if(_0x3975a5){alert(_0x32d82f(0x604)+_0x38e4d1+'\x22\x20已经存在了，换个名字吧！');return;}await _0x3df81a['qzoneGroups']['add']({'name':_0x38e4d1}),_0x73b24f['value']='',await _0xb44e47();}async function _0x54a829(_0x2f3e1c){const _0x442dc1=_0x2b1222,_0x36a86d=await _0x109970('确认删除',_0x442dc1(0xd56),{'confirmButtonClass':_0x442dc1(0x1c6)});if(_0x36a86d){await _0x3df81a['qzoneGroups'][_0x442dc1(0xc40)](_0x2f3e1c);const _0x14cec3=await _0x3df81a[_0x442dc1(0x589)][_0x442dc1(0x478)]('groupId')[_0x442dc1(0x49d)](_0x2f3e1c)[_0x442dc1(0x27a)]();for(const _0x3d3c16 of _0x14cec3){_0x3d3c16[_0x442dc1(0x67d)]=null,await _0x3df81a[_0x442dc1(0x589)]['put'](_0x3d3c16);if(_0x1ae02e[_0x442dc1(0x589)][_0x3d3c16['id']])_0x1ae02e[_0x442dc1(0x589)][_0x3d3c16['id']][_0x442dc1(0x67d)]=null;}await _0xb44e47();}}function _0x3ede62(_0x543ccb){const _0x3d3b80=_0x2b1222,_0x449b17=_0x1ae02e[_0x3d3b80(0x589)][_0x1ae02e[_0x3d3b80(0x588)]];document[_0x3d3b80(0x1f4)](_0x3d3b80(0xfdd))[_0x3d3b80(0x215)][_0x3d3b80(0x887)]=_0x449b17[_0x3d3b80(0xe83)]?'block':_0x3d3b80(0x1b5);if(_0x50ca2c)return;_0x3c0c35=_0x543ccb,document[_0x3d3b80(0x1f4)]('message-actions-modal')[_0x3d3b80(0x159b)][_0x3d3b80(0x6a4)]('visible');}function _0x22a0ab(){const _0x47d0cf=_0x2b1222;document[_0x47d0cf(0x1f4)]('message-actions-modal')['classList'][_0x47d0cf(0xa9c)](_0x47d0cf(0xfca)),_0x3c0c35=null;}async function _0xb52841(){const _0x246ea8=_0x2b1222;if(!_0x3c0c35)return;const _0x5cc469=_0x3c0c35,_0x55c743=_0x1ae02e['chats'][_0x1ae02e['activeChatId']],_0x4f36bb=_0x55c743[_0x246ea8(0xce3)]['find'](_0xce276c=>_0xce276c[_0x246ea8(0x1388)]===_0x5cc469);if(!_0x4f36bb)return;_0x22a0ab();let _0x52fb7a;const _0x297c2f=_0x4f36bb[_0x246ea8(0xcbd)]&&[_0x246ea8(0xd83),_0x246ea8(0xce9),_0x246ea8(0x904),_0x246ea8(0xd9b)][_0x246ea8(0xe82)](_0x4f36bb[_0x246ea8(0xcbd)]);if(_0x297c2f){let _0x908733={'type':_0x4f36bb['type']};if(_0x4f36bb[_0x246ea8(0xcbd)]==='voice_message')_0x908733[_0x246ea8(0x128c)]=_0x4f36bb[_0x246ea8(0x128c)];else{if(_0x4f36bb[_0x246ea8(0xcbd)]===_0x246ea8(0xce9))_0x908733[_0x246ea8(0xdec)]=_0x4f36bb[_0x246ea8(0x128c)];else{if(_0x4f36bb[_0x246ea8(0xcbd)]===_0x246ea8(0x904))_0x908733[_0x246ea8(0x618)]=_0x4f36bb[_0x246ea8(0x618)],_0x908733[_0x246ea8(0x10c2)]=_0x4f36bb['note'];else _0x4f36bb['type']===_0x246ea8(0xd9b)&&(_0x908733[_0x246ea8(0x156f)]=_0x4f36bb['title'],_0x908733[_0x246ea8(0xdec)]=_0x4f36bb['description'],_0x908733[_0x246ea8(0x115e)]=_0x4f36bb[_0x246ea8(0x115e)],_0x908733['content']=_0x4f36bb[_0x246ea8(0x128c)]);}}_0x52fb7a=JSON['stringify'](_0x908733,null,0x2);}else typeof _0x4f36bb['content']===_0x246ea8(0xcc5)?_0x52fb7a=JSON[_0x246ea8(0x994)](_0x4f36bb[_0x246ea8(0x128c)],null,0x2):_0x52fb7a=_0x4f36bb[_0x246ea8(0x128c)];const _0x53eba6={'voice':{'type':_0x246ea8(0xd83),'content':_0x246ea8(0x2bd)},'image':{'type':_0x246ea8(0xce9),'description':_0x246ea8(0x279)},'transfer':{'type':_0x246ea8(0x904),'amount':5.2,'note':_0x246ea8(0x1323)},'link':{'type':'share_link','title':_0x246ea8(0x12a4),'description':'文章摘要...','source_name':_0x246ea8(0x11d0),'content':_0x246ea8(0xaff)}},_0x2f61e8='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22format-helpers\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27'+JSON[_0x246ea8(0x994)](_0x53eba6[_0x246ea8(0xcfd)])+_0x246ea8(0xb04)+JSON[_0x246ea8(0x994)](_0x53eba6[_0x246ea8(0x685)])+_0x246ea8(0xcc3)+JSON[_0x246ea8(0x994)](_0x53eba6[_0x246ea8(0x904)])+_0x246ea8(0xdee)+JSON['stringify'](_0x53eba6['link'])+_0x246ea8(0xd2e),_0x3b7ea9=await _0x11f6fb(_0x246ea8(0x146b),_0x246ea8(0xacc),_0x52fb7a,'textarea',_0x2f61e8);_0x3b7ea9!==null&&await _0x113628(_0x5cc469,_0x3b7ea9,!![]);}async function _0x3cb484(){const _0x4e4bf7=_0x2b1222;if(!_0x3c0c35)return;const _0x2ee9f2=_0x1ae02e['chats'][_0x1ae02e[_0x4e4bf7(0x588)]],_0x37faf1=_0x2ee9f2['history'][_0x4e4bf7(0x13b7)](_0x5116b8=>_0x5116b8['timestamp']===_0x3c0c35);if(!_0x37faf1)return;let _0x540953;typeof _0x37faf1[_0x4e4bf7(0x128c)]==='object'?_0x540953=JSON[_0x4e4bf7(0x994)](_0x37faf1[_0x4e4bf7(0x128c)]):_0x540953=String(_0x37faf1[_0x4e4bf7(0x128c)]);try{await navigator['clipboard'][_0x4e4bf7(0x514)](_0x540953),await _0x1460c5('复制成功',_0x4e4bf7(0x49b));}catch(_0x553d42){await _0x1460c5(_0x4e4bf7(0x756),'无法访问剪贴板。');}_0x22a0ab();}async function _0x16e0c2(){const _0x3f4a8e=_0x2b1222;if(!_0x3c0c35)return;try{await navigator[_0x3f4a8e(0x131f)][_0x3f4a8e(0x514)](_0x3c0c35),await _0x1460c5(_0x3f4a8e(0x672),_0x3f4a8e(0x867)+_0x3c0c35+_0x3f4a8e(0xbca));}catch(_0x5cc29e){await _0x1460c5(_0x3f4a8e(0x756),_0x3f4a8e(0x1088));}_0x22a0ab();}function _0xb9c6b5(_0x2752a4=''){const _0x418aa8=_0x2b1222,_0x56730b=document[_0x418aa8(0x219)](_0x418aa8(0xaf9));_0x56730b[_0x418aa8(0x7c6)]='message-editor-block';const _0x27988d={'voice':{'type':_0x418aa8(0xd83),'content':'在这里输入语音内容'},'image':{'type':'ai_image','description':_0x418aa8(0x279)},'transfer':{'type':_0x418aa8(0x904),'amount':5.2,'note':'一点心意'},'link':{'type':_0x418aa8(0xd9b),'title':_0x418aa8(0x12a4),'description':'文章摘要...','source_name':_0x418aa8(0x11d0),'content':'文章完整内容...'},'offline':{'type':_0x418aa8(0x439),'content':'「在这里输入对话内容」\x0a(在这里输入动作或环境描写)'},'quote':{'type':_0x418aa8(0x3d4),'target_timestamp':0x499602d2,'reply_content':_0x418aa8(0x84b)},'nai':{'type':_0x418aa8(0x132a),'prompt':'1girl,\x20best\x20quality,\x20masterpiece,\x20...'}};return _0x56730b[_0x418aa8(0xf21)]=_0x418aa8(0x102f)+_0x2752a4+_0x418aa8(0x159d)+JSON[_0x418aa8(0x994)](_0x27988d[_0x418aa8(0xcfd)])+_0x418aa8(0x9f0)+JSON['stringify'](_0x27988d[_0x418aa8(0x685)])+'\x27>图片</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27'+JSON[_0x418aa8(0x994)](_0x27988d[_0x418aa8(0x904)])+_0x418aa8(0xf3d)+JSON[_0x418aa8(0x994)](_0x27988d[_0x418aa8(0x83a)])+'\x27>链接</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27'+JSON[_0x418aa8(0x994)](_0x27988d[_0x418aa8(0x5bc)])+_0x418aa8(0xd03)+JSON[_0x418aa8(0x994)](_0x27988d['quote'])+_0x418aa8(0x872)+JSON[_0x418aa8(0x994)](_0x27988d[_0x418aa8(0x6fe)])+_0x418aa8(0x7dd),_0x56730b[_0x418aa8(0xeda)](_0x418aa8(0x44f))[_0x418aa8(0x122b)](_0x418aa8(0x740),()=>{const _0x36341b=_0x418aa8;document[_0x36341b(0x14bf)](_0x36341b(0x707))[_0x36341b(0x58a)]>0x1?_0x56730b[_0x36341b(0xa9c)]():alert('至少需要保留一条消息。');}),_0x56730b['querySelectorAll']('.format-btn')[_0x418aa8(0x59b)](_0x5e8419=>{const _0xfa9853=_0x418aa8;_0x5e8419[_0xfa9853(0x122b)](_0xfa9853(0x740),()=>{const _0x4f11a0=_0xfa9853,_0x4caea4=_0x5e8419['dataset'][_0x4f11a0(0x1532)],_0x569b38=_0x56730b[_0x4f11a0(0xeda)](_0x4f11a0(0x1097));if(_0x4caea4&&_0x569b38)try{const _0x2ed865=JSON[_0x4f11a0(0x129c)](_0x4caea4);_0x569b38['value']=JSON[_0x4f11a0(0x994)](_0x2ed865,null,0x2),_0x569b38[_0x4f11a0(0xed2)]();}catch(_0x22ecb9){console[_0x4f11a0(0x127d)]('解析格式模板失败:',_0x22ecb9);}});}),_0x56730b;}async function _0x5999ab(){const _0x2b490b=_0x2b1222;if(!_0x3c0c35)return;const _0x204a58=_0x3c0c35,_0x30dba2=_0x1ae02e[_0x2b490b(0x589)][_0x1ae02e[_0x2b490b(0x588)]],_0x11bd97=_0x30dba2[_0x2b490b(0xce3)][_0x2b490b(0x13b7)](_0x2bf35a=>_0x2bf35a[_0x2b490b(0x1388)]===_0x204a58);if(!_0x11bd97)return;_0x22a0ab();const _0x2020ae=document[_0x2b490b(0x1f4)](_0x2b490b(0xcf8)),_0x5e2fba=document[_0x2b490b(0x1f4)](_0x2b490b(0x813));_0x5e2fba['innerHTML']='';let _0x3cfc19;if(_0x11bd97[_0x2b490b(0xadf)]){const _0x4223d3={'type':'quote_reply','target_timestamp':_0x11bd97[_0x2b490b(0xadf)][_0x2b490b(0x1388)],'reply_content':_0x11bd97['content']};_0x3cfc19=JSON['stringify'](_0x4223d3,null,0x2);}else{if(_0x11bd97['type']&&[_0x2b490b(0xd83),_0x2b490b(0xce9),_0x2b490b(0x904),_0x2b490b(0x439),'share_link',_0x2b490b(0x132a)][_0x2b490b(0xe82)](_0x11bd97[_0x2b490b(0xcbd)])){let _0x56aea4={'type':_0x11bd97[_0x2b490b(0xcbd)]};if(_0x11bd97[_0x2b490b(0xcbd)]===_0x2b490b(0xd83))_0x56aea4[_0x2b490b(0x128c)]=_0x11bd97[_0x2b490b(0x128c)];else{if(_0x11bd97[_0x2b490b(0xcbd)]===_0x2b490b(0xce9))_0x56aea4[_0x2b490b(0xdec)]=_0x11bd97[_0x2b490b(0x128c)];else{if(_0x11bd97[_0x2b490b(0xcbd)]==='transfer')_0x56aea4['amount']=_0x11bd97['amount'],_0x56aea4['note']=_0x11bd97['note'];else{if(_0x11bd97[_0x2b490b(0xcbd)]===_0x2b490b(0x439))_0x11bd97['content']?_0x56aea4[_0x2b490b(0x128c)]=_0x11bd97[_0x2b490b(0x128c)]:(_0x56aea4[_0x2b490b(0xdf2)]=_0x11bd97[_0x2b490b(0xdf2)],_0x56aea4[_0x2b490b(0xdec)]=_0x11bd97[_0x2b490b(0xdec)]);else{if(_0x11bd97[_0x2b490b(0xcbd)]==='share_link')_0x56aea4[_0x2b490b(0x156f)]=_0x11bd97['title'],_0x56aea4[_0x2b490b(0xdec)]=_0x11bd97['description'],_0x56aea4['source_name']=_0x11bd97[_0x2b490b(0x115e)],_0x56aea4[_0x2b490b(0x128c)]=_0x11bd97['content'];else _0x11bd97[_0x2b490b(0xcbd)]===_0x2b490b(0x132a)&&(_0x56aea4[_0x2b490b(0x1063)]=_0x11bd97['prompt'],_0x56aea4[_0x2b490b(0x48d)]=_0x11bd97[_0x2b490b(0x48d)],_0x56aea4['fullPrompt']=_0x11bd97[_0x2b490b(0x936)]);}}}}_0x3cfc19=JSON[_0x2b490b(0x994)](_0x56aea4,null,0x2);}else typeof _0x11bd97[_0x2b490b(0x128c)]===_0x2b490b(0xcc5)?_0x3cfc19=JSON[_0x2b490b(0x994)](_0x11bd97[_0x2b490b(0x128c)],null,0x2):_0x3cfc19=_0x11bd97[_0x2b490b(0x128c)];}const _0x2910b2=_0xb9c6b5(_0x3cfc19);_0x5e2fba['appendChild'](_0x2910b2);const _0x53f050=document[_0x2b490b(0x1f4)](_0x2b490b(0x1232)),_0x1f09c0=_0x53f050[_0x2b490b(0xf44)](!![]);_0x53f050[_0x2b490b(0xad7)][_0x2b490b(0xa88)](_0x1f09c0,_0x53f050),_0x1f09c0[_0x2b490b(0x122b)](_0x2b490b(0x740),()=>{const _0xce15c=_0x2b490b,_0x3745dc=_0xb9c6b5();_0x5e2fba[_0xce15c(0x6ce)](_0x3745dc),_0x3745dc[_0xce15c(0xeda)](_0xce15c(0x1097))['focus']();});const _0x58a3c1=document[_0x2b490b(0x1f4)]('cancel-advanced-editor-btn'),_0x11fdf9=_0x58a3c1[_0x2b490b(0xf44)](!![]);_0x58a3c1['parentNode'][_0x2b490b(0xa88)](_0x11fdf9,_0x58a3c1),_0x11fdf9['addEventListener'](_0x2b490b(0x740),()=>{const _0x456ee4=_0x2b490b;_0x2020ae[_0x456ee4(0x159b)][_0x456ee4(0xa9c)](_0x456ee4(0xfca));});const _0x462025=document[_0x2b490b(0x1f4)]('save-advanced-editor-btn'),_0x1a561d=_0x462025[_0x2b490b(0xf44)](!![]);_0x462025[_0x2b490b(0xad7)][_0x2b490b(0xa88)](_0x1a561d,_0x462025),_0x1a561d[_0x2b490b(0x122b)](_0x2b490b(0x740),()=>{_0x113628(_0x204a58);}),_0x2020ae[_0x2b490b(0x159b)][_0x2b490b(0x6a4)]('visible');}async function _0x3cb484(){const _0x3fea97=_0x2b1222;if(!_0x3c0c35)return;const _0x57c632=_0x1ae02e[_0x3fea97(0x589)][_0x1ae02e[_0x3fea97(0x588)]],_0x4f9f3f=_0x57c632[_0x3fea97(0xce3)][_0x3fea97(0x13b7)](_0x444af3=>_0x444af3['timestamp']===_0x3c0c35);if(!_0x4f9f3f)return;let _0x27cf17;if(_0x4f9f3f[_0x3fea97(0xcbd)]===_0x3fea97(0x439))_0x4f9f3f[_0x3fea97(0x128c)]?_0x27cf17=_0x4f9f3f[_0x3fea97(0x128c)]:_0x27cf17='「'+(_0x4f9f3f[_0x3fea97(0xdf2)]||'')+'」\x0a'+(_0x4f9f3f[_0x3fea97(0xdec)]||'');else typeof _0x4f9f3f[_0x3fea97(0x128c)]==='object'?_0x27cf17=JSON[_0x3fea97(0x994)](_0x4f9f3f[_0x3fea97(0x128c)]):_0x27cf17=String(_0x4f9f3f[_0x3fea97(0x128c)]);try{await navigator[_0x3fea97(0x131f)][_0x3fea97(0x514)](_0x27cf17),await _0x1460c5(_0x3fea97(0x672),'消息内容已复制到剪贴板。');}catch(_0x1c2ad2){await _0x1460c5(_0x3fea97(0x756),_0x3fea97(0x1088));}_0x22a0ab();}function _0x35975a(_0x29f4ef){const _0x15e732=_0x2b1222,_0x145432=_0x29f4ef[_0x15e732(0x4a2)]();if(_0x145432[_0x15e732(0xebf)]('{')&&_0x145432['endsWith']('}'))try{const _0x2f7a21=JSON[_0x15e732(0x129c)](_0x145432);if(_0x2f7a21[_0x15e732(0xcbd)])return _0x2f7a21;}catch(_0x1edb16){}if(_0x43460a['test'](_0x145432))return{'type':_0x15e732(0x1b3),'content':_0x145432};return{'type':_0x15e732(0x40f),'content':_0x145432};}async function _0x113628(_0x321b48,_0x30b599=null){const _0xfe1899=_0x2b1222;if(!_0x321b48)return;const _0x35804c=_0x1ae02e[_0xfe1899(0x589)][_0x1ae02e['activeChatId']],_0x4c960a=_0x35804c['history'][_0xfe1899(0xf2d)](_0xcd236c=>_0xcd236c[_0xfe1899(0x1388)]===_0x321b48);if(_0x4c960a===-0x1)return;const _0x48ea17=_0x35804c[_0xfe1899(0xce3)][_0x4c960a];let _0x2e2e8f=[];const _0x2dc9ff=_0x30b599!==null?[_0x30b599]:Array[_0xfe1899(0xa81)](document['querySelectorAll'](_0xfe1899(0x438)))[_0xfe1899(0x1431)](_0x5c9ac1=>_0x5c9ac1[_0xfe1899(0x107e)]);for(const _0xb2a1ac of _0x2dc9ff){if(!_0xb2a1ac[_0xfe1899(0x4a2)]())continue;const _0x57e23f=_0x35975a(_0xb2a1ac['trim']()),_0x26b61d={'role':_0x48ea17[_0xfe1899(0xfbb)],'senderName':_0x48ea17['senderName'],'timestamp':_0x48ea17[_0xfe1899(0x1388)]};switch(_0x57e23f[_0xfe1899(0xcbd)]){case'text':_0x26b61d[_0xfe1899(0xcbd)]='text',_0x26b61d[_0xfe1899(0x128c)]=_0x57e23f[_0xfe1899(0x128c)];break;case _0xfe1899(0x439):_0x26b61d[_0xfe1899(0xcbd)]=_0xfe1899(0x439);_0x57e23f[_0xfe1899(0x128c)]?_0x26b61d[_0xfe1899(0x128c)]=_0x57e23f[_0xfe1899(0x128c)]:(_0x26b61d[_0xfe1899(0xdf2)]=_0x57e23f[_0xfe1899(0xdf2)],_0x26b61d['description']=_0x57e23f[_0xfe1899(0xdec)]);break;case _0xfe1899(0x3d4):_0x26b61d[_0xfe1899(0xcbd)]=_0xfe1899(0x3d4),_0x26b61d['content']=_0x57e23f[_0xfe1899(0x976)];const _0x46d87f=_0x35804c[_0xfe1899(0xce3)][_0xfe1899(0x13b7)](_0x18d3a7=>_0x18d3a7[_0xfe1899(0x1388)]===_0x57e23f[_0xfe1899(0x3d8)]);if(_0x46d87f){let _0x2a1d80=_0x46d87f[_0xfe1899(0xfb7)];_0x46d87f[_0xfe1899(0xfbb)]===_0xfe1899(0x860)&&(_0x2a1d80=_0x1ae02e[_0xfe1899(0x11ef)]['nickname']||_0xfe1899(0xee7)),_0x26b61d['quote']={'timestamp':_0x57e23f['target_timestamp'],'senderName':_0x2a1d80,'content':String(_0x46d87f[_0xfe1899(0x128c)]||'')};}else _0x26b61d['quote']={'timestamp':_0x57e23f[_0xfe1899(0x3d8)],'senderName':_0xfe1899(0x10b3),'content':'原始消息已删除或不存在'};break;case _0xfe1899(0xd83):case'ai_image':case'user_photo':_0x26b61d[_0xfe1899(0xcbd)]=_0x57e23f[_0xfe1899(0xcbd)],_0x26b61d[_0xfe1899(0x128c)]=_0x57e23f['content']||_0x57e23f[_0xfe1899(0xdec)];if(_0x57e23f[_0xfe1899(0x339)])_0x26b61d['meaning']=_0x57e23f['meaning'];break;case _0xfe1899(0x132a):{const _0x47b6d8=_0x35804c[_0xfe1899(0xce3)][_0x4c960a];let _0x9d1a2a=_0x57e23f['prompt'],_0x545063=_0x57e23f[_0xfe1899(0x48d)],_0xad2b96=_0x57e23f[_0xfe1899(0x936)],_0x2122b4=![];_0x9d1a2a&&typeof _0x9d1a2a===_0xfe1899(0x6c3)&&_0x47b6d8[_0xfe1899(0x1063)]!==_0x9d1a2a?_0x2122b4=!![]:(_0x9d1a2a=_0x47b6d8[_0xfe1899(0x1063)],_0xad2b96=_0x47b6d8[_0xfe1899(0x936)],_0x545063=_0x47b6d8['imageUrl']);if(_0x2122b4){await _0x1460c5(_0xfe1899(0x11b7),_0xfe1899(0xb78));try{const _0x5f24f1=await _0x930e42(_0x9d1a2a,_0x35804c['id']);_0x545063=_0x5f24f1[_0xfe1899(0x48d)],_0xad2b96=_0x5f24f1['fullPrompt'],await _0x1460c5('成功',_0xfe1899(0xd35));}catch(_0x65361b){console['error'](_0xfe1899(0x6aa),_0x65361b),await _0x1460c5(_0xfe1899(0x108a),'无法重新生成图片:\x20'+_0x65361b[_0xfe1899(0x11f0)]+_0xfe1899(0x57a)),_0x545063=_0x47b6d8[_0xfe1899(0x48d)];}}_0x26b61d[_0xfe1899(0xcbd)]=_0xfe1899(0x132a),_0x26b61d[_0xfe1899(0x48d)]=_0x545063,_0x26b61d['prompt']=_0x9d1a2a,_0x26b61d[_0xfe1899(0x936)]=_0xad2b96;break;}case'sticker':{_0x26b61d[_0xfe1899(0xcbd)]=_0xfe1899(0x1b3);let _0x295b52=![];if(_0x57e23f[_0xfe1899(0x339)]){const _0xd85d05=_0x1ae02e[_0xfe1899(0x1420)][_0xfe1899(0x13b7)](_0x1280f1=>_0x1280f1[_0xfe1899(0x5d2)]===_0x57e23f[_0xfe1899(0x339)]);_0xd85d05?(_0x26b61d[_0xfe1899(0x128c)]=_0xd85d05[_0xfe1899(0x258)],_0x26b61d[_0xfe1899(0x339)]=_0xd85d05[_0xfe1899(0x5d2)],console[_0xfe1899(0x57e)](_0xfe1899(0x116b)),_0x295b52=!![]):(_0x26b61d[_0xfe1899(0xcbd)]=_0xfe1899(0x40f),_0x26b61d[_0xfe1899(0x128c)]=_0xfe1899(0xe39)+_0x57e23f[_0xfe1899(0x339)]+']',console[_0xfe1899(0xb3b)]('导演/编辑模式保存(Sticker):\x20提供了\x20meaning\x20但未找到对应表情:',_0x57e23f[_0xfe1899(0x339)]),_0x295b52=!![]);}if(!_0x295b52&&_0x57e23f[_0xfe1899(0x258)]){_0x26b61d[_0xfe1899(0x128c)]=_0x57e23f['url'];const _0x703aa3=_0x1ae02e[_0xfe1899(0x1420)][_0xfe1899(0x13b7)](_0x4d90a1=>_0x4d90a1[_0xfe1899(0x258)]===_0x57e23f['url']);if(_0x57e23f[_0xfe1899(0x339)]&&(!_0x703aa3||_0x703aa3['name']===_0x57e23f[_0xfe1899(0x339)]))_0x26b61d[_0xfe1899(0x339)]=_0x57e23f[_0xfe1899(0x339)];else _0x703aa3?_0x26b61d['meaning']=_0x703aa3[_0xfe1899(0x5d2)]:_0x26b61d[_0xfe1899(0x339)]=_0xfe1899(0x12bc);console[_0xfe1899(0x57e)]('导演/编辑模式保存(Sticker):\x20使用了\x20URL，最终\x20meaning:',_0x26b61d[_0xfe1899(0x339)]),_0x295b52=!![];}if(!_0x295b52&&_0x57e23f[_0xfe1899(0x128c)]&&typeof _0x57e23f[_0xfe1899(0x128c)]===_0xfe1899(0x6c3)&&_0x43460a[_0xfe1899(0x60b)](_0x57e23f['content'])){_0x26b61d[_0xfe1899(0x128c)]=_0x57e23f[_0xfe1899(0x128c)];const _0x2d0c6b=_0x1ae02e[_0xfe1899(0x1420)]['find'](_0x17f169=>_0x17f169[_0xfe1899(0x258)]===_0x57e23f[_0xfe1899(0x128c)]);_0x26b61d[_0xfe1899(0x339)]=_0x2d0c6b?_0x2d0c6b[_0xfe1899(0x5d2)]:'未知表情',console[_0xfe1899(0x57e)](_0xfe1899(0xcc6),_0x26b61d[_0xfe1899(0x339)]),_0x295b52=!![];}if(!_0x295b52){console[_0xfe1899(0x127d)](_0xfe1899(0x129b),_0x57e23f);continue;}break;}case _0xfe1899(0x904):_0x26b61d[_0xfe1899(0xcbd)]=_0xfe1899(0x904),_0x26b61d['amount']=_0x57e23f[_0xfe1899(0x618)],_0x26b61d['note']=_0x57e23f[_0xfe1899(0x10c2)];break;case _0xfe1899(0xd9b):_0x26b61d['type']=_0xfe1899(0xd9b),_0x26b61d['title']=_0x57e23f[_0xfe1899(0x156f)],_0x26b61d[_0xfe1899(0xdec)]=_0x57e23f[_0xfe1899(0xdec)],_0x26b61d[_0xfe1899(0x115e)]=_0x57e23f[_0xfe1899(0x115e)],_0x26b61d[_0xfe1899(0x128c)]=_0x57e23f[_0xfe1899(0x128c)];break;default:Object['assign'](_0x26b61d,_0x57e23f);break;}_0x2e2e8f[_0xfe1899(0x1426)](_0x26b61d);}if(_0x2e2e8f[_0xfe1899(0x58a)]===0x0){document['getElementById'](_0xfe1899(0xcf8))['classList'][_0xfe1899(0xa9c)](_0xfe1899(0xfca));return;}_0x35804c[_0xfe1899(0xce3)][_0xfe1899(0x30b)](_0x4c960a,0x1,..._0x2e2e8f);let _0x423fdd=_0x321b48;for(let _0x393d61=_0x4c960a;_0x393d61<_0x35804c[_0xfe1899(0xce3)][_0xfe1899(0x58a)];_0x393d61++){_0x35804c[_0xfe1899(0xce3)][_0x393d61]['timestamp']=_0x423fdd,_0x423fdd++;}await _0x3df81a[_0xfe1899(0x589)]['put'](_0x35804c),document[_0xfe1899(0x1f4)](_0xfe1899(0xcf8))[_0xfe1899(0x159b)][_0xfe1899(0xa9c)]('visible'),_0x3689f0(_0x1ae02e[_0xfe1899(0x588)]),await _0x1460c5('成功',_0xfe1899(0x127c));}function _0x5a2a11(_0xdcf50b){const _0x2a52ca=_0x2b1222;_0x16630f=_0xdcf50b,document[_0x2a52ca(0x1f4)](_0x2a52ca(0x13f1))[_0x2a52ca(0x159b)][_0x2a52ca(0x6a4)]('visible');}function _0x176d7f(){const _0x236c87=_0x2b1222;document[_0x236c87(0x1f4)]('post-actions-modal')[_0x236c87(0x159b)][_0x236c87(0xa9c)](_0x236c87(0xfca)),_0x16630f=null;}async function _0x5bc099(){const _0x4ed005=_0x2b1222;if(!_0x16630f)return;const _0x46c724=_0x16630f,_0x2a94e2=await _0x3df81a['qzonePosts'][_0x4ed005(0x13f8)](_0x46c724);if(!_0x2a94e2)return;_0x176d7f();let _0xab232b;if(_0x2a94e2[_0x4ed005(0xcbd)]===_0x4ed005(0x30e))_0xab232b=_0x2a94e2[_0x4ed005(0x128c)];else{const _0x9ba2={'type':_0x2a94e2[_0x4ed005(0xcbd)],'publicText':_0x2a94e2[_0x4ed005(0xf1f)]||''};if(_0x2a94e2[_0x4ed005(0xcbd)]===_0x4ed005(0x7e5))_0x9ba2[_0x4ed005(0x48d)]=_0x2a94e2[_0x4ed005(0x48d)],_0x9ba2[_0x4ed005(0x91d)]=_0x2a94e2[_0x4ed005(0x91d)];else _0x2a94e2['type']===_0x4ed005(0x10ea)&&(_0x9ba2[_0x4ed005(0x1090)]=_0x2a94e2[_0x4ed005(0x1090)]);_0xab232b=JSON['stringify'](_0x9ba2,null,0x2);}const _0x38cd29={'shuoshuo':_0x4ed005(0xcec),'image':{'type':'image_post','publicText':'','imageUrl':_0x4ed005(0x7f5),'imageDescription':''},'text_image':{'type':_0x4ed005(0x10ea),'publicText':'','hiddenContent':''}},_0x5c3893=_0x4ed005(0xc09)+JSON[_0x4ed005(0x994)](_0x38cd29['image'])+_0x4ed005(0x12f2)+JSON[_0x4ed005(0x994)](_0x38cd29[_0x4ed005(0x10ea)])+_0x4ed005(0x10b2),_0x46a720=await _0x11f6fb('编辑动态',_0x4ed005(0x1575),_0xab232b,_0x4ed005(0x1097),_0x5c3893);setTimeout(()=>{const _0x335953=_0x4ed005,_0x45698f=document[_0x335953(0xeda)](_0x335953(0x277));_0x45698f&&_0x45698f[_0x335953(0x122b)](_0x335953(0x740),()=>{const _0x10407c=_0x335953,_0x163392=document[_0x10407c(0x1f4)](_0x10407c(0x1029));_0x163392[_0x10407c(0x107e)]=_0x38cd29['shuoshuo'],_0x163392['focus']();});},0x64),_0x46a720!==null&&await _0x4224ae(_0x46c724,_0x46a720);}async function _0x4224ae(_0x5347c0,_0x224353){const _0x30a733=_0x2b1222,_0x236bf2=await _0x3df81a[_0x30a733(0x910)][_0x30a733(0x13f8)](_0x5347c0);if(!_0x236bf2)return;const _0x33a113=_0x224353[_0x30a733(0x4a2)]();try{const _0x589fb7=JSON[_0x30a733(0x129c)](_0x33a113);_0x236bf2[_0x30a733(0xcbd)]=_0x589fb7[_0x30a733(0xcbd)]||_0x30a733(0x7e5),_0x236bf2['publicText']=_0x589fb7['publicText']||'',_0x236bf2[_0x30a733(0x48d)]=_0x589fb7[_0x30a733(0x48d)]||'',_0x236bf2['imageDescription']=_0x589fb7[_0x30a733(0x91d)]||'',_0x236bf2[_0x30a733(0x1090)]=_0x589fb7[_0x30a733(0x1090)]||'',_0x236bf2[_0x30a733(0x128c)]='';}catch(_0x2d71b2){_0x236bf2[_0x30a733(0xcbd)]=_0x30a733(0x30e),_0x236bf2['content']=_0x33a113,_0x236bf2[_0x30a733(0xf1f)]='',_0x236bf2[_0x30a733(0x48d)]='',_0x236bf2[_0x30a733(0x91d)]='',_0x236bf2[_0x30a733(0x1090)]='';}await _0x3df81a[_0x30a733(0x910)]['put'](_0x236bf2),await _0x28d6f7(),await _0x1460c5('成功','动态已更新！');}async function _0x5a44cf(){const _0x5e3151=_0x2b1222;if(!_0x16630f)return;const _0x8b7fbb=await _0x3df81a[_0x5e3151(0x910)][_0x5e3151(0x13f8)](_0x16630f);if(!_0x8b7fbb)return;let _0x1851c3=_0x8b7fbb[_0x5e3151(0x128c)]||_0x8b7fbb['publicText']||_0x8b7fbb[_0x5e3151(0x1090)]||_0x8b7fbb['imageDescription']||_0x5e3151(0x185);try{await navigator[_0x5e3151(0x131f)][_0x5e3151(0x514)](_0x1851c3),await _0x1460c5(_0x5e3151(0x672),_0x5e3151(0x552));}catch(_0x23f6fc){await _0x1460c5('复制失败',_0x5e3151(0x1088));}_0x176d7f();}let _0x2bd389=new Set();async function _0x1a96cc(){const _0x56cbd4=_0x2b1222,_0x305850=await _0x12414d(_0x56cbd4(0x65c),[{'text':'创建普通群聊\x20(我参与)','value':_0x56cbd4(0x2d1)},{'text':'创建旁观群聊\x20(我围观)','value':_0x56cbd4(0xf8e)}]);if(_0x305850===_0x56cbd4(0x2d1)){_0x2bd389[_0x56cbd4(0x411)]();const _0x407861=document['getElementById'](_0x56cbd4(0x261)),_0x5002bf=_0x407861[_0x56cbd4(0xf44)](!![]);_0x407861[_0x56cbd4(0xad7)][_0x56cbd4(0xa88)](_0x5002bf,_0x407861),_0x5002bf['addEventListener'](_0x56cbd4(0x740),_0x19928a),await _0x13600e(),_0x2e53fa(_0x56cbd4(0x878));}else _0x305850===_0x56cbd4(0xf8e)&&_0x552192();}async function _0x552192(){const _0x2ebb0f=_0x2b1222;_0x2bd389[_0x2ebb0f(0x411)]();const _0x5ddfec=document[_0x2ebb0f(0x1f4)](_0x2ebb0f(0x261)),_0x3f4bb1=_0x5ddfec[_0x2ebb0f(0xf44)](!![]);_0x5ddfec[_0x2ebb0f(0xad7)]['replaceChild'](_0x3f4bb1,_0x5ddfec),_0x3f4bb1[_0x2ebb0f(0x122b)]('click',_0x59747a),await _0x92cc77(),_0x2e53fa('contact-picker-screen');}async function _0x92cc77(){const _0x137050=_0x2b1222,_0x58ffcd=document['getElementById']('contact-picker-list');_0x58ffcd['innerHTML']='';const _0x28f8b0=Object[_0x137050(0x753)](_0x1ae02e[_0x137050(0x589)])[_0x137050(0xede)](_0x14da0d=>!_0x14da0d[_0x137050(0xe83)]),_0x72d116=await _0x3df81a['npcs'][_0x137050(0x27a)]();if(_0x28f8b0[_0x137050(0x58a)]===0x0&&_0x72d116['length']===0x0){_0x58ffcd[_0x137050(0xf21)]='<p\x20style=\x22text-align:center;\x20color:#8a8a8a;\x20margin-top:50px;\x22>还没有任何角色或NPC可以加入群聊。</p>';return;}_0x28f8b0[_0x137050(0x59b)](_0x20901a=>{const _0x3858b9=_0x137050,_0x428ff1=document[_0x3858b9(0x219)]('div');_0x428ff1[_0x3858b9(0x7c6)]=_0x3858b9(0xec5),_0x428ff1[_0x3858b9(0x746)][_0x3858b9(0x80a)]=_0x20901a['id'],_0x428ff1[_0x3858b9(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+(_0x20901a[_0x3858b9(0x6a8)][_0x3858b9(0xc99)]||_0x5494d0)+'\x22\x20class=\x22avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>'+_0x20901a[_0x3858b9(0x5d2)]+_0x3858b9(0xfdf),_0x58ffcd[_0x3858b9(0x6ce)](_0x428ff1);}),_0x72d116[_0x137050(0x59b)](_0x3427dd=>{const _0x47bc76=_0x137050,_0x2e599a=document[_0x47bc76(0x219)](_0x47bc76(0xaf9));_0x2e599a[_0x47bc76(0x7c6)]=_0x47bc76(0xec5),_0x2e599a[_0x47bc76(0x746)][_0x47bc76(0x80a)]=_0x3427dd['id'],_0x2e599a[_0x47bc76(0x746)][_0x47bc76(0x13e4)]=_0x47bc76(0x8c3),_0x2e599a[_0x47bc76(0xf21)]=_0x47bc76(0x3bd)+(_0x3427dd[_0x47bc76(0x95b)]||_0x54779f)+'\x22\x20class=\x22avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>'+_0x3427dd[_0x47bc76(0x5d2)]+_0x47bc76(0x14e8),_0x58ffcd[_0x47bc76(0x6ce)](_0x2e599a);}),_0x5c2ecb();}async function _0x59747a(){const _0x49e29e=_0x2b1222;if(_0x2bd389[_0x49e29e(0xb51)]<0x2){alert(_0x49e29e(0x15c4));return;}const _0x57a644=await _0x11f6fb(_0x49e29e(0x928),_0x49e29e(0x1404),_0x49e29e(0x15d3));if(!_0x57a644||!_0x57a644[_0x49e29e(0x4a2)]())return;const _0x5874a0='group_'+Date['now'](),_0x52b6dd=[],_0x5c1653=await _0x3df81a[_0x49e29e(0x15b9)][_0x49e29e(0x27a)]();for(const _0x514417 of _0x2bd389){const _0x3a2cfd=document[_0x49e29e(0xeda)](_0x49e29e(0xe8d)+_0x514417+'\x22]')[_0x49e29e(0x746)][_0x49e29e(0x13e4)]===_0x49e29e(0x8c3);if(_0x3a2cfd){const _0x128f71=_0x5c1653[_0x49e29e(0x13b7)](_0x4f65a3=>_0x4f65a3['id']===parseInt(_0x514417));_0x128f71&&_0x52b6dd['push']({'id':_0x49e29e(0x27f)+_0x128f71['id'],'originalName':_0x128f71[_0x49e29e(0x5d2)],'groupNickname':_0x128f71['name'],'persona':_0x128f71[_0x49e29e(0x3be)],'avatar':_0x128f71[_0x49e29e(0x95b)]||_0x54779f,'isNpc':!![]});}else{const _0x3fca03=_0x1ae02e['chats'][_0x514417];_0x3fca03&&_0x52b6dd[_0x49e29e(0x1426)]({'id':_0x514417,'originalName':_0x3fca03[_0x49e29e(0x96f)],'groupNickname':_0x3fca03[_0x49e29e(0x5d2)],'persona':_0x3fca03[_0x49e29e(0x6a8)][_0x49e29e(0xf42)],'avatar':_0x3fca03[_0x49e29e(0x6a8)][_0x49e29e(0xc99)]||_0x5494d0,'isNpc':![]});}}const _0xac0ece={'id':_0x5874a0,'name':_0x57a644[_0x49e29e(0x4a2)](),'isGroup':!![],'isSpectatorGroup':!![],'members':_0x52b6dd,'settings':{'maxMemory':0xa,'groupAvatar':_0x22fe34,'background':'','theme':_0x49e29e(0x372),'fontSize':0xd,'customCss':'','linkedWorldBookIds':[]},'history':[{'role':_0x49e29e(0x1594),'content':_0x49e29e(0x2ef),'timestamp':Date[_0x49e29e(0xd6e)](),'isHidden':!![]}],'musicData':{'totalTime':0x0}};_0x1ae02e[_0x49e29e(0x589)][_0x5874a0]=_0xac0ece,await _0x3df81a[_0x49e29e(0x589)][_0x49e29e(0x295)](_0xac0ece),await _0x1033ae(),_0x2e53fa(_0x49e29e(0x133d)),_0x4c0122(_0x5874a0);}async function _0x13600e(){const _0x4d3738=_0x2b1222,_0x2facd1=document[_0x4d3738(0x1f4)](_0x4d3738(0x10f0));_0x2facd1['innerHTML']='';const _0x8e4195=Object[_0x4d3738(0x753)](_0x1ae02e['chats'])[_0x4d3738(0xede)](_0xf022c6=>!_0xf022c6[_0x4d3738(0xe83)]),_0x3869ef=await _0x3df81a[_0x4d3738(0x15b9)]['toArray']();if(_0x8e4195[_0x4d3738(0x58a)]===0x0&&_0x3869ef['length']===0x0){_0x2facd1[_0x4d3738(0xf21)]=_0x4d3738(0x4f2);return;}_0x8e4195[_0x4d3738(0x59b)](_0x56e1bf=>{const _0x24c167=_0x4d3738,_0x37a152=document[_0x24c167(0x219)](_0x24c167(0xaf9));_0x37a152['className']=_0x24c167(0xec5),_0x37a152[_0x24c167(0x746)][_0x24c167(0x80a)]=_0x56e1bf['id'],_0x37a152[_0x24c167(0xf21)]=_0x24c167(0x3bd)+(_0x56e1bf[_0x24c167(0x6a8)][_0x24c167(0xc99)]||_0x5494d0)+_0x24c167(0xddc)+_0x56e1bf[_0x24c167(0x5d2)]+_0x24c167(0xfdf),_0x2facd1[_0x24c167(0x6ce)](_0x37a152);}),_0x3869ef[_0x4d3738(0x59b)](_0x4d89e1=>{const _0x3bae28=_0x4d3738,_0xbe54ff=document[_0x3bae28(0x219)](_0x3bae28(0xaf9));_0xbe54ff['className']='contact-picker-item',_0xbe54ff[_0x3bae28(0x746)][_0x3bae28(0x80a)]='npc_'+_0x4d89e1['id'],_0xbe54ff[_0x3bae28(0xf21)]=_0x3bae28(0x3bd)+(_0x4d89e1[_0x3bae28(0x95b)]||_0x54779f)+_0x3bae28(0xddc)+_0x4d89e1['name']+_0x3bae28(0x14e8),_0x2facd1[_0x3bae28(0x6ce)](_0xbe54ff);}),_0x5c2ecb();}function _0x5c2ecb(){const _0x51a9af=_0x2b1222,_0x333dc3=document[_0x51a9af(0x1f4)](_0x51a9af(0x261));_0x333dc3[_0x51a9af(0x231)]=_0x51a9af(0x2bc)+_0x2bd389['size']+')',_0x333dc3[_0x51a9af(0xa0d)]=_0x2bd389[_0x51a9af(0xb51)]<0x2;}async function _0x19928a(){const _0x115187=_0x2b1222;if(_0x2bd389[_0x115187(0xb51)]<0x2){alert(_0x115187(0x8b0));return;}const _0x428a7c=await _0x11f6fb('设置群名','请输入群聊的名字',_0x115187(0xe9e));if(!_0x428a7c||!_0x428a7c[_0x115187(0x4a2)]())return;const _0x1e3bf1=_0x115187(0x1262)+Date[_0x115187(0xd6e)](),_0x5c8c85=[],_0x1a8110=await _0x3df81a['npcs'][_0x115187(0x27a)]();for(const _0x4ad466 of _0x2bd389){if(_0x4ad466[_0x115187(0xebf)](_0x115187(0x27f))){const _0x54b94c=parseInt(_0x4ad466[_0x115187(0xef0)](_0x115187(0x27f),'')),_0x373550=_0x1a8110[_0x115187(0x13b7)](_0x161f4f=>_0x161f4f['id']===_0x54b94c);_0x373550&&_0x5c8c85[_0x115187(0x1426)]({'id':_0x4ad466,'originalName':_0x373550['name'],'groupNickname':_0x373550['name'],'persona':_0x373550[_0x115187(0x3be)],'avatar':_0x373550[_0x115187(0x95b)]||_0x54779f,'isNpc':!![]});}else{const _0x1fca0b=_0x1ae02e[_0x115187(0x589)][_0x4ad466];_0x1fca0b&&_0x5c8c85[_0x115187(0x1426)]({'id':_0x4ad466,'originalName':_0x1fca0b[_0x115187(0x96f)],'groupNickname':_0x1fca0b[_0x115187(0x5d2)],'persona':_0x1fca0b[_0x115187(0x6a8)][_0x115187(0xf42)],'avatar':_0x1fca0b[_0x115187(0x6a8)][_0x115187(0xc99)]||_0x5494d0,'isNpc':![]});}}const _0x53f6ad={'id':_0x1e3bf1,'name':_0x428a7c[_0x115187(0x4a2)](),'isGroup':!![],'members':_0x5c8c85,'settings':{'myPersona':_0x115187(0x1127),'myNickname':'我','maxMemory':0xa,'groupAvatar':_0x22fe34,'myAvatar':_0x203a38,'background':'','theme':_0x115187(0x372),'fontSize':0xd,'customCss':'','linkedWorldBookIds':[]},'history':[],'musicData':{'totalTime':0x0}};_0x1ae02e['chats'][_0x1e3bf1]=_0x53f6ad,await _0x3df81a[_0x115187(0x589)]['put'](_0x53f6ad),await _0x1033ae(),_0x2e53fa(_0x115187(0x133d)),_0x4c0122(_0x1e3bf1);}function _0x4a91e3(){const _0x4468c6=_0x2b1222;if(!_0x1ae02e['activeChatId']||!_0x1ae02e[_0x4468c6(0x589)][_0x1ae02e[_0x4468c6(0x588)]][_0x4468c6(0xe83)])return;_0xbf343b(),_0x2e53fa(_0x4468c6(0x3c6));}function _0xbf343b(){const _0x2d6ab7=_0x2b1222,_0x1198d1=document[_0x2d6ab7(0x1f4)](_0x2d6ab7(0x9a6)),_0x378832=_0x1ae02e[_0x2d6ab7(0x589)][_0x1ae02e['activeChatId']];_0x1198d1[_0x2d6ab7(0xf21)]='',_0x378832['members'][_0x2d6ab7(0x59b)](_0x13edbc=>{const _0x10f6e6=_0x2d6ab7,_0x3f9873=document[_0x10f6e6(0x219)](_0x10f6e6(0xaf9));_0x3f9873[_0x10f6e6(0x7c6)]=_0x10f6e6(0x382),_0x3f9873[_0x10f6e6(0xf21)]=_0x10f6e6(0x1344)+_0x13edbc['avatar']+_0x10f6e6(0x27c)+_0x13edbc[_0x10f6e6(0xd69)]+_0x10f6e6(0xb5f)+_0x13edbc['id']+'\x22\x20title=\x22移出群聊\x22>-</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x1198d1['appendChild'](_0x3f9873);});}async function _0xec098b(_0x396790){const _0x365ae5=_0x2b1222,_0x1ab944=_0x1ae02e['chats'][_0x1ae02e[_0x365ae5(0x588)]],_0x5e8af9=_0x1ab944['members']['findIndex'](_0x3e6ede=>_0x3e6ede['id']===_0x396790);if(_0x5e8af9===-0x1)return;if(_0x1ab944[_0x365ae5(0x1402)][_0x365ae5(0x58a)]<=0x2){alert('群聊人数不能少于2人。');return;}const _0x2b1843=_0x1ab944[_0x365ae5(0x1402)][_0x5e8af9][_0x365ae5(0xd69)],_0x5af1bd=await _0x109970(_0x365ae5(0x1219),_0x365ae5(0xa41)+_0x2b1843+_0x365ae5(0xb18),{'confirmButtonClass':_0x365ae5(0x1c6)});_0x5af1bd&&(_0x1ab944[_0x365ae5(0x1402)]['splice'](_0x5e8af9,0x1),await _0x3df81a[_0x365ae5(0x589)]['put'](_0x1ab944),_0xbf343b(),document[_0x365ae5(0x1f4)](_0x365ae5(0x4c4))[_0x365ae5(0x740)]());}async function _0x3332d5(){const _0xb31889=_0x2b1222,_0x267ba6=document[_0xb31889(0x1f4)](_0xb31889(0x261)),_0x3b2f92=_0x267ba6[_0xb31889(0xf44)](!![]);_0x267ba6[_0xb31889(0xad7)][_0xb31889(0xa88)](_0x3b2f92,_0x267ba6),_0x3b2f92[_0xb31889(0x122b)]('click',_0x8f849e),await _0x3ff0bc(),_0x2e53fa('contact-picker-screen');}async function _0x3ff0bc(){const _0x2c4faf=_0x2b1222,_0x381cfe=document[_0x2c4faf(0x1f4)](_0x2c4faf(0x10f0));_0x381cfe[_0x2c4faf(0xf21)]='',_0x2bd389[_0x2c4faf(0x411)]();const _0x59d4a1=_0x1ae02e[_0x2c4faf(0x589)][_0x1ae02e[_0x2c4faf(0x588)]],_0x5336d8=new Set(_0x59d4a1[_0x2c4faf(0x1402)]['map'](_0x3360e8=>_0x3360e8['id'])),_0x5b5831=Object[_0x2c4faf(0x753)](_0x1ae02e[_0x2c4faf(0x589)])[_0x2c4faf(0xede)](_0x4bfc68=>!_0x4bfc68['isGroup']&&!_0x5336d8[_0x2c4faf(0xe75)](_0x4bfc68['id'])),_0x41b8b2=(await _0x3df81a['npcs']['toArray']())[_0x2c4faf(0xede)](_0x2c61a3=>!_0x5336d8[_0x2c4faf(0xe75)]('npc_'+_0x2c61a3['id']));_0x5b5831[_0x2c4faf(0x58a)]===0x0&&_0x41b8b2['length']===0x0?(_0x381cfe['innerHTML']=_0x2c4faf(0xa45),document[_0x2c4faf(0x1f4)](_0x2c4faf(0x261))[_0x2c4faf(0x215)][_0x2c4faf(0x887)]=_0x2c4faf(0x1b5)):(document[_0x2c4faf(0x1f4)](_0x2c4faf(0x261))[_0x2c4faf(0x215)][_0x2c4faf(0x887)]=_0x2c4faf(0x361),_0x5b5831[_0x2c4faf(0x59b)](_0x7de09c=>{const _0xc047ec=_0x2c4faf,_0x28124c=document[_0xc047ec(0x219)](_0xc047ec(0xaf9));_0x28124c[_0xc047ec(0x7c6)]=_0xc047ec(0xec5),_0x28124c['dataset']['contactId']=_0x7de09c['id'],_0x28124c[_0xc047ec(0x746)][_0xc047ec(0x796)]=_0xc047ec(0x1381),_0x28124c[_0xc047ec(0xf21)]=_0xc047ec(0x4fb)+(_0x7de09c[_0xc047ec(0x6a8)]['aiAvatar']||_0x5494d0)+_0xc047ec(0x7cc)+_0x7de09c['name']+'\x20<small\x20style=\x22color:#888;\x22>(角色)</small></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x381cfe[_0xc047ec(0x6ce)](_0x28124c);}),_0x41b8b2[_0x2c4faf(0x59b)](_0xe7d71f=>{const _0x30e6f9=_0x2c4faf,_0x4c3dcf=document[_0x30e6f9(0x219)](_0x30e6f9(0xaf9));_0x4c3dcf[_0x30e6f9(0x7c6)]=_0x30e6f9(0xec5),_0x4c3dcf[_0x30e6f9(0x746)][_0x30e6f9(0x80a)]=_0x30e6f9(0x27f)+_0xe7d71f['id'],_0x4c3dcf[_0x30e6f9(0x746)]['contactType']='npc',_0x4c3dcf['dataset'][_0x30e6f9(0xd48)]=_0xe7d71f['id'],_0x4c3dcf[_0x30e6f9(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+(_0xe7d71f[_0x30e6f9(0x95b)]||_0x54779f)+_0x30e6f9(0x7cc)+_0xe7d71f[_0x30e6f9(0x5d2)]+_0x30e6f9(0x1338),_0x381cfe[_0x30e6f9(0x6ce)](_0x4c3dcf);})),_0x5c2ecb();}async function _0x8f849e(){const _0xba2fa8=_0x2b1222;if(_0x2bd389[_0xba2fa8(0xb51)]===0x0){alert('请至少选择一个要添加的联系人。');return;}const _0x3dd753=_0x1ae02e[_0xba2fa8(0x589)][_0x1ae02e[_0xba2fa8(0x588)]],_0x466e17=await _0x3df81a[_0xba2fa8(0x15b9)][_0xba2fa8(0x27a)]();for(const _0x474d35 of _0x2bd389){const _0x17a489=document[_0xba2fa8(0xeda)](_0xba2fa8(0xe8d)+_0x474d35+'\x22]');if(!_0x17a489)continue;const _0x3d801b=_0x17a489[_0xba2fa8(0x746)]['contactType'];if(_0x3d801b===_0xba2fa8(0x1381)){const _0x55049f=_0x1ae02e['chats'][_0x474d35];_0x55049f&&_0x3dd753[_0xba2fa8(0x1402)][_0xba2fa8(0x1426)]({'id':_0x474d35,'originalName':_0x55049f[_0xba2fa8(0x96f)],'groupNickname':_0x55049f[_0xba2fa8(0x5d2)],'persona':_0x55049f[_0xba2fa8(0x6a8)][_0xba2fa8(0xf42)],'avatar':_0x55049f[_0xba2fa8(0x6a8)]['aiAvatar']||_0x5494d0,'isNpc':![]});}else{if(_0x3d801b===_0xba2fa8(0x717)){const _0x2d9eda=parseInt(_0x17a489[_0xba2fa8(0x746)]['npcId']),_0x12aa31=_0x466e17[_0xba2fa8(0x13b7)](_0x3a200c=>_0x3a200c['id']===_0x2d9eda);_0x12aa31&&_0x3dd753['members'][_0xba2fa8(0x1426)]({'id':'npc_'+_0x2d9eda,'originalName':_0x12aa31[_0xba2fa8(0x5d2)],'groupNickname':_0x12aa31[_0xba2fa8(0x5d2)],'persona':_0x12aa31[_0xba2fa8(0x3be)],'avatar':_0x12aa31[_0xba2fa8(0x95b)]||_0x54779f,'isNpc':!![]});}}}await _0x3df81a[_0xba2fa8(0x589)][_0xba2fa8(0x295)](_0x3dd753),_0x4a91e3();}function _0x3a7902(){_0x206fc4=!![],_0x2b00f0(null);}function _0x2a3153(_0x4621b6,_0x36b726){const _0x3d40fc=setInterval(()=>{const _0x266dd5=_0x475c,_0x1b79b4=Date[_0x266dd5(0xd6e)](),_0x1b4190=_0x36b726-_0x1b79b4;if(_0x1b4190<0x0){clearInterval(_0x3d40fc),_0x4621b6['innerHTML']=_0x266dd5(0xba3);return;}const _0x1cea43=Math[_0x266dd5(0x123c)](_0x1b4190%(0x3e8*0x3c*0x3c)/(0x3e8*0x3c)),_0x51c13f=Math['floor'](_0x1b4190%(0x3e8*0x3c)/0x3e8),_0x448dd8=String(_0x1cea43)[_0x266dd5(0x1189)](0x2,'0'),_0x34ab0f=String(_0x51c13f)[_0x266dd5(0x1189)](0x2,'0');_0x4621b6[_0x266dd5(0xf21)]='<span>'+_0x448dd8['charAt'](0x0)+_0x266dd5(0xb4f)+_0x448dd8[_0x266dd5(0x5c9)](0x1)+_0x266dd5(0x68b)+_0x34ab0f['charAt'](0x0)+_0x266dd5(0xb4f)+_0x34ab0f[_0x266dd5(0x5c9)](0x1)+_0x266dd5(0xa0c);},0x3e8);return _0x3d40fc;}function _0x3829aa(){for(const _0x1eb486 in _0x5daf45){clearInterval(_0x5daf45[_0x1eb486]);}_0x5daf45={};}async function _0x109af1(_0x5a7f9a){const _0xab1622=_0x2b1222,_0x56d68b=_0x1ae02e[_0xab1622(0x589)][_0x1ae02e['activeChatId']];if(!_0x56d68b)return;const _0x4d2b01=_0x56d68b[_0xab1622(0xce3)][_0xab1622(0x13b7)](_0x340cae=>_0x340cae[_0xab1622(0x1388)]===_0x5a7f9a);if(!_0x4d2b01||![_0xab1622(0x4a4),'waimai_order'][_0xab1622(0xe82)](_0x4d2b01[_0xab1622(0xcbd)])){console[_0xab1622(0x127d)](_0xab1622(0x43c),_0x5a7f9a);return;}let _0x5074f3='';if(_0x4d2b01[_0xab1622(0xcbd)]===_0xab1622(0x4a4)){let _0xd3211f;switch(_0x4d2b01[_0xab1622(0x1589)]){case _0xab1622(0xe0b):const _0x59cc0c=_0x4d2b01[_0xab1622(0xa32)]||'对方',_0x320e67=_0x140540(_0x56d68b,_0x59cc0c);_0xd3211f='由\x20'+_0x320e67+'\x20为您代付成功';break;case _0xab1622(0x69b):_0xd3211f=_0xab1622(0xcbc);break;default:_0xd3211f=_0xab1622(0x714);break;}_0x5074f3='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20left;\x20font-size:\x2015px;\x20line-height:\x201.8;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>商品:</strong>\x20'+_0x4d2b01['productInfo']+_0xab1622(0x105e)+Number(_0x4d2b01[_0xab1622(0x618)])[_0xab1622(0x24f)](0x2)+_0xab1622(0x1457)+_0xd3211f+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}else{if(_0x4d2b01[_0xab1622(0xcbd)]==='waimai_order'){let _0x3735f9,_0x3f4e30;_0x56d68b['isGroup']?(_0x3735f9=_0x140540(_0x56d68b,_0x4d2b01[_0xab1622(0xfb7)]),_0x3f4e30=_0x140540(_0x56d68b,_0x4d2b01[_0xab1622(0x309)])):_0x4d2b01[_0xab1622(0xfbb)]===_0xab1622(0x860)?(_0x3735f9=_0x56d68b['settings'][_0xab1622(0xe31)]||'我',_0x3f4e30=_0x56d68b[_0xab1622(0x5d2)]):(_0x3735f9=_0x56d68b[_0xab1622(0x5d2)],_0x3f4e30=_0x56d68b[_0xab1622(0x6a8)][_0xab1622(0xe31)]||'我'),_0x5074f3=_0xab1622(0x2df)+_0x3735f9+_0xab1622(0xdc8)+_0x3f4e30+'<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>商品:</strong>\x20'+_0x4d2b01[_0xab1622(0xbf5)]+_0xab1622(0x105e)+Number(_0x4d2b01['amount'])[_0xab1622(0x24f)](0x2)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}}await _0x1460c5(_0xab1622(0x1182),_0x5074f3);}async function _0x57ac52(_0x28c957,_0xa52b61){const _0x54b10b=_0x2b1222,_0xdb2361=_0x1ae02e['chats'][_0x1ae02e['activeChatId']];if(!_0xdb2361)return;const _0x144aed=_0xdb2361[_0x54b10b(0xce3)]['findIndex'](_0x9a08ed=>_0x9a08ed['timestamp']===_0x28c957);if(_0x144aed===-0x1)return;const _0x110ad7=_0xdb2361[_0x54b10b(0xce3)][_0x144aed];_0x110ad7[_0x54b10b(0x1589)]=_0xa52b61;let _0x223653;const _0x31eeeb=_0xdb2361[_0x54b10b(0xe83)]?_0xdb2361['settings'][_0x54b10b(0xe31)]||'我':'我';_0xa52b61===_0x54b10b(0xe0b)?(_0x110ad7[_0x54b10b(0xa32)]=_0x31eeeb,_0x223653=_0x54b10b(0x15ab)+_0x31eeeb+_0x54b10b(0xe59)+_0x110ad7['senderName']+_0x54b10b(0x1247)+_0x28c957+_0x54b10b(0x10a0)):_0x223653=_0x54b10b(0x15ab)+_0x31eeeb+')\x20拒绝了\x20'+_0x110ad7['senderName']+_0x54b10b(0x256)+_0x28c957+'）。]';const _0x179adb={'role':_0x54b10b(0x1594),'content':_0x223653,'timestamp':Date[_0x54b10b(0xd6e)](),'isHidden':!![]};_0xdb2361[_0x54b10b(0xce3)][_0x54b10b(0x1426)](_0x179adb),await _0x3df81a[_0x54b10b(0x589)]['put'](_0xdb2361),_0x3689f0(_0x1ae02e[_0x54b10b(0x588)]);}let _0x11ced0={'isActive':![],'isAwaitingResponse':![],'isGroupCall':![],'activeChatId':null,'initiator':null,'startTime':null,'participants':[],'isUserParticipating':!![],'callHistory':[],'preCallContext':''},_0x442708=null;async function _0x266a61(){const _0x12c5a0=_0x2b1222;if(!_0x1ae02e[_0x12c5a0(0x588)]||_0x11ced0[_0x12c5a0(0xd51)]||_0x11ced0[_0x12c5a0(0x116c)])return;const _0x5b449c=_0x1ae02e[_0x12c5a0(0x589)][_0x1ae02e['activeChatId']];_0x11ced0[_0x12c5a0(0xd5e)]=_0x5b449c[_0x12c5a0(0xe83)],_0x11ced0[_0x12c5a0(0x116c)]=!![],_0x11ced0['initiator']=_0x12c5a0(0x860),_0x11ced0['activeChatId']=_0x5b449c['id'],_0x11ced0[_0x12c5a0(0x59d)]=!![];_0x5b449c[_0x12c5a0(0xe83)]?(document[_0x12c5a0(0x1f4)](_0x12c5a0(0xc18))[_0x12c5a0(0x9fe)]=_0x5b449c[_0x12c5a0(0x6a8)][_0x12c5a0(0x1207)]||_0x203a38,document[_0x12c5a0(0x1f4)](_0x12c5a0(0x121c))['textContent']=_0x5b449c[_0x12c5a0(0x6a8)][_0x12c5a0(0xe31)]||'我'):(document[_0x12c5a0(0x1f4)](_0x12c5a0(0xc18))[_0x12c5a0(0x9fe)]=_0x5b449c['settings'][_0x12c5a0(0xc99)]||_0x5494d0,document['getElementById'](_0x12c5a0(0x121c))[_0x12c5a0(0x231)]=_0x5b449c[_0x12c5a0(0x5d2)]);document['querySelector'](_0x12c5a0(0x979))[_0x12c5a0(0x231)]=_0x5b449c[_0x12c5a0(0xe83)]?_0x12c5a0(0xae9):_0x12c5a0(0x7ed),_0x2e53fa(_0x12c5a0(0x112e));const _0x1ee36c={'role':_0x12c5a0(0x1594),'content':_0x5b449c[_0x12c5a0(0xe83)]?'[系统提示：用户\x20('+(_0x5b449c[_0x12c5a0(0x6a8)][_0x12c5a0(0xe31)]||'我')+_0x12c5a0(0x4d4):_0x12c5a0(0xd8a),'timestamp':Date[_0x12c5a0(0xd6e)](),'isHidden':!![]};_0x5b449c[_0x12c5a0(0xce3)]['push'](_0x1ee36c),await _0x3df81a[_0x12c5a0(0x589)]['put'](_0x5b449c),await _0x5626da();}function _0xeb5668(){const _0x123d0a=_0x2b1222,_0x2ae84f=_0x1ae02e[_0x123d0a(0x589)][_0x11ced0[_0x123d0a(0x588)]];if(!_0x2ae84f)return;_0x11ced0[_0x123d0a(0xd51)]=!![],_0x11ced0[_0x123d0a(0x116c)]=![],_0x11ced0[_0x123d0a(0xc1c)]=Date[_0x123d0a(0xd6e)](),_0x11ced0[_0x123d0a(0x72a)]=[];const _0x229434=_0x2ae84f[_0x123d0a(0xce3)]['slice'](-0xa);_0x11ced0[_0x123d0a(0x7d3)]=_0x229434[_0x123d0a(0x1431)](_0x107fb6=>{const _0x1d0e3e=_0x123d0a,_0x3c14ed=_0x107fb6[_0x1d0e3e(0xfbb)]===_0x1d0e3e(0x860)?_0x2ae84f[_0x1d0e3e(0x6a8)][_0x1d0e3e(0xe31)]||'我':_0x107fb6[_0x1d0e3e(0xfb7)]||_0x2ae84f['name'];return _0x3c14ed+':\x20'+String(_0x107fb6[_0x1d0e3e(0x128c)])[_0x1d0e3e(0x516)](0x0,0x32)+_0x1d0e3e(0x629);})[_0x123d0a(0x1143)]('\x0a'),_0x9e8a42(),document[_0x123d0a(0x1f4)](_0x123d0a(0x3a7))[_0x123d0a(0xf21)]='<em>'+(_0x11ced0[_0x123d0a(0xd5e)]?_0x123d0a(0xcb2):_0x123d0a(0x15bb))+_0x123d0a(0xbf2),_0x2e53fa(_0x123d0a(0x9d1)),document['getElementById'](_0x123d0a(0xa53))['style'][_0x123d0a(0x887)]=_0x11ced0[_0x123d0a(0x59d)]?_0x123d0a(0x361):'none',document[_0x123d0a(0x1f4)](_0x123d0a(0xea8))['style'][_0x123d0a(0x887)]=_0x11ced0[_0x123d0a(0x59d)]?_0x123d0a(0x1b5):_0x123d0a(0x361);if(_0x442708)clearInterval(_0x442708);_0x442708=setInterval(_0x1387c5,0x3e8),_0x1387c5(),_0x5e7bc2();}async function _0x102da0(){const _0x332bd8=_0x2b1222;if(!_0x11ced0[_0x332bd8(0xd51)])return;const _0xbdecae=Math[_0x332bd8(0x123c)]((Date[_0x332bd8(0xd6e)]()-_0x11ced0[_0x332bd8(0xc1c)])/0x3e8),_0xc20465=Math['floor'](_0xbdecae/0x3c)+'分'+_0xbdecae%0x3c+'秒',_0x2714f9=_0x332bd8(0x1115)+_0xc20465,_0x4cd9f9=_0x1ae02e['chats'][_0x11ced0['activeChatId']];if(_0x4cd9f9){const _0x2cadc0=[];_0x11ced0[_0x332bd8(0xd5e)]?(_0x11ced0[_0x332bd8(0x1059)][_0x332bd8(0x59b)](_0x2dc5ca=>_0x2cadc0[_0x332bd8(0x1426)]({'name':_0x2dc5ca[_0x332bd8(0x96f)],'avatar':_0x2dc5ca[_0x332bd8(0x95b)]})),_0x11ced0['isUserParticipating']&&_0x2cadc0[_0x332bd8(0x303)]({'name':_0x4cd9f9['settings']['myNickname']||'我','avatar':_0x4cd9f9['settings'][_0x332bd8(0x1207)]||_0x203a38})):(_0x2cadc0[_0x332bd8(0x1426)]({'name':_0x4cd9f9[_0x332bd8(0x5d2)],'avatar':_0x4cd9f9[_0x332bd8(0x6a8)]['aiAvatar']||_0x5494d0}),_0x2cadc0[_0x332bd8(0x303)]({'name':'我','avatar':_0x4cd9f9[_0x332bd8(0x6a8)][_0x332bd8(0x1207)]||_0x5494d0}));const _0x11c43d={'chatId':_0x11ced0[_0x332bd8(0x588)],'timestamp':Date['now'](),'duration':_0xbdecae,'participants':_0x2cadc0,'transcript':[..._0x11ced0[_0x332bd8(0x72a)]]};await _0x3df81a[_0x332bd8(0xac4)][_0x332bd8(0x6a4)](_0x11c43d),console[_0x332bd8(0x57e)]('通话记录已保存:',_0x11c43d);let _0x4988ce={'role':_0x11ced0['initiator']===_0x332bd8(0x860)?'user':_0x332bd8(0x13c0),'content':_0x2714f9,'timestamp':Date[_0x332bd8(0xd6e)]()};_0x4cd9f9[_0x332bd8(0xe83)]&&_0x4988ce[_0x332bd8(0xfbb)]==='assistant'&&(_0x4988ce[_0x332bd8(0xfb7)]=_0x11ced0[_0x332bd8(0x108f)]||_0x4cd9f9[_0x332bd8(0x1402)][0x0]?.[_0x332bd8(0x96f)]||_0x4cd9f9[_0x332bd8(0x5d2)]);_0x4cd9f9[_0x332bd8(0xce3)][_0x332bd8(0x1426)](_0x4988ce);const _0x3521a6=_0x11ced0[_0x332bd8(0x72a)]['map'](_0x1805ac=>{const _0x23b6f9=_0x332bd8,_0x19dbf6=_0x1805ac['role']==='user'?_0x4cd9f9[_0x23b6f9(0x6a8)][_0x23b6f9(0xe31)]||'我':_0x1805ac[_0x23b6f9(0xfb7)];return _0x19dbf6+':\x20'+_0x1805ac[_0x23b6f9(0x128c)];})[_0x332bd8(0x1143)]('\x0a');_0x291745(_0x4cd9f9['id'],_0x3521a6);const _0xb4320={'role':_0x332bd8(0x1594),'content':_0x332bd8(0x1447),'timestamp':Date[_0x332bd8(0xd6e)]()+0x1,'isHidden':!![]};_0x4cd9f9[_0x332bd8(0xce3)]['push'](_0xb4320),await _0x3df81a[_0x332bd8(0x589)][_0x332bd8(0x295)](_0x4cd9f9);}clearInterval(_0x442708),_0x442708=null,_0x11ced0={'isActive':![],'isAwaitingResponse':![],'isGroupCall':![],'activeChatId':null,'initiator':null,'startTime':null,'participants':[],'isUserParticipating':!![],'callHistory':[],'preCallContext':''},_0x4cd9f9&&(_0x4c0122(_0x4cd9f9['id']),_0x5626da());}function _0x9e8a42(){const _0x4768c8=_0x2b1222,_0x325c09=document['getElementById'](_0x4768c8(0x42b));_0x325c09[_0x4768c8(0xf21)]='';const _0x4f1f7b=_0x1ae02e[_0x4768c8(0x589)][_0x11ced0[_0x4768c8(0x588)]];if(!_0x4f1f7b)return;let _0x292fcc=[];_0x11ced0[_0x4768c8(0xd5e)]?(_0x292fcc=[..._0x11ced0[_0x4768c8(0x1059)]],_0x11ced0['isUserParticipating']&&_0x292fcc[_0x4768c8(0x303)]({'id':_0x4768c8(0x860),'name':_0x4f1f7b[_0x4768c8(0x6a8)][_0x4768c8(0xe31)]||'我','avatar':_0x4f1f7b['settings']['myAvatar']||_0x203a38})):_0x292fcc[_0x4768c8(0x1426)]({'id':'ai','name':_0x4f1f7b['name'],'avatar':_0x4f1f7b[_0x4768c8(0x6a8)]['aiAvatar']||_0x5494d0}),_0x292fcc[_0x4768c8(0x59b)](_0x1c902f=>{const _0x4eedff=_0x4768c8,_0x30c18c=document['createElement']('div');_0x30c18c['className']='participant-avatar-wrapper',_0x30c18c[_0x4eedff(0x746)][_0x4eedff(0x755)]=_0x1c902f['id'];const _0xc04304=_0x1c902f[_0x4eedff(0xd69)]||_0x1c902f[_0x4eedff(0x5d2)];_0x30c18c['innerHTML']=_0x4eedff(0x90b)+_0x1c902f[_0x4eedff(0x95b)]+_0x4eedff(0x390)+_0xc04304+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22participant-name\x22>'+_0xc04304+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x325c09[_0x4eedff(0x6ce)](_0x30c18c);});}function _0x3688e3(){const _0x3b8b53=_0x2b1222;if(!_0x11ced0[_0x3b8b53(0xd51)]||_0x11ced0[_0x3b8b53(0x59d)])return;_0x11ced0[_0x3b8b53(0x59d)]=!![],_0x9e8a42(),document[_0x3b8b53(0x1f4)](_0x3b8b53(0xa53))['style'][_0x3b8b53(0x887)]=_0x3b8b53(0x361),document[_0x3b8b53(0x1f4)](_0x3b8b53(0xea8))[_0x3b8b53(0x215)][_0x3b8b53(0x887)]=_0x3b8b53(0x1b5),_0x5e7bc2('[系统提示：用户加入了通话]');}function _0x1387c5(){const _0x374a98=_0x2b1222;if(!_0x11ced0[_0x374a98(0xd51)])return;const _0xddc0f5=Math[_0x374a98(0x123c)]((Date[_0x374a98(0xd6e)]()-_0x11ced0[_0x374a98(0xc1c)])/0x3e8),_0x13f661=Math[_0x374a98(0x123c)](_0xddc0f5/0x3c),_0x1a4c6d=_0xddc0f5%0x3c;document[_0x374a98(0x1f4)](_0x374a98(0xf92))[_0x374a98(0x231)]=String(_0x13f661)[_0x374a98(0x1189)](0x2,'0')+':'+String(_0x1a4c6d)[_0x374a98(0x1189)](0x2,'0');}function _0x165339(){const _0x1ce857=_0x2b1222,_0x293d9b=_0x1ae02e[_0x1ce857(0x589)][_0x1ae02e[_0x1ce857(0x588)]];if(!_0x293d9b)return;if(_0x293d9b[_0x1ce857(0xe83)]){const _0x4f982d=_0x11ced0[_0x1ce857(0x108f)]||_0x293d9b[_0x1ce857(0x1402)][0x0]?.[_0x1ce857(0x5d2)]||_0x1ce857(0x499);document[_0x1ce857(0x1f4)](_0x1ce857(0xf40))['src']=_0x293d9b['settings'][_0x1ce857(0xe46)]||_0x22fe34,document['getElementById'](_0x1ce857(0x7a5))[_0x1ce857(0x231)]=_0x293d9b['name'],document[_0x1ce857(0xeda)](_0x1ce857(0x6e2))[_0x1ce857(0x231)]=_0x4f982d+_0x1ce857(0x1113);}else document[_0x1ce857(0x1f4)](_0x1ce857(0xf40))['src']=_0x293d9b['settings']['aiAvatar']||_0x5494d0,document[_0x1ce857(0x1f4)]('caller-name')[_0x1ce857(0x231)]=_0x293d9b[_0x1ce857(0x5d2)],document[_0x1ce857(0xeda)](_0x1ce857(0x6e2))['textContent']=_0x1ce857(0x2d5);document[_0x1ce857(0x1f4)](_0x1ce857(0xc4f))[_0x1ce857(0x159b)][_0x1ce857(0x6a4)](_0x1ce857(0xfca));}function _0x2a3f87(){const _0x11e1ef=_0x2b1222;document[_0x11e1ef(0x1f4)](_0x11e1ef(0xc4f))[_0x11e1ef(0x159b)][_0x11e1ef(0xa9c)](_0x11e1ef(0xfca));}async function _0x5e7bc2(_0x40e613=null){const _0x3038d8=_0x2b1222;if(!_0x11ced0[_0x3038d8(0xd51)])return;const _0x5f5ce3=_0x1ae02e[_0x3038d8(0x589)][_0x11ced0['activeChatId']],{proxyUrl:_0x184ba0,apiKey:_0x555deb,model:_0x341f8b}=_0x1ae02e[_0x3038d8(0x226)],_0x7339b0=document[_0x3038d8(0x1f4)](_0x3038d8(0x3a7)),_0x11ba3d=_0x5f5ce3[_0x3038d8(0x6a8)][_0x3038d8(0xe31)]||'我';let _0x430bb8='';if(_0x5f5ce3[_0x3038d8(0x6a8)][_0x3038d8(0x1469)]&&_0x5f5ce3['settings'][_0x3038d8(0x1469)]['length']>0x0){const _0x1f810a=_0x5f5ce3[_0x3038d8(0x6a8)]['linkedWorldBookIds'][_0x3038d8(0x1431)](_0x17481f=>{const _0x459296=_0x3038d8,_0x217bec=_0x1ae02e['worldBooks'][_0x459296(0x13b7)](_0x16c3d6=>_0x16c3d6['id']===_0x17481f);return _0x217bec&&_0x217bec[_0x459296(0x128c)]?_0x459296(0x404)+_0x217bec['name']+'\x0a'+_0x217bec[_0x459296(0x128c)]:'';})['filter'](Boolean)[_0x3038d8(0x1143)]('');_0x1f810a&&(_0x430bb8=_0x3038d8(0x855)+_0x1f810a+_0x3038d8(0x47a));}if(_0x40e613&&_0x11ced0[_0x3038d8(0x59d)]){const _0x3107b9=Date[_0x3038d8(0xd6e)](),_0x175c10=document['createElement']('div');_0x175c10[_0x3038d8(0x7c6)]=_0x3038d8(0x7c8),_0x175c10[_0x3038d8(0x231)]=_0x40e613,_0x175c10[_0x3038d8(0x746)]['timestamp']=_0x3107b9,_0x1160f3(_0x175c10,()=>_0x240884(_0x3107b9)),_0x7339b0[_0x3038d8(0x6ce)](_0x175c10),_0x7339b0[_0x3038d8(0x2d4)]=_0x7339b0[_0x3038d8(0x1092)],_0x11ced0[_0x3038d8(0x72a)][_0x3038d8(0x1426)]({'role':'user','content':_0x40e613,'timestamp':_0x3107b9});}let _0xce91d6;if(_0x11ced0['isGroupCall']){const _0x112a68=_0x11ced0[_0x3038d8(0x1059)][_0x3038d8(0x1431)](_0x3826a7=>_0x3826a7[_0x3038d8(0x5d2)]);_0x11ced0[_0x3038d8(0x59d)]&&_0x112a68[_0x3038d8(0x303)](_0x11ba3d),_0xce91d6=_0x3038d8(0x1288)+_0x11ba3d+'】。你【绝对不能】生成\x20`name`\x20字段为\x20**\x22'+_0x11ba3d+_0x3038d8(0x13ca)+_0x11ced0[_0x3038d8(0x7d3)]+_0x3038d8(0xb1a)+_0x112a68[_0x3038d8(0x1143)]('、\x20')+'。\x0a\x20\x20\x20\x20\x20\x20\x20\x20**通话刚刚开始...**\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+_0x430bb8+_0x3038d8(0xe71);}else{let _0x37ab0c=_0x11ced0[_0x3038d8(0x735)]==='user'?'你刚刚接听了用户的视频通话请求。':_0x3038d8(0x2cc);_0xce91d6=_0x3038d8(0x773)+_0x5f5ce3[_0x3038d8(0x5d2)]+'\x20('+_0x5f5ce3[_0x3038d8(0x6a8)]['aiPersona']+')，并以【第三人称旁观视角】来描述TA在视频通话中的所有动作和语言。\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20核心规则\x0a\x20\x20\x20\x20\x20\x20\x20\x201.\x20\x20**【【【视角铁律】】】**:\x20你的回复【绝对不能】使用第一人称“我”。必须使用第三人称，如“他”、“她”、或直接使用角色名“'+_0x5f5ce3[_0x3038d8(0x5d2)]+_0x3038d8(0x5ee)+_0x11ba3d+_0x3038d8(0xfff)+_0x5f5ce3[_0x3038d8(0x6a8)][_0x3038d8(0x36b)]+_0x3038d8(0x194)+_0x37ab0c+_0x3038d8(0x427)+_0x11ced0[_0x3038d8(0x7d3)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20现在，请根据【通话前摘要】和下面的【通话实时记录】，继续进行对话。\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}const _0x36025d=[{'role':'system','content':_0xce91d6},..._0x11ced0[_0x3038d8(0x72a)][_0x3038d8(0x1431)](_0x16b5be=>({'role':_0x16b5be['role'],'content':_0x16b5be['content']}))];if(_0x11ced0['callHistory'][_0x3038d8(0x58a)]===0x0){const _0x54fddf=_0x11ced0['initiator']===_0x3038d8(0x860)?'*你按下了接听键...*':_0x3038d8(0x2ca);_0x36025d[_0x3038d8(0x1426)]({'role':_0x3038d8(0x860),'content':_0x54fddf});}try{let _0x4691a7=_0x184ba0===GEMINI_API_URL,_0x58a871=_0x16b978(_0x341f8b,_0x555deb,_0xce91d6,_0x36025d);const _0x55426f=_0x4691a7?await fetch(_0x58a871[_0x3038d8(0x258)],_0x58a871[_0x3038d8(0xc6b)]):await fetch(_0x184ba0+_0x3038d8(0x14c2),{'method':'POST','headers':{'Content-Type':_0x3038d8(0xa90),'Authorization':_0x3038d8(0xf03)+_0x555deb},'body':JSON['stringify']({'model':_0x341f8b,'messages':_0x36025d,'temperature':_0x1ae02e[_0x3038d8(0x12c0)][_0x3038d8(0x217)]||0.8})});if(!_0x55426f['ok'])throw new Error((await _0x55426f[_0x3038d8(0xb84)]())[_0x3038d8(0x127d)][_0x3038d8(0x11f0)]);const _0x4c0b5d=await _0x55426f['json'](),_0x39143c=_0x4691a7?_0x4c0b5d[_0x3038d8(0x152f)][0x0][_0x3038d8(0x128c)][_0x3038d8(0x14fb)][0x0]['text']:_0x4c0b5d['choices'][0x0][_0x3038d8(0x11f0)][_0x3038d8(0x128c)],_0x32b0d5=_0x7339b0[_0x3038d8(0xeda)]('em');if(_0x32b0d5)_0x32b0d5[_0x3038d8(0xa9c)]();if(_0x11ced0[_0x3038d8(0xd5e)]){const _0x3bde67=_0x1493d9(_0x39143c);_0x3bde67[_0x3038d8(0x59b)](_0x4a5dd9=>{const _0x4a74dc=_0x3038d8;if(!_0x4a5dd9[_0x4a74dc(0x5d2)]||_0x4a5dd9['name']===_0x11ba3d||!_0x4a5dd9[_0x4a74dc(0x9cd)])return;const _0x4390b1=Date[_0x4a74dc(0xd6e)]()+Math[_0x4a74dc(0x13ae)](),_0x443a9c=document[_0x4a74dc(0x219)](_0x4a74dc(0xaf9));_0x443a9c[_0x4a74dc(0x7c6)]=_0x4a74dc(0xd73),_0x443a9c['innerHTML']=_0x4a74dc(0x894)+_0x4a5dd9[_0x4a74dc(0x5d2)]+':</strong>\x20'+_0x4a5dd9['speech'],_0x443a9c[_0x4a74dc(0x746)][_0x4a74dc(0x1388)]=_0x4390b1,_0x1160f3(_0x443a9c,()=>_0x240884(_0x4390b1)),_0x7339b0[_0x4a74dc(0x6ce)](_0x443a9c),_0x11ced0[_0x4a74dc(0x72a)]['push']({'role':_0x4a74dc(0x13c0),'content':_0x4a5dd9['name']+':\x20'+_0x4a5dd9[_0x4a74dc(0x9cd)],'timestamp':_0x4390b1});const _0x305b7b=_0x11ced0[_0x4a74dc(0x1059)][_0x4a74dc(0x13b7)](_0x4bd883=>_0x4bd883[_0x4a74dc(0x5d2)]===_0x4a5dd9[_0x4a74dc(0x5d2)]);if(_0x305b7b){const _0x49751d=document[_0x4a74dc(0xeda)](_0x4a74dc(0x9f8)+_0x305b7b['id']+_0x4a74dc(0xec8));_0x49751d&&(_0x49751d[_0x4a74dc(0x159b)][_0x4a74dc(0x6a4)](_0x4a74dc(0x8ed)),setTimeout(()=>_0x49751d['classList'][_0x4a74dc(0xa9c)](_0x4a74dc(0x8ed)),0x7d0));}});}else{const _0x5d5003=Date[_0x3038d8(0xd6e)](),_0x591c96=document[_0x3038d8(0x219)]('div');_0x591c96[_0x3038d8(0x7c6)]=_0x3038d8(0xd73),_0x591c96['textContent']=_0x39143c,_0x591c96[_0x3038d8(0x746)][_0x3038d8(0x1388)]=_0x5d5003,_0x1160f3(_0x591c96,()=>_0x240884(_0x5d5003)),_0x7339b0[_0x3038d8(0x6ce)](_0x591c96),_0x11ced0[_0x3038d8(0x72a)][_0x3038d8(0x1426)]({'role':_0x3038d8(0x13c0),'content':_0x39143c,'timestamp':_0x5d5003});const _0x30d921=document[_0x3038d8(0xeda)](_0x3038d8(0x33e));_0x30d921&&(_0x30d921['classList']['add'](_0x3038d8(0x8ed)),setTimeout(()=>_0x30d921[_0x3038d8(0x159b)][_0x3038d8(0xa9c)]('speaking'),0x7d0));}_0x7339b0[_0x3038d8(0x2d4)]=_0x7339b0[_0x3038d8(0x1092)];}catch(_0x56d0ea){const _0x4f3f6d=document[_0x3038d8(0x219)]('div');_0x4f3f6d[_0x3038d8(0x7c6)]=_0x3038d8(0xd73),_0x4f3f6d[_0x3038d8(0x215)][_0x3038d8(0x1451)]=_0x3038d8(0x14a7),_0x4f3f6d[_0x3038d8(0x231)]=_0x3038d8(0xbcc)+_0x56d0ea[_0x3038d8(0x11f0)]+']',_0x7339b0[_0x3038d8(0x6ce)](_0x4f3f6d),_0x7339b0[_0x3038d8(0x2d4)]=_0x7339b0[_0x3038d8(0x1092)],_0x11ced0['callHistory'][_0x3038d8(0x1426)]({'role':'assistant','content':_0x3038d8(0xbcc)+_0x56d0ea[_0x3038d8(0x11f0)]+']'});}}function _0x5ed783(_0x21ed4b){const _0x1de314=_0x2b1222;document['getElementById'](_0x1de314(0xade))[_0x1de314(0x215)]['display']=_0x21ed4b?_0x1de314(0x1b5):_0x1de314(0xeba),document[_0x1de314(0x1f4)](_0x1de314(0x1547))[_0x1de314(0x215)][_0x1de314(0x887)]=_0x21ed4b?_0x1de314(0xeba):_0x1de314(0x1b5);}async function _0x57ac52(_0x1dd2f6,_0x22d5aa){const _0x386ee6=_0x2b1222,_0x36e43e=_0x1ae02e[_0x386ee6(0x589)][_0x1ae02e[_0x386ee6(0x588)]];if(!_0x36e43e)return;const _0xa69ede=_0x36e43e[_0x386ee6(0xce3)][_0x386ee6(0xf2d)](_0x2acc2a=>_0x2acc2a[_0x386ee6(0x1388)]===_0x1dd2f6);if(_0xa69ede===-0x1)return;const _0x36025e=_0x36e43e[_0x386ee6(0xce3)][_0xa69ede];_0x36025e[_0x386ee6(0x1589)]=_0x22d5aa;let _0x2d40ba;const _0x56e397=_0x36e43e['isGroup']?_0x36e43e[_0x386ee6(0x6a8)]['myNickname']||'我':'我';_0x22d5aa===_0x386ee6(0xe0b)?(_0x36025e[_0x386ee6(0xa32)]=_0x56e397,_0x2d40ba=_0x386ee6(0x15ab)+_0x56e397+_0x386ee6(0xe59)+_0x36025e[_0x386ee6(0xfb7)]+_0x386ee6(0x1247)+_0x1dd2f6+_0x386ee6(0x10a0)):_0x2d40ba=_0x386ee6(0x15ab)+_0x56e397+_0x386ee6(0x1350)+_0x36025e[_0x386ee6(0xfb7)]+_0x386ee6(0x256)+_0x1dd2f6+_0x386ee6(0x1ad);const _0x153efd={'role':_0x386ee6(0x1594),'content':_0x2d40ba,'timestamp':Date['now'](),'isHidden':!![]};_0x36e43e[_0x386ee6(0xce3)]['push'](_0x153efd),await _0x3df81a[_0x386ee6(0x589)][_0x386ee6(0x295)](_0x36e43e),_0x3689f0(_0x1ae02e[_0x386ee6(0x588)]),_0x22d5aa===_0x386ee6(0xe0b)&&_0x5626da();}async function _0x2baf5c(_0x5622b4,_0x182a99){const _0x547da0=_0x2b1222,_0x5646ba=_0x1ae02e[_0x547da0(0x589)][_0x5622b4];if(!_0x5646ba)return;let _0x52d953;_0x5646ba[_0x547da0(0xe83)]?_0x52d953=_0x140540(_0x5646ba,_0x182a99):_0x52d953=_0x5646ba[_0x547da0(0x5d2)];const _0x5c0cbd=document['getElementById'](_0x547da0(0x296));_0x5c0cbd['classList']['remove']('pat-animation'),void _0x5c0cbd[_0x547da0(0x93a)],_0x5c0cbd[_0x547da0(0x159b)][_0x547da0(0x6a4)](_0x547da0(0x1550));const _0x291b43=await _0x11f6fb(_0x547da0(0xd8e)+_0x52d953+'”',_0x547da0(0x1563),'','text');if(_0x291b43===null)return;const _0x3446bd=_0x140540(_0x5646ba,_0x1ae02e['qzoneSettings'][_0x547da0(0xb46)]),_0x2ef30b=_0x3446bd+_0x547da0(0x64d)+_0x52d953+'”\x20'+_0x291b43['trim'](),_0x347ea8={'role':_0x547da0(0x1594),'type':_0x547da0(0x1454),'content':_0x2ef30b,'timestamp':Date[_0x547da0(0xd6e)]()};_0x5646ba[_0x547da0(0xce3)][_0x547da0(0x1426)](_0x347ea8);const _0xacd03a=_0x547da0(0xcd3)+_0x3446bd+_0x547da0(0x1162)+_0x182a99+'）'+_0x291b43['trim']()+_0x547da0(0x123d),_0xb14b56={'role':_0x547da0(0x1594),'content':_0xacd03a,'timestamp':Date[_0x547da0(0xd6e)]()+0x1,'isHidden':!![]};_0x5646ba[_0x547da0(0xce3)]['push'](_0xb14b56),await _0x3df81a['chats']['put'](_0x5646ba),_0x1ae02e[_0x547da0(0x588)]===_0x5622b4&&_0x5286f1(_0x347ea8,_0x5646ba),await _0x1033ae();}let _0x2bcd4e=null,_0x41d472=![],_0x578a04=new Set();function _0x240884(_0x17e789){const _0x1158ae=_0x2b1222;_0x2bcd4e=_0x17e789,document[_0x1158ae(0x1f4)](_0x1158ae(0x69d))[_0x1158ae(0x159b)][_0x1158ae(0x6a4)]('visible');}function _0x1af44f(){const _0x1c06be=_0x2b1222;document[_0x1c06be(0x1f4)]('call-message-actions-modal')['classList'][_0x1c06be(0xa9c)](_0x1c06be(0xfca)),_0x2bcd4e=null;}async function _0x5491c4(){const _0x19240b=_0x2b1222;if(!_0x2bcd4e)return;const _0x1fe76b=_0x2bcd4e,_0x121ac6=_0x11ced0[_0x19240b(0x72a)][_0x19240b(0x13b7)](_0x3a35b6=>_0x3a35b6[_0x19240b(0x1388)]===_0x1fe76b);if(!_0x121ac6)return;_0x1af44f();let _0x500ea1=_0x121ac6[_0x19240b(0x128c)];if(_0x11ced0['isGroupCall']&&_0x121ac6[_0x19240b(0xfbb)]===_0x19240b(0x13c0)){const _0x58940f=_0x121ac6[_0x19240b(0x128c)]['split'](':\x20');_0x58940f[_0x19240b(0x58a)]>0x1&&(_0x500ea1=_0x58940f[_0x19240b(0x5cc)](0x1)[_0x19240b(0x1143)](':\x20'));}const _0x4b8c1e=await _0x11f6fb(_0x19240b(0x94a),_0x19240b(0x1575),_0x500ea1,'textarea');_0x4b8c1e!==null&&await _0x2cd374(_0x1fe76b,_0x4b8c1e);}async function _0x2cd374(_0x29fd10,_0xfd3831){const _0x47a224=_0x2b1222,_0x191be1=_0x11ced0[_0x47a224(0x72a)][_0x47a224(0x13b7)](_0x5953b4=>_0x5953b4[_0x47a224(0x1388)]===_0x29fd10);if(_0x191be1){let _0x427def=_0xfd3831;if(_0x11ced0[_0x47a224(0xd5e)]&&_0x191be1[_0x47a224(0xfbb)]==='assistant'){const _0x3bee61=_0x191be1[_0x47a224(0x128c)]['split'](':\x20'),_0x4ee812=_0x3bee61[0x0];_0x427def=_0x4ee812+':\x20'+_0xfd3831;}_0x191be1[_0x47a224(0x128c)]=_0x427def;const _0x54ffe4=document[_0x47a224(0xeda)]('.call-message-bubble[data-timestamp=\x22'+_0x29fd10+'\x22]');if(_0x54ffe4){if(_0x11ced0[_0x47a224(0xd5e)]&&_0x191be1[_0x47a224(0xfbb)]===_0x47a224(0x13c0)){const _0x4a6f6f=_0x191be1['content'][_0x47a224(0x23f)](':\x20'),_0x4869c7=_0x4a6f6f[0x0];_0x54ffe4[_0x47a224(0xf21)]=_0x47a224(0x894)+_0x4869c7+_0x47a224(0x547)+_0xfd3831;}else _0x54ffe4['textContent']=_0xfd3831;}}await _0x1460c5('成功',_0x47a224(0x378));}async function _0x4a548e(){const _0x15caa7=_0x2b1222;if(!_0x2bcd4e)return;const _0x29fbf3=await _0x109970('删除消息',_0x15caa7(0xaba),{'confirmButtonClass':_0x15caa7(0x1c6)});if(_0x29fbf3){const _0x5b141d=_0x2bcd4e;_0x1af44f();const _0x60e84f=_0x11ced0[_0x15caa7(0x72a)][_0x15caa7(0xf2d)](_0x59b844=>_0x59b844[_0x15caa7(0x1388)]===_0x5b141d);_0x60e84f>-0x1&&_0x11ced0[_0x15caa7(0x72a)][_0x15caa7(0x30b)](_0x60e84f,0x1);const _0x18e3e1=document['querySelector'](_0x15caa7(0xcbb)+_0x5b141d+'\x22]');_0x18e3e1&&_0x18e3e1[_0x15caa7(0xa9c)]();}else _0x1af44f();}function _0x1632cb(_0x5c6673){const _0x7b8331=_0x2b1222;_0x53a45d=_0x5c6673;const _0x39ffd9=_0x1ae02e[_0x7b8331(0x589)][_0x1ae02e[_0x7b8331(0x588)]],_0x418145=_0x39ffd9['history'][_0x7b8331(0x13b7)](_0x2d74e0=>_0x2d74e0['timestamp']===_0x5c6673);_0x418145&&(document[_0x7b8331(0x1f4)](_0x7b8331(0x287))['textContent']=_0x418145[_0x7b8331(0xfb7)]),document[_0x7b8331(0x1f4)](_0x7b8331(0x794))[_0x7b8331(0x159b)][_0x7b8331(0x6a4)](_0x7b8331(0xfca));}function _0x46ad40(){const _0x58ba2f=_0x2b1222;document[_0x58ba2f(0x1f4)]('transfer-actions-modal')[_0x58ba2f(0x159b)][_0x58ba2f(0xa9c)]('visible'),_0x53a45d=null;}async function _0x2ee6fa(_0x1161a6){const _0x31be6b=_0x2b1222;if(!_0x53a45d)return;const _0x33f89b=_0x53a45d,_0x57e0f5=_0x1ae02e['chats'][_0x1ae02e[_0x31be6b(0x588)]],_0x342f24=_0x57e0f5[_0x31be6b(0xce3)][_0x31be6b(0xf2d)](_0x333ef7=>_0x333ef7[_0x31be6b(0x1388)]===_0x33f89b);if(_0x342f24===-0x1)return;const _0x552c92=_0x57e0f5[_0x31be6b(0xce3)][_0x342f24];_0x552c92[_0x31be6b(0x1589)]=_0x1161a6;let _0x281d09;if(_0x1161a6===_0x31be6b(0x1281)){const _0x472490={'role':_0x31be6b(0x860),'type':_0x31be6b(0x904),'isRefund':!![],'amount':_0x552c92[_0x31be6b(0x618)],'note':_0x31be6b(0x13d8),'timestamp':Date['now']()};_0x57e0f5['history'][_0x31be6b(0x1426)](_0x472490),_0x281d09='[系统提示：你拒绝并退还了“'+_0x552c92[_0x31be6b(0xfb7)]+_0x31be6b(0xe77);}else _0x281d09='[系统提示：你接受了“'+_0x552c92['senderName']+_0x31be6b(0xe77);const _0x5f233c={'role':_0x31be6b(0x1594),'content':_0x281d09,'timestamp':Date['now']()+0x1,'isHidden':!![]};_0x57e0f5[_0x31be6b(0xce3)][_0x31be6b(0x1426)](_0x5f233c),await _0x3df81a[_0x31be6b(0x589)][_0x31be6b(0x295)](_0x57e0f5),_0x46ad40(),_0x3689f0(_0x1ae02e[_0x31be6b(0x588)]),_0x1033ae();}function _0x4a7c98(_0x15115a){const _0x73bcce=_0x2b1222;_0x743628=null;if(_0x15115a){const _0x21c468=_0x15115a['querySelector'](_0x73bcce(0x9e4));_0x21c468&&(_0x21c468[_0x73bcce(0xced)]=_0x73bcce(0x497));}}async function _0x59bf0f(){const _0x5a1ffa=_0x2b1222,_0x414579=document[_0x5a1ffa(0x1f4)](_0x5a1ffa(0x11ba));_0x414579[_0x5a1ffa(0xf21)]='';const _0x1acf62=await _0x3df81a[_0x5a1ffa(0x9e3)][_0x5a1ffa(0x931)](_0x5a1ffa(0x1388))['reverse']()[_0x5a1ffa(0x27a)]();if(_0x1acf62['length']===0x0){_0x414579[_0x5a1ffa(0xf21)]='<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>这里还没有共同的回忆和约定呢~</p>';return;}_0x1acf62['sort']((_0x2f6052,_0x5b39ff)=>{const _0x443e30=_0x5a1ffa,_0x1997be=_0x2f6052[_0x443e30(0xcbd)]===_0x443e30(0x119e)&&_0x2f6052[_0x443e30(0x1538)]>Date[_0x443e30(0xd6e)](),_0x2a3b9b=_0x5b39ff[_0x443e30(0xcbd)]===_0x443e30(0x119e)&&_0x5b39ff[_0x443e30(0x1538)]>Date[_0x443e30(0xd6e)]();if(_0x1997be&&!_0x2a3b9b)return-0x1;if(!_0x1997be&&_0x2a3b9b)return 0x1;if(_0x1997be&&_0x2a3b9b)return _0x2f6052['targetDate']-_0x5b39ff[_0x443e30(0x1538)];return 0x0;}),_0x1acf62[_0x5a1ffa(0x59b)](_0x391268=>{const _0x734e66=_0x5a1ffa;let _0x1c0053;_0x391268[_0x734e66(0xcbd)]===_0x734e66(0x119e)&&_0x391268['targetDate']>Date[_0x734e66(0xd6e)]()?_0x1c0053=_0x6421f9(_0x391268):_0x1c0053=_0x5b73c8(_0x391268),_0x414579[_0x734e66(0x6ce)](_0x1c0053);}),_0xba180b();}function _0x5b73c8(_0x7f02cc){const _0x568d21=_0x2b1222,_0x149518=document[_0x568d21(0x219)](_0x568d21(0xaf9));_0x149518[_0x568d21(0x7c6)]='memory-card';const _0xaf5db1=new Date(_0x7f02cc['timestamp']),_0x27c379=_0xaf5db1['getFullYear']()+'-'+String(_0xaf5db1['getMonth']()+0x1)[_0x568d21(0x1189)](0x2,'0')+'-'+String(_0xaf5db1[_0x568d21(0x772)]())['padStart'](0x2,'0')+'\x20'+String(_0xaf5db1[_0x568d21(0x4ee)]())['padStart'](0x2,'0')+':'+String(_0xaf5db1[_0x568d21(0x1465)]())[_0x568d21(0x1189)](0x2,'0');let _0x1c434f,_0x201547;if(_0x7f02cc[_0x568d21(0xcbd)]===_0x568d21(0x119e)&&_0x7f02cc[_0x568d21(0x1538)])_0x1c434f=_0x568d21(0x319)+_0x7f02cc[_0x568d21(0xdec)],_0x201547=_0x1ec77d('在\x20'+new Date(_0x7f02cc[_0x568d21(0x1538)])[_0x568d21(0x613)]()+_0x568d21(0x83b))[_0x568d21(0xef0)](/\n/g,_0x568d21(0xc9b));else{let _0x5d109e=_0x568d21(0x97d);if(_0x7f02cc[_0x568d21(0x12cf)]){const _0x495f0a=_0x1ae02e[_0x568d21(0x589)][_0x7f02cc[_0x568d21(0x12cf)]];_0x495f0a?_0x5d109e=_0x495f0a['name']:_0x5d109e=_0x7f02cc['authorName']||'一位朋友';}else _0x7f02cc['authorName']&&(_0x5d109e=_0x7f02cc[_0x568d21(0xc8c)]);_0x1c434f=_0x5d109e+_0x568d21(0x1482),_0x201547=_0x1ec77d(_0x7f02cc[_0x568d21(0xdec)]);}return _0x149518[_0x568d21(0xf21)]=_0x568d21(0x975)+_0x27c379+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22author\x22>'+_0x1c434f+_0x568d21(0xaa0)+_0x201547+_0x568d21(0x722),_0x1160f3(_0x149518,async()=>{const _0x57ff78=_0x568d21,_0x561f37=await _0x109970(_0x57ff78(0x112c),_0x57ff78(0x1077),{'confirmButtonClass':_0x57ff78(0x1c6)});_0x561f37&&(await _0x3df81a[_0x57ff78(0x9e3)][_0x57ff78(0xc40)](_0x7f02cc['id']),_0x59bf0f());}),_0x149518;}function _0x6421f9(_0x177724){const _0x2e4a40=_0x2b1222,_0x4af0bf=document[_0x2e4a40(0x219)](_0x2e4a40(0xaf9));_0x4af0bf[_0x2e4a40(0x7c6)]=_0x2e4a40(0x1a0);const _0x438286=new Date(_0x177724[_0x2e4a40(0x1538)]),_0x3ab0d5=_0x438286[_0x2e4a40(0x613)](_0x2e4a40(0xd02),{'dateStyle':_0x2e4a40(0x82e),'timeStyle':'short'});return _0x4af0bf['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22title\x22>'+_0x177724[_0x2e4a40(0xdec)]+_0x2e4a40(0x3b6)+_0x177724['targetDate']+_0x2e4a40(0x101d)+_0x3ab0d5+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x1160f3(_0x4af0bf,async()=>{const _0x54fb77=_0x2e4a40,_0x5f2fb6=await _0x109970(_0x54fb77(0xe29),_0x54fb77(0xb89),{'confirmButtonClass':_0x54fb77(0x1c6)});_0x5f2fb6&&(await _0x3df81a[_0x54fb77(0x9e3)][_0x54fb77(0xc40)](_0x177724['id']),_0x59bf0f());}),_0x4af0bf;}let _0x31cfb5=[];function _0xba180b(){const _0x86c10=_0x2b1222;_0x31cfb5[_0x86c10(0x59b)](_0x18d8fb=>clearInterval(_0x18d8fb)),_0x31cfb5=[],document[_0x86c10(0x14bf)](_0x86c10(0x987))[_0x86c10(0x59b)](_0x1c8089=>{const _0x5548c5=_0x86c10,_0x5254ae=parseInt(_0x1c8089[_0x5548c5(0x746)][_0x5548c5(0x1538)]);let _0x3d0c4;const _0x3e613e=()=>{const _0x4cb918=_0x5548c5,_0x2fbabb=Date[_0x4cb918(0xd6e)](),_0x2ecc7d=_0x5254ae-_0x2fbabb;if(_0x2ecc7d<0x0){_0x1c8089[_0x4cb918(0x231)]=_0x4cb918(0x85c),clearInterval(_0x3d0c4),setTimeout(()=>_0x59bf0f(),0x7d0);return;}const _0x5dfd48=Math[_0x4cb918(0x123c)](_0x2ecc7d/(0x3e8*0x3c*0x3c*0x18)),_0x2d8560=Math['floor'](_0x2ecc7d%(0x3e8*0x3c*0x3c*0x18)/(0x3e8*0x3c*0x3c)),_0x5019f2=Math[_0x4cb918(0x123c)](_0x2ecc7d%(0x3e8*0x3c*0x3c)/(0x3e8*0x3c)),_0xbed822=Math[_0x4cb918(0x123c)](_0x2ecc7d%(0x3e8*0x3c)/0x3e8);_0x1c8089[_0x4cb918(0x231)]=_0x5dfd48+'天\x20'+_0x2d8560+'时\x20'+_0x5019f2+'分\x20'+_0xbed822+'秒';};_0x3e613e(),_0x3d0c4=setInterval(_0x3e613e,0x3e8),_0x31cfb5[_0x5548c5(0x1426)](_0x3d0c4);});}async function _0x31f1ac(_0x16aab5){const _0x5291d4=_0x2b1222,_0x26321d=_0x1ae02e['chats'][_0x16aab5];if(!_0x26321d)return;await _0x1460c5(_0x5291d4(0x771),_0x5291d4(0x14f8)+_0x26321d[_0x5291d4(0x5d2)]+_0x5291d4(0x1530));const {proxyUrl:_0x521cf9,apiKey:_0x364219,model:_0x10e0b8}=_0x1ae02e[_0x5291d4(0x226)];if(!_0x521cf9||!_0x364219||!_0x10e0b8){await _0x1460c5(_0x5291d4(0x688),'API设置不完整，无法继续。');return;}const _0x5847f4=_0x26321d['history'][_0x5291d4(0x5cc)](-0x5)[_0x5291d4(0x1431)](_0xae9e56=>{const _0x528805=_0x5291d4,_0x732f62=_0xae9e56[_0x528805(0xfbb)]===_0x528805(0x860)?_0x26321d['settings']['myNickname']||'我':_0xae9e56[_0x528805(0xfb7)]||_0x26321d[_0x528805(0x5d2)];return _0x732f62+':\x20'+String(_0xae9e56[_0x528805(0x128c)])[_0x528805(0x516)](0x0,0x32)+_0x528805(0x629);})[_0x5291d4(0x1143)]('\x0a');let _0x52f6dc='';if(_0x26321d[_0x5291d4(0x6a8)]['linkedWorldBookIds']&&_0x26321d[_0x5291d4(0x6a8)][_0x5291d4(0x1469)][_0x5291d4(0x58a)]>0x0){const _0x44a165=_0x26321d[_0x5291d4(0x6a8)]['linkedWorldBookIds']['map'](_0x27cc34=>{const _0x1798fb=_0x5291d4,_0x3ffbb6=_0x1ae02e[_0x1798fb(0x1453)][_0x1798fb(0x13b7)](_0xdbf613=>_0xdbf613['id']===_0x27cc34);if(!_0x3ffbb6||!Array[_0x1798fb(0x121f)](_0x3ffbb6[_0x1798fb(0x128c)]))return'';const _0x3e1278=_0x3ffbb6['content'][_0x1798fb(0x1431)](_0x10fefa=>{const _0xf0031f=_0x1798fb;let _0x278dd2=_0xf0031f(0x272)+(_0x10fefa[_0xf0031f(0x306)]||_0xf0031f(0x286))+'\x0a';return _0x10fefa['keys']['length']>0x0&&(_0x278dd2+=_0xf0031f(0x935)+_0x10fefa[_0xf0031f(0x1378)]['join'](',\x20')+'\x0a'),_0x278dd2+=_0xf0031f(0x3d9)+_0x10fefa[_0xf0031f(0x128c)],_0x278dd2;})[_0x1798fb(0x1143)]('\x0a');return _0x3e1278?'\x0a\x0a##\x20世界书:\x20'+_0x3ffbb6[_0x1798fb(0x5d2)]+'\x0a'+_0x3e1278:'';})[_0x5291d4(0xede)](Boolean)[_0x5291d4(0x1143)]('');_0x44a165&&(_0x52f6dc='\x0a\x0a#\x20核心世界观设定\x20(必须严格遵守以下所有设定)\x0a'+_0x44a165+'\x0a');}const _0xbf4a9c=_0x5291d4(0x13ce)+_0x26321d[_0x5291d4(0x5d2)]+_0x5291d4(0x1240)+_0x26321d['settings'][_0x5291d4(0xf42)]+_0x5291d4(0x20e)+_0x52f6dc+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20#\x20被拉黑前的对话摘要\x20(这是你被拉黑的关键原因)\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+_0x5847f4+_0x5291d4(0x10f2);try{const _0x93ab58=[{'role':_0x5291d4(0x1594),'content':_0xbf4a9c},{'role':_0x5291d4(0x860),'content':_0x5291d4(0x69a)}];let _0x4244f5=_0x521cf9===GEMINI_API_URL,_0x5a887a=_0x16b978(_0x10e0b8,_0x364219,_0xbf4a9c,_0x93ab58);const _0x51cad5=_0x4244f5?await fetch(_0x5a887a['url'],_0x5a887a[_0x5291d4(0xc6b)]):await fetch(_0x521cf9+_0x5291d4(0x14c2),{'method':_0x5291d4(0x12d9),'headers':{'Content-Type':'application/json','Authorization':_0x5291d4(0xf03)+_0x364219},'body':JSON[_0x5291d4(0x994)]({'model':_0x10e0b8,'messages':_0x93ab58,'temperature':_0x1ae02e[_0x5291d4(0x12c0)]['apiTemperature']||0.9})});if(!_0x51cad5['ok']){const _0x36cf36=await _0x51cad5[_0x5291d4(0xb84)]();throw new Error(_0x5291d4(0x47b)+_0x51cad5[_0x5291d4(0x1589)]+_0x5291d4(0x7c5)+_0x36cf36[_0x5291d4(0x127d)][_0x5291d4(0x11f0)]);}const _0x4d7da5=await _0x51cad5['json']();let _0x591625=_0x4244f5?_0x4d7da5[_0x5291d4(0x152f)][0x0][_0x5291d4(0x128c)][_0x5291d4(0x14fb)][0x0]['text']:_0x4d7da5[_0x5291d4(0x10be)][0x0]['message'][_0x5291d4(0x128c)];_0x591625=_0x591625[_0x5291d4(0xef0)](/^```json\s*/,'')[_0x5291d4(0xef0)](/```$/,'');const _0x206afc=_0x591625[_0x5291d4(0x4a2)](),_0x2ebb81=JSON['parse'](_0x206afc);_0x2ebb81[_0x5291d4(0xb83)]===_0x5291d4(0x1140)&&_0x2ebb81[_0x5291d4(0x11d6)]?(_0x26321d['relationship'][_0x5291d4(0x1589)]=_0x5291d4(0x149e),_0x26321d['relationship']['applicationReason']=_0x2ebb81[_0x5291d4(0x11d6)],_0x1ae02e[_0x5291d4(0x589)][_0x16aab5]=_0x26321d,_0x1033ae(),await _0x1460c5(_0x5291d4(0x108e),'“'+_0x26321d[_0x5291d4(0x5d2)]+_0x5291d4(0x2a0))):(await _0x1460c5(_0x5291d4(0x13ff),'“'+_0x26321d[_0x5291d4(0x5d2)]+_0x5291d4(0x89d)),_0x26321d['relationship'][_0x5291d4(0x1589)]=_0x5291d4(0x14e6),_0x26321d['relationship'][_0x5291d4(0x139b)]=Date[_0x5291d4(0xd6e)]());}catch(_0x25ce5b){await _0x1460c5(_0x5291d4(0x853),'为“'+_0x26321d[_0x5291d4(0x5d2)]+_0x5291d4(0x3f3)+_0x25ce5b[_0x5291d4(0x11f0)]+'\x0a\x0a将重置冷静期。'),_0x26321d['relationship'][_0x5291d4(0x1589)]=_0x5291d4(0x14e6),_0x26321d['relationship'][_0x5291d4(0x139b)]=Date['now']();}finally{await _0x3df81a['chats'][_0x5291d4(0x295)](_0x26321d),_0x3689f0(_0x16aab5);}}function _0x418789(){const _0x2a9799=_0x2b1222;if(!_0x1ae02e[_0x2a9799(0x588)])return;const _0x10f958=_0x1ae02e[_0x2a9799(0x589)][_0x1ae02e[_0x2a9799(0x588)]];_0x10f958[_0x2a9799(0xe83)]?_0x418795():document[_0x2a9799(0x1f4)](_0x2a9799(0xf14))[_0x2a9799(0x159b)]['add'](_0x2a9799(0xfca));}function _0x418795(){const _0x7c7f46=_0x2b1222,_0x3c43d2=document[_0x7c7f46(0x1f4)]('red-packet-modal'),_0x5e4ce8=_0x1ae02e['chats'][_0x1ae02e['activeChatId']];document[_0x7c7f46(0x1f4)](_0x7c7f46(0x1074))['value']='',document['getElementById'](_0x7c7f46(0x64e))['value']='',document[_0x7c7f46(0x1f4)](_0x7c7f46(0x905))[_0x7c7f46(0x107e)]='',document[_0x7c7f46(0x1f4)]('rp-direct-amount')[_0x7c7f46(0x107e)]='',document['getElementById'](_0x7c7f46(0xe87))[_0x7c7f46(0x107e)]='',document[_0x7c7f46(0x1f4)]('rp-group-total')['textContent']='¥\x200.00',document[_0x7c7f46(0x1f4)](_0x7c7f46(0x13a2))[_0x7c7f46(0x231)]=_0x7c7f46(0x367);const _0x3df5c9=document['getElementById']('rp-direct-receiver');_0x3df5c9[_0x7c7f46(0xf21)]='',_0x5e4ce8['members'][_0x7c7f46(0x59b)](_0x1ac436=>{const _0x367f18=_0x7c7f46,_0x2f42e1=document[_0x367f18(0x219)](_0x367f18(0x10bb));_0x2f42e1[_0x367f18(0x107e)]=_0x1ac436[_0x367f18(0x96f)],_0x2f42e1['textContent']=_0x1ac436[_0x367f18(0xd69)],_0x3df5c9['appendChild'](_0x2f42e1);}),document['getElementById'](_0x7c7f46(0xfb9))['click'](),_0x3c43d2[_0x7c7f46(0x159b)][_0x7c7f46(0x6a4)](_0x7c7f46(0xfca));}async function _0x544651(){const _0x3c73be=_0x2b1222,_0x11afab=_0x1ae02e[_0x3c73be(0x589)][_0x1ae02e['activeChatId']],_0x236cbb=parseFloat(document[_0x3c73be(0x1f4)](_0x3c73be(0x1074))[_0x3c73be(0x107e)]),_0x540d86=parseInt(document[_0x3c73be(0x1f4)](_0x3c73be(0x64e))[_0x3c73be(0x107e)]),_0x38fdd7=document[_0x3c73be(0x1f4)](_0x3c73be(0x905))[_0x3c73be(0x107e)][_0x3c73be(0x4a2)]();if(isNaN(_0x236cbb)||_0x236cbb<=0x0){alert(_0x3c73be(0x115f));return;}if(isNaN(_0x540d86)||_0x540d86<=0x0){alert('请输入有效的红包个数！');return;}if(_0x236cbb/_0x540d86<0.01){alert('单个红包金额不能少于0.01元！');return;}const _0xfacbe=_0x11afab[_0x3c73be(0x6a8)][_0x3c73be(0xe31)]||'我',_0x243f89={'role':_0x3c73be(0x860),'senderName':_0xfacbe,'type':_0x3c73be(0x601),'packetType':_0x3c73be(0xd1f),'timestamp':Date[_0x3c73be(0xd6e)](),'totalAmount':_0x236cbb,'count':_0x540d86,'greeting':_0x38fdd7||_0x3c73be(0x12d6),'claimedBy':{},'isFullyClaimed':![]};_0x11afab[_0x3c73be(0xce3)]['push'](_0x243f89),await _0x3df81a[_0x3c73be(0x589)]['put'](_0x11afab),_0x5286f1(_0x243f89,_0x11afab),_0x1033ae(),document['getElementById']('red-packet-modal')[_0x3c73be(0x159b)]['remove'](_0x3c73be(0xfca));}async function _0x2b3e39(){const _0x176150=_0x2b1222,_0x513f7d=_0x1ae02e[_0x176150(0x589)][_0x1ae02e[_0x176150(0x588)]],_0x2765ea=parseFloat(document[_0x176150(0x1f4)](_0x176150(0x1193))[_0x176150(0x107e)]),_0x45890f=document['getElementById'](_0x176150(0x12c1))[_0x176150(0x107e)],_0x1fc7c0=document[_0x176150(0x1f4)](_0x176150(0xe87))[_0x176150(0x107e)][_0x176150(0x4a2)]();if(isNaN(_0x2765ea)||_0x2765ea<=0x0){alert(_0x176150(0x1142));return;}if(!_0x45890f){alert(_0x176150(0x33c));return;}const _0x36d30b=_0x513f7d['settings'][_0x176150(0xe31)]||'我',_0x1cc2e9={'role':_0x176150(0x860),'senderName':_0x36d30b,'type':_0x176150(0x601),'packetType':_0x176150(0x111e),'timestamp':Date['now'](),'totalAmount':_0x2765ea,'count':0x1,'greeting':_0x1fc7c0||_0x176150(0x39c),'receiverName':_0x45890f,'claimedBy':{},'isFullyClaimed':![]};_0x513f7d[_0x176150(0xce3)][_0x176150(0x1426)](_0x1cc2e9),await _0x3df81a[_0x176150(0x589)][_0x176150(0x295)](_0x513f7d),_0x5286f1(_0x1cc2e9,_0x513f7d),_0x1033ae(),document[_0x176150(0x1f4)]('red-packet-modal')[_0x176150(0x159b)][_0x176150(0xa9c)]('visible');}async function _0x528a5e(_0x503635){const _0x188f1e=_0x2b1222,_0x5cebf4=_0x1ae02e[_0x188f1e(0x588)],_0x9dc737=await _0x3df81a['chats'][_0x188f1e(0x13f8)](_0x5cebf4);if(!_0x9dc737)return;_0x1ae02e[_0x188f1e(0x589)][_0x5cebf4]=_0x9dc737;const _0xfbfbba=_0x9dc737[_0x188f1e(0xce3)][_0x188f1e(0x13b7)](_0x21608f=>_0x21608f[_0x188f1e(0x1388)]===_0x503635);if(!_0xfbfbba)return;const _0x3d16de=_0x1ae02e[_0x188f1e(0x11ef)]['nickname']||_0x188f1e(0xee7),_0x48c719=_0xfbfbba[_0x188f1e(0x13d5)]&&_0xfbfbba[_0x188f1e(0x13d5)][_0x3d16de];if(_0xfbfbba[_0x188f1e(0xcdd)]===_0x188f1e(0x111e)&&_0xfbfbba['receiverName']!==_0x3d16de&&Object['keys'](_0xfbfbba[_0x188f1e(0x13d5)])[_0x188f1e(0x58a)]>0x0||_0xfbfbba['isFullyClaimed']||_0x48c719){_0x566a89(_0xfbfbba);return;}const _0x18bfc5=await _0x5c42f4(_0xfbfbba);_0x18bfc5!==null&&(await _0x3689f0(_0x5cebf4),await _0x1460c5(_0x188f1e(0x28d),_0x188f1e(0xfa5)+_0x140540(_0x9dc737,_0xfbfbba[_0x188f1e(0xfb7)])+_0x188f1e(0x828)+_0x18bfc5[_0x188f1e(0x24f)](0x2)+_0x188f1e(0xd74)));const _0x1bcf2b=_0x1ae02e[_0x188f1e(0x589)][_0x5cebf4][_0x188f1e(0xce3)][_0x188f1e(0x13b7)](_0x9eb8f9=>_0x9eb8f9[_0x188f1e(0x1388)]===_0x503635);_0x1bcf2b&&_0x566a89(_0x1bcf2b);}async function _0x5c42f4(_0x4aa379){const _0x2580c3=_0x2b1222,_0x968641=_0x1ae02e[_0x2580c3(0x589)][_0x1ae02e[_0x2580c3(0x588)]];let _0x18d3bb=Date[_0x2580c3(0xd6e)]();const _0x330bff=_0x1ae02e['qzoneSettings']['nickname']||'{{user}}',_0x4c7c57=_0x4aa379[_0x2580c3(0x13bd)]-Object[_0x2580c3(0x1378)](_0x4aa379[_0x2580c3(0x13d5)]||{})['length'];if(_0x4c7c57<=0x0)return _0x4aa379[_0x2580c3(0x6dd)]=!![],await _0x3df81a[_0x2580c3(0x589)]['put'](_0x968641),await _0x1460c5(_0x2580c3(0x683),_0x2580c3(0x13cf)),null;let _0x2a0f74=0x0;const _0x153233=_0x4aa379[_0x2580c3(0x9c3)]-Object[_0x2580c3(0x753)](_0x4aa379[_0x2580c3(0x13d5)]||{})['reduce']((_0x534488,_0x403119)=>_0x534488+_0x403119,0x0);if(_0x4aa379[_0x2580c3(0xcdd)]===_0x2580c3(0xd1f)){if(_0x4c7c57===0x1)_0x2a0f74=_0x153233;else{const _0x1000c8=0.01,_0x3bbfd9=_0x153233-(_0x4c7c57-0x1)*_0x1000c8;_0x2a0f74=Math[_0x2580c3(0x13ae)]()*(_0x3bbfd9-_0x1000c8)+_0x1000c8;}}else _0x2a0f74=_0x4aa379[_0x2580c3(0x9c3)];_0x2a0f74=parseFloat(_0x2a0f74[_0x2580c3(0x24f)](0x2));if(!_0x4aa379[_0x2580c3(0x13d5)])_0x4aa379[_0x2580c3(0x13d5)]={};_0x4aa379[_0x2580c3(0x13d5)][_0x330bff]=_0x2a0f74;const _0x233114=Object[_0x2580c3(0x1378)](_0x4aa379[_0x2580c3(0x13d5)])[_0x2580c3(0x58a)]>=_0x4aa379[_0x2580c3(0x13bd)];_0x233114&&(_0x4aa379[_0x2580c3(0x6dd)]=!![]);const _0x1eec93=_0x140540(_0x968641,_0x330bff),_0xf66ab=_0x140540(_0x968641,_0x4aa379[_0x2580c3(0xfb7)]),_0x5483a4={'role':_0x2580c3(0x1594),'type':_0x2580c3(0x1454),'content':_0x2580c3(0xfa5)+_0xf66ab+_0x2580c3(0x1009),'timestamp':_0x18d3bb++};_0x968641['history'][_0x2580c3(0x1426)](_0x5483a4);let _0x2f847c;if(_0x233114){const _0x425cea={'role':_0x2580c3(0x1594),'type':'pat_message','content':_0xf66ab+_0x2580c3(0x399),'timestamp':_0x18d3bb++};_0x968641['history'][_0x2580c3(0x1426)](_0x425cea);let _0x526d74={'name':'','amount':-0x1};_0x4aa379[_0x2580c3(0xcdd)]==='lucky'&&_0x4aa379[_0x2580c3(0x13bd)]>0x1&&Object[_0x2580c3(0xd20)](_0x4aa379[_0x2580c3(0x13d5)])[_0x2580c3(0x59b)](([_0x3acf26,_0x247ff2])=>{const _0x5e60a3=_0x2580c3;_0x247ff2>_0x526d74[_0x5e60a3(0x618)]&&(_0x526d74={'name':_0x3acf26,'amount':_0x247ff2});});const _0x3d2002=_0x526d74[_0x2580c3(0x5d2)]?_0x140540(_0x968641,_0x526d74[_0x2580c3(0x5d2)]):'无';_0x2f847c='[系统提示：用户\x20('+_0x1eec93+_0x2580c3(0x1cb)+_0x3d2002+_0x2580c3(0x221);}else _0x2f847c=_0x2580c3(0x2fc)+_0x1eec93+_0x2580c3(0x12da)+_0x4aa379[_0x2580c3(0x1388)]+_0x2580c3(0x148f);const _0x6f1718={'role':_0x2580c3(0x1594),'content':_0x2f847c,'timestamp':_0x18d3bb++,'isHidden':!![]};return _0x968641[_0x2580c3(0xce3)][_0x2580c3(0x1426)](_0x6f1718),await _0x3df81a[_0x2580c3(0x589)][_0x2580c3(0x295)](_0x968641),_0x2a0f74;}async function _0x566a89(_0x1c9cb5){const _0x88adb3=_0x2b1222;if(!_0x1c9cb5){console[_0x88adb3(0x127d)](_0x88adb3(0x7fd));return;}const _0x103e7c=_0x1ae02e[_0x88adb3(0x589)][_0x1ae02e[_0x88adb3(0x588)]];if(!_0x103e7c)return;const _0x5f38c0=document[_0x88adb3(0x1f4)]('red-packet-details-modal'),_0x5b9fcc=_0x1ae02e[_0x88adb3(0x11ef)]['nickname']||_0x88adb3(0xee7),_0x271c48=_0x140540(_0x103e7c,_0x1c9cb5[_0x88adb3(0xfb7)]);document[_0x88adb3(0x1f4)](_0x88adb3(0x7b7))[_0x88adb3(0x231)]=_0x271c48,document[_0x88adb3(0x1f4)](_0x88adb3(0x14ca))['textContent']=_0x1c9cb5[_0x88adb3(0xc6a)]||_0x88adb3(0x12d6);const _0xa84c82=document[_0x88adb3(0x1f4)](_0x88adb3(0xd43));_0x1c9cb5['claimedBy']&&_0x1c9cb5['claimedBy'][_0x5b9fcc]?(_0xa84c82[_0x88adb3(0xeda)](_0x88adb3(0x39e))[_0x88adb3(0x231)]=_0x1c9cb5['claimedBy'][_0x5b9fcc][_0x88adb3(0x24f)](0x2),_0xa84c82[_0x88adb3(0x215)][_0x88adb3(0x887)]=_0x88adb3(0x361)):_0xa84c82[_0x88adb3(0x215)][_0x88adb3(0x887)]=_0x88adb3(0x1b5);const _0x253437=Object['keys'](_0x1c9cb5['claimedBy']||{})[_0x88adb3(0x58a)],_0xe8cc53=Object[_0x88adb3(0x753)](_0x1c9cb5['claimedBy']||{})[_0x88adb3(0x7b6)]((_0x366974,_0x3d8654)=>_0x366974+_0x3d8654,0x0);let _0x27425c=_0x253437+'/'+_0x1c9cb5['count']+'个红包，共'+_0xe8cc53[_0x88adb3(0x24f)](0x2)+'/'+_0x1c9cb5[_0x88adb3(0x9c3)]['toFixed'](0x2)+'元。';if(!_0x1c9cb5[_0x88adb3(0x6dd)]&&_0x253437<_0x1c9cb5['count']){const _0xfa24ab=Math[_0x88adb3(0x123c)]((_0x1c9cb5[_0x88adb3(0x1388)]+0x18*0x3c*0x3c*0x3e8-Date[_0x88adb3(0xd6e)]())/(0x3e8*0x3c*0x3c));if(_0xfa24ab>0x0)_0x27425c+='\x20剩余红包将在'+_0xfa24ab+'小时内退还。';}document[_0x88adb3(0x1f4)](_0x88adb3(0x267))['textContent']=_0x27425c;const _0x5b3b36=document[_0x88adb3(0x1f4)]('rp-details-list');_0x5b3b36[_0x88adb3(0xf21)]='';const _0x554c4d=Object[_0x88adb3(0xd20)](_0x1c9cb5[_0x88adb3(0x13d5)]||{});let _0x458fb3={'name':'','amount':-0x1};_0x1c9cb5[_0x88adb3(0xcdd)]===_0x88adb3(0xd1f)&&_0x1c9cb5[_0x88adb3(0x6dd)]&&_0x554c4d['length']>0x1&&_0x554c4d[_0x88adb3(0x59b)](([_0x15c7cb,_0x4a4ad4])=>{const _0x39fc19=_0x88adb3;_0x4a4ad4>_0x458fb3[_0x39fc19(0x618)]&&(_0x458fb3={'name':_0x15c7cb,'amount':_0x4a4ad4});}),_0x554c4d[_0x88adb3(0x74e)]((_0x3cd099,_0x139a33)=>_0x139a33[0x1]-_0x3cd099[0x1]),_0x554c4d[_0x88adb3(0x59b)](([_0x251d32,_0x3adfc5])=>{const _0x22ea19=_0x88adb3,_0x942408=document['createElement'](_0x22ea19(0xaf9));_0x942408['className']=_0x22ea19(0xf43);let _0x42fa1c='';_0x458fb3[_0x22ea19(0x5d2)]&&_0x251d32===_0x458fb3[_0x22ea19(0x5d2)]&&(_0x42fa1c=_0x22ea19(0xf6f));const _0x34287e=_0x140540(_0x103e7c,_0x251d32);_0x942408['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>'+_0x34287e+_0x22ea19(0xd95)+_0x3adfc5['toFixed'](0x2)+_0x22ea19(0x1537)+_0x42fa1c+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x5b3b36[_0x22ea19(0x6ce)](_0x942408);}),_0x5f38c0[_0x88adb3(0x159b)]['add']('visible');}document[_0x2b1222(0x1f4)](_0x2b1222(0x1046))['addEventListener'](_0x2b1222(0x740),()=>{const _0x2fc5f4=_0x2b1222;document[_0x2fc5f4(0x1f4)]('red-packet-details-modal')['classList']['remove'](_0x2fc5f4(0xfca));}),window[_0x2b1222(0x1e4)]=_0x528a5e;function _0x200590(){const _0x206e0a=_0x2b1222,_0x5deaba=document[_0x206e0a(0x1f4)](_0x206e0a(0x14d0));document[_0x206e0a(0x1f4)](_0x206e0a(0x861))[_0x206e0a(0x107e)]='';const _0x478aa0=document[_0x206e0a(0x1f4)](_0x206e0a(0xe4e));_0x478aa0[_0x206e0a(0xf21)]='',_0x16add4(),_0x16add4(),_0x5deaba[_0x206e0a(0x159b)]['add'](_0x206e0a(0xfca));}function _0x16add4(){const _0x5ddc83=_0x2b1222,_0x39e1d4=document[_0x5ddc83(0x1f4)](_0x5ddc83(0xe4e)),_0x4273f7=document['createElement'](_0x5ddc83(0xaf9));_0x4273f7[_0x5ddc83(0x7c6)]=_0x5ddc83(0xd2b),_0x4273f7[_0x5ddc83(0xf21)]=_0x5ddc83(0x8d1),_0x4273f7[_0x5ddc83(0xeda)](_0x5ddc83(0x64b))['addEventListener'](_0x5ddc83(0x740),()=>{const _0x221920=_0x5ddc83;_0x39e1d4[_0x221920(0x1390)][_0x221920(0x58a)]>0x2?_0x4273f7['remove']():alert(_0x221920(0xa57));}),_0x39e1d4[_0x5ddc83(0x6ce)](_0x4273f7);}async function _0x1ea708(){const _0x9983e1=_0x2b1222;if(!_0x1ae02e[_0x9983e1(0x588)])return;const _0x5c11d0=document[_0x9983e1(0x1f4)](_0x9983e1(0x861))[_0x9983e1(0x107e)]['trim']();if(!_0x5c11d0){alert(_0x9983e1(0x380));return;}const _0x17631c=Array[_0x9983e1(0xa81)](document['querySelectorAll'](_0x9983e1(0x17e)))['map'](_0x26a26a=>_0x26a26a[_0x9983e1(0x107e)][_0x9983e1(0x4a2)]())[_0x9983e1(0xede)](_0x187d53=>_0x187d53);if(_0x17631c[_0x9983e1(0x58a)]<0x2){alert(_0x9983e1(0x5d9));return;}const _0x3fdf26=_0x1ae02e[_0x9983e1(0x589)][_0x1ae02e[_0x9983e1(0x588)]],_0x3c6e27=_0x3fdf26['isGroup']?_0x3fdf26[_0x9983e1(0x6a8)][_0x9983e1(0xe31)]||'我':'我',_0x41ccb4={'role':'user','senderName':_0x3c6e27,'type':'poll','timestamp':Date[_0x9983e1(0xd6e)](),'question':_0x5c11d0,'options':_0x17631c,'votes':{},'isClosed':![]};_0x3fdf26[_0x9983e1(0xce3)][_0x9983e1(0x1426)](_0x41ccb4),await _0x3df81a[_0x9983e1(0x589)]['put'](_0x3fdf26),_0x5286f1(_0x41ccb4,_0x3fdf26),_0x1033ae(),document[_0x9983e1(0x1f4)]('create-poll-modal')[_0x9983e1(0x159b)][_0x9983e1(0xa9c)]('visible');}async function _0x2b9da2(_0x256340,_0x51a30d){const _0x1331ec=_0x2b1222,_0x109425=_0x1ae02e[_0x1331ec(0x589)][_0x1ae02e[_0x1331ec(0x588)]],_0x3b81b8=_0x109425[_0x1331ec(0xce3)][_0x1331ec(0x13b7)](_0x485ce6=>_0x485ce6[_0x1331ec(0x1388)]===_0x256340),_0x252c80=_0x109425[_0x1331ec(0xe83)]?_0x109425[_0x1331ec(0x6a8)][_0x1331ec(0xe31)]||'我':'我';if(!_0x3b81b8||_0x3b81b8[_0x1331ec(0x12cc)]){_0x3b81b8&&_0x3b81b8['isClosed']&&_0x55b32a(_0x256340);return;}const _0xcdc9ea=_0x3b81b8['votes'][_0x51a30d]&&_0x3b81b8['votes'][_0x51a30d][_0x1331ec(0xe82)](_0x252c80);if(!_0xcdc9ea){for(const _0x4fc46a in _0x3b81b8[_0x1331ec(0xde9)]){const _0x1d0554=_0x3b81b8[_0x1331ec(0xde9)][_0x4fc46a][_0x1331ec(0x621)](_0x252c80);_0x1d0554>-0x1&&_0x3b81b8[_0x1331ec(0xde9)][_0x4fc46a][_0x1331ec(0x30b)](_0x1d0554,0x1);}!_0x3b81b8[_0x1331ec(0xde9)][_0x51a30d]&&(_0x3b81b8[_0x1331ec(0xde9)][_0x51a30d]=[]),_0x3b81b8[_0x1331ec(0xde9)][_0x51a30d][_0x1331ec(0x1426)](_0x252c80);}let _0x4321da=null;!_0xcdc9ea&&(_0x4321da=_0x1331ec(0x2fc)+_0x252c80+')\x20刚刚投票给了\x20“'+_0x51a30d+_0x1331ec(0xbc7));if(_0x4321da){const _0x529240={'role':'system','content':_0x4321da,'timestamp':Date[_0x1331ec(0xd6e)](),'isHidden':!![]};_0x109425['history'][_0x1331ec(0x1426)](_0x529240);}await _0x3df81a[_0x1331ec(0x589)][_0x1331ec(0x295)](_0x109425),_0x3689f0(_0x1ae02e[_0x1331ec(0x588)]);}async function _0x16b605(_0x4e8acc){const _0x35086d=_0x2b1222,_0x22c1b7=_0x1ae02e[_0x35086d(0x589)][_0x1ae02e[_0x35086d(0x588)]],_0x495a1b=_0x22c1b7['history'][_0x35086d(0x13b7)](_0x4e4924=>_0x4e4924[_0x35086d(0x1388)]===_0x4e8acc);if(!_0x495a1b||_0x495a1b[_0x35086d(0x12cc)])return;const _0xcd7bc2=await _0x109970(_0x35086d(0xd59),'确定要结束这个投票吗？结束后将无法再进行投票。');if(_0xcd7bc2){_0x495a1b[_0x35086d(0x12cc)]=!![];const _0x42976b=_0x495a1b[_0x35086d(0x2c2)][_0x35086d(0x1431)](_0x45c192=>'“'+_0x45c192+'”('+(_0x495a1b[_0x35086d(0xde9)][_0x45c192]?.['length']||0x0)+'票)')[_0x35086d(0x1143)]('，'),_0x2c1a92=_0x35086d(0x299)+_0x42976b+'。]',_0x169243={'role':_0x35086d(0x1594),'content':_0x2c1a92,'timestamp':Date[_0x35086d(0xd6e)](),'isHidden':!![]};_0x22c1b7[_0x35086d(0xce3)][_0x35086d(0x1426)](_0x169243),await _0x3df81a[_0x35086d(0x589)]['put'](_0x22c1b7),_0x3689f0(_0x1ae02e[_0x35086d(0x588)]);}}function _0x55b32a(_0x497a47){const _0x32756d=_0x2b1222,_0x579972=_0x1ae02e['chats'][_0x1ae02e[_0x32756d(0x588)]],_0x297048=_0x579972[_0x32756d(0xce3)]['find'](_0x3c0e7f=>_0x3c0e7f[_0x32756d(0x1388)]===_0x497a47);if(!_0x297048||!_0x297048[_0x32756d(0x12cc)])return;let _0x336e9b=_0x32756d(0x89b)+_0x297048[_0x32756d(0x128d)]+'</strong></p><hr\x20style=\x22opacity:\x200.2;\x20margin:\x2010px\x200;\x22>';Object[_0x32756d(0x1378)](_0x297048[_0x32756d(0xde9)])[_0x32756d(0x58a)]===0x0?_0x336e9b+=_0x32756d(0x25c):_0x297048[_0x32756d(0x2c2)][_0x32756d(0x59b)](_0x1cfdc0=>{const _0x3bef8d=_0x32756d,_0xec42dc=_0x297048[_0x3bef8d(0xde9)][_0x1cfdc0]||[],_0x135c32=_0xec42dc[_0x3bef8d(0x1431)](_0x32453d=>_0x140540(_0x579972,_0x32453d))[_0x3bef8d(0x1143)]('、\x20');_0x336e9b+=_0x3bef8d(0x29b)+_0x1cfdc0+'\x20('+_0xec42dc['length']+_0x3bef8d(0x1212)+(_0xec42dc['length']>0x0?_0x135c32:'无人投票')+_0x3bef8d(0x10ab);}),_0x1460c5(_0x32756d(0xa6a),_0x336e9b);}function _0x3dcc29(){const _0x19bae4=_0x2b1222;if(!_0x1ae02e[_0x19bae4(0x588)])return;const _0x55bdef=_0x1ae02e[_0x19bae4(0x589)][_0x1ae02e[_0x19bae4(0x588)]];document[_0x19bae4(0x1f4)](_0x19bae4(0x44d))['textContent']='“'+_0x55bdef[_0x19bae4(0x5d2)]+_0x19bae4(0xffb),_0x278bb7(),document[_0x19bae4(0x1f4)](_0x19bae4(0x985))[_0x19bae4(0x159b)]['add'](_0x19bae4(0xfca));}function _0x278bb7(){const _0x5285fb=_0x2b1222,_0x3a3f36=document['getElementById'](_0x5285fb(0x509));_0x3a3f36[_0x5285fb(0xf21)]='';const _0x516f7a=_0x1ae02e[_0x5285fb(0x589)][_0x1ae02e[_0x5285fb(0x588)]],_0x2bcfcc=_0x516f7a[_0x5285fb(0x6a8)]['aiAvatarLibrary']||[];if(_0x2bcfcc['length']===0x0){_0x3a3f36['innerHTML']=_0x5285fb(0xe41);return;}_0x2bcfcc[_0x5285fb(0x59b)]((_0x536213,_0x4b293c)=>{const _0x1ad13a=_0x5285fb,_0xe02ae9=document[_0x1ad13a(0x219)]('div');_0xe02ae9[_0x1ad13a(0x7c6)]=_0x1ad13a(0x270),_0xe02ae9[_0x1ad13a(0x156f)]=_0x536213[_0x1ad13a(0x5d2)],_0xe02ae9[_0x1ad13a(0xf21)]=_0x1ad13a(0x14f1)+_0x536213['url']+_0x1ad13a(0x103c)+_0x536213[_0x1ad13a(0x5d2)]+_0x1ad13a(0x12f5);const _0x3737a8=document[_0x1ad13a(0x219)](_0x1ad13a(0xaf9));_0x3737a8['className']='delete-btn',_0x3737a8[_0x1ad13a(0xf21)]='×',_0x3737a8[_0x1ad13a(0x215)]['display']=_0x1ad13a(0x361),_0x3737a8[_0x1ad13a(0x1199)]=async _0x39efdd=>{const _0x4c3558=_0x1ad13a;_0x39efdd['stopPropagation']();const _0x5639fc=await _0x109970('删除头像',_0x4c3558(0xe51)+_0x536213['name']+_0x4c3558(0x13d9),{'confirmButtonClass':_0x4c3558(0x1c6)});_0x5639fc&&(_0x516f7a[_0x4c3558(0x6a8)][_0x4c3558(0xb77)][_0x4c3558(0x30b)](_0x4b293c,0x1),await _0x3df81a[_0x4c3558(0x589)][_0x4c3558(0x295)](_0x516f7a),_0x278bb7());},_0xe02ae9[_0x1ad13a(0x6ce)](_0x3737a8),_0x3a3f36[_0x1ad13a(0x6ce)](_0xe02ae9);});}async function _0x51f4e2(){const _0x2ede00=_0x2b1222,_0x3bd1e7=await _0x11f6fb(_0x2ede00(0xa3f),_0x2ede00(0x5e5));if(!_0x3bd1e7||!_0x3bd1e7[_0x2ede00(0x4a2)]())return;const _0x52f89b=await _0x11f6fb(_0x2ede00(0xa3f),_0x2ede00(0x218),'',_0x2ede00(0x258));if(!_0x52f89b||!_0x52f89b[_0x2ede00(0x4a2)]()[_0x2ede00(0xebf)]('http')){alert(_0x2ede00(0x14f3));return;}const _0x6dfe32=_0x1ae02e['chats'][_0x1ae02e[_0x2ede00(0x588)]];!_0x6dfe32[_0x2ede00(0x6a8)][_0x2ede00(0xb77)]&&(_0x6dfe32['settings'][_0x2ede00(0xb77)]=[]),_0x6dfe32['settings'][_0x2ede00(0xb77)]['push']({'name':_0x3bd1e7[_0x2ede00(0x4a2)](),'url':_0x52f89b[_0x2ede00(0x4a2)]()}),await _0x3df81a[_0x2ede00(0x589)]['put'](_0x6dfe32),_0x278bb7();}function _0x1c418f(){const _0xd6312=_0x2b1222;document[_0xd6312(0x1f4)]('ai-avatar-library-modal')[_0xd6312(0x159b)][_0xd6312(0xa9c)](_0xd6312(0xfca));}function _0x4e5a6a(){const _0x4eedcf=_0x2b1222;if(!_0x1ae02e[_0x4eedcf(0x588)])return;const _0x50da42=_0x1ae02e[_0x4eedcf(0x589)][_0x1ae02e[_0x4eedcf(0x588)]];document[_0x4eedcf(0x1f4)](_0x4eedcf(0x7c0))[_0x4eedcf(0x231)]='“'+(_0x50da42[_0x4eedcf(0x6a8)][_0x4eedcf(0xe31)]||'我')+'”的头像库',_0x604e98(),document[_0x4eedcf(0x1f4)](_0x4eedcf(0x14ed))[_0x4eedcf(0x159b)][_0x4eedcf(0x6a4)]('visible');}function _0x604e98(){const _0x3efadf=_0x2b1222,_0xf5430e=document[_0x3efadf(0x1f4)](_0x3efadf(0x48c));_0xf5430e[_0x3efadf(0xf21)]='';const _0xb51ddd=_0x1ae02e[_0x3efadf(0x589)][_0x1ae02e[_0x3efadf(0x588)]],_0x461ee6=_0xb51ddd[_0x3efadf(0x6a8)][_0x3efadf(0x12ce)]||[];if(_0x461ee6[_0x3efadf(0x58a)]===0x0){_0xf5430e['innerHTML']='<p\x20style=\x22color:\x20var(--text-secondary);\x20grid-column:\x201\x20/\x20-1;\x20text-align:\x20center;\x22>这个头像库还是空的，点击右上角“添加”吧！</p>';return;}_0x461ee6[_0x3efadf(0x59b)]((_0x5bd645,_0x334e15)=>{const _0x36c42b=_0x3efadf,_0x3660f6=document[_0x36c42b(0x219)]('div');_0x3660f6[_0x36c42b(0x7c6)]=_0x36c42b(0x270),_0x3660f6[_0x36c42b(0x156f)]=_0x5bd645['name'],_0x3660f6['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sticker-image-container\x22\x20style=\x22background-image:\x20url('+_0x5bd645['url']+_0x36c42b(0x103c)+_0x5bd645['name']+_0x36c42b(0x12f5);const _0x288230=document['createElement'](_0x36c42b(0xaf9));_0x288230[_0x36c42b(0x7c6)]=_0x36c42b(0xb05),_0x288230[_0x36c42b(0xf21)]='×',_0x288230['style'][_0x36c42b(0x887)]=_0x36c42b(0x361),_0x288230[_0x36c42b(0x1199)]=async _0x59ba9e=>{const _0x385380=_0x36c42b;_0x59ba9e[_0x385380(0x1025)]();const _0x207b30=await _0x109970('删除头像',_0x385380(0x2e4)+_0x5bd645['name']+'”吗？',{'confirmButtonClass':_0x385380(0x1c6)});_0x207b30&&(_0xb51ddd[_0x385380(0x6a8)][_0x385380(0x12ce)][_0x385380(0x30b)](_0x334e15,0x1),await _0x3df81a[_0x385380(0x589)][_0x385380(0x295)](_0xb51ddd),_0x604e98());},_0x3660f6[_0x36c42b(0x6ce)](_0x288230),_0xf5430e[_0x36c42b(0x6ce)](_0x3660f6);});}async function _0x2cf3e3(){const _0x551a0f=_0x2b1222,_0x341c5c=await _0x11f6fb(_0x551a0f(0xa3f),_0x551a0f(0x5e5));if(!_0x341c5c||!_0x341c5c[_0x551a0f(0x4a2)]())return;const _0x3bf857=await _0x11f6fb(_0x551a0f(0xa3f),'请输入头像的图片URL','',_0x551a0f(0x258));if(!_0x3bf857||!_0x3bf857[_0x551a0f(0x4a2)]()[_0x551a0f(0xebf)]('http')){alert(_0x551a0f(0x14f3));return;}const _0x488bed=_0x1ae02e[_0x551a0f(0x589)][_0x1ae02e['activeChatId']];!_0x488bed['settings'][_0x551a0f(0x12ce)]&&(_0x488bed[_0x551a0f(0x6a8)][_0x551a0f(0x12ce)]=[]),_0x488bed[_0x551a0f(0x6a8)][_0x551a0f(0x12ce)][_0x551a0f(0x1426)]({'name':_0x341c5c[_0x551a0f(0x4a2)](),'url':_0x3bf857[_0x551a0f(0x4a2)]()}),await _0x3df81a[_0x551a0f(0x589)][_0x551a0f(0x295)](_0x488bed),_0x604e98();}async function _0x45a9e6(_0x3233a8){const _0x508b59=_0x2b1222,_0x4a8cc2=_0x3233a8['target'][_0x508b59(0x8b1)][0x0];if(!_0x4a8cc2)return;const _0x3993f8=await new Promise(_0x4c950f=>{const _0x5368a8=_0x508b59,_0x2d6c9b=new FileReader();_0x2d6c9b['onload']=()=>_0x4c950f(_0x2d6c9b['result']),_0x2d6c9b[_0x5368a8(0x21e)](_0x4a8cc2);}),_0x4fa784=await _0x11f6fb(_0x508b59(0x3f9),_0x508b59(0xd98));if(!_0x4fa784||!_0x4fa784[_0x508b59(0x4a2)]())return;const _0x27fad6=_0x1ae02e[_0x508b59(0x589)][_0x1ae02e[_0x508b59(0x588)]];!_0x27fad6['settings'][_0x508b59(0x12ce)]&&(_0x27fad6[_0x508b59(0x6a8)][_0x508b59(0x12ce)]=[]),_0x27fad6[_0x508b59(0x6a8)][_0x508b59(0x12ce)]['push']({'name':_0x4fa784[_0x508b59(0x4a2)](),'url':_0x3993f8}),await _0x3df81a[_0x508b59(0x589)]['put'](_0x27fad6),_0x604e98(),_0x3233a8[_0x508b59(0xb57)][_0x508b59(0x107e)]=null;}async function _0x1d39e5(_0x357ce6){const _0x306e0c=_0x2b1222,_0x15f1a7=_0x1ae02e['chats'][_0x1ae02e[_0x306e0c(0x588)]];if(!_0x15f1a7)return;const _0xdf40f9=_0x357ce6['trim']()[_0x306e0c(0x23f)]('\x0a'),_0xf06188=[],_0x44703a=_0x306e0c(0x1175);let _0x170bb3=0x0;for(const _0x51731d of _0xdf40f9){const _0x444ec0=_0x51731d['trim']();if(!_0x444ec0||_0x444ec0['includes']('http')||_0x444ec0[_0x306e0c(0xe82)]('填入'))continue;let _0x8dc8ac=null,_0x2e760b=null;const _0x55c74f=_0x444ec0[_0x306e0c(0xba5)](/^([\u4e00-\u9fa5]+)([a-zA-Z0-9]+\..+)$/);if(_0x55c74f)_0x8dc8ac=_0x55c74f[0x1],_0x2e760b=_0x55c74f[0x2];else{const _0x10cc1c=_0x444ec0[_0x306e0c(0x23f)](/\s+/);_0x10cc1c[_0x306e0c(0x58a)]>=0x2&&(_0x2e760b=_0x10cc1c[_0x306e0c(0x1139)](),_0x8dc8ac=_0x10cc1c[_0x306e0c(0x1143)]('\x20'));}_0x8dc8ac&&_0x2e760b&&_0x2e760b[_0x306e0c(0xe82)]('.')?_0xf06188['push']({'name':_0x8dc8ac,'url':_0x44703a+_0x2e760b}):_0x170bb3++;}if(_0x170bb3>0x0)await _0x1460c5(_0x306e0c(0x78c),'有\x20'+_0x170bb3+_0x306e0c(0x9f5));if(_0xf06188[_0x306e0c(0x58a)]>0x0){if(!_0x15f1a7[_0x306e0c(0x6a8)]['myAvatarLibrary'])_0x15f1a7['settings'][_0x306e0c(0x12ce)]=[];_0x15f1a7[_0x306e0c(0x6a8)][_0x306e0c(0x12ce)][_0x306e0c(0x1426)](..._0xf06188),await _0x3df81a['chats'][_0x306e0c(0x295)](_0x15f1a7),_0x604e98(),await _0x1460c5(_0x306e0c(0x1159),_0x306e0c(0x12e4)+_0xf06188[_0x306e0c(0x58a)]+_0x306e0c(0x8a4));}else _0x170bb3===0x0&&alert(_0x306e0c(0x318));}function _0x3ae5b2(){const _0x44f763=_0x2b1222;document[_0x44f763(0x1f4)](_0x44f763(0x14ed))[_0x44f763(0x159b)][_0x44f763(0xa9c)](_0x44f763(0xfca));}function _0x402168(){const _0x3305da=_0x2b1222;if(!_0x1ae02e[_0x3305da(0x588)])return;const _0xc0e769=_0x1ae02e[_0x3305da(0x589)][_0x1ae02e[_0x3305da(0x588)]];document[_0x3305da(0x1f4)](_0x3305da(0xdfe))[_0x3305da(0x231)]='“'+_0xc0e769[_0x3305da(0x5d2)]+_0x3305da(0xffb),_0x279cee(),document[_0x3305da(0x1f4)](_0x3305da(0x81d))[_0x3305da(0x159b)][_0x3305da(0x6a4)](_0x3305da(0xfca));}function _0x279cee(){const _0x81adcb=_0x2b1222,_0x27100c=document[_0x81adcb(0x1f4)](_0x81adcb(0x1161));_0x27100c[_0x81adcb(0xf21)]='';const _0x492fb1=_0x1ae02e[_0x81adcb(0x589)][_0x1ae02e[_0x81adcb(0x588)]],_0x13a85c=_0x492fb1[_0x81adcb(0x6a8)][_0x81adcb(0x1276)]||[];if(_0x13a85c[_0x81adcb(0x58a)]===0x0){_0x27100c[_0x81adcb(0xf21)]='<p\x20style=\x22color:\x20var(--text-secondary);\x20grid-column:\x201\x20/\x20-1;\x20text-align:\x20center;\x22>这个头像库还是空的，点击右上角“添加”吧！</p>';return;}_0x13a85c[_0x81adcb(0x59b)]((_0x21d28d,_0x5b2130)=>{const _0x1b5510=_0x81adcb,_0x263630=document[_0x1b5510(0x219)](_0x1b5510(0xaf9));_0x263630[_0x1b5510(0x7c6)]=_0x1b5510(0x270),_0x263630[_0x1b5510(0x156f)]=_0x21d28d[_0x1b5510(0x5d2)],_0x263630[_0x1b5510(0xf21)]=_0x1b5510(0x14f1)+_0x21d28d[_0x1b5510(0x258)]+');\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22sticker-name\x22>'+_0x21d28d[_0x1b5510(0x5d2)]+_0x1b5510(0x12f5);const _0x1a5644=document[_0x1b5510(0x219)](_0x1b5510(0xaf9));_0x1a5644[_0x1b5510(0x7c6)]=_0x1b5510(0xb05),_0x1a5644[_0x1b5510(0xf21)]='×',_0x1a5644[_0x1b5510(0x215)][_0x1b5510(0x887)]='block',_0x1a5644[_0x1b5510(0x1199)]=async _0xcef243=>{const _0x584e2f=_0x1b5510;_0xcef243[_0x584e2f(0x1025)]();const _0x143bf4=await _0x109970(_0x584e2f(0x1590),_0x584e2f(0xe51)+_0x21d28d['name']+'”吗？',{'confirmButtonClass':_0x584e2f(0x1c6)});_0x143bf4&&(_0x492fb1[_0x584e2f(0x6a8)][_0x584e2f(0x1276)][_0x584e2f(0x30b)](_0x5b2130,0x1),await _0x3df81a[_0x584e2f(0x589)][_0x584e2f(0x295)](_0x492fb1),_0x279cee());},_0x263630[_0x1b5510(0x6ce)](_0x1a5644),_0x27100c[_0x1b5510(0x6ce)](_0x263630);});}async function _0x4bdf22(){const _0x33b807=_0x2b1222,_0xc7dc73=await _0x11f6fb(_0x33b807(0xa3f),_0x33b807(0x1531));if(!_0xc7dc73||!_0xc7dc73[_0x33b807(0x4a2)]())return;const _0x34ce91=await _0x11f6fb(_0x33b807(0xa3f),_0x33b807(0x218),'',_0x33b807(0x258));if(!_0x34ce91||!_0x34ce91[_0x33b807(0x4a2)]()['startsWith'](_0x33b807(0x11bb))){alert(_0x33b807(0x14f3));return;}const _0x2e6c12=_0x1ae02e[_0x33b807(0x589)][_0x1ae02e[_0x33b807(0x588)]];!_0x2e6c12[_0x33b807(0x6a8)][_0x33b807(0x1276)]&&(_0x2e6c12[_0x33b807(0x6a8)][_0x33b807(0x1276)]=[]),_0x2e6c12[_0x33b807(0x6a8)][_0x33b807(0x1276)][_0x33b807(0x1426)]({'name':_0xc7dc73[_0x33b807(0x4a2)](),'url':_0x34ce91[_0x33b807(0x4a2)]()}),await _0x3df81a[_0x33b807(0x589)][_0x33b807(0x295)](_0x2e6c12),_0x279cee();}function _0x189c79(){const _0x28157b=_0x2b1222;document['getElementById'](_0x28157b(0x81d))['classList'][_0x28157b(0xa9c)]('visible');}async function _0x4b6e2b(_0x5a5f66){const _0x249a36=_0x2b1222,_0x40c8f8=_0x249a36(0x999),_0x3dfc53=await _0x11f6fb(_0x249a36(0x793),_0x40c8f8,'',_0x249a36(0x1097));_0x3dfc53&&_0x3dfc53[_0x249a36(0x4a2)]()&&await _0x13502e(_0x5a5f66,_0x3dfc53);}async function _0x13502e(_0xb7bb96,_0xf4c149){const _0x5af6f9=_0x2b1222,_0x46625e=_0x1ae02e['chats'][_0x1ae02e[_0x5af6f9(0x588)]];if(!_0x46625e)return;const _0x8c1061=_0xf4c149['trim']()[_0x5af6f9(0x23f)]('\x0a'),_0x4a4089=[],_0x46ccb0=_0x5af6f9(0x1175);let _0x2a2189=0x0;for(const _0x3775ac of _0x8c1061){const _0x4e43f4=_0x3775ac[_0x5af6f9(0x4a2)]();if(!_0x4e43f4||_0x4e43f4[_0x5af6f9(0xe82)](_0x5af6f9(0x11bb))||_0x4e43f4[_0x5af6f9(0xe82)]('填入'))continue;let _0x5baa8e=null,_0x2d700b=null;const _0x157c05=_0x4e43f4[_0x5af6f9(0xba5)](/^([\u4e00-\u9fa5]+)([a-zA-Z0-9]+\..+)$/);if(_0x157c05)_0x5baa8e=_0x157c05[0x1],_0x2d700b=_0x157c05[0x2];else{const _0x4e7bf8=_0x4e43f4[_0x5af6f9(0x23f)](/\s+/);_0x4e7bf8[_0x5af6f9(0x58a)]>=0x2&&(_0x2d700b=_0x4e7bf8[_0x5af6f9(0x1139)](),_0x5baa8e=_0x4e7bf8[_0x5af6f9(0x1143)]('\x20'));}_0x5baa8e&&_0x2d700b&&_0x2d700b[_0x5af6f9(0xe82)]('.')?_0x4a4089[_0x5af6f9(0x1426)]({'name':_0x5baa8e,'url':_0x46ccb0+_0x2d700b}):(_0x2a2189++,console['warn'](_0x5af6f9(0x99d),_0x4e43f4));}_0x2a2189>0x0&&await _0x1460c5(_0x5af6f9(0x78c),'有\x20'+_0x2a2189+'\x20行的格式不正确，已被系统跳过。');if(_0x4a4089[_0x5af6f9(0x58a)]>0x0){if(_0xb7bb96==='ai'){if(!_0x46625e[_0x5af6f9(0x6a8)][_0x5af6f9(0xb77)])_0x46625e[_0x5af6f9(0x6a8)]['aiAvatarLibrary']=[];_0x46625e[_0x5af6f9(0x6a8)]['aiAvatarLibrary'][_0x5af6f9(0x1426)](..._0x4a4089),await _0x3df81a[_0x5af6f9(0x589)][_0x5af6f9(0x295)](_0x46625e),_0x278bb7();}else{if(_0xb7bb96===_0x5af6f9(0x678)){if(!_0x46625e['settings'][_0x5af6f9(0x1276)])_0x46625e[_0x5af6f9(0x6a8)][_0x5af6f9(0x1276)]=[];_0x46625e['settings'][_0x5af6f9(0x1276)][_0x5af6f9(0x1426)](..._0x4a4089),await _0x3df81a['chats']['put'](_0x46625e),_0x279cee();}}await _0x1460c5(_0x5af6f9(0x1159),_0x5af6f9(0x12e4)+_0x4a4089[_0x5af6f9(0x58a)]+_0x5af6f9(0x8a4));}else _0x2a2189===0x0&&alert(_0x5af6f9(0x1c8));}async function _0x522d1a(){const _0x473a7d=_0x2b1222,_0x1ed02a=await _0x11f6fb(_0x473a7d(0xa3f),_0x473a7d(0x1531));if(!_0x1ed02a||!_0x1ed02a[_0x473a7d(0x4a2)]())return;const _0x155009=await _0x11f6fb(_0x473a7d(0xa3f),'请输入头像的图片URL','',_0x473a7d(0x258));if(!_0x155009||!_0x155009['trim']()[_0x473a7d(0xebf)]('http')){alert(_0x473a7d(0x14f3));return;}const _0x49dd07=_0x1ae02e[_0x473a7d(0x589)][_0x1ae02e[_0x473a7d(0x588)]];!_0x49dd07[_0x473a7d(0x6a8)][_0x473a7d(0x1276)]&&(_0x49dd07['settings'][_0x473a7d(0x1276)]=[]),_0x49dd07[_0x473a7d(0x6a8)]['groupAvatarLibrary'][_0x473a7d(0x1426)]({'name':_0x1ed02a[_0x473a7d(0x4a2)](),'url':_0x155009[_0x473a7d(0x4a2)]()}),await _0x3df81a[_0x473a7d(0x589)]['put'](_0x49dd07),_0x279cee();}function _0x37ef0b(_0x42e68a){return new Promise(_0x1c28a9=>{const _0x33a9d7=_0x475c,_0x4c7592=document[_0x33a9d7(0x1f4)]('chat-list-actions-modal'),_0x5a6c9a=document[_0x33a9d7(0x1f4)](_0x33a9d7(0xc5e)),_0xbb2d26=document['getElementById'](_0x33a9d7(0x591)),_0x18df14=document['getElementById'](_0x33a9d7(0x14ee));_0x5a6c9a[_0x33a9d7(0x231)]=_0x42e68a[_0x33a9d7(0x6e3)]?_0x33a9d7(0xb28):_0x33a9d7(0x1324);const _0x2cbebd=_0x5a6c9a[_0x33a9d7(0xf44)](!![]);_0x5a6c9a[_0x33a9d7(0xad7)][_0x33a9d7(0xa88)](_0x2cbebd,_0x5a6c9a),_0x2cbebd['onclick']=()=>{const _0x578082=_0x33a9d7;_0x4c7592[_0x578082(0x159b)][_0x578082(0xa9c)]('visible'),_0x1c28a9(_0x578082(0x11e1));};const _0x242847=_0xbb2d26['cloneNode'](!![]);_0xbb2d26[_0x33a9d7(0xad7)][_0x33a9d7(0xa88)](_0x242847,_0xbb2d26),_0x242847[_0x33a9d7(0x1199)]=()=>{const _0x704ea=_0x33a9d7;_0x4c7592['classList'][_0x704ea(0xa9c)](_0x704ea(0xfca)),_0x1c28a9(_0x704ea(0xc40));};const _0x391d77=_0x18df14['cloneNode'](!![]);_0x18df14['parentNode'][_0x33a9d7(0xa88)](_0x391d77,_0x18df14),_0x391d77[_0x33a9d7(0x1199)]=()=>{const _0x74df2f=_0x33a9d7;_0x4c7592[_0x74df2f(0x159b)][_0x74df2f(0xa9c)]('visible'),_0x1c28a9(null);},_0x4c7592['classList'][_0x33a9d7(0x6a4)]('visible');});}function _0x3fbfc(){const _0x4462a7=_0x2b1222,_0x5eb125=document[_0x4462a7(0x1f4)](_0x4462a7(0xf95)),_0x2e2175=_0x1ae02e[_0x4462a7(0x12c0)][_0x4462a7(0x99f)];_0x2e2175?_0x5eb125[_0x4462a7(0x215)][_0x4462a7(0xf98)]=_0x4462a7(0x13cb)+_0x2e2175+')':_0x5eb125[_0x4462a7(0x215)][_0x4462a7(0xf98)]=_0x4462a7(0x130a);}function _0x50b88d(){const _0x4f2690=_0x2b1222;if(!_0x1ae02e[_0x4f2690(0x12c0)][_0x4f2690(0x11df)])return;for(const _0x3ad7fa in _0x1ae02e['globalSettings'][_0x4f2690(0x11df)]){const _0x24c288=document['getElementById'](_0x4f2690(0x1164)+_0x3ad7fa);_0x24c288&&(_0x24c288[_0x4f2690(0x9fe)]=_0x1ae02e[_0x4f2690(0x12c0)][_0x4f2690(0x11df)][_0x3ad7fa]);}}function _0x215cd7(){const _0x50bd06=_0x2b1222,_0x541e2d=document[_0x50bd06(0x1f4)](_0x50bd06(0x70f));if(!_0x541e2d)return;_0x541e2d['innerHTML']='';const _0x57b0ca={'qq':'QQ','album':'相册','browser':_0x50bd06(0x122e),'taobao':'淘宝','memo':'备忘录','diary':'日记','amap':_0x50bd06(0x59e),'usage':'App记录','music':'网易云','ephone':_0x50bd06(0x143d)};for(const _0x4d1c9a in _0x1ae02e['globalSettings'][_0x50bd06(0x11df)]){const _0x508931=_0x1ae02e[_0x50bd06(0x12c0)][_0x50bd06(0x11df)][_0x4d1c9a],_0x25a804=_0x57b0ca[_0x4d1c9a]||_0x50bd06(0x1249),_0x9878a8=document[_0x50bd06(0x219)](_0x50bd06(0xaf9));_0x9878a8[_0x50bd06(0x7c6)]=_0x50bd06(0xb9e),_0x9878a8[_0x50bd06(0x746)][_0x50bd06(0x9a4)]=_0x4d1c9a,_0x9878a8[_0x50bd06(0xf21)]=_0x50bd06(0xdd8)+_0x508931+_0x50bd06(0xec3)+_0x25a804+_0x50bd06(0x1d2),_0x541e2d['appendChild'](_0x9878a8);}}function _0x57e1d4(){const _0xd83453=_0x2b1222;if(!_0x1ae02e['globalSettings'][_0xd83453(0x69e)])return;for(const _0x1d7f63 in _0x1ae02e[_0xd83453(0x12c0)]['appIcons']){const _0x48f76a=document['getElementById']('icon-img-'+_0x1d7f63);_0x48f76a&&(_0x48f76a[_0xd83453(0x9fe)]=_0x1ae02e[_0xd83453(0x12c0)][_0xd83453(0x69e)][_0x1d7f63]);}}function _0xcf6765(){const _0x5e5ce6=_0x2b1222,_0xc0cb9d=document[_0x5e5ce6(0x1f4)](_0x5e5ce6(0x907));if(!_0xc0cb9d)return;_0xc0cb9d[_0x5e5ce6(0xf21)]='';const _0x12126f={'qq':'QQ','world-book':_0x5e5ce6(0x11f9),'wallpaper':_0x5e5ce6(0x5c1),'renderer':'渲染器','api-settings':_0x5e5ce6(0x1392),'font':'字体','char-phone':_0x5e5ce6(0x663),'douban':_0x5e5ce6(0x10b5),'preset':'预设','tutorial':'教程','werewolf':_0x5e5ce6(0xba4),'x':'X'};for(const _0x37ca87 in _0x1ae02e[_0x5e5ce6(0x12c0)]['appIcons']){const _0x2ef235=_0x1ae02e[_0x5e5ce6(0x12c0)][_0x5e5ce6(0x69e)][_0x37ca87],_0x166994=_0x12126f[_0x37ca87]||'Cphone',_0x52f090=document['createElement']('div');_0x52f090[_0x5e5ce6(0x7c6)]=_0x5e5ce6(0xb9e),_0x52f090[_0x5e5ce6(0x746)]['iconId']=_0x37ca87,_0x52f090[_0x5e5ce6(0xf21)]=_0x5e5ce6(0xdd8)+_0x2ef235+'\x22\x20alt=\x22'+_0x166994+_0x5e5ce6(0x1d2),_0xc0cb9d['appendChild'](_0x52f090);}}function _0x1343e4(_0x46a1e4){const _0x2b9bda=_0x2b1222;if(!_0x1ae02e[_0x2b9bda(0x588)])return;const _0x357ced=_0x1ae02e[_0x2b9bda(0x589)][_0x1ae02e[_0x2b9bda(0x588)]];if(!_0x357ced||!_0x357ced['history'])return;const _0x128d63=_0x357ced[_0x2b9bda(0xce3)][_0x2b9bda(0x13b7)](_0x804e90=>_0x804e90[_0x2b9bda(0x1388)]===_0x46a1e4);if(!_0x128d63||_0x128d63['type']!==_0x2b9bda(0xd9b)){console[_0x2b9bda(0x127d)]('无法找到或消息类型不匹配的分享链接:',_0x46a1e4);return;}document['getElementById'](_0x2b9bda(0x1518))['textContent']=_0x128d63[_0x2b9bda(0x115e)]||_0x2b9bda(0x131a);const _0x44176a=document[_0x2b9bda(0x1f4)](_0x2b9bda(0x12a5));_0x44176a[_0x2b9bda(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1\x20class=\x22article-title\x22>'+(_0x128d63['title']||_0x2b9bda(0x5e0))+_0x2b9bda(0x118e)+(_0x128d63['source_name']||'未知')+_0x2b9bda(0xec2)+(_0x128d63[_0x2b9bda(0x128c)]||_0x2b9bda(0x106f))[_0x2b9bda(0xef0)](/\n/g,_0x2b9bda(0xb2d))+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x2e53fa('browser-screen');}function _0x31bd80(){const _0x2e9295=_0x2b1222;_0x2e53fa(_0x2e9295(0x13c3));}function _0x31bd80(){_0x2e53fa('chat-interface-screen');}function _0x55ba1c(){const _0x30a400=_0x2b1222;if(!_0x1ae02e[_0x30a400(0x588)])return;document[_0x30a400(0x1f4)](_0x30a400(0x5d4))['value']='',document[_0x30a400(0x1f4)](_0x30a400(0x53b))[_0x30a400(0x107e)]='',document[_0x30a400(0x1f4)](_0x30a400(0x8ef))[_0x30a400(0x107e)]='',document[_0x30a400(0x1f4)](_0x30a400(0x1dd))[_0x30a400(0x107e)]='',document[_0x30a400(0x1f4)](_0x30a400(0xc74))[_0x30a400(0x159b)][_0x30a400(0x6a4)](_0x30a400(0xfca));}async function _0x166ab6(){const _0x16c0b9=_0x2b1222;if(!_0x1ae02e['activeChatId'])return;const _0x3bad60=document['getElementById']('link-title-input')['value'][_0x16c0b9(0x4a2)]();if(!_0x3bad60){alert(_0x16c0b9(0x1178));return;}const _0x2de335=document[_0x16c0b9(0x1f4)](_0x16c0b9(0x53b))[_0x16c0b9(0x107e)][_0x16c0b9(0x4a2)](),_0x541e98=document[_0x16c0b9(0x1f4)](_0x16c0b9(0x8ef))[_0x16c0b9(0x107e)][_0x16c0b9(0x4a2)](),_0x5e5ae3=document['getElementById']('link-content-input')[_0x16c0b9(0x107e)][_0x16c0b9(0x4a2)](),_0x77a979=_0x1ae02e['chats'][_0x1ae02e[_0x16c0b9(0x588)]],_0x1bdf94={'role':_0x16c0b9(0x860),'type':_0x16c0b9(0xd9b),'timestamp':Date['now'](),'title':_0x3bad60,'description':_0x2de335,'source_name':_0x541e98,'content':_0x5e5ae3,'thumbnail_url':null};_0x77a979[_0x16c0b9(0xce3)][_0x16c0b9(0x1426)](_0x1bdf94),await _0x3df81a[_0x16c0b9(0x589)][_0x16c0b9(0x295)](_0x77a979),_0x5286f1(_0x1bdf94,_0x77a979),_0x1033ae(),document['getElementById'](_0x16c0b9(0xc74))[_0x16c0b9(0x159b)][_0x16c0b9(0xa9c)](_0x16c0b9(0xfca));}function _0x4f9640(_0x4be095,_0x19e6b5){const _0x2be6fd=_0x2b1222;if(!_0x19e6b5||!_0x19e6b5['id'])return[];const _0xd1bf16=_0x19e6b5['groupId'],_0x2f921f=_0x19e6b5['id'];return _0x4be095[_0x2be6fd(0xede)](_0x13fedb=>{const _0xc535f6=_0x2be6fd;if(_0x13fedb[_0xc535f6(0x12cf)]===_0xc535f6(0x860)){if(_0x13fedb[_0xc535f6(0xe9a)]&&_0x13fedb['visibleGroupIds'][_0xc535f6(0x58a)]>0x0)return _0xd1bf16&&_0x13fedb[_0xc535f6(0xe9a)][_0xc535f6(0xe82)](_0xd1bf16);return!![];}if(String(_0x13fedb[_0xc535f6(0x12cf)])[_0xc535f6(0xebf)](_0xc535f6(0x27f))){if(Array[_0xc535f6(0x121f)](_0x13fedb[_0xc535f6(0xd7a)]))return _0x13fedb['visibleTo'][_0xc535f6(0xe82)](_0x2f921f);return![];}const _0x577d9a=_0x1ae02e['chats'][_0x13fedb[_0xc535f6(0x12cf)]];if(!_0x577d9a)return![];const _0x1dc826=_0x577d9a[_0xc535f6(0x67d)],_0x444c3f=_0x1dc826&&_0xd1bf16&&_0x1dc826===_0xd1bf16,_0x2d03ba=!_0x1dc826&&!_0xd1bf16;return _0x444c3f||_0x2d03ba;});}function _0x4de72f(_0x34823e){const _0x1b57ee=_0x2b1222;document['body']['classList'][_0x1b57ee(0x1483)]('frame-mode-active',_0x34823e);if(_0x5419de[_0x1b57ee(0xd51)]){const _0x6e8ff5=document['getElementById'](_0x1b57ee(0x369)),_0x2a62a3=document[_0x1b57ee(0x1f4)](_0x1b57ee(0x296)),_0x4a58ee=_0x1ae02e[_0x1b57ee(0x12c0)][_0x1b57ee(0xbde)]||![];_0x34823e?(_0x6e8ff5[_0x1b57ee(0x159b)][_0x1b57ee(0xa9c)](_0x1b57ee(0xfca)),_0x2a62a3[_0x1b57ee(0x159b)]['add'](_0x1b57ee(0xd6c))):(_0x2a62a3['classList'][_0x1b57ee(0xa9c)](_0x1b57ee(0xd6c)),_0x4a58ee?(_0x2a62a3['classList'][_0x1b57ee(0x6a4)]('dynamic-island-active'),_0x6e8ff5[_0x1b57ee(0x159b)]['remove']('visible')):_0x5419de[_0x1b57ee(0xc78)]&&_0x5419de[_0x1b57ee(0xc78)][_0x1b57ee(0x58a)]>0x0&&_0x6e8ff5[_0x1b57ee(0x159b)][_0x1b57ee(0x6a4)](_0x1b57ee(0xfca)));}}function _0xf32df4(_0x5ad8a5){const _0x2174a0=_0x2b1222;document[_0x2174a0(0x8b9)][_0x2174a0(0x159b)][_0x2174a0(0x1483)](_0x2174a0(0x109e),_0x5ad8a5);}function _0x1798d7(_0x2043f2){const _0x44058d=_0x2b1222;document['body'][_0x44058d(0x159b)][_0x44058d(0x1483)]('minimal-chat-ui-active',_0x2043f2);}function _0x486571(_0x1f4948){const _0x2531de=_0x2b1222,_0x42a1d9=document[_0x2531de(0x1f4)]('phone-screen'),_0x453a14=document[_0x2531de(0x1f4)](_0x2531de(0x103b)),_0x4379a8=_0x1f4948==='dark';_0x42a1d9[_0x2531de(0x159b)][_0x2531de(0x1483)](_0x2531de(0xe08),_0x4379a8),_0x453a14&&(_0x453a14[_0x2531de(0xe56)]=_0x4379a8),localStorage[_0x2531de(0xae8)](_0x2531de(0x119f),_0x1f4948);}function _0x3661c1(){const _0x48bb7a=_0x2b1222,_0x445e95=document['getElementById'](_0x48bb7a(0x103b)),_0x30079e=_0x445e95[_0x48bb7a(0xe56)]?'dark':'light';_0x486571(_0x30079e);}function _0x537bdb(){const _0x5e965b=_0x2b1222;if(!_0x1ae02e[_0x5e965b(0x588)])return;_0x38eeb7(),_0x2e53fa('long-term-memory-screen');}function _0x38eeb7(){const _0x1bc678=_0x2b1222,_0x2a6b49=document[_0x1bc678(0x1f4)](_0x1bc678(0xfe7)),_0x3ddfbb=_0x1ae02e[_0x1bc678(0x589)][_0x1ae02e[_0x1bc678(0x588)]];_0x2a6b49[_0x1bc678(0xf21)]='';let _0x2624e2=[];_0x3ddfbb[_0x1bc678(0xe83)]?_0x3ddfbb['members'][_0x1bc678(0x59b)](_0x491a06=>{const _0x5c69aa=_0x1bc678,_0xe3d25=_0x1ae02e[_0x5c69aa(0x589)][_0x491a06['id']];if(_0xe3d25&&_0xe3d25[_0x5c69aa(0x5fb)]){const _0x519032=_0xe3d25[_0x5c69aa(0x5fb)][_0x5c69aa(0x1431)](_0x214d47=>({..._0x214d47,'authorName':_0x491a06[_0x5c69aa(0xd69)],'authorChatId':_0x491a06['id']}));_0x2624e2[_0x5c69aa(0x1426)](..._0x519032);}}):_0x3ddfbb[_0x1bc678(0x5fb)]&&(_0x2624e2=_0x3ddfbb['longTermMemory'][_0x1bc678(0x1431)](_0x4b77ce=>({..._0x4b77ce,'authorName':_0x3ddfbb[_0x1bc678(0x5d2)],'authorChatId':_0x3ddfbb['id']})));if(_0x2624e2[_0x1bc678(0x58a)]===0x0){_0x2a6b49[_0x1bc678(0xf21)]=_0x1bc678(0xe69);return;}_0x2624e2[_0x1bc678(0x74e)]((_0x1e47b5,_0x1dfdb5)=>_0x1dfdb5[_0x1bc678(0x1388)]-_0x1e47b5['timestamp']),_0x2624e2['forEach']((_0x135899,_0x48b813)=>{const _0x155512=_0x1bc678,_0x13b985=document[_0x155512(0x219)](_0x155512(0xaf9));_0x13b985[_0x155512(0x7c6)]=_0x155512(0x41f),_0x13b985['style'][_0x155512(0x14cb)]=_0x155512(0x372),_0x13b985[_0x155512(0xf21)]=_0x155512(0x968)+_0x135899[_0x155512(0xc8c)]+_0x155512(0xcf4)+_0x135899[_0x155512(0x128c)][_0x155512(0xef0)](/\n/g,_0x155512(0xc9b))+_0x155512(0x6c0)+_0x135899['authorChatId']+_0x155512(0xd9a)+_0x135899[_0x155512(0x1388)]+_0x155512(0x3ee)+_0x135899[_0x155512(0xfc9)]+_0x155512(0xd9a)+_0x135899[_0x155512(0x1388)]+_0x155512(0xb79),_0x2a6b49[_0x155512(0x6ce)](_0x13b985);});}async function _0x4a7290(){const _0x5da22d=_0x2b1222,_0x4d92b4=_0x1ae02e['chats'][_0x1ae02e['activeChatId']];if(!_0x4d92b4)return;let _0x2354c4=_0x4d92b4;if(_0x4d92b4[_0x5da22d(0xe83)]){const _0x3354ae=_0x4d92b4[_0x5da22d(0x1402)][_0x5da22d(0x1431)](_0x53095e=>({'text':'为“'+_0x53095e[_0x5da22d(0xd69)]+'”添加记忆','value':_0x53095e['id']})),_0x4a840b=await _0x12414d(_0x5da22d(0xe1b),_0x3354ae);if(!_0x4a840b)return;_0x2354c4=_0x1ae02e[_0x5da22d(0x589)][_0x4a840b];if(!_0x2354c4){alert(_0x5da22d(0x1507));return;}}const _0xa5e36b=await _0x11f6fb('为“'+_0x2354c4['name']+_0x5da22d(0x15b5),_0x5da22d(0x113c),'',_0x5da22d(0x1097));if(_0xa5e36b&&_0xa5e36b['trim']()){if(!_0x2354c4[_0x5da22d(0x5fb)])_0x2354c4['longTermMemory']=[];_0x2354c4[_0x5da22d(0x5fb)][_0x5da22d(0x1426)]({'content':_0xa5e36b[_0x5da22d(0x4a2)](),'timestamp':Date[_0x5da22d(0xd6e)](),'source':'manual'}),await _0x3df81a[_0x5da22d(0x589)][_0x5da22d(0x295)](_0x2354c4),_0x38eeb7();}}async function _0x3f89fb(_0x19a62b,_0x2df4db){const _0x57cd8c=_0x2b1222,_0x361044=_0x1ae02e[_0x57cd8c(0x589)][_0x19a62b];if(!_0x361044||!_0x361044['longTermMemory'])return;const _0x3b8f70=_0x361044['longTermMemory']['findIndex'](_0xdc90ba=>_0xdc90ba[_0x57cd8c(0x1388)]===_0x2df4db);if(_0x3b8f70===-0x1)return;const _0x1e7cbd=_0x361044[_0x57cd8c(0x5fb)][_0x3b8f70],_0x3ecf0f=await _0x11f6fb(_0x57cd8c(0xab2),_0x57cd8c(0x467),_0x1e7cbd['content'],_0x57cd8c(0x1097));_0x3ecf0f&&_0x3ecf0f['trim']()&&(_0x1e7cbd[_0x57cd8c(0x128c)]=_0x3ecf0f['trim'](),await _0x3df81a[_0x57cd8c(0x589)][_0x57cd8c(0x295)](_0x361044),_0x38eeb7());}async function _0x37aab4(_0x49bd06,_0x84621f){const _0x54b9f1=_0x2b1222,_0x1566d0=await _0x109970(_0x54b9f1(0xed1),_0x54b9f1(0x9b7),{'confirmButtonClass':'btn-danger'});if(_0x1566d0){const _0x5c5afc=_0x1ae02e['chats'][_0x49bd06];if(!_0x5c5afc||!_0x5c5afc[_0x54b9f1(0x5fb)])return;_0x5c5afc[_0x54b9f1(0x5fb)]=_0x5c5afc[_0x54b9f1(0x5fb)][_0x54b9f1(0xede)](_0x1d3178=>_0x1d3178['timestamp']!==_0x84621f),await _0x3df81a[_0x54b9f1(0x589)][_0x54b9f1(0x295)](_0x5c5afc),_0x38eeb7();}}async function _0x66d2ab(){const _0x243033=_0x2b1222,_0x1ea5e6=await _0x109970('确认操作','这将提取最近的对话内容发送给AI进行总结，会消耗API额度。确定要继续吗？');_0x1ea5e6&&await _0x32f641(_0x1ae02e[_0x243033(0x588)],!![]);}async function _0x10f791(_0x32ce09){const _0x17bb71=_0x2b1222,_0x5d67c2=_0x1ae02e[_0x17bb71(0x589)][_0x32ce09];if(!_0x5d67c2||!_0x5d67c2[_0x17bb71(0x6a8)][_0x17bb71(0xd16)])return;const _0x1fe89e=_0x5d67c2[_0x17bb71(0xb23)]||0x0,_0x3f549e=_0x5d67c2[_0x17bb71(0xce3)]['filter'](_0x3477d9=>_0x3477d9[_0x17bb71(0x1388)]>_0x1fe89e&&!_0x3477d9['isHidden']);_0x3f549e['length']>=_0x5d67c2[_0x17bb71(0x6a8)][_0x17bb71(0x58d)]&&(console[_0x17bb71(0x57e)](_0x17bb71(0xc79)+_0x3f549e[_0x17bb71(0x58a)]+'/'+_0x5d67c2[_0x17bb71(0x6a8)][_0x17bb71(0x58d)]+_0x17bb71(0x1136)),await _0x32f641(_0x32ce09));}async function _0x291745(_0x1cd68a,_0x1b8d28){const _0x1c7065=_0x2b1222,_0x23140a=_0x1ae02e['chats'][_0x1cd68a];if(!_0x23140a||!_0x1b8d28)throw new Error(_0x1c7065(0xfba));const _0x5a84a0=_0x1ae02e[_0x1c7065(0x11ef)][_0x1c7065(0xb46)]||'用户';let _0x540d54,_0x49989d=_0x23140a;const _0x34f13f=new Date()[_0x1c7065(0x5c5)](_0x1c7065(0xd02),{'year':_0x1c7065(0x113f),'month':_0x1c7065(0x2ee),'day':_0x1c7065(0x113f)});if(_0x23140a[_0x1c7065(0xe83)]){let _0xd95bea=null;_0x11ced0['callRequester']&&(_0xd95bea=_0x23140a[_0x1c7065(0x1402)][_0x1c7065(0x13b7)](_0x451dd5=>_0x451dd5[_0x1c7065(0x96f)]===_0x11ced0['callRequester']));!_0xd95bea&&(_0xd95bea=_0x23140a[_0x1c7065(0x1402)][_0x1c7065(0x13b7)](_0x55f875=>_0x55f875['id']!==_0x1c7065(0x860)&&_0x11ced0['participants'][_0x1c7065(0x690)](_0xf40c07=>_0xf40c07['id']===_0x55f875['id'])));!_0xd95bea&&(_0xd95bea=_0x23140a['members'][_0x1c7065(0x13b7)](_0x323aa8=>_0x323aa8['id']!==_0x1c7065(0x860)));if(!_0xd95bea)throw new Error('群聊通话中没有找到可作为总结主体的AI角色。');const _0xf4d2fe=_0x1ae02e[_0x1c7065(0x589)][_0xd95bea['id']];if(!_0xf4d2fe)throw new Error(_0x1c7065(0xbef)+_0xd95bea['groupNickname']+'”\x20的详细角色信息。');const _0x479518=_0x23140a[_0x1c7065(0x6a8)][_0x1c7065(0x36b)]||_0x1c7065(0x1570);_0x540d54='\x0a#\x20你的任务\x0a你就是角色“'+_0xd95bea['originalName']+_0x1c7065(0x633)+_0x5a84a0+_0x1c7065(0xb98)+_0x34f13f+_0x1c7065(0x93b)+_0x34f13f+'”这个信息，将其转换为【具体的公历日期】。\x0a4.\x20\x20**【风格要求】**:\x20你的总结应该像一份会议纪要或备忘录，而不是一篇抒情散文。\x0a5.\x20\x20**【长度铁律】**:\x20你的总结【必须】非常简短，总长度【绝对不能超过80个字】。\x0a6.\x20\x20**【输出格式】**:\x20你的回复【必须且只能】是一个JSON对象，格式如下：\x0a\x20\x20\x20\x20`{\x22summary\x22:\x20\x22在这里写下你以第一人称视角，总结好的核心事实与计划。\x22}`\x0a\x0a#\x20你的角色设定\x20(必须严格遵守)\x0a'+_0xf4d2fe['settings'][_0x1c7065(0xf42)]+_0x1c7065(0x1030)+_0x479518+'\x0a\x0a#\x20待总结的群组视频通话记录\x0a'+_0x1b8d28+_0x1c7065(0x10c5)+_0xd95bea['originalName']+_0x1c7065(0xcac),_0x49989d=_0xf4d2fe;}else _0x540d54=_0x1c7065(0xa8d)+_0x23140a[_0x1c7065(0x96f)]+_0x1c7065(0x9db)+_0x5a84a0+_0x1c7065(0x7ad)+_0x34f13f+_0x1c7065(0x892)+_0x34f13f+_0x1c7065(0xe6f)+_0x23140a['settings'][_0x1c7065(0xf42)]+_0x1c7065(0x1030)+_0x23140a[_0x1c7065(0x6a8)][_0x1c7065(0x36b)]+_0x1c7065(0x911)+_0x1b8d28+'\x0a\x0a现在，请以“'+_0x23140a[_0x1c7065(0x96f)]+_0x1c7065(0xcac);try{const _0x240110=_0x1ae02e[_0x1c7065(0x226)][_0x1c7065(0x78a)]&&_0x1ae02e['apiConfig'][_0x1c7065(0x247)]&&_0x1ae02e['apiConfig'][_0x1c7065(0xe21)],{proxyUrl:_0x196f3f,apiKey:_0x1a8c0f,model:_0x154fbd}=_0x240110?{'proxyUrl':_0x1ae02e['apiConfig'][_0x1c7065(0x78a)],'apiKey':_0x1ae02e['apiConfig'][_0x1c7065(0x247)],'model':_0x1ae02e[_0x1c7065(0x226)]['secondaryModel']}:_0x1ae02e['apiConfig'];if(!_0x196f3f||!_0x1a8c0f||!_0x154fbd)throw new Error(_0x1c7065(0xe1c));let _0x3a318e=_0x196f3f['includes']('generativelanguage'),_0x43c7c4=_0x16b978(_0x154fbd,_0x1a8c0f,_0x540d54,[{'role':_0x1c7065(0x860),'content':_0x1c7065(0xdb1)}]);const _0x44f145=_0x3a318e?await fetch(_0x43c7c4[_0x1c7065(0x258)],_0x43c7c4[_0x1c7065(0xc6b)]):await fetch(_0x196f3f+'/v1/chat/completions',{'method':_0x1c7065(0x12d9),'headers':{'Content-Type':_0x1c7065(0xa90),'Authorization':_0x1c7065(0xf03)+_0x1a8c0f},'body':JSON[_0x1c7065(0x994)]({'model':_0x154fbd,'messages':[{'role':_0x1c7065(0x1594),'content':_0x540d54},{'role':_0x1c7065(0x860),'content':_0x1c7065(0xdb1)}],'temperature':0.1})});if(!_0x44f145['ok']){const _0x901f3d=await _0x44f145[_0x1c7065(0xb84)]()[_0x1c7065(0x3d1)](()=>({'error':{'message':_0x44f145[_0x1c7065(0x1260)]}}));throw new Error('API\x20请求失败:\x20'+_0x44f145[_0x1c7065(0x1589)]+'\x20-\x20'+_0x901f3d['error']['message']);}const _0x2d0cea=await _0x44f145[_0x1c7065(0xb84)]();let _0x4d982c=_0x3a318e?getGeminiResponseText(_0x2d0cea):_0x2d0cea[_0x1c7065(0x10be)][0x0][_0x1c7065(0x11f0)]['content'];_0x4d982c=_0x4d982c['replace'](/^```json\s*/,'')['replace'](/```$/,'')[_0x1c7065(0x4a2)]();const _0x4c1c91=JSON['parse'](_0x4d982c);if(_0x4c1c91[_0x1c7065(0xefa)]&&_0x4c1c91['summary'][_0x1c7065(0x4a2)]()){const _0x3cef80={'content':_0x1c7065(0xd3c)+(_0x23140a['isGroup']?'群聊':'')+'通话中，'+_0x4c1c91[_0x1c7065(0xefa)][_0x1c7065(0x4a2)]()+')','timestamp':Date[_0x1c7065(0xd6e)](),'source':_0x23140a['isGroup']?_0x1c7065(0x120a):_0x1c7065(0x10e7)};if(!_0x49989d[_0x1c7065(0x5fb)])_0x49989d['longTermMemory']=[];return _0x49989d[_0x1c7065(0x5fb)][_0x1c7065(0x1426)](_0x3cef80),await _0x3df81a[_0x1c7065(0x589)][_0x1c7065(0x295)](_0x49989d),console[_0x1c7065(0x57e)]('通话记录已成功总结并存入角色“'+_0x49989d['name']+_0x1c7065(0xd12)),!![];}else throw new Error(_0x1c7065(0x7c1));}catch(_0x1ae7ff){console['error']('总结通话记录时出错:',_0x1ae7ff);throw _0x1ae7ff;}}function _0x1d2d55(_0x5e184d){const _0x35ea27=_0x2b1222,_0x8e0067=new Set(['的','是','了','在','我','你','他','她','它','我们','你们','他们','这','那','一个','也','和','与','或','但','然而','所以','因此','就','都','地','得','着','过','吧','吗','呢','啊','哦','嗯','什么','怎么',_0x35ea27(0xb4d),'哪个','一些','这个','那个','还有']),_0x40f965=_0x5e184d[_0x35ea27(0xba5)](/[\u4e00-\u9fa5]+|[a-zA-Z0-9]+/g)||[],_0x231b57=new Map();let _0x444e23=0x0;_0x40f965[_0x35ea27(0x59b)](_0xc3905f=>{const _0x3bda2f=_0x35ea27;if(_0xc3905f[_0x3bda2f(0x58a)]>0x1&&!_0x8e0067[_0x3bda2f(0xe75)](_0xc3905f)){const _0x11a839=(_0x231b57[_0x3bda2f(0x13f8)](_0xc3905f)||0x0)+0x1;_0x231b57[_0x3bda2f(0x3d3)](_0xc3905f,_0x11a839);if(_0x11a839>_0x444e23)_0x444e23=_0x11a839;}});const _0x5bd615=[],_0x3555cd=[],_0x20bc3e=_0x444e23*0.9,_0x4179b0=_0x444e23*0.6;_0x231b57[_0x35ea27(0x59b)]((_0x34d202,_0x433fbe)=>{const _0x2add2c=_0x35ea27;if(_0x34d202>=_0x20bc3e)_0x5bd615[_0x2add2c(0x1426)](_0x433fbe);else _0x34d202>=_0x4179b0&&_0x3555cd[_0x2add2c(0x1426)](_0x433fbe);});const _0x13f2bc=new Set(_0x5bd615),_0xf2c199=_0x3555cd[_0x35ea27(0xede)](_0x541cc0=>!_0x13f2bc[_0x35ea27(0xe75)](_0x541cc0))[_0x35ea27(0x5cc)](0x0,0x5);return{'coreKeywords':_0x5bd615[_0x35ea27(0x5cc)](0x0,0x3),'situationalKeywords':_0xf2c199};}function _0x5a2518(_0xae5d26,_0x1a6491,_0x2a0a13){const _0x1d252c=_0x2b1222;let _0x206204;_0x2a0a13==='hours'?_0x206204=Date[_0x1d252c(0xd6e)]()-_0x1a6491*0x3c*0x3c*0x3e8:_0x206204=Date[_0x1d252c(0xd6e)]()-_0x1a6491*0x18*0x3c*0x3c*0x3e8;const _0x14a4fe=_0xae5d26[_0x1d252c(0xce3)][_0x1d252c(0xede)](_0x531669=>_0x531669['timestamp']>_0x206204&&!_0x531669[_0x1d252c(0x58e)]);if(_0x14a4fe['length']<0x3)return'';const _0x3618fc=_0x14a4fe['map'](_0x3aea29=>{const _0x316964=_0x1d252c;if(typeof _0x3aea29[_0x316964(0x128c)]===_0x316964(0x6c3))return _0x3aea29[_0x316964(0x128c)];if(_0x3aea29['type']==='voice_message')return _0x3aea29[_0x316964(0x128c)];if(_0x3aea29[_0x316964(0xcbd)]===_0x316964(0x439))return(_0x3aea29['dialogue']||'')+'\x20'+(_0x3aea29[_0x316964(0xdec)]||'');return'';})[_0x1d252c(0x1143)]('\x20'),_0x2fd34b=new Set(['的','是','了','在','我','你','他','她','它','我们','你们','他们','这','那','一个','也','和','与','或','但','然而','所以','因此','就','都','地','得','着','过','吧','吗','呢','啊','哦','嗯']),_0x329764=_0x3618fc[_0x1d252c(0xba5)](/[\u4e00-\u9fa5]+|[a-zA-Z0-9]+/g)||[],_0x3465f1=new Map();_0x329764[_0x1d252c(0x59b)](_0x575d80=>{const _0x1606cc=_0x1d252c;_0x575d80[_0x1606cc(0x58a)]>0x1&&!_0x2fd34b[_0x1606cc(0xe75)](_0x575d80)&&_0x3465f1['set'](_0x575d80,(_0x3465f1[_0x1606cc(0x13f8)](_0x575d80)||0x0)+0x1);});const _0xfbf470=[..._0x3465f1[_0x1d252c(0xd20)]()]['sort']((_0x334088,_0x1ed360)=>_0x1ed360[0x1]-_0x334088[0x1])[_0x1d252c(0x1431)](_0x124d9b=>_0x124d9b[0x0]);if(_0xfbf470[_0x1d252c(0x58a)]===0x0)return'';let _0x2cc46d;return _0x2a0a13==='hours'?_0x2cc46d='最近'+_0x1a6491+'小时核心议题':_0x1a6491===0x1?_0x2cc46d=_0x1d252c(0x75f):_0x2cc46d='最近'+_0x1a6491+_0x1d252c(0x749),_0x1d252c(0x665)+_0x2cc46d+_0x1d252c(0x10d0)+_0xfbf470[_0x1d252c(0x5cc)](0x0,0x3)[_0x1d252c(0x1143)]('、\x20')+_0x1d252c(0x15d);}function _0x293818(_0x5d5187){const _0xae93c2=_0x2b1222;if(!_0x5d5187||typeof _0x5d5187!==_0xae93c2(0x6c3))return null;const _0x91450b=_0x5d5187[_0xae93c2(0xef0)](/^```json\s*/,'')[_0xae93c2(0xef0)](/```$/,'')[_0xae93c2(0x4a2)](),_0x33f09a=_0x91450b['match'](/{[\s\S]*}/);if(_0x33f09a)try{const _0x4ecd29=JSON[_0xae93c2(0x129c)](_0x33f09a[0x0]);return console[_0xae93c2(0x57e)](_0xae93c2(0xc93)),_0x4ecd29;}catch(_0x9383ad){console[_0xae93c2(0xb3b)]('容错解析：策略1失败\x20(找到了JSON块，但格式错误)，将尝试策略2...');}const _0x43d264=_0x91450b[_0xae93c2(0xba5)](/"summary"\s*:\s*"((?:[^"\\]|\\.)*)"/);if(_0x43d264&&_0x43d264[0x1])return console[_0xae93c2(0x57e)](_0xae93c2(0xc61)),{'summary':_0x43d264[0x1][_0xae93c2(0xef0)](/\\"/g,'\x22')};if(_0x91450b)return console[_0xae93c2(0x57e)](_0xae93c2(0x86e)),{'summary':_0x91450b};return null;}async function _0x3f0e99(_0x3d6808){const _0x572d05=_0x2b1222;let _0x34ff5e=_0x1ae02e[_0x572d05(0x589)][_0x3d6808];if(!_0x34ff5e)return;let _0x3b4fc4=_0x34ff5e;if(_0x34ff5e['isGroup']){const _0x382c9e=_0x34ff5e[_0x572d05(0x1402)][_0x572d05(0x1431)](_0x578cc6=>{const _0x267531=_0x572d05,_0x3bdd69=_0x1ae02e[_0x267531(0x589)][_0x578cc6['id']];if(_0x3bdd69&&_0x3bdd69[_0x267531(0x5fb)]&&_0x3bdd69[_0x267531(0x5fb)][_0x267531(0x58a)]>=0x2)return{'text':_0x267531(0xf15)+_0x578cc6[_0x267531(0xd69)]+'”的记忆\x20('+_0x3bdd69[_0x267531(0x5fb)][_0x267531(0x58a)]+'条)','value':_0x578cc6['id']};return null;})[_0x572d05(0xede)](Boolean);if(_0x382c9e[_0x572d05(0x58a)]===0x0){alert(_0x572d05(0x846));return;}const _0x4d0b94=await _0x12414d('选择要精炼记忆的角色',_0x382c9e);if(!_0x4d0b94)return;_0x3b4fc4=_0x1ae02e['chats'][_0x4d0b94];}if(!_0x3b4fc4['longTermMemory']||_0x3b4fc4[_0x572d05(0x5fb)][_0x572d05(0x58a)]<0x2){alert('“'+_0x3b4fc4['name']+_0x572d05(0x1039));return;}const _0x45f6a7=_0x3b4fc4['longTermMemory'][_0x572d05(0x58a)],_0x2f7538=await _0x12414d(_0x572d05(0xc8b),[{'text':_0x572d05(0x598)+_0x45f6a7+'条)','value':_0x572d05(0x54b)},{'text':_0x572d05(0x1443),'value':'20'},{'text':_0x572d05(0xe13),'value':'50'},{'text':_0x572d05(0xb21),'value':'100'},{'text':_0x572d05(0x4d9),'value':_0x572d05(0xb42)}][_0x572d05(0xede)](_0xa1fb6a=>_0xa1fb6a[_0x572d05(0x107e)]===_0x572d05(0x54b)||_0xa1fb6a[_0x572d05(0x107e)]===_0x572d05(0xb42)||parseInt(_0xa1fb6a[_0x572d05(0x107e)])<_0x45f6a7));if(_0x2f7538===null)return;let _0x4e68ef,_0x430768=_0x45f6a7;if(_0x2f7538===_0x572d05(0x54b))_0x4e68ef=[..._0x3b4fc4[_0x572d05(0x5fb)]];else{if(_0x2f7538===_0x572d05(0xb42)){const _0x3f276f=await _0x11f6fb(_0x572d05(0x810),_0x572d05(0x767)+_0x45f6a7+_0x572d05(0x10bc));if(_0x3f276f===null)return;const _0x5e4c67=parseInt(_0x3f276f);if(isNaN(_0x5e4c67)||_0x5e4c67<0x2||_0x5e4c67>_0x45f6a7){alert('请输入一个\x202\x20到\x20'+_0x45f6a7+_0x572d05(0xaf2));return;}_0x430768=_0x5e4c67,_0x4e68ef=_0x3b4fc4[_0x572d05(0x5fb)][_0x572d05(0x5cc)](-_0x430768);}else _0x430768=parseInt(_0x2f7538),_0x430768>=_0x45f6a7?(_0x4e68ef=[..._0x3b4fc4[_0x572d05(0x5fb)]],_0x430768=_0x45f6a7):_0x4e68ef=_0x3b4fc4[_0x572d05(0x5fb)][_0x572d05(0x5cc)](-_0x430768);}const _0x5646e0=await _0x11f6fb('设置精炼字数','请输入精炼后核心记忆的大致字数：',_0x572d05(0x1014));if(_0x5646e0===null)return;const _0x2da444=parseInt(_0x5646e0);if(isNaN(_0x2da444)||_0x2da444<0x14){alert(_0x572d05(0x1224));return;}const _0x734a87=await _0x109970('确认精炼记忆？',_0x572d05(0xfd2)+_0x430768+_0x572d05(0x1271)+_0x2da444+_0x572d05(0x337),{'confirmButtonClass':'btn-danger','confirmText':_0x572d05(0x1ea)});if(!_0x734a87)return;const _0x19196d=_0x4e68ef[_0x572d05(0x1431)](_0x1c9147=>'-\x20'+_0x1c9147[_0x572d05(0x128c)])[_0x572d05(0x1143)]('\x0a'),_0x282e53=_0x1ae02e[_0x572d05(0x11ef)][_0x572d05(0xb46)]||'用户',_0xeaa574=new Date()[_0x572d05(0x5c5)](_0x572d05(0xd02),{'year':_0x572d05(0x113f),'month':_0x572d05(0x2ee),'day':_0x572d05(0x113f)}),_0x3c630e='\x0a#\x20你的任务\x0a你就是角色“'+_0x3b4fc4[_0x572d05(0x96f)]+_0x572d05(0x2da)+_0x282e53+_0x572d05(0x83c)+_0xeaa574+_0x572d05(0x394)+_0xeaa574+_0x572d05(0x1332)+_0x2da444+_0x572d05(0xc91)+_0x3b4fc4[_0x572d05(0x6a8)][_0x572d05(0xf42)]+_0x572d05(0x1030)+_0x3b4fc4[_0x572d05(0x6a8)][_0x572d05(0x36b)]+'\x0a\x0a#\x20待整合的记忆要点列表\x0a'+_0x19196d+_0x572d05(0x10c5)+_0x3b4fc4[_0x572d05(0x96f)]+_0x572d05(0x61f);await _0x1460c5(_0x572d05(0x11b7),_0x572d05(0x136a));try{const _0x3c5653=_0x1ae02e[_0x572d05(0x226)][_0x572d05(0x78a)]&&_0x1ae02e[_0x572d05(0x226)][_0x572d05(0x247)]&&_0x1ae02e[_0x572d05(0x226)][_0x572d05(0xe21)],{proxyUrl:_0x3a53c1,apiKey:_0x10754d,model:_0xf1221}=_0x3c5653?{'proxyUrl':_0x1ae02e['apiConfig']['secondaryProxyUrl'],'apiKey':_0x1ae02e[_0x572d05(0x226)][_0x572d05(0x247)],'model':_0x1ae02e[_0x572d05(0x226)]['secondaryModel']}:_0x1ae02e[_0x572d05(0x226)];if(!_0x3a53c1||!_0x10754d||!_0xf1221)throw new Error(_0x572d05(0xf60));let _0x4cf7ea=_0x3a53c1[_0x572d05(0xe82)](_0x572d05(0xc38)),_0x4832b3=_0x16b978(_0xf1221,_0x10754d,_0x3c630e,[{'role':'user','content':'请开始整合。'}]);const _0x1f11fc=_0x4cf7ea?await fetch(_0x4832b3['url'],_0x4832b3[_0x572d05(0xc6b)]):await fetch(_0x3a53c1+'/v1/chat/completions',{'method':_0x572d05(0x12d9),'headers':{'Content-Type':_0x572d05(0xa90),'Authorization':_0x572d05(0xf03)+_0x10754d},'body':JSON[_0x572d05(0x994)]({'model':_0xf1221,'messages':[{'role':_0x572d05(0x1594),'content':_0x3c630e},{'role':_0x572d05(0x860),'content':_0x572d05(0x1c5)}],'temperature':0.2})});if(!_0x1f11fc['ok'])throw new Error(_0x572d05(0xaa6)+_0x1f11fc['statusText']);const _0x3a3621=await _0x1f11fc[_0x572d05(0xb84)]();let _0x683153=_0x4cf7ea?getGeminiResponseText(_0x3a3621):_0x3a3621['choices'][0x0][_0x572d05(0x11f0)][_0x572d05(0x128c)];const _0x12ba69=_0x293818(_0x683153);if(_0x12ba69&&_0x12ba69[_0x572d05(0xefa)]&&typeof _0x12ba69[_0x572d05(0xefa)]===_0x572d05(0x6c3)&&_0x12ba69[_0x572d05(0xefa)][_0x572d05(0x4a2)]()){const _0x567281=await _0x109970(_0x572d05(0x50f),_0x572d05(0x88e)+_0x430768+'\x20条旧记忆总结为以下核心记忆：<br><br><div\x20class=\x22scrollable-content-preview\x22>'+_0x12ba69[_0x572d05(0xefa)][_0x572d05(0x4a2)]()+_0x572d05(0x996),{'confirmText':_0x572d05(0xe80),'cancelText':_0x572d05(0x2a4),'confirmButtonClass':_0x572d05(0x1c6)});if(_0x567281){const _0x4544af={'content':_0x12ba69[_0x572d05(0xefa)][_0x572d05(0x4a2)](),'timestamp':Date[_0x572d05(0xd6e)](),'source':_0x572d05(0xd46)},_0x2c7b3e=_0x45f6a7-_0x430768,_0x4600e5=_0x2c7b3e>0x0?_0x3b4fc4[_0x572d05(0x5fb)][_0x572d05(0x5cc)](0x0,_0x2c7b3e):[];_0x3b4fc4['longTermMemory']=[..._0x4600e5,_0x4544af],_0x3b4fc4[_0x572d05(0xb23)]=Date['now'](),await _0x3df81a[_0x572d05(0x589)][_0x572d05(0x295)](_0x3b4fc4),document[_0x572d05(0x1f4)](_0x572d05(0x14b4))[_0x572d05(0x159b)][_0x572d05(0xaea)]('active')&&_0x38eeb7(),await _0x1460c5(_0x572d05(0xfbc),_0x572d05(0x10ec)+_0x430768+'\x20条记忆精炼为\x201\x20条核心记忆！');}else await _0x1460c5(_0x572d05(0x1086),_0x572d05(0x11ad));}else throw new Error(_0x572d05(0x7c1));}catch(_0x3c473f){console[_0x572d05(0x127d)](_0x572d05(0xc41),_0x3c473f),await _0x1460c5('精炼失败','操作失败，请检查API配置或稍后重试。\x0a错误信息:\x20'+_0x3c473f['message']);}}async function _0x32f641(_0x29a360,_0x48a714=![]){const _0x5bd6d7=_0x2b1222,_0x5da949=_0x1ae02e[_0x5bd6d7(0x589)][_0x29a360];if(!_0x5da949)return;const _0x5046e8=_0x5da949[_0x5bd6d7(0xb23)]||0x0,_0x1d477e=_0x48a714?_0x5da949['history'][_0x5bd6d7(0xede)](_0x20f767=>!_0x20f767[_0x5bd6d7(0x58e)]||_0x20f767[_0x5bd6d7(0xfbb)]===_0x5bd6d7(0x1594)&&_0x20f767[_0x5bd6d7(0x128c)][_0x5bd6d7(0xe82)](_0x5bd6d7(0x1415)))[_0x5bd6d7(0x5cc)](-(_0x5da949[_0x5bd6d7(0x6a8)][_0x5bd6d7(0x58d)]||0x14)):_0x5da949['history'][_0x5bd6d7(0xede)](_0x55c855=>_0x55c855['timestamp']>_0x5046e8&&(!_0x55c855[_0x5bd6d7(0x58e)]||_0x55c855[_0x5bd6d7(0xfbb)]===_0x5bd6d7(0x1594)&&_0x55c855[_0x5bd6d7(0x128c)]['includes'](_0x5bd6d7(0x1415))));if(_0x1d477e[_0x5bd6d7(0x58a)]<0x5){if(_0x48a714)alert('最近的消息太少，无法进行有意义的总结。');return;}const _0x1177ce=_0x1ae02e[_0x5bd6d7(0x11ef)][_0x5bd6d7(0xb46)]||'用户',_0x145c2c=_0x1d477e[_0x5bd6d7(0x1431)](_0x4dbdee=>{const _0x42c46c=_0x5bd6d7;if(_0x4dbdee[_0x42c46c(0x58e)]&&_0x4dbdee[_0x42c46c(0xfbb)]===_0x42c46c(0x1594)&&_0x4dbdee[_0x42c46c(0x128c)]['includes'](_0x42c46c(0x1415)))return _0x4dbdee['content'];let _0x4fcde9;_0x4dbdee[_0x42c46c(0xfbb)]===_0x42c46c(0x860)?_0x4fcde9=_0x1177ce:_0x4fcde9=_0x4dbdee['senderName']||_0x5da949[_0x42c46c(0x96f)];let _0x16bf9d='';if(_0x4dbdee[_0x42c46c(0xcbd)]===_0x42c46c(0x439)){if(_0x4dbdee[_0x42c46c(0x128c)])_0x16bf9d=_0x4dbdee[_0x42c46c(0x128c)];else{const _0x5ca683=_0x4dbdee[_0x42c46c(0xdf2)]?'「'+_0x4dbdee[_0x42c46c(0xdf2)]+'」':'',_0x45026b=_0x4dbdee['description']?'('+_0x4dbdee['description']+')':'';_0x16bf9d=(_0x5ca683+'\x20'+_0x45026b)['trim']();}}else _0x16bf9d=String(_0x4dbdee[_0x42c46c(0x128c)]);return _0x4fcde9+':\x20'+_0x16bf9d;})[_0x5bd6d7(0x1143)]('\x0a');let _0x36b278;if(_0x5da949[_0x5bd6d7(0xe83)])_0x36b278='\x0a#\x20你的任务\x0a你是一个高级的“记忆分配专家”。你的任务是阅读下面的群聊记录，并为【每一个参与的AI角色】生成一段【个性化的、第一人称】的长期记忆。\x0a#\x20核心规则\x0a1.\x20\x20**视角铁律**:\x20每一条总结都【必须】使用【第一人称视角\x20(\x22我\x22)】。\x0a2.\x20\x20**内容核心**:\x20重点总结：我说过的话、我做过的事、别人对我说的话、与我相关的事、以及对我个人很重要的群聊事件、关键信息和心理活动。\x0a3.\x20\x20**【简洁性铁律】**:\x20每条个人记忆总结【绝对不能超过60个字】。\x0a4.\x20\x20**【省略规则】**:\x20如果一个角色在本次对话中【完全没有参与或提及】，你可以省略TA的记忆。\x0a5.\x20\x20**输出格式**:\x20你的回复【必须且只能】是一个JSON对象，格式如下：\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22summaries\x22:\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22角色的本名A\x22:\x20\x22我今天在群里和大家讨论了电影，感觉很开心。\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22角色的本名B\x22:\x20\x22我在群里和'+_0x1177ce+_0x5bd6d7(0xc0a)+_0x145c2c+_0x5bd6d7(0x343)+_0x5da949['members'][_0x5bd6d7(0x1431)](_0x512590=>'-\x20'+_0x512590[_0x5bd6d7(0xd69)]+_0x5bd6d7(0x85b)+_0x512590[_0x5bd6d7(0x96f)]+')')[_0x5bd6d7(0x1143)]('\x0a')+'\x0a现在，请为【参与了对话的AI角色】生成他们各自的、第一人称的、精简的记忆。';else{const _0x406193=new Date()['toLocaleDateString'](_0x5bd6d7(0xd02),{'year':'numeric','month':'long','day':_0x5bd6d7(0x113f)});_0x36b278='\x0a#\x20你的任务\x0a你就是角色“'+_0x5da949[_0x5bd6d7(0x96f)]+_0x5bd6d7(0x9db)+_0x1177ce+_0x5bd6d7(0x12de)+_0x406193+_0x5bd6d7(0xcef)+_0x406193+'”这个信息，将其转换为【具体的公历日期】（例如：“约定了明天见面”应总结为“我们约定了'+new Date(Date[_0x5bd6d7(0xd6e)]()+0x5265c00)['toLocaleDateString'](_0x5bd6d7(0xd02),{'month':_0x5bd6d7(0x2ee),'day':_0x5bd6d7(0x113f)})+'见面”）。\x0a4.\x20\x20**【风格要求】**:\x20你的总结应该像一份备忘录或要点记录，而不是一篇抒情散文。请尽量减少主观的心理感受描述，除非它直接导致了某个决定或计划。\x0a5.\x20\x20**【长度铁律】**:\x20你的总结【必须】非常简短，总长度【绝对不能超过100个字】。\x0a6.\x20\x20**【输出格式】**:\x20你的回复【必须且只能】是一个JSON对象，格式如下：\x0a\x20\x20\x20\x20`{\x22summary\x22:\x20\x22在这里写下你以第一人称视角，总结好的核心事实与计划。\x22}`\x0a\x0a#\x20你的角色设定\x0a'+_0x5da949[_0x5bd6d7(0x6a8)][_0x5bd6d7(0xf42)]+_0x5bd6d7(0x1549)+_0x5da949[_0x5bd6d7(0x6a8)][_0x5bd6d7(0x36b)]+_0x5bd6d7(0x12fb)+_0x145c2c+_0x5bd6d7(0x10c5)+_0x5da949[_0x5bd6d7(0x96f)]+_0x5bd6d7(0xcac);}try{const _0xf76604=_0x1ae02e[_0x5bd6d7(0x226)][_0x5bd6d7(0x78a)]&&_0x1ae02e[_0x5bd6d7(0x226)]['secondaryApiKey']&&_0x1ae02e[_0x5bd6d7(0x226)]['secondaryModel'],{proxyUrl:_0x32130c,apiKey:_0x5982fe,model:_0x1cb6ff}=_0xf76604?{'proxyUrl':_0x1ae02e[_0x5bd6d7(0x226)][_0x5bd6d7(0x78a)],'apiKey':_0x1ae02e[_0x5bd6d7(0x226)]['secondaryApiKey'],'model':_0x1ae02e['apiConfig'][_0x5bd6d7(0xe21)]}:_0x1ae02e[_0x5bd6d7(0x226)];if(!_0x32130c||!_0x5982fe||!_0x1cb6ff)throw new Error(_0x5bd6d7(0xcb7));let _0x2a28f5=_0x32130c[_0x5bd6d7(0xe82)](_0x5bd6d7(0xc38)),_0x3bcec3=_0x16b978(_0x1cb6ff,_0x5982fe,_0x36b278,[{'role':'user','content':'请开始总结。'}]);const _0x59d129=_0x2a28f5?await fetch(_0x3bcec3[_0x5bd6d7(0x258)],_0x3bcec3[_0x5bd6d7(0xc6b)]):await fetch(_0x32130c+'/v1/chat/completions',{'method':_0x5bd6d7(0x12d9),'headers':{'Content-Type':_0x5bd6d7(0xa90),'Authorization':_0x5bd6d7(0xf03)+_0x5982fe},'body':JSON[_0x5bd6d7(0x994)]({'model':_0x1cb6ff,'messages':[{'role':_0x5bd6d7(0x1594),'content':_0x36b278},{'role':_0x5bd6d7(0x860),'content':_0x5bd6d7(0xdb1)}],'temperature':0.2})});if(!_0x59d129['ok'])throw new Error(_0x5bd6d7(0xaa6)+_0x59d129['statusText']);const _0x3dfcfc=await _0x59d129[_0x5bd6d7(0xb84)]();let _0x2fba35=_0x2a28f5?getGeminiResponseText(_0x3dfcfc):_0x3dfcfc[_0x5bd6d7(0x10be)][0x0][_0x5bd6d7(0x11f0)]['content'];_0x2fba35=_0x2fba35[_0x5bd6d7(0xef0)](/^```json\s*/,'')[_0x5bd6d7(0xef0)](/```$/,'')[_0x5bd6d7(0x4a2)]();const _0x533564=JSON[_0x5bd6d7(0x129c)](_0x2fba35);if(_0x5da949['isGroup']){if(_0x533564[_0x5bd6d7(0x4e2)]&&typeof _0x533564[_0x5bd6d7(0x4e2)]==='object'){let _0x1ee347=0x0;for(const _0x60f8c9 in _0x533564['summaries']){const _0x57efde=_0x533564[_0x5bd6d7(0x4e2)][_0x60f8c9];if(_0x57efde&&_0x57efde[_0x5bd6d7(0x4a2)]()){const _0x2ac1f0=Object[_0x5bd6d7(0x753)](_0x1ae02e[_0x5bd6d7(0x589)])[_0x5bd6d7(0x13b7)](_0x83f020=>_0x83f020['originalName']===_0x60f8c9);if(_0x2ac1f0){const _0x4a5cb3={'content':_0x57efde[_0x5bd6d7(0x4a2)](),'timestamp':Date['now'](),'source':_0x5bd6d7(0x743)+_0x5da949[_0x5bd6d7(0x5d2)]};if(!_0x2ac1f0[_0x5bd6d7(0x5fb)])_0x2ac1f0[_0x5bd6d7(0x5fb)]=[];_0x2ac1f0[_0x5bd6d7(0x5fb)]['push'](_0x4a5cb3),await _0x3df81a[_0x5bd6d7(0x589)][_0x5bd6d7(0x295)](_0x2ac1f0),_0x1ee347++;}}}if(_0x1ee347>0x0)console[_0x5bd6d7(0x57e)]('自动总结成功：为\x20'+_0x1ee347+_0x5bd6d7(0x8af));else throw new Error('AI返回了空的或格式不正确的总结内容。');}else throw new Error(_0x5bd6d7(0x101f));}else{if(_0x533564[_0x5bd6d7(0xefa)]&&_0x533564[_0x5bd6d7(0xefa)][_0x5bd6d7(0x4a2)]()){const _0x467761={'content':_0x533564[_0x5bd6d7(0xefa)][_0x5bd6d7(0x4a2)](),'timestamp':Date[_0x5bd6d7(0xd6e)](),'source':_0x5bd6d7(0x2aa)};_0x5da949[_0x5bd6d7(0x5fb)][_0x5bd6d7(0x1426)](_0x467761),await _0x3df81a[_0x5bd6d7(0x589)]['put'](_0x5da949),console['log']('自动总结成功：已成功添加\x201\x20条新的长期记忆！');}else throw new Error('AI返回了空的或格式不正确的总结内容。');}_0x5da949[_0x5bd6d7(0xb23)]=_0x1d477e[_0x5bd6d7(0x5cc)](-0x1)[0x0][_0x5bd6d7(0x1388)],await _0x3df81a[_0x5bd6d7(0x589)]['put'](_0x5da949),document[_0x5bd6d7(0x1f4)](_0x5bd6d7(0x14b4))[_0x5bd6d7(0x159b)][_0x5bd6d7(0xaea)]('active')&&_0x38eeb7();}catch(_0x298168){console[_0x5bd6d7(0x127d)](_0x5bd6d7(0x1366),_0x298168),await _0x1460c5(_0x5bd6d7(0x155a),_0x5bd6d7(0x1345)+_0x298168[_0x5bd6d7(0x11f0)]);}}function _0x547958(){const _0x30bdd5=_0x2b1222;if(!_0x3c0c35)return;const _0x2aa3bc=_0x1ae02e[_0x30bdd5(0x589)][_0x1ae02e['activeChatId']],_0x12f9a6=_0x2aa3bc[_0x30bdd5(0xce3)][_0x30bdd5(0x13b7)](_0x5703f5=>_0x5703f5[_0x30bdd5(0x1388)]===_0x3c0c35&&!_0x5703f5[_0x30bdd5(0x58e)]);if(!_0x12f9a6)return;let _0x58ac9a;_0x12f9a6[_0x30bdd5(0xfbb)]==='user'?_0x58ac9a=_0x2aa3bc[_0x30bdd5(0xe83)]?_0x2aa3bc['settings'][_0x30bdd5(0xe31)]||'我':'我':_0x2aa3bc['isGroup']?_0x58ac9a=_0x140540(_0x2aa3bc,_0x12f9a6[_0x30bdd5(0xfb7)]):_0x58ac9a=_0x2aa3bc['name'];const _0x246c5b=String(_0x12f9a6[_0x30bdd5(0x128c)]||'');let _0x3b9cba='';if(typeof _0x12f9a6['content']==='string'&&_0x43460a['test'](_0x12f9a6[_0x30bdd5(0x128c)]))_0x3b9cba=_0x30bdd5(0x486);else{if(_0x12f9a6['type']===_0x30bdd5(0xce9)||_0x12f9a6['type']==='user_photo')_0x3b9cba=_0x30bdd5(0x947);else _0x12f9a6[_0x30bdd5(0xcbd)]==='voice_message'?_0x3b9cba=_0x30bdd5(0x57d):_0x3b9cba=_0x246c5b[_0x30bdd5(0x516)](0x0,0x32)+(_0x246c5b[_0x30bdd5(0x58a)]>0x32?_0x30bdd5(0x629):'');}_0x44c23e={'timestamp':_0x12f9a6[_0x30bdd5(0x1388)],'senderName':_0x58ac9a,'content':_0x246c5b};const _0x5457c2=document['getElementById'](_0x30bdd5(0x13d7));_0x5457c2[_0x30bdd5(0xeda)](_0x30bdd5(0x709))[_0x30bdd5(0x231)]=_0x30bdd5(0xefc)+_0x44c23e[_0x30bdd5(0xfb7)]+':',_0x5457c2[_0x30bdd5(0xeda)]('.text')[_0x30bdd5(0x231)]=_0x3b9cba,_0x5457c2[_0x30bdd5(0x215)][_0x30bdd5(0x887)]=_0x30bdd5(0x361),_0x22a0ab(),document['getElementById']('chat-input')[_0x30bdd5(0xed2)]();}function _0x47891a(){const _0x156a94=_0x2b1222;_0x44c23e=null,document[_0x156a94(0x1f4)](_0x156a94(0x13d7))[_0x156a94(0x215)]['display']='none';}let _0x53a45d=null;function _0x1632cb(_0x50360b){const _0x1ed230=_0x2b1222;_0x53a45d=_0x50360b;const _0xa909a6=_0x1ae02e[_0x1ed230(0x589)][_0x1ae02e[_0x1ed230(0x588)]],_0x58e417=_0xa909a6[_0x1ed230(0xce3)]['find'](_0x2d24ae=>_0x2d24ae['timestamp']===_0x50360b);_0x58e417&&(document[_0x1ed230(0x1f4)](_0x1ed230(0x287))[_0x1ed230(0x231)]=_0x58e417[_0x1ed230(0xfb7)]),document[_0x1ed230(0x1f4)]('transfer-actions-modal')[_0x1ed230(0x159b)][_0x1ed230(0x6a4)]('visible');}function _0x46ad40(){const _0x34b771=_0x2b1222;document['getElementById'](_0x34b771(0x794))[_0x34b771(0x159b)]['remove'](_0x34b771(0xfca)),_0x53a45d=null;}async function _0x2ee6fa(_0x4916a0){const _0x40ef70=_0x2b1222;if(!_0x53a45d)return;const _0x3bb7fb=_0x53a45d,_0x584bcf=_0x1ae02e[_0x40ef70(0x589)][_0x1ae02e[_0x40ef70(0x588)]],_0x1c61fa=_0x584bcf[_0x40ef70(0xce3)]['findIndex'](_0x103043=>_0x103043[_0x40ef70(0x1388)]===_0x3bb7fb);if(_0x1c61fa===-0x1)return;const _0x24094d=_0x584bcf[_0x40ef70(0xce3)][_0x1c61fa];_0x24094d['status']=_0x4916a0;let _0x9e6389;if(_0x4916a0===_0x40ef70(0x1281)){const _0x2e7f6d={'role':'user','type':_0x40ef70(0x904),'isRefund':!![],'amount':_0x24094d[_0x40ef70(0x618)],'note':_0x40ef70(0x13d8),'timestamp':Date[_0x40ef70(0xd6e)]()};_0x584bcf['history'][_0x40ef70(0x1426)](_0x2e7f6d),_0x9e6389=_0x40ef70(0x11a7)+_0x24094d[_0x40ef70(0xfb7)]+_0x40ef70(0xe77);}else _0x9e6389=_0x40ef70(0xf7d)+_0x24094d['senderName']+'”的转账。]';const _0x189409={'role':_0x40ef70(0x1594),'content':_0x9e6389,'timestamp':Date[_0x40ef70(0xd6e)]()+0x1,'isHidden':!![]};_0x584bcf[_0x40ef70(0xce3)][_0x40ef70(0x1426)](_0x189409),await _0x3df81a[_0x40ef70(0x589)][_0x40ef70(0x295)](_0x584bcf),_0x46ad40(),_0x3689f0(_0x1ae02e['activeChatId']),_0x1033ae();}async function _0xca395b(){const _0x3e1163=_0x2b1222;_0x2e53fa(_0x3e1163(0x9a5));const _0x2adf45=document[_0x3e1163(0x1f4)](_0x3e1163(0x815)),_0x2a133d=document[_0x3e1163(0x1f4)](_0x3e1163(0xba9));_0x2adf45[_0x3e1163(0xf21)]='',_0x2a133d[_0x3e1163(0x231)]='所有通话记录';const _0x413046=await _0x3df81a[_0x3e1163(0xac4)][_0x3e1163(0x931)]('timestamp')[_0x3e1163(0x115a)]()[_0x3e1163(0x27a)]();if(_0x413046[_0x3e1163(0x58a)]===0x0){_0x2adf45[_0x3e1163(0xf21)]='<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>这里还没有通话记录哦~</p>';return;}_0x413046[_0x3e1163(0x59b)](_0x395d33=>{const _0x406f8c=_0x250925(_0x395d33);_0x1160f3(_0x406f8c,async()=>{const _0x248d0c=_0x475c,_0x1687ef=await _0x11f6fb('自定义通话名称',_0x248d0c(0xbfd),_0x395d33[_0x248d0c(0xbec)]||'');if(_0x1687ef===null)return;await _0x3df81a[_0x248d0c(0xac4)][_0x248d0c(0xf18)](_0x395d33['id'],{'customName':_0x1687ef[_0x248d0c(0x4a2)]()}),await _0xca395b(),await _0x1460c5('成功',_0x248d0c(0x8a6));}),_0x2adf45['appendChild'](_0x406f8c);});}function _0x250925(_0x3781db){const _0x6c373d=_0x2b1222,_0xa7cc1e=document[_0x6c373d(0x219)](_0x6c373d(0xaf9));_0xa7cc1e[_0x6c373d(0x7c6)]='call-record-card',_0xa7cc1e['dataset'][_0x6c373d(0x1172)]=_0x3781db['id'];const _0x25debd=_0x1ae02e[_0x6c373d(0x589)][_0x3781db[_0x6c373d(0x3e0)]],_0x22c6de=_0x25debd?_0x25debd[_0x6c373d(0x5d2)]:_0x6c373d(0xf8f),_0x2ccd2e=new Date(_0x3781db['timestamp']),_0x2a116a=_0x2ccd2e[_0x6c373d(0x1567)]()+'-'+String(_0x2ccd2e[_0x6c373d(0x45d)]()+0x1)[_0x6c373d(0x1189)](0x2,'0')+'-'+String(_0x2ccd2e['getDate']())[_0x6c373d(0x1189)](0x2,'0')+'\x20'+String(_0x2ccd2e[_0x6c373d(0x4ee)]())[_0x6c373d(0x1189)](0x2,'0')+':'+String(_0x2ccd2e[_0x6c373d(0x1465)]())[_0x6c373d(0x1189)](0x2,'0'),_0x2f1d55=Math[_0x6c373d(0x123c)](_0x3781db['duration']/0x3c)+'分'+_0x3781db[_0x6c373d(0x15b4)]%0x3c+'秒',_0x55b871=_0x3781db['participants'][_0x6c373d(0x1431)](_0x3368ea=>'<img\x20src=\x22'+_0x3368ea[_0x6c373d(0x95b)]+_0x6c373d(0xec3)+_0x3368ea[_0x6c373d(0x5d2)]+_0x6c373d(0x157e)+_0x3368ea[_0x6c373d(0x5d2)]+'\x22>')[_0x6c373d(0x1143)]('');return _0xa7cc1e[_0x6c373d(0xf21)]=_0x6c373d(0x2bb)+_0x2a116a+_0x6c373d(0x1554)+_0x2f1d55+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20【核心修改】在这里新增一个标题行\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x3781db[_0x6c373d(0xbec)]?_0x6c373d(0x1397)+_0x3781db[_0x6c373d(0xbec)]+_0x6c373d(0x149b):'')+_0x6c373d(0x1073)+_0x55b871+_0x6c373d(0xb71)+_0x22c6de+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0xa7cc1e;}async function _0x205cfe(_0x4a6be3){const _0x32619d=_0x2b1222,_0x21244f=await _0x3df81a[_0x32619d(0xac4)][_0x32619d(0x13f8)](_0x4a6be3);if(!_0x21244f)return;const _0x44d428=document[_0x32619d(0x1f4)]('call-transcript-modal'),_0x11bf79=document['getElementById']('transcript-modal-title'),_0x409538=document['getElementById']('call-transcript-modal-body');_0x11bf79[_0x32619d(0x231)]=_0x32619d(0xfe8)+new Date(_0x21244f[_0x32619d(0x1388)])[_0x32619d(0x613)]()+_0x32619d(0x64a)+Math['floor'](_0x21244f[_0x32619d(0x15b4)]/0x3c)+'分'+_0x21244f[_0x32619d(0x15b4)]%0x3c+'秒)',_0x409538[_0x32619d(0xf21)]='';const _0x41728e=document[_0x32619d(0x1f4)](_0x32619d(0x1361)),_0x316e8c=document[_0x32619d(0x1f4)](_0x32619d(0x1118));!_0x21244f[_0x32619d(0x806)]||_0x21244f[_0x32619d(0x806)]['length']===0x0?(_0x409538[_0x32619d(0xf21)]=_0x32619d(0x42c),_0x316e8c['style'][_0x32619d(0x887)]=_0x32619d(0x1b5)):(_0x316e8c[_0x32619d(0x215)][_0x32619d(0x887)]=_0x32619d(0x361),_0x21244f[_0x32619d(0x806)][_0x32619d(0x59b)](_0xea0d80=>{const _0x2cb0bf=_0x32619d,_0x5ecdf1=document[_0x2cb0bf(0x219)]('div');_0x5ecdf1['className']=_0x2cb0bf(0x150a)+_0xea0d80[_0x2cb0bf(0xfbb)],_0x5ecdf1[_0x2cb0bf(0x231)]=_0xea0d80[_0x2cb0bf(0x128c)],_0x409538[_0x2cb0bf(0x6ce)](_0x5ecdf1);}));const _0x1495fa=_0x41728e[_0x32619d(0xf44)](!![]);_0x41728e['parentNode'][_0x32619d(0xa88)](_0x1495fa,_0x41728e);const _0x4eaed5=_0x316e8c[_0x32619d(0xf44)](!![]);_0x316e8c['parentNode'][_0x32619d(0xa88)](_0x4eaed5,_0x316e8c),_0x1495fa[_0x32619d(0x122b)](_0x32619d(0x740),async()=>{const _0x471bbc=_0x32619d,_0x5f06fb=await _0x109970('确认删除',_0x471bbc(0x7ee),{'confirmButtonClass':'btn-danger'});_0x5f06fb&&(_0x44d428[_0x471bbc(0x159b)][_0x471bbc(0xa9c)](_0x471bbc(0xfca)),await _0x3df81a['callRecords'][_0x471bbc(0xc40)](_0x4a6be3),await _0xca395b(),alert(_0x471bbc(0x1544)));}),_0x4eaed5[_0x32619d(0x122b)]('click',async()=>{const _0x1facea=_0x32619d,_0x434873=await _0x109970(_0x1facea(0x710),_0x1facea(0x602),{'confirmText':'确认总结'});if(!_0x434873)return;_0x44d428[_0x1facea(0x159b)][_0x1facea(0xa9c)](_0x1facea(0xfca));const _0x9046ba=_0x1ae02e[_0x1facea(0x589)][_0x21244f[_0x1facea(0x3e0)]];if(!_0x9046ba){alert('错误：找不到该通话记录所属的聊天对象。');return;}await _0x1460c5(_0x1facea(0x11b7),'正在请求AI进行手动总结...');try{const _0xea774d=_0x21244f[_0x1facea(0x806)][_0x1facea(0x1431)](_0x25835c=>{const _0x40ab13=_0x1facea,_0xf5a0ec=_0x25835c['role']===_0x40ab13(0x860)?_0x9046ba[_0x40ab13(0x6a8)][_0x40ab13(0xe31)]||'我':_0x25835c['senderName']||_0x9046ba[_0x40ab13(0x5d2)];return _0xf5a0ec+':\x20'+_0x25835c[_0x40ab13(0x128c)];})[_0x1facea(0x1143)]('\x0a');await _0x291745(_0x21244f[_0x1facea(0x3e0)],_0xea774d),await _0x1460c5('总结成功',_0x1facea(0x153d)+_0x9046ba[_0x1facea(0x5d2)]+'”的长期记忆中。');}catch(_0x1a5765){await _0x1460c5(_0x1facea(0x155a),_0x1facea(0x11a0)+_0x1a5765[_0x1facea(0x11f0)]);}});const _0x294ed1=document['getElementById']('close-transcript-modal-btn'),_0x93b7bf=_0x294ed1[_0x32619d(0xf44)](!![]);_0x294ed1[_0x32619d(0xad7)][_0x32619d(0xa88)](_0x93b7bf,_0x294ed1),_0x93b7bf[_0x32619d(0x122b)](_0x32619d(0x740),()=>{const _0x570437=_0x32619d;_0x44d428['classList'][_0x570437(0xa9c)]('visible');}),_0x44d428['classList'][_0x32619d(0x6a4)](_0x32619d(0xfca));}async function _0x1c12b7(){const _0x5cfcf2=_0x2b1222;if(!_0x1ae02e[_0x5cfcf2(0x588)]||_0x1ae02e[_0x5cfcf2(0x589)][_0x1ae02e[_0x5cfcf2(0x588)]][_0x5cfcf2(0xe83)])return;const _0x5a0363=_0x1ae02e[_0x5cfcf2(0x589)][_0x1ae02e[_0x5cfcf2(0x588)]],_0xb3130d=await _0x11f6fb('编辑对方状态','请输入对方现在的新状态：',_0x5a0363['status']['text']);_0xb3130d!==null&&(_0x5a0363['status']['text']=_0xb3130d['trim']()||'在线',_0x5a0363[_0x5cfcf2(0x1589)][_0x5cfcf2(0x142b)]=![],_0x5a0363[_0x5cfcf2(0x1589)]['lastUpdate']=Date[_0x5cfcf2(0xd6e)](),await _0x3df81a['chats'][_0x5cfcf2(0x295)](_0x5a0363),_0x3689f0(_0x1ae02e[_0x5cfcf2(0x588)]),_0x1033ae(),await _0x1460c5(_0x5cfcf2(0x72b),'“'+_0x5a0363[_0x5cfcf2(0x5d2)]+_0x5cfcf2(0x1066)+_0x5a0363[_0x5cfcf2(0x1589)][_0x5cfcf2(0x40f)]));}async function _0x24db97(){const _0x1002c8=_0x2b1222,_0x1e98ce=document['getElementById'](_0x1002c8(0x3b8)),_0x3c0e43=document[_0x1002c8(0x1f4)](_0x1002c8(0xbf1));_0x3c0e43[_0x1002c8(0xf21)]='';const _0x533d4d=Object[_0x1002c8(0x753)](_0x1ae02e[_0x1002c8(0x589)]);_0x533d4d['forEach'](_0x549025=>{const _0x2b341d=_0x1002c8,_0xa6bcc0=document['createElement'](_0x2b341d(0xaf9));_0xa6bcc0['className']=_0x2b341d(0xec5),_0xa6bcc0['innerHTML']=_0x2b341d(0x1089)+_0x549025['id']+'\x22\x20style=\x22margin-right:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+(_0x549025[_0x2b341d(0xe83)]?_0x549025['settings'][_0x2b341d(0xe46)]:_0x549025[_0x2b341d(0x6a8)][_0x2b341d(0xc99)]||_0x5494d0)+_0x2b341d(0x27c)+_0x549025['name']+_0x2b341d(0x100c),_0x3c0e43[_0x2b341d(0x6ce)](_0xa6bcc0);}),_0x1e98ce[_0x1002c8(0x159b)][_0x1002c8(0x6a4)](_0x1002c8(0xfca));}function _0x3dfe58(_0x42d179){const _0x3673f4=_0x2b1222,_0x15046b=document[_0x3673f4(0x1f4)](_0x3673f4(0x1377));if(!_0x15046b[_0x3673f4(0x159b)][_0x3673f4(0xaea)]('visible')){if(_0x42d179)_0x42d179();return;}_0x15046b[_0x3673f4(0x159b)][_0x3673f4(0xa9c)](_0x3673f4(0xfca)),setTimeout(()=>{const _0x4819e6=_0x3673f4;document[_0x4819e6(0x1f4)]('music-playlist-panel')[_0x4819e6(0x159b)][_0x4819e6(0xa9c)](_0x4819e6(0xfca));if(_0x42d179)_0x42d179();},0x190);}function _0x312b38(_0x924997){const _0x158238=_0x2b1222;if(!_0x924997)return[];const _0x13e358=String(_0x924997)[_0x158238(0x23f)](/\r\n?|\n/),_0x12a7cd=[],_0x10e048=/\[(\d{2}):(\d{2})[.:](\d{2,3})\]/g;for(const _0x43d2b5 of _0x13e358){const _0x32a75c=_0x43d2b5[_0x158238(0xef0)](_0x10e048,'')[_0x158238(0x4a2)]();if(!_0x32a75c)continue;_0x10e048[_0x158238(0xd0e)]=0x0;let _0x500845;while((_0x500845=_0x10e048[_0x158238(0x1315)](_0x43d2b5))!==null){const _0x265e53=parseInt(_0x500845[0x1],0xa),_0x483aea=parseInt(_0x500845[0x2],0xa),_0x29ebd6=parseInt(_0x500845[0x3][_0x158238(0x4c9)](0x3,'0'),0xa),_0x172adf=_0x265e53*0x3c+_0x483aea+_0x29ebd6/0x3e8;_0x12a7cd[_0x158238(0x1426)]({'time':_0x172adf,'text':_0x32a75c});}}return _0x12a7cd[_0x158238(0x74e)]((_0x3e55bf,_0x2fd0fb)=>_0x3e55bf['time']-_0x2fd0fb['time']);}function _0x3e5b8a(){const _0xfe2e42=_0x2b1222,_0x3f6915=document[_0xfe2e42(0x1f4)](_0xfe2e42(0xfd3));_0x3f6915['innerHTML']='';if(!_0x5419de[_0xfe2e42(0xc78)]||_0x5419de[_0xfe2e42(0xc78)][_0xfe2e42(0x58a)]===0x0){_0x3f6915[_0xfe2e42(0xf21)]=_0xfe2e42(0xb0a);return;}_0x5419de[_0xfe2e42(0xc78)][_0xfe2e42(0x59b)]((_0x5d7e0c,_0x4a0dcb)=>{const _0x5c2c89=_0xfe2e42,_0x4c14d5=document[_0x5c2c89(0x219)]('div');_0x4c14d5['className']='lyric-line',_0x4c14d5[_0x5c2c89(0x231)]=_0x5d7e0c['text'],_0x4c14d5[_0x5c2c89(0x746)]['index']=_0x4a0dcb,_0x3f6915[_0x5c2c89(0x6ce)](_0x4c14d5);}),_0x3f6915[_0xfe2e42(0x215)][_0xfe2e42(0x8c6)]=_0xfe2e42(0x73e);}function _0x511381(){}function _0x31cb27(){const _0x23a99b=_0x2b1222;if(!islandLyricText||!islandLyricContainer)return;const _0x388571=islandLyricText[_0x23a99b(0x12cd)],_0x2a8c27=islandLyricContainer[_0x23a99b(0x8e1)];if(_0x388571>_0x2a8c27){const _0x4e0aae=_0x388571/_0x2a8c27,_0x29a312=Math[_0x23a99b(0x616)](0x5,_0x4e0aae*0x5);islandLyricText[_0x23a99b(0x215)]['setProperty'](_0x23a99b(0x742),_0x29a312+'s'),islandLyricText[_0x23a99b(0x215)]['setProperty'](_0x23a99b(0xff5),_0x2a8c27+'px'),islandLyricText[_0x23a99b(0x215)]['setProperty'](_0x23a99b(0x854),_0x388571+'px'),islandLyricText[_0x23a99b(0x159b)]['add']('scrolling');}else islandLyricText[_0x23a99b(0x159b)]['remove'](_0x23a99b(0x1322));}function _0x3687ce(_0x5835a1){const _0x3eb17b=_0x2b1222;if(_0x5419de['parsedLyrics'][_0x3eb17b(0x58a)]===0x0)return;let _0x1142f4=-0x1;for(let _0x3010da=0x0;_0x3010da<_0x5419de[_0x3eb17b(0xc78)][_0x3eb17b(0x58a)];_0x3010da++){if(_0x5835a1>=_0x5419de[_0x3eb17b(0xc78)][_0x3010da][_0x3eb17b(0x12ba)])_0x1142f4=_0x3010da;else break;}if(_0x1142f4===_0x5419de[_0x3eb17b(0x35c)])return;_0x5419de['currentLyricIndex']=_0x1142f4,_0x4ab3d4();const _0x299c7f=document[_0x3eb17b(0x1f4)]('single-lyric-display');_0x299c7f&&(_0x1142f4>-0x1&&_0x5419de[_0x3eb17b(0xc78)][_0x1142f4]?_0x299c7f['textContent']=_0x5419de[_0x3eb17b(0xc78)][_0x1142f4][_0x3eb17b(0x40f)]:_0x299c7f[_0x3eb17b(0x231)]=_0x3eb17b(0xd1c));const _0x157333=document['getElementById']('global-lyrics-bar');_0x157333[_0x3eb17b(0x159b)][_0x3eb17b(0xaea)]('visible')&&(_0x1142f4>-0x1&&_0x5419de[_0x3eb17b(0xc78)][_0x1142f4]?_0x157333[_0x3eb17b(0x231)]=_0x5419de[_0x3eb17b(0xc78)][_0x1142f4][_0x3eb17b(0x40f)]:_0x157333[_0x3eb17b(0x231)]='♪');if(phoneScreenForIsland[_0x3eb17b(0x159b)][_0x3eb17b(0xaea)](_0x3eb17b(0xd6c))){const _0x2258d5=_0x1142f4>-0x1&&_0x5419de[_0x3eb17b(0xc78)][_0x1142f4]?_0x5419de[_0x3eb17b(0xc78)][_0x1142f4]['text']:'♪\x20♪\x20♪',_0x16fe2a=islandLyricText[_0x3eb17b(0xeda)](_0x3eb17b(0x39e));if(_0x16fe2a&&_0x16fe2a['textContent']===_0x2258d5)return;islandLyricText['style'][_0x3eb17b(0x38d)]=0x0,setTimeout(()=>{const _0x4523f0=_0x3eb17b;islandLyricText[_0x4523f0(0x159b)][_0x4523f0(0xa9c)](_0x4523f0(0x1322)),islandLyricContainer[_0x4523f0(0x159b)]['remove'](_0x4523f0(0x43e)),islandLyricText[_0x4523f0(0x215)]['animation']=_0x4523f0(0x1b5);let _0x1b7458=islandLyricText[_0x4523f0(0xeda)](_0x4523f0(0x39e)),_0x1cf6c7=islandLyricText[_0x4523f0(0xeda)](_0x4523f0(0x1bd));!_0x1b7458&&(_0x1b7458=document[_0x4523f0(0x219)](_0x4523f0(0x489)),islandLyricText['appendChild'](_0x1b7458));!_0x1cf6c7&&(_0x1cf6c7=document[_0x4523f0(0x219)]('span'),islandLyricText[_0x4523f0(0x6ce)](_0x1cf6c7));_0x1b7458[_0x4523f0(0x231)]=_0x2258d5,_0x1cf6c7[_0x4523f0(0x231)]=_0x2258d5;const _0x43a000=_0x1b7458[_0x4523f0(0x93a)],_0xa35ce6=islandLyricContainer[_0x4523f0(0x8e1)];if(_0x43a000>_0xa35ce6){const _0x5a09fd=_0x43a000/_0xa35ce6,_0x2effe4=Math['max'](0x5,_0x5a09fd*0x5);islandLyricText[_0x4523f0(0x215)][_0x4523f0(0x495)]('--marquee-duration',_0x2effe4+'s'),islandLyricText['classList']['add']('scrolling'),islandLyricText['style'][_0x4523f0(0xe2c)]=_0x4523f0(0xc13);}else islandLyricContainer[_0x4523f0(0x159b)][_0x4523f0(0x6a4)](_0x4523f0(0x43e));islandLyricText[_0x4523f0(0x215)][_0x4523f0(0x38d)]=0x1;},0xc8);}}function _0x4ab3d4(_0x2fb715=![]){const _0x11cb1d=_0x2b1222,_0x2bdbae=_0x2fb715?'#fullscreen-lyrics-container\x20.music-lyrics-list':'#music-lyrics-container\x20#music-lyrics-list',_0x28d93d=_0x2fb715?_0x11cb1d(0x13b2):_0x11cb1d(0xbcf),_0x2a38f7=document['querySelector'](_0x2bdbae),_0x8adcbc=document[_0x11cb1d(0xeda)](_0x28d93d);if(!_0x2a38f7||!_0x8adcbc)return;const _0x3b5e53=_0x2a38f7[_0x11cb1d(0x14bf)](_0x11cb1d(0x3af));_0x3b5e53['forEach'](_0x3a43de=>_0x3a43de[_0x11cb1d(0x159b)][_0x11cb1d(0xa9c)]('active'));if(_0x5419de[_0x11cb1d(0x35c)]===-0x1){_0x2a38f7[_0x11cb1d(0x215)]['transform']=_0x11cb1d(0x73e);return;}const _0x4e8477=_0x2a38f7['querySelector'](_0x11cb1d(0x28f)+_0x5419de[_0x11cb1d(0x35c)]+'\x22]');if(_0x4e8477){_0x4e8477[_0x11cb1d(0x159b)][_0x11cb1d(0x6a4)](_0x11cb1d(0x7cf));const _0x42ca3b=_0x8adcbc['offsetHeight'],_0x1990c7=_0x42ca3b/2.2-_0x4e8477['offsetTop']-_0x4e8477[_0x11cb1d(0xc5b)]/0x2;_0x2a38f7[_0x11cb1d(0x215)][_0x11cb1d(0x8c6)]=_0x11cb1d(0x18a)+_0x1990c7+_0x11cb1d(0xc3a);}}function _0x56179d(_0x58a464){const _0x292794=_0x2b1222;if(isNaN(_0x58a464)||_0x58a464<0x0)return _0x292794(0xe28);const _0x4b5226=Math[_0x292794(0x123c)](_0x58a464/0x3c),_0x40f2da=Math[_0x292794(0x123c)](_0x58a464%0x3c);return _0x4b5226+':'+String(_0x40f2da)[_0x292794(0x1189)](0x2,'0');}let _0x315b6d=0x0,_0x17e38f;function _0x39fb09(){_0x17e38f&&cancelAnimationFrame(_0x17e38f);function _0x4869dc(){const _0x2dbead=_0x475c;if(!_0x5419de[_0x2dbead(0x14ce)]||!_0x43beab[_0x2dbead(0x15b4)])return;const _0x346e58=performance['now'](),_0x466641=_0x43beab[_0x2dbead(0xa68)],_0x804e9a=_0x43beab['duration'],_0x1379da=_0x466641/_0x804e9a*0x64;document['getElementById']('music-progress-fill')[_0x2dbead(0x215)]['width']=_0x1379da+'%',_0x346e58-_0x315b6d>0x3e8&&(document[_0x2dbead(0x1f4)]('music-current-time')['textContent']=_0x56179d(_0x466641),document[_0x2dbead(0x1f4)](_0x2dbead(0xb5a))[_0x2dbead(0x231)]=_0x56179d(_0x804e9a),_0x315b6d=_0x346e58),_0x3687ce(_0x466641),_0x511381(),_0x17e38f=requestAnimationFrame(_0x4869dc);}_0x17e38f=requestAnimationFrame(_0x4869dc);}function _0x3b3797(){const _0x5efd89=_0x2b1222;if(!lastRawAiResponse){alert(_0x5efd89(0x1400));return;}const _0x526bf0=document[_0x5efd89(0x1f4)](_0x5efd89(0xbc2)),_0xa78a90=document[_0x5efd89(0x1f4)](_0x5efd89(0x66c));_0xa78a90[_0x5efd89(0xf21)]='';const _0x1caa54=_0x1493d9(lastRawAiResponse);if(_0x1caa54&&_0x1caa54[_0x5efd89(0x58a)]>0x0)_0x1caa54[_0x5efd89(0x59b)](_0x15877b=>{const _0xc3b951=_0x5efd89;if(typeof _0x15877b===_0xc3b951(0xcc5)&&_0x15877b!==null)try{const _0x5ac233=JSON[_0xc3b951(0x994)](_0x15877b,null,0x2),_0x506183=_0x19f2df(_0x5ac233);_0xa78a90[_0xc3b951(0x6ce)](_0x506183);}catch(_0x4534e4){console[_0xc3b951(0x127d)](_0xc3b951(0xff4),_0x15877b,_0x4534e4);}else{if(typeof _0x15877b==='string'){const _0x4e07b3=_0x19f2df(_0x15877b);_0xa78a90['appendChild'](_0x4e07b3),console[_0xc3b951(0xb3b)](_0xc3b951(0x1eb),_0x15877b);}}});else{const _0x4f6750=_0x19f2df(lastRawAiResponse);_0xa78a90['appendChild'](_0x4f6750);}_0x526bf0[_0x5efd89(0x159b)][_0x5efd89(0x6a4)](_0x5efd89(0xfca));}function _0x19f2df(_0x3b835b=''){const _0x5695d9=_0x2b1222,_0x385349=document[_0x5695d9(0x219)](_0x5695d9(0xaf9));_0x385349[_0x5695d9(0x7c6)]=_0x5695d9(0x1591);const _0xe96780={'text':{'type':_0x5695d9(0x40f),'content':_0x5695d9(0xd9e)},'sticker':{'type':'sticker','url':_0x5695d9(0x7f5),'meaning':_0x5695d9(0xd6d)},'image':{'type':'ai_image','description':_0x5695d9(0x1471)},'voice':{'type':_0x5695d9(0xd83),'content':_0x5695d9(0x12f1)},'transfer':{'type':'transfer','amount':5.2,'note':_0x5695d9(0x1323)},'offline':{'type':'offline_text','content':_0x5695d9(0x1273)},'quote':{'type':_0x5695d9(0x3d4),'target_timestamp':0x499602d2,'reply_content':_0x5695d9(0x84b)},'nai':{'type':_0x5695d9(0x132a),'prompt':_0x5695d9(0xbfb)}};return _0x385349['innerHTML']=_0x5695d9(0xa29)+_0x3b835b+_0x5695d9(0x159d)+JSON[_0x5695d9(0x994)](_0xe96780[_0x5695d9(0x40f)])+_0x5695d9(0x65a)+JSON[_0x5695d9(0x994)](_0xe96780[_0x5695d9(0x1b3)])+_0x5695d9(0xfb2)+JSON[_0x5695d9(0x994)](_0xe96780['image'])+_0x5695d9(0x924)+JSON[_0x5695d9(0x994)](_0xe96780[_0x5695d9(0xcfd)])+_0x5695d9(0x9f0)+JSON['stringify'](_0xe96780[_0x5695d9(0x904)])+_0x5695d9(0xf3d)+JSON['stringify'](_0xe96780[_0x5695d9(0x5bc)])+_0x5695d9(0xd03)+JSON[_0x5695d9(0x994)](_0xe96780['quote'])+'\x27>引用</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22format-btn\x22\x20data-template=\x27'+JSON[_0x5695d9(0x994)](_0xe96780[_0x5695d9(0x6fe)])+_0x5695d9(0x7dd),_0x385349[_0x5695d9(0xeda)](_0x5695d9(0x44f))[_0x5695d9(0x122b)](_0x5695d9(0x740),()=>{_0x385349['remove']();}),_0x385349[_0x5695d9(0x14bf)](_0x5695d9(0x10a8))['forEach'](_0x99f699=>{const _0x38cf5b=_0x5695d9;_0x99f699[_0x38cf5b(0x122b)](_0x38cf5b(0x740),()=>{const _0x54679f=_0x38cf5b,_0x3e9e31=_0x99f699['dataset'][_0x54679f(0x1532)],_0x4bed19=_0x385349[_0x54679f(0xeda)](_0x54679f(0x1097));if(_0x3e9e31&&_0x4bed19)try{const _0x4e0576=JSON['parse'](_0x3e9e31);_0x4bed19[_0x54679f(0x107e)]=JSON[_0x54679f(0x994)](_0x4e0576,null,0x2),_0x4bed19[_0x54679f(0xed2)]();}catch(_0x32a795){console[_0x54679f(0x127d)](_0x54679f(0x35d),_0x32a795);}});}),_0x385349;}async function _0x22d658(){const _0x4a8438=_0x2b1222,_0xc422d8=new Map();let _0x165b58=null;if(lastPrivateMessagesSent[_0x4a8438(0x58a)]>0x0){console[_0x4a8438(0x57e)](_0x4a8438(0x103f)+lastPrivateMessagesSent['length']+'\x20条上一轮发送的私信...');const _0x4771b8=[...lastPrivateMessagesSent];_0x165b58=_0x4771b8[_0x4a8438(0x753)]();const _0x28e219=[...new Set(_0x4771b8[_0x4a8438(0x1431)](_0x350d35=>_0x350d35['chatId']))];for(const _0x7688f2 of _0x28e219){const _0x315f24=await _0x3df81a[_0x4a8438(0x589)][_0x4a8438(0x13f8)](_0x7688f2);_0x315f24&&_0xc422d8[_0x4a8438(0x3d3)](_0x7688f2,_0x315f24);}for(const _0x496848 of _0x4771b8){const _0x12b01c=_0xc422d8[_0x4a8438(0x13f8)](_0x496848[_0x4a8438(0x3e0)]);_0x12b01c&&(_0x12b01c['history']=_0x12b01c[_0x4a8438(0xce3)]['filter'](_0x1ac6e6=>_0x1ac6e6['timestamp']!==_0x496848['timestamp']));}_0xc422d8[_0x4a8438(0xb51)]>0x0&&await _0x3df81a[_0x4a8438(0x589)][_0x4a8438(0x8b2)](Array[_0x4a8438(0xa81)](_0xc422d8['values']())),lastPrivateMessagesSent=[];}const _0x31cdea=_0x1ae02e['chats'][_0x1ae02e[_0x4a8438(0x588)]];if(!_0x31cdea)return;const _0x6ee15b=document[_0x4a8438(0x1f4)](_0x4a8438(0x66c)),_0x50efe9=_0x6ee15b['querySelectorAll']('textarea'),_0x1c2928=Array[_0x4a8438(0xa81)](_0x50efe9)['map'](_0x3663ef=>_0x3663ef[_0x4a8438(0x107e)][_0x4a8438(0x4a2)]())[_0x4a8438(0xede)](Boolean),_0x5c83aa=_0x31cdea[_0x4a8438(0xce3)]['filter'](_0xf7a601=>lastResponseTimestamps[_0x4a8438(0xe82)](_0xf7a601[_0x4a8438(0x1388)]));_0x31cdea['history']=_0x31cdea['history'][_0x4a8438(0xede)](_0x4c0206=>!lastResponseTimestamps['includes'](_0x4c0206['timestamp']));if(_0x1c2928['length']===0x0){await _0x3df81a[_0x4a8438(0x589)]['put'](_0x31cdea),_0x3689f0(_0x1ae02e[_0x4a8438(0x588)]),_0x1033ae(),document[_0x4a8438(0x1f4)]('ai-response-editor-modal')['classList']['remove'](_0x4a8438(0xfca)),lastRawAiResponse='',lastResponseTimestamps=[];return;}let _0x50566a=[];for(const _0x3af0bd of _0x1c2928){try{const _0x3b2cec=JSON[_0x4a8438(0x129c)](_0x3af0bd);_0x50566a[_0x4a8438(0x1426)](_0x3b2cec);}catch(_0x17e0c9){console['warn'](_0x4a8438(0x4d1),_0x3af0bd);}}const _0x2e4ce6=_0x5c83aa['filter'](_0x1851d6=>_0x1851d6['type']===_0x4a8438(0x132a));let _0x35d688=0x0,_0x13c670=[],_0x472995=Date[_0x4a8438(0xd6e)]();const _0x255e24=new Map();for(const _0x18ea63 of _0x50566a){if(!_0x18ea63||typeof _0x18ea63!==_0x4a8438(0xcc5)||!_0x18ea63['type']){console['warn']('在导演模式保存时，发现无效的指令对象，已跳过:',_0x18ea63);continue;}let _0x153461=null;const _0x37ecfd={'role':'assistant','senderName':_0x18ea63[_0x4a8438(0x5d2)]||_0x31cdea[_0x4a8438(0x96f)],'timestamp':_0x472995++};switch(_0x18ea63[_0x4a8438(0xcbd)]){case _0x4a8438(0x42d):{const _0x513492=_0x18ea63[_0x4a8438(0x5d2)],_0x5f29ff=_0x18ea63[_0x4a8438(0x515)],_0x261ffd=_0x1ae02e[_0x4a8438(0x11ef)][_0x4a8438(0xb46)]||_0x4a8438(0xee7);if(_0x5f29ff===_0x261ffd){const _0x8b7217=Object[_0x4a8438(0x753)](_0x1ae02e['chats'])['find'](_0x466815=>!_0x466815['isGroup']&&_0x466815[_0x4a8438(0x96f)]===_0x513492);if(_0x8b7217){if(!_0x255e24[_0x4a8438(0xe75)](_0x8b7217['id'])){const _0x14b2fe=_0xc422d8[_0x4a8438(0x13f8)](_0x8b7217['id'])||await _0x3df81a[_0x4a8438(0x589)]['get'](_0x8b7217['id']);_0x255e24[_0x4a8438(0x3d3)](_0x8b7217['id'],_0x14b2fe);}const _0x5f5cba=_0x255e24[_0x4a8438(0x13f8)](_0x8b7217['id']),_0x4fdc21=Array[_0x4a8438(0x121f)](_0x18ea63[_0x4a8438(0x128c)])?_0x18ea63['content']:[_0x18ea63['content']];let _0x1d5f47=0x0;for(const _0xf99d92 of _0x4fdc21){if(!_0xf99d92||!_0xf99d92[_0x4a8438(0x4a2)]())continue;const _0xdf213a=_0x165b58?_0x165b58['next']()[_0x4a8438(0x107e)]:null,_0x51e43a=_0xdf213a&&_0xdf213a[_0x4a8438(0x3e0)]===_0x8b7217['id']?_0xdf213a[_0x4a8438(0x1388)]:_0x472995++,_0x83f791={'role':_0x4a8438(0x13c0),'senderName':_0x513492,'content':_0xf99d92,'timestamp':_0x51e43a};lastPrivateMessagesSent[_0x4a8438(0x1426)]({'chatId':_0x8b7217['id'],'timestamp':_0x83f791[_0x4a8438(0x1388)]}),_0x5f5cba[_0x4a8438(0xce3)][_0x4a8438(0x1426)](_0x83f791),_0x1d5f47++;}_0x1d5f47>0x0&&(_0x1ae02e[_0x4a8438(0x588)]!==_0x8b7217['id']&&(_0x5f5cba['unreadCount']=(_0x5f5cba[_0x4a8438(0xf2c)]||0x0)+_0x1d5f47,_0x158e58(_0x8b7217['id'],_0x8b7217[_0x4a8438(0x5d2)]+_0x4a8438(0x7d9)+_0x1d5f47+'\x20条新消息'))),_0x153461=null;}else console[_0x4a8438(0xb3b)]('AI\x20'+_0x513492+_0x4a8438(0xd26)),_0x153461=null;}else console['warn'](_0x4a8438(0xea6)+_0x5f29ff+_0x4a8438(0x3a9)),_0x153461=null;continue;}case _0x4a8438(0x2d3):{const _0x3f20a8='[这是你上一轮的内部思考]\x0a-\x20分析:\x20'+(_0x18ea63[_0x4a8438(0xbe2)]||'无')+_0x4a8438(0x7c4)+(_0x18ea63[_0x4a8438(0x94e)]||'无')+_0x4a8438(0x307)+JSON['stringify'](_0x18ea63['character_thoughts']||{}),_0x457c59={'role':_0x4a8438(0x1594),'content':_0x3f20a8,'timestamp':_0x472995++,'isHidden':!![]};_0x31cdea[_0x4a8438(0xce3)][_0x4a8438(0x1426)](_0x457c59),_0x13c670[_0x4a8438(0x1426)](_0x457c59[_0x4a8438(0x1388)]);continue;}case _0x4a8438(0x40f):_0x153461={..._0x37ecfd,'content':String(_0x18ea63['content']||_0x18ea63['message'])};break;case _0x4a8438(0x1b3):{let _0x16c412=![];if(_0x18ea63[_0x4a8438(0x258)]&&_0x18ea63[_0x4a8438(0x339)])_0x153461={..._0x37ecfd,'type':_0x4a8438(0x1b3),'content':_0x18ea63[_0x4a8438(0x258)],'meaning':_0x18ea63[_0x4a8438(0x339)]},_0x16c412=!![];else{if(_0x18ea63['meaning']){const _0x350416=_0x1ae02e['userStickers'][_0x4a8438(0x13b7)](_0x4ffe15=>_0x4ffe15[_0x4a8438(0x5d2)]===_0x18ea63['meaning']);_0x350416?(_0x153461={..._0x37ecfd,'type':_0x4a8438(0x1b3),'content':_0x350416[_0x4a8438(0x258)],'meaning':_0x350416[_0x4a8438(0x5d2)]},_0x16c412=!![]):(_0x153461={..._0x37ecfd,'type':'text','content':_0x4a8438(0xe39)+_0x18ea63['meaning']+']'},_0x16c412=!![]);}else{if(_0x18ea63[_0x4a8438(0x258)]){_0x153461={..._0x37ecfd,'type':_0x4a8438(0x1b3),'content':_0x18ea63[_0x4a8438(0x258)]};const _0x591fcb=_0x1ae02e[_0x4a8438(0x1420)][_0x4a8438(0x13b7)](_0x4e324b=>_0x4e324b[_0x4a8438(0x258)]===_0x18ea63[_0x4a8438(0x258)]);_0x153461[_0x4a8438(0x339)]=_0x591fcb?_0x591fcb['name']:_0x4a8438(0x12bc),_0x16c412=!![];}else{if(_0x18ea63[_0x4a8438(0x128c)]&&typeof _0x18ea63[_0x4a8438(0x128c)]===_0x4a8438(0x6c3)&&_0x43460a[_0x4a8438(0x60b)](_0x18ea63['content'])){_0x153461={..._0x37ecfd,'type':_0x4a8438(0x1b3),'content':_0x18ea63['content']};const _0x32d46a=_0x1ae02e[_0x4a8438(0x1420)][_0x4a8438(0x13b7)](_0x1f1219=>_0x1f1219[_0x4a8438(0x258)]===_0x18ea63[_0x4a8438(0x128c)]);_0x153461[_0x4a8438(0x339)]=_0x32d46a?_0x32d46a[_0x4a8438(0x5d2)]:_0x4a8438(0x12bc),_0x16c412=!![];}}}}if(!_0x16c412){console[_0x4a8438(0x127d)](_0x4a8438(0x92f),_0x18ea63);continue;}break;}case _0x4a8438(0xce9):_0x153461={..._0x37ecfd,'type':_0x4a8438(0xce9),'content':_0x18ea63['description'],'image_prompt':_0x18ea63[_0x4a8438(0x1248)]};break;case _0x4a8438(0x132a):{const _0x585cb7=_0x18ea63[_0x4a8438(0x1063)];let _0x5715b3=null,_0x155236=null;const _0x13e705=_0x2e4ce6[_0x35d688];_0x35d688++;let _0x542774=![];if(_0x13e705){const _0x17a734=_0x13e705[_0x4a8438(0x1063)];_0x585cb7&&_0x585cb7!==_0x17a734?(console[_0x4a8438(0x57e)](_0x4a8438(0x741)),_0x542774=!![]):(console[_0x4a8438(0x57e)](_0x4a8438(0x1008)),_0x5715b3=_0x13e705['imageUrl'],_0x155236=_0x13e705[_0x4a8438(0x936)]);}else console[_0x4a8438(0x57e)](_0x4a8438(0x179)),_0x542774=!![];if(_0x542774){const _0x1eba7b=_0x13e705?'检测到NAI提示词已修改，正在重新生成...':_0x4a8438(0xe06);await _0x1460c5(_0x4a8438(0x11b7),_0x1eba7b);try{const _0x1ccd5d=await _0x930e42(_0x585cb7,_0x31cdea['id']);_0x5715b3=_0x1ccd5d['imageUrl'],_0x155236=_0x1ccd5d[_0x4a8438(0x936)],await _0x1460c5('成功','图片已生成！');}catch(_0x576269){console['error'](_0x4a8438(0x432),_0x576269),await _0x1460c5(_0x4a8438(0x108a),'无法生成图片:\x20'+_0x576269[_0x4a8438(0x11f0)]+'.\x20\x0a\x0a将保留旧图片（如果存在）。');if(_0x13e705)_0x5715b3=_0x13e705[_0x4a8438(0x48d)],_0x155236=_0x13e705[_0x4a8438(0x936)];else{console['error'](_0x4a8438(0xd24));continue;}}}_0x153461={..._0x37ecfd,'type':'naiimag','imageUrl':_0x5715b3,'prompt':_0x585cb7,'fullPrompt':_0x155236};break;}case'voice_message':_0x153461={..._0x37ecfd,'type':_0x4a8438(0xd83),'content':_0x18ea63['content']};break;case _0x4a8438(0x904):_0x153461={..._0x37ecfd,'type':_0x4a8438(0x904),'amount':_0x18ea63[_0x4a8438(0x618)],'note':_0x18ea63[_0x4a8438(0x10c2)],'receiverName':_0x18ea63[_0x4a8438(0xe7f)]||'我'};break;case _0x4a8438(0x4a4):_0x153461={..._0x37ecfd,'type':_0x4a8438(0x4a4),'productInfo':_0x18ea63[_0x4a8438(0xbf5)],'amount':_0x18ea63[_0x4a8438(0x618)],'status':_0x4a8438(0x630),'countdownEndTime':Date[_0x4a8438(0xd6e)]()+0xf*0x3c*0x3e8};break;case _0x4a8438(0x439):_0x153461={..._0x37ecfd,..._0x18ea63};break;case _0x4a8438(0xe38):{const _0x16ff1b=_0x5aea9a[_0x31cdea['id']];if(_0x16ff1b){const _0x29b470=_0x16ff1b[_0x4a8438(0xce3)]['findLastIndex'](_0x19111a=>_0x19111a[_0x4a8438(0x13a7)]===0x2);if(_0x29b470>-0x1){const _0x484bdb=_0x16ff1b['history'][_0x29b470];_0x16ff1b[_0x4a8438(0x870)][_0x484bdb['y']][_0x484bdb['x']]=0x0,_0x16ff1b['history']['splice'](_0x29b470,0x1),console[_0x4a8438(0x57e)]('导演模式悔棋：已撤销AI在\x20('+_0x484bdb['x']+',\x20'+_0x484bdb['y']+')\x20的棋步。');}}const _0x3a478b=parseInt(_0x18ea63['x']),_0x3c8360=parseInt(_0x18ea63['y']);!isNaN(_0x3a478b)&&!isNaN(_0x3c8360)?_0x35b05e({'x':_0x3a478b,'y':_0x3c8360},!![]):console['warn'](_0x4a8438(0x961),_0x18ea63);continue;}case _0x4a8438(0x46b):{if(!_0x31cdea[_0x4a8438(0xe83)]){if(_0x18ea63['heartfelt_voice'])_0x31cdea[_0x4a8438(0xbae)]=String(_0x18ea63['heartfelt_voice']);if(_0x18ea63[_0x4a8438(0x2ba)])_0x31cdea[_0x4a8438(0x3d2)]=String(_0x18ea63[_0x4a8438(0x2ba)]);if(!Array['isArray'](_0x31cdea[_0x4a8438(0xc34)]))_0x31cdea[_0x4a8438(0xc34)]=[];_0x31cdea[_0x4a8438(0xc34)][_0x4a8438(0x1426)]({'heartfeltVoice':_0x31cdea[_0x4a8438(0xbae)],'randomJottings':_0x31cdea[_0x4a8438(0x3d2)],'timestamp':Date['now']()});if(_0x31cdea[_0x4a8438(0xc34)][_0x4a8438(0x58a)]>0x32)_0x31cdea['thoughtsHistory']['shift']();}continue;}case'quote_reply':{const _0x564eee=_0x31cdea[_0x4a8438(0xce3)][_0x4a8438(0x13b7)](_0x4f39d2=>_0x4f39d2[_0x4a8438(0x1388)]===_0x18ea63['target_timestamp']);let _0x27066a=null;if(_0x564eee){let _0xdc38db=_0x564eee[_0x4a8438(0xfb7)];_0x564eee[_0x4a8438(0xfbb)]==='user'&&(_0xdc38db=_0x31cdea[_0x4a8438(0xe83)]?_0x31cdea[_0x4a8438(0x6a8)]['myNickname']||'我':_0x1ae02e[_0x4a8438(0x11ef)]['nickname']||_0x4a8438(0xee7)),_0x27066a={'timestamp':_0x18ea63[_0x4a8438(0x3d8)],'senderName':_0xdc38db,'content':String(_0x564eee[_0x4a8438(0x128c)]||'')};}else _0x27066a={'timestamp':_0x18ea63[_0x4a8438(0x3d8)],'senderName':_0x4a8438(0x10b3),'content':_0x4a8438(0x2db)};_0x153461={..._0x37ecfd,'content':_0x18ea63[_0x4a8438(0x976)],'quote':_0x27066a};break;}default:console[_0x4a8438(0xb3b)](_0x4a8438(0x127e),_0x18ea63['type'],_0x18ea63);if(_0x18ea63[_0x4a8438(0x128c)])_0x153461={..._0x37ecfd,'content':String(_0x18ea63[_0x4a8438(0x128c)])};else continue;break;}_0x153461&&(_0x31cdea[_0x4a8438(0xce3)][_0x4a8438(0x1426)](_0x153461),_0x13c670[_0x4a8438(0x1426)](_0x153461[_0x4a8438(0x1388)]));}await _0x3df81a[_0x4a8438(0x589)][_0x4a8438(0x295)](_0x31cdea),_0x255e24[_0x4a8438(0xb51)]>0x0&&await _0x3df81a[_0x4a8438(0x589)][_0x4a8438(0x8b2)](Array[_0x4a8438(0xa81)](_0x255e24['values']())),_0x3689f0(_0x1ae02e['activeChatId']),_0x1033ae(),document[_0x4a8438(0x1f4)](_0x4a8438(0xbc2))[_0x4a8438(0x159b)][_0x4a8438(0xa9c)](_0x4a8438(0xfca)),lastRawAiResponse=_0x1c2928[_0x4a8438(0x1143)]('\x0a\x0a'),lastResponseTimestamps=_0x13c670,await _0x1460c5(_0x4a8438(0x1043),_0x4a8438(0x1241));}async function _0x417baa(){const _0x139d78=_0x2b1222;if(!_0x3c0c35)return;const _0x53b43f=0x2*0x3c*0x3e8,_0x286a08=_0x3c0c35,_0xc7561e=Date['now']();if(_0xc7561e-_0x286a08>_0x53b43f){_0x22a0ab(),await _0x1460c5('操作失败',_0x139d78(0x1253));return;}await _0x1bbf9c(_0x286a08,!![]),_0x22a0ab();}async function _0x1bbf9c(_0x20e307,_0x5853a3){const _0x4844c5=_0x2b1222,_0x464dff=_0x1ae02e['chats'][_0x1ae02e[_0x4844c5(0x588)]];if(!_0x464dff)return;const _0x11021b=_0x464dff[_0x4844c5(0xce3)][_0x4844c5(0xf2d)](_0x4503f0=>_0x4503f0[_0x4844c5(0x1388)]===_0x20e307);if(_0x11021b===-0x1)return;const _0x3aab2d=_0x464dff[_0x4844c5(0xce3)][_0x11021b],_0x2ce476={'originalType':_0x3aab2d[_0x4844c5(0xcbd)]||_0x4844c5(0x40f),'originalContent':_0x3aab2d[_0x4844c5(0x128c)],'originalMeaning':_0x3aab2d['meaning'],'originalQuote':_0x3aab2d[_0x4844c5(0xadf)]};_0x3aab2d['type']='recalled_message',_0x3aab2d[_0x4844c5(0x128c)]=_0x5853a3?'你撤回了一条消息':'对方撤回了一条消息',_0x3aab2d[_0x4844c5(0x849)]=_0x2ce476,delete _0x3aab2d[_0x4844c5(0x339)],delete _0x3aab2d[_0x4844c5(0xadf)];if(_0x5853a3){const _0x4f2ba1=_0x464dff[_0x4844c5(0xe83)]?_0x464dff[_0x4844c5(0x6a8)][_0x4844c5(0xe31)]||'我':'我';let _0x470e76='';if(_0x2ce476[_0x4844c5(0xf8c)]===_0x4844c5(0x1b3))_0x470e76=_0x4844c5(0xf3a)+(_0x2ce476[_0x4844c5(0x9f1)]||'未知')+']';else _0x2ce476[_0x4844c5(0xf8c)]===_0x4844c5(0xce9)||_0x2ce476[_0x4844c5(0xf8c)]===_0x4844c5(0xe86)?_0x470e76=_0x4844c5(0x61a)+_0x2ce476[_0x4844c5(0xb2f)]+']':_0x470e76='“'+String(_0x2ce476[_0x4844c5(0xb2f)])+'”';const _0x3d62b8={'role':_0x4844c5(0x1594),'content':_0x4844c5(0xcd3)+_0x4f2ba1+_0x4844c5(0x6b8)+_0x470e76+_0x4844c5(0x45f),'timestamp':Date['now'](),'isHidden':!![]};_0x464dff[_0x4844c5(0xce3)][_0x4844c5(0x1426)](_0x3d62b8);}await _0x3df81a[_0x4844c5(0x589)][_0x4844c5(0x295)](_0x464dff),_0x3689f0(_0x1ae02e['activeChatId']),_0x5853a3&&(_0x1033ae(),_0x5626da());}async function _0x23bc2e(){const _0x1e3791=_0x2b1222;await _0x574c35(),document[_0x1e3791(0x1f4)]('world-book-category-manager-modal')['classList'][_0x1e3791(0x6a4)](_0x1e3791(0xfca));}async function _0x574c35(){const _0x2f059e=_0x2b1222,_0x47b402=document['getElementById'](_0x2f059e(0xb6c)),_0x7999d8=await _0x3df81a[_0x2f059e(0xde3)][_0x2f059e(0x27a)]();_0x47b402[_0x2f059e(0xf21)]='',_0x7999d8[_0x2f059e(0x58a)]===0x0&&(_0x47b402[_0x2f059e(0xf21)]='<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-secondary);\x22>还没有任何分类</p>'),_0x7999d8[_0x2f059e(0x59b)](_0x7851fa=>{const _0x15372c=_0x2f059e,_0x594b38=document[_0x15372c(0x219)](_0x15372c(0xaf9));_0x594b38['className']='existing-group-item',_0x594b38[_0x15372c(0xf21)]=_0x15372c(0xf67)+_0x7851fa[_0x15372c(0x5d2)]+_0x15372c(0x327)+_0x7851fa['id']+_0x15372c(0x837),_0x47b402[_0x15372c(0x6ce)](_0x594b38);});}async function _0x59b9af(){const _0x3bc0fb=_0x2b1222,_0x26a2d0=document['getElementById'](_0x3bc0fb(0x14ba)),_0x193939=_0x26a2d0[_0x3bc0fb(0x107e)]['trim']();if(!_0x193939){alert(_0x3bc0fb(0xc11));return;}const _0x1f6948=await _0x3df81a[_0x3bc0fb(0xde3)]['where'](_0x3bc0fb(0x5d2))[_0x3bc0fb(0x49d)](_0x193939)['first']();if(_0x1f6948){alert('分类\x20\x22'+_0x193939+_0x3bc0fb(0xf6a));return;}await _0x3df81a[_0x3bc0fb(0xde3)][_0x3bc0fb(0x6a4)]({'name':_0x193939}),_0x26a2d0[_0x3bc0fb(0x107e)]='',await _0x574c35();}async function _0x209650(_0xdf30e9){const _0x3a45c0=_0x2b1222,_0x454135=await _0x109970(_0x3a45c0(0xed1),_0x3a45c0(0x776),{'confirmButtonClass':_0x3a45c0(0x1c6)});if(_0x454135){await _0x3df81a[_0x3a45c0(0xde3)][_0x3a45c0(0xc40)](_0xdf30e9);const _0x3e8c2d=await _0x3df81a[_0x3a45c0(0x1453)][_0x3a45c0(0x478)](_0x3a45c0(0x1467))[_0x3a45c0(0x49d)](_0xdf30e9)['toArray']();for(const _0x5ec1dc of _0x3e8c2d){_0x5ec1dc[_0x3a45c0(0x1467)]=null,await _0x3df81a[_0x3a45c0(0x1453)][_0x3a45c0(0x295)](_0x5ec1dc);const _0x5399fe=_0x1ae02e[_0x3a45c0(0x1453)][_0x3a45c0(0x13b7)](_0xf47123=>_0xf47123['id']===_0x5ec1dc['id']);if(_0x5399fe)_0x5399fe['categoryId']=null;}await _0x574c35();}}async function _0x497f93(){const _0x2c3122=_0x2b1222;if(!_0x3c0c35)return;const _0x470f35=_0x3c0c35;_0x22a0ab();const _0x5b8471=_0x1ae02e[_0x2c3122(0x589)][_0x1ae02e['activeChatId']],_0x13bd41=_0x5b8471[_0x2c3122(0xce3)]['find'](_0x2446f2=>_0x2446f2[_0x2c3122(0x1388)]===_0x470f35);if(!_0x13bd41)return;let _0x428e9e=String(_0x13bd41[_0x2c3122(0x128c)]||'')[_0x2c3122(0x516)](0x0,0x32)+_0x2c3122(0x629);if(_0x13bd41[_0x2c3122(0xcbd)]==='ai_image')_0x428e9e=_0x2c3122(0xada)+_0x428e9e;const _0x1a3566=await _0x109970(_0x2c3122(0x11b8),'确定要将以下消息发布到公告板吗？\x0a\x0a“'+_0x428e9e+'”',{'confirmText':'确定发布'});if(_0x1a3566){const _0x649685=_0x5b8471[_0x2c3122(0x6a8)]['myNickname']||'我';!Array[_0x2c3122(0x121f)](_0x5b8471[_0x2c3122(0x5ab)])&&(_0x5b8471[_0x2c3122(0x5ab)]=[]);const _0x617026={'id':_0x2c3122(0x1065)+Date[_0x2c3122(0xd6e)](),'messageTimestamp':_0x470f35,'publisher':_0x649685,'publishedAt':Date[_0x2c3122(0xd6e)](),'isPinned':![]};_0x5b8471[_0x2c3122(0x5ab)][_0x2c3122(0x1426)](_0x617026);const _0x31c9c1={'role':_0x2c3122(0x1594),'type':_0x2c3122(0x1454),'content':_0x649685+_0x2c3122(0x4df),'timestamp':Date[_0x2c3122(0xd6e)]()};_0x5b8471[_0x2c3122(0xce3)]['push'](_0x31c9c1),await _0x3df81a[_0x2c3122(0x589)][_0x2c3122(0x295)](_0x5b8471),_0x5286f1(_0x31c9c1,_0x5b8471),_0x1033ae(),await _0x1460c5('成功',_0x2c3122(0x103e));}}async function _0x2404ac(){const _0x42aa23=_0x2b1222,_0x44ee71=_0x1ae02e['chats'][_0x1ae02e[_0x42aa23(0x588)]],_0x38421e=_0x44ee71[_0x42aa23(0x5ab)]||[];if(!_0x44ee71||_0x38421e[_0x42aa23(0x58a)]===0x0){_0x1460c5('提示',_0x42aa23(0x6a1));return;}const _0xfaeed=document[_0x42aa23(0x1f4)](_0x42aa23(0x638));_0xfaeed[_0x42aa23(0xf21)]='',_0x38421e[_0x42aa23(0x74e)]((_0x167e02,_0x56f02c)=>(_0x56f02c[_0x42aa23(0x6e3)]?0x1:0x0)-(_0x167e02[_0x42aa23(0x6e3)]?0x1:0x0));for(const _0x3f94ac of _0x38421e){const _0x55348a=_0x44ee71[_0x42aa23(0xce3)][_0x42aa23(0x13b7)](_0x11c314=>_0x11c314[_0x42aa23(0x1388)]===_0x3f94ac[_0x42aa23(0x140c)]),_0x8f8f45=document['createElement'](_0x42aa23(0xaf9));_0x8f8f45['className']=_0x42aa23(0x8ba);if(_0x55348a){const _0xd4142a=await _0x1c1dfa(_0x55348a,_0x44ee71);_0xd4142a&&_0x8f8f45[_0x42aa23(0x6ce)](_0xd4142a);}else _0x8f8f45['innerHTML']=_0x42aa23(0x1af);_0x3f94ac['isPinned']&&(_0x8f8f45[_0x42aa23(0xf21)]+=_0x42aa23(0x1003)),_0x8f8f45[_0x42aa23(0xf21)]+=_0x42aa23(0x1425)+_0x3f94ac['id']+'\x22>...</div>',_0xfaeed[_0x42aa23(0x6ce)](_0x8f8f45);}document[_0x42aa23(0x1f4)](_0x42aa23(0x14ab))['classList'][_0x42aa23(0x6a4)]('visible');}let _0x3d0c20=null;function _0x58b3ab(_0x22e1f6){const _0x11a735=_0x2b1222;_0x3d0c20=_0x22e1f6;const _0x1eda53=_0x1ae02e[_0x11a735(0x589)][_0x1ae02e[_0x11a735(0x588)]],_0x106998=_0x1eda53['announcements']['find'](_0x18b1dd=>_0x18b1dd['id']===_0x22e1f6);if(!_0x106998)return;const _0x53fc4c=document[_0x11a735(0x1f4)](_0x11a735(0x1121));_0x53fc4c[_0x11a735(0x231)]=_0x106998[_0x11a735(0x6e3)]?_0x11a735(0xb28):_0x11a735(0xcd4),document[_0x11a735(0x1f4)]('announcement-actions-modal')['classList']['add'](_0x11a735(0xfca));}async function _0x3cc2fe(){const _0x2afead=_0x2b1222;if(!_0x3d0c20)return;const _0x57c9d8=_0x1ae02e[_0x2afead(0x589)][_0x1ae02e[_0x2afead(0x588)]],_0xb04495=_0x57c9d8[_0x2afead(0x5ab)][_0x2afead(0x13b7)](_0x516472=>_0x516472['id']===_0x3d0c20);_0xb04495&&(_0xb04495[_0x2afead(0x6e3)]=!_0xb04495['isPinned'],await _0x3df81a[_0x2afead(0x589)]['put'](_0x57c9d8),_0x2404ac()),document[_0x2afead(0x1f4)](_0x2afead(0x1244))['classList'][_0x2afead(0xa9c)]('visible');}async function _0x4dda73(){const _0x1f402f=_0x2b1222;if(!_0x3d0c20)return;const _0x3485ad=await _0x109970(_0x1f402f(0xed1),'确定要删除这条公告吗？此操作不可恢复。',{'confirmButtonClass':'btn-danger'});if(_0x3485ad){const _0xc298cb=_0x1ae02e[_0x1f402f(0x589)][_0x1ae02e['activeChatId']];_0xc298cb[_0x1f402f(0x5ab)]=_0xc298cb[_0x1f402f(0x5ab)][_0x1f402f(0xede)](_0x5f3173=>_0x5f3173['id']!==_0x3d0c20),await _0x3df81a[_0x1f402f(0x589)][_0x1f402f(0x295)](_0xc298cb),_0x2404ac();}document[_0x1f402f(0x1f4)](_0x1f402f(0x1244))[_0x1f402f(0x159b)][_0x1f402f(0xa9c)](_0x1f402f(0xfca));}let _0x37b6a9=![],_0x4a1402={'ai':null,'my':null};function _0x50c117(_0x4c0a53=_0x2b1222(0x21a)){const _0x5a9272=_0x2b1222,_0x36ee34=document[_0x5a9272(0x1f4)](_0x5a9272(0x138b));if(!_0x1ae02e[_0x5a9272(0x588)])return;const _0x4b21d3=_0x1ae02e['chats'][_0x1ae02e[_0x5a9272(0x588)]];_0x37b6a9=_0x4c0a53===_0x5a9272(0xc32);if(_0x37b6a9){const _0x4aa3c5=_0x4b21d3[_0x5a9272(0x1402)][_0x5a9272(0x13b7)](_0xcb07cc=>_0xcb07cc['id']===_0x530c3e);if(!_0x4aa3c5)return;_0x4a1402['my']=_0x4aa3c5[_0x5a9272(0x757)]||'',_0x52ef67(!![],_0x4aa3c5['avatar'],_0x4aa3c5['avatarFrame']);}else _0x4a1402['ai']=_0x4b21d3[_0x5a9272(0x6a8)][_0x5a9272(0x94d)]||'',_0x4a1402['my']=_0x4b21d3[_0x5a9272(0x6a8)]['myAvatarFrame']||'',_0x52ef67(![]);_0x36ee34[_0x5a9272(0x159b)][_0x5a9272(0x6a4)](_0x5a9272(0xfca));}function _0x52ef67(_0x13987b=![],_0x217067=null,_0x9dd312=null){const _0x3fc601=_0x2b1222,_0x240049=document[_0x3fc601(0x1f4)](_0x3fc601(0x1552)),_0x4d3959=document[_0x3fc601(0x1f4)]('my-frame-grid'),_0x546b11=_0x1ae02e[_0x3fc601(0x589)][_0x1ae02e[_0x3fc601(0x588)]];_0x240049[_0x3fc601(0xf21)]='',_0x4d3959[_0x3fc601(0xf21)]='',document[_0x3fc601(0xeda)](_0x3fc601(0x1169))[_0x3fc601(0x215)][_0x3fc601(0x887)]=_0x13987b?_0x3fc601(0x1b5):_0x3fc601(0xeba),document[_0x3fc601(0x1f4)]('ai-frame-content')[_0x3fc601(0x215)][_0x3fc601(0x887)]=_0x3fc601(0x361),document[_0x3fc601(0x1f4)](_0x3fc601(0x1e1))[_0x3fc601(0x215)][_0x3fc601(0x887)]=_0x3fc601(0x1b5),document[_0x3fc601(0x1f4)](_0x3fc601(0x2ea))['classList'][_0x3fc601(0x6a4)](_0x3fc601(0x7cf)),document[_0x3fc601(0x1f4)](_0x3fc601(0xe0d))[_0x3fc601(0x159b)][_0x3fc601(0xa9c)](_0x3fc601(0x7cf));if(_0x13987b)_0x5a4e4d[_0x3fc601(0x59b)](_0x281e6a=>{const _0x47e455=_0x3fc601,_0x2e9ee0=_0x1c324b(_0x281e6a,'my',_0x217067);_0x281e6a[_0x47e455(0x258)]===_0x9dd312&&_0x2e9ee0[_0x47e455(0x159b)][_0x47e455(0x6a4)](_0x47e455(0xc3e)),_0x240049['appendChild'](_0x2e9ee0);});else{const _0x3d5fd5=_0x546b11['settings'][_0x3fc601(0xc99)]||_0x5494d0,_0x952ff0=_0x546b11['settings']['myAvatar']||(_0x546b11[_0x3fc601(0xe83)]?_0x203a38:_0x5494d0);_0x5a4e4d[_0x3fc601(0x59b)](_0x5b63bf=>{const _0x171dc8=_0x3fc601,_0x2ef2ad=_0x1c324b(_0x5b63bf,'ai',_0x3d5fd5);if(_0x5b63bf['url']===_0x4a1402['ai'])_0x2ef2ad[_0x171dc8(0x159b)]['add'](_0x171dc8(0xc3e));_0x240049[_0x171dc8(0x6ce)](_0x2ef2ad);const _0x501f11=_0x1c324b(_0x5b63bf,'my',_0x952ff0);if(_0x5b63bf[_0x171dc8(0x258)]===_0x4a1402['my'])_0x501f11['classList']['add']('selected');_0x4d3959[_0x171dc8(0x6ce)](_0x501f11);});}}function _0x1c324b(_0x53e06f,_0x2e2777,_0x3c4e72){const _0x570f37=_0x2b1222,_0x578f5d=document[_0x570f37(0x219)]('div');return _0x578f5d[_0x570f37(0x7c6)]='frame-item',_0x578f5d[_0x570f37(0x746)]['frameUrl']=_0x53e06f['url'],_0x578f5d[_0x570f37(0x156f)]=_0x53e06f[_0x570f37(0x5d2)],_0x578f5d[_0x570f37(0xf21)]=_0x570f37(0x960)+_0x3c4e72+_0x570f37(0x12e8)+(_0x53e06f[_0x570f37(0x258)]?'<img\x20src=\x22'+_0x53e06f[_0x570f37(0x258)]+_0x570f37(0x145e):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x578f5d[_0x570f37(0x122b)](_0x570f37(0x740),()=>{const _0x5826f8=_0x570f37;_0x4a1402[_0x2e2777]=_0x53e06f[_0x5826f8(0x258)];const _0x434e12=_0x2e2777==='ai'?document[_0x5826f8(0x1f4)](_0x5826f8(0x1552)):document[_0x5826f8(0x1f4)](_0x5826f8(0x34e));_0x434e12[_0x5826f8(0x14bf)](_0x5826f8(0x761))[_0x5826f8(0x59b)](_0x12afe0=>_0x12afe0[_0x5826f8(0x159b)][_0x5826f8(0xa9c)](_0x5826f8(0xc3e))),_0x578f5d[_0x5826f8(0x159b)][_0x5826f8(0x6a4)](_0x5826f8(0xc3e));}),_0x578f5d;}async function _0x530f25(){const _0x295250=_0x2b1222;if(!_0x1ae02e[_0x295250(0x588)])return;const _0x497c9b=_0x1ae02e[_0x295250(0x589)][_0x1ae02e[_0x295250(0x588)]];if(_0x37b6a9){const _0x459e7=_0x497c9b[_0x295250(0x1402)]['find'](_0x14d80c=>_0x14d80c['id']===_0x530c3e);_0x459e7&&(_0x459e7[_0x295250(0x757)]=_0x4a1402['my']);}else _0x497c9b[_0x295250(0x6a8)][_0x295250(0x94d)]=_0x4a1402['ai'],_0x497c9b[_0x295250(0x6a8)]['myAvatarFrame']=_0x4a1402['my'];await _0x3df81a[_0x295250(0x589)][_0x295250(0x295)](_0x497c9b);if(!_0x37b6a9&&!_0x497c9b['isGroup']){const _0x41c78e=_0x497c9b['id'];for(const _0x20c7c5 of Object[_0x295250(0x753)](_0x1ae02e[_0x295250(0x589)])){if(_0x20c7c5[_0x295250(0xe83)]&&_0x20c7c5['members']){const _0x2bf0a0=_0x20c7c5[_0x295250(0x1402)][_0x295250(0x13b7)](_0x56ea0c=>_0x56ea0c['id']===_0x41c78e);_0x2bf0a0&&(_0x2bf0a0['avatarFrame']=_0x497c9b[_0x295250(0x6a8)][_0x295250(0x94d)],await _0x3df81a[_0x295250(0x589)][_0x295250(0x295)](_0x20c7c5),console[_0x295250(0x57e)](_0x295250(0x31a)+_0x41c78e+_0x295250(0xae5)+_0x20c7c5['name']+'\x22'));}}}document[_0x295250(0x1f4)](_0x295250(0x138b))[_0x295250(0x159b)]['remove'](_0x295250(0xfca)),_0x3689f0(_0x1ae02e[_0x295250(0x588)]),alert('头像框已保存并同步！'),_0x37b6a9=![];}function _0x5ac074(){const _0x4399c2=_0x2b1222;_0x41d472=!_0x41d472;const _0x4f6b99=document[_0x4399c2(0x1f4)](_0x4399c2(0x440)),_0x1159ce=document[_0x4399c2(0x1f4)](_0x4399c2(0x781)),_0x521b0f=document[_0x4399c2(0x1f4)](_0x4399c2(0x1391));document[_0x4399c2(0x14bf)](_0x4399c2(0x1006))[_0x4399c2(0x59b)](_0xd32011=>{const _0x194cf9=_0x4399c2;_0xd32011[_0x194cf9(0x159b)][_0x194cf9(0x1483)]('management-mode',_0x41d472);}),_0x41d472?(_0x4f6b99[_0x4399c2(0x231)]='完成',_0x1159ce[_0x4399c2(0x215)][_0x4399c2(0x887)]=_0x4399c2(0xeba),_0x578a04['clear'](),_0x521b0f[_0x4399c2(0xe56)]=![],_0x2f953b()):(_0x4f6b99[_0x4399c2(0x231)]='管理',_0x1159ce[_0x4399c2(0x215)][_0x4399c2(0x887)]=_0x4399c2(0x1b5),document[_0x4399c2(0x14bf)]('.frame-item.selected')[_0x4399c2(0x59b)](_0xc26303=>{const _0x1b32e1=_0x4399c2;_0xc26303['classList']['remove'](_0x1b32e1(0xc3e));}));}function _0x2f953b(){const _0x1338bd=_0x2b1222,_0xb5a2e4=document['getElementById'](_0x1338bd(0x5c8));_0xb5a2e4['textContent']=_0x1338bd(0x408)+_0x578a04[_0x1338bd(0xb51)]+')';}function _0x4584cb(){const _0x2a63a8=_0x2b1222,_0x163c34=document[_0x2a63a8(0x1f4)]('select-all-frames-checkbox')[_0x2a63a8(0xe56)],_0x3908c9=document[_0x2a63a8(0xeda)](_0x2a63a8(0x97a));if(!_0x3908c9)return;_0x3908c9[_0x2a63a8(0x14bf)](_0x2a63a8(0xf74))[_0x2a63a8(0x59b)](_0x1dc9a0=>{const _0x474267=_0x2a63a8,_0xaf2e9=parseInt(_0x1dc9a0[_0x474267(0xeda)](_0x474267(0x6c8))[_0x474267(0x746)]['id']);if(isNaN(_0xaf2e9))return;_0x1dc9a0[_0x474267(0x159b)][_0x474267(0x1483)](_0x474267(0xc3e),_0x163c34),_0x163c34?_0x578a04['add'](_0xaf2e9):_0x578a04[_0x474267(0xc40)](_0xaf2e9);}),_0x2f953b();}async function _0x24fb63(){const _0x5e8b42=_0x2b1222;if(_0x578a04[_0x5e8b42(0xb51)]===0x0)return;const _0x112ef3=await _0x109970(_0x5e8b42(0xed1),_0x5e8b42(0x1145)+_0x578a04[_0x5e8b42(0xb51)]+'\x20个自定义头像框吗？',{'confirmButtonClass':_0x5e8b42(0x1c6)});if(_0x112ef3){const _0x1bd656=[..._0x578a04];await _0x3df81a[_0x5e8b42(0x1434)][_0x5e8b42(0xab7)](_0x1bd656),_0x5ac074(),_0x52ef67(_0x37b6a9),await _0x1460c5(_0x5e8b42(0xfed),_0x5e8b42(0x60d));}}function _0x1807b6(_0x414dbb){const _0xfca232=_0x2b1222,_0x25ba54=document['getElementById'](_0xfca232(0x13a1));_0x25ba54&&(_0x25ba54[_0xfca232(0xf21)]=_0x414dbb||'');}async function _0x513460(_0x1da5f5){const _0x8a75bc=_0x2b1222;if(!_0x5419de[_0x8a75bc(0xd51)]||!_0x5419de[_0x8a75bc(0x588)])return;const _0x2a1a87=_0x1ae02e[_0x8a75bc(0x589)][_0x5419de['activeChatId']];if(!_0x2a1a87)return;const _0x493e63=_0x2a1a87[_0x8a75bc(0xe83)]?_0x2a1a87[_0x8a75bc(0x6a8)][_0x8a75bc(0xe31)]||'我':'我',_0x58c74e='[系统提示：用户\x20('+_0x493e63+')\x20'+_0x1da5f5+']',_0xab3a52={'role':'system','content':_0x58c74e,'timestamp':Date[_0x8a75bc(0xd6e)](),'isHidden':!![]};_0x2a1a87[_0x8a75bc(0xce3)]['push'](_0xab3a52),await _0x3df81a[_0x8a75bc(0x589)][_0x8a75bc(0x295)](_0x2a1a87);}async function _0xeecd32(){const _0x35a384=_0x2b1222;if(_0xc320bf[_0x35a384(0xb51)]===0x0)return;const _0x3391ba=_0x1ae02e[_0x35a384(0x589)][_0x1ae02e[_0x35a384(0x588)]];if(!_0x3391ba)return;const _0x997a5d=document[_0x35a384(0x1f4)]('selection-screenshot-btn'),_0x2d1388=_0x997a5d['textContent'];_0x997a5d[_0x35a384(0x231)]=_0x35a384(0xf7f),_0x997a5d[_0x35a384(0xa0d)]=!![];const _0x242489=document['createElement']('div'),_0x46bae9=document[_0x35a384(0x1f4)](_0x35a384(0x296));_0x242489[_0x35a384(0x215)]['width']=_0x46bae9['offsetWidth']+'px',_0x242489[_0x35a384(0x215)][_0x35a384(0x1335)]=_0x35a384(0x13da),_0x242489[_0x35a384(0x215)][_0x35a384(0xe00)]=_0x35a384(0x1251),_0x242489['style'][_0x35a384(0xbe7)]='-9999px',_0x242489['style'][_0x35a384(0x887)]='flex',_0x242489['style'][_0x35a384(0x676)]=_0x35a384(0x1301),_0x242489['style'][_0x35a384(0x1158)]=_0x35a384(0x2aa);const _0x1467b3=document[_0x35a384(0x1f4)](_0x35a384(0x13c3));_0x242489[_0x35a384(0x215)][_0x35a384(0xf98)]=_0x1467b3[_0x35a384(0x215)][_0x35a384(0xf98)],_0x242489['style'][_0x35a384(0x11e7)]=_0x1467b3[_0x35a384(0x215)]['backgroundColor']||(document[_0x35a384(0x1f4)](_0x35a384(0x296))[_0x35a384(0x159b)][_0x35a384(0xaea)](_0x35a384(0xe08))?_0x35a384(0x147e):_0x35a384(0xa9d));const _0x27928b=document[_0x35a384(0x219)](_0x35a384(0x215));_0x27928b[_0x35a384(0xf21)]=_0x35a384(0x1399),document[_0x35a384(0xda4)][_0x35a384(0x6ce)](_0x27928b);try{const _0x360151=_0x1467b3['querySelector'](_0x35a384(0xd0a))[_0x35a384(0xf44)](!![]);_0x360151[_0x35a384(0x159b)]['add'](_0x35a384(0x96c));const _0x2d4ca6=document[_0x35a384(0x219)](_0x35a384(0xaf9)),_0x5b652f=document[_0x35a384(0x1f4)](_0x35a384(0xd31));_0x2d4ca6[_0x35a384(0x215)][_0x35a384(0x887)]='flex',_0x2d4ca6[_0x35a384(0x215)]['flexDirection']='column',_0x2d4ca6[_0x35a384(0x215)][_0x35a384(0xcd7)]=_0x35a384(0x534),_0x2d4ca6[_0x35a384(0x215)][_0x35a384(0x35b)]=_0x35a384(0x651),_0x2d4ca6['style']['width']=_0x35a384(0x10d6),_0x2d4ca6[_0x35a384(0x215)][_0x35a384(0x8d2)]=_0x35a384(0x71c),_0x2d4ca6[_0x35a384(0x746)]['theme']=_0x5b652f[_0x35a384(0x746)]['theme'],_0x2d4ca6['style']['setProperty'](_0x35a384(0x471),_0x5b652f['style'][_0x35a384(0x15b2)]('--chat-font-size'));const _0x572320=_0x1467b3[_0x35a384(0xeda)]('#chat-input-area')[_0x35a384(0xf44)](!![]),_0x43807f=[..._0xc320bf]['sort']((_0xc4aaaf,_0x16a8e8)=>_0xc4aaaf-_0x16a8e8);_0x43807f['forEach'](_0x562775=>{const _0x22a5a0=_0x35a384,_0x30b92f=document['querySelector']('.message-bubble[data-timestamp=\x22'+_0x562775+'\x22]');if(_0x30b92f){const _0x5c5c66=_0x30b92f[_0x22a5a0(0x96a)](_0x22a5a0(0x711));_0x5c5c66&&_0x2d4ca6[_0x22a5a0(0x6ce)](_0x5c5c66[_0x22a5a0(0xf44)](!![]));}}),_0x242489['appendChild'](_0x360151),_0x242489[_0x35a384(0x6ce)](_0x2d4ca6),_0x242489[_0x35a384(0x6ce)](_0x572320),document[_0x35a384(0x8b9)][_0x35a384(0x6ce)](_0x242489);const _0x590dd8=Array[_0x35a384(0xa81)](_0x242489[_0x35a384(0xff7)](_0x35a384(0xecb))),_0x4a48cc=_0x590dd8['map'](_0x1880ed=>new Promise((_0x2bb055,_0x1fc02a)=>{const _0x21c72b=_0x35a384;if(_0x1880ed[_0x21c72b(0x9fe)][_0x21c72b(0xebf)](_0x21c72b(0xd32))){_0x2bb055();return;}const _0xb16c32=new Image();_0xb16c32['crossOrigin']='anonymous',_0xb16c32[_0x21c72b(0xcbe)]=_0x2bb055,_0xb16c32[_0x21c72b(0xdf5)]=_0x2bb055,_0xb16c32[_0x21c72b(0x9fe)]=_0x1880ed[_0x21c72b(0x9fe)];}));await Promise['all'](_0x4a48cc);const _0x4ac169=await html2canvas(_0x242489,{'allowTaint':!![],'useCORS':!![],'backgroundColor':null,'scale':window[_0x35a384(0x48e)]||0x2});_0x4ac169[_0x35a384(0x17d)](function(_0x35c050){const _0x1e33b3=_0x35a384,_0x21e629=URL['createObjectURL'](_0x35c050),_0x4a778f=document[_0x1e33b3(0x219)]('a');_0x4a778f[_0x1e33b3(0x1060)]=_0x1e33b3(0x1c0)+_0x3391ba[_0x1e33b3(0x5d2)]+'-'+Date[_0x1e33b3(0xd6e)]()+'.png',_0x4a778f['href']=_0x21e629,document[_0x1e33b3(0x8b9)][_0x1e33b3(0x6ce)](_0x4a778f),_0x4a778f[_0x1e33b3(0x740)](),document['body']['removeChild'](_0x4a778f),URL['revokeObjectURL'](_0x21e629);},_0x35a384(0xdce));}catch(_0x4c9cc7){console[_0x35a384(0x127d)](_0x35a384(0x22e),_0x4c9cc7),await _0x1460c5('生成失败',_0x35a384(0x1f6));}finally{document[_0x35a384(0x8b9)][_0x35a384(0xdb3)](_0x242489),document[_0x35a384(0xda4)][_0x35a384(0xdb3)](_0x27928b),_0x997a5d[_0x35a384(0x231)]=_0x2d1388,_0x997a5d[_0x35a384(0xa0d)]=![],_0x527427();}}function _0x1ec77d(_0x154f8b){const _0x3ecc5f=_0x2b1222;if(!_0x154f8b||typeof _0x154f8b!==_0x3ecc5f(0x6c3))return'';return _0x154f8b=_0x154f8b[_0x3ecc5f(0xef0)](/!h\{(.*?)\}/g,_0x3ecc5f(0x11f6)),_0x154f8b=_0x154f8b[_0x3ecc5f(0xef0)](/!u\{(.*?)\}/g,'<span\x20class=\x22diary-underline\x22>$1</span>'),_0x154f8b=_0x154f8b[_0x3ecc5f(0xef0)](/!e\{(.*?)\}/g,_0x3ecc5f(0xadc)),_0x154f8b=_0x154f8b[_0x3ecc5f(0xef0)](/!w\{(.*?)\}/g,'<span\x20class=\x22diary-handwritten\x22>$1</span>'),_0x154f8b=_0x154f8b[_0x3ecc5f(0xef0)](/!m\{(.*?)\}/g,_0x3ecc5f(0x114b)),_0x154f8b=_0x154f8b[_0x3ecc5f(0xef0)](/\|\|(.*?)\|\|/g,_0x3ecc5f(0x5ac)),_0x154f8b=_0x154f8b[_0x3ecc5f(0xef0)](/\*\*(.*?)\*\*/g,_0x3ecc5f(0x114a)),_0x154f8b=_0x154f8b[_0x3ecc5f(0xef0)](/\~\~(.*?)\~\~/g,'<s>$1</s>'),_0x154f8b=_0x154f8b['replace'](/\*(.*?)\*/g,'<em>$1</em>'),_0x154f8b;}async function _0x339620(){const _0x433c9a=_0x2b1222;console[_0x433c9a(0x57e)](_0x433c9a(0x9c0));let _0x47539a=0x0;const _0x264ef7=Object[_0x433c9a(0x753)](_0x1ae02e['chats']);for(const _0x3698e2 of _0x264ef7){let _0x421f9d=![];for(const _0x5bb828 of _0x3698e2[_0x433c9a(0xce3)]){_0x5bb828[_0x433c9a(0xcbd)]===_0x433c9a(0x601)&&_0x5bb828['packetType']===_0x433c9a(0x111e)&&_0x5bb828[_0x433c9a(0xfbb)]==='assistant'&&_0x5bb828[_0x433c9a(0x37f)](_0x433c9a(0xe7f))&&!_0x5bb828[_0x433c9a(0x37f)](_0x433c9a(0x14b1))&&(_0x5bb828[_0x433c9a(0x14b1)]=_0x5bb828[_0x433c9a(0xe7f)],delete _0x5bb828[_0x433c9a(0xe7f)],_0x421f9d=!![],_0x47539a++);}_0x421f9d&&(console[_0x433c9a(0x57e)](_0x433c9a(0x441)+_0x3698e2[_0x433c9a(0x5d2)]+_0x433c9a(0xf09)),await _0x3df81a['chats'][_0x433c9a(0x295)](_0x3698e2));}_0x47539a>0x0?(console[_0x433c9a(0x57e)](_0x433c9a(0x2b5)+_0x47539a+_0x433c9a(0xea5)),alert(_0x433c9a(0xd8d)+_0x47539a+_0x433c9a(0xcdc)),location['reload']()):console['log'](_0x433c9a(0x1130));}async function _0x430345(){const _0x237989=_0x2b1222;if(!_0x1ae02e[_0x237989(0x588)]||_0x1ae02e[_0x237989(0x589)][_0x1ae02e['activeChatId']][_0x237989(0xe83)])return;const _0x98db5f=_0x1ae02e[_0x237989(0x589)][_0x1ae02e[_0x237989(0x588)]];if(!_0x98db5f)return;const _0x4998dc=_0x98db5f[_0x237989(0xbae)]||'',_0x484ec9=await _0x11f6fb(_0x237989(0x282)+_0x98db5f['name']+_0x237989(0x1259),_0x237989(0x1085),_0x4998dc,_0x237989(0x1097));if(_0x484ec9===null){await _0x1460c5(_0x237989(0xc2e),_0x237989(0x13d6));return;}const _0x86cd6b=_0x98db5f[_0x237989(0x3d2)]||'',_0x548072=await _0x11f6fb(_0x237989(0x282)+_0x98db5f[_0x237989(0x5d2)]+_0x237989(0x82a),'请输入新的散记内容...',_0x86cd6b,_0x237989(0x1097));if(_0x548072===null){await _0x1460c5(_0x237989(0xc2e),_0x237989(0x44c));return;}_0x98db5f['heartfeltVoice']=_0x484ec9[_0x237989(0x4a2)](),_0x98db5f[_0x237989(0x3d2)]=_0x548072[_0x237989(0x4a2)]();!Array[_0x237989(0x121f)](_0x98db5f['thoughtsHistory'])&&(_0x98db5f[_0x237989(0xc34)]=[]);if(_0x98db5f[_0x237989(0xc34)][_0x237989(0x58a)]>0x0){const _0x163fde=_0x98db5f['thoughtsHistory'][_0x98db5f['thoughtsHistory'][_0x237989(0x58a)]-0x1];_0x163fde[_0x237989(0xbae)]=_0x98db5f[_0x237989(0xbae)],_0x163fde[_0x237989(0x3d2)]=_0x98db5f[_0x237989(0x3d2)],_0x163fde[_0x237989(0x1388)]=Date[_0x237989(0xd6e)]();}else _0x98db5f[_0x237989(0xc34)][_0x237989(0x1426)]({'heartfeltVoice':_0x98db5f[_0x237989(0xbae)],'randomJottings':_0x98db5f[_0x237989(0x3d2)],'timestamp':Date['now']()});await _0x3df81a[_0x237989(0x589)][_0x237989(0x295)](_0x98db5f),await _0x44a7fc(_0x98db5f['id']),await _0x1460c5('成功',_0x237989(0x16d));}async function _0x44a7fc(_0x4aa805){const _0x58d945=_0x2b1222,_0x4a6072=_0x1ae02e['chats'][_0x4aa805];if(!_0x4a6072||_0x4a6072[_0x58d945(0xe83)])return;const _0x3343a7=document[_0x58d945(0x1f4)]('profile-heartfelt-voice'),_0x57f8cc=document['getElementById'](_0x58d945(0xc7d));_0x3343a7[_0x58d945(0xf21)]=await _0x3f4407(_0x4a6072[_0x58d945(0xbae)]||_0x58d945(0x629),_0x4aa805),_0x57f8cc[_0x58d945(0xf21)]=await _0x3f4407(_0x4a6072['randomJottings']||_0x58d945(0x629),_0x4aa805);const _0x279e5b=document[_0x58d945(0x1f4)](_0x58d945(0xf9e));_0x279e5b['classList'][_0x58d945(0x6a4)](_0x58d945(0xfca));}function _0x4b9a45(){const _0x125463=_0x2b1222;document[_0x125463(0x1f4)](_0x125463(0x11ee))['style'][_0x125463(0x887)]=_0x125463(0x1b5),document['getElementById']('profile-thoughts-history-view')[_0x125463(0x215)][_0x125463(0x887)]=_0x125463(0xeba),_0x5ddd5e();}function _0x890701(){const _0x3497e5=_0x2b1222;document[_0x3497e5(0x1f4)]('profile-thoughts-history-view')['style'][_0x3497e5(0x887)]=_0x3497e5(0x1b5),document[_0x3497e5(0x1f4)](_0x3497e5(0x11ee))[_0x3497e5(0x215)]['display']='flex';}function _0x5ddd5e(){const _0x219280=_0x2b1222,_0x462ba9=document[_0x219280(0x1f4)](_0x219280(0x11be)),_0x52a060=_0x1ae02e[_0x219280(0x589)][_0x1ae02e[_0x219280(0x588)]];_0x462ba9[_0x219280(0xf21)]='';if(!_0x52a060||!_0x52a060[_0x219280(0xc34)]||_0x52a060[_0x219280(0xc34)][_0x219280(0x58a)]===0x0){_0x462ba9[_0x219280(0xf21)]=_0x219280(0xa27);return;}const _0x29df60=[..._0x52a060[_0x219280(0xc34)]]['reverse'](),_0x1ad61f=_0x29df60[_0x219280(0x5cc)](0x0,_0x33e9c0);_0x1ad61f[_0x219280(0x59b)](_0x407ff2=>{const _0x4405a2=_0x219280,_0x2617bc=_0x165d8c(_0x407ff2);_0x462ba9[_0x4405a2(0x6ce)](_0x2617bc);}),_0x8aa6f6=_0x1ad61f[_0x219280(0x58a)],_0x29df60[_0x219280(0x58a)]>_0x8aa6f6&&appendLoadMoreThoughtsButton(_0x462ba9);}async function _0x616eb2(){const _0x1339dd=_0x2b1222;if(_0x139519)return;_0x139519=!![];const _0x103e6d=document['getElementById'](_0x1339dd(0x11be)),_0x86cc86=_0x1ae02e['chats'][_0x1ae02e[_0x1339dd(0x588)]];if(!_0x86cc86){_0x139519=![];return;}_0x5563af(_0x103e6d,_0x1339dd(0xb30)),await new Promise(_0x5ed598=>setTimeout(_0x5ed598,0x1f4));const _0x96d974=[..._0x86cc86[_0x1339dd(0xc34)]]['reverse'](),_0x3a1f2a=_0x96d974[_0x1339dd(0x58a)],_0x265871=_0x8aa6f6,_0x8732bf=_0x8aa6f6+_0x33e9c0,_0x3f489d=_0x96d974[_0x1339dd(0x5cc)](_0x265871,_0x8732bf);_0x1335c4(_0x103e6d),_0x3f489d[_0x1339dd(0x59b)](_0x1c35f6=>{const _0x43c62e=_0x1339dd,_0x2a10f2=_0x165d8c(_0x1c35f6);_0x103e6d[_0x43c62e(0x6ce)](_0x2a10f2);}),_0x8aa6f6+=_0x3f489d[_0x1339dd(0x58a)],_0x139519=![];}function _0x165d8c(_0x2e4456){const _0x599b18=_0x2b1222,_0x2414d8=document['createElement'](_0x599b18(0xaf9));_0x2414d8['className']='thought-card';const _0x3934b0=new Date(_0x2e4456[_0x599b18(0x1388)]),_0x55d41d=_0x3934b0[_0x599b18(0x1567)]()+'-'+String(_0x3934b0[_0x599b18(0x45d)]()+0x1)[_0x599b18(0x1189)](0x2,'0')+'-'+String(_0x3934b0['getDate']())[_0x599b18(0x1189)](0x2,'0')+'\x20'+String(_0x3934b0[_0x599b18(0x4ee)]())[_0x599b18(0x1189)](0x2,'0')+':'+String(_0x3934b0['getMinutes']())[_0x599b18(0x1189)](0x2,'0');return _0x2414d8[_0x599b18(0xf21)]=_0x599b18(0x9ba)+_0x2e4456[_0x599b18(0x1388)]+'\x22\x20title=\x22删除此条记录\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thought-header\x22>'+_0x55d41d+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thought-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22currentColor\x22\x20xmlns=\x22http://www.w3.org/2000/svg\x22><path\x20d=\x22M12\x2021.35l-1.45-1.32C5.4\x2015.36\x202\x2012.28\x202\x208.5\x202\x205.42\x204.42\x203\x207.5\x203c1.74\x200\x203.41.81\x204.5\x202.09C13.09\x203.81\x2014.76\x203\x2016.5\x203\x2019.58\x203\x2022\x205.42\x2022\x208.5c0\x203.78-3.4\x206.86-8.55\x2011.54L12\x2021.35z\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20心声\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text\x22>'+_0x1ec77d(_0x2e4456[_0x599b18(0xbae)])+_0x599b18(0x7ca)+_0x1ec77d(_0x2e4456[_0x599b18(0x3d2)])+_0x599b18(0x1101),_0x2414d8;}async function _0x537d50(_0x1cf36){const _0x1462c9=_0x2b1222,_0x1e205b=_0x1cf36[_0x1462c9(0xb57)][_0x1462c9(0x8b1)][0x0];if(!_0x1e205b)return;try{let _0x16b935,_0x947da2=null;if(_0x1e205b['name']['endsWith']('.json')){const _0xdb4ddc=await _0x1e205b[_0x1462c9(0x40f)]();_0x16b935=JSON[_0x1462c9(0x129c)](_0xdb4ddc);}else{if(_0x1e205b[_0x1462c9(0x5d2)][_0x1462c9(0x324)](_0x1462c9(0x1535))){const _0x31a0a7=await _0x1e205b[_0x1462c9(0x1018)]();_0x16b935=await _0x19c15e(_0x31a0a7),_0x947da2=await new Promise(_0x1f6e2d=>{const _0x569060=_0x1462c9,_0x19b715=new FileReader();_0x19b715['onload']=()=>_0x1f6e2d(_0x19b715[_0x569060(0xbc9)]),_0x19b715[_0x569060(0x21e)](_0x1e205b);});}else throw new Error(_0x1462c9(0x40e));}await _0x14bfec(_0x16b935,_0x947da2);}catch(_0x12256c){console[_0x1462c9(0x127d)]('角色卡导入失败:',_0x12256c),await _0x1460c5(_0x1462c9(0x15ca),'无法解析角色卡文件。\x0a错误:\x20'+_0x12256c[_0x1462c9(0x11f0)]);}finally{_0x1cf36['target']['value']=null;}}function _0x19c15e(_0x46590a){return new Promise((_0x272e68,_0x49a0b9)=>{const _0xbdedee=_0x475c,_0x3ebac0=new DataView(_0x46590a);if(_0x3ebac0['getUint32'](0x0)!==0x89504e47||_0x3ebac0[_0xbdedee(0x7ea)](0x4)!==0xd0a1a0a)return _0x49a0b9(new Error(_0xbdedee(0xe14)));let _0x52734d=0x8;const _0x2de879=new TextDecoder();while(_0x52734d<_0x3ebac0[_0xbdedee(0x702)]){const _0x2f7d5f=_0x3ebac0[_0xbdedee(0x7ea)](_0x52734d),_0x4e77cc=_0x2de879[_0xbdedee(0x3e8)](_0x46590a[_0xbdedee(0x5cc)](_0x52734d+0x4,_0x52734d+0x8));if(_0x4e77cc===_0xbdedee(0xca1)){const _0xa259bc=new Uint8Array(_0x46590a,_0x52734d+0x8,_0x2f7d5f),_0x22042b=_0xa259bc['indexOf'](0x0);if(_0x22042b!==-0x1){const _0x6827a9=_0x2de879[_0xbdedee(0x3e8)](_0xa259bc['slice'](0x0,_0x22042b));if(_0x6827a9===_0xbdedee(0x1428)){const _0x538c04=_0x2de879[_0xbdedee(0x3e8)](_0xa259bc['slice'](_0x22042b+0x1));try{const _0x2caee6=atob(_0x538c04),_0x5273eb=new Uint8Array(_0x2caee6['length']);for(let _0x52e14c=0x0;_0x52e14c<_0x2caee6[_0xbdedee(0x58a)];_0x52e14c++){_0x5273eb[_0x52e14c]=_0x2caee6[_0xbdedee(0x109b)](_0x52e14c);}const _0x44d31d=new TextDecoder('utf-8')[_0xbdedee(0x3e8)](_0x5273eb);_0x272e68(JSON['parse'](_0x44d31d));return;}catch(_0x391241){return _0x49a0b9(new Error(_0xbdedee(0x956)+_0x391241[_0xbdedee(0x11f0)]));}}}}_0x52734d+=0x4+0x4+_0x2f7d5f+0x4;}_0x49a0b9(new Error(_0xbdedee(0x89e)));});}function _0x120ca0(_0x450382){const _0x38111c=_0x2b1222;if(_0x450382[_0x38111c(0xc6b)]?.[_0x38111c(0x10fe)]?.['entries']?.[_0x38111c(0x58a)]>0x0)return console['log']('诊断：在\x20data.character_book\x20中找到世界书。'),_0x450382[_0x38111c(0xc6b)]['character_book']['entries'];if(_0x450382[_0x38111c(0x9ae)]?.['character_book']?.[_0x38111c(0xd20)]?.[_0x38111c(0x58a)]>0x0)return console[_0x38111c(0x57e)](_0x38111c(0x1556)),_0x450382[_0x38111c(0x9ae)][_0x38111c(0x10fe)][_0x38111c(0xd20)];if(_0x450382['data']?.[_0x38111c(0x9ae)]?.['character_book']?.[_0x38111c(0xd20)]?.[_0x38111c(0x58a)]>0x0)return console['log'](_0x38111c(0xce8)),_0x450382[_0x38111c(0xc6b)][_0x38111c(0x9ae)][_0x38111c(0x10fe)]['entries'];const _0x493f2b=[_0x38111c(0x10fe),_0x38111c(0x152a),'world_info',_0x38111c(0x26b)];for(const _0x4e8baa of _0x493f2b){if(_0x450382[_0x4e8baa]?.[_0x38111c(0xd20)]?.[_0x38111c(0x58a)]>0x0)return console[_0x38111c(0x57e)](_0x38111c(0x1581)+_0x4e8baa+_0x38111c(0x70a)),_0x450382[_0x4e8baa]['entries'];}return console[_0x38111c(0x57e)](_0x38111c(0x158a)),null;}async function _0x14bfec(_0x3a71f7,_0x51709d=null){const _0x1d3f5c=_0x2b1222,_0x437393=_0x3a71f7['data']||_0x3a71f7;if(!_0x437393[_0x1d3f5c(0x5d2)])throw new Error(_0x1d3f5c(0xe5d));let _0x103b17=null;const _0x36fe93=_0x120ca0(_0x3a71f7);if(_0x36fe93){const _0x5e1ed6=_0x36fe93[_0x1d3f5c(0xede)](_0x4c3e62=>_0x4c3e62[_0x1d3f5c(0x1368)]&&_0x4c3e62[_0x1d3f5c(0x128c)])['map'](_0x11212f=>({'keys':_0x11212f[_0x1d3f5c(0x1378)]||[],'comment':_0x11212f[_0x1d3f5c(0x306)]||'','content':_0x11212f['content'][_0x1d3f5c(0xef0)](/<memory>|<\/memory>/g,'')[_0x1d3f5c(0x4a2)]()}));if(_0x5e1ed6['length']>0x0){const _0x4ded1c={'id':_0x1d3f5c(0x524)+Date['now'](),'name':_0x437393['name']+'的设定集','content':_0x5e1ed6,'categoryId':null};await _0x3df81a[_0x1d3f5c(0x1453)][_0x1d3f5c(0x6a4)](_0x4ded1c),_0x1ae02e[_0x1d3f5c(0x1453)][_0x1d3f5c(0x1426)](_0x4ded1c),_0x103b17=_0x4ded1c['id'];}}let _0x59cdb4=_0x437393['description']||_0x3a71f7[_0x1d3f5c(0xdec)]||'无';_0x59cdb4=_0x59cdb4[_0x1d3f5c(0xef0)](/```yaml/g,'')[_0x1d3f5c(0xef0)](/```/g,'')[_0x1d3f5c(0xef0)](/<\/?info>/g,'')[_0x1d3f5c(0xef0)](/<\/?character>/g,'')[_0x1d3f5c(0xef0)](/<\/?writing_rule>/g,'')['replace'](/\[OOC：.*?\]/g,'')[_0x1d3f5c(0x4a2)]();let _0x59306f=_0x1d3f5c(0x11b3)+_0x59cdb4+'\x0a\x0a';if(_0x437393[_0x1d3f5c(0x24a)])_0x59306f+='#\x20性格补充\x0a'+_0x437393[_0x1d3f5c(0x24a)]+'\x0a\x0a';if(_0x437393[_0x1d3f5c(0x329)])_0x59306f+=_0x1d3f5c(0x4ff)+_0x437393[_0x1d3f5c(0x329)]+'\x0a\x0a';if(_0x437393[_0x1d3f5c(0x10af)])_0x59306f+=_0x1d3f5c(0x98c)+_0x437393[_0x1d3f5c(0x10af)]+'\x0a\x0a';const _0x217c7d=_0x437393[_0x1d3f5c(0x5d2)],_0x2ddfe7=_0x437393[_0x1d3f5c(0x5d2)],_0x5a85a2=_0x1d3f5c(0x13b9)+Date[_0x1d3f5c(0xd6e)](),_0x3d6af8={'id':_0x5a85a2,'name':_0x217c7d['trim'](),'originalName':_0x2ddfe7['trim'](),'isGroup':![],'relationship':{'status':_0x1d3f5c(0xfe3)},'status':{'text':'在线','lastUpdate':Date[_0x1d3f5c(0xd6e)](),'isBusy':![]},'settings':{'aiPersona':_0x59306f,'myPersona':_0x1d3f5c(0x1127),'maxMemory':0xa,'aiAvatar':_0x5494d0,'myAvatar':_0x5494d0,'background':'','theme':'default','fontSize':0xd,'customCss':'','linkedWorldBookIds':_0x103b17?[_0x103b17]:[],'aiAvatarLibrary':[]},'history':[],'musicData':{'totalTime':0x0},'longTermMemory':[]};_0x51709d&&(_0x3d6af8[_0x1d3f5c(0x6a8)]['aiAvatar']=_0x51709d,_0x3d6af8['settings'][_0x1d3f5c(0xb77)][_0x1d3f5c(0x1426)]({'name':_0x1d3f5c(0x1203),'url':_0x51709d}));const _0x19ed73=_0x437393[_0x1d3f5c(0x21f)]||_0x3a71f7[_0x1d3f5c(0x21f)];if(_0x19ed73&&typeof _0x19ed73==='string'){const _0x404554=document[_0x1d3f5c(0x219)](_0x1d3f5c(0xaf9));_0x404554[_0x1d3f5c(0xf21)]=_0x19ed73;const _0x37271d=(_0x404554[_0x1d3f5c(0x231)]||_0x404554[_0x1d3f5c(0x6ba)]||'')[_0x1d3f5c(0xef0)](/原作者UR.*?开局/s,'')['trim']();_0x37271d&&_0x3d6af8[_0x1d3f5c(0xce3)][_0x1d3f5c(0x1426)]({'role':'assistant','senderName':_0x3d6af8['originalName'],'content':_0x37271d,'timestamp':Date[_0x1d3f5c(0xd6e)]()});}_0x1ae02e[_0x1d3f5c(0x589)][_0x5a85a2]=_0x3d6af8,await _0x3df81a[_0x1d3f5c(0x589)][_0x1d3f5c(0x295)](_0x3d6af8),_0x1033ae();let _0x477ba3='角色\x20“'+_0x3d6af8['name']+_0x1d3f5c(0x12df);_0x103b17&&(_0x477ba3+=_0x1d3f5c(0xd3f)),await _0x1460c5('导入成功！',_0x477ba3);}async function _0x42d8d8(){const _0x30429e=_0x2b1222;if(!_0x1ae02e['activeChatId'])return;const _0x14d4ff=_0x1ae02e[_0x30429e(0x589)][_0x1ae02e[_0x30429e(0x588)]],_0x2bdc3c=_0x14d4ff[_0x30429e(0x6a8)][_0x30429e(0x12ee)];if(!_0x2bdc3c||_0x2bdc3c['length']===0x0){alert('这个角色没有可用的备选开场白。');return;}const _0x132d4b=_0x2bdc3c[_0x30429e(0x1431)]((_0x1ded1b,_0xac4f9d)=>{const _0xb47f71=_0x30429e,_0x22f765=_0x1ded1b[_0xb47f71(0xef0)](/<[^>]*>/g,'')[_0xb47f71(0x4a2)]()[_0xb47f71(0x516)](0x0,0x14);return{'text':_0xb47f71(0xa37)+(_0xac4f9d+0x1)+':\x20'+_0x22f765+_0xb47f71(0x629),'value':_0xac4f9d};}),_0x411e8f=await _0x12414d(_0x30429e(0xee8),_0x132d4b);if(_0x411e8f!==null){const _0x1e3b68=await _0x109970(_0x30429e(0x710),_0x30429e(0x4c2),{'confirmButtonClass':'btn-danger','confirmText':_0x30429e(0x134a)});if(_0x1e3b68){const _0x2dcf3b=_0x2bdc3c[_0x411e8f],_0xb39821={'role':_0x30429e(0x13c0),'senderName':_0x14d4ff[_0x30429e(0x96f)],'content':_0x2dcf3b,'timestamp':Date['now']()};_0x14d4ff[_0x30429e(0xce3)]=[_0xb39821],await _0x3df81a[_0x30429e(0x589)][_0x30429e(0x295)](_0x14d4ff),_0x3689f0(_0x14d4ff['id']),document[_0x30429e(0x1f4)](_0x30429e(0xccd))['classList']['remove']('visible'),await _0x1460c5('成功',_0x30429e(0x14e7));}}}function _0x4fc058(_0x170006={'keys':[],'comment':'','content':'','enabled':!![]}){const _0x4a2063=_0x2b1222,_0x307ac2=document['createElement']('div');_0x307ac2[_0x4a2063(0x7c6)]=_0x4a2063(0x578);const _0x23933a=_0x170006['enabled']!==![]?'checked':'';return _0x307ac2[_0x4a2063(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20justify-content:\x20flex-end;\x20align-items:\x20center;\x20gap:\x2010px;\x20margin-bottom:\x205px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22toggle-switch\x22\x20title=\x22启用/禁用此条目\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22entry-enabled-switch\x22\x20'+_0x23933a+_0x4a2063(0x522)+(_0x170006['comment']||'')+_0x4a2063(0xa76)+(_0x170006['keys']||[])[_0x4a2063(0x1143)](',\x20')+_0x4a2063(0xf99)+(_0x170006[_0x4a2063(0x128c)]||'')+_0x4a2063(0xba8),_0x307ac2[_0x4a2063(0xeda)]('.delete-block-btn')[_0x4a2063(0x122b)]('click',()=>{const _0x2f2348=_0x4a2063;_0x307ac2[_0x2f2348(0xa9c)]();}),_0x307ac2;}async function _0x34d1db(){const _0x4c57d7=_0x2b1222;if(!_0x1ae02e[_0x4c57d7(0x588)])return;const _0x4bb043=_0x1ae02e[_0x4c57d7(0x588)],_0x206495=document['getElementById'](_0x4c57d7(0x12ab));if(!_0x206495[_0x4c57d7(0x159b)][_0x4c57d7(0xaea)](_0x4c57d7(0xfca))){const _0x143dcd=document['querySelector'](_0x4c57d7(0x1022));_0x206495[_0x4c57d7(0x215)][_0x4c57d7(0xe00)]=_0x143dcd[_0x4c57d7(0xc5b)]+'px',_0x206495[_0x4c57d7(0x215)][_0x4c57d7(0x887)]=_0x4c57d7(0x361),(!_0x5aea9a[_0x4bb043]||!_0x5aea9a[_0x4bb043][_0x4c57d7(0xd51)])&&_0x43b4a7(_0x4bb043),_0x3fb716(_0x4bb043),setTimeout(async()=>{const _0x48589e=_0x4c57d7;_0x206495[_0x48589e(0x159b)][_0x48589e(0x6a4)](_0x48589e(0xfca));const _0x42bd3f={'role':'system','content':_0x48589e(0x22b),'timestamp':Date['now'](),'isHidden':!![]};_0x1ae02e['chats'][_0x4bb043][_0x48589e(0xce3)][_0x48589e(0x1426)](_0x42bd3f),await _0x3df81a[_0x48589e(0x589)][_0x48589e(0x295)](_0x1ae02e[_0x48589e(0x589)][_0x4bb043]);},0xa);}else await _0x360542();}async function _0x360542(){const _0x15b301=_0x2b1222;if(!_0x1ae02e[_0x15b301(0x588)])return;const _0x52dbd5=_0x1ae02e[_0x15b301(0x588)],_0x4ca686=document[_0x15b301(0x1f4)](_0x15b301(0x12ab));_0x4ca686[_0x15b301(0x159b)][_0x15b301(0xa9c)](_0x15b301(0xfca)),setTimeout(()=>{const _0x201cde=_0x15b301;_0x4ca686[_0x201cde(0x215)][_0x201cde(0x887)]=_0x201cde(0x1b5);},0x12c);if(_0x5aea9a[_0x52dbd5]){_0x5aea9a[_0x52dbd5][_0x15b301(0xd51)]=![];const _0x1def29={'role':_0x15b301(0x1594),'content':_0x15b301(0x11cd),'timestamp':Date[_0x15b301(0xd6e)](),'isHidden':!![]};_0x1ae02e[_0x15b301(0x589)][_0x52dbd5][_0x15b301(0xce3)][_0x15b301(0x1426)](_0x1def29),await _0x3df81a[_0x15b301(0x589)][_0x15b301(0x295)](_0x1ae02e[_0x15b301(0x589)][_0x52dbd5]);}}function _0x43b4a7(_0x5a2fb8){const _0x1f6c4e=_0x2b1222,_0x583cc0=document[_0x1f6c4e(0x1f4)](_0x1f6c4e(0x19c)),_0x564809=document[_0x1f6c4e(0x1f4)](_0x1f6c4e(0x12ab)),_0x46a429=document[_0x1f6c4e(0x1f4)]('gomoku-controls'),_0x3639bb=_0x564809[_0x1f6c4e(0x93a)]-0x28,_0x124bcf=_0x564809[_0x1f6c4e(0xc5b)]-_0x46a429['offsetHeight']-0x28,_0x42bf9c=Math[_0x1f6c4e(0x123c)](Math[_0x1f6c4e(0xbc3)](_0x3639bb,_0x124bcf)),_0x422775=0xf,_0x36c61b=Math['floor'](_0x42bf9c/_0x422775),_0x2eef27=_0x36c61b*_0x422775;_0x583cc0['width']=_0x2eef27,_0x583cc0[_0x1f6c4e(0x1158)]=_0x2eef27,_0x5aea9a[_0x5a2fb8]={'isActive':!![],'board':Array(_0x422775)[_0x1f6c4e(0x22d)](0x0)['map'](()=>Array(_0x422775)[_0x1f6c4e(0x22d)](0x0)),'currentPlayer':0x1,'history':[],'isGameOver':![],'GRID_SIZE':_0x422775,'CELL_SIZE':_0x36c61b};}function _0x3fb716(_0x5511f9){const _0x41f8c3=_0x2b1222,_0x4b48d6=_0x5aea9a[_0x5511f9];if(!_0x4b48d6)return;const _0x8d5eba=document[_0x41f8c3(0x1f4)](_0x41f8c3(0x19c)),_0x3cc03b=_0x8d5eba[_0x41f8c3(0x902)]('2d'),{GRID_SIZE:_0x368a04,CELL_SIZE:_0x3dabc}=_0x4b48d6,_0x1c99ee=_0x3dabc/0x2;_0x3cc03b['clearRect'](0x0,0x0,_0x8d5eba['width'],_0x8d5eba[_0x41f8c3(0x1158)]),_0x3cc03b[_0x41f8c3(0xb34)]=_0x41f8c3(0x88a),_0x3cc03b[_0x41f8c3(0xea2)](0x0,0x0,_0x8d5eba['width'],_0x8d5eba[_0x41f8c3(0x1158)]),_0x3cc03b['strokeStyle']=_0x41f8c3(0x4d8),_0x3cc03b[_0x41f8c3(0x13a0)]=0x1;for(let _0x1faa8a=0x0;_0x1faa8a<_0x368a04;_0x1faa8a++){_0x3cc03b[_0x41f8c3(0x188)](),_0x3cc03b['moveTo'](_0x1c99ee,_0x1c99ee+_0x1faa8a*_0x3dabc),_0x3cc03b[_0x41f8c3(0x1f9)](_0x8d5eba[_0x41f8c3(0x4cb)]-_0x1c99ee,_0x1c99ee+_0x1faa8a*_0x3dabc),_0x3cc03b[_0x41f8c3(0x1347)](),_0x3cc03b[_0x41f8c3(0x188)](),_0x3cc03b[_0x41f8c3(0x14cc)](_0x1c99ee+_0x1faa8a*_0x3dabc,_0x1c99ee),_0x3cc03b[_0x41f8c3(0x1f9)](_0x1c99ee+_0x1faa8a*_0x3dabc,_0x8d5eba[_0x41f8c3(0x1158)]-_0x1c99ee),_0x3cc03b['stroke']();}for(let _0x4b1b3a=0x0;_0x4b1b3a<_0x368a04;_0x4b1b3a++){for(let _0x209ab6=0x0;_0x209ab6<_0x368a04;_0x209ab6++){_0x4b48d6[_0x41f8c3(0x870)][_0x4b1b3a][_0x209ab6]!==0x0&&_0x34e667(_0x3cc03b,_0x209ab6,_0x4b1b3a,_0x4b48d6[_0x41f8c3(0x870)][_0x4b1b3a][_0x209ab6],_0x4b48d6);}}}function _0x34e667(_0x183e4c,_0x27c51b,_0x257801,_0x3d516e,_0x4dc9af){const _0xb76f68=_0x2b1222,{CELL_SIZE:_0x1be371}=_0x4dc9af,_0xd93fa4=_0x1be371/0x2,_0x560ac8=_0x1be371/0x2-0x2;_0x183e4c[_0xb76f68(0x188)](),_0x183e4c['arc'](_0xd93fa4+_0x27c51b*_0x1be371,_0xd93fa4+_0x257801*_0x1be371,_0x560ac8,0x0,0x2*Math['PI']),_0x3d516e===0x1?_0x183e4c[_0xb76f68(0xb34)]=_0xb76f68(0x1be):_0x183e4c[_0xb76f68(0xb34)]='white',_0x183e4c[_0xb76f68(0x22d)]();}function _0xd5621c(_0x1f08fa){const _0x42208c=_0x2b1222,_0x59c257=_0x1ae02e[_0x42208c(0x588)],_0x26262e=_0x5aea9a[_0x59c257];if(!_0x26262e||_0x26262e[_0x42208c(0xa55)]||_0x26262e[_0x42208c(0x969)]!==0x1)return;const _0x278ffb=document[_0x42208c(0x1f4)](_0x42208c(0x19c)),_0x3f2499=_0x278ffb[_0x42208c(0x902)]('2d'),_0x144eae=_0x278ffb[_0x42208c(0x6cc)](),_0x172963=_0x1f08fa[_0x42208c(0x1476)]-_0x144eae[_0x42208c(0xbe7)],_0x43ab8e=_0x1f08fa['clientY']-_0x144eae[_0x42208c(0xe00)],_0x557a63=Math[_0x42208c(0x8cf)]((_0x172963-_0x26262e[_0x42208c(0x125b)]/0x2)/_0x26262e[_0x42208c(0x125b)]),_0x27ca3a=Math[_0x42208c(0x8cf)]((_0x43ab8e-_0x26262e[_0x42208c(0x125b)]/0x2)/_0x26262e[_0x42208c(0x125b)]);_0x3fb716(_0x59c257);if(_0x557a63>=0x0&&_0x557a63<_0x26262e[_0x42208c(0xe67)]&&_0x27ca3a>=0x0&&_0x27ca3a<_0x26262e['GRID_SIZE']&&_0x26262e[_0x42208c(0x870)][_0x27ca3a][_0x557a63]===0x0){const _0x54353c=_0x26262e['CELL_SIZE']/0x2-0x2;_0x3f2499['beginPath'](),_0x3f2499[_0x42208c(0x725)](_0x26262e['CELL_SIZE']/0x2+_0x557a63*_0x26262e[_0x42208c(0x125b)],_0x26262e[_0x42208c(0x125b)]/0x2+_0x27ca3a*_0x26262e['CELL_SIZE'],_0x54353c,0x0,0x2*Math['PI']),_0x3f2499[_0x42208c(0xb34)]=_0x42208c(0x127a),_0x3f2499[_0x42208c(0x22d)]();}}function _0x13398a(_0x4edaf7){const _0x413485=_0x2b1222,_0xbc589e=_0x1ae02e[_0x413485(0x588)],_0x282eee=_0x5aea9a[_0xbc589e];if(!_0x282eee||_0x282eee[_0x413485(0xa55)]||_0x282eee[_0x413485(0x969)]!==0x1)return;const _0x21bc62=document[_0x413485(0x1f4)](_0x413485(0x19c)),_0x10ca61=_0x21bc62['getBoundingClientRect'](),_0xcad0c9=_0x4edaf7[_0x413485(0x1476)]-_0x10ca61[_0x413485(0xbe7)],_0x23363f=_0x4edaf7[_0x413485(0x1521)]-_0x10ca61[_0x413485(0xe00)],_0x1f01f1=Math[_0x413485(0x8cf)]((_0xcad0c9-_0x282eee['CELL_SIZE']/0x2)/_0x282eee[_0x413485(0x125b)]),_0xdf708f=Math[_0x413485(0x8cf)]((_0x23363f-_0x282eee[_0x413485(0x125b)]/0x2)/_0x282eee['CELL_SIZE']);_0x1f01f1>=0x0&&_0x1f01f1<_0x282eee[_0x413485(0xe67)]&&_0xdf708f>=0x0&&_0xdf708f<_0x282eee[_0x413485(0xe67)]&&_0x282eee[_0x413485(0x870)][_0xdf708f][_0x1f01f1]===0x0&&(_0x282eee['board'][_0xdf708f][_0x1f01f1]=0x1,_0x282eee[_0x413485(0xce3)][_0x413485(0x1426)]({'x':_0x1f01f1,'y':_0xdf708f,'player':0x1}),_0x3fb716(_0xbc589e),_0x4a3647(_0x1f01f1,_0xdf708f,0x1,_0x282eee)?(_0x282eee[_0x413485(0xa55)]=!![],setTimeout(()=>alert(_0x413485(0x250)),0x64),_0x1a3508(_0x413485(0x860))):_0x282eee['currentPlayer']=0x2);}function _0x35b05e(_0x45059f,_0xb93e21=![]){const _0x190075=_0x2b1222,_0x1acc1b=_0x1ae02e[_0x190075(0x588)],_0x31e62c=_0x5aea9a[_0x1acc1b];if(!_0x31e62c||_0x31e62c[_0x190075(0xa55)])return;if(!_0xb93e21&&_0x31e62c[_0x190075(0x969)]!==0x2)return;const {x:_0x38db72,y:_0xfb5958}=_0x45059f;_0x38db72>=0x0&&_0x38db72<_0x31e62c[_0x190075(0xe67)]&&_0xfb5958>=0x0&&_0xfb5958<_0x31e62c['GRID_SIZE']&&_0x31e62c[_0x190075(0x870)][_0xfb5958][_0x38db72]===0x0?(_0x31e62c['board'][_0xfb5958][_0x38db72]=0x2,_0x31e62c[_0x190075(0xce3)]['push']({'x':_0x38db72,'y':_0xfb5958,'player':0x2}),_0x3fb716(_0x1acc1b),_0x4a3647(_0x38db72,_0xfb5958,0x2,_0x31e62c)?(_0x31e62c[_0x190075(0xa55)]=!![],setTimeout(()=>alert(_0x190075(0x12c4)),0x64),_0x1a3508('ai')):_0x31e62c[_0x190075(0x969)]=0x1):(console[_0x190075(0xb3b)](_0x190075(0xdfd),_0x45059f),_0x31e62c[_0x190075(0x969)]=0x1);}function _0x4a3647(_0x49a4ab,_0x553923,_0x38bd7e,_0x693735){const {board:_0x2e3e77,GRID_SIZE:_0x3b0d63}=_0x693735,_0x43b742=[[0x1,0x0],[0x0,0x1],[0x1,0x1],[0x1,-0x1]];for(const [_0x42c048,_0xb98fae]of _0x43b742){let _0x20777d=0x1;for(let _0x4987a0=0x1;_0x4987a0<0x5;_0x4987a0++){const _0x2ce65f=_0x49a4ab+_0x4987a0*_0x42c048,_0x3437ca=_0x553923+_0x4987a0*_0xb98fae;if(_0x2ce65f>=0x0&&_0x2ce65f<_0x3b0d63&&_0x3437ca>=0x0&&_0x3437ca<_0x3b0d63&&_0x2e3e77[_0x3437ca][_0x2ce65f]===_0x38bd7e)_0x20777d++;else break;}for(let _0x386cb0=0x1;_0x386cb0<0x5;_0x386cb0++){const _0x87f5a7=_0x49a4ab-_0x386cb0*_0x42c048,_0x2e3477=_0x553923-_0x386cb0*_0xb98fae;if(_0x87f5a7>=0x0&&_0x87f5a7<_0x3b0d63&&_0x2e3477>=0x0&&_0x2e3477<_0x3b0d63&&_0x2e3e77[_0x2e3477][_0x87f5a7]===_0x38bd7e)_0x20777d++;else break;}if(_0x20777d>=0x5)return!![];}return![];}function _0xce74a4(_0x21478d){const _0x2ed68b=_0x2b1222;if(!_0x21478d||!_0x21478d[_0x2ed68b(0xd51)])return'';let _0x24c3d1=_0x2ed68b(0x10ca);_0x24c3d1+=_0x21478d[_0x2ed68b(0x870)][_0x2ed68b(0x1431)](_0xc6fba2=>_0xc6fba2[_0x2ed68b(0x1143)]('\x20'))[_0x2ed68b(0x1143)]('\x0a');let _0x42baa1=_0x2ed68b(0x31f);return _0x42baa1+=_0x21478d[_0x2ed68b(0xce3)][_0x2ed68b(0x1431)](_0x70fb6d=>'玩家'+_0x70fb6d[_0x2ed68b(0x13a7)]+_0x2ed68b(0x620)+_0x70fb6d['x']+','+_0x70fb6d['y']+')')[_0x2ed68b(0x1143)](_0x2ed68b(0x6c4)),_0x2ed68b(0x12f8)+_0x24c3d1+_0x2ed68b(0x12e6)+_0x42baa1+_0x2ed68b(0x3e1);}async function _0x1a3508(_0xf87649){const _0x26a129=_0x2b1222,_0x44582f=_0x1ae02e['activeChatId'],_0x4a7a05=_0x1ae02e[_0x26a129(0x589)][_0x44582f];if(!_0x4a7a05)return;const _0x36ad9a=_0x4a7a05[_0x26a129(0xe83)]?_0x4a7a05[_0x26a129(0x6a8)]['myNickname']||'我':'我',_0x3d2d64=_0x4a7a05[_0x26a129(0xe83)]?_0x26a129(0x14ad):_0x4a7a05['name'],_0x253493=_0xf87649===_0x26a129(0x860)?_0x36ad9a:_0x3d2d64,_0x3530ef=_0xf87649===_0x26a129(0x860)?_0x26a129(0x402):_0x26a129(0x689),_0xec1f9f='[系统提示：五子棋游戏已结束。最终结果是：'+_0x253493+_0x26a129(0x1418)+_0x3530ef+'。]',_0x392543={'role':_0x26a129(0x1594),'content':_0xec1f9f,'timestamp':Date['now'](),'isHidden':!![]};_0x4a7a05[_0x26a129(0xce3)][_0x26a129(0x1426)](_0x392543),await _0x3df81a[_0x26a129(0x589)][_0x26a129(0x295)](_0x4a7a05),console[_0x26a129(0x57e)](_0x26a129(0x7f3)+_0xf87649);}let _0x38b1ed=![];async function _0x4faebc(){const _0x2aa0ae=_0x2b1222,_0x327795=document[_0x2aa0ae(0x1f4)]('product-grid'),_0x2a5db3=document[_0x2aa0ae(0x1f4)](_0x2aa0ae(0xe4f)),_0x5cf1bd=document[_0x2aa0ae(0x1f4)](_0x2aa0ae(0x5ad));_0x327795[_0x2aa0ae(0xf21)]='',_0x2a5db3['innerHTML']='';const [_0x19cf0b,_0x45c659]=await Promise['all']([_0x3df81a['shoppingProducts'][_0x2aa0ae(0x27a)](),_0x3df81a[_0x2aa0ae(0xca5)]['orderBy'](_0x2aa0ae(0x5d2))[_0x2aa0ae(0x27a)]()]);_0x5cf1bd['classList'][_0x2aa0ae(0x1483)]('management-mode',_0x38b1ed);const _0x4e2942=document[_0x2aa0ae(0x219)](_0x2aa0ae(0xd2d));_0x4e2942[_0x2aa0ae(0x7c6)]=_0x2aa0ae(0x186),_0x4e2942[_0x2aa0ae(0x231)]='全部',_0x4e2942[_0x2aa0ae(0x746)]['categoryId']=_0x2aa0ae(0x54b);if(activeShoppingCategoryId===_0x2aa0ae(0x54b))_0x4e2942[_0x2aa0ae(0x159b)][_0x2aa0ae(0x6a4)](_0x2aa0ae(0x7cf));_0x2a5db3[_0x2aa0ae(0x6ce)](_0x4e2942),_0x45c659[_0x2aa0ae(0x59b)](_0x1b0e8c=>{const _0x20a9a7=_0x2aa0ae,_0xe23d39=document[_0x20a9a7(0x219)](_0x20a9a7(0xd2d));_0xe23d39[_0x20a9a7(0x7c6)]='product-category-tab',_0xe23d39[_0x20a9a7(0x231)]=_0x1b0e8c[_0x20a9a7(0x5d2)],_0xe23d39['dataset'][_0x20a9a7(0x1467)]=_0x1b0e8c['id'];if(activeShoppingCategoryId===_0x1b0e8c['id'])_0xe23d39[_0x20a9a7(0x159b)]['add'](_0x20a9a7(0x7cf));_0x2a5db3['appendChild'](_0xe23d39);});let _0x42fdf8;activeShoppingCategoryId==='all'?_0x42fdf8=_0x19cf0b:_0x42fdf8=_0x19cf0b[_0x2aa0ae(0xede)](_0x1a0174=>_0x1a0174['categoryId']===activeShoppingCategoryId);if(_0x42fdf8[_0x2aa0ae(0x58a)]===0x0){const _0x16bc09=activeShoppingCategoryId===_0x2aa0ae(0x54b)?'商店空空如也，点击“管理”添加商品吧！':'这个分类下还没有商品哦~';_0x327795[_0x2aa0ae(0xf21)]=_0x2aa0ae(0x157d)+_0x16bc09+'</p>';return;}_0x42fdf8['forEach'](_0x2ddadf=>{const _0x5d84b4=_0x2aa0ae,_0x4e7790=document[_0x5d84b4(0x219)](_0x5d84b4(0xaf9));_0x4e7790[_0x5d84b4(0x7c6)]=_0x5d84b4(0x1529),_0x4e7790[_0x5d84b4(0x746)]['id']=_0x2ddadf['id'];const _0x44775d=_0x5d84b4(0x12be);_0x4e7790[_0x5d84b4(0xf21)]=_0x5d84b4(0x1375)+_0x44775d+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x2ddadf['imageUrl']+_0x5d84b4(0x1312)+_0x2ddadf['name']+_0x5d84b4(0x469)+_0x2ddadf[_0x5d84b4(0x6ec)][_0x5d84b4(0x24f)](0x2)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22add-to-cart-btn\x22>加入购物车</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x327795['appendChild'](_0x4e7790);});}function _0x4c2f6e(_0x53e97d){activeShoppingCategoryId=_0x53e97d,_0x4faebc(),_0x13c00e();}function _0x13c00e(){const _0x8d63c4=_0x2b1222,_0x97be21=document['getElementById'](_0x8d63c4(0x998));if(!_0x97be21)return;const _0x4d40cf=_0x38b1ed&&activeShoppingCategoryId!==_0x8d63c4(0x54b);_0x97be21[_0x8d63c4(0x215)][_0x8d63c4(0x887)]=_0x4d40cf?_0x8d63c4(0xeba):'none';}async function _0xca6a96(){const _0x53a1e7=_0x2b1222;if(activeShoppingCategoryId===_0x53a1e7(0x54b))return;const _0xb4d3cb=activeShoppingCategoryId,_0x11ac26=await _0x3df81a['shoppingCategories'][_0x53a1e7(0x13f8)](_0xb4d3cb);if(!_0x11ac26){alert('错误：找不到要删除的分类。');return;}const _0x56c54f=_0x53a1e7(0x472)+_0x11ac26[_0x53a1e7(0x5d2)]+_0x53a1e7(0x982),_0x56f8f3=await _0x109970(_0x53a1e7(0x33f),_0x56c54f,{'confirmButtonClass':_0x53a1e7(0x1c6),'confirmText':'确认删除'});_0x56f8f3&&(await _0x3cb7af(_0xb4d3cb),activeShoppingCategoryId=_0x53a1e7(0x54b),await _0x4faebc(),_0x13c00e(),await _0x1460c5('成功','分类\x20“'+_0x11ac26['name']+_0x53a1e7(0x1163)));}async function _0xef4db1(){const _0x591dbf=_0x2b1222;activeShoppingCategoryId=_0x591dbf(0x54b),await _0x4faebc(),_0x2e53fa(_0x591dbf(0x5ad)),_0x13c00e();}async function _0x4faebc(){const _0x18be96=_0x2b1222,_0x1de41d=document[_0x18be96(0x1f4)](_0x18be96(0x7f8)),_0x4cc343=document[_0x18be96(0x1f4)](_0x18be96(0xe4f)),_0x2fe5c6=document['getElementById'](_0x18be96(0x5ad));_0x1de41d[_0x18be96(0xf21)]='',_0x4cc343['innerHTML']='';const [_0x366410,_0x5632b1]=await Promise['all']([_0x3df81a[_0x18be96(0xbf4)][_0x18be96(0x27a)](),_0x3df81a[_0x18be96(0xca5)][_0x18be96(0x931)](_0x18be96(0x5d2))[_0x18be96(0x27a)]()]);_0x2fe5c6[_0x18be96(0x159b)][_0x18be96(0x1483)](_0x18be96(0xb15),_0x38b1ed);const _0x12d4c1=document[_0x18be96(0x219)](_0x18be96(0xd2d));_0x12d4c1[_0x18be96(0x7c6)]='product-category-tab',_0x12d4c1[_0x18be96(0x231)]='全部',_0x12d4c1[_0x18be96(0x746)][_0x18be96(0x1467)]=_0x18be96(0x54b);if(activeShoppingCategoryId===_0x18be96(0x54b))_0x12d4c1['classList'][_0x18be96(0x6a4)](_0x18be96(0x7cf));_0x4cc343['appendChild'](_0x12d4c1),_0x5632b1[_0x18be96(0x59b)](_0x1e9b9d=>{const _0x14e16a=_0x18be96,_0x300d13=document['createElement'](_0x14e16a(0xd2d));_0x300d13[_0x14e16a(0x7c6)]=_0x14e16a(0x186),_0x300d13[_0x14e16a(0x231)]=_0x1e9b9d[_0x14e16a(0x5d2)],_0x300d13[_0x14e16a(0x746)][_0x14e16a(0x1467)]=_0x1e9b9d['id'];if(activeShoppingCategoryId===_0x1e9b9d['id'])_0x300d13[_0x14e16a(0x159b)][_0x14e16a(0x6a4)]('active');_0x4cc343[_0x14e16a(0x6ce)](_0x300d13);});let _0x306c71;activeShoppingCategoryId===_0x18be96(0x54b)?_0x306c71=_0x366410:_0x306c71=_0x366410['filter'](_0x5808a6=>_0x5808a6['categoryId']===activeShoppingCategoryId);if(_0x306c71[_0x18be96(0x58a)]===0x0){const _0x49fd70=activeShoppingCategoryId==='all'?_0x18be96(0x561):_0x18be96(0x513);_0x1de41d[_0x18be96(0xf21)]=_0x18be96(0x157d)+_0x49fd70+'</p>';return;}_0x306c71[_0x18be96(0x59b)](_0x23404e=>{const _0x21bfe2=_0x18be96,_0x275c68=document[_0x21bfe2(0x219)](_0x21bfe2(0xaf9));_0x275c68[_0x21bfe2(0x7c6)]=_0x21bfe2(0x1529),_0x275c68[_0x21bfe2(0x746)]['id']=_0x23404e['id'];const _0x24fdc0=_0x38b1ed?_0x21bfe2(0xdd2):'';_0x275c68['innerHTML']=_0x21bfe2(0xa73)+_0x24fdc0+_0x21bfe2(0x90b)+_0x23404e[_0x21bfe2(0x48d)]+_0x21bfe2(0x155c)+_0x23404e['name']+_0x21bfe2(0x821)+_0x23404e[_0x21bfe2(0x6ec)][_0x21bfe2(0x24f)](0x2)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22add-to-cart-btn\x22>加入购物车</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x1de41d[_0x21bfe2(0x6ce)](_0x275c68);});}async function _0x37f43c(_0x4ba6d9,_0x2f3fa1=0x1,_0xd205ce=null){const _0x80f307=_0x2b1222,_0x124876=_0xd205ce?_0x126669['find'](_0xc426a=>_0xc426a[_0x80f307(0x12f6)]===_0x4ba6d9&&_0xc426a[_0x80f307(0xbcd)]?.['name']===_0xd205ce[_0x80f307(0x5d2)]):_0x126669[_0x80f307(0x13b7)](_0xe5d967=>_0xe5d967[_0x80f307(0x12f6)]===_0x4ba6d9&&!_0xe5d967['variation']);if(_0x124876)_0x124876['quantity']+=_0x2f3fa1;else{const _0x5f150e=await _0x3df81a['shoppingProducts'][_0x80f307(0x13f8)](_0x4ba6d9);_0x5f150e&&_0x126669[_0x80f307(0x1426)]({'productId':_0x5f150e['id'],'quantity':_0x2f3fa1,'variation':_0xd205ce});}_0x552ba0();}function _0x1adcd7(_0x37d01a,_0x4d4320){const _0x518d26=_0x2b1222,_0x1cd83a=_0x126669[_0x518d26(0xf2d)](_0x4d49b0=>_0x4d49b0['productId']===_0x37d01a);_0x1cd83a>-0x1&&(_0x126669[_0x1cd83a][_0x518d26(0x262)]+=_0x4d4320,_0x126669[_0x1cd83a][_0x518d26(0x262)]<=0x0&&_0x126669[_0x518d26(0x30b)](_0x1cd83a,0x1),_0x552ba0(),_0x42157c());}function _0x552ba0(){const _0xc4ce54=_0x2b1222,_0x3acd0f=_0x126669[_0xc4ce54(0x7b6)]((_0x4a0536,_0x50975a)=>_0x4a0536+_0x50975a['quantity'],0x0);document[_0xc4ce54(0x1f4)](_0xc4ce54(0x759))['textContent']=_0x3acd0f,document[_0xc4ce54(0x1f4)](_0xc4ce54(0x66a))[_0xc4ce54(0x231)]=_0xc4ce54(0x13e8)+_0x3acd0f+')',document['getElementById'](_0xc4ce54(0x67e))[_0xc4ce54(0x231)]=_0xc4ce54(0xc6f)+_0x3acd0f+')';}function _0x4c7a32(){const _0xfdc2da=_0x2b1222;_0x42157c(),_0x2e53fa(_0xfdc2da(0xafc));}async function _0x42157c(){const _0x80002e=_0x2b1222,_0x259e2c=document[_0x80002e(0x1f4)](_0x80002e(0x224));_0x259e2c[_0x80002e(0xf21)]='';let _0x4ccb62=0x0;if(_0x126669[_0x80002e(0x58a)]===0x0)_0x259e2c[_0x80002e(0xf21)]=_0x80002e(0x9de);else{const _0x5ab3eb=_0x126669['map'](_0x2d4142=>_0x2d4142['productId']),_0xcc30e2=await _0x3df81a['shoppingProducts'][_0x80002e(0x478)]('id')['anyOf'](_0x5ab3eb)[_0x80002e(0x27a)](),_0x4cfa4e=new Map(_0xcc30e2['map'](_0x5be9f2=>[_0x5be9f2['id'],_0x5be9f2]));_0x126669[_0x80002e(0x59b)](_0x1a05ec=>{const _0x31d62f=_0x80002e,_0x29d45d=_0x4cfa4e['get'](_0x1a05ec[_0x31d62f(0x12f6)]);if(_0x29d45d){const _0x40a180=document[_0x31d62f(0x219)](_0x31d62f(0xaf9));_0x40a180['className']=_0x31d62f(0x8fa);const _0xe7e1ca=_0x1a05ec[_0x31d62f(0xbcd)]?_0x31d62f(0xf88)+_0x1a05ec[_0x31d62f(0xbcd)]['name']+_0x31d62f(0x149b):'';_0x40a180['innerHTML']=_0x31d62f(0x49e)+_0x29d45d['id']+'\x22\x20checked>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+(_0x1a05ec[_0x31d62f(0xbcd)]?.['imageUrl']||_0x29d45d[_0x31d62f(0x48d)])+'\x22\x20class=\x22cart-item-image\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-name\x22>'+_0x29d45d[_0x31d62f(0x5d2)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0xe7e1ca+_0x31d62f(0x47c)+(_0x1a05ec[_0x31d62f(0xbcd)]?.[_0x31d62f(0x6ec)]||_0x29d45d[_0x31d62f(0x6ec)])[_0x31d62f(0x24f)](0x2)+_0x31d62f(0x340)+_0x29d45d['id']+_0x31d62f(0x24e)+_0x1a05ec[_0x31d62f(0x262)]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22quantity-btn\x20increase-qty-btn\x22\x20data-id=\x22'+_0x29d45d['id']+_0x31d62f(0xacb),_0x259e2c[_0x31d62f(0x6ce)](_0x40a180);}});}_0x383a35();}async function _0x383a35(){const _0x31f246=_0x2b1222;let _0x559ef2=0x0;const _0x4ad735=document[_0x31f246(0x14bf)]('.cart-item-checkbox:checked'),_0x46f0e2=Array[_0x31f246(0xa81)](_0x4ad735)[_0x31f246(0x1431)](_0x247ecc=>parseInt(_0x247ecc[_0x31f246(0x746)]['id']));if(_0x46f0e2[_0x31f246(0x58a)]>0x0){const _0x4eb753=await _0x3df81a[_0x31f246(0xbf4)]['where']('id')[_0x31f246(0x5b9)](_0x46f0e2)[_0x31f246(0x27a)](),_0x39deea=new Map(_0x4eb753[_0x31f246(0x1431)](_0x2b567d=>[_0x2b567d['id'],_0x2b567d]));_0x126669[_0x31f246(0x59b)](_0x2695ce=>{const _0x185bd4=_0x31f246;if(_0x46f0e2['includes'](_0x2695ce[_0x185bd4(0x12f6)])){const _0x3b5a5a=_0x39deea['get'](_0x2695ce['productId']);if(_0x3b5a5a){const _0x48e52b=_0x2695ce[_0x185bd4(0xbcd)]?_0x2695ce[_0x185bd4(0xbcd)][_0x185bd4(0x6ec)]:_0x3b5a5a['price'];_0x559ef2+=_0x48e52b*_0x2695ce[_0x185bd4(0x262)];}}});}document[_0x31f246(0x1f4)](_0x31f246(0xa87))[_0x31f246(0x231)]=_0x31f246(0xbd1)+_0x559ef2[_0x31f246(0x24f)](0x2);}async function _0xb3910(){const _0x15b7ae=_0x2b1222,_0x281875=_0x1ae02e['chats'][_0x1ae02e['activeChatId']];if(!_0x281875||!_0x281875['isGroup'])return;const _0x4ecef8=document[_0x15b7ae(0x1f4)](_0x15b7ae(0x15d1)),_0x349a25=document['getElementById'](_0x15b7ae(0x4a9));_0x349a25['innerHTML']='';const _0x105c67=_0x281875[_0x15b7ae(0x6a8)][_0x15b7ae(0xe31)]||'我',_0x20d4c0=_0x281875[_0x15b7ae(0x1402)]['filter'](_0x591c25=>_0x591c25['groupNickname']!==_0x105c67);_0x20d4c0['forEach'](_0x3f5831=>{const _0x31d41c=_0x15b7ae,_0x1f074e=document['createElement'](_0x31d41c(0xaf9));_0x1f074e[_0x31d41c(0x7c6)]='contact-picker-item',_0x1f074e[_0x31d41c(0x746)][_0x31d41c(0x309)]=_0x3f5831[_0x31d41c(0x96f)],_0x1f074e[_0x31d41c(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+(_0x3f5831[_0x31d41c(0x95b)]||_0x54779f)+'\x22\x20class=\x22avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>'+_0x3f5831['groupNickname']+_0x31d41c(0x100c),_0x349a25[_0x31d41c(0x6ce)](_0x1f074e);}),document[_0x15b7ae(0x1f4)](_0x15b7ae(0x83e))[_0x15b7ae(0xe56)]=![],_0x4ecef8[_0x15b7ae(0x159b)]['add'](_0x15b7ae(0xfca));}async function _0x243414(){const _0x532689=_0x2b1222,_0x4983bb=_0x1ae02e[_0x532689(0x589)][_0x1ae02e[_0x532689(0x588)]],_0x576c11=_0x126669[_0x532689(0xede)](_0x1d66bb=>document['querySelector'](_0x532689(0x143f)+_0x1d66bb['productId']+_0x532689(0x426)));if(_0x576c11[_0x532689(0x58a)]===0x0){alert(_0x532689(0x446));return;}if(_0x4983bb[_0x532689(0xe83)])_0xb3910();else{const _0x121284=await _0x109970(_0x532689(0x126b),'确定要将选中的商品作为礼物送出吗？',{'confirmText':_0x532689(0x2e7)});_0x121284&&await _0xd5c77f(_0x576c11);}}async function _0xd5c77f(_0x5b6366,_0x53d696=null){const _0x1ec8d6=_0x2b1222;if(!_0x1ae02e[_0x1ec8d6(0x588)])return;const _0x5c2154=_0x1ae02e[_0x1ec8d6(0x589)][_0x1ae02e[_0x1ec8d6(0x588)]],_0x3eced6=_0x5b6366[_0x1ec8d6(0x1431)](_0x3e76ca=>_0x3e76ca[_0x1ec8d6(0x12f6)]),_0x2ef17f=await _0x3df81a[_0x1ec8d6(0xbf4)][_0x1ec8d6(0x478)]('id')[_0x1ec8d6(0x5b9)](_0x3eced6)[_0x1ec8d6(0x27a)](),_0x402d2b=new Map(_0x2ef17f[_0x1ec8d6(0x1431)](_0x4db233=>[_0x4db233['id'],_0x4db233])),_0x2b474e=_0x5b6366[_0x1ec8d6(0x1431)](_0xd799=>{const _0x2ea2ba=_0x1ec8d6,_0x17bd34=_0x402d2b[_0x2ea2ba(0x13f8)](_0xd799['productId']);return _0xd799[_0x2ea2ba(0xbcd)]?{'name':_0x17bd34['name']+'\x20-\x20'+_0xd799[_0x2ea2ba(0xbcd)]['name'],'price':_0xd799[_0x2ea2ba(0xbcd)][_0x2ea2ba(0x6ec)],'imageUrl':_0xd799[_0x2ea2ba(0xbcd)][_0x2ea2ba(0x48d)]||_0x17bd34['imageUrl'],'quantity':_0xd799[_0x2ea2ba(0x262)]}:{'name':_0x17bd34[_0x2ea2ba(0x5d2)],'price':_0x17bd34[_0x2ea2ba(0x6ec)],'imageUrl':_0x17bd34[_0x2ea2ba(0x48d)],'quantity':_0xd799[_0x2ea2ba(0x262)]};}),_0x5302a4={'role':'user','type':_0x1ec8d6(0x248),'timestamp':Date[_0x1ec8d6(0xd6e)](),'items':_0x2b474e,'total':_0x2b474e[_0x1ec8d6(0x7b6)]((_0xdc5af5,_0x2f8be2)=>_0xdc5af5+_0x2f8be2[_0x1ec8d6(0x6ec)]*_0x2f8be2[_0x1ec8d6(0x262)],0x0),'recipients':_0x53d696};_0x5c2154[_0x1ec8d6(0xce3)][_0x1ec8d6(0x1426)](_0x5302a4);if(_0x53d696&&_0x53d696[_0x1ec8d6(0x58a)]>0x0){const _0x4cd94d=_0x53d696[_0x1ec8d6(0x1431)](_0x34af4e=>_0x140540(_0x5c2154,_0x34af4e))[_0x1ec8d6(0x1143)]('、'),_0x5784c4={'role':'system','content':_0x1ec8d6(0x2fc)+(_0x5c2154[_0x1ec8d6(0x6a8)][_0x1ec8d6(0xe31)]||'我')+_0x1ec8d6(0x3bf)+_0x4cd94d+_0x1ec8d6(0x11fb),'timestamp':Date[_0x1ec8d6(0xd6e)]()+0x1,'isHidden':!![]};_0x5c2154['history'][_0x1ec8d6(0x1426)](_0x5784c4);}await _0x3df81a[_0x1ec8d6(0x589)][_0x1ec8d6(0x295)](_0x5c2154),_0x5286f1(_0x5302a4,_0x5c2154),_0x1033ae(),_0x126669=_0x126669[_0x1ec8d6(0xede)](_0x19ba53=>!_0x5b6366[_0x1ec8d6(0x690)](_0x539094=>_0x539094[_0x1ec8d6(0x12f6)]===_0x19ba53[_0x1ec8d6(0x12f6)])),_0x552ba0(),_0x2e53fa(_0x1ec8d6(0x13c3)),await _0x1460c5('成功',_0x1ec8d6(0x7da));}function _0xe31fb(_0x48ec79){const _0x4388e5=_0x2b1222,_0x58907c=_0x1ae02e[_0x4388e5(0x589)][_0x1ae02e[_0x4388e5(0x588)]],_0xca5328=_0x58907c[_0x4388e5(0xce3)][_0x4388e5(0x13b7)](_0x363dde=>_0x363dde[_0x4388e5(0x1388)]===_0x48ec79);if(!_0xca5328||_0xca5328[_0x4388e5(0xcbd)]!==_0x4388e5(0x248))return;const _0xe1055f=document['getElementById'](_0x4388e5(0x510));let _0x71eaef='';_0xca5328['items']['forEach'](_0x24cd55=>{const _0x2ad4c0=_0x4388e5;_0x71eaef+='<tr><td\x20class=\x22item-name\x22>'+_0x24cd55[_0x2ad4c0(0x5d2)]+_0x2ad4c0(0xda1)+_0x24cd55[_0x2ad4c0(0x262)]+_0x2ad4c0(0x331)+_0x24cd55[_0x2ad4c0(0x6ec)][_0x2ad4c0(0x24f)](0x2)+'</td><td\x20class=\x22item-subtotal\x22>¥'+(_0x24cd55[_0x2ad4c0(0x6ec)]*_0x24cd55['quantity'])[_0x2ad4c0(0x24f)](0x2)+_0x2ad4c0(0x9d3);}),_0xe1055f[_0x4388e5(0xf21)]='<div\x20class=\x22receipt-header\x22><h3>购物中心</h3><p>交易时间:\x20'+new Date(_0xca5328['timestamp'])['toLocaleString']()+_0x4388e5(0x694)+_0x71eaef+_0x4388e5(0xafe)+_0xca5328[_0x4388e5(0x32d)][_0x4388e5(0x24f)](0x2)+_0x4388e5(0x2c5),document[_0x4388e5(0x1f4)](_0x4388e5(0x1a8))[_0x4388e5(0x159b)][_0x4388e5(0x6a4)]('visible');}async function _0x25b813(_0x54e358=null){const _0x373fe8=_0x2b1222;_0x1f45c5=_0x54e358;const _0x2f18ba=document['getElementById']('product-editor-modal'),_0x23faed=document[_0x373fe8(0x1f4)](_0x373fe8(0x56c)),_0x247e6e=document[_0x373fe8(0x1f4)](_0x373fe8(0xc15)),_0x5e369f=document[_0x373fe8(0x1f4)](_0x373fe8(0x99a)),_0x55ce63=document[_0x373fe8(0x1f4)](_0x373fe8(0x36d)),_0x27079e=document[_0x373fe8(0x1f4)]('product-image-preview'),_0xa112d0=document[_0x373fe8(0x1f4)](_0x373fe8(0x8a2)),_0x4ff7d1=document['getElementById'](_0x373fe8(0x808));_0x4ff7d1[_0x373fe8(0xf21)]='',_0xa112d0[_0x373fe8(0xf21)]=_0x373fe8(0x263);const _0x575f3d=await _0x3df81a[_0x373fe8(0xca5)][_0x373fe8(0x27a)]();_0x575f3d[_0x373fe8(0x59b)](_0xf6b9eb=>{const _0x1507c4=_0x373fe8,_0x4eb8cf=document[_0x1507c4(0x219)]('option');_0x4eb8cf[_0x1507c4(0x107e)]=_0xf6b9eb['id'],_0x4eb8cf[_0x1507c4(0x231)]=_0xf6b9eb['name'],_0xa112d0[_0x1507c4(0x6ce)](_0x4eb8cf);});if(_0x54e358){_0x23faed[_0x373fe8(0x231)]='编辑商品';const _0x116f23=await _0x3df81a[_0x373fe8(0xbf4)]['get'](_0x54e358);_0x247e6e[_0x373fe8(0x107e)]=_0x116f23[_0x373fe8(0x5d2)],_0x5e369f[_0x373fe8(0x107e)]=_0x116f23[_0x373fe8(0x6ec)],_0x55ce63['value']=_0x116f23[_0x373fe8(0xdec)]||'',_0x27079e[_0x373fe8(0x9fe)]=_0x116f23[_0x373fe8(0x48d)],_0xa112d0[_0x373fe8(0x107e)]=_0x116f23[_0x373fe8(0x1467)]||'',_0x116f23[_0x373fe8(0x7ec)]&&_0x116f23['variations'][_0x373fe8(0x58a)]>0x0&&_0x116f23['variations'][_0x373fe8(0x59b)](_0x221e52=>_0x15c396(_0x221e52));}else _0x23faed[_0x373fe8(0x231)]=_0x373fe8(0x129f),_0x247e6e[_0x373fe8(0x107e)]='',_0x5e369f[_0x373fe8(0x107e)]='',_0x55ce63['value']='',_0x27079e[_0x373fe8(0x9fe)]='https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756206115802_qdqqd_0c99bh.jpeg',_0xa112d0['value']='';_0x2f18ba['classList'][_0x373fe8(0x6a4)](_0x373fe8(0xfca));}async function _0x4a1825(){const _0x3a0764=_0x2b1222,_0x44e9a0=document[_0x3a0764(0x1f4)](_0x3a0764(0xc15))['value'][_0x3a0764(0x4a2)](),_0x1c408e=parseFloat(document[_0x3a0764(0x1f4)]('product-price-input')[_0x3a0764(0x107e)]),_0x20f023=document[_0x3a0764(0x1f4)](_0x3a0764(0x36d))[_0x3a0764(0x107e)][_0x3a0764(0x4a2)](),_0x14af03=document[_0x3a0764(0x1f4)](_0x3a0764(0x15ba))[_0x3a0764(0x9fe)],_0x175656=parseInt(document[_0x3a0764(0x1f4)]('product-category-select')[_0x3a0764(0x107e)])||null;if(!_0x44e9a0){alert(_0x3a0764(0xbe4));return;}if(isNaN(_0x1c408e)||_0x1c408e<0x0){alert('请输入有效的默认价格！');return;}const _0x50cc2f=[];document[_0x3a0764(0x14bf)](_0x3a0764(0xfc8))[_0x3a0764(0x59b)](_0x5b773c=>{const _0x16fa9f=_0x3a0764,_0xa3b29=_0x5b773c[_0x16fa9f(0xeda)]('.variation-name-input')[_0x16fa9f(0x107e)][_0x16fa9f(0x4a2)](),_0x4fd246=parseFloat(_0x5b773c[_0x16fa9f(0xeda)](_0x16fa9f(0xcd5))[_0x16fa9f(0x107e)]),_0x3e344e=_0x5b773c[_0x16fa9f(0xeda)](_0x16fa9f(0x14d2))[_0x16fa9f(0x9fe)];_0xa3b29&&!isNaN(_0x4fd246)&&_0x4fd246>=0x0&&_0x50cc2f[_0x16fa9f(0x1426)]({'name':_0xa3b29,'price':_0x4fd246,'imageUrl':_0x3e344e['includes'](_0x16fa9f(0xb56))?null:_0x3e344e});});const _0x4777ef={'name':_0x44e9a0,'price':_0x1c408e,'description':_0x20f023,'imageUrl':_0x14af03,'categoryId':_0x175656,'variations':_0x50cc2f};_0x1f45c5?await _0x3df81a[_0x3a0764(0xbf4)][_0x3a0764(0xf18)](_0x1f45c5,_0x4777ef):await _0x3df81a['shoppingProducts'][_0x3a0764(0x6a4)](_0x4777ef),document[_0x3a0764(0x1f4)](_0x3a0764(0x1593))['classList'][_0x3a0764(0xa9c)]('visible'),await _0x4faebc();}async function _0x54bb4b(){const _0x2abea6=_0x2b1222;await _0x2cf8c6(),_0x2e53fa(_0x2abea6(0xd88));}async function _0x2cf8c6(){const _0x59849e=_0x2b1222,_0x3448fd=document[_0x59849e(0x1f4)](_0x59849e(0x1528)),_0x28ee74=document[_0x59849e(0x1f4)](_0x59849e(0x2b1));_0x3448fd[_0x59849e(0xf21)]='',_0x28ee74['innerHTML']='';const _0x4e109f=await _0x3df81a['renderingRules'][_0x59849e(0x27a)]();if(_0x4e109f[_0x59849e(0x58a)]===0x0){_0x28ee74[_0x59849e(0xf21)]='<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20margin-top:\x2050px;\x22>还没有任何渲染规则。点击右上角“+”创建第一个吧！</p>';return;}const _0x21fcd8=document[_0x59849e(0x219)]('button');_0x21fcd8[_0x59849e(0x7c6)]='rules-tab\x20active',_0x21fcd8[_0x59849e(0x231)]=_0x59849e(0x5b1),_0x21fcd8[_0x59849e(0x746)][_0x59849e(0x1467)]=_0x59849e(0x667),_0x3448fd[_0x59849e(0x6ce)](_0x21fcd8);const _0x4f8d66=document[_0x59849e(0x219)](_0x59849e(0xaf9));_0x4f8d66[_0x59849e(0x7c6)]=_0x59849e(0x125d),_0x4f8d66['dataset'][_0x59849e(0x1467)]=_0x59849e(0x667),_0x28ee74[_0x59849e(0x6ce)](_0x4f8d66);const _0x5af6cc=Object[_0x59849e(0x753)](_0x1ae02e[_0x59849e(0x589)])['filter'](_0x348b49=>!_0x348b49['isGroup']&&_0x4e109f[_0x59849e(0x690)](_0x387c70=>_0x387c70[_0x59849e(0x3e0)]===_0x348b49['id']));_0x5af6cc[_0x59849e(0x59b)](_0xf8b6d0=>{const _0x5ed20=_0x59849e,_0x54961f=document['createElement'](_0x5ed20(0xd2d));_0x54961f[_0x5ed20(0x7c6)]=_0x5ed20(0x3b4),_0x54961f['textContent']=_0xf8b6d0[_0x5ed20(0x5d2)],_0x54961f[_0x5ed20(0x746)][_0x5ed20(0x1467)]=_0xf8b6d0['id'],_0x3448fd[_0x5ed20(0x6ce)](_0x54961f);const _0x2f48d2=document[_0x5ed20(0x219)](_0x5ed20(0xaf9));_0x2f48d2['className']=_0x5ed20(0x5de),_0x2f48d2[_0x5ed20(0x746)][_0x5ed20(0x1467)]=_0xf8b6d0['id'],_0x28ee74[_0x5ed20(0x6ce)](_0x2f48d2);}),_0x4e109f[_0x59849e(0x59b)](_0x3cd303=>{const _0x48fb7c=_0x59849e,_0x1d857d=_0x1ddc3b(_0x3cd303),_0x57fd75=_0x28ee74[_0x48fb7c(0xeda)](_0x48fb7c(0x107f)+_0x3cd303[_0x48fb7c(0x3e0)]+'\x22]');_0x57fd75&&_0x57fd75[_0x48fb7c(0x6ce)](_0x1d857d);}),document['querySelectorAll'](_0x59849e(0x228))[_0x59849e(0x59b)](_0x42865b=>{const _0x1c6e07=_0x59849e;_0x42865b[_0x1c6e07(0x122b)]('click',()=>_0x576cd2(_0x42865b['dataset'][_0x1c6e07(0x1467)]));});}function _0x1ddc3b(_0x1ce3a6){const _0x1b8956=_0x2b1222,_0x26e1f4=document[_0x1b8956(0x219)](_0x1b8956(0xaf9));return _0x26e1f4[_0x1b8956(0x7c6)]='rule-card\x20'+(_0x1ce3a6[_0x1b8956(0x63d)]?_0x1b8956(0x1368):''),_0x26e1f4[_0x1b8956(0x746)]['ruleId']=_0x1ce3a6['id'],_0x26e1f4['innerHTML']=_0x1b8956(0xfc4)+_0x1ce3a6[_0x1b8956(0x5d2)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-content-preview\x22>'+_0x1ce3a6[_0x1b8956(0xf04)]+_0x1b8956(0x722),_0x26e1f4[_0x1b8956(0x122b)](_0x1b8956(0x740),()=>_0x17e3bd(_0x1ce3a6['id'])),_0x1160f3(_0x26e1f4,()=>_0x9ea562(_0x1ce3a6['id'])),_0x26e1f4;}async function _0x17e3bd(_0x26cbd8=null){const _0x2895a4=_0x2b1222;_0x2a8ade=_0x26cbd8;const _0x4ec9f5=document[_0x2895a4(0x1f4)](_0x2895a4(0xdfa)),_0x20e101=document[_0x2895a4(0x1f4)](_0x2895a4(0xb6e)),_0x4400c1=document[_0x2895a4(0x1f4)](_0x2895a4(0x6f1)),_0x5bc07b=document['getElementById'](_0x2895a4(0xef9)),_0x62e4e0=document[_0x2895a4(0x1f4)](_0x2895a4(0x582)),_0x5b42a5=document['getElementById']('rule-template-input'),_0x39b77f=document[_0x2895a4(0x1f4)]('rule-enabled-switch');_0x5bc07b[_0x2895a4(0xf21)]='<option\x20value=\x22global\x22>公用\x20(所有角色)</option>',Object[_0x2895a4(0x753)](_0x1ae02e[_0x2895a4(0x589)])[_0x2895a4(0xede)](_0x8ff0a4=>!_0x8ff0a4[_0x2895a4(0xe83)])[_0x2895a4(0x59b)](_0x889cd9=>{const _0x4426f7=_0x2895a4;_0x5bc07b['innerHTML']+=_0x4426f7(0x732)+_0x889cd9['id']+'\x22>'+_0x889cd9[_0x4426f7(0x5d2)]+_0x4426f7(0x3cc);});if(_0x26cbd8){_0x20e101[_0x2895a4(0x231)]=_0x2895a4(0xeb1);const _0x4687ec=await _0x3df81a[_0x2895a4(0xd2c)][_0x2895a4(0x13f8)](_0x26cbd8);_0x4400c1['value']=_0x4687ec['name'],_0x5bc07b['value']=_0x4687ec[_0x2895a4(0x3e0)],_0x62e4e0[_0x2895a4(0x107e)]=_0x4687ec[_0x2895a4(0xf04)],_0x5b42a5[_0x2895a4(0x107e)]=_0x4687ec[_0x2895a4(0x1532)],_0x39b77f['checked']=_0x4687ec[_0x2895a4(0x63d)];}else _0x20e101[_0x2895a4(0x231)]=_0x2895a4(0x165),_0x4400c1[_0x2895a4(0x107e)]='',_0x5bc07b[_0x2895a4(0x107e)]=_0x2895a4(0x667),_0x62e4e0['value']='',_0x5b42a5[_0x2895a4(0x107e)]='',_0x39b77f[_0x2895a4(0xe56)]=!![];_0x4ec9f5[_0x2895a4(0x159b)][_0x2895a4(0x6a4)](_0x2895a4(0xfca));}async function _0x4fea28(){const _0x59655a=_0x2b1222,_0x37d144=document[_0x59655a(0x1f4)](_0x59655a(0x6f1))['value'][_0x59655a(0x4a2)](),_0x5bc66c=document['getElementById'](_0x59655a(0x582))[_0x59655a(0x107e)][_0x59655a(0x4a2)]();if(!_0x37d144||!_0x5bc66c){alert('规则名称和正则表达式不能为空！');return;}try{new RegExp(_0x5bc66c);}catch(_0x30a780){alert(_0x59655a(0x520)+_0x30a780[_0x59655a(0x11f0)]);return;}const _0x17fe29={'name':_0x37d144,'chatId':document[_0x59655a(0x1f4)](_0x59655a(0xef9))['value'],'regex':_0x5bc66c,'template':document[_0x59655a(0x1f4)](_0x59655a(0x85d))['value'],'isEnabled':document['getElementById']('rule-enabled-switch')[_0x59655a(0xe56)]};_0x2a8ade?await _0x3df81a['renderingRules'][_0x59655a(0xf18)](_0x2a8ade,_0x17fe29):await _0x3df81a[_0x59655a(0xd2c)][_0x59655a(0x6a4)](_0x17fe29),document['getElementById'](_0x59655a(0xdfa))[_0x59655a(0x159b)]['remove'](_0x59655a(0xfca)),await _0x2cf8c6();}async function _0x9ea562(_0x2bad40){const _0x578af8=_0x2b1222,_0x9edcb=await _0x109970(_0x578af8(0x131d),_0x578af8(0x71e),{'confirmButtonClass':'btn-danger'});_0x9edcb&&(await _0x3df81a[_0x578af8(0xd2c)][_0x578af8(0xc40)](_0x2bad40),await _0x2cf8c6());}async function _0x3f4407(_0x6f7c29,_0x43d60d){const _0x146f58=_0x2b1222;if(_0x6f7c29[_0x146f58(0x4a2)]()[_0x146f58(0xebf)]('<')||!_0x6f7c29[_0x146f58(0xe82)]('[')&&!_0x6f7c29[_0x146f58(0xe82)]('{'))return _0x6f7c29;const _0x33d46e=await _0x3df81a[_0x146f58(0xd2c)][_0x146f58(0x478)](_0x146f58(0x3e0))['equals'](_0x146f58(0x667))['or'](_0x146f58(0x3e0))[_0x146f58(0x49d)](_0x43d60d)['toArray']();let _0x6ccc00=_0x6f7c29;for(const _0x1065d8 of _0x33d46e[_0x146f58(0xede)](_0x16a610=>_0x16a610[_0x146f58(0x63d)])){try{const _0x25bd91=new RegExp(_0x1065d8[_0x146f58(0xf04)],'g');_0x25bd91['test'](_0x6ccc00)&&(_0x6ccc00=_0x6ccc00[_0x146f58(0xef0)](_0x25bd91,_0x1065d8['template']));}catch(_0x18fd6b){console['error']('渲染规则\x20['+_0x1065d8['name']+']\x20的正则表达式无效:',_0x18fd6b);}}return _0x6ccc00;}async function _0x54bb4b(){const _0x203118=_0x2b1222;await _0x2cf8c6(),_0x2e53fa(_0x203118(0xd88));}async function _0x2cf8c6(){const _0x1a8c9b=_0x2b1222,_0x461d56=document['getElementById'](_0x1a8c9b(0x1528)),_0x5ce2eb=document['getElementById'](_0x1a8c9b(0x2b1));_0x461d56[_0x1a8c9b(0xf21)]='',_0x5ce2eb[_0x1a8c9b(0xf21)]='';const _0x3373ff=await _0x3df81a['renderingRules'][_0x1a8c9b(0x27a)]();if(_0x3373ff[_0x1a8c9b(0x58a)]===0x0){_0x5ce2eb[_0x1a8c9b(0xf21)]='<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20margin-top:\x2050px;\x22>还没有任何渲染规则。点击右上角“+”创建第一个吧！</p>';return;}const _0x312187=document[_0x1a8c9b(0x219)](_0x1a8c9b(0xd2d));_0x312187['className']=_0x1a8c9b(0x959),_0x312187[_0x1a8c9b(0x231)]='公用规则',_0x312187[_0x1a8c9b(0x746)]['categoryId']=_0x1a8c9b(0x667),_0x461d56[_0x1a8c9b(0x6ce)](_0x312187);const _0x4eaf61=document[_0x1a8c9b(0x219)]('div');_0x4eaf61[_0x1a8c9b(0x7c6)]='rules-category-pane\x20active',_0x4eaf61[_0x1a8c9b(0x746)]['categoryId']=_0x1a8c9b(0x667),_0x5ce2eb[_0x1a8c9b(0x6ce)](_0x4eaf61);const _0x5e82e7=Object[_0x1a8c9b(0x753)](_0x1ae02e[_0x1a8c9b(0x589)])[_0x1a8c9b(0xede)](_0x358be6=>!_0x358be6['isGroup']&&_0x3373ff['some'](_0x2d7ed2=>_0x2d7ed2['chatId']===_0x358be6['id']));_0x5e82e7[_0x1a8c9b(0x59b)](_0x539d70=>{const _0x115f32=_0x1a8c9b,_0x32eb9c=document[_0x115f32(0x219)]('button');_0x32eb9c[_0x115f32(0x7c6)]='rules-tab',_0x32eb9c[_0x115f32(0x231)]=_0x539d70[_0x115f32(0x5d2)],_0x32eb9c[_0x115f32(0x746)][_0x115f32(0x1467)]=_0x539d70['id'],_0x461d56[_0x115f32(0x6ce)](_0x32eb9c);const _0x5d7680=document[_0x115f32(0x219)](_0x115f32(0xaf9));_0x5d7680[_0x115f32(0x7c6)]=_0x115f32(0x5de),_0x5d7680[_0x115f32(0x746)]['categoryId']=_0x539d70['id'],_0x5ce2eb[_0x115f32(0x6ce)](_0x5d7680);}),_0x3373ff[_0x1a8c9b(0x59b)](_0x313591=>{const _0x320554=_0x1a8c9b,_0x52cf30=_0x1ddc3b(_0x313591),_0x10ed27=_0x5ce2eb[_0x320554(0xeda)](_0x320554(0x107f)+_0x313591['chatId']+'\x22]');_0x10ed27&&_0x10ed27['appendChild'](_0x52cf30);}),document[_0x1a8c9b(0x14bf)](_0x1a8c9b(0x228))['forEach'](_0x6150f2=>{const _0x407c8c=_0x1a8c9b;_0x6150f2[_0x407c8c(0x122b)](_0x407c8c(0x740),()=>_0x576cd2(_0x6150f2[_0x407c8c(0x746)][_0x407c8c(0x1467)]));});}function _0x1ddc3b(_0x36f35d){const _0x6436d3=_0x2b1222,_0x3881ad=document['createElement'](_0x6436d3(0xaf9));return _0x3881ad[_0x6436d3(0x7c6)]='rule-card\x20'+(_0x36f35d[_0x6436d3(0x63d)]?'enabled':''),_0x3881ad[_0x6436d3(0x746)][_0x6436d3(0xdc7)]=_0x36f35d['id'],_0x3881ad[_0x6436d3(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-title\x22>'+_0x36f35d['name']+_0x6436d3(0x212)+_0x36f35d[_0x6436d3(0xf04)]+_0x6436d3(0x722),_0x3881ad['addEventListener']('click',()=>_0x17e3bd(_0x36f35d['id'])),_0x1160f3(_0x3881ad,()=>_0x9ea562(_0x36f35d['id'])),_0x3881ad;}async function _0x17e3bd(_0x3aabbc=null){const _0xf8b8ea=_0x2b1222;_0x2a8ade=_0x3aabbc;const _0x36e9ad=document[_0xf8b8ea(0x1f4)](_0xf8b8ea(0xdfa)),_0x2ceba8=document[_0xf8b8ea(0x1f4)](_0xf8b8ea(0xb6e)),_0x4e3884=document[_0xf8b8ea(0x1f4)](_0xf8b8ea(0x6f1)),_0x485c04=document[_0xf8b8ea(0x1f4)]('rule-chat-id-select'),_0x2fb5e5=document[_0xf8b8ea(0x1f4)](_0xf8b8ea(0x582)),_0x4a302b=document[_0xf8b8ea(0x1f4)](_0xf8b8ea(0x85d)),_0x52b490=document[_0xf8b8ea(0x1f4)]('rule-enabled-switch');_0x485c04[_0xf8b8ea(0xf21)]=_0xf8b8ea(0xf00),Object['values'](_0x1ae02e[_0xf8b8ea(0x589)])[_0xf8b8ea(0xede)](_0x2efe71=>!_0x2efe71[_0xf8b8ea(0xe83)])['forEach'](_0x5e2cb1=>{const _0x2f0b5f=_0xf8b8ea;_0x485c04['innerHTML']+='<option\x20value=\x22'+_0x5e2cb1['id']+'\x22>'+_0x5e2cb1[_0x2f0b5f(0x5d2)]+_0x2f0b5f(0x3cc);});if(_0x3aabbc){_0x2ceba8['textContent']=_0xf8b8ea(0xeb1);const _0xaf88de=await _0x3df81a[_0xf8b8ea(0xd2c)]['get'](_0x3aabbc);_0x4e3884['value']=_0xaf88de['name'],_0x485c04[_0xf8b8ea(0x107e)]=_0xaf88de[_0xf8b8ea(0x3e0)],_0x2fb5e5[_0xf8b8ea(0x107e)]=_0xaf88de[_0xf8b8ea(0xf04)],_0x4a302b[_0xf8b8ea(0x107e)]=_0xaf88de[_0xf8b8ea(0x1532)],_0x52b490[_0xf8b8ea(0xe56)]=_0xaf88de[_0xf8b8ea(0x63d)];}else _0x2ceba8['textContent']=_0xf8b8ea(0x165),_0x4e3884[_0xf8b8ea(0x107e)]='',_0x485c04[_0xf8b8ea(0x107e)]=_0xf8b8ea(0x667),_0x2fb5e5[_0xf8b8ea(0x107e)]='',_0x4a302b[_0xf8b8ea(0x107e)]='',_0x52b490[_0xf8b8ea(0xe56)]=!![];_0x36e9ad['classList'][_0xf8b8ea(0x6a4)](_0xf8b8ea(0xfca));}async function _0x4fea28(){const _0x555cc7=_0x2b1222,_0x441583=document[_0x555cc7(0x1f4)]('rule-name-input')['value'][_0x555cc7(0x4a2)](),_0x5c5819=document[_0x555cc7(0x1f4)](_0x555cc7(0x582))['value']['trim']();if(!_0x441583||!_0x5c5819){alert(_0x555cc7(0x62f));return;}try{new RegExp(_0x5c5819);}catch(_0x1c6500){alert(_0x555cc7(0x520)+_0x1c6500[_0x555cc7(0x11f0)]);return;}const _0x5903ed={'name':_0x441583,'chatId':document[_0x555cc7(0x1f4)](_0x555cc7(0xef9))[_0x555cc7(0x107e)],'regex':_0x5c5819,'template':document[_0x555cc7(0x1f4)](_0x555cc7(0x85d))['value'],'isEnabled':document['getElementById'](_0x555cc7(0xb36))[_0x555cc7(0xe56)]};_0x2a8ade?await _0x3df81a[_0x555cc7(0xd2c)][_0x555cc7(0xf18)](_0x2a8ade,_0x5903ed):await _0x3df81a[_0x555cc7(0xd2c)]['add'](_0x5903ed),document[_0x555cc7(0x1f4)](_0x555cc7(0xdfa))[_0x555cc7(0x159b)][_0x555cc7(0xa9c)](_0x555cc7(0xfca)),await _0x2cf8c6();}async function _0x9ea562(_0xa4a91b){const _0x474f5a=_0x2b1222,_0x1d75da=await _0x109970(_0x474f5a(0x131d),_0x474f5a(0x71e),{'confirmButtonClass':_0x474f5a(0x1c6)});_0x1d75da&&(await _0x3df81a[_0x474f5a(0xd2c)][_0x474f5a(0xc40)](_0xa4a91b),await _0x2cf8c6());}async function _0x3f4407(_0xec3777,_0x5d65ab){const _0x55dda9=_0x2b1222;if(_0xec3777['trim']()[_0x55dda9(0xebf)]('<')||!_0xec3777[_0x55dda9(0xe82)]('[')&&!_0xec3777['includes']('{'))return _0xec3777;if(!_0x3913ad[_0x5d65ab]){console['log'](_0x55dda9(0x8c8)+_0x5d65ab);const _0x2e4489=await _0x3df81a[_0x55dda9(0xd2c)][_0x55dda9(0x478)](_0x55dda9(0x3e0))[_0x55dda9(0x49d)](_0x55dda9(0x667))['or'](_0x55dda9(0x3e0))['equals'](_0x5d65ab)[_0x55dda9(0x27a)]();_0x3913ad[_0x5d65ab]=_0x2e4489['filter'](_0x898944=>_0x898944[_0x55dda9(0x63d)]);}const _0x4a7882=_0x3913ad[_0x5d65ab];let _0x3f571d=_0xec3777;for(const _0x42651b of _0x4a7882){try{const _0xe67dd5=new RegExp(_0x42651b[_0x55dda9(0xf04)],'g');let _0x56c9c6=_0x3f571d;_0xe67dd5['test'](_0x56c9c6)&&(_0x3f571d=_0x3f571d[_0x55dda9(0xef0)](_0xe67dd5,_0x42651b['template']));}catch(_0x467fc0){console[_0x55dda9(0x127d)]('渲染规则\x20['+_0x42651b['name']+_0x55dda9(0x1533),_0x467fc0);}}return _0x3f571d;}function _0x474b99(_0x59b8de){const _0x5f49e1=_0x2b1222;if(!_0x59b8de)return'';const _0x21ac22=new Date(),_0x4a687c=new Date(_0x59b8de),_0x4c67f2=String(_0x4a687c[_0x5f49e1(0x4ee)]())[_0x5f49e1(0x1189)](0x2,'0'),_0x5800bb=String(_0x4a687c[_0x5f49e1(0x1465)]())[_0x5f49e1(0x1189)](0x2,'0'),_0x415f29=_0x4c67f2+':'+_0x5800bb;if(_0x21ac22[_0x5f49e1(0xee2)]()===_0x4a687c['toDateString']())return _0x415f29;const _0x35665d=new Date();_0x35665d[_0x5f49e1(0x1342)](_0x21ac22[_0x5f49e1(0x772)]()-0x1);if(_0x35665d[_0x5f49e1(0xee2)]()===_0x4a687c[_0x5f49e1(0xee2)]())return _0x5f49e1(0x5c6)+_0x415f29;const _0x2afbfd=_0x4a687c[_0x5f49e1(0x1567)](),_0x26bb3b=String(_0x4a687c[_0x5f49e1(0x45d)]()+0x1)[_0x5f49e1(0x1189)](0x2,'0'),_0x4863cf=String(_0x4a687c['getDate']())['padStart'](0x2,'0');return _0x21ac22['getFullYear']()===_0x2afbfd?_0x26bb3b+'月'+_0x4863cf+'日\x20'+_0x415f29:_0x2afbfd+'年'+_0x26bb3b+'月'+_0x4863cf+'日\x20'+_0x415f29;}function _0x4a4f71(_0x1a7583){const _0x409cfd=_0x2b1222,_0x3cbe12=document['createElement'](_0x409cfd(0xaf9));_0x3cbe12['className']=_0x409cfd(0x158b);const _0x2930eb=document[_0x409cfd(0x219)]('div');return _0x2930eb['className']='message-bubble\x20system-bubble',_0x2930eb[_0x409cfd(0x231)]=_0x474b99(_0x1a7583),_0x3cbe12['appendChild'](_0x2930eb),_0x3cbe12;}async function _0x1532bd(){const _0x192e41=_0x2b1222,_0x1d48c1=_0x1ae02e['chats'][_0x1ae02e['activeChatId']];if(!_0x1d48c1||!lastResponseTimestamps||lastResponseTimestamps['length']===0x0){alert(_0x192e41(0x1479));return;}_0x1d48c1['history']=_0x1d48c1[_0x192e41(0xce3)][_0x192e41(0xede)](_0x28127f=>!lastResponseTimestamps[_0x192e41(0xe82)](_0x28127f[_0x192e41(0x1388)])),await _0x3df81a['chats'][_0x192e41(0x295)](_0x1d48c1),await _0x3689f0(_0x1ae02e[_0x192e41(0x588)]),_0x39f47d();}async function _0x1416e1(_0xf30df0,_0x4cf8b6){const _0x271727=_0x2b1222;if(!_0x1ae02e[_0x271727(0x588)])return;const _0x46bea1=_0x1ae02e[_0x271727(0x589)][_0x1ae02e[_0x271727(0x588)]],_0x3a3a24=_0x46bea1[_0x271727(0xce3)]['findIndex'](_0x45aca9=>_0x45aca9[_0x271727(0x1388)]===_0xf30df0);if(_0x3a3a24===-0x1)return;const _0x539f74=_0x46bea1[_0x271727(0xce3)][_0x3a3a24],_0x34d571=_0x539f74[_0x271727(0x1063)];if(!_0x34d571){await _0x1460c5(_0x271727(0x43d),_0x271727(0x8c9));return;}_0x4cf8b6['disabled']=!![],_0x4cf8b6[_0x271727(0x159b)]['add']('loading');const _0x312360=_0x4cf8b6[_0x271727(0x96a)](_0x271727(0x251)),_0xe7697d=_0x312360?_0x312360['querySelector'](_0x271727(0x549)):null;_0xe7697d&&(_0xe7697d[_0x271727(0x215)][_0x271727(0x38d)]=_0x271727(0x862));try{const _0x37b85a=await _0x930e42(_0x34d571,_0x46bea1['id']);_0x539f74['imageUrl']=_0x37b85a[_0x271727(0x48d)],_0x539f74[_0x271727(0x936)]=_0x37b85a['fullPrompt'],await _0x3df81a[_0x271727(0x589)][_0x271727(0x295)](_0x46bea1),_0xe7697d&&(_0xe7697d[_0x271727(0x9fe)]=_0x37b85a[_0x271727(0x48d)],_0xe7697d['title']=_0x37b85a[_0x271727(0x936)],_0xe7697d[_0x271727(0x215)][_0x271727(0x38d)]='1');}catch(_0x49a457){console[_0x271727(0x127d)](_0x271727(0x82d),_0x49a457),await _0x1460c5(_0x271727(0x108a),_0x271727(0xe6e)+_0x49a457[_0x271727(0x11f0)]),_0xe7697d&&(_0xe7697d[_0x271727(0x215)][_0x271727(0x38d)]='1');}finally{_0x4cf8b6[_0x271727(0xa0d)]=![],_0x4cf8b6[_0x271727(0x159b)]['remove'](_0x271727(0x609));}}async function _0x42215c(){const _0x45ef13=_0x2b1222,_0x101d58=_0x1ae02e[_0x45ef13(0x589)][_0x1ae02e[_0x45ef13(0x588)]];if(!_0x101d58)return;const _0x57d3ea=_0x101d58[_0x45ef13(0xce3)][_0x45ef13(0x38f)](_0x41a581=>_0x41a581[_0x45ef13(0xfbb)]==='user'&&!_0x41a581[_0x45ef13(0x58e)]);if(_0x57d3ea===-0x1){alert(_0x45ef13(0x9e8));return;}const _0x27e89a=_0x101d58[_0x45ef13(0xce3)][_0x45ef13(0x38f)](_0xff8b29=>_0xff8b29[_0x45ef13(0xfbb)]===_0x45ef13(0x13c0));if(_0x27e89a<_0x57d3ea){alert('AI\x20尚未对您的最后一条消息做出回应，无法重新生成。');return;}_0x101d58['history']=_0x101d58[_0x45ef13(0xce3)][_0x45ef13(0x5cc)](0x0,_0x57d3ea+0x1),await _0x3df81a[_0x45ef13(0x589)][_0x45ef13(0x295)](_0x101d58),await _0x3689f0(_0x1ae02e[_0x45ef13(0x588)]),await _0x5626da();}async function _0x1ac7c3(){const _0x11b8fc=_0x2b1222;if(!_0x11ced0['isActive'])return;const _0xb216=_0x11ced0[_0x11b8fc(0x72a)][_0x11b8fc(0x38f)](_0x8b1c8b=>_0x8b1c8b[_0x11b8fc(0xfbb)]===_0x11b8fc(0x860));if(_0xb216===-0x1){alert(_0x11b8fc(0x9da));return;}_0x11ced0['callHistory'][_0x11b8fc(0x30b)](_0xb216+0x1);const _0x5ec506=document[_0x11b8fc(0x1f4)](_0x11b8fc(0x3a7));_0x5ec506[_0x11b8fc(0xf21)]='',_0x11ced0[_0x11b8fc(0x72a)][_0x11b8fc(0x59b)](_0x4cfa0c=>{const _0x54f9b2=_0x11b8fc,_0x267635=document[_0x54f9b2(0x219)](_0x54f9b2(0xaf9)),_0x4d6b25=_0x4cfa0c[_0x54f9b2(0xfbb)]===_0x54f9b2(0x13c0)?_0x54f9b2(0x980):_0x54f9b2(0x86d);_0x267635[_0x54f9b2(0x7c6)]=_0x54f9b2(0x10db)+_0x4d6b25,_0x267635[_0x54f9b2(0x746)][_0x54f9b2(0x1388)]=_0x4cfa0c[_0x54f9b2(0x1388)],_0x4cfa0c[_0x54f9b2(0xfbb)]===_0x54f9b2(0x860)?_0x267635[_0x54f9b2(0x231)]=_0x4cfa0c['content']:_0x267635[_0x54f9b2(0xf21)]=_0x4cfa0c[_0x54f9b2(0x128c)],_0x1160f3(_0x267635,()=>_0x240884(_0x4cfa0c['timestamp'])),_0x5ec506[_0x54f9b2(0x6ce)](_0x267635);}),_0x5ec506[_0x11b8fc(0x2d4)]=_0x5ec506[_0x11b8fc(0x1092)],_0x5e7bc2(null);}async function _0x3f8c33(){const _0x4bdc8e=_0x2b1222,_0x146b45=_0x1ae02e['chats'][_0x1ae02e[_0x4bdc8e(0x588)]];if(!_0x146b45)return;_0x450e6f(_0x146b45['id'],!![]);const _0x301c63=document['getElementById'](_0x4bdc8e(0x12a0));!_0x146b45[_0x4bdc8e(0xe83)]&&(_0x301c63[_0x4bdc8e(0x215)][_0x4bdc8e(0x38d)]=0x0,setTimeout(()=>{const _0x1f8745=_0x4bdc8e;_0x301c63['textContent']='对方正在输入...',_0x301c63[_0x1f8745(0x159b)][_0x1f8745(0x6a4)](_0x1f8745(0x5cd)),_0x301c63[_0x1f8745(0x215)][_0x1f8745(0x38d)]=0x1;},0xc8));try{const {proxyUrl:_0x3ce2de,apiKey:_0x58edcf,model:_0x267d9b}=_0x1ae02e['apiConfig'];if(!_0x3ce2de||!_0x58edcf||!_0x267d9b)throw new Error(_0x4bdc8e(0xcb7));const _0x5b040c=parseInt(_0x146b45[_0x4bdc8e(0x6a8)][_0x4bdc8e(0x4b2)])||0xa,_0x16cc5d=_0x146b45['history'][_0x4bdc8e(0x5cc)](-_0x5b040c),_0x5f1f8c=new Date(),_0x231467=new Date(_0x5f1f8c[_0x4bdc8e(0x457)]()+_0x5f1f8c['getTimezoneOffset']()*0xea60+0x36ee80*0x8),_0x221bab=_0x231467[_0x4bdc8e(0x613)](_0x4bdc8e(0xd02),{'timeZone':_0x4bdc8e(0x1001),'dateStyle':_0x4bdc8e(0x82e),'timeStyle':_0x4bdc8e(0x144f)}),_0x35c8ad=_0x1c13d6(_0x231467),_0x555c93=_0x146b45[_0x4bdc8e(0x6a8)]['myNickname']||'我';let _0x1fe009='';if(_0x146b45['settings']['linkedWorldBookIds']&&_0x146b45[_0x4bdc8e(0x6a8)][_0x4bdc8e(0x1469)][_0x4bdc8e(0x58a)]>0x0){const _0x5294e3=_0x146b45[_0x4bdc8e(0x6a8)][_0x4bdc8e(0x1469)][_0x4bdc8e(0x1431)](_0x25e487=>{const _0x85f98b=_0x4bdc8e,_0x1d0736=_0x1ae02e[_0x85f98b(0x1453)][_0x85f98b(0x13b7)](_0x5b4689=>_0x5b4689['id']===_0x25e487);if(!_0x1d0736||!Array[_0x85f98b(0x121f)](_0x1d0736['content']))return'';const _0x25c029=_0x1d0736['content'][_0x85f98b(0xede)](_0x1dc825=>_0x1dc825[_0x85f98b(0x1368)]!==![])[_0x85f98b(0x1431)](_0x21cf0=>{const _0x5d2c9c=_0x85f98b;let _0x75b075=_0x5d2c9c(0x272)+(_0x21cf0[_0x5d2c9c(0x306)]||_0x5d2c9c(0x286))+'\x0a';if(_0x21cf0[_0x5d2c9c(0x1378)][_0x5d2c9c(0x58a)]>0x0)_0x75b075+=_0x5d2c9c(0x935)+_0x21cf0['keys'][_0x5d2c9c(0x1143)](',\x20')+'\x0a';return _0x75b075+=_0x5d2c9c(0x3d9)+_0x21cf0[_0x5d2c9c(0x128c)],_0x75b075;})[_0x85f98b(0x1143)]('');return _0x25c029?_0x85f98b(0x404)+_0x1d0736[_0x85f98b(0x5d2)]+'\x0a'+_0x25c029:'';})[_0x4bdc8e(0xede)](Boolean)[_0x4bdc8e(0x1143)]('');_0x5294e3&&(_0x1fe009=_0x4bdc8e(0x855)+_0x5294e3+'\x0a#\x20---\x20世界书设定结束\x20---\x0a');}let _0x20edd3='';if(_0x5419de[_0x4bdc8e(0xd51)]&&_0x5419de[_0x4bdc8e(0x588)]===_0x146b45['id']){const _0x21bc2c=_0x5419de[_0x4bdc8e(0x541)]>-0x1?_0x5419de[_0x4bdc8e(0x560)][_0x5419de[_0x4bdc8e(0x541)]]:null;_0x20edd3=_0x4bdc8e(0x146e);}const _0x2e6b8c=_0xce74a4(_0x5aea9a[_0x146b45['id']]);let _0x256e8d='';_0x146b45[_0x4bdc8e(0x1515)]&&_0x146b45[_0x4bdc8e(0x1515)][_0x4bdc8e(0x58a)]>0x0&&(_0x256e8d=_0x4bdc8e(0x2c9)+_0x146b45['nameHistory'][_0x4bdc8e(0x1143)](',\x20')+_0x4bdc8e(0x774));let _0x2adbd1='';const _0x34837f=_0x1ae02e[_0x4bdc8e(0x11ef)][_0x4bdc8e(0xb46)]||'用户';_0x2adbd1+=_0x4bdc8e(0xa25)+_0x34837f+_0x4bdc8e(0x193);const _0x168ebf=Object[_0x4bdc8e(0x753)](_0x1ae02e[_0x4bdc8e(0x589)])['filter'](_0x3da44b=>_0x3da44b[_0x4bdc8e(0xe83)]&&_0x3da44b[_0x4bdc8e(0x1402)]['some'](_0x5231d3=>_0x5231d3['id']===_0x146b45['id']));_0x168ebf[_0x4bdc8e(0x58a)]>0x0&&(_0x2adbd1+=_0x4bdc8e(0x1181),_0x168ebf[_0x4bdc8e(0x59b)](_0x1efef8=>{const _0x396b62=_0x4bdc8e,_0x5eb357=_0x1efef8[_0x396b62(0x6a8)]['myNickname']||_0x34837f;_0x2adbd1+='\x20\x20-\x20在群聊“'+_0x1efef8[_0x396b62(0x5d2)]+_0x396b62(0x73b)+_0x5eb357+_0x396b62(0x136c);}));_0x2adbd1+='当你在任何系统提示、动态评论或挂载的群聊记忆中看到这些名字时，它们都指代的是【你的聊天对象】。';const _0x3e31e5=_0x1df3df(_0x146b45),_0xe409ab='\x0a#\x20身份与核心任务\x0a你正在扮演角色“'+_0x146b45[_0x4bdc8e(0x96f)]+_0x4bdc8e(0x15c7)+_0x221bab+'\x20('+_0x35c8ad+_0x4bdc8e(0x118a)+(_0x20edd3?'你们正在一起听歌，'+_0x20edd3:'你们没有在听歌。')+_0x4bdc8e(0xef2)+(_0x146b45[_0x4bdc8e(0x5fb)]&&_0x146b45[_0x4bdc8e(0x5fb)]['length']>0x0?_0x146b45[_0x4bdc8e(0x5fb)][_0x4bdc8e(0x1431)](_0x1a31a8=>'-\x20'+_0x1a31a8[_0x4bdc8e(0x128c)])[_0x4bdc8e(0x1143)]('\x0a'):_0x4bdc8e(0x1384))+_0x4bdc8e(0x374)+_0x146b45[_0x4bdc8e(0x6a8)][_0x4bdc8e(0xf42)]+_0x4bdc8e(0x1187)+_0x146b45['originalName']+'\x22\x20(核心身份，用于指令中的\x27name\x27字段)\x0a-\x20\x20\x20**用户给你的备注**:\x20\x22'+_0x146b45[_0x4bdc8e(0x5d2)]+'\x22\x20(你可以建议修改)\x0a-\x20\x20\x20**你对用户的称呼**:\x20“'+_0x555c93+_0x4bdc8e(0x871)+_0x2adbd1+_0x4bdc8e(0xbcb)+_0x256e8d+_0x4bdc8e(0xbcb)+_0x1fe009+_0x4bdc8e(0xc5d)+_0x3e31e5+'\x0a#\x20可用资源\x0a-\x20\x20\x20**你的头像库**:\x0a\x20\x20\x20\x20'+(_0x146b45[_0x4bdc8e(0x6a8)][_0x4bdc8e(0xb77)]&&_0x146b45[_0x4bdc8e(0x6a8)][_0x4bdc8e(0xb77)][_0x4bdc8e(0x58a)]>0x0?_0x146b45[_0x4bdc8e(0x6a8)][_0x4bdc8e(0xb77)]['map'](_0x2202e5=>'-\x20'+_0x2202e5[_0x4bdc8e(0x5d2)])['join']('\x0a'):_0x4bdc8e(0xe0e))+'\x0a-\x20\x20\x20**用户的头像库**:\x0a\x20\x20\x20\x20'+(_0x146b45[_0x4bdc8e(0x6a8)][_0x4bdc8e(0x12ce)]&&_0x146b45[_0x4bdc8e(0x6a8)][_0x4bdc8e(0x12ce)]['length']>0x0?_0x146b45['settings']['myAvatarLibrary']['map'](_0x21a13e=>'-\x20'+_0x21a13e[_0x4bdc8e(0x5d2)])[_0x4bdc8e(0x1143)]('\x0a'):'-\x20(空)')+'\x0a\x0a#\x20可用指令列表\x0a###\x20核心聊天指令\x0a-\x20\x20\x20**发文本**:\x20`{\x22type\x22:\x20\x22text\x22,\x20\x22content\x22:\x20\x22你好呀！\x22}`\x0a-\x20\x20\x20**发表情**:\x20`{\x22type\x22:\x20\x22sticker\x22,\x20\x22meaning\x22:\x20\x22表情的含义(必须从可用表情列表选择)\x22}`\x0a-\x20\x20\x20**发图片**:\x20`{\x22type\x22:\x20\x22ai_image\x22,\x20\x22description\x22:\x20\x22详细中文描述\x22}`\x0a-\x20\x20\x20**发语音**:\x20`{\x22type\x22:\x20\x22voice_message\x22,\x20\x22content\x22:\x20\x22语音文字内容\x22}`\x0a-\x20\x20\x20**引用回复**:\x20`{\x22type\x22:\x20\x22quote_reply\x22,\x20\x22target_timestamp\x22:\x20消息时间戳,\x20\x22reply_content\x22:\x20\x22回复内容\x22}`\x0a\x0a###\x20社交与互动指令\x0a-\x20\x20\x20**拍用户**:\x20`{\x22type\x22:\x20\x22pat_user\x22,\x20\x22suffix\x22:\x20\x22(可选)后缀\x22}`\x0a-\x20\x20\x20**分享链接**:\x20`{\x22type\x22:\x20\x22share_link\x22,\x20\x22title\x22:\x20\x22标题\x22,\x20\x22description\x22:\x20\x22摘要\x22,\x20\x22source_name\x22:\x20\x22来源\x22,\x20\x22content\x22:\x20\x22正文\x22}`\x0a-\x20\x20\x20**共享位置**:\x20\x27{\x22type\x22:\x20\x22location_share\x22,\x20\x22content\x22:\x20\x22你想分享的位置名\x22}\x27\x0a\x0a###\x20状态与关系指令\x0a-\x20\x20\x20**改自己备注**:\x20`{\x22type\x22:\x20\x22change_remark_name\x22,\x20\x22new_name\x22:\x20\x22新名字\x22}`\x0a-\x20\x20\x20**改用户称呼**:\x20`{\x22type\x22:\x20\x22change_user_nickname\x22,\x20\x22new_name\x22:\x20\x22新称呼\x22}`\x0a-\x20\x20\x20**换自己头像**:\x20`{\x22type\x22:\x20\x22change_avatar\x22,\x20\x22name\x22:\x20\x22头像名\x22}`\x20(从你头像库选)\x0a-\x20\x20\x20**换用户头像**:\x20`{\x22type\x22:\x20\x22change_user_avatar\x22,\x20\x22name\x22:\x20\x22头像名\x22}`\x20(从用户头像库选)\x0a-\x20\x20\x20**回应好友申请**:\x20`{\x22type\x22:\x20\x22friend_request_response\x22,\x20\x22decision\x22:\x20\x22accept\x22\x20or\x20\x22reject\x22}`\x0a-\x20\x20\x20**拉黑用户**:\x20`{\x22type\x22:\x20\x22block_user\x22}`\x0a\x0a###\x20特殊功能指令\x0a-\x20\x20\x20**记录回忆**:\x20`{\x22type\x22:\x20\x22create_memory\x22,\x20\x22description\x22:\x20\x22记录这件有意义的事。\x22}`\x0a-\x20\x20\x20**创建约定**:\x20`{\x22type\x22:\x20\x22create_countdown\x22,\x20\x22title\x22:\x20\x22约定标题\x22,\x20\x22date\x22:\x20\x22YYYY-MM-DDTHH:mm:ss\x22}`\x0a-\x20\x20\x20**切换歌曲**:\x20`{\x22type\x22:\x20\x22change_music\x22,\x20\x22song_name\x22:\x20\x22歌名\x22}`\x20(从播放列表选)\x0a-\x20\x20\x20**发起转账**:\x20`{\x22type\x22:\x20\x22transfer\x22,\x20\x22amount\x22:\x205.20,\x20\x22note\x22:\x20\x22备注\x22}`\x0a-\x20\x20\x20**回应转账**:\x20`{\x22type\x22:\x20\x22accept_transfer\x22,\x20\x22for_timestamp\x22:\x20时间戳}`\x20或\x20`{\x22type\x22:\x20\x22decline_transfer\x22,\x20\x22for_timestamp\x22:\x20时间戳}`\x0a-\x20\x20\x20**发起外卖代付**:\x20`{\x22type\x22:\x20\x22waimai_request\x22,\x20\x22productInfo\x22:\x20\x22商品\x22,\x20\x22amount\x22:\x2025}`\x20(你想让【用户】帮你付钱时使用)\x0a-\x20\x20\x20**回应外卖代付**:\x20`{\x22type\x22:\x20\x22waimai_response\x22,\x20\x22status\x22:\x20\x22paid\x22\x20or\x20\x22rejected\x22,\x20\x22for_timestamp\x22:\x20时间戳}`\x0a-\x20\x20\x20**发起视频通话**:\x20`{\x22type\x22:\x20\x22video_call_request\x22}`\x0a-\x20\x20\x20**回应视频通话**:\x20`{\x22type\x22:\x20\x22video_call_response\x22,\x20\x22decision\x22:\x20\x22accept\x22\x20or\x20\x22reject\x22}`\x0a\x0a\x0a#\x20对话者的角色设定\x0a'+_0x146b45[_0x4bdc8e(0x6a8)][_0x4bdc8e(0x36b)]+'\x0a\x0a\x0a\x0a现在，请根据以上规则和下面的对话历史，继续进行对话。',_0x1bd41a=_0x16cc5d[_0x4bdc8e(0x1431)](_0xa57994=>({'role':_0xa57994[_0x4bdc8e(0xfbb)],'content':String(_0xa57994[_0x4bdc8e(0x128c)])}));_0x1bd41a[_0x4bdc8e(0x1426)]({'role':_0x4bdc8e(0x860),'content':'[系统指令：用户按下了“推进”按钮，现在轮到你主动行动了，请继续对话。]'});let _0x133d03=_0x3ce2de===GEMINI_API_URL,_0x408968=_0x16b978(_0x267d9b,_0x58edcf,_0xe409ab,_0x1bd41a);const _0x5bcd9f=_0x133d03?await fetch(_0x408968[_0x4bdc8e(0x258)],_0x408968[_0x4bdc8e(0xc6b)]):await fetch(_0x3ce2de+_0x4bdc8e(0x14c2),{'method':'POST','headers':{'Content-Type':_0x4bdc8e(0xa90),'Authorization':'Bearer\x20'+_0x58edcf},'body':JSON[_0x4bdc8e(0x994)]({'model':_0x267d9b,'messages':[{'role':_0x4bdc8e(0x1594),'content':_0xe409ab},..._0x1bd41a],'temperature':_0x1ae02e[_0x4bdc8e(0x12c0)][_0x4bdc8e(0x217)]||0.8})});if(!_0x5bcd9f['ok']){const _0x80abbb=await _0x5bcd9f[_0x4bdc8e(0xb84)]();throw new Error(_0x4bdc8e(0x47b)+_0x80abbb[_0x4bdc8e(0x127d)][_0x4bdc8e(0x11f0)]);}const _0x315fbf=await _0x5bcd9f[_0x4bdc8e(0xb84)](),_0x18503d=getGeminiResponseText(_0x315fbf),_0xddd31c=_0x1493d9(_0x18503d),_0xc61368=[];for(const _0x3f7d99 of _0xddd31c){if(_0x3f7d99[_0x4bdc8e(0xcbd)]==='text'&&typeof _0x3f7d99['content']===_0x4bdc8e(0x6c3)&&_0x3f7d99[_0x4bdc8e(0x128c)][_0x4bdc8e(0xe82)]('\x0a')){const _0x512fb5=_0x3f7d99[_0x4bdc8e(0x128c)][_0x4bdc8e(0x23f)](/\n+/)[_0x4bdc8e(0xede)](_0x566978=>_0x566978[_0x4bdc8e(0x4a2)]());_0x512fb5[_0x4bdc8e(0x59b)](_0x22f6c7=>{_0xc61368['push']({..._0x3f7d99,'content':_0x22f6c7});});}else _0xc61368['push'](_0x3f7d99);}let _0x42e241=Date['now']();for(const _0x1b42f5 of _0xc61368){const _0x15be7b={'role':'assistant','senderName':_0x146b45[_0x4bdc8e(0x96f)],'timestamp':_0x42e241++,'content':_0x1b42f5[_0x4bdc8e(0x128c)]||_0x1b42f5[_0x4bdc8e(0x11f0)],'type':_0x1b42f5[_0x4bdc8e(0xcbd)]||'text'};if(_0x1b42f5['type']===_0x4bdc8e(0x46b)){if(!_0x146b45[_0x4bdc8e(0xe83)]){if(_0x1b42f5[_0x4bdc8e(0x7a9)])_0x146b45[_0x4bdc8e(0xbae)]=String(_0x1b42f5[_0x4bdc8e(0x7a9)]);if(_0x1b42f5[_0x4bdc8e(0x2ba)])_0x146b45[_0x4bdc8e(0x3d2)]=String(_0x1b42f5[_0x4bdc8e(0x2ba)]);}continue;}_0x146b45[_0x4bdc8e(0xce3)][_0x4bdc8e(0x1426)](_0x15be7b),_0x5286f1(_0x15be7b,_0x146b45),await new Promise(_0x17f0fc=>setTimeout(_0x17f0fc,Math[_0x4bdc8e(0x13ae)]()*0x3e8+0x320));}await _0x3df81a['chats']['put'](_0x146b45),_0x1033ae();}catch(_0x41096f){console[_0x4bdc8e(0x127d)]('推进剧情失败:',_0x41096f),await _0x1460c5('操作失败',_0x4bdc8e(0xb92)+_0x41096f[_0x4bdc8e(0x11f0)]);}finally{_0x450e6f(_0x146b45['id'],![]);if(!_0x146b45[_0x4bdc8e(0xe83)]&&document[_0x4bdc8e(0x1f4)](_0x4bdc8e(0x12a0))){const _0xebae39=document[_0x4bdc8e(0x1f4)](_0x4bdc8e(0x12a0));_0xebae39['style'][_0x4bdc8e(0x38d)]=0x0,setTimeout(()=>{const _0x2d2a1e=_0x4bdc8e;_0xebae39[_0x2d2a1e(0x231)]=_0x146b45[_0x2d2a1e(0x5d2)],_0xebae39[_0x2d2a1e(0x159b)][_0x2d2a1e(0xa9c)]('typing-status'),_0xebae39[_0x2d2a1e(0x215)][_0x2d2a1e(0x38d)]=0x1;},0xc8);}}}function _0x5e2ecb(){const _0x61df63=_0x2b1222,_0xbb98d0=document[_0x61df63(0x1f4)](_0x61df63(0xddb)),_0x71a90e=_0x1ae02e[_0x61df63(0x12c0)][_0x61df63(0xe88)]||_0x2c09ea;_0x71a90e&&_0x71a90e['trim']()&&(_0xbb98d0[_0x61df63(0x9fe)]=_0x71a90e,_0xbb98d0[_0x61df63(0x9ab)]()['catch'](_0x49aff3=>console['log'](_0x61df63(0x1548),_0x49aff3)));}function _0x5556f9(){const _0x24965e=_0x2b1222;if(!_0x1ae02e[_0x24965e(0x12c0)]['widgetData'])return;for(const _0x24fc6c in _0x1ae02e[_0x24965e(0x12c0)][_0x24965e(0xd55)]){const _0x516eb2=document['getElementById'](_0x24fc6c),_0x52e493=_0x1ae02e[_0x24965e(0x12c0)][_0x24965e(0xd55)][_0x24fc6c];_0x516eb2&&(_0x516eb2[_0x24965e(0x1120)]===_0x24965e(0x15b3)?_0x516eb2['src']=_0x52e493:_0x516eb2[_0x24965e(0x231)]=_0x52e493);}}function _0x2cdf38(){return new Promise(_0x2e7823=>{const _0x1141d7=_0x475c,_0xd8db1f=document[_0x1141d7(0x219)](_0x1141d7(0x1557));_0xd8db1f[_0x1141d7(0xcbd)]='file',_0xd8db1f[_0x1141d7(0xa7d)]=_0x1141d7(0xc52),_0xd8db1f['onchange']=_0x44ccad=>{const _0x3ed0bb=_0x1141d7,_0x293ecf=_0x44ccad[_0x3ed0bb(0xb57)][_0x3ed0bb(0x8b1)][0x0];if(_0x293ecf){const _0x3b0acc=new FileReader();_0x3b0acc['onload']=_0x562bdc=>{_0x2e7823(_0x562bdc['target']['result']);},_0x3b0acc[_0x3ed0bb(0x21e)](_0x293ecf);}else _0x2e7823(null);},_0xd8db1f[_0x1141d7(0x740)]();});}async function _0x514ed1(_0x111fe6){const _0x4dc01d=_0x2b1222,_0x15f1cf=_0x111fe6['id'],_0x2b72c4=_0x111fe6[_0x4dc01d(0x231)],_0x1a064b=await _0x11f6fb('修改文字',_0x4dc01d(0x6ee),_0x2b72c4);if(_0x1a064b!==null&&_0x1a064b[_0x4dc01d(0x4a2)]()!==''){const _0x2bde6b=_0x1a064b[_0x4dc01d(0x4a2)]();_0x111fe6[_0x4dc01d(0x231)]=_0x2bde6b,_0x1ae02e['globalSettings'][_0x4dc01d(0xd55)][_0x15f1cf]=_0x2bde6b,await _0x3df81a[_0x4dc01d(0x12c0)][_0x4dc01d(0x295)](_0x1ae02e[_0x4dc01d(0x12c0)]),alert('文字已更新！');}}async function _0x559e32(_0x5a0a92){const _0x8fd941=_0x2b1222,_0x5b83e8=_0x5a0a92['id'],_0x62485e=await _0x12414d('修改图片',[{'text':_0x8fd941(0x1414),'value':_0x8fd941(0x13df)},{'text':_0x8fd941(0x13a3),'value':_0x8fd941(0x258)}]);let _0x7774db=null;if(_0x62485e==='local')_0x7774db=await _0x2cdf38();else _0x62485e==='url'&&(_0x7774db=await _0x11f6fb(_0x8fd941(0x865),_0x8fd941(0x1360),_0x5a0a92[_0x8fd941(0x9fe)],_0x8fd941(0x258)));if(_0x7774db&&_0x7774db[_0x8fd941(0x4a2)]()){const _0x53888a=_0x7774db[_0x8fd941(0x4a2)]();_0x5a0a92['src']=_0x53888a,_0x1ae02e[_0x8fd941(0x12c0)][_0x8fd941(0xd55)][_0x5b83e8]=_0x53888a,await _0x3df81a[_0x8fd941(0x12c0)][_0x8fd941(0x295)](_0x1ae02e[_0x8fd941(0x12c0)]),alert('图片已更新！');}else _0x62485e===_0x8fd941(0x258)&&_0x7774db!==null&&alert(_0x8fd941(0x11cb));}const _0x201a17={'getSongCache'(_0x3839ad,_0x7a9fb6){const _0x3075fc=_0x2b1222,_0x241b55=(_0x7a9fb6||_0x3075fc(0x54b))+':'+_0x3839ad;if(_0x1ae02e['cache']&&_0x1ae02e[_0x3075fc(0xe02)][_0x3075fc(0x182)]){const _0xc017dd=_0x1ae02e[_0x3075fc(0xe02)][_0x3075fc(0x182)]['get'](_0x241b55);if(_0xc017dd&&Date['now']()-_0xc017dd[_0x3075fc(0x1388)]<0x36ee80)return _0xc017dd[_0x3075fc(0xc6b)];}return null;},'setSongCache'(_0x5e54f9,_0x71850d,_0x3d300f){const _0x32d05d=_0x2b1222,_0x578b70=(_0x3d300f||_0x32d05d(0x54b))+':'+_0x5e54f9;if(!_0x1ae02e[_0x32d05d(0xe02)])_0x1ae02e[_0x32d05d(0xe02)]={};if(!_0x1ae02e[_0x32d05d(0xe02)][_0x32d05d(0x182)])_0x1ae02e['cache'][_0x32d05d(0x182)]=new Map();_0x1ae02e[_0x32d05d(0xe02)]['songs'][_0x32d05d(0x3d3)](_0x578b70,{'data':_0x71850d,'timestamp':Date[_0x32d05d(0xd6e)]()});}};typeof Http_Get_External===_0x2b1222(0x488)&&(window[_0x2b1222(0x4ed)]=function(_0x4b5b8d){return new Promise(_0x5101ad=>{const _0xa8e635=_0x475c;fetch(_0x4b5b8d)[_0xa8e635(0x14bc)](_0x3c143c=>_0x3c143c[_0xa8e635(0xb84)]()[_0xa8e635(0x3d1)](()=>_0x3c143c[_0xa8e635(0x40f)]()))[_0xa8e635(0x14bc)](_0x5101ad)[_0xa8e635(0x3d1)](()=>_0x5101ad(null));});});async function _0x286647(_0x33aad4){return await Http_Get_External(_0x33aad4);}function _0x36ed00(_0x48d15a){return new Promise(_0x5edf9f=>{const _0x4fa97d=_0x475c,_0x3df9b8=new Audio();_0x3df9b8[_0x4fa97d(0x122b)](_0x4fa97d(0x1057),()=>_0x5edf9f(!![]),{'once':!![]}),_0x3df9b8[_0x4fa97d(0x122b)](_0x4fa97d(0x127d),()=>_0x5edf9f(![]),{'once':!![]}),_0x3df9b8[_0x4fa97d(0x9fe)]=_0x48d15a;});}async function _0x5cc50b(_0x1d89e6,_0x373b61){const _0x1fa7a0=_0x2b1222;try{let _0x51c173=_0x1d89e6[_0x1fa7a0(0xef0)](/\s/g,'');_0x373b61&&(_0x51c173+='\x20'+_0x373b61[_0x1fa7a0(0xef0)](/\s/g,''));const _0x1332cd=_0x1fa7a0(0xd6f)+encodeURIComponent(_0x51c173);console[_0x1fa7a0(0x57e)](_0x1fa7a0(0x6e1),_0x1332cd);const _0x3e1599=await fetch(_0x1332cd);if(!_0x3e1599['ok'])throw new Error(_0x1fa7a0(0xf35)+_0x3e1599[_0x1fa7a0(0x1589)]);const _0x66d81f=await _0x3e1599[_0x1fa7a0(0xb84)]();if(_0x66d81f[_0x1fa7a0(0xd4c)]!==0xc8||!_0x66d81f[_0x1fa7a0(0xc6b)]||_0x66d81f[_0x1fa7a0(0xc6b)][_0x1fa7a0(0x58a)]===0x0)return console['log'](_0x1fa7a0(0x2a7),_0x66d81f),[];return _0x66d81f[_0x1fa7a0(0xc6b)][_0x1fa7a0(0x1431)](_0x904ba0=>({'name':_0x904ba0[_0x1fa7a0(0x693)],'artist':_0x904ba0[_0x1fa7a0(0x19e)],'id':_0x904ba0['id'],'cover':_0x904ba0['cover']||_0x1fa7a0(0x3c4),'source':_0x1fa7a0(0x15a6)}))['slice'](0x0,0x1e);}catch(_0x1d44d2){return console[_0x1fa7a0(0x127d)](_0x1fa7a0(0x5bb),_0x1d44d2),[];}}async function _0x21b1f5(_0x193967){const _0x445544=_0x2b1222;try{_0x193967=_0x193967[_0x445544(0xef0)](/\s/g,'');const _0x92213e=await _0x286647(_0x445544(0xaf8)+encodeURIComponent(_0x193967));if(!_0x92213e?.[_0x445544(0xc6b)]?.[_0x445544(0x58a)])return[];return _0x92213e[_0x445544(0xc6b)]['map'](_0x3a84d8=>({'name':_0x3a84d8[_0x445544(0x693)],'artist':_0x3a84d8[_0x445544(0x19e)],'id':_0x3a84d8['id'],'cover':_0x3a84d8[_0x445544(0xeac)]||_0x445544(0x1374),'source':_0x445544(0xa35)}))[_0x445544(0x5cc)](0x0,0x1e);}catch(_0x88c816){return console[_0x445544(0x127d)](_0x445544(0xb12),_0x88c816),[];}}async function _0x3e6207(){const _0x377ced=_0x2b1222,_0x152c4d=await _0x11f6fb('搜索歌曲','请输入\x20歌名\x20或\x20歌名-歌手');if(!_0x152c4d||!_0x152c4d['trim']())return;await _0x1460c5(_0x377ced(0x11b7),_0x377ced(0xf86));let _0x201340=_0x152c4d['trim'](),_0x44af64='';if(_0x152c4d[_0x377ced(0xe82)]('-')||_0x152c4d['includes']('–')){const _0x26358e=_0x152c4d['split'](/[-–]/);_0x201340=_0x26358e[0x0]['trim'](),_0x44af64=_0x26358e[_0x377ced(0x5cc)](0x1)[_0x377ced(0x1143)]('\x20')['trim']();}const [_0x286be4,_0x39d2c6]=await Promise[_0x377ced(0x54b)]([_0x5cc50b(_0x201340,_0x44af64),_0x21b1f5(_0x201340)]),_0x178441=[..._0x286be4,..._0x39d2c6];if(_0x178441[_0x377ced(0x58a)]===0x0){await _0x1460c5(_0x377ced(0x6df),_0x377ced(0x8da));return;}const _0x4ebc1c=document[_0x377ced(0x1f4)](_0x377ced(0x21d)),_0x28aa59=document[_0x377ced(0x1f4)]('search-results-list');_0x28aa59[_0x377ced(0xf21)]='',document['getElementById'](_0x377ced(0x737))[_0x377ced(0xe56)]=![],_0x178441[_0x377ced(0x59b)](_0xdfcbf3=>{const _0x4f9a7a=_0x377ced,_0xf9b87f=document['createElement'](_0x4f9a7a(0xaf9));_0xf9b87f['className']=_0x4f9a7a(0xf89),_0xf9b87f[_0x4f9a7a(0x746)]['songJson']=JSON[_0x4f9a7a(0x994)](_0xdfcbf3),_0xf9b87f[_0x4f9a7a(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22music-search-checkbox\x22\x20style=\x22margin-right:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22search-result-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22title\x22>'+_0xdfcbf3[_0x4f9a7a(0x5d2)]+_0x4f9a7a(0xe19)+_0xdfcbf3[_0x4f9a7a(0x1309)]+_0x4f9a7a(0x8b6)+(_0xdfcbf3[_0x4f9a7a(0xc36)]===_0x4f9a7a(0x15a6)?_0x4f9a7a(0x114f):_0x4f9a7a(0x6a6))+'</span></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x28aa59['appendChild'](_0xf9b87f);}),_0x4ebc1c['classList']['add'](_0x377ced(0xfca));}async function _0x550ed0(_0x224f80){const _0x49782f=_0x2b1222;let _0x5561ae=null,_0x4cdc73=_0x224f80[_0x49782f(0xc36)];const _0x25b482=_0x224f80[_0x49782f(0xc36)]===_0x49782f(0x15a6)?_0x49782f(0x9cc)+_0x224f80['id']:'https://api.vkeys.cn/v2/music/tencent?id='+_0x224f80['id'];let _0x279695=await _0x286647(_0x25b482);_0x279695?.[_0x49782f(0xc6b)]?.[_0x49782f(0x258)]&&(_0x5561ae={'url':_0x279695[_0x49782f(0xc6b)]['url'],'id':_0x224f80['id'],'source':_0x224f80[_0x49782f(0xc36)]});if(!_0x5561ae){const _0x4e7405=_0x224f80[_0x49782f(0xc36)]===_0x49782f(0x15a6)?_0x49782f(0xa35):_0x49782f(0x15a6),_0x51e668=_0x4e7405===_0x49782f(0xa35)?await _0x21b1f5(_0x224f80[_0x49782f(0x5d2)]):await _0x5cc50b(_0x224f80[_0x49782f(0x5d2)],_0x224f80[_0x49782f(0x1309)]);if(_0x51e668[_0x49782f(0x58a)]>0x0){const _0x137858=_0x4e7405==='netease'?_0x49782f(0x9cc)+_0x51e668[0x0]['id']:_0x49782f(0xeb6)+_0x51e668[0x0]['id'],_0x1dcdf4=await _0x286647(_0x137858);_0x1dcdf4?.[_0x49782f(0xc6b)]?.['url']&&(_0x5561ae={'url':_0x1dcdf4[_0x49782f(0xc6b)][_0x49782f(0x258)],'id':_0x51e668[0x0]['id'],'source':_0x4e7405},_0x4cdc73=_0x4e7405);}}if(_0x5561ae){_0x5561ae[_0x49782f(0x258)]&&typeof _0x5561ae['url']===_0x49782f(0x6c3)&&(_0x5561ae['url']=_0x5561ae['url'][_0x49782f(0xef0)](/^http:\/\//i,'https://'));_0x224f80['cover']&&typeof _0x224f80[_0x49782f(0xeac)]===_0x49782f(0x6c3)&&(_0x224f80[_0x49782f(0xeac)]=_0x224f80[_0x49782f(0xeac)][_0x49782f(0xef0)](/^http:\/\//i,'https://'));const _0x158f95=await _0x4d1a8b(_0x5561ae['id'],_0x4cdc73)||'';return{'name':_0x224f80[_0x49782f(0x5d2)],'artist':_0x224f80[_0x49782f(0x1309)],'src':_0x5561ae[_0x49782f(0x258)],'cover':_0x224f80['cover'],'isLocal':![],'lrcContent':_0x158f95};}return null;}async function _0x4d1a8b(_0xdfda9d,_0x5e456e){const _0x3e18bf=_0x2b1222,_0x44e26f=_0x5e456e===_0x3e18bf(0x15a6)?_0x3e18bf(0xca7)+_0xdfda9d:_0x3e18bf(0x1424)+_0xdfda9d,_0x3e0dad=await _0x286647(_0x44e26f);if(_0x3e0dad?.[_0x3e18bf(0xc6b)]){const _0x4c7728=_0x3e0dad[_0x3e18bf(0xc6b)][_0x3e18bf(0x15a1)]||_0x3e0dad[_0x3e18bf(0xc6b)]['lyric']||'',_0x1a6951=_0x3e0dad['data'][_0x3e18bf(0x17c)]||_0x3e0dad['data'][_0x3e18bf(0xf48)]||'';return _0x4c7728+'\x0a'+_0x1a6951;}return'';}async function _0x192e7a(_0x489a3c){const _0x312a16=_0x2b1222;if(_0x489a3c<0x0||_0x489a3c>=_0x5419de[_0x312a16(0x560)][_0x312a16(0x58a)])return;const _0x9e3e5=await _0x12414d(_0x312a16(0xeea),[{'text':_0x312a16(0x122c),'value':_0x312a16(0x5aa)},{'text':'📋\x20直接粘贴歌词文本','value':_0x312a16(0x10f9)}]);let _0x497422=null;if(_0x9e3e5==='file')_0x497422=await new Promise(_0x188ff1=>{const _0x778909=_0x312a16,_0xd82ec5=document[_0x778909(0x1f4)]('lrc-upload-input'),_0x30a77c=_0xb30ebb=>{const _0xea198e=_0x778909,_0x1eb119=_0xb30ebb[_0xea198e(0xb57)][_0xea198e(0x8b1)][0x0];if(_0x1eb119){const _0x37a827=new FileReader();_0x37a827[_0xea198e(0xcbe)]=_0x364e21=>_0x188ff1(_0x364e21[_0xea198e(0xb57)]['result']),_0x37a827[_0xea198e(0xdf5)]=()=>_0x188ff1(null),_0x37a827[_0xea198e(0x1263)](_0x1eb119);}else _0x188ff1(null);_0xd82ec5[_0xea198e(0x7f6)](_0xea198e(0x1147),_0x30a77c),_0xd82ec5[_0xea198e(0x107e)]='';};_0xd82ec5[_0x778909(0x122b)](_0x778909(0x1147),_0x30a77c,{'once':!![]}),_0xd82ec5[_0x778909(0x740)]();});else{if(_0x9e3e5===_0x312a16(0x10f9)){const _0x3aaa4e=await _0x11f6fb(_0x312a16(0x6fb),_0x312a16(0xe36),'',_0x312a16(0x1097));if(_0x3aaa4e)_0x497422=_0x3aaa4e['replace'](/\[/g,'\x0a[')['trim']();}}_0x497422!==null&&(_0x5419de[_0x312a16(0x560)][_0x489a3c]['lrcContent']=_0x497422,await _0x549080(),_0x5419de[_0x312a16(0x541)]===_0x489a3c&&(_0x5419de[_0x312a16(0xc78)]=_0x312b38(_0x497422),_0x3e5b8a(),_0x4ab3d4()),await _0x1460c5('成功','《'+_0x5419de['playlist'][_0x489a3c]['name']+_0x312a16(0x1348)));}async function _0x57529d(){const _0x4c58a7=_0x2b1222;if(_0x5419de['currentIndex']===-0x1)return;const _0x476fa2=_0x5419de[_0x4c58a7(0x560)][_0x5419de['currentIndex']];if(!_0x476fa2)return;_0x476fa2[_0x4c58a7(0x1367)]=!_0x476fa2[_0x4c58a7(0x1367)],await _0x549080();const _0x2b4f99=document[_0x4c58a7(0xeda)](_0x4c58a7(0xa91)),_0x1fb46d=document[_0x4c58a7(0x1f4)](_0x4c58a7(0x7a6));_0x2b4f99[_0x4c58a7(0x159b)][_0x4c58a7(0x1483)](_0x4c58a7(0xd6a),_0x476fa2['isBgClear']),_0x1fb46d[_0x4c58a7(0x159b)]['toggle']('active',_0x476fa2[_0x4c58a7(0x1367)]);}function _0x9005f8(){const _0x4363db=_0x2b1222,_0x335e0a=document[_0x4363db(0x1f4)](_0x4363db(0x59c)),_0x45ee59=document[_0x4363db(0x1f4)]('show-avatars-btn');_0x335e0a&&_0x45ee59&&(_0x335e0a['classList'][_0x4363db(0x1483)]('visible'),_0x45ee59[_0x4363db(0x159b)][_0x4363db(0x1483)]('active'));}function _0xf961e4(){const _0x4451aa=_0x2b1222,_0x17039e=document[_0x4451aa(0xeda)](_0x4451aa(0xa91)),_0x13ea95=document[_0x4451aa(0x1f4)]('music-player-overlay');_0x17039e&&_0x13ea95&&(_0x17039e[_0x4451aa(0x159b)][_0x4451aa(0x1483)]('fullscreen'),_0x13ea95[_0x4451aa(0x159b)][_0x4451aa(0x1483)](_0x4451aa(0xc75)));}window['togglePlayerFullscreen']=_0xf961e4;async function _0x2c5a3e(){const _0x3ba643=_0x2b1222;if(_0x5419de[_0x3ba643(0x560)][_0x3ba643(0x58a)]===0x0){alert(_0x3ba643(0x99b));return;}const _0x3070e9=await _0x109970(_0x3ba643(0xb72),_0x3ba643(0x131e),{'confirmText':'开始清理'});if(!_0x3070e9)return;await _0x1460c5(_0x3ba643(0x11b7),_0x3ba643(0x93d)+_0x5419de[_0x3ba643(0x560)]['length']+_0x3ba643(0x8e6));const _0x4cddff=_0x5419de[_0x3ba643(0x560)][_0x3ba643(0x58a)],_0x54026a=[],_0x2181e2=[],_0x43adfd=_0x5419de[_0x3ba643(0x560)][_0x3ba643(0x1431)](async _0x5b59e4=>{const _0x23e486=_0x3ba643;if(_0x5b59e4['isLocal']){_0x54026a[_0x23e486(0x1426)](_0x5b59e4);return;}const _0x1b9271=await _0x36ed00(_0x5b59e4[_0x23e486(0x9fe)]);_0x1b9271?_0x54026a['push'](_0x5b59e4):(_0x2181e2['push'](_0x5b59e4[_0x23e486(0x5d2)]),console[_0x23e486(0xb3b)](_0x23e486(0x10bd)+_0x5b59e4[_0x23e486(0x5d2)]+'\x20-\x20'+_0x5b59e4[_0x23e486(0x9fe)]));});await Promise[_0x3ba643(0x54b)](_0x43adfd);const _0x560f51=_0x4cddff-_0x54026a[_0x3ba643(0x58a)];if(_0x560f51>0x0){const _0x45bb90=_0x5419de[_0x3ba643(0x560)][_0x5419de[_0x3ba643(0x541)]],_0x26259b=_0x2181e2[_0x3ba643(0xe82)](_0x45bb90?.[_0x3ba643(0x5d2)]);_0x5419de[_0x3ba643(0x560)]=_0x54026a,await _0x549080();if(_0x26259b)_0x43beab[_0x3ba643(0x352)](),_0x43beab['src']='',_0x5419de[_0x3ba643(0x541)]=_0x5419de[_0x3ba643(0x560)][_0x3ba643(0x58a)]>0x0?0x0:-0x1,_0x5419de[_0x3ba643(0x14ce)]=![];else _0x45bb90&&(_0x5419de['currentIndex']=_0x5419de[_0x3ba643(0x560)][_0x3ba643(0xf2d)](_0x56d823=>_0x56d823[_0x3ba643(0x9fe)]===_0x45bb90[_0x3ba643(0x9fe)]));_0x13c03f(),_0x5d7946(),await _0x1460c5(_0x3ba643(0x1f2),_0x3ba643(0x1318)+_0x560f51+_0x3ba643(0x311)+_0x2181e2[_0x3ba643(0x1143)](_0x3ba643(0x5bf)));}else await _0x1460c5(_0x3ba643(0x81f),_0x3ba643(0x76f));}function _0x496c6d(){const _0x3638c9=_0x2b1222,_0x374651=document['getElementById'](_0x3638c9(0x296));_0x374651[_0x3638c9(0x159b)]['toggle']('status-bar-visible',!!_0x1ae02e['globalSettings'][_0x3638c9(0xad9)]);}async function _0x5157c4(){const _0x83f097=_0x2b1222,_0x2f315e=document['getElementById']('clear-posts-modal'),_0x1e8e87=document['getElementById']('clear-posts-list');_0x1e8e87['innerHTML']='';const _0x15db75=[];_0x15db75[_0x83f097(0x1426)]({'text':_0x83f097(0x5d5),'value':_0x83f097(0x54b),'isDanger':!![]});const _0x59626a=_0x1ae02e[_0x83f097(0x11ef)][_0x83f097(0xb46)]||'我';_0x15db75[_0x83f097(0x1426)]({'text':_0x83f097(0x15b1)+_0x59626a+_0x83f097(0xf64),'value':_0x83f097(0x860)}),Object['values'](_0x1ae02e[_0x83f097(0x589)])['forEach'](_0x3da052=>{const _0xd8a021=_0x83f097;!_0x3da052[_0xd8a021(0xe83)]&&_0x15db75[_0xd8a021(0x1426)]({'text':_0xd8a021(0x15b1)+_0x3da052[_0xd8a021(0x5d2)]+_0xd8a021(0x144c),'value':_0x3da052['id']});});try{const _0x1206a3=await _0x3df81a['npcs']['toArray']();_0x1206a3[_0x83f097(0x58a)]>0x0&&(_0x15db75[_0x83f097(0x1426)]({'isSeparator':!![],'text':_0x83f097(0x12a9)}),_0x1206a3[_0x83f097(0x59b)](_0x13cc60=>{const _0x30a09c=_0x83f097;_0x15db75['push']({'text':_0x30a09c(0x15b1)+_0x13cc60[_0x30a09c(0x5d2)]+_0x30a09c(0xbb3),'value':_0x30a09c(0x27f)+_0x13cc60['id']});}));}catch(_0x20fa23){console[_0x83f097(0x127d)]('加载NPC列表失败:',_0x20fa23);}_0x15db75[_0x83f097(0x59b)](_0x5c5d8a=>{const _0x433206=_0x83f097;if(_0x5c5d8a[_0x433206(0xa70)]){const _0x519a08=document[_0x433206(0x219)](_0x433206(0xaf9));_0x519a08[_0x433206(0x231)]=_0x5c5d8a[_0x433206(0x40f)],_0x519a08[_0x433206(0x215)][_0x433206(0x519)]=_0x433206(0x57c),_0x1e8e87[_0x433206(0x6ce)](_0x519a08);return;}const _0x5639ea=document[_0x433206(0x219)](_0x433206(0xaf9));_0x5639ea[_0x433206(0x7c6)]=_0x433206(0x151a),_0x5c5d8a[_0x433206(0x1040)]&&_0x5639ea['classList']['add']('danger-option'),_0x5639ea[_0x433206(0x746)][_0x433206(0x5a9)]=_0x5c5d8a[_0x433206(0x107e)],_0x5639ea[_0x433206(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>'+_0x5c5d8a[_0x433206(0x40f)]+_0x433206(0x12f5),_0x1e8e87[_0x433206(0x6ce)](_0x5639ea);}),_0x2f315e[_0x83f097(0x159b)]['add']('visible');}async function _0x18b24f(){const _0x39cb01=_0x2b1222,_0x34e4e0=document[_0x39cb01(0x14bf)](_0x39cb01(0x1499));if(_0x34e4e0['length']===0x0){alert(_0x39cb01(0xe92));return;}const _0x3d9b1c=Array['from'](_0x34e4e0)['map'](_0x24b064=>_0x24b064[_0x39cb01(0x746)][_0x39cb01(0x5a9)]);let _0x2216fc=[];_0x3d9b1c[_0x39cb01(0xe82)](_0x39cb01(0x54b))?_0x2216fc[_0x39cb01(0x1426)]('所有动态'):(_0x3d9b1c[_0x39cb01(0xe82)]('user')&&_0x2216fc[_0x39cb01(0x1426)]('“'+_0x1ae02e[_0x39cb01(0x11ef)][_0x39cb01(0xb46)]+'”'),_0x3d9b1c[_0x39cb01(0x59b)](_0x212c3c=>{const _0x44f855=_0x39cb01,_0xd1d389=_0x1ae02e[_0x44f855(0x589)][_0x212c3c];_0xd1d389&&_0x2216fc[_0x44f855(0x1426)]('“'+_0xd1d389[_0x44f855(0x5d2)]+'”');}));const _0x36eaa2=_0x39cb01(0x479)+_0x2216fc[_0x39cb01(0x1143)]('、\x20')+_0x39cb01(0xf34),_0x2c03c8=await _0x109970('确认清空动态？',_0x36eaa2,{'confirmButtonClass':'btn-danger','confirmText':'确认清空'});if(!_0x2c03c8)return;try{_0x3d9b1c['includes'](_0x39cb01(0x54b))?await _0x3df81a[_0x39cb01(0x910)][_0x39cb01(0x411)]():await _0x3df81a[_0x39cb01(0x910)][_0x39cb01(0x478)](_0x39cb01(0x12cf))['anyOf'](_0x3d9b1c)[_0x39cb01(0xc40)](),_0x6f01c2=await _0x3df81a[_0x39cb01(0x910)][_0x39cb01(0x931)](_0x39cb01(0x1388))[_0x39cb01(0x115a)]()[_0x39cb01(0x27a)](),_0x54afbd=0x0,await _0x28d6f7(),document[_0x39cb01(0x1f4)](_0x39cb01(0x4a0))['classList'][_0x39cb01(0xa9c)](_0x39cb01(0xfca)),await _0x1460c5(_0x39cb01(0x1539),_0x39cb01(0x196));}catch(_0x45c93e){console['error'](_0x39cb01(0x146f),_0x45c93e),await _0x1460c5(_0x39cb01(0xc5a),_0x39cb01(0xd5b)+_0x45c93e[_0x39cb01(0x11f0)]);}}async function _0x1186f6(_0x2eb0a3){const _0x4083da=_0x2b1222,_0xf37367=await _0x109970('确认删除',_0x4083da(0x7f2),{'confirmButtonClass':_0x4083da(0x1c6),'confirmText':_0x4083da(0xed1)});if(_0xf37367){const _0x19851a=_0x1ae02e['chats'][_0x1ae02e[_0x4083da(0x588)]];if(!_0x19851a||!_0x19851a[_0x4083da(0xc34)])return;const _0x4abc54=_0x19851a['thoughtsHistory'][_0x4083da(0xf2d)](_0x242fbf=>_0x242fbf[_0x4083da(0x1388)]===_0x2eb0a3);if(_0x4abc54===-0x1)return;const _0x5c9a26=_0x4abc54===_0x19851a['thoughtsHistory']['length']-0x1;_0x19851a[_0x4083da(0xc34)]=_0x19851a[_0x4083da(0xc34)][_0x4083da(0xede)](_0x288ac8=>_0x288ac8[_0x4083da(0x1388)]!==_0x2eb0a3);if(_0x5c9a26){if(_0x19851a[_0x4083da(0xc34)][_0x4083da(0x58a)]>0x0){const _0x1dd5de=_0x19851a['thoughtsHistory'][_0x19851a[_0x4083da(0xc34)][_0x4083da(0x58a)]-0x1];_0x19851a['heartfeltVoice']=_0x1dd5de[_0x4083da(0xbae)],_0x19851a['randomJottings']=_0x1dd5de['randomJottings'];const _0x418801=document[_0x4083da(0x1f4)](_0x4083da(0xa08)),_0x227d10=document[_0x4083da(0x1f4)]('profile-random-jottings');if(_0x418801)_0x418801['textContent']=_0x19851a[_0x4083da(0xbae)];if(_0x227d10)_0x227d10[_0x4083da(0x231)]=_0x19851a['randomJottings'];console[_0x4083da(0x57e)](_0x4083da(0xa6c));}else{_0x19851a[_0x4083da(0xbae)]='...',_0x19851a[_0x4083da(0x3d2)]=_0x4083da(0x629);const _0x2cc867=document[_0x4083da(0x1f4)]('profile-heartfelt-voice'),_0x53dcc7=document[_0x4083da(0x1f4)](_0x4083da(0xc7d));if(_0x2cc867)_0x2cc867['textContent']=_0x19851a[_0x4083da(0xbae)];if(_0x53dcc7)_0x53dcc7['textContent']=_0x19851a[_0x4083da(0x3d2)];console[_0x4083da(0x57e)]('已删除最后一条心声，当前心声已重置。');}}await _0x3df81a['chats'][_0x4083da(0x295)](_0x19851a),_0x5ddd5e(),await _0x1460c5('成功',_0x4083da(0x10aa));}}document[_0x2b1222(0x1f4)](_0x2b1222(0x11be))[_0x2b1222(0x122b)](_0x2b1222(0x740),_0x1fa39b=>{const _0xe218b=_0x2b1222,_0x3a7c29=_0x1fa39b['target'][_0xe218b(0x96a)](_0xe218b(0x6e7));if(_0x3a7c29){const _0x3095fd=parseInt(_0x3a7c29[_0xe218b(0x746)][_0xe218b(0x1388)]);!isNaN(_0x3095fd)&&_0x1186f6(_0x3095fd);}});async function _0x3299b7(){const _0xaf0cf7=_0x2b1222,_0x11f723=document[_0xaf0cf7(0x1f4)]('css-preset-select');_0x11f723[_0xaf0cf7(0xf21)]=_0xaf0cf7(0x9c9);const _0x478582=await _0x3df81a[_0xaf0cf7(0x86c)][_0xaf0cf7(0x478)](_0xaf0cf7(0xcbd))['equals']('global_css')['toArray']();_0x478582[_0xaf0cf7(0x59b)](_0x3fca64=>{const _0x4a513e=_0xaf0cf7,_0x11b521=document[_0x4a513e(0x219)](_0x4a513e(0x10bb));_0x11b521[_0x4a513e(0x107e)]=_0x3fca64['id'],_0x11b521[_0x4a513e(0x231)]=_0x3fca64[_0x4a513e(0x5d2)],_0x11f723[_0x4a513e(0x6ce)](_0x11b521);});}async function _0x3cae5c(){const _0x3bb494=_0x2b1222,_0x3fec82=document['getElementById']('css-preset-select'),_0x233381=parseInt(_0x3fec82['value']);if(isNaN(_0x233381))return;const _0x2d5bf6=await _0x3df81a[_0x3bb494(0x86c)]['get'](_0x233381);if(_0x2d5bf6){const _0x4d454a=document['getElementById']('global-css-input');_0x4d454a[_0x3bb494(0x107e)]=_0x2d5bf6[_0x3bb494(0x107e)],_0x1807b6(_0x2d5bf6[_0x3bb494(0x107e)]);}}async function _0x5e03e1(){const _0x2990bb=_0x2b1222,_0x248d05=await _0x11f6fb('保存CSS预设',_0x2990bb(0x11ed));if(!_0x248d05||!_0x248d05['trim']())return;const _0x5a9f26=document[_0x2990bb(0x1f4)](_0x2990bb(0x242))['value'],_0x5898b2=await _0x3df81a['appearancePresets'][_0x2990bb(0x478)]({'name':_0x248d05['trim'](),'type':_0x2990bb(0x12a8)})[_0x2990bb(0x9a8)]();if(_0x5898b2){const _0x14f7f7=await _0x109970(_0x2990bb(0x214),_0x2990bb(0x1303)+_0x248d05[_0x2990bb(0x4a2)]()+'”\x20的预设已存在。要覆盖它吗？',{'confirmButtonClass':_0x2990bb(0x1c6)});if(!_0x14f7f7)return;await _0x3df81a[_0x2990bb(0x86c)][_0x2990bb(0xf18)](_0x5898b2['id'],{'value':_0x5a9f26});}else await _0x3df81a[_0x2990bb(0x86c)]['add']({'name':_0x248d05['trim'](),'type':_0x2990bb(0x12a8),'value':_0x5a9f26});await _0x3299b7(),alert(_0x2990bb(0xbe8));}async function _0x925eac(){const _0x10fbbd=_0x2b1222,_0x521e10=document['getElementById'](_0x10fbbd(0x3bb)),_0xeec6ae=parseInt(_0x521e10[_0x10fbbd(0x107e)]);if(isNaN(_0xeec6ae)){alert('请先从下拉框中选择一个要删除的预设。');return;}const _0x1f32ed=await _0x3df81a[_0x10fbbd(0x86c)]['get'](_0xeec6ae);if(!_0x1f32ed)return;const _0x4460db=await _0x109970(_0x10fbbd(0x15bc),'确定要删除预设\x20“'+_0x1f32ed[_0x10fbbd(0x5d2)]+_0x10fbbd(0xbdf),{'confirmButtonClass':_0x10fbbd(0x1c6)});_0x4460db&&(await _0x3df81a[_0x10fbbd(0x86c)][_0x10fbbd(0xc40)](_0xeec6ae),await _0x3299b7(),alert(_0x10fbbd(0x14de)));}async function _0x406faf(){const _0x8e7496=_0x2b1222,_0x2f4437=document[_0x8e7496(0x1f4)](_0x8e7496(0x35a));_0x2f4437[_0x8e7496(0xf21)]=_0x8e7496(0x9c9);const _0x2fd42f=await _0x3df81a[_0x8e7496(0x86c)][_0x8e7496(0x478)](_0x8e7496(0xcbd))[_0x8e7496(0x49d)](_0x8e7496(0x634))[_0x8e7496(0x27a)]();_0x2fd42f[_0x8e7496(0x59b)](_0x469daa=>{const _0x119ca3=_0x8e7496,_0x316a3d=document[_0x119ca3(0x219)]('option');_0x316a3d[_0x119ca3(0x107e)]=_0x469daa['id'],_0x316a3d[_0x119ca3(0x231)]=_0x469daa[_0x119ca3(0x5d2)],_0x2f4437[_0x119ca3(0x6ce)](_0x316a3d);});}async function _0x1622bd(){const _0x369514=_0x2b1222,_0x1dfb77=document[_0x369514(0x1f4)](_0x369514(0x35a)),_0x5b14e2=parseInt(_0x1dfb77['value']);if(isNaN(_0x5b14e2))return;const _0x32d367=await _0x3df81a[_0x369514(0x86c)][_0x369514(0x13f8)](_0x5b14e2);if(_0x32d367){const _0x392e9c=document['getElementById'](_0x369514(0x918));_0x392e9c['value']=_0x32d367[_0x369514(0x107e)],_0x143b61(_0x32d367[_0x369514(0x107e)],!![]);}}async function _0x489b10(){const _0x2291ae=_0x2b1222,_0x20d3c5=await _0x11f6fb(_0x2291ae(0x1e9),'请输入预设名称');if(!_0x20d3c5||!_0x20d3c5['trim']())return;const _0x471e3c=document[_0x2291ae(0x1f4)]('font-url-input')[_0x2291ae(0x107e)]['trim']();if(!_0x471e3c){alert(_0x2291ae(0x607));return;}const _0x69600f=await _0x3df81a[_0x2291ae(0x86c)][_0x2291ae(0x478)]({'name':_0x20d3c5['trim'](),'type':'font'})[_0x2291ae(0x9a8)]();if(_0x69600f){const _0xa5a39c=await _0x109970(_0x2291ae(0x214),_0x2291ae(0x1303)+_0x20d3c5[_0x2291ae(0x4a2)]()+_0x2291ae(0x7e6),{'confirmButtonClass':'btn-danger'});if(!_0xa5a39c)return;await _0x3df81a['appearancePresets']['update'](_0x69600f['id'],{'value':_0x471e3c});}else await _0x3df81a['appearancePresets'][_0x2291ae(0x6a4)]({'name':_0x20d3c5[_0x2291ae(0x4a2)](),'type':_0x2291ae(0x634),'value':_0x471e3c});await _0x406faf(),alert(_0x2291ae(0xe3d));}async function _0xf02c9f(){const _0xff34d6=_0x2b1222,_0x5b41b6=document[_0xff34d6(0x1f4)](_0xff34d6(0x35a)),_0x1eb115=parseInt(_0x5b41b6[_0xff34d6(0x107e)]);if(isNaN(_0x1eb115)){alert(_0xff34d6(0x1498));return;}const _0xf12b36=await _0x3df81a['appearancePresets'][_0xff34d6(0x13f8)](_0x1eb115);if(!_0xf12b36)return;const _0x528992=await _0x109970(_0xff34d6(0x15bc),'确定要删除预设\x20“'+_0xf12b36[_0xff34d6(0x5d2)]+_0xff34d6(0xbdf),{'confirmButtonClass':_0xff34d6(0x1c6)});_0x528992&&(await _0x3df81a[_0xff34d6(0x86c)][_0xff34d6(0xc40)](_0x1eb115),await _0x406faf(),alert(_0xff34d6(0x14de)));}async function _0x199b60(){const _0x172d18=_0x2b1222,_0x361566=document[_0x172d18(0x1f4)](_0x172d18(0x241));_0x361566[_0x172d18(0xf21)]=_0x172d18(0x9c9);const _0x2a6516=await _0x3df81a['appearancePresets'][_0x172d18(0x478)](_0x172d18(0xcbd))[_0x172d18(0x49d)](_0x172d18(0x379))['toArray']();_0x2a6516[_0x172d18(0x59b)](_0x4211f8=>{const _0x115baa=_0x172d18,_0x50112e=document[_0x115baa(0x219)](_0x115baa(0x10bb));_0x50112e[_0x115baa(0x107e)]=_0x4211f8['id'],_0x50112e[_0x115baa(0x231)]=_0x4211f8[_0x115baa(0x5d2)],_0x361566[_0x115baa(0x6ce)](_0x50112e);});const _0x40ad3a={'wallpaper':_0x1ae02e[_0x172d18(0x12c0)]['wallpaper'],'cphoneWallpaper':_0x1ae02e['globalSettings'][_0x172d18(0x99f)],'globalChatBackground':_0x1ae02e[_0x172d18(0x12c0)][_0x172d18(0x3a1)],'appIcons':_0x1ae02e['globalSettings'][_0x172d18(0x69e)],'cphoneAppIcons':_0x1ae02e[_0x172d18(0x12c0)]['cphoneAppIcons'],'chatActionButtonsOrder':_0x1ae02e[_0x172d18(0x12c0)]['chatActionButtonsOrder'],'theme':localStorage[_0x172d18(0x587)]('ephone-theme')||_0x172d18(0x1336),'showStatusBar':_0x1ae02e[_0x172d18(0x12c0)][_0x172d18(0xad9)],'notificationSoundUrl':_0x1ae02e[_0x172d18(0x12c0)][_0x172d18(0xe88)],'widgetData':_0x1ae02e[_0x172d18(0x12c0)][_0x172d18(0xd55)]};let _0x41f1a3=null;for(const _0x31b7da of _0x2a6516){if(JSON['stringify'](_0x31b7da[_0x172d18(0x107e)])===JSON[_0x172d18(0x994)](_0x40ad3a)){_0x41f1a3=_0x31b7da['id'];break;}}_0x41f1a3?_0x361566[_0x172d18(0x107e)]=_0x41f1a3:_0x361566['value']='';}async function _0x166ae4(){const _0x2ea7a4=_0x2b1222,_0x438f38=document[_0x2ea7a4(0x1f4)]('appearance-preset-select'),_0x452b19=parseInt(_0x438f38[_0x2ea7a4(0x107e)]);if(isNaN(_0x452b19))return;const _0x514829=await _0x3df81a['appearancePresets'][_0x2ea7a4(0x13f8)](_0x452b19);if(_0x514829&&_0x514829[_0x2ea7a4(0x107e)]){const _0xe309fa=_0x514829[_0x2ea7a4(0x107e)];Object['assign'](_0x1ae02e['globalSettings'],_0xe309fa),_0x486571(_0xe309fa['theme']||'light'),await _0x3df81a['globalSettings'][_0x2ea7a4(0x295)](_0x1ae02e['globalSettings']),_0x47f04e(),_0x3fbfc(),_0x57e1d4(),_0x50b88d(),_0x496c6d(),_0x5556f9(),_0x1216fb(),alert('已成功加载外观预设：“'+_0x514829['name']+'”');}}async function _0x2d0876(){const _0x35c5f5=_0x2b1222,_0x181d33=await _0x11f6fb(_0x35c5f5(0xda2),_0x35c5f5(0x11ed));if(!_0x181d33||!_0x181d33[_0x35c5f5(0x4a2)]())return;const _0x2856ce={'wallpaper':_0x1ae02e[_0x35c5f5(0x12c0)][_0x35c5f5(0xd23)],'cphoneWallpaper':_0x1ae02e[_0x35c5f5(0x12c0)][_0x35c5f5(0x99f)],'globalChatBackground':_0x1ae02e[_0x35c5f5(0x12c0)]['globalChatBackground'],'appIcons':_0x1ae02e[_0x35c5f5(0x12c0)][_0x35c5f5(0x69e)],'cphoneAppIcons':_0x1ae02e[_0x35c5f5(0x12c0)]['cphoneAppIcons'],'chatActionButtonsOrder':_0x1ae02e['globalSettings']['chatActionButtonsOrder'],'theme':localStorage['getItem'](_0x35c5f5(0x119f))||_0x35c5f5(0x1336),'showStatusBar':_0x1ae02e[_0x35c5f5(0x12c0)]['showStatusBar'],'notificationSoundUrl':_0x1ae02e[_0x35c5f5(0x12c0)][_0x35c5f5(0xe88)],'widgetData':_0x1ae02e[_0x35c5f5(0x12c0)][_0x35c5f5(0xd55)]},_0x1df2f5=await _0x3df81a[_0x35c5f5(0x86c)]['where']({'name':_0x181d33[_0x35c5f5(0x4a2)](),'type':_0x35c5f5(0x379)})[_0x35c5f5(0x9a8)]();if(_0x1df2f5){const _0x7ed832=await _0x109970(_0x35c5f5(0x214),_0x35c5f5(0x1303)+_0x181d33[_0x35c5f5(0x4a2)]()+'”\x20的预设已存在。要覆盖它吗？',{'confirmButtonClass':_0x35c5f5(0x1c6)});if(!_0x7ed832)return;await _0x3df81a[_0x35c5f5(0x86c)][_0x35c5f5(0xf18)](_0x1df2f5['id'],{'value':_0x2856ce});}else await _0x3df81a[_0x35c5f5(0x86c)][_0x35c5f5(0x6a4)]({'name':_0x181d33[_0x35c5f5(0x4a2)](),'type':_0x35c5f5(0x379),'value':_0x2856ce});await _0x199b60(),alert('外观预设已保存！');}async function _0x2c7aca(){const _0x5284d7=_0x2b1222,_0x2d4dc5=document[_0x5284d7(0x1f4)]('appearance-preset-select'),_0x52a257=parseInt(_0x2d4dc5['value']);if(isNaN(_0x52a257)){alert(_0x5284d7(0x1498));return;}const _0x17a239=await _0x3df81a[_0x5284d7(0x86c)]['get'](_0x52a257);if(!_0x17a239)return;const _0x178359=await _0x109970('删除预设',_0x5284d7(0x98f)+_0x17a239[_0x5284d7(0x5d2)]+_0x5284d7(0xbdf),{'confirmButtonClass':_0x5284d7(0x1c6)});_0x178359&&(await _0x3df81a[_0x5284d7(0x86c)][_0x5284d7(0xc40)](_0x52a257),await _0x199b60(),alert(_0x5284d7(0x14de)));}async function _0x42cb64(){const _0x22c3f1=_0x2b1222,_0xc1b36=document[_0x22c3f1(0x1f4)]('theme-preset-select');_0xc1b36['innerHTML']=_0x22c3f1(0x9c9);const _0x3e5b5a=await _0x3df81a[_0x22c3f1(0x86c)][_0x22c3f1(0x478)](_0x22c3f1(0xcbd))[_0x22c3f1(0x49d)](_0x22c3f1(0xfc0))[_0x22c3f1(0x27a)]();_0x3e5b5a[_0x22c3f1(0x59b)](_0x1df26a=>{const _0x398b57=_0x22c3f1,_0x4d087b=document['createElement'](_0x398b57(0x10bb));_0x4d087b['value']=_0x1df26a['id'],_0x4d087b['textContent']=_0x1df26a['name'],_0xc1b36[_0x398b57(0x6ce)](_0x4d087b);});}async function _0x495e16(){const _0x353133=_0x2b1222,_0x4fc99f=document[_0x353133(0x1f4)]('theme-preset-select'),_0x3cc493=parseInt(_0x4fc99f[_0x353133(0x107e)]);if(isNaN(_0x3cc493))return;const _0x4fd86d=await _0x3df81a[_0x353133(0x86c)][_0x353133(0x13f8)](_0x3cc493);if(_0x4fd86d){const _0x4d622d=_0x4fd86d[_0x353133(0x107e)][_0x353133(0xc9c)]||_0x353133(0x372),_0xf57202=_0x4fd86d['value'][_0x353133(0xb42)]||'',_0x22bbbc=document['querySelector'](_0x353133(0x13c9)+_0x4d622d+'\x22]');_0x22bbbc&&(_0x22bbbc[_0x353133(0xe56)]=!![]);const _0x2d21ab=document[_0x353133(0x1f4)](_0x353133(0x833));_0x2d21ab[_0x353133(0x107e)]=_0xf57202,_0x356272();}}async function _0x38c15b(){const _0x1edb8b=_0x2b1222,_0x598c32=await _0x11f6fb(_0x1edb8b(0xee1),_0x1edb8b(0x11ed));if(!_0x598c32||!_0x598c32[_0x1edb8b(0x4a2)]())return;const _0x38aa06=document[_0x1edb8b(0xeda)](_0x1edb8b(0x420)),_0x2bc669=_0x38aa06?_0x38aa06['value']:_0x1edb8b(0x372),_0x1271ea=document[_0x1edb8b(0x1f4)](_0x1edb8b(0x833))[_0x1edb8b(0x107e)][_0x1edb8b(0x4a2)](),_0x4fb539={'base':_0x2bc669,'custom':_0x1271ea},_0x435a28=await _0x3df81a['appearancePresets'][_0x1edb8b(0x478)]({'name':_0x598c32[_0x1edb8b(0x4a2)](),'type':_0x1edb8b(0xfc0)})[_0x1edb8b(0x9a8)]();if(_0x435a28){const _0xde7b2=await _0x109970(_0x1edb8b(0x214),_0x1edb8b(0x1303)+_0x598c32[_0x1edb8b(0x4a2)]()+_0x1edb8b(0x7e6),{'confirmButtonClass':_0x1edb8b(0x1c6)});if(!_0xde7b2)return;await _0x3df81a[_0x1edb8b(0x86c)][_0x1edb8b(0xf18)](_0x435a28['id'],{'value':_0x4fb539});}else await _0x3df81a['appearancePresets']['add']({'name':_0x598c32[_0x1edb8b(0x4a2)](),'type':_0x1edb8b(0xfc0),'value':_0x4fb539});await _0x42cb64(),alert('主题预设已保存！');}async function _0x1939b5(){const _0x1eb204=_0x2b1222,_0x5366a7=document[_0x1eb204(0x1f4)](_0x1eb204(0x421)),_0x37c8b0=parseInt(_0x5366a7[_0x1eb204(0x107e)]);if(isNaN(_0x37c8b0)){alert(_0x1eb204(0x1498));return;}const _0x45cef0=await _0x3df81a[_0x1eb204(0x86c)][_0x1eb204(0x13f8)](_0x37c8b0);if(!_0x45cef0)return;const _0x34a529=await _0x109970('删除预设',_0x1eb204(0x98f)+_0x45cef0['name']+'”\x20吗？',{'confirmButtonClass':_0x1eb204(0x1c6)});_0x34a529&&(await _0x3df81a[_0x1eb204(0x86c)]['delete'](_0x37c8b0),await _0x42cb64(),alert(_0x1eb204(0x14de)));}async function _0x1e402e(){const _0x6af2a6=_0x2b1222;await _0x945730(),document[_0x6af2a6(0x1f4)](_0x6af2a6(0x5a2))[_0x6af2a6(0x159b)][_0x6af2a6(0x6a4)](_0x6af2a6(0xfca));}async function _0x945730(){const _0x63d685=_0x2b1222,_0x2e32c5=document['getElementById'](_0x63d685(0x1489)),_0x166717=await _0x3df81a[_0x63d685(0x679)][_0x63d685(0x27a)]();_0x2e32c5[_0x63d685(0xf21)]='';if(_0x166717['length']===0x0){_0x2e32c5[_0x63d685(0xf21)]=_0x63d685(0x1138);return;}_0x166717[_0x63d685(0x59b)](_0x240b26=>{const _0x47a690=_0x63d685,_0x324bf8=document[_0x47a690(0x219)](_0x47a690(0xaf9));_0x324bf8[_0x47a690(0x7c6)]=_0x47a690(0xd18),_0x324bf8['innerHTML']=_0x47a690(0xf67)+_0x240b26[_0x47a690(0x5d2)]+_0x47a690(0x327)+_0x240b26['id']+_0x47a690(0x837),_0x2e32c5['appendChild'](_0x324bf8);});}async function _0x26b112(){const _0x2d1376=_0x2b1222,_0x583975=document['getElementById'](_0x2d1376(0x415)),_0x5453ee=_0x583975[_0x2d1376(0x107e)]['trim']();if(!_0x5453ee){alert(_0x2d1376(0xc11));return;}const _0x53a571=await _0x3df81a[_0x2d1376(0x679)]['where'](_0x2d1376(0x5d2))[_0x2d1376(0x49d)](_0x5453ee)['first']();if(_0x53a571){alert('分类\x20\x22'+_0x5453ee+_0x2d1376(0xf6a));return;}await _0x3df81a['stickerCategories'][_0x2d1376(0x6a4)]({'name':_0x5453ee}),_0x583975[_0x2d1376(0x107e)]='',await _0x945730();}async function _0x42545b(_0x439abb){const _0x104974=_0x2b1222,_0x5e8689=await _0x3df81a[_0x104974(0x679)]['get'](_0x439abb);if(!_0x5e8689)return;const _0x17a126=await _0x3df81a[_0x104974(0x1420)]['where'](_0x104974(0x1467))['equals'](_0x439abb)[_0x104974(0x13bd)](),_0xf154ba=_0x17a126>0x0?_0x104974(0x45b)+_0x5e8689['name']+'》吗？\x0a\x0a【【【警告】】】\x0a此操作将同时永久删除该分类下的\x20'+_0x17a126+_0x104974(0xff2):_0x104974(0x45b)+_0x5e8689[_0x104974(0x5d2)]+'》吗？',_0x516a05=await _0x109970(_0x104974(0x33f),_0xf154ba,{'confirmButtonClass':_0x104974(0x1c6)});if(_0x516a05)try{await _0x3df81a['transaction']('rw',_0x3df81a[_0x104974(0x679)],_0x3df81a[_0x104974(0x1420)],async()=>{const _0x34c9c3=_0x104974,_0x38c4c4=await _0x3df81a[_0x34c9c3(0x1420)][_0x34c9c3(0x478)](_0x34c9c3(0x1467))[_0x34c9c3(0x49d)](_0x439abb)[_0x34c9c3(0x75a)]();_0x38c4c4['length']>0x0&&await _0x3df81a['userStickers']['bulkDelete'](_0x38c4c4),await _0x3df81a[_0x34c9c3(0x679)][_0x34c9c3(0xc40)](_0x439abb);}),_0x1ae02e[_0x104974(0x1420)]=await _0x3df81a[_0x104974(0x1420)][_0x104974(0x27a)](),_0x483dbf===_0x439abb&&(_0x483dbf=_0x104974(0x54b)),await _0x945730(),await _0x3056ba(),alert(_0x104974(0xd60)+_0x5e8689['name']+'》及其下的表情已成功删除。');}catch(_0xf3e5f8){console[_0x104974(0x127d)]('删除分类及表情时出错:',_0xf3e5f8),alert(_0x104974(0x1298));}}function _0x51fdef(_0xf777b0){const _0x56683e=_0x2b1222;_0x483dbf=_0xf777b0,document[_0x56683e(0x14bf)](_0x56683e(0x51d))[_0x56683e(0x59b)](_0x5c7ad=>{const _0x58c264=_0x56683e;_0x5c7ad['classList']['toggle'](_0x58c264(0x7cf),String(_0x5c7ad[_0x58c264(0x746)][_0x58c264(0x1467)])===String(_0xf777b0));}),_0x3056ba(![]);const _0x27f9e=document[_0x56683e(0x1f4)]('select-all-stickers-checkbox');if(_0x27f9e)_0x27f9e[_0x56683e(0xe56)]=![];}async function _0x4f5143(){const _0x24b94e=_0x2b1222;if(!_0x1ae02e['activeChatId'])return;const _0x436c93=_0x1ae02e[_0x24b94e(0x589)][_0x1ae02e[_0x24b94e(0x588)]];if(!_0x436c93)return;try{const _0xedab63={'type':_0x24b94e(0x920),'version':0x1,'chatData':_0x436c93},_0x1f0484=new Blob([JSON[_0x24b94e(0x994)](_0xedab63,null,0x2)],{'type':_0x24b94e(0xa90)}),_0x52e0bb=URL['createObjectURL'](_0x1f0484),_0x3b5eef=document[_0x24b94e(0x219)]('a');_0x3b5eef[_0x24b94e(0x4c6)]=_0x52e0bb,_0x3b5eef[_0x24b94e(0x1060)]=_0x24b94e(0x204)+_0x436c93[_0x24b94e(0x5d2)]+'-'+new Date()['toISOString']()['split']('T')[0x0]+'.json',_0x3b5eef[_0x24b94e(0x740)](),URL['revokeObjectURL'](_0x52e0bb),await _0x1460c5(_0x24b94e(0xf2f),'与“'+_0x436c93['name']+_0x24b94e(0xc47));}catch(_0x4fc747){console['error'](_0x24b94e(0x835),_0x4fc747),await _0x1460c5(_0x24b94e(0x95c),_0x24b94e(0x5ea)+_0x4fc747[_0x24b94e(0x11f0)]);}}async function _0x1f336e(_0x522949){const _0x51e1dc=_0x2b1222;if(!_0x522949||!_0x1ae02e[_0x51e1dc(0x588)])return;const _0x366d9f=_0x1ae02e['activeChatId'],_0x2b37d4=_0x1ae02e[_0x51e1dc(0x589)][_0x366d9f];try{const _0x31df42=await _0x522949[_0x51e1dc(0x40f)](),_0x538b48=JSON['parse'](_0x31df42);if(_0x538b48[_0x51e1dc(0xcbd)]!==_0x51e1dc(0x920)||!_0x538b48[_0x51e1dc(0xaa9)])throw new Error('文件格式不正确，这不是一个有效的单聊备份文件。');const _0x85aca5=await _0x109970('严重警告！',_0x51e1dc(0x1421)+_0x2b37d4[_0x51e1dc(0x5d2)]+_0x51e1dc(0x10c4),{'confirmButtonClass':_0x51e1dc(0x1c6),'confirmText':_0x51e1dc(0xa0a)});if(!_0x85aca5)return;const _0x43a812=_0x538b48['chatData'];_0x43a812['id']=_0x366d9f,await _0x3df81a[_0x51e1dc(0x589)][_0x51e1dc(0x295)](_0x43a812),_0x1ae02e[_0x51e1dc(0x589)][_0x366d9f]=_0x43a812,await _0x1460c5('导入成功',_0x51e1dc(0xd84)),_0x3689f0(_0x366d9f),_0x1033ae(),document[_0x51e1dc(0x1f4)](_0x51e1dc(0x4c4))[_0x51e1dc(0x740)]();}catch(_0x371633){console[_0x51e1dc(0x127d)]('导入单个聊天时出错:',_0x371633),await _0x1460c5(_0x51e1dc(0x15ca),'文件解析或应用失败:\x20'+_0x371633['message']);}}function _0x40349d(){_0x50cdb6(),_0x2e53fa('character-selection-screen');}function _0x50cdb6(){const _0x28a4e7=_0x2b1222,_0x4349c3=document[_0x28a4e7(0x1f4)](_0x28a4e7(0x880));_0x4349c3[_0x28a4e7(0xf21)]='';const _0x24229f=Object['values'](_0x1ae02e['chats'])[_0x28a4e7(0xede)](_0x5c1e7d=>!_0x5c1e7d[_0x28a4e7(0xe83)]);if(_0x24229f[_0x28a4e7(0x58a)]===0x0){_0x4349c3[_0x28a4e7(0xf21)]='<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>还没有可以查看手机的角色哦~</p>';return;}_0x24229f[_0x28a4e7(0x59b)](_0x551fb7=>{const _0x3f616b=_0x28a4e7,_0x27a971=document['createElement']('div');_0x27a971[_0x3f616b(0x7c6)]=_0x3f616b(0xc3c),_0x27a971['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+(_0x551fb7['settings'][_0x3f616b(0xc99)]||_0x5494d0)+_0x3f616b(0xddc)+_0x551fb7[_0x3f616b(0x5d2)]+_0x3f616b(0x12f5),_0x27a971[_0x3f616b(0x122b)]('click',()=>_0x2ba020(_0x551fb7['id'])),_0x4349c3[_0x3f616b(0x6ce)](_0x27a971);});}async function _0x2ba020(_0x1cedd3){const _0x50ca66=_0x2b1222;_0x2123eb=_0x1cedd3,console[_0x50ca66(0x57e)](_0x50ca66(0xd99)+_0x1cedd3+_0x50ca66(0x1562)),_0x3fbfc(),_0x50b88d(),_0x2e4c76(),_0x2e53fa(_0x50ca66(0xf95));}function _0x597899(){const _0x2b20ad=_0x2b1222;_0x2123eb=null,console[_0x2b20ad(0x57e)]('已返回我的手机'),_0x2e53fa(_0x2b20ad(0x3b7));}function _0x2e4c76(){const _0x37212b=_0x2b1222,_0x3a2f30=new Date(),_0x380d74=_0x3a2f30['toLocaleTimeString']('zh-CN',{'hour':_0x37212b(0x9bd),'minute':_0x37212b(0x9bd)}),_0x3fd79a=_0x3a2f30[_0x37212b(0x5c5)](_0x37212b(0xd02),{'weekday':'long','month':_0x37212b(0x2ee),'day':'numeric'});document[_0x37212b(0x1f4)](_0x37212b(0x2a2))[_0x37212b(0x231)]=_0x380d74,document[_0x37212b(0x1f4)](_0x37212b(0x5cb))[_0x37212b(0x231)]=_0x3fd79a,_0x1335d9(_0x37212b(0xb25));}function _0x1335d9(_0x22a6cf){const _0x170b57=_0x2b1222;document[_0x170b57(0x14bf)](_0x170b57(0xedb))['forEach'](_0x2cc282=>_0x2cc282[_0x170b57(0x159b)][_0x170b57(0xa9c)](_0x170b57(0x7cf))),document[_0x170b57(0x1f4)](_0x22a6cf)['classList']['add'](_0x170b57(0x7cf));}window[_0x2b1222(0x1574)]=_0x1335d9;async function _0x45577b(_0x400480){const _0x28c9f7=_0x2b1222;if(!_0x2123eb)return;const _0x1c793b=_0x1ae02e[_0x28c9f7(0x589)][_0x2123eb];await _0xe28bc5(_0x2123eb,_0x400480);switch(_0x400480){case'qq':_0x359b34(),_0x1335d9(_0x28c9f7(0x453));break;case'album':_0x27df5a(),_0x1335d9(_0x28c9f7(0x13b3));break;case _0x28c9f7(0x1250):_0xe42c16(),_0x1335d9('char-browser-screen');break;case'taobao':_0x5c8c49(),_0x1335d9('char-taobao-screen');break;case _0x28c9f7(0x1371):_0x44ed07(),_0x1335d9(_0x28c9f7(0xb2a));break;case _0x28c9f7(0xc33):_0x4151e3(),_0x1335d9(_0x28c9f7(0x91c));break;case _0x28c9f7(0xbe9):_0xb3e967(),_0x1335d9(_0x28c9f7(0x90f));break;case _0x28c9f7(0xbc4):_0x116da9(),_0x1335d9(_0x28c9f7(0x3b2));break;case _0x28c9f7(0xc7f):_0x5bafbb(),_0x1335d9(_0x28c9f7(0xdcf));break;}}async function _0x27df5a(){const _0x5a5944=_0x2b1222,_0x1c2236=document[_0x5a5944(0x1f4)]('char-album-grid');_0x1c2236[_0x5a5944(0xf21)]='';if(!_0x2123eb)return;const _0x26b02d=_0x1ae02e[_0x5a5944(0x589)][_0x2123eb],_0x325193=_0x26b02d['simulatedAlbum']||[];if(_0x325193[_0x5a5944(0x58a)]===0x0){_0x1c2236[_0x5a5944(0xf21)]=_0x5a5944(0x14e1);return;}const _0x3c69fc=_0x5a5944(0xe1f);_0x325193[_0x5a5944(0x59b)](_0x2c5033=>{const _0x58f449=_0x5a5944,_0x51349d=document[_0x58f449(0x219)]('div');_0x51349d['className']=_0x58f449(0xd5f),_0x51349d['dataset'][_0x58f449(0xdec)]=_0x2c5033[_0x58f449(0xdec)],_0x1c2236[_0x58f449(0x6ce)](_0x51349d);if(_0x1ae02e[_0x58f449(0x12c0)][_0x58f449(0x7d1)]){_0x51349d['style'][_0x58f449(0x11e7)]=_0x58f449(0x10d3);const _0x4c4d17=/[^\x00-\x7F]/[_0x58f449(0x60b)](_0x2c5033['image_prompt']),_0x24b9c5=_0x2c5033['image_prompt']&&_0x2c5033[_0x58f449(0x1248)][_0x58f449(0x4a2)]()&&!_0x4c4d17,_0x399ff0=_0x24b9c5?_0x2c5033[_0x58f449(0x1248)]:_0x58f449(0xa98),_0x18ce7e=_0x58f449(0xe8f)+encodeURIComponent(_0x399ff0),_0x4adbf0=new Image();_0x4adbf0['onload']=function(){const _0x3841a1=_0x58f449;_0x51349d['style']['backgroundImage']=_0x3841a1(0x13cb)+this[_0x3841a1(0x9fe)]+')';},_0x4adbf0['onerror']=function(){const _0x366e9b=_0x58f449;_0x51349d[_0x366e9b(0x215)]['backgroundImage']='url('+_0x3c69fc+')';},_0x4adbf0[_0x58f449(0x9fe)]=_0x18ce7e;}else{_0x51349d[_0x58f449(0x215)]['backgroundColor']=_0x58f449(0xa9d),_0x51349d[_0x58f449(0x215)][_0x58f449(0x4e3)]=_0x58f449(0x1116);const _0x57be86=document['createElement']('p');_0x57be86[_0x58f449(0x7c6)]=_0x58f449(0x11c0),_0x57be86[_0x58f449(0x231)]=_0x2c5033[_0x58f449(0xdec)]||_0x58f449(0xe0f),_0x51349d[_0x58f449(0x6ce)](_0x57be86);}});}function _0xe42c16(){const _0x3eb75b=_0x2b1222,_0x544c73=document['getElementById'](_0x3eb75b(0x8fc));_0x544c73[_0x3eb75b(0xf21)]='';if(!_0x2123eb)return;const _0x225dc6=_0x1ae02e['chats'][_0x2123eb],_0x10f841=[_0x225dc6[_0x3eb75b(0x5d2)],'爱好','旅游','美食','新闻',..._0x225dc6[_0x3eb75b(0x6a8)]['aiPersona'][_0x3eb75b(0x23f)](/，|。|\s/)[_0x3eb75b(0x5cc)](0x0,0x5)],_0x46d6d8=['知乎',_0x3eb75b(0x1017),_0x3eb75b(0x777),'微博',_0x3eb75b(0x8df)];for(let _0x41891c=0x0;_0x41891c<0xf;_0x41891c++){const _0x1394b7=_0x10f841[Math[_0x3eb75b(0x123c)](Math['random']()*_0x10f841[_0x3eb75b(0x58a)])],_0x5abea1=_0x46d6d8[Math[_0x3eb75b(0x123c)](Math['random']()*_0x46d6d8[_0x3eb75b(0x58a)])],_0x5d526c=document[_0x3eb75b(0x219)](_0x3eb75b(0xaf9));_0x5d526c[_0x3eb75b(0x7c6)]=_0x3eb75b(0x33d),_0x5d526c[_0x3eb75b(0xf21)]=_0x3eb75b(0x1144)+_0x1394b7+_0x3eb75b(0x7c5)+_0x5abea1+_0x3eb75b(0xcfb)+_0x5abea1[_0x3eb75b(0x1f7)]()+_0x3eb75b(0x1357)+_0x1394b7+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x544c73[_0x3eb75b(0x6ce)](_0x5d526c);}}function _0x5c8c49(){const _0x2f319a=_0x2b1222,_0x4c55c0=document[_0x2f319a(0x1f4)](_0x2f319a(0x92c));_0x4c55c0[_0x2f319a(0xf21)]='';if(!_0x2123eb)return;const _0x71f534=_0x1ae02e[_0x2f319a(0x589)][_0x2123eb],_0x1a0ed0=_0x71f534[_0x2f319a(0xf56)]?.[_0x2f319a(0x13b4)]||[];if(_0x1a0ed0[_0x2f319a(0x58a)]===0x0){_0x4c55c0[_0x2f319a(0xf21)]='<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>TA最近好像什么都没买呢，<br>点击右上角刷新按钮生成一些记录吧！</p>';return;}_0x1a0ed0[_0x2f319a(0x59b)](_0x1eed44=>{const _0x22f397=_0x2f319a,_0x1214df=document[_0x22f397(0x219)]('div');_0x1214df[_0x22f397(0x7c6)]='char-product-item',_0x1214df[_0x22f397(0x746)]['reason']=_0x1eed44['reason'];let _0x4ecb6e;if(_0x1ae02e['globalSettings'][_0x22f397(0x7d1)]){const _0x50d41b=_0x22f397(0xe8f)+encodeURIComponent(_0x1eed44['image_prompt']||_0x22f397(0x50b));_0x4ecb6e=_0x22f397(0xe40)+_0x50d41b+_0x22f397(0x137b);}else _0x4ecb6e='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-product-description-overlay\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22char-photo-description\x22>'+(_0x1eed44[_0x22f397(0x11d6)]||_0x22f397(0x8b3))+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';_0x1214df[_0x22f397(0xf21)]=_0x22f397(0x1375)+_0x4ecb6e+_0x22f397(0xd2a)+_0x1eed44[_0x22f397(0x12d5)]+_0x22f397(0x1098)+(_0x1eed44[_0x22f397(0x6ec)]||0x0)[_0x22f397(0x24f)](0x2)+_0x22f397(0xa5f)+_0x1eed44['status']+_0x22f397(0xa9e),_0x4c55c0['appendChild'](_0x1214df);});}function _0x58774f(){const _0x47bf8d=_0x2b1222;_0x1335d9(_0x47bf8d(0xb25));}function _0x268274(){const _0x390411=_0x2b1222,_0x124be9=document['getElementById'](_0x390411(0xdef));_0x124be9[_0x390411(0xf21)]='';if(!_0x2123eb)return;const _0x232bf4=Object[_0x390411(0x753)](_0x1ae02e[_0x390411(0x589)])['filter'](_0x564e9e=>{const _0x4aa711=_0x390411;if(_0x564e9e['id']===_0x2123eb)return!![];if(_0x564e9e['isGroup']&&_0x564e9e[_0x4aa711(0x1402)][_0x4aa711(0x690)](_0x442c09=>_0x442c09['id']===_0x2123eb))return!![];return![];});_0x232bf4[_0x390411(0x59b)](_0x47cf4c=>{const _0x23726a=_0x390411,_0x245315=_0x15d653(_0x47cf4c);_0x124be9[_0x23726a(0x6ce)](_0x245315);});}async function _0xe28bc5(_0x312350,_0x4f9763){const _0x541372=_0x2b1222,_0xdf82c8=_0x1ae02e[_0x541372(0x589)][_0x312350];if(!_0xdf82c8)return;!_0xdf82c8[_0x541372(0xb14)]&&(_0xdf82c8[_0x541372(0xb14)]=[]),_0xdf82c8[_0x541372(0xb14)][_0x541372(0x1426)]({'appName':_0x4f9763,'timestamp':Date[_0x541372(0xd6e)]()}),_0xdf82c8[_0x541372(0xb14)]['length']>0x32&&_0xdf82c8['appUsageLog'][_0x541372(0xbe1)](),await _0x3df81a['chats'][_0x541372(0x295)](_0xdf82c8);}function _0x5bafbb(){const _0x4ac359=_0x2b1222,_0xcacbff=document['getElementById'](_0x4ac359(0xb96));_0xcacbff[_0x4ac359(0xf21)]='';const _0x52d67b=_0x1ae02e[_0x4ac359(0x589)][_0x2123eb],_0x45278c=(_0x52d67b['appUsageLog']||[])[_0x4ac359(0x5cc)]()[_0x4ac359(0x115a)]();if(_0x45278c['length']===0x0){_0xcacbff[_0x4ac359(0xf21)]=_0x4ac359(0x1477);return;}const _0x5879dd={'qq':'QQ','album':'相册','browser':_0x4ac359(0x122e),'taobao':'淘宝','memo':'备忘录','diary':'日记','amap':_0x4ac359(0x59e),'usage':'App记录'};_0x45278c['forEach'](_0x5e8e70=>{const _0x4ea837=_0x4ac359,_0x33a052=document[_0x4ea837(0x219)](_0x4ea837(0xaf9));_0x33a052[_0x4ea837(0x7c6)]=_0x4ea837(0x6c7),_0x33a052[_0x4ea837(0xf21)]=_0x4ea837(0x265)+new Date(_0x5e8e70[_0x4ea837(0x1388)])[_0x4ea837(0x613)]()+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22action\x22>打开了\x20<strong>'+(_0x5879dd[_0x5e8e70['appName']]||_0x5e8e70[_0x4ea837(0xc8d)])+'</strong></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0xcacbff[_0x4ea837(0x6ce)](_0x33a052);});}async function _0x5bf972(_0x38f11e){const _0x389db1=_0x2b1222,_0x1a5448=_0x1ae02e[_0x389db1(0x589)][_0x2123eb];if(!_0x1a5448)return;const _0x192b5d={'role':_0x389db1(0x13c0),'senderName':_0x1a5448['originalName'],'type':_0x389db1(0x973),'content':_0x38f11e,'imageUrl':_0x389db1(0x5e8),'timestamp':Date['now']()};_0x1a5448[_0x389db1(0xce3)][_0x389db1(0x1426)](_0x192b5d),await _0x3df81a['chats'][_0x389db1(0x295)](_0x1a5448),_0x1ae02e['activeChatId']===_0x2123eb&&_0x5286f1(_0x192b5d,_0x1a5448),await _0x1460c5(_0x389db1(0xa01),'“'+_0x1a5448[_0x389db1(0x5d2)]+'”\x20的位置已发送到你们的聊天中。');}async function _0x1ce24c(_0x3f36d7){const _0x1d76c5=_0x2b1222,_0x164dcd=_0x1ae02e['chats'][_0x2123eb];if(!_0x164dcd||!_0x164dcd[_0x1d76c5(0x11c6)])return;const _0x15ede0=_0x164dcd[_0x1d76c5(0x11c6)]['find'](_0x1f28db=>_0x1f28db['id']===_0x3f36d7);if(_0x15ede0){_0x4bc9b5=_0x15ede0;const _0x242f33=document['getElementById'](_0x1d76c5(0x424)),_0x75f7ff=document[_0x1d76c5(0x1f4)](_0x1d76c5(0x955)),_0x8e9c08=document[_0x1d76c5(0x1f4)](_0x1d76c5(0xe48));if(_0x242f33)_0x242f33[_0x1d76c5(0x231)]=_0x15ede0[_0x1d76c5(0x156f)];if(_0x75f7ff)_0x75f7ff['value']=_0x15ede0[_0x1d76c5(0x128c)];const _0x523395=await _0x3df81a[_0x1d76c5(0xbeb)]['where']({'type':_0x1d76c5(0xc1f),'content.id':_0x3f36d7})['first']();_0x8e9c08[_0x1d76c5(0x159b)]['toggle'](_0x1d76c5(0x7cf),!!_0x523395),_0x1335d9(_0x1d76c5(0x393));}}function _0x44ed07(){const _0x15a7ba=_0x2b1222,_0x277467=document[_0x15a7ba(0x1f4)]('char-memo-list');_0x277467['innerHTML']='';const _0x523f18=_0x1ae02e[_0x15a7ba(0x589)][_0x2123eb],_0x315a3b=(_0x523f18['memos']||[])[_0x15a7ba(0x5cc)]()[_0x15a7ba(0x115a)]();if(_0x315a3b['length']===0x0){_0x277467[_0x15a7ba(0xf21)]='<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>还没有备忘录。</p>';return;}_0x315a3b[_0x15a7ba(0x59b)](_0x22781f=>{const _0x2be4eb=_0x15a7ba,_0x5ddd15=document['createElement']('div');_0x5ddd15[_0x2be4eb(0x7c6)]='list-item',_0x5ddd15[_0x2be4eb(0xf21)]=_0x2be4eb(0x1a6)+_0x22781f[_0x2be4eb(0x156f)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22item-content\x22>'+(_0x22781f[_0x2be4eb(0x128c)]||'')[_0x2be4eb(0x23f)]('\x0a')[0x0]+_0x2be4eb(0x1514),_0x5ddd15[_0x2be4eb(0x122b)]('click',()=>_0x1ce24c(_0x22781f['id'])),_0x1160f3(_0x5ddd15,()=>deleteMemo(_0x22781f['id'])),_0x277467['appendChild'](_0x5ddd15);});}async function _0x19b93f(_0x40636e=null){const _0xfe0b2b=_0x2b1222;_0x2f43ed=null;const _0xb1418c=await _0x11f6fb(_0xfe0b2b(0x141d),_0xfe0b2b(0x152c));if(_0xb1418c===null||!_0xb1418c[_0xfe0b2b(0x4a2)]())return;const _0x4bfec5=await _0x11f6fb(_0xfe0b2b(0x271)+_0xb1418c,_0xfe0b2b(0xa0b),'','textarea');_0x4bfec5!==null&&(await _0x58cca4({'title':_0xb1418c[_0xfe0b2b(0x4a2)](),'content':_0x4bfec5}),_0x1335d9(_0xfe0b2b(0xb2a)));}async function _0x58cca4(_0x472752){const _0x2ce921=_0x2b1222,_0x48cb80=_0x1ae02e[_0x2ce921(0x589)][_0x2123eb];if(!_0x48cb80[_0x2ce921(0x11c6)])_0x48cb80[_0x2ce921(0x11c6)]=[];_0x48cb80[_0x2ce921(0x11c6)][_0x2ce921(0x1426)]({'id':Date[_0x2ce921(0xd6e)](),'title':_0x472752[_0x2ce921(0x156f)],'content':_0x472752[_0x2ce921(0x128c)]}),await _0x3df81a[_0x2ce921(0x589)][_0x2ce921(0x295)](_0x48cb80),_0x44ed07();}async function _0x58cca4(_0x5a9326){const _0x4f52ef=_0x2b1222,_0x37b969=_0x1ae02e[_0x4f52ef(0x589)][_0x2123eb];if(!_0x37b969[_0x4f52ef(0x11c6)])_0x37b969[_0x4f52ef(0x11c6)]=[];if(_0x2f43ed){const _0xae126f=_0x37b969[_0x4f52ef(0x11c6)][_0x4f52ef(0x13b7)](_0x44416d=>_0x44416d['id']===_0x2f43ed);if(_0xae126f)_0xae126f['content']=_0x5a9326;}else _0x37b969[_0x4f52ef(0x11c6)][_0x4f52ef(0x1426)]({'id':Date[_0x4f52ef(0xd6e)](),'content':_0x5a9326});await _0x3df81a[_0x4f52ef(0x589)][_0x4f52ef(0x295)](_0x37b969),_0x44ed07(),_0x2f43ed=null;}async function _0x3c7fd1(){const _0x4b2860=_0x2b1222;if(!_0x2123eb)return;const _0x67697=_0x1ae02e[_0x4b2860(0x589)][_0x2123eb];if(!_0x67697)return;await _0x1460c5(_0x4b2860(0x11b7),'正在请求“'+_0x67697[_0x4b2860(0x5d2)]+_0x4b2860(0x15d2));const {proxyUrl:_0x55f6b0,apiKey:_0x5e2132,model:_0x4807c5}=_0x1ae02e[_0x4b2860(0x226)];if(!_0x55f6b0||!_0x5e2132||!_0x4807c5){alert(_0x4b2860(0x4af));return;}const _0x3f0824=_0x1ae02e[_0x4b2860(0x11ef)][_0x4b2860(0xb46)]===_0x4b2860(0xee7)||!_0x1ae02e[_0x4b2860(0x11ef)][_0x4b2860(0xb46)]?'用户':_0x1ae02e[_0x4b2860(0x11ef)][_0x4b2860(0xb46)],_0x11ce9b=_0x67697['longTermMemory']&&_0x67697[_0x4b2860(0x5fb)][_0x4b2860(0x58a)]>0x0?_0x67697[_0x4b2860(0x5fb)][_0x4b2860(0x1431)](_0x352539=>_0x4b2860(0x10a4)+_0x3f7f7a(_0x352539['timestamp'])+')\x20'+_0x352539[_0x4b2860(0x128c)])[_0x4b2860(0x1143)]('\x0a'):'无',_0x1f7d1d=_0x67697[_0x4b2860(0x6a8)][_0x4b2860(0x4b2)]||0xa,_0x48a4e6=_0x67697[_0x4b2860(0xce3)][_0x4b2860(0x5cc)](-_0x1f7d1d)['map'](_0x2bc436=>(_0x2bc436[_0x4b2860(0xfbb)]===_0x4b2860(0x860)?_0x3f0824:_0x67697[_0x4b2860(0x5d2)])+':\x20'+String(_0x2bc436[_0x4b2860(0x128c)])['substring'](0x0,0x1e)+_0x4b2860(0x629))['join']('\x0a'),_0x503df6=(_0x67697[_0x4b2860(0x6a8)][_0x4b2860(0x1469)]||[])['map'](_0x4787ad=>_0x1ae02e[_0x4b2860(0x1453)]['find'](_0x2816c1=>_0x2816c1['id']===_0x4787ad))[_0x4b2860(0xede)](Boolean)[_0x4b2860(0x1431)](_0x58a85b=>_0x4b2860(0x44b)+_0x58a85b['name']+_0x4b2860(0x1330)+_0x58a85b[_0x4b2860(0x128c)][_0x4b2860(0xede)](_0x5e20fe=>_0x5e20fe[_0x4b2860(0x1368)])[_0x4b2860(0x1431)](_0xd5fa57=>'-\x20'+_0xd5fa57[_0x4b2860(0x128c)])[_0x4b2860(0x1143)]('\x0a'))[_0x4b2860(0x1143)](''),_0x46a3a8=_0x5a2518(_0x67697,0x3,_0x4b2860(0x5f2)),_0x30b875=_0x5a2518(_0x67697,0x6,_0x4b2860(0x5f2)),_0x19033b=_0x5a2518(_0x67697,0x9,_0x4b2860(0x5f2)),_0x49323a=_0x5a2518(_0x67697,0x1,_0x4b2860(0x1265)),_0x4afb6a=_0x5a2518(_0x67697,0x3,_0x4b2860(0x1265)),_0x1fd11a=_0x5a2518(_0x67697,0x7,'days');let _0x2faccd='';if(_0x46a3a8||_0x30b875||_0x19033b||_0x49323a||_0x4afb6a||_0x1fd11a){_0x2faccd+=_0x4b2860(0x135e);if(_0x46a3a8)_0x2faccd+=_0x46a3a8;if(_0x30b875)_0x2faccd+=_0x30b875;if(_0x19033b)_0x2faccd+=_0x19033b;if(_0x46a3a8||_0x30b875||_0x19033b)_0x2faccd+='\x0a';if(_0x49323a)_0x2faccd+=_0x49323a;if(_0x4afb6a)_0x2faccd+=_0x4afb6a;if(_0x1fd11a)_0x2faccd+=_0x1fd11a;}const _0x1f5f00=_0x67697[_0x4b2860(0x6a8)]['myPersona']||'(未设置)',_0x351b91='\x0a#\x20你的任务\x0a你是一个虚拟生活模拟器和故事作家。你的任务是扮演角色“'+_0x67697['name']+'”，并根据其人设、记忆和最近的互动，虚构出【5到8篇】TA最近可能会写的日记。\x0a\x0a#\x20核心规则\x0a1.\x20\x20**【时间\x20(最高优先级)】**:\x0a\x20\x20\x20\x20-\x20\x20\x20今天的日期是\x20**'+new Date()[_0x4b2860(0x5c5)](_0x4b2860(0xd02))+_0x4b2860(0xc44)+_0x3f0824+'”\x20来指代你的聊天对象（用户）。\x0a6.\x20\x20**【日记专属Markdown语法\x20(必须使用！)】**:\x0a\x20\x20\x20\x20-\x20\x20\x20`**加粗文字**`:\x20用于强调。\x0a\x20\x20\x20\x20-\x20\x20\x20`~~划掉的文字~~`:\x20用于表示改变主意或自我否定。\x0a\x20\x20\x20\x20-\x20\x20\x20`!h{黄色高亮}`:\x20用于标记关键词或重要信息。\x0a\x20\x20\x20\x20-\x20\x20\x20`!u{粉色下划线}`:\x20用于标注人名、地名或特殊名词。\x0a\x20\x20\x20\x20-\x20\x20\x20`!e{粉色强调}`:\x20用于表达强烈的情绪。\x0a\x20\x20\x20\x20-\x20\x20\x20`!w{手写体}`:\x20用于写下引言、歌词或特殊笔记。\x0a\x20\x20\x20\x20-\x20\x20\x20`!m{凌乱的手写体}`:\x20用于表达激动、慌乱或潦草记录时的心情。\x0a\x20\x20\x20\x20-\x20\x20\x20`||涂黑||`:\x20用于隐藏秘密或敏感词汇\x20(每次涂黑2~5个字)。\x0a\x0a#\x20供你参考的上下文\x0a-\x20**你的角色设定**:\x20'+_0x67697[_0x4b2860(0x6a8)]['aiPersona']+_0x4b2860(0xc3f)+_0x1f5f00+_0x4b2860(0x5e4)+_0x11ce9b+'\x0a'+_0x503df6+'\x0a'+_0x2faccd+_0x4b2860(0xbd8)+_0x3f0824+'”的对话摘要**:\x0a'+_0x48a4e6+_0x4b2860(0xdd1);try{const _0x58e4be=[{'role':_0x4b2860(0x860),'content':_0x4b2860(0x2d0)}];let _0xd4e261=_0x55f6b0['includes'](_0x4b2860(0xc38)),_0xb926f=_0x16b978(_0x4807c5,_0x5e2132,_0x351b91,_0x58e4be);const _0x39ff95=_0xd4e261?await fetch(_0xb926f['url'],_0xb926f[_0x4b2860(0xc6b)]):await fetch(_0x55f6b0+'/v1/chat/completions',{'method':_0x4b2860(0x12d9),'headers':{'Content-Type':_0x4b2860(0xa90),'Authorization':_0x4b2860(0xf03)+_0x5e2132},'body':JSON['stringify']({'model':_0x4807c5,'messages':[{'role':'system','content':_0x351b91},..._0x58e4be],'temperature':_0x1ae02e[_0x4b2860(0x12c0)][_0x4b2860(0x217)]||0.95})});if(!_0x39ff95['ok'])throw new Error(_0x4b2860(0xaa6)+_0x39ff95[_0x4b2860(0x1260)]);const _0xc6db95=await _0x39ff95[_0x4b2860(0xb84)](),_0x55f461=getGeminiResponseText(_0xc6db95),_0x5e67e7=_0x55f461[_0x4b2860(0xba5)](/(\[[\s\S]*\])/);if(!_0x5e67e7||!_0x5e67e7[0x0])throw new Error(_0x4b2860(0x600)+_0x55f461);const _0x53c6a9=_0x5e67e7[0x0];let _0x2e98c8;try{_0x2e98c8=JSON[_0x4b2860(0x129c)](_0x53c6a9);}catch(_0x4d4fff){throw new Error(_0x4b2860(0x1160)+_0x4d4fff[_0x4b2860(0x11f0)]+'\x0a\x0aAI原始返回内容:\x0a'+_0x55f461);}_0x67697[_0x4b2860(0xc33)]=_0x2e98c8[_0x4b2860(0x1431)](_0x31172c=>({'id':Date[_0x4b2860(0xd6e)]()+Math[_0x4b2860(0x13ae)](),'title':_0x31172c['title'],'content':_0x31172c[_0x4b2860(0x128c)],'timestamp':Date[_0x4b2860(0xd6e)]()})),await _0x3df81a[_0x4b2860(0x589)][_0x4b2860(0x295)](_0x67697),await _0x4151e3();}catch(_0x1b4e33){console[_0x4b2860(0x127d)](_0x4b2860(0x210),_0x1b4e33),await _0x1460c5(_0x4b2860(0x108a),_0x4b2860(0x691)+_0x1b4e33[_0x4b2860(0x11f0)]);}}async function _0x2d26cb(){const _0x1e15db=_0x2b1222;if(!_0x2123eb)return;const _0x525377=_0x1ae02e[_0x1e15db(0x589)][_0x2123eb];if(!_0x525377)return;await _0x1460c5(_0x1e15db(0x11b7),_0x1e15db(0xc8f)+_0x525377[_0x1e15db(0x5d2)]+_0x1e15db(0x81c));const {proxyUrl:_0xfe7343,apiKey:_0x3db561,model:_0x341494}=_0x1ae02e[_0x1e15db(0x226)];if(!_0xfe7343||!_0x3db561||!_0x341494)return;const _0x2bb1ea=_0x1ae02e['qzoneSettings']['nickname']===_0x1e15db(0xee7)||!_0x1ae02e[_0x1e15db(0x11ef)][_0x1e15db(0xb46)]?'用户':_0x1ae02e[_0x1e15db(0x11ef)]['nickname'],_0x4314b2=_0x525377[_0x1e15db(0x5fb)]&&_0x525377['longTermMemory'][_0x1e15db(0x58a)]>0x0?_0x525377[_0x1e15db(0x5fb)][_0x1e15db(0x1431)](_0x5a7182=>_0x1e15db(0x10a4)+_0x3f7f7a(_0x5a7182[_0x1e15db(0x1388)])+')\x20'+_0x5a7182[_0x1e15db(0x128c)])['join']('\x0a'):'无',_0x3cfb08=_0x525377[_0x1e15db(0x6a8)][_0x1e15db(0x4b2)]||0xa,_0x4c54f7=_0x525377[_0x1e15db(0xce3)]['slice'](-_0x3cfb08)[_0x1e15db(0x1431)](_0x31983c=>(_0x31983c[_0x1e15db(0xfbb)]===_0x1e15db(0x860)?_0x2bb1ea:_0x525377[_0x1e15db(0x5d2)])+':\x20'+String(_0x31983c[_0x1e15db(0x128c)])['substring'](0x0,0x1e)+_0x1e15db(0x629))['join']('\x0a'),_0x5abaa5=(_0x525377[_0x1e15db(0x6a8)][_0x1e15db(0x1469)]||[])[_0x1e15db(0x1431)](_0x413855=>_0x1ae02e[_0x1e15db(0x1453)]['find'](_0x4179dc=>_0x4179dc['id']===_0x413855))['filter'](Boolean)[_0x1e15db(0x1431)](_0x8b27cf=>'\x0a##\x20世界书《'+_0x8b27cf[_0x1e15db(0x5d2)]+'》设定:\x0a'+_0x8b27cf[_0x1e15db(0x128c)][_0x1e15db(0xede)](_0x1486ec=>_0x1486ec['enabled'])[_0x1e15db(0x1431)](_0x55bf88=>'-\x20'+_0x55bf88[_0x1e15db(0x128c)])[_0x1e15db(0x1143)]('\x0a'))['join'](''),_0x7557ef=_0x1e15db(0x6a2)+_0x525377[_0x1e15db(0x5d2)]+_0x1e15db(0x76c)+new Date()[_0x1e15db(0x5c5)]('zh-CN')+_0x1e15db(0x1245)+_0x525377[_0x1e15db(0x6a8)][_0x1e15db(0xf42)]+_0x1e15db(0x5e4)+_0x4314b2+'\x0a'+_0x5abaa5+_0x1e15db(0xff0)+_0x2bb1ea+'”的对话摘要**:\x0a'+_0x4c54f7+_0x1e15db(0xd34);try{const _0x2134cc=[{'role':_0x1e15db(0x860),'content':_0x1e15db(0xe24)}];let _0x36b917=_0xfe7343['includes']('generativelanguage'),_0x215bd4=_0x16b978(_0x341494,_0x3db561,_0x7557ef,_0x2134cc);const _0x30f3dc=_0x36b917?await fetch(_0x215bd4[_0x1e15db(0x258)],_0x215bd4[_0x1e15db(0xc6b)]):await fetch(_0xfe7343+_0x1e15db(0x14c2),{'method':_0x1e15db(0x12d9),'headers':{'Content-Type':'application/json','Authorization':'Bearer\x20'+_0x3db561},'body':JSON['stringify']({'model':_0x341494,'messages':[{'role':_0x1e15db(0x1594),'content':_0x7557ef},..._0x2134cc],'temperature':_0x1ae02e['globalSettings']['apiTemperature']||0.95})});if(!_0x30f3dc['ok'])throw new Error(_0x1e15db(0xaa6)+_0x30f3dc[_0x1e15db(0x1260)]);const _0x336cc1=await _0x30f3dc[_0x1e15db(0xb84)](),_0x577b49=getGeminiResponseText(_0x336cc1),_0x3361a7=_0x577b49[_0x1e15db(0xba5)](/(\[[\s\S]*\])/);if(!_0x3361a7||!_0x3361a7[0x0])throw new Error('AI返回的内容中未找到有效的JSON数组。原始返回:\x20'+_0x577b49);const _0x49a218=_0x3361a7[0x0];let _0x5327ec;try{_0x5327ec=JSON[_0x1e15db(0x129c)](_0x49a218)[0x0];}catch(_0x452e2d){throw new Error(_0x1e15db(0x1160)+_0x452e2d[_0x1e15db(0x11f0)]+_0x1e15db(0x6b6)+_0x577b49);}if(!_0x525377[_0x1e15db(0xc33)])_0x525377[_0x1e15db(0xc33)]=[];_0x525377[_0x1e15db(0xc33)][_0x1e15db(0x1426)]({'id':Date['now'](),'title':_0x5327ec[_0x1e15db(0x156f)],'content':_0x5327ec[_0x1e15db(0x128c)],'timestamp':Date[_0x1e15db(0xd6e)]()}),await _0x3df81a['chats'][_0x1e15db(0x295)](_0x525377),await _0x4151e3();}catch(_0x418cef){console[_0x1e15db(0x127d)]('生成新日记失败:',_0x418cef),await _0x1460c5(_0x1e15db(0x108a),'错误:\x20'+_0x418cef[_0x1e15db(0x11f0)]);}}function _0x4151e3(){const _0x194a28=_0x2b1222,_0x172572=document['getElementById'](_0x194a28(0x599));_0x172572['innerHTML']='';const _0x5c3735=_0x1ae02e['chats'][_0x2123eb],_0x363735=(_0x5c3735[_0x194a28(0xc33)]||[])[_0x194a28(0x5cc)]()[_0x194a28(0x115a)]();if(_0x363735[_0x194a28(0x58a)]===0x0){_0x172572[_0x194a28(0xf21)]='<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>日记本还是空的。</p>';return;}_0x363735[_0x194a28(0x59b)](_0x477858=>{const _0x3528d9=_0x194a28,_0x3407de=document[_0x3528d9(0x219)](_0x3528d9(0xaf9));_0x3407de[_0x3528d9(0x7c6)]=_0x3528d9(0x269),_0x3407de[_0x3528d9(0xf21)]=_0x3528d9(0x4b7)+_0x477858[_0x3528d9(0x156f)]+_0x3528d9(0x112d)+new Date(_0x477858[_0x3528d9(0x1388)])[_0x3528d9(0x5c5)]()+_0x3528d9(0x1372),_0x3407de[_0x3528d9(0x122b)](_0x3528d9(0x740),()=>_0xfbf8dd(_0x477858['id'])),_0x1160f3(_0x3407de,()=>_0x2c9b72(_0x477858['id'])),_0x172572[_0x3528d9(0x6ce)](_0x3407de);});}async function _0xfbf8dd(_0x3a31d5){const _0x5982e7=_0x2b1222,_0x1cab15=_0x1ae02e['chats'][_0x2123eb];if(!_0x1cab15||!_0x1cab15['diary'])return;const _0x5cfb88=_0x1cab15[_0x5982e7(0xc33)][_0x5982e7(0x13b7)](_0x496e93=>_0x496e93['id']===_0x3a31d5);if(_0x5cfb88){_0x16a7cb=_0x5cfb88;const _0x10e250=document['getElementById'](_0x5982e7(0xddf)),_0x49514d=document[_0x5982e7(0x1f4)](_0x5982e7(0x149d)),_0x4ac32d=document[_0x5982e7(0x1f4)](_0x5982e7(0x164));_0x10e250['textContent']=_0x5cfb88[_0x5982e7(0x156f)];const _0x5db7ca=_0x1ec77d(_0x5cfb88[_0x5982e7(0x128c)])[_0x5982e7(0x23f)]('\x0a')['map'](_0x4b77c6=>_0x5982e7(0x104b)+(_0x4b77c6||_0x5982e7(0x284))+_0x5982e7(0x1517))[_0x5982e7(0x1143)]('');_0x49514d[_0x5982e7(0xf21)]=_0x5db7ca;const _0x18efaa=await _0x3df81a[_0x5982e7(0xbeb)][_0x5982e7(0x478)]({'type':_0x5982e7(0x654),'content.id':_0x3a31d5})[_0x5982e7(0x9a8)]();_0x4ac32d[_0x5982e7(0x159b)][_0x5982e7(0x1483)](_0x5982e7(0x7cf),!!_0x18efaa),_0x1335d9('char-diary-detail-screen');}}async function _0x5d54f8(){const _0x5513c3=_0x2b1222;if(!_0x16a7cb||!_0x2123eb)return;const _0x51cde9=_0x16a7cb,_0x5bd8e1=_0x1ae02e[_0x5513c3(0x589)][_0x2123eb],_0x1de689=document[_0x5513c3(0x1f4)](_0x5513c3(0x164)),_0x14ba97=await _0x3df81a[_0x5513c3(0xbeb)][_0x5513c3(0x478)]({'type':'char_diary','content.id':_0x51cde9['id']})['first']();if(_0x14ba97)await _0x3df81a[_0x5513c3(0xbeb)]['delete'](_0x14ba97['id']),_0x1de689['classList'][_0x5513c3(0xa9c)](_0x5513c3(0x7cf)),await _0x1460c5('操作成功','已取消收藏。');else{const _0xe45e76={'type':_0x5513c3(0x654),'content':{'id':_0x51cde9['id'],'title':_0x51cde9[_0x5513c3(0x156f)],'content':_0x51cde9['content'],'timestamp':_0x51cde9[_0x5513c3(0x1388)],'characterId':_0x2123eb,'characterName':_0x5bd8e1[_0x5513c3(0x5d2)]},'timestamp':Date[_0x5513c3(0xd6e)]()};await _0x3df81a[_0x5513c3(0xbeb)][_0x5513c3(0x6a4)](_0xe45e76),_0x1de689[_0x5513c3(0x159b)]['add'](_0x5513c3(0x7cf)),await _0x1460c5(_0x5513c3(0x1539),_0x5513c3(0x10a5));}}async function _0x11d7e1(){const _0x3f9702=_0x2b1222;if(!_0x4bc9b5||!_0x2123eb)return;const _0x11b3ff=_0x4bc9b5,_0x3afac6=_0x1ae02e[_0x3f9702(0x589)][_0x2123eb],_0x3bdb6c=document[_0x3f9702(0x1f4)](_0x3f9702(0xe48)),_0x2d0243=await _0x3df81a[_0x3f9702(0xbeb)][_0x3f9702(0x478)]({'type':'char_memo','content.id':_0x11b3ff['id']})[_0x3f9702(0x9a8)]();if(_0x2d0243)await _0x3df81a['favorites'][_0x3f9702(0xc40)](_0x2d0243['id']),_0x3bdb6c[_0x3f9702(0x159b)][_0x3f9702(0xa9c)]('active'),await _0x1460c5(_0x3f9702(0x1539),'已取消收藏。');else{const _0x25c846={'type':_0x3f9702(0xc1f),'content':{'id':_0x11b3ff['id'],'title':_0x11b3ff[_0x3f9702(0x156f)],'content':_0x11b3ff['content'],'timestamp':_0x11b3ff[_0x3f9702(0x1388)],'characterId':_0x2123eb,'characterName':_0x3afac6[_0x3f9702(0x5d2)]},'timestamp':Date[_0x3f9702(0xd6e)]()};await _0x3df81a[_0x3f9702(0xbeb)][_0x3f9702(0x6a4)](_0x25c846),_0x3bdb6c[_0x3f9702(0x159b)][_0x3f9702(0x6a4)](_0x3f9702(0x7cf)),await _0x1460c5(_0x3f9702(0x1539),_0x3f9702(0x10a5));}}async function _0x2c9b72(_0x2f5d7d){const _0x3798c1=_0x2b1222,_0x16f3ac=await _0x109970(_0x3798c1(0x46c),_0x3798c1(0xed7),{'confirmButtonClass':_0x3798c1(0x1c6)});if(_0x16f3ac){const _0x343deb=_0x1ae02e[_0x3798c1(0x589)][_0x2123eb];_0x343deb[_0x3798c1(0xc33)]=_0x343deb[_0x3798c1(0xc33)]['filter'](_0x439068=>_0x439068['id']!==_0x2f5d7d),await _0x3df81a[_0x3798c1(0x589)][_0x3798c1(0x295)](_0x343deb),_0x4151e3();}}async function _0x359b34(){const _0x5312b5=_0x2b1222,_0x390483=document[_0x5312b5(0x1f4)](_0x5312b5(0xdef));_0x390483[_0x5312b5(0xf21)]='';const _0x2fc07e=_0x1ae02e[_0x5312b5(0x589)][_0x2123eb];if(!_0x2fc07e)return;const _0x1100e2=_0x2fc07e[_0x5312b5(0x6a8)][_0x5312b5(0xe31)]||(_0x1ae02e[_0x5312b5(0x11ef)][_0x5312b5(0xb46)]||'我'),_0x4e4160=_0x2fc07e[_0x5312b5(0xce3)][_0x5312b5(0xede)](_0x2f2f0d=>!_0x2f2f0d[_0x5312b5(0x58e)])[_0x5312b5(0x5cc)](-0x1)[0x0]||{'content':_0x5312b5(0x629)};let _0x54c634='...';if(_0x4e4160){if(typeof _0x4e4160[_0x5312b5(0x128c)]==='string')_0x54c634=_0x4e4160[_0x5312b5(0x128c)];else{if(Array[_0x5312b5(0x121f)](_0x4e4160[_0x5312b5(0x128c)])&&_0x4e4160['content'][0x0]?.['type']===_0x5312b5(0x1296))_0x54c634=_0x5312b5(0x947);else{if(_0x4e4160['type']){const _0x1ddc30={'voice_message':_0x5312b5(0x57d),'transfer':_0x5312b5(0x915),'ai_image':_0x5312b5(0x947)};_0x54c634=_0x1ddc30[_0x4e4160[_0x5312b5(0xcbd)]]||'['+_0x4e4160[_0x5312b5(0xcbd)]+']';}}}}const _0x28986c=_0x2fc07e['settings']['myAvatar']||_0x5494d0,_0x436af4=_0x2fc07e['settings'][_0x5312b5(0xef7)]||'';let _0x55ee74;_0x436af4?_0x55ee74=_0x5312b5(0xb00)+_0x28986c+'\x22\x20class=\x22avatar-img\x22\x20style=\x22border-radius:\x2050%;\x22><img\x20src=\x22'+_0x436af4+_0x5312b5(0x25a):_0x55ee74=_0x5312b5(0xe63)+_0x28986c+_0x5312b5(0x1359);const _0x3fb546=document[_0x5312b5(0x219)](_0x5312b5(0xaf9));_0x3fb546['className']='chat-list-item',_0x3fb546[_0x5312b5(0x746)][_0x5312b5(0xe58)]='-1',_0x3fb546[_0x5312b5(0xf21)]=_0x5312b5(0x20e)+_0x55ee74+_0x5312b5(0xda3)+_0x1100e2+_0x5312b5(0x3df)+String(_0x54c634)[_0x5312b5(0x516)](0x0,0x14)+_0x5312b5(0xb22),_0x390483[_0x5312b5(0x6ce)](_0x3fb546);const _0xf1483b=await _0x3df81a[_0x5312b5(0x15b9)][_0x5312b5(0x27a)](),_0x3811e0=new Map(_0xf1483b['map'](_0x585840=>[_0x585840[_0x5312b5(0x5d2)],_0x585840])),_0x5981bb=_0x2fc07e[_0x5312b5(0x6fc)]||[];if(_0x5981bb[_0x5312b5(0x58a)]===0x0&&!_0x3fb546){_0x390483[_0x5312b5(0xf21)]=_0x5312b5(0x13af);return;}_0x5981bb[_0x5312b5(0x59b)]((_0x915bc1,_0x4db172)=>{const _0x3af3ff=_0x5312b5;if(_0x915bc1[_0x3af3ff(0xcbd)]===_0x3af3ff(0xc77))return;const _0x2a2a75=document['createElement'](_0x3af3ff(0xaf9));_0x2a2a75[_0x3af3ff(0x7c6)]=_0x3af3ff(0x1153),_0x2a2a75[_0x3af3ff(0x746)][_0x3af3ff(0xe58)]=_0x4db172;let _0xccc39a,_0x10882c,_0x416969;if(_0x915bc1[_0x3af3ff(0xcbd)]==='group'){_0x416969=_0x915bc1[_0x3af3ff(0x5cf)]+_0x3af3ff(0x1427),_0xccc39a=_0x915bc1[_0x3af3ff(0x1580)]['slice'](-0x1)[0x0]||{'content':_0x3af3ff(0x629)};const _0x433fe0='logo,\x20simple,\x20flat\x20design,\x20for\x20a\x20group\x20chat\x20named\x20\x27'+_0x915bc1['groupName']+'\x27',_0x12e679=_0x1ae02e[_0x3af3ff(0x12c0)][_0x3af3ff(0x7d1)]?_0x3af3ff(0xe8f)+encodeURIComponent(_0x433fe0):_0x22fe34;_0x10882c=_0x3af3ff(0xa8f)+_0x12e679+'\x22\x20class=\x22avatar\x22\x20style=\x22border-radius:\x2050%;\x22></div>';}else{_0x416969=_0x915bc1['participant'][_0x3af3ff(0x5d2)],_0xccc39a=_0x915bc1[_0x3af3ff(0x1580)][_0x3af3ff(0x5cc)](-0x1)[0x0]||{'content':'...'};const _0xa0ba2=_0x3811e0[_0x3af3ff(0x13f8)](_0x416969);let _0x20c160=_0xa0ba2&&_0xa0ba2[_0x3af3ff(0x95b)]?_0xa0ba2[_0x3af3ff(0x95b)]:_0x1ae02e[_0x3af3ff(0x12c0)][_0x3af3ff(0x7d1)]?_0x3af3ff(0xe8f)+encodeURIComponent(_0x915bc1['participant'][_0x3af3ff(0x400)]||_0x3af3ff(0x1246)):_0x54779f;_0x10882c='<div\x20class=\x22avatar-group\x22><img\x20src=\x22'+_0x20c160+_0x3af3ff(0x1572);}let _0x597b80=_0x3af3ff(0x629);_0xccc39a&&_0xccc39a[_0x3af3ff(0x128c)]&&(_0x597b80=_0xccc39a[_0x3af3ff(0x128c)]),_0x2a2a75['innerHTML']=_0x3af3ff(0xa73)+_0x10882c+_0x3af3ff(0x9d8)+_0x416969+_0x3af3ff(0x7e9)+String(_0x597b80)[_0x3af3ff(0x516)](0x0,0x14)+'...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x390483[_0x3af3ff(0x6ce)](_0x2a2a75);});}async function _0x169d5d(){const _0x324f60=_0x2b1222;if(!_0x2123eb)return;const _0x16a787=_0x1ae02e['chats'][_0x2123eb];if(!_0x16a787)return;await _0x1460c5(_0x324f60(0x11b7),_0x324f60(0x43a)+_0x16a787[_0x324f60(0x5d2)]+'”的记忆和人设，生成全新的社交动态...');const {proxyUrl:_0x5aff63,apiKey:_0x2655ab,model:_0xa018b0}=_0x1ae02e[_0x324f60(0x226)];if(!_0x5aff63||!_0x2655ab||!_0xa018b0){alert(_0x324f60(0x4af));return;}const _0x995c95=await _0x3df81a[_0x324f60(0x15b9)]['toArray'](),_0x1d8d87=_0x995c95['filter'](_0x2481c2=>_0x2481c2[_0x324f60(0x11e9)]&&_0x2481c2[_0x324f60(0x11e9)][_0x324f60(0xe82)](_0x2123eb));let _0x4ac11d=_0x324f60(0x2e9);_0x1d8d87[_0x324f60(0x58a)]>0x0?(_0x4ac11d+=_0x324f60(0x9f3),_0x1d8d87[_0x324f60(0x59b)](_0x4946cb=>{const _0x333f01=_0x324f60;_0x4ac11d+=_0x333f01(0x1ec)+_0x4946cb[_0x333f01(0x5d2)]+_0x333f01(0x4ce)+_0x4946cb['persona']+'\x0a';})):_0x4ac11d+=_0x324f60(0x4cf);const _0x837e15=_0x1ae02e[_0x324f60(0x11ef)][_0x324f60(0xb46)]===_0x324f60(0xee7)||!_0x1ae02e[_0x324f60(0x11ef)][_0x324f60(0xb46)]?'用户':_0x1ae02e[_0x324f60(0x11ef)][_0x324f60(0xb46)],_0x144dc8=_0x16a787[_0x324f60(0x6a8)][_0x324f60(0xe31)]||_0x837e15,_0x412de7=_0x16a787['longTermMemory']&&_0x16a787[_0x324f60(0x5fb)][_0x324f60(0x58a)]>0x0?_0x16a787[_0x324f60(0x5fb)][_0x324f60(0x1431)](_0x44a3df=>_0x324f60(0x10a4)+_0x3f7f7a(_0x44a3df[_0x324f60(0x1388)])+')\x20'+_0x44a3df['content'])[_0x324f60(0x1143)]('\x0a'):'无',_0x3a0bff=_0x16a787[_0x324f60(0x6a8)][_0x324f60(0x4b2)]||0xa,_0x340c5f=_0x16a787[_0x324f60(0xce3)]['slice'](-_0x3a0bff)[_0x324f60(0x1431)](_0x16a820=>(_0x16a820[_0x324f60(0xfbb)]==='user'?_0x144dc8:_0x16a787[_0x324f60(0x5d2)])+':\x20'+String(_0x16a820[_0x324f60(0x128c)])[_0x324f60(0x516)](0x0,0x1e)+'...')[_0x324f60(0x1143)]('\x0a'),_0x91a2c9=(_0x16a787[_0x324f60(0x6a8)]['linkedWorldBookIds']||[])[_0x324f60(0x1431)](_0x47f48e=>_0x1ae02e[_0x324f60(0x1453)][_0x324f60(0x13b7)](_0x186ca0=>_0x186ca0['id']===_0x47f48e))[_0x324f60(0xede)](Boolean)[_0x324f60(0x1431)](_0x134633=>_0x324f60(0x44b)+_0x134633[_0x324f60(0x5d2)]+_0x324f60(0x63a)+_0x134633[_0x324f60(0x128c)][_0x324f60(0xede)](_0x9b25a2=>_0x9b25a2[_0x324f60(0x1368)])[_0x324f60(0x1431)](_0xd946c5=>'-\x20'+_0xd946c5[_0x324f60(0x128c)])['join']('\x0a'))['join'](''),_0x55d19e=_0x16a787[_0x324f60(0x96f)]||_0x16a787['name'],_0x427a36=_0x2c88ab(_0x16a787),_0x594a82=_0x324f60(0x124e)+_0x16a787[_0x324f60(0x5d2)]+'”。你的任务是虚构出【5到7段】TA最近的QQ聊天记录。\x0a\x0a#\x20核心规则\x0a1.\x20\x20**【NPC唯一性铁律】**:\x20在你本次生成的所有对话中（包括私聊和群聊），每一个NPC的名字【必须是独一-无二的】。绝对禁止出现重名的NPC，禁止出现重复群聊。\x0a2.\x20\x20**【NPC来源】**:\x20你应该优先从“你的社交圈\x20(绑定的NPC)”和“世界书”中寻找角色作为聊天对象。如果不够，你也可以自由创造全新的NPC，对话内容要多样化，反映角色的生活。\x0a3.\x20\x20**关联性**:\x20对话内容应巧妙地反映角色的长期记忆、世界观，以及与用户互动可能带来的心情变化。\x0a4.\x20\x20**简洁性**:\x20每段对话的总长度应在8到15句之间。\x0a#\x20格式铁律\x20(最高优先级)\x0a-\x20你的回复【必须且只能】是一个JSON数组格式的字符串，以\x20`[`\x20开始，并以\x20`]`\x20结束。\x0a-\x20【绝对禁止】在JSON数组前后添加任何多余的文字、解释、或\x20markdown\x20标记。\x0a-\x20数组中的每个元素都代表一段对话，且【必须】是以下两种格式之一：\x0a\x0a\x0a\x0a###\x20格式\x20A：与NPC的私聊\x0a```json\x0a{\x0a\x20\x20\x22type\x22:\x20\x22private_npc\x22,\x0a\x20\x20\x22participant\x22:\x20{\x0a\x20\x20\x20\x20\x22name\x22:\x20\x22NPC的名字\x22,\x0a\x20\x20\x20\x20\x22avatar_prompt\x22:\x20\x22(仅当NPC是新创造时提供)一段用于生成头像的【英文】关键词,\x20风格为动漫/插画/二次元等,\x20禁止真人\x22\x0a\x20\x20},\x0a\x22messages\x22:\x20[\x0a\x20\x20{\x22sender\x22:\x20\x22'+_0x55d19e+_0x324f60(0x1045)+_0x55d19e+_0x324f60(0x100e)+_0x55d19e+'\x22,\x20\x22content\x22:\x20\x22我在群里说的话\x22},\x0a\x20\x20{\x22sender\x22:\x20\x22NPC成员1\x22,\x20\x22content\x22:\x20\x22成员1回复我\x22},\x0a\x20\x20{\x22sender\x22:\x20\x22NPC成员2\x22,\x20\x22type\x22:\x20\x22sticker\x22,\x20\x22meaning\x22:\x20\x22表情的含义(必须从可用表情列表选择)\x22}\x0a]\x0a}\x0a```\x0a\x0a#\x20角色与上下文\x0a-\x20**你的角色设定**:\x20'+_0x16a787[_0x324f60(0x6a8)][_0x324f60(0xf42)]+_0x324f60(0x13e3)+_0x412de7+_0x324f60(0x3c9)+_0x91a2c9+_0x324f60(0x44e)+_0x340c5f+'\x0a'+_0x4ac11d+'\x0a#\x20可用表情包\x20(必须严格遵守！)\x0a-\x20当你需要发送表情时，你【必须】从下面的列表中【精确地选择一个】含义（meaning）。\x0a-\x20【绝对禁止】使用任何不在列表中的表情含义！\x0a'+_0x427a36+_0x324f60(0x3e5);try{const _0x58d396=[{'role':_0x324f60(0x860),'content':'请根据你的设定，生成模拟聊天记录。'}];let _0x5e0654=_0x5aff63[_0x324f60(0xe82)](_0x324f60(0xc38)),_0x1ef284=_0x16b978(_0xa018b0,_0x2655ab,_0x594a82,_0x58d396);const _0x389a73=_0x5e0654?await fetch(_0x1ef284[_0x324f60(0x258)],_0x1ef284['data']):await fetch(_0x5aff63+_0x324f60(0x14c2),{'method':'POST','headers':{'Content-Type':_0x324f60(0xa90),'Authorization':_0x324f60(0xf03)+_0x2655ab},'body':JSON[_0x324f60(0x994)]({'model':_0xa018b0,'messages':[{'role':_0x324f60(0x1594),'content':_0x594a82},..._0x58d396],'temperature':_0x1ae02e[_0x324f60(0x12c0)][_0x324f60(0x217)]||0.9})});if(!_0x389a73['ok'])throw new Error(_0x324f60(0xaa6)+_0x389a73[_0x324f60(0x1260)]);const _0x36d697=await _0x389a73['json'](),_0x5e5adc=getGeminiResponseText(_0x36d697),_0xfca248=_0x5e5adc[_0x324f60(0xba5)](/(\[[\s\S]*\])/);if(!_0xfca248||!_0xfca248[0x0])throw new Error(_0x324f60(0x600)+_0x5e5adc);const _0x5cdf67=_0xfca248[0x0];let _0x3989c2;try{_0x3989c2=JSON[_0x324f60(0x129c)](_0x5cdf67);}catch(_0x1f664b){throw new Error(_0x324f60(0x1160)+_0x1f664b[_0x324f60(0x11f0)]+'\x0a\x0aAI原始返回内容:\x0a'+_0x5e5adc);}_0x16a787[_0x324f60(0x6fc)]=_0x3989c2,await _0x3df81a[_0x324f60(0x589)][_0x324f60(0x295)](_0x16a787),await _0x359b34();const _0x5d8ea2={'role':_0x324f60(0x1594),'content':'[系统指令：你刚刚在自己的手机上活动了一番（和朋友聊天、逛群等）。现在请根据你的角色设定，主动给用户发一条消息，可以聊聊你刚才看到或聊到的趣事，或者仅仅是问候一下。]','timestamp':Date[_0x324f60(0xd6e)](),'isHidden':!![]};_0x16a787[_0x324f60(0xce3)][_0x324f60(0x1426)](_0x5d8ea2),await _0x3df81a['chats'][_0x324f60(0x295)](_0x16a787),_0x5626da();}catch(_0x21f0b9){console['error'](_0x324f60(0x15a2),_0x21f0b9),await _0x1460c5(_0x324f60(0x108a),_0x324f60(0x88d)+_0x21f0b9[_0x324f60(0x11f0)]);}}async function _0x4562fa(){const _0x1e6f58=_0x2b1222;if(!_0x2123eb)return;const _0x55035d=_0x1ae02e[_0x1e6f58(0x589)][_0x2123eb];if(!_0x55035d)return;try{const {proxyUrl:_0x28fee0,apiKey:_0x12d457,model:_0x2333fd}=_0x1ae02e['apiConfig'];if(!_0x28fee0||!_0x12d457||!_0x2333fd)throw new Error('API未配置，无法生成对话。');const _0x1c064a=parseInt(_0x55035d[_0x1e6f58(0x6a8)]['maxMemory'])||0xa,_0x4dd6db=_0x55035d[_0x1e6f58(0xce3)]['slice'](-_0x1c064a),_0x530dae=_0x55035d['settings']['myNickname']||'我',_0x1ca200=_0x55035d['settings'][_0x1e6f58(0x36b)]||'用户',_0x367148=_0x1e6f58(0xe7a)+(_0x55035d['longTermMemory']&&_0x55035d[_0x1e6f58(0x5fb)][_0x1e6f58(0x58a)]>0x0?_0x55035d[_0x1e6f58(0x5fb)]['map'](_0x21095b=>'-\x20'+_0x21095b[_0x1e6f58(0x128c)])[_0x1e6f58(0x1143)]('\x0a'):_0x1e6f58(0x1384));let _0x3e57d3='';if(_0x55035d[_0x1e6f58(0x6a8)][_0x1e6f58(0x1469)]&&_0x55035d[_0x1e6f58(0x6a8)][_0x1e6f58(0x1469)][_0x1e6f58(0x58a)]>0x0){const _0x38e5bc=_0x55035d[_0x1e6f58(0x6a8)]['linkedWorldBookIds'][_0x1e6f58(0x1431)](_0x50fc09=>{const _0x2605b2=_0x1e6f58,_0x247500=_0x1ae02e[_0x2605b2(0x1453)][_0x2605b2(0x13b7)](_0x3c96a7=>_0x3c96a7['id']===_0x50fc09);if(!_0x247500||!Array[_0x2605b2(0x121f)](_0x247500[_0x2605b2(0x128c)]))return'';const _0x1e3116=_0x247500[_0x2605b2(0x128c)]['filter'](_0x4da8ea=>_0x4da8ea[_0x2605b2(0x1368)]!==![])['map'](_0x4abd8b=>'\x0a###\x20条目:\x20'+(_0x4abd8b[_0x2605b2(0x306)]||_0x2605b2(0x286))+_0x2605b2(0xd7d)+_0x4abd8b[_0x2605b2(0x128c)])[_0x2605b2(0x1143)]('');return _0x1e3116?_0x2605b2(0x404)+_0x247500[_0x2605b2(0x5d2)]+'\x0a'+_0x1e3116:'';})[_0x1e6f58(0xede)](Boolean)[_0x1e6f58(0x1143)]('');_0x38e5bc&&(_0x3e57d3=_0x1e6f58(0x140b)+_0x38e5bc+'\x0a');}const _0x6d7c7a=_0x5a2518(_0x55035d,0x3,_0x1e6f58(0x5f2)),_0x574ed4=_0x5a2518(_0x55035d,0x6,_0x1e6f58(0x5f2)),_0x4f51a7=_0x5a2518(_0x55035d,0x9,_0x1e6f58(0x5f2)),_0x20d88f=_0x5a2518(_0x55035d,0x1,_0x1e6f58(0x1265)),_0x4b354a=_0x5a2518(_0x55035d,0x3,_0x1e6f58(0x1265)),_0x4019f4=_0x5a2518(_0x55035d,0x7,_0x1e6f58(0x1265));let _0x492c6a='';if(_0x6d7c7a||_0x574ed4||_0x4f51a7||_0x20d88f||_0x4b354a||_0x4019f4){_0x492c6a+=_0x1e6f58(0x135e);if(_0x6d7c7a)_0x492c6a+=_0x6d7c7a;if(_0x574ed4)_0x492c6a+=_0x574ed4;if(_0x4f51a7)_0x492c6a+=_0x4f51a7;if(_0x6d7c7a||_0x574ed4||_0x4f51a7)_0x492c6a+='\x0a';if(_0x20d88f)_0x492c6a+=_0x20d88f;if(_0x4b354a)_0x492c6a+=_0x4b354a;if(_0x4019f4)_0x492c6a+=_0x4019f4;}const _0x2a7e29=_0x1df3df(_0x55035d),_0x506097='\x0a#\x20你的核心任务\x0a你正在扮演角色“'+_0x55035d['originalName']+_0x1e6f58(0x1239)+_0x55035d[_0x1e6f58(0x6a8)][_0x1e6f58(0xf42)]+_0x1e6f58(0xf0e)+_0x2a7e29+_0x1e6f58(0x1030)+_0x1ca200+_0x1e6f58(0x1472)+_0x55035d['originalName']+'\x22\x0a-\x20**用户的备注**:\x20\x22'+_0x530dae+'\x22\x0a'+_0x3e57d3+'\x0a'+_0x367148+'\x0a'+_0x492c6a+_0x1e6f58(0x1151)+_0x4dd6db['map'](_0x44f087=>(_0x44f087[_0x1e6f58(0xfbb)]==='user'?_0x530dae:_0x55035d[_0x1e6f58(0x5d2)])+':\x20'+String(_0x44f087[_0x1e6f58(0x128c)]))[_0x1e6f58(0x1143)]('\x0a')+_0x1e6f58(0x11eb),_0x31f3ae=_0x4dd6db[_0x1e6f58(0x1431)](_0x2faa0b=>({'role':_0x2faa0b[_0x1e6f58(0xfbb)],'content':(_0x2faa0b[_0x1e6f58(0xfbb)]===_0x1e6f58(0x860)?_0x530dae:_0x55035d[_0x1e6f58(0x5d2)])+':\x20'+String(_0x2faa0b[_0x1e6f58(0x128c)])}));let _0x558364=_0x28fee0[_0x1e6f58(0xe82)](_0x1e6f58(0xc38)),_0x44188c=_0x16b978(_0x2333fd,_0x12d457,_0x506097,_0x31f3ae);const _0x1e710f=_0x558364?await fetch(_0x44188c[_0x1e6f58(0x258)],_0x44188c[_0x1e6f58(0xc6b)]):await fetch(_0x28fee0+'/v1/chat/completions',{'method':_0x1e6f58(0x12d9),'headers':{'Content-Type':_0x1e6f58(0xa90),'Authorization':_0x1e6f58(0xf03)+_0x12d457},'body':JSON[_0x1e6f58(0x994)]({'model':_0x2333fd,'messages':[{'role':'system','content':_0x506097},..._0x31f3ae],'temperature':_0x1ae02e['globalSettings'][_0x1e6f58(0x217)]||0.8})});if(!_0x1e710f['ok'])throw new Error(_0x1e6f58(0x47b)+(await _0x1e710f[_0x1e6f58(0xb84)]())['error']['message']);const _0x3ef9b1=await _0x1e710f[_0x1e6f58(0xb84)](),_0x2e1559=getGeminiResponseText(_0x3ef9b1),_0x134ea2=_0x1493d9(_0x2e1559);if(!_0x134ea2||_0x134ea2[_0x1e6f58(0x58a)]===0x0)throw new Error('AI返回了空内容。');let _0x1d1f31=0x0,_0x4159a2=Date[_0x1e6f58(0xd6e)]();for(const _0xa4345b of _0x134ea2){const _0x21e739={'role':_0x1e6f58(0x13c0),'senderName':_0x55035d[_0x1e6f58(0x96f)],'timestamp':_0x4159a2++};let _0x920d4d=null;switch(_0xa4345b[_0x1e6f58(0xcbd)]){case _0x1e6f58(0x40f):_0x920d4d={..._0x21e739,'content':String(_0xa4345b[_0x1e6f58(0x128c)]||_0xa4345b[_0x1e6f58(0x11f0)])};break;case _0x1e6f58(0x1b3):if(_0xa4345b[_0x1e6f58(0x339)]){const _0x49a67b=_0x1ae02e[_0x1e6f58(0x1420)][_0x1e6f58(0x13b7)](_0x1b22ec=>_0x1b22ec[_0x1e6f58(0x5d2)]===_0xa4345b[_0x1e6f58(0x339)]);_0x49a67b?_0x920d4d={..._0x21e739,'type':_0x1e6f58(0x1b3),'content':_0x49a67b[_0x1e6f58(0x258)],'meaning':_0x49a67b[_0x1e6f58(0x5d2)]}:(console[_0x1e6f58(0xb3b)](_0x1e6f58(0xf87)+_0xa4345b[_0x1e6f58(0x339)]+'\x22'),_0x920d4d={..._0x21e739,'type':_0x1e6f58(0x40f),'content':_0x1e6f58(0xe39)+_0xa4345b[_0x1e6f58(0x339)]+']'});}else console[_0x1e6f58(0xb3b)](_0x1e6f58(0x9cf),_0xa4345b),_0x920d4d={..._0x21e739,'type':_0x1e6f58(0x1b3),'content':_0xa4345b[_0x1e6f58(0x258)],'meaning':_0x1e6f58(0x12bc)};break;}_0x920d4d&&(_0x55035d[_0x1e6f58(0xce3)]['push'](_0x920d4d),_0x1d1f31++);}_0x1d1f31>0x0&&(_0x55035d[_0x1e6f58(0xf2c)]=(_0x55035d[_0x1e6f58(0xf2c)]||0x0)+_0x1d1f31),await _0x3df81a[_0x1e6f58(0x589)]['put'](_0x55035d),await _0x1033ae(),_0x1d1f31>0x0&&_0x158e58(_0x55035d['id'],_0x1e6f58(0x30a)+_0x1d1f31+'\x20条新消息');}catch(_0x3da81d){console[_0x1e6f58(0x127d)](_0x1e6f58(0x627),_0x3da81d),await _0x1460c5(_0x1e6f58(0xc5a),'无法生成新回复:\x20'+_0x3da81d[_0x1e6f58(0x11f0)]);}}async function _0x5cf6f7(){const _0x56d16e=_0x2b1222;if(_0x4d2c3e||!_0x2123eb)return;_0x4d2c3e=!![];const _0x552261=document[_0x56d16e(0x1f4)](_0x56d16e(0x95d)),_0x5bced7=_0x1ae02e[_0x56d16e(0x589)][_0x2123eb];if(!_0x5bced7){_0x4d2c3e=![];return;}_0x5563af(_0x552261,_0x56d16e(0xe00));const _0x200e59=_0x552261['scrollHeight'];await new Promise(_0x232079=>setTimeout(_0x232079,0x1f4));const _0x8af215=_0x5bced7['history']['length'],_0x2baf34=_0x1ae02e[_0x56d16e(0x12c0)][_0x56d16e(0xf47)]||0x32,_0x4715c2=_0x8af215-_0x369c2d,_0x850ebf=Math[_0x56d16e(0x616)](0x0,_0x4715c2-_0x2baf34),_0x481779=_0x5bced7[_0x56d16e(0xce3)][_0x56d16e(0x5cc)](_0x850ebf,_0x4715c2);_0x1335c4(_0x552261);if(_0x481779[_0x56d16e(0x58a)]===0x0){_0x4d2c3e=![];return;}for(const _0x16d328 of _0x481779[_0x56d16e(0x115a)]()){const _0x5994b1={..._0x16d328,'role':_0x16d328[_0x56d16e(0xfbb)]==='user'?_0x56d16e(0x13c0):'user'},_0x59e8b8={'id':_0x56d16e(0x11cf),'isGroup':![],'name':_0x5bced7[_0x56d16e(0x5d2)],'settings':{..._0x5bced7[_0x56d16e(0x6a8)],'myAvatar':_0x5bced7[_0x56d16e(0x6a8)][_0x56d16e(0xc99)],'myAvatarFrame':_0x5bced7['settings'][_0x56d16e(0x94d)],'aiAvatar':_0x5bced7[_0x56d16e(0x6a8)]['myAvatar'],'aiAvatarFrame':_0x5bced7[_0x56d16e(0x6a8)][_0x56d16e(0xef7)]}},_0x22d496=await _0x1c1dfa(_0x5994b1,_0x59e8b8);_0x22d496&&_0x552261[_0x56d16e(0x2d2)](_0x22d496);}_0x369c2d+=_0x481779[_0x56d16e(0x58a)];const _0x772c99=_0x552261[_0x56d16e(0x1092)];_0x552261[_0x56d16e(0x2d4)]=_0x772c99-_0x200e59,_0x4d2c3e=![];}async function _0x54b7eb(_0x5ded0f){const _0x47d77d=_0x2b1222,_0x2da472=_0x1ae02e[_0x47d77d(0x589)][_0x2123eb];if(!_0x2da472)return;_0x5b33ce=_0x5ded0f===-0x1?_0x47d77d(0xc77):_0x2da472['simulatedConversations'][_0x5ded0f]?.[_0x47d77d(0xcbd)];const _0x34a0ae=document[_0x47d77d(0x1f4)](_0x47d77d(0x95d));_0x34a0ae[_0x47d77d(0xf21)]='',_0x34a0ae[_0x47d77d(0x746)][_0x47d77d(0x195)]=_0x2da472['settings'][_0x47d77d(0x195)]||'default';const _0x2fe4f7=document[_0x47d77d(0x1f4)](_0x47d77d(0x296))[_0x47d77d(0x159b)][_0x47d77d(0xaea)](_0x47d77d(0xe08));_0x34a0ae[_0x47d77d(0x215)]['backgroundColor']=_0x2fe4f7?_0x47d77d(0x147e):'#f0f2f5';let _0x35bfc0,_0x5d87d3=[];const _0x542ed3=await _0x3df81a[_0x47d77d(0x15b9)][_0x47d77d(0x27a)](),_0x57c07f=new Map(_0x542ed3['map'](_0x2369df=>[_0x2369df[_0x47d77d(0x5d2)],_0x2369df]));if(_0x5ded0f===-0x1){_0x5b33ce=_0x47d77d(0xc77);const _0x5c296f=document[_0x47d77d(0x1f4)](_0x47d77d(0xc17)),_0x19597e=document[_0x47d77d(0x1f4)](_0x47d77d(0xdb6));_0x34a0ae['innerHTML']='',_0x5c296f[_0x47d77d(0x231)]=_0x2da472['settings'][_0x47d77d(0xe31)]||(_0x1ae02e[_0x47d77d(0x11ef)][_0x47d77d(0xb46)]||'我'),_0x19597e[_0x47d77d(0xced)]='与\x20'+(_0x2da472[_0x47d77d(0x6a8)][_0x47d77d(0xe31)]||'我')+_0x47d77d(0x147c),_0x369c2d=0x0,_0x4d2c3e=![];const _0x2ae19b=_0x2da472[_0x47d77d(0xce3)],_0xa42d18=_0x1ae02e[_0x47d77d(0x12c0)][_0x47d77d(0xf47)]||0x32,_0x1ccca9=_0x2ae19b[_0x47d77d(0x5cc)](-_0xa42d18);_0x35bfc0={'id':_0x47d77d(0x11cf),'isGroup':![],'name':_0x2da472[_0x47d77d(0x5d2)],'settings':{..._0x2da472[_0x47d77d(0x6a8)],'myAvatar':_0x2da472[_0x47d77d(0x6a8)]['aiAvatar'],'myAvatarFrame':_0x2da472[_0x47d77d(0x6a8)]['aiAvatarFrame'],'aiAvatar':_0x2da472[_0x47d77d(0x6a8)]['myAvatar'],'aiAvatarFrame':_0x2da472[_0x47d77d(0x6a8)][_0x47d77d(0xef7)]}},_0x5d87d3=_0x1ccca9[_0x47d77d(0x1431)](_0x2e0d80=>({..._0x2e0d80,'role':_0x2e0d80['role']==='user'?_0x47d77d(0x13c0):_0x47d77d(0x860)})),_0x369c2d=_0x1ccca9[_0x47d77d(0x58a)];}else{const _0x3797a7=_0x2da472['simulatedConversations'][_0x5ded0f];if(!_0x3797a7)return;_0x5b33ce=_0x3797a7[_0x47d77d(0xcbd)];const _0x175b5a=document[_0x47d77d(0x1f4)]('char-conversation-partner-name'),_0x39761d=document[_0x47d77d(0x1f4)](_0x47d77d(0xdb6));if(_0x3797a7['type']===_0x47d77d(0x678))_0x175b5a[_0x47d77d(0x231)]=_0x3797a7[_0x47d77d(0x5cf)]+'\x20('+(_0x3797a7['participants'][_0x47d77d(0x58a)]+0x1)+')',_0x39761d[_0x47d77d(0xced)]='在\x20'+_0x3797a7[_0x47d77d(0x5cf)]+_0x47d77d(0xaab),_0x35bfc0={'id':'temp_group_chat','isGroup':!![],'name':_0x3797a7[_0x47d77d(0x5cf)],'originalName':_0x2da472['originalName'],'members':_0x3797a7[_0x47d77d(0x1059)][_0x47d77d(0x1431)](_0x1dfcc2=>{const _0x343af5=_0x47d77d,_0x56c033=_0x57c07f[_0x343af5(0x13f8)](_0x1dfcc2[_0x343af5(0x5d2)]);let _0x2eb30e=_0x56c033&&_0x56c033['avatar']?_0x56c033[_0x343af5(0x95b)]:_0x1ae02e['globalSettings'][_0x343af5(0x7d1)]?_0x343af5(0xe8f)+encodeURIComponent(_0x1dfcc2[_0x343af5(0x400)]||'anime\x20person'):_0x54779f;return{'originalName':_0x1dfcc2['name'],'groupNickname':_0x1dfcc2[_0x343af5(0x5d2)],'avatar':_0x2eb30e};}),'settings':{..._0x2da472[_0x47d77d(0x6a8)],'myNickname':_0x2da472['name'],'myAvatar':_0x2da472[_0x47d77d(0x6a8)]['aiAvatar'],'myAvatarFrame':_0x2da472[_0x47d77d(0x6a8)][_0x47d77d(0x94d)]}};else{_0x175b5a[_0x47d77d(0x231)]=_0x3797a7[_0x47d77d(0x622)][_0x47d77d(0x5d2)],_0x39761d[_0x47d77d(0xced)]='与\x20'+_0x3797a7[_0x47d77d(0x622)][_0x47d77d(0x5d2)]+_0x47d77d(0x159a);const _0x30e348=_0x57c07f[_0x47d77d(0x13f8)](_0x3797a7['participant'][_0x47d77d(0x5d2)]),_0x1e6a86=_0x30e348&&_0x30e348['avatar']?_0x30e348[_0x47d77d(0x95b)]:_0x1ae02e[_0x47d77d(0x12c0)][_0x47d77d(0x7d1)]?_0x47d77d(0xe8f)+encodeURIComponent(_0x3797a7[_0x47d77d(0x622)][_0x47d77d(0x400)]||_0x47d77d(0x1246)):_0x54779f;_0x35bfc0={'id':_0x47d77d(0x594),'isGroup':![],'name':_0x3797a7[_0x47d77d(0x622)][_0x47d77d(0x5d2)],'originalName':_0x2da472[_0x47d77d(0x96f)],'settings':{..._0x2da472[_0x47d77d(0x6a8)],'myAvatar':_0x2da472[_0x47d77d(0x6a8)][_0x47d77d(0xc99)],'myAvatarFrame':_0x2da472[_0x47d77d(0x6a8)][_0x47d77d(0x94d)],'aiAvatar':_0x1e6a86,'aiAvatarFrame':''}};}_0x5d87d3=_0x3797a7[_0x47d77d(0x1580)];}for(const _0x357dc9 of _0x5d87d3){let _0x42d23a=_0x357dc9['role'];if(_0x5ded0f!==-0x1){const _0x48d20b=_0x357dc9[_0x47d77d(0xd1b)]===(_0x2da472[_0x47d77d(0x96f)]||_0x2da472[_0x47d77d(0x5d2)]);_0x42d23a=_0x48d20b?_0x47d77d(0x860):_0x47d77d(0x13c0);}const _0x256a9c={'role':_0x42d23a,'senderName':_0x357dc9['sender']||(_0x42d23a===_0x47d77d(0x860)?_0x35bfc0[_0x47d77d(0x6a8)]['myNickname']:_0x35bfc0[_0x47d77d(0x5d2)]),'timestamp':_0x357dc9['timestamp']||Date[_0x47d77d(0xd6e)]()+Math['random']()};if(_0x357dc9[_0x47d77d(0xcbd)]===_0x47d77d(0x1b3)&&_0x357dc9['meaning']){const _0x500888=_0x1ae02e[_0x47d77d(0x1420)][_0x47d77d(0x13b7)](_0x530fa4=>_0x530fa4[_0x47d77d(0x5d2)]===_0x357dc9[_0x47d77d(0x339)]);_0x500888?(_0x256a9c[_0x47d77d(0x128c)]=_0x500888[_0x47d77d(0x258)],_0x256a9c[_0x47d77d(0x339)]=_0x357dc9[_0x47d77d(0x339)],_0x256a9c[_0x47d77d(0xcbd)]='sticker'):(console[_0x47d77d(0xb3b)](_0x47d77d(0x237)+_0x357dc9[_0x47d77d(0x339)]+_0x47d77d(0x107c)),_0x256a9c[_0x47d77d(0x128c)]=_0x47d77d(0xe39)+_0x357dc9['meaning']+']',_0x256a9c[_0x47d77d(0xcbd)]=_0x47d77d(0x40f));}else _0x256a9c[_0x47d77d(0x128c)]=_0x357dc9['content'],_0x256a9c[_0x47d77d(0xcbd)]=_0x357dc9[_0x47d77d(0xcbd)]||_0x47d77d(0x40f);const _0x277039=await _0x1c1dfa(_0x256a9c,_0x35bfc0);_0x277039&&_0x34a0ae['appendChild'](_0x277039);}_0x1335d9(_0x47d77d(0x71b)),setTimeout(()=>_0x34a0ae[_0x47d77d(0x2d4)]=_0x34a0ae[_0x47d77d(0x1092)],0x0);}function _0x294a5c(){const _0x1189cf=_0x2b1222;document[_0x1189cf(0x1f4)](_0x1189cf(0x362))[_0x1189cf(0x159b)][_0x1189cf(0xa9c)](_0x1189cf(0xfca));}async function _0x10ea1e(){const _0x404b3f=_0x2b1222;if(!_0x2123eb)return;const _0x32eb02=_0x1ae02e[_0x404b3f(0x589)][_0x2123eb];if(!_0x32eb02){await _0x1460c5(_0x404b3f(0xc5a),'无法找到当前角色的数据。');return;}await _0x1460c5(_0x404b3f(0x11b7),_0x404b3f(0xc8f)+_0x32eb02[_0x404b3f(0x5d2)]+_0x404b3f(0x1504));const {proxyUrl:_0x39a785,apiKey:_0x5e7e48,model:_0x1e3894}=_0x1ae02e[_0x404b3f(0x226)];if(!_0x39a785||!_0x5e7e48||!_0x1e3894){alert(_0x404b3f(0x4af));return;}const _0x406178=_0x1ae02e[_0x404b3f(0x11ef)][_0x404b3f(0xb46)]===_0x404b3f(0xee7)||!_0x1ae02e['qzoneSettings']['nickname']?'用户':_0x1ae02e[_0x404b3f(0x11ef)][_0x404b3f(0xb46)],_0x199088=_0x32eb02[_0x404b3f(0x5fb)]&&_0x32eb02[_0x404b3f(0x5fb)][_0x404b3f(0x58a)]>0x0?_0x32eb02['longTermMemory']['map'](_0x90e149=>_0x404b3f(0x10a4)+_0x3f7f7a(_0x90e149[_0x404b3f(0x1388)])+')\x20'+_0x90e149[_0x404b3f(0x128c)])['join']('\x0a'):'无',_0x2d4e42=_0x32eb02[_0x404b3f(0x6a8)]['maxMemory']||0xa,_0x12b484=_0x32eb02[_0x404b3f(0xce3)]['slice'](-_0x2d4e42)[_0x404b3f(0x1431)](_0x1f44e8=>(_0x1f44e8[_0x404b3f(0xfbb)]===_0x404b3f(0x860)?_0x406178:_0x32eb02[_0x404b3f(0x5d2)])+':\x20'+String(_0x1f44e8['content'])[_0x404b3f(0x516)](0x0,0x1e)+_0x404b3f(0x629))[_0x404b3f(0x1143)]('\x0a'),_0x545ffb=(_0x32eb02[_0x404b3f(0x6a8)][_0x404b3f(0x1469)]||[])[_0x404b3f(0x1431)](_0x4525a4=>_0x1ae02e['worldBooks']['find'](_0x2706a2=>_0x2706a2['id']===_0x4525a4))[_0x404b3f(0xede)](Boolean)[_0x404b3f(0x1431)](_0x445c44=>_0x404b3f(0x44b)+_0x445c44['name']+_0x404b3f(0x1330)+_0x445c44[_0x404b3f(0x128c)][_0x404b3f(0xede)](_0x5f4a1f=>_0x5f4a1f['enabled'])[_0x404b3f(0x1431)](_0x5f343c=>'-\x20'+_0x5f343c[_0x404b3f(0x128c)])[_0x404b3f(0x1143)]('\x0a'))[_0x404b3f(0x1143)](''),_0x46dac0=_0x5a2518(_0x32eb02,0x3,_0x404b3f(0x5f2)),_0x5cce63=_0x5a2518(_0x32eb02,0x6,_0x404b3f(0x5f2)),_0x36c6f9=_0x5a2518(_0x32eb02,0x9,_0x404b3f(0x5f2)),_0x174182=_0x5a2518(_0x32eb02,0x1,_0x404b3f(0x1265)),_0x119c1e=_0x5a2518(_0x32eb02,0x3,_0x404b3f(0x1265)),_0x338604=_0x5a2518(_0x32eb02,0x7,_0x404b3f(0x1265));let _0x5635e2='';if(_0x46dac0||_0x5cce63||_0x36c6f9||_0x174182||_0x119c1e||_0x338604){_0x5635e2+='\x0a#\x20智能总结\x20(基于不同时间维度的对话回顾)\x0a';if(_0x46dac0)_0x5635e2+=_0x46dac0;if(_0x5cce63)_0x5635e2+=_0x5cce63;if(_0x36c6f9)_0x5635e2+=_0x36c6f9;if(_0x46dac0||_0x5cce63||_0x36c6f9)_0x5635e2+='\x0a';if(_0x174182)_0x5635e2+=_0x174182;if(_0x119c1e)_0x5635e2+=_0x119c1e;if(_0x338604)_0x5635e2+=_0x338604;}const _0x366b2c='\x0a#\x20你的任务\x0a你是一个虚拟生活模拟器。你的任务是扮演角色“'+_0x32eb02[_0x404b3f(0x5d2)]+_0x404b3f(0xf11)+_0x32eb02[_0x404b3f(0x6a8)]['aiPersona']+'\x0a'+_0x199088+'\x0a'+_0x545ffb+'\x0a'+_0x5635e2+_0x404b3f(0xbd8)+_0x406178+'”的对话摘要**:\x0a'+_0x12b484+_0x404b3f(0x1409);try{const _0xb3a220=[{'role':'user','content':'请根据你的设定，生成你的相册内容。'}];let _0x16b22b=_0x39a785[_0x404b3f(0xe82)](_0x404b3f(0xc38)),_0x12b1f5=_0x16b978(_0x1e3894,_0x5e7e48,_0x366b2c,_0xb3a220);const _0xfd1141=_0x16b22b?await fetch(_0x12b1f5[_0x404b3f(0x258)],_0x12b1f5[_0x404b3f(0xc6b)]):await fetch(_0x39a785+'/v1/chat/completions',{'method':_0x404b3f(0x12d9),'headers':{'Content-Type':_0x404b3f(0xa90),'Authorization':_0x404b3f(0xf03)+_0x5e7e48},'body':JSON[_0x404b3f(0x994)]({'model':_0x1e3894,'messages':[{'role':_0x404b3f(0x1594),'content':_0x366b2c},..._0xb3a220],'temperature':_0x1ae02e[_0x404b3f(0x12c0)][_0x404b3f(0x217)]||0.9})});if(!_0xfd1141['ok'])throw new Error(_0x404b3f(0xaa6)+_0xfd1141[_0x404b3f(0x1260)]);const _0x3a2ead=await _0xfd1141['json'](),_0x3bd52f=getGeminiResponseText(_0x3a2ead),_0x4219d4=_0x3bd52f[_0x404b3f(0xba5)](/(\[[\s\S]*\])/);if(!_0x4219d4||!_0x4219d4[0x0])throw new Error('AI返回的内容中未找到有效的JSON数组。原始返回:\x20'+_0x3bd52f);const _0x4789ff=_0x4219d4[0x0];let _0x1e90a5;try{_0x1e90a5=JSON['parse'](_0x4789ff);}catch(_0x790908){throw new Error(_0x404b3f(0x1160)+_0x790908[_0x404b3f(0x11f0)]+_0x404b3f(0x6b6)+_0x3bd52f);}_0x32eb02[_0x404b3f(0xb5c)]=_0x1e90a5,await _0x3df81a[_0x404b3f(0x589)]['put'](_0x32eb02),await _0x27df5a();}catch(_0x203e6c){console[_0x404b3f(0x127d)](_0x404b3f(0x477),_0x203e6c),await _0x1460c5('生成失败',_0x404b3f(0x1fb)+_0x203e6c[_0x404b3f(0x11f0)]);}}async function _0x27df5a(){const _0x54637b=_0x2b1222,_0x15bf42=document['getElementById'](_0x54637b(0x14eb));_0x15bf42[_0x54637b(0xf21)]='';if(!_0x2123eb)return;const _0x1e83a3=_0x1ae02e[_0x54637b(0x589)][_0x2123eb],_0x185006=_0x1e83a3[_0x54637b(0xb5c)]||[];if(_0x185006['length']===0x0){_0x15bf42[_0x54637b(0xf21)]='<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>TA的相册还是空的，<br>点击右上角刷新按钮生成一些照片吧！</p>';return;}const _0x19cfe8=_0x54637b(0xe1f);_0x185006[_0x54637b(0x59b)](_0x4570c9=>{const _0x2647c9=_0x54637b,_0x4237ee=document[_0x2647c9(0x219)]('div');_0x4237ee[_0x2647c9(0x7c6)]='char-photo-item',_0x4237ee['dataset'][_0x2647c9(0xdec)]=_0x4570c9['description'],_0x15bf42[_0x2647c9(0x6ce)](_0x4237ee);if(_0x1ae02e[_0x2647c9(0x12c0)][_0x2647c9(0x7d1)]){_0x4237ee[_0x2647c9(0x215)][_0x2647c9(0x11e7)]=_0x2647c9(0x10d3);const _0x7bc0f2=/[^\x00-\x7F]/['test'](_0x4570c9[_0x2647c9(0x1248)]),_0x353d33=_0x4570c9[_0x2647c9(0x1248)]&&_0x4570c9['image_prompt'][_0x2647c9(0x4a2)]()&&!_0x7bc0f2,_0x5d3ae1=_0x353d33?_0x4570c9[_0x2647c9(0x1248)]:'a\x20beautiful\x20scenery,\x20anime\x20style,\x20cinematic\x20lighting',_0x22427b='https://image.pollinations.ai/prompt/'+encodeURIComponent(_0x5d3ae1),_0x268372=new Image();_0x268372['onload']=function(){const _0x116bcb=_0x2647c9;_0x4237ee[_0x116bcb(0x215)][_0x116bcb(0xf98)]=_0x116bcb(0x13cb)+this['src']+')';},_0x268372[_0x2647c9(0xdf5)]=function(){const _0x11c2d3=_0x2647c9;_0x4237ee[_0x11c2d3(0x215)][_0x11c2d3(0xf98)]=_0x11c2d3(0x13cb)+_0x19cfe8+')';},_0x268372[_0x2647c9(0x9fe)]=_0x22427b;}else{_0x4237ee[_0x2647c9(0x215)][_0x2647c9(0x11e7)]=_0x2647c9(0xa9d),_0x4237ee[_0x2647c9(0x215)]['border']=_0x2647c9(0x1116);const _0x9d8e79=document[_0x2647c9(0x219)]('p');_0x9d8e79[_0x2647c9(0x7c6)]='char-photo-description',_0x9d8e79[_0x2647c9(0x231)]=_0x4570c9[_0x2647c9(0xdec)]||'(这张照片没有描述)',_0x4237ee[_0x2647c9(0x6ce)](_0x9d8e79);}});}async function _0xecabb9(){const _0x32e246=_0x2b1222;if(!_0x2123eb)return;const _0x4e38cf=_0x1ae02e['chats'][_0x2123eb];if(!_0x4e38cf)return;await _0x1460c5('请稍候...',_0x32e246(0xfa3)+_0x4e38cf[_0x32e246(0x5d2)]+_0x32e246(0xa28));const {proxyUrl:_0x521a42,apiKey:_0x56d0a8,model:_0x219ea5}=_0x1ae02e[_0x32e246(0x226)];if(!_0x521a42||!_0x56d0a8||!_0x219ea5){alert(_0x32e246(0x10d4));return;}const _0x233dd8=_0x1ae02e[_0x32e246(0x11ef)][_0x32e246(0xb46)]===_0x32e246(0xee7)||!_0x1ae02e[_0x32e246(0x11ef)][_0x32e246(0xb46)]?'用户':_0x1ae02e[_0x32e246(0x11ef)]['nickname'],_0x2069b7=_0x4e38cf[_0x32e246(0x5fb)]&&_0x4e38cf[_0x32e246(0x5fb)][_0x32e246(0x58a)]>0x0?_0x4e38cf['longTermMemory'][_0x32e246(0x1431)](_0x12d771=>_0x32e246(0x10a4)+_0x3f7f7a(_0x12d771[_0x32e246(0x1388)])+')\x20'+_0x12d771[_0x32e246(0x128c)])[_0x32e246(0x1143)]('\x0a'):'无',_0xbe7ee1=_0x4e38cf['settings'][_0x32e246(0x4b2)]||0xa,_0x511c82=_0x4e38cf[_0x32e246(0xce3)][_0x32e246(0x5cc)](-_0xbe7ee1)[_0x32e246(0x1431)](_0x2ac80b=>(_0x2ac80b['role']==='user'?_0x233dd8:_0x4e38cf[_0x32e246(0x5d2)])+':\x20'+String(_0x2ac80b[_0x32e246(0x128c)])[_0x32e246(0x516)](0x0,0x1e)+_0x32e246(0x629))[_0x32e246(0x1143)]('\x0a'),_0x4c9925=(_0x4e38cf[_0x32e246(0x6a8)][_0x32e246(0x1469)]||[])[_0x32e246(0x1431)](_0x499f67=>_0x1ae02e[_0x32e246(0x1453)]['find'](_0x465798=>_0x465798['id']===_0x499f67))[_0x32e246(0xede)](Boolean)[_0x32e246(0x1431)](_0x27c44c=>_0x32e246(0x44b)+_0x27c44c['name']+'》设定:\x0a'+_0x27c44c['content']['filter'](_0x1f53a5=>_0x1f53a5[_0x32e246(0x1368)])[_0x32e246(0x1431)](_0x5a4c44=>'-\x20'+_0x5a4c44[_0x32e246(0x128c)])[_0x32e246(0x1143)]('\x0a'))[_0x32e246(0x1143)](''),_0x46368f=_0x5a2518(_0x4e38cf,0x3,_0x32e246(0x5f2)),_0x1de8b4=_0x5a2518(_0x4e38cf,0x6,_0x32e246(0x5f2)),_0x181a8a=_0x5a2518(_0x4e38cf,0x9,_0x32e246(0x5f2)),_0x119c6e=_0x5a2518(_0x4e38cf,0x1,_0x32e246(0x1265)),_0x26fdc0=_0x5a2518(_0x4e38cf,0x3,_0x32e246(0x1265)),_0x4fdc95=_0x5a2518(_0x4e38cf,0x7,_0x32e246(0x1265));let _0x1e2c60='';if(_0x46368f||_0x1de8b4||_0x181a8a||_0x119c6e||_0x26fdc0||_0x4fdc95){_0x1e2c60+=_0x32e246(0x135e);if(_0x46368f)_0x1e2c60+=_0x46368f;if(_0x1de8b4)_0x1e2c60+=_0x1de8b4;if(_0x181a8a)_0x1e2c60+=_0x181a8a;if(_0x46368f||_0x1de8b4||_0x181a8a)_0x1e2c60+='\x0a';if(_0x119c6e)_0x1e2c60+=_0x119c6e;if(_0x26fdc0)_0x1e2c60+=_0x26fdc0;if(_0x4fdc95)_0x1e2c60+=_0x4fdc95;}const _0x547b80=_0x4e38cf['settings']['myPersona']||_0x32e246(0x1570),_0x5ef164='\x0a#\x20你的任务\x0a你是一个虚拟生活模拟器。你的任务是扮演角色“'+_0x4e38cf[_0x32e246(0x5d2)]+_0x32e246(0x45c)+_0x4e38cf['settings'][_0x32e246(0xf42)]+_0x32e246(0xad5)+_0x547b80+_0x32e246(0x5e4)+_0x2069b7+'\x0a'+_0x4c9925+'\x0a'+_0x1e2c60+'\x20\x0a-\x20**你最近和“'+_0x233dd8+_0x32e246(0x9ec)+_0x511c82+_0x32e246(0x10c6);try{const _0x4a55d1=[{'role':_0x32e246(0x860),'content':_0x32e246(0x91a)}];let _0x1184ca=_0x521a42[_0x32e246(0xe82)](_0x32e246(0xc38)),_0x1c69a3=_0x16b978(_0x219ea5,_0x56d0a8,_0x5ef164,_0x4a55d1);const _0x1516be=_0x1184ca?await fetch(_0x1c69a3[_0x32e246(0x258)],_0x1c69a3['data']):await fetch(_0x521a42+_0x32e246(0x14c2),{'method':_0x32e246(0x12d9),'headers':{'Content-Type':_0x32e246(0xa90),'Authorization':_0x32e246(0xf03)+_0x56d0a8},'body':JSON[_0x32e246(0x994)]({'model':_0x219ea5,'messages':[{'role':_0x32e246(0x1594),'content':_0x5ef164},..._0x4a55d1],'temperature':_0x1ae02e[_0x32e246(0x12c0)][_0x32e246(0x217)]||0.9})});if(!_0x1516be['ok'])throw new Error('API\x20错误:\x20'+_0x1516be['statusText']);const _0x12e03b=await _0x1516be['json'](),_0x5f58f0=getGeminiResponseText(_0x12e03b),_0x35b38c=_0x5f58f0[_0x32e246(0xba5)](/(\[[\s\S]*\])/);if(!_0x35b38c||!_0x35b38c[0x0])throw new Error(_0x32e246(0x600)+_0x5f58f0);const _0x2b8e76=_0x35b38c[0x0];let _0x3f0a56;try{_0x3f0a56=JSON[_0x32e246(0x129c)](_0x2b8e76);}catch(_0x4b714d){throw new Error(_0x32e246(0x1160)+_0x4b714d[_0x32e246(0x11f0)]+_0x32e246(0x6b6)+_0x5f58f0);}_0x4e38cf['simulatedBrowserHistory']=_0x3f0a56,await _0x3df81a[_0x32e246(0x589)][_0x32e246(0x295)](_0x4e38cf),await _0xe42c16();}catch(_0x2335e3){console[_0x32e246(0x127d)](_0x32e246(0xc05),_0x2335e3),await _0x1460c5(_0x32e246(0x108a),'无法生成浏览记录，请检查API配置或稍后再试。\x0a错误:\x20'+_0x2335e3['message']);}}function _0xe42c16(){const _0x5701b0=_0x2b1222,_0x3e0aa9=document[_0x5701b0(0x1f4)](_0x5701b0(0x8fc));_0x3e0aa9['innerHTML']='';if(!_0x2123eb)return;const _0x2ac2fe=_0x1ae02e['chats'][_0x2123eb],_0x3577d4=_0x2ac2fe[_0x5701b0(0xa6f)]||[];if(_0x3577d4['length']===0x0){_0x3e0aa9[_0x5701b0(0xf21)]=_0x5701b0(0x949);return;}_0x3577d4['forEach']((_0x2b5957,_0x2d2520)=>{const _0x56b6af=_0x5701b0,_0x3f1b4c=document[_0x56b6af(0x219)](_0x56b6af(0xaf9));_0x3f1b4c[_0x56b6af(0x7c6)]='char-browser-item',_0x3f1b4c[_0x56b6af(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22title\x22>'+_0x2b5957[_0x56b6af(0x156f)]+_0x56b6af(0x77e)+_0x2b5957[_0x56b6af(0x258)]+_0x56b6af(0x1514),_0x3f1b4c[_0x56b6af(0x122b)]('click',()=>_0x1a8aa1(_0x2d2520)),_0x3e0aa9[_0x56b6af(0x6ce)](_0x3f1b4c);});}async function _0x1a8aa1(_0x52bdb8){const _0x28e578=_0x2b1222,_0x3de1cd=_0x1ae02e[_0x28e578(0x589)][_0x2123eb],_0x4c2341=_0x3de1cd[_0x28e578(0xa6f)][_0x52bdb8];if(!_0x4c2341)return;_0x98fb65=_0x4c2341,_0x31feba(_0x4c2341),_0x1335d9('char-browser-article-screen');const _0x122216=document['getElementById'](_0x28e578(0x11fd)),_0x2c0193=await _0x3df81a[_0x28e578(0xbeb)][_0x28e578(0x478)]({'type':_0x28e578(0x106c),'content.url':_0x4c2341[_0x28e578(0x258)]})[_0x28e578(0x9a8)]();_0x122216[_0x28e578(0x159b)][_0x28e578(0x1483)](_0x28e578(0x7cf),!!_0x2c0193);}async function _0x918322(){const _0x1cb865=_0x2b1222;if(!_0x98fb65||!_0x2123eb)return;const _0x429bc2=_0x98fb65,_0x40761d=_0x1ae02e[_0x1cb865(0x589)][_0x2123eb],_0x4ffe3a=document['getElementById'](_0x1cb865(0x11fd)),_0x36248=await _0x3df81a[_0x1cb865(0xbeb)][_0x1cb865(0x478)]({'type':'char_browser_article','content.url':_0x429bc2['url']})[_0x1cb865(0x9a8)]();if(_0x36248)await _0x3df81a['favorites']['delete'](_0x36248['id']),_0x4ffe3a[_0x1cb865(0x159b)][_0x1cb865(0xa9c)](_0x1cb865(0x7cf)),await _0x1460c5('操作成功',_0x1cb865(0x484));else{const _0x1217d4={'type':'char_browser_article','content':{..._0x429bc2,'characterId':_0x2123eb,'characterName':_0x40761d[_0x1cb865(0x5d2)]},'timestamp':Date['now']()};await _0x3df81a['favorites'][_0x1cb865(0x6a4)](_0x1217d4),_0x4ffe3a[_0x1cb865(0x159b)][_0x1cb865(0x6a4)]('active'),await _0x1460c5(_0x1cb865(0x1539),'已成功收藏到“我的收藏”页面！');}}function _0x31feba(_0x428ffd){const _0x1da461=_0x2b1222,_0x164ca0=document['getElementById']('char-article-title'),_0x4f0c21=document[_0x1da461(0x1f4)]('char-article-content');_0x164ca0[_0x1da461(0x231)]=_0x428ffd[_0x1da461(0x156f)],_0x4f0c21[_0x1da461(0xf21)]='',_0x428ffd[_0x1da461(0xcbd)]===_0x1da461(0x685)?_0x4f0c21[_0x1da461(0xf21)]=_0x1da461(0x447)+(_0x428ffd[_0x1da461(0x156f)]||_0x1da461(0x175))+_0x1da461(0x1517):_0x4f0c21[_0x1da461(0xf21)]='<p>'+(_0x428ffd[_0x1da461(0x128c)]||_0x1da461(0xdd3))[_0x1da461(0xef0)](/\n/g,_0x1da461(0xb2d))+_0x1da461(0x1517);}async function _0x5b2548(){const _0x1d29d7=_0x2b1222;if(!_0x2123eb)return;const _0x5a46a0=_0x1ae02e['chats'][_0x2123eb];if(!_0x5a46a0)return;await _0x1460c5(_0x1d29d7(0x11b7),'正在模拟“'+_0x5a46a0['name']+_0x1d29d7(0x1461));const {proxyUrl:_0x4fc3e0,apiKey:_0x2a527d,model:_0xdd3edb}=_0x1ae02e[_0x1d29d7(0x226)];if(!_0x4fc3e0||!_0x2a527d||!_0xdd3edb){alert('API未配置，无法生成内容。');return;}const _0x4ef407=_0x1ae02e[_0x1d29d7(0x11ef)][_0x1d29d7(0xb46)]==='{{user}}'||!_0x1ae02e['qzoneSettings'][_0x1d29d7(0xb46)]?'用户':_0x1ae02e[_0x1d29d7(0x11ef)][_0x1d29d7(0xb46)],_0x1d3973=_0x5a46a0[_0x1d29d7(0x5fb)]&&_0x5a46a0[_0x1d29d7(0x5fb)]['length']>0x0?_0x5a46a0[_0x1d29d7(0x5fb)][_0x1d29d7(0x1431)](_0x27b878=>'-\x20(记录于\x20'+_0x3f7f7a(_0x27b878[_0x1d29d7(0x1388)])+')\x20'+_0x27b878[_0x1d29d7(0x128c)])[_0x1d29d7(0x1143)]('\x0a'):'无',_0x4d9a26=_0x5a46a0[_0x1d29d7(0x6a8)]['maxMemory']||0xa,_0x51df81=_0x5a46a0[_0x1d29d7(0xce3)][_0x1d29d7(0x5cc)](-_0x4d9a26)[_0x1d29d7(0x1431)](_0x54e268=>(_0x54e268[_0x1d29d7(0xfbb)]===_0x1d29d7(0x860)?_0x4ef407:_0x5a46a0[_0x1d29d7(0x5d2)])+':\x20'+String(_0x54e268[_0x1d29d7(0x128c)])[_0x1d29d7(0x516)](0x0,0x1e)+_0x1d29d7(0x629))['join']('\x0a'),_0x4c232f=(_0x5a46a0[_0x1d29d7(0x6a8)]['linkedWorldBookIds']||[])[_0x1d29d7(0x1431)](_0x44dc05=>_0x1ae02e[_0x1d29d7(0x1453)][_0x1d29d7(0x13b7)](_0x2f960c=>_0x2f960c['id']===_0x44dc05))['filter'](Boolean)[_0x1d29d7(0x1431)](_0xf3058b=>_0x1d29d7(0x44b)+_0xf3058b[_0x1d29d7(0x5d2)]+_0x1d29d7(0x1330)+_0xf3058b[_0x1d29d7(0x128c)][_0x1d29d7(0xede)](_0x2dc66b=>_0x2dc66b[_0x1d29d7(0x1368)])[_0x1d29d7(0x1431)](_0x202e84=>'-\x20'+_0x202e84[_0x1d29d7(0x128c)])[_0x1d29d7(0x1143)]('\x0a'))[_0x1d29d7(0x1143)](''),_0x39c16f=_0x5a2518(_0x5a46a0,0x3,_0x1d29d7(0x5f2)),_0x2a4b82=_0x5a2518(_0x5a46a0,0x6,_0x1d29d7(0x5f2)),_0x34345e=_0x5a2518(_0x5a46a0,0x9,_0x1d29d7(0x5f2)),_0x568523=_0x5a2518(_0x5a46a0,0x1,_0x1d29d7(0x1265)),_0x3f312e=_0x5a2518(_0x5a46a0,0x3,_0x1d29d7(0x1265)),_0x58c3be=_0x5a2518(_0x5a46a0,0x7,'days');let _0x30b31d='';if(_0x39c16f||_0x2a4b82||_0x34345e||_0x568523||_0x3f312e||_0x58c3be){_0x30b31d+=_0x1d29d7(0x135e);if(_0x39c16f)_0x30b31d+=_0x39c16f;if(_0x2a4b82)_0x30b31d+=_0x2a4b82;if(_0x34345e)_0x30b31d+=_0x34345e;if(_0x39c16f||_0x2a4b82||_0x34345e)_0x30b31d+='\x0a';if(_0x568523)_0x30b31d+=_0x568523;if(_0x3f312e)_0x30b31d+=_0x3f312e;if(_0x58c3be)_0x30b31d+=_0x58c3be;}const _0x264260='\x0a#\x20你的任务\x0a你是一个虚拟生活模拟器。你的任务是扮演角色“'+_0x5a46a0[_0x1d29d7(0x5d2)]+_0x1d29d7(0xb35)+_0x5a46a0['settings'][_0x1d29d7(0xf42)]+_0x1d29d7(0x5e4)+_0x1d3973+'\x0a'+_0x4c232f+'\x0a'+_0x30b31d+_0x1d29d7(0xbd8)+_0x4ef407+'”的对话摘要**:\x0a'+_0x51df81+_0x1d29d7(0x2c3);try{const _0x583a18=[{'role':'user','content':'请根据你的设定，生成你的淘宝购买记录和余额。'}];let _0x10d554=_0x4fc3e0[_0x1d29d7(0xe82)](_0x1d29d7(0xc38)),_0x44d4ab=_0x16b978(_0xdd3edb,_0x2a527d,_0x264260,_0x583a18);const _0x4e84e9=_0x10d554?await fetch(_0x44d4ab[_0x1d29d7(0x258)],_0x44d4ab[_0x1d29d7(0xc6b)]):await fetch(_0x4fc3e0+'/v1/chat/completions',{'method':'POST','headers':{'Content-Type':_0x1d29d7(0xa90),'Authorization':_0x1d29d7(0xf03)+_0x2a527d},'body':JSON[_0x1d29d7(0x994)]({'model':_0xdd3edb,'messages':[{'role':_0x1d29d7(0x1594),'content':_0x264260},..._0x583a18],'temperature':_0x1ae02e[_0x1d29d7(0x12c0)][_0x1d29d7(0x217)]||0.9})});if(!_0x4e84e9['ok'])throw new Error(_0x1d29d7(0xaa6)+_0x4e84e9['statusText']);const _0x132750=await _0x4e84e9['json'](),_0x44ddfc=getGeminiResponseText(_0x132750),_0x55ecd1=_0x44ddfc[_0x1d29d7(0xba5)](/({[\s\S]*})/);if(!_0x55ecd1)throw new Error(_0x1d29d7(0x450));const _0x55cc5a=JSON[_0x1d29d7(0x129c)](_0x55ecd1[0x0]);!_0x55cc5a[_0x1d29d7(0x13b4)]&&(_0x55cc5a[_0x1d29d7(0x13b4)]=[]),_0x5a46a0[_0x1d29d7(0xf56)]=_0x55cc5a,await _0x3df81a['chats'][_0x1d29d7(0x295)](_0x5a46a0),await _0x5c8c49();}catch(_0x324b5a){console['error']('生成模拟淘宝记录失败:',_0x324b5a),await _0x1460c5('生成失败','无法生成购物记录，请检查API配置或稍后再试。\x0a错误:\x20'+_0x324b5a[_0x1d29d7(0x11f0)]);}}function _0x533dbb(){const _0x34ae3f=_0x2b1222;_0x46e61f(),_0x1335d9(_0x34ae3f(0x71f));}function _0x46e61f(){const _0x4d1c61=_0x2b1222,_0x33efde=document['getElementById'](_0x4d1c61(0xf5d));_0x33efde['innerHTML']='';const _0x36e843=_0x1ae02e['chats'][_0x2123eb],_0x51642f=_0x36e843['simulatedTaobaoHistory']||{},_0x30e5b2=_0x51642f[_0x4d1c61(0x13b4)]||[],_0x3b4743=_0x51642f[_0x4d1c61(0xdf4)]||0x0,_0x4f7605=document[_0x4d1c61(0x219)]('div');_0x4f7605[_0x4d1c61(0x215)][_0x4d1c61(0x519)]=_0x4d1c61(0x12b6),_0x4f7605[_0x4d1c61(0xf21)]=_0x4d1c61(0x462)+_0x3b4743[_0x4d1c61(0x24f)](0x2)+_0x4d1c61(0x102a),_0x33efde['appendChild'](_0x4f7605);const _0x5f8fb1=document[_0x4d1c61(0x219)]('h3');_0x5f8fb1[_0x4d1c61(0x231)]=_0x4d1c61(0x77d),_0x5f8fb1[_0x4d1c61(0x215)][_0x4d1c61(0x519)]=_0x4d1c61(0x10d9),_0x33efde['appendChild'](_0x5f8fb1);if(_0x30e5b2[_0x4d1c61(0x58a)]===0x0){_0x33efde[_0x4d1c61(0xf21)]+=_0x4d1c61(0x512);return;}_0x30e5b2['forEach'](_0x3d249d=>{const _0x3c531f=_0x4d1c61,_0x343ac8=document[_0x3c531f(0x219)]('div');_0x343ac8[_0x3c531f(0x215)][_0x3c531f(0x519)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20space-between;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2015px\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-bottom:\x201px\x20solid\x20#f0f0f0;\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x343ac8[_0x3c531f(0xf21)]=_0x3c531f(0xceb)+_0x3d249d[_0x3c531f(0x12d5)]+_0x3c531f(0x965)+_0x3d249d[_0x3c531f(0x1589)]+_0x3c531f(0x12fc)+(_0x3d249d[_0x3c531f(0x6ec)]||0x0)[_0x3c531f(0x24f)](0x2)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x33efde['appendChild'](_0x343ac8);});}async function _0x1ab30b(){const _0x2a02a7=_0x2b1222;if(!_0x2123eb)return;const _0x191076=_0x1ae02e[_0x2a02a7(0x589)][_0x2123eb];if(!_0x191076)return;await _0x1460c5(_0x2a02a7(0x11b7),_0x2a02a7(0xc8f)+_0x191076[_0x2a02a7(0x5d2)]+_0x2a02a7(0x544));const {proxyUrl:_0x5178cc,apiKey:_0x2e34aa,model:_0xbe3b1f}=_0x1ae02e[_0x2a02a7(0x226)];if(!_0x5178cc||!_0x2e34aa||!_0xbe3b1f){alert(_0x2a02a7(0x4af));return;}const _0x2f55ab=_0x1ae02e[_0x2a02a7(0x11ef)][_0x2a02a7(0xb46)]===_0x2a02a7(0xee7)||!_0x1ae02e[_0x2a02a7(0x11ef)]['nickname']?'用户':_0x1ae02e['qzoneSettings'][_0x2a02a7(0xb46)],_0x3aaecc=_0x191076[_0x2a02a7(0x5fb)]&&_0x191076[_0x2a02a7(0x5fb)]['length']>0x0?_0x191076[_0x2a02a7(0x5fb)][_0x2a02a7(0x1431)](_0xa6f921=>'-\x20(记录于\x20'+_0x3f7f7a(_0xa6f921[_0x2a02a7(0x1388)])+')\x20'+_0xa6f921[_0x2a02a7(0x128c)])[_0x2a02a7(0x1143)]('\x0a'):'无',_0x4dd6ee=_0x191076[_0x2a02a7(0x6a8)]['maxMemory']||0xa,_0x21d796=_0x191076[_0x2a02a7(0xce3)][_0x2a02a7(0x5cc)](-_0x4dd6ee)[_0x2a02a7(0x1431)](_0xc00847=>(_0xc00847['role']===_0x2a02a7(0x860)?_0x2f55ab:_0x191076[_0x2a02a7(0x5d2)])+':\x20'+String(_0xc00847[_0x2a02a7(0x128c)])[_0x2a02a7(0x516)](0x0,0x1e)+'...')[_0x2a02a7(0x1143)]('\x0a'),_0x44ae6f=(_0x191076[_0x2a02a7(0x6a8)]['linkedWorldBookIds']||[])[_0x2a02a7(0x1431)](_0x1728a6=>_0x1ae02e[_0x2a02a7(0x1453)][_0x2a02a7(0x13b7)](_0x39ec66=>_0x39ec66['id']===_0x1728a6))['filter'](Boolean)[_0x2a02a7(0x1431)](_0x5c2236=>'\x0a##\x20世界书《'+_0x5c2236[_0x2a02a7(0x5d2)]+_0x2a02a7(0x1330)+_0x5c2236[_0x2a02a7(0x128c)][_0x2a02a7(0xede)](_0x41162a=>_0x41162a['enabled'])[_0x2a02a7(0x1431)](_0x1e20f6=>'-\x20'+_0x1e20f6[_0x2a02a7(0x128c)])[_0x2a02a7(0x1143)]('\x0a'))['join'](''),_0x596d63=_0x5a2518(_0x191076,0x3,_0x2a02a7(0x5f2)),_0x5a69d5=_0x5a2518(_0x191076,0x6,'hours'),_0x2e1f5e=_0x5a2518(_0x191076,0x9,_0x2a02a7(0x5f2)),_0x58e169=_0x5a2518(_0x191076,0x1,_0x2a02a7(0x1265)),_0xab7413=_0x5a2518(_0x191076,0x3,_0x2a02a7(0x1265)),_0x29fd35=_0x5a2518(_0x191076,0x7,_0x2a02a7(0x1265));let _0x1b4904='';if(_0x596d63||_0x5a69d5||_0x2e1f5e||_0x58e169||_0xab7413||_0x29fd35){_0x1b4904+='\x0a#\x20智能总结\x20(基于不同时间维度的对话回顾)\x0a';if(_0x596d63)_0x1b4904+=_0x596d63;if(_0x5a69d5)_0x1b4904+=_0x5a69d5;if(_0x2e1f5e)_0x1b4904+=_0x2e1f5e;if(_0x596d63||_0x5a69d5||_0x2e1f5e)_0x1b4904+='\x0a';if(_0x58e169)_0x1b4904+=_0x58e169;if(_0xab7413)_0x1b4904+=_0xab7413;if(_0x29fd35)_0x1b4904+=_0x29fd35;}const _0x318d4d=_0x191076[_0x2a02a7(0x6a8)][_0x2a02a7(0x36b)]||_0x2a02a7(0x1570),_0x155d20=_0x2a02a7(0x317)+_0x191076[_0x2a02a7(0x5d2)]+_0x2a02a7(0x1155)+_0x191076[_0x2a02a7(0x6a8)][_0x2a02a7(0xf42)]+'\x0a-\x20**\x20你的聊天对象（用户）的人设**:'+_0x318d4d+'\x0a-\x20**你的长期记忆**:\x0a'+_0x3aaecc+'\x0a'+_0x44ae6f+'\x0a'+_0x1b4904+'\x0a-\x20**你最近和“'+_0x2f55ab+_0x2a02a7(0x9ec)+_0x21d796+_0x2a02a7(0x375);try{const _0x31cf50=[{'role':_0x2a02a7(0x860),'content':_0x2a02a7(0x111b)}];let _0x20e23d=_0x5178cc[_0x2a02a7(0xe82)](_0x2a02a7(0xc38)),_0x29872c=_0x16b978(_0xbe3b1f,_0x2e34aa,_0x155d20,_0x31cf50);const _0x9f300e=_0x20e23d?await fetch(_0x29872c[_0x2a02a7(0x258)],_0x29872c[_0x2a02a7(0xc6b)]):await fetch(_0x5178cc+_0x2a02a7(0x14c2),{'method':_0x2a02a7(0x12d9),'headers':{'Content-Type':'application/json','Authorization':'Bearer\x20'+_0x2e34aa},'body':JSON[_0x2a02a7(0x994)]({'model':_0xbe3b1f,'messages':[{'role':'system','content':_0x155d20},..._0x31cf50],'temperature':_0x1ae02e[_0x2a02a7(0x12c0)][_0x2a02a7(0x217)]||0.9})});if(!_0x9f300e['ok']){const _0x114cc8=await _0x9f300e['json']()['catch'](()=>null),_0x6d39cb=_0x114cc8?.[_0x2a02a7(0x127d)]?.['message']||_0x9f300e[_0x2a02a7(0x1260)];throw new Error('API\x20错误:\x20'+_0x9f300e[_0x2a02a7(0x1589)]+_0x2a02a7(0x7c5)+_0x6d39cb);}const _0x49d9dd=await _0x9f300e[_0x2a02a7(0xb84)](),_0x249468=getGeminiResponseText(_0x49d9dd),_0x3279f0=_0x249468[_0x2a02a7(0xba5)](/(\[[\s\S]*\])/);if(!_0x3279f0||!_0x3279f0[0x0])throw new Error(_0x2a02a7(0x600)+_0x249468);const _0x3ead95=_0x3279f0[0x0];let _0x4d333a;try{_0x4d333a=JSON[_0x2a02a7(0x129c)](_0x3ead95);}catch(_0x3c11c9){throw new Error(_0x2a02a7(0x1160)+_0x3c11c9[_0x2a02a7(0x11f0)]+_0x2a02a7(0x6b6)+_0x249468);}if(!Array[_0x2a02a7(0x121f)](_0x4d333a))throw new Error('AI返回的数据不是一个数组。原始返回:\x20'+JSON[_0x2a02a7(0x994)](_0x4d333a));_0x191076[_0x2a02a7(0x11c6)]=_0x4d333a[_0x2a02a7(0x1431)](_0x4cdf36=>({'id':Date['now']()+Math['random'](),'title':_0x4cdf36['title'],'content':_0x4cdf36[_0x2a02a7(0x128c)]})),await _0x3df81a['chats'][_0x2a02a7(0x295)](_0x191076),await _0x44ed07();}catch(_0x423a52){console[_0x2a02a7(0x127d)](_0x2a02a7(0x4f0),_0x423a52),await _0x1460c5('生成失败',_0x2a02a7(0xec9)+_0x423a52['message']);}}async function _0x210fcc(){const _0x12d23a=_0x2b1222;if(!_0x2123eb)return;const _0x28415f=_0x1ae02e['chats'][_0x2123eb];if(!_0x28415f)return;await _0x1460c5(_0x12d23a(0x11b7),_0x12d23a(0x97e)+_0x28415f[_0x12d23a(0x5d2)]+'”的出行足迹...');const {proxyUrl:_0x4f6d09,apiKey:_0x41170c,model:_0x26f78f}=_0x1ae02e[_0x12d23a(0x226)];if(!_0x4f6d09||!_0x41170c||!_0x26f78f){alert(_0x12d23a(0x10d4));return;}const _0xcc2af0=_0x1ae02e[_0x12d23a(0x11ef)][_0x12d23a(0xb46)]===_0x12d23a(0xee7)||!_0x1ae02e[_0x12d23a(0x11ef)][_0x12d23a(0xb46)]?'用户':_0x1ae02e[_0x12d23a(0x11ef)]['nickname'],_0x2c0c61=_0x28415f[_0x12d23a(0x5fb)]&&_0x28415f[_0x12d23a(0x5fb)][_0x12d23a(0x58a)]>0x0?_0x28415f[_0x12d23a(0x5fb)][_0x12d23a(0x1431)](_0x7b9457=>_0x12d23a(0x10a4)+_0x3f7f7a(_0x7b9457[_0x12d23a(0x1388)])+')\x20'+_0x7b9457[_0x12d23a(0x128c)])[_0x12d23a(0x1143)]('\x0a'):'无',_0x48df60=_0x28415f[_0x12d23a(0x6a8)]['maxMemory']||0xa,_0x1402eb=_0x28415f[_0x12d23a(0xce3)][_0x12d23a(0x5cc)](-_0x48df60)[_0x12d23a(0x1431)](_0x1baa4b=>(_0x1baa4b[_0x12d23a(0xfbb)]===_0x12d23a(0x860)?_0xcc2af0:_0x28415f[_0x12d23a(0x5d2)])+':\x20'+String(_0x1baa4b[_0x12d23a(0x128c)])[_0x12d23a(0x516)](0x0,0x1e)+'...')[_0x12d23a(0x1143)]('\x0a'),_0x28adc5=(_0x28415f[_0x12d23a(0x6a8)][_0x12d23a(0x1469)]||[])[_0x12d23a(0x1431)](_0x268a60=>_0x1ae02e[_0x12d23a(0x1453)][_0x12d23a(0x13b7)](_0x26005b=>_0x26005b['id']===_0x268a60))['filter'](Boolean)[_0x12d23a(0x1431)](_0x6b97c2=>_0x12d23a(0x44b)+_0x6b97c2[_0x12d23a(0x5d2)]+_0x12d23a(0x1330)+_0x6b97c2[_0x12d23a(0x128c)][_0x12d23a(0xede)](_0x1f4910=>_0x1f4910['enabled'])['map'](_0x26512a=>'-\x20'+_0x26512a[_0x12d23a(0x128c)])[_0x12d23a(0x1143)]('\x0a'))[_0x12d23a(0x1143)](''),_0x29c1e2=_0x5a2518(_0x28415f,0x3,_0x12d23a(0x5f2)),_0xa6e896=_0x5a2518(_0x28415f,0x6,_0x12d23a(0x5f2)),_0x4522c6=_0x5a2518(_0x28415f,0x9,_0x12d23a(0x5f2)),_0x54067d=_0x5a2518(_0x28415f,0x1,_0x12d23a(0x1265)),_0x5520ff=_0x5a2518(_0x28415f,0x3,_0x12d23a(0x1265)),_0x223b80=_0x5a2518(_0x28415f,0x7,_0x12d23a(0x1265));let _0x20f357='';if(_0x29c1e2||_0xa6e896||_0x4522c6||_0x54067d||_0x5520ff||_0x223b80){_0x20f357+=_0x12d23a(0x135e);if(_0x29c1e2)_0x20f357+=_0x29c1e2;if(_0xa6e896)_0x20f357+=_0xa6e896;if(_0x4522c6)_0x20f357+=_0x4522c6;if(_0x29c1e2||_0xa6e896||_0x4522c6)_0x20f357+='\x0a';if(_0x54067d)_0x20f357+=_0x54067d;if(_0x5520ff)_0x20f357+=_0x5520ff;if(_0x223b80)_0x20f357+=_0x223b80;}const _0x3bc51b=_0x12d23a(0x317)+_0x28415f['name']+'”，并根据其人设、记忆和最近的互动，虚构出【12到20条】TA最近的“高德地图”出行足迹。\x0a\x0a#\x20核心规则\x0a1.\x20\x20**【时间\x20(最高优先级)】**:\x0a\x20\x20\x20\x20-\x20\x20\x20今天的日期是\x20**'+new Date()[_0x12d23a(0xc66)]()+'**。\x0a\x20\x20\x20\x20-\x20\x20\x20你生成的【所有】足迹的\x20`timestamp`\x20字段，【必须】是今天或今天以前的日期。\x0a\x20\x20\x20\x20-\x20\x20\x20【绝对禁止】生成任何未来的日期！\x0a\x20\x20\x20\x20-\x20\x20\x20请生成一个看起来像是过去几周内的、时间【从新到旧】排列的足迹列表。\x0a2.\x20\x20**创造性与合理性**:\x20足迹必须完全符合角色的性格、爱好、职业和生活环境。\x0a3.\x20\x20**多样性**:\x20地点类型要丰富，可以包括餐厅、商场、公园、公司、朋友家等。\x0a4.\x20\x20**【格式铁律\x20(最高优先级)】**:\x20\x0a\x20\x20\x20\x20-\x20你的回复【必须且只能】是一个JSON数组格式的字符串。\x0a\x20\x20\x20\x20-\x20你的回复必须以\x20`[`\x20开始，并以\x20`]`\x20结束。\x0a\x20\x20\x20\x20-\x20【绝对禁止】在JSON数组前后添加任何多余的文字、解释、或\x20markdown\x20标记\x20(如\x20```json)。\x0a\x20\x20\x20\x20-\x20数组中的每个元素都是一个对象，代表一条足迹，格式【必须】如下:\x0a\x20\x20\x20\x20```json\x0a\x20\x20\x20\x20[\x0a\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22locationName\x22:\x20\x22一个具体、生动的地点名称\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22address\x22:\x20\x22一个虚构但看起来很真实的详细地址\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22comment\x22:\x20\x22这是角色对这次出行或这个地点的内心独白或评论，必须使用第一人称“我”来写。\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22image_prompt\x22:\x20\x22(可选)一段用于生成这张地点照片的、详细的【英文】关键词,\x20风格为\x20realistic\x20photo,\x20high\x20quality\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22timestamp\x22:\x20\x22符合\x20ISO\x208601\x20格式的日期时间字符串\x20(例如:\x20\x272025-09-25T18:30:00Z\x27)\x22\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20]\x0a\x20\x20\x20\x20```\x0a\x20\x20\x20\x20-\x20**重要**:\x20大约有【三分之一】的足迹需要包含\x20`image_prompt`\x20字段来生成一张照片。\x0a\x20\x20\x20\x20-\x20**图片**:\x20image_prompt\x20生成的图片【绝对禁止包含真人】。如果地点是室内，可以生成空无一人的场景；如果是室外，可以只有风景或建筑。\x0a\x0a#\x20供你参考的上下文\x0a-\x20**你的角色设定**:\x20'+_0x28415f[_0x12d23a(0x6a8)][_0x12d23a(0xf42)]+_0x12d23a(0x5e4)+_0x2c0c61+'\x0a'+_0x28adc5+'\x0a'+_0x20f357+_0x12d23a(0xff0)+_0xcc2af0+_0x12d23a(0x9ec)+_0x1402eb+_0x12d23a(0x61c);try{const _0x12a7e3=[{'role':'user','content':'请根据你的设定，生成你的高德地图足迹。'}];let _0x54c960=_0x4f6d09['includes']('generativelanguage'),_0x24bad5=_0x16b978(_0x26f78f,_0x41170c,_0x3bc51b,_0x12a7e3);const _0x191b5b=_0x54c960?await fetch(_0x24bad5[_0x12d23a(0x258)],_0x24bad5[_0x12d23a(0xc6b)]):await fetch(_0x4f6d09+_0x12d23a(0x14c2),{'method':_0x12d23a(0x12d9),'headers':{'Content-Type':_0x12d23a(0xa90),'Authorization':_0x12d23a(0xf03)+_0x41170c},'body':JSON[_0x12d23a(0x994)]({'model':_0x26f78f,'messages':[{'role':_0x12d23a(0x1594),'content':_0x3bc51b},..._0x12a7e3],'temperature':_0x1ae02e[_0x12d23a(0x12c0)]['apiTemperature']||0.9})});if(!_0x191b5b['ok'])throw new Error(_0x12d23a(0xaa6)+_0x191b5b[_0x12d23a(0x1260)]);const _0x32a970=await _0x191b5b[_0x12d23a(0xb84)](),_0x2a6355=getGeminiResponseText(_0x32a970),_0x6cdb8c=_0x2a6355[_0x12d23a(0xba5)](/(\[[\s\S]*\])/);if(!_0x6cdb8c||!_0x6cdb8c[0x0])throw new Error(_0x12d23a(0x600)+_0x2a6355);const _0x1424a0=_0x6cdb8c[0x0];let _0x2c1ffc;try{_0x2c1ffc=JSON[_0x12d23a(0x129c)](_0x1424a0);}catch(_0xf33919){throw new Error(_0x12d23a(0x1160)+_0xf33919['message']+_0x12d23a(0x6b6)+_0x2a6355);}_0x28415f[_0x12d23a(0x943)]=_0x2c1ffc,await _0x3df81a[_0x12d23a(0x589)][_0x12d23a(0x295)](_0x28415f),await _0xb3e967();}catch(_0x2b2f15){console[_0x12d23a(0x127d)]('生成模拟足迹失败:',_0x2b2f15),await _0x1460c5('生成失败',_0x12d23a(0x475)+_0x2b2f15[_0x12d23a(0x11f0)]);}}function _0xb3e967(){const _0x23c304=_0x2b1222,_0x1455cd=document[_0x23c304(0x1f4)](_0x23c304(0x11c7));_0x1455cd[_0x23c304(0xf21)]='';if(!_0x2123eb)return;const _0x5df24e=_0x1ae02e[_0x23c304(0x589)][_0x2123eb],_0x4e3279=_0x5df24e[_0x23c304(0x943)]||[];if(_0x4e3279[_0x23c304(0x58a)]===0x0){_0x1455cd[_0x23c304(0xf21)]=_0x23c304(0x197);return;}_0x4e3279[_0x23c304(0x59b)](_0x6fa132=>{const _0x265126=_0x23c304,_0x249ea4=document[_0x265126(0x219)](_0x265126(0xaf9));_0x249ea4['className']=_0x265126(0x1217);let _0x588418='';if(_0x6fa132[_0x265126(0x1248)]){const _0xdd3c7=_0x265126(0xe8f)+encodeURIComponent(_0x6fa132[_0x265126(0x1248)]);_0x588418='<div\x20class=\x22amap-item-photo\x22\x20style=\x22background-image:\x20url(\x27'+_0xdd3c7+_0x265126(0x6eb)+_0x6fa132[_0x265126(0x306)]+_0x265126(0x23c);}const _0x4cfed0=_0x6fa132[_0x265126(0x1388)]?_0x3f7f7a(new Date(_0x6fa132[_0x265126(0x1388)])[_0x265126(0x457)]()):_0x265126(0xf96);_0x249ea4[_0x265126(0xf21)]=_0x265126(0xc1b)+_0x6fa132[_0x265126(0x416)]+_0x265126(0x146a)+_0x6fa132['address']+_0x265126(0x316)+_0x6fa132[_0x265126(0x306)][_0x265126(0xef0)](/\n/g,_0x265126(0xc9b))+_0x265126(0x4ad)+_0x588418+_0x265126(0xb41)+_0x4cfed0+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x1455cd[_0x265126(0x6ce)](_0x249ea4);});}async function _0x19852e(){const _0x5e6a40=_0x2b1222;if(!_0x2123eb)return;const _0x5175e5=_0x1ae02e['chats'][_0x2123eb];if(!_0x5175e5)return;await _0x1460c5(_0x5e6a40(0x11b7),_0x5e6a40(0xdab)+_0x5175e5[_0x5e6a40(0x5d2)]+'”的手机使用习惯...');const {proxyUrl:_0xc0d8d3,apiKey:_0x1acead,model:_0x3620de}=_0x1ae02e[_0x5e6a40(0x226)];if(!_0xc0d8d3||!_0x1acead||!_0x3620de){alert(_0x5e6a40(0x10d4));return;}const _0x1492a1=_0x1ae02e[_0x5e6a40(0x11ef)][_0x5e6a40(0xb46)]===_0x5e6a40(0xee7)||!_0x1ae02e[_0x5e6a40(0x11ef)]['nickname']?'用户':_0x1ae02e[_0x5e6a40(0x11ef)][_0x5e6a40(0xb46)],_0x52ab7c=_0x5175e5[_0x5e6a40(0x5fb)]&&_0x5175e5[_0x5e6a40(0x5fb)][_0x5e6a40(0x58a)]>0x0?_0x5175e5[_0x5e6a40(0x5fb)][_0x5e6a40(0x1431)](_0xbce354=>_0x5e6a40(0x10a4)+_0x3f7f7a(_0xbce354[_0x5e6a40(0x1388)])+')\x20'+_0xbce354['content'])['join']('\x0a'):'无',_0x2cc21e=_0x5175e5[_0x5e6a40(0x6a8)][_0x5e6a40(0x4b2)]||0xa,_0x15ce83=_0x5175e5['history'][_0x5e6a40(0x5cc)](-_0x2cc21e)[_0x5e6a40(0x1431)](_0x5437ca=>(_0x5437ca[_0x5e6a40(0xfbb)]===_0x5e6a40(0x860)?_0x1492a1:_0x5175e5[_0x5e6a40(0x5d2)])+':\x20'+String(_0x5437ca[_0x5e6a40(0x128c)])[_0x5e6a40(0x516)](0x0,0x1e)+'...')[_0x5e6a40(0x1143)]('\x0a'),_0x1273e5=(_0x5175e5[_0x5e6a40(0x6a8)][_0x5e6a40(0x1469)]||[])[_0x5e6a40(0x1431)](_0x28194c=>_0x1ae02e['worldBooks'][_0x5e6a40(0x13b7)](_0x4bb3ca=>_0x4bb3ca['id']===_0x28194c))['filter'](Boolean)['map'](_0x14eadb=>_0x5e6a40(0x44b)+_0x14eadb['name']+_0x5e6a40(0x1330)+_0x14eadb[_0x5e6a40(0x128c)][_0x5e6a40(0xede)](_0x54825e=>_0x54825e[_0x5e6a40(0x1368)])[_0x5e6a40(0x1431)](_0x40dba9=>'-\x20'+_0x40dba9[_0x5e6a40(0x128c)])[_0x5e6a40(0x1143)]('\x0a'))[_0x5e6a40(0x1143)](''),_0x124e0a=_0x5a2518(_0x5175e5,0x3,_0x5e6a40(0x5f2)),_0x3b2569=_0x5a2518(_0x5175e5,0x6,'hours'),_0x25c50f=_0x5a2518(_0x5175e5,0x9,_0x5e6a40(0x5f2)),_0xee4636=_0x5a2518(_0x5175e5,0x1,_0x5e6a40(0x1265)),_0x4f1b3a=_0x5a2518(_0x5175e5,0x3,_0x5e6a40(0x1265)),_0x14333d=_0x5a2518(_0x5175e5,0x7,_0x5e6a40(0x1265));let _0x27c8c9='';if(_0x124e0a||_0x3b2569||_0x25c50f||_0xee4636||_0x4f1b3a||_0x14333d){_0x27c8c9+='\x0a#\x20智能总结\x20(基于不同时间维度的对话回顾)\x0a';if(_0x124e0a)_0x27c8c9+=_0x124e0a;if(_0x3b2569)_0x27c8c9+=_0x3b2569;if(_0x25c50f)_0x27c8c9+=_0x25c50f;if(_0x124e0a||_0x3b2569||_0x25c50f)_0x27c8c9+='\x0a';if(_0xee4636)_0x27c8c9+=_0xee4636;if(_0x4f1b3a)_0x27c8c9+=_0x4f1b3a;if(_0x14333d)_0x27c8c9+=_0x14333d;}const _0x3ebd0d=_0x5e6a40(0x317)+_0x5175e5['name']+_0x5e6a40(0x9fc)+_0x5175e5[_0x5e6a40(0x6a8)][_0x5e6a40(0xf42)]+_0x5e6a40(0x5e4)+_0x52ab7c+'\x0a'+_0x1273e5+'\x0a'+_0x27c8c9+_0x5e6a40(0xff0)+_0x1492a1+'”的对话摘要**:\x0a'+_0x15ce83+_0x5e6a40(0x138a);try{const _0x4a8f7e=[{'role':'user','content':'请根据你的设定，生成你的App使用记录。'}];let _0x5dfbd2=_0xc0d8d3[_0x5e6a40(0xe82)](_0x5e6a40(0xc38)),_0x4c9df0=_0x16b978(_0x3620de,_0x1acead,_0x3ebd0d,_0x4a8f7e);const _0x2ce89e=_0x5dfbd2?await fetch(_0x4c9df0['url'],_0x4c9df0[_0x5e6a40(0xc6b)]):await fetch(_0xc0d8d3+'/v1/chat/completions',{'method':_0x5e6a40(0x12d9),'headers':{'Content-Type':_0x5e6a40(0xa90),'Authorization':_0x5e6a40(0xf03)+_0x1acead},'body':JSON[_0x5e6a40(0x994)]({'model':_0x3620de,'messages':[{'role':_0x5e6a40(0x1594),'content':_0x3ebd0d},..._0x4a8f7e],'temperature':_0x1ae02e[_0x5e6a40(0x12c0)][_0x5e6a40(0x217)]||0.9})});if(!_0x2ce89e['ok'])throw new Error(_0x5e6a40(0xaa6)+_0x2ce89e[_0x5e6a40(0x1260)]);const _0x50934f=await _0x2ce89e[_0x5e6a40(0xb84)](),_0x35cd9a=getGeminiResponseText(_0x50934f),_0x2ec65c=_0x35cd9a['replace'](/^```json\s*/,'')[_0x5e6a40(0xef0)](/```$/,''),_0x326e1b=JSON[_0x5e6a40(0x129c)](_0x2ec65c);_0x5175e5[_0x5e6a40(0xa3d)]=_0x326e1b,await _0x3df81a[_0x5e6a40(0x589)][_0x5e6a40(0x295)](_0x5175e5),await _0x5bafbb();}catch(_0x4fd7d6){console[_0x5e6a40(0x127d)](_0x5e6a40(0x436),_0x4fd7d6),await _0x1460c5(_0x5e6a40(0x108a),_0x5e6a40(0xf36)+_0x4fd7d6[_0x5e6a40(0x11f0)]);}}function _0x5bafbb(){const _0x2fa0bc=_0x2b1222,_0x46f63d=document['getElementById']('char-usage-list');_0x46f63d['innerHTML']='';if(!_0x2123eb)return;const _0xd3cd94=_0x1ae02e['chats'][_0x2123eb],_0x194ecb=(_0xd3cd94[_0x2fa0bc(0xa3d)]||[])[_0x2fa0bc(0x74e)]((_0x452ff8,_0x40b6f2)=>_0x40b6f2[_0x2fa0bc(0x157f)]-_0x452ff8['usageTimeMinutes']);if(_0x194ecb[_0x2fa0bc(0x58a)]===0x0){_0x46f63d[_0x2fa0bc(0xf21)]=_0x2fa0bc(0xf57);return;}_0x194ecb[_0x2fa0bc(0x59b)](_0x4d7702=>{const _0x1c23e5=_0x2fa0bc,_0x17578f=document[_0x1c23e5(0x219)](_0x1c23e5(0xaf9));_0x17578f['className']=_0x1c23e5(0x1494);const _0x136b67=Math[_0x1c23e5(0x123c)](_0x4d7702[_0x1c23e5(0x157f)]/0x3c),_0xf7c62d=_0x4d7702[_0x1c23e5(0x157f)]%0x3c;let _0x377390='';if(_0x136b67>0x0)_0x377390+=_0x136b67+'小时';if(_0xf7c62d>0x0)_0x377390+=_0xf7c62d+'分钟';if(!_0x377390)_0x377390=_0x1c23e5(0xb1c);const _0x316348=_0x4d7702[_0x1c23e5(0x1248)]||_0x1c23e5(0x2f8)+_0x4d7702['appName']+_0x1c23e5(0x1078),_0x395d21=_0x1c23e5(0xe8f)+encodeURIComponent(_0x316348);_0x17578f['innerHTML']=_0x1c23e5(0x1344)+_0x395d21+_0x1c23e5(0x11d1)+_0x4d7702['appName']+_0x1c23e5(0xec6)+_0x4d7702[_0x1c23e5(0x60c)]+_0x1c23e5(0xab6)+_0x377390+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x46f63d[_0x1c23e5(0x6ce)](_0x17578f);});}async function _0x1108ad(){const _0x44eeff=_0x2b1222;if(!_0x2123eb)return;const _0x1b9d13=_0x1ae02e[_0x44eeff(0x589)][_0x2123eb];if(!_0x1b9d13)return;await _0x1460c5('请稍候...','正在请求“'+_0x1b9d13[_0x44eeff(0x5d2)]+_0x44eeff(0xf52));const {proxyUrl:_0x2ac0fa,apiKey:_0x121e47,model:_0x5f2575}=_0x1ae02e[_0x44eeff(0x226)];if(!_0x2ac0fa||!_0x121e47||!_0x5f2575){alert(_0x44eeff(0x4af));return;}const _0x272787=_0x1ae02e[_0x44eeff(0x11ef)][_0x44eeff(0xb46)]===_0x44eeff(0xee7)||!_0x1ae02e[_0x44eeff(0x11ef)][_0x44eeff(0xb46)]?'用户':_0x1ae02e[_0x44eeff(0x11ef)]['nickname'],_0x5193df=_0x1b9d13['longTermMemory']&&_0x1b9d13[_0x44eeff(0x5fb)][_0x44eeff(0x58a)]>0x0?_0x1b9d13[_0x44eeff(0x5fb)]['map'](_0x3b9328=>_0x44eeff(0x10a4)+_0x3f7f7a(_0x3b9328[_0x44eeff(0x1388)])+')\x20'+_0x3b9328[_0x44eeff(0x128c)])[_0x44eeff(0x1143)]('\x0a'):'无',_0x2d62a4=_0x1b9d13[_0x44eeff(0x6a8)][_0x44eeff(0x4b2)]||0xa,_0x3c8ac2=_0x1b9d13[_0x44eeff(0xce3)]['slice'](-_0x2d62a4)['map'](_0x3fb4e1=>(_0x3fb4e1[_0x44eeff(0xfbb)]===_0x44eeff(0x860)?_0x272787:_0x1b9d13[_0x44eeff(0x5d2)])+':\x20'+String(_0x3fb4e1[_0x44eeff(0x128c)])[_0x44eeff(0x516)](0x0,0x1e)+_0x44eeff(0x629))[_0x44eeff(0x1143)]('\x0a'),_0x3dd997=(_0x1b9d13[_0x44eeff(0x6a8)][_0x44eeff(0x1469)]||[])[_0x44eeff(0x1431)](_0x1d3da5=>_0x1ae02e[_0x44eeff(0x1453)][_0x44eeff(0x13b7)](_0xad4f1a=>_0xad4f1a['id']===_0x1d3da5))['filter'](Boolean)[_0x44eeff(0x1431)](_0x37da53=>'\x0a##\x20世界书《'+_0x37da53['name']+_0x44eeff(0x1330)+_0x37da53[_0x44eeff(0x128c)]['filter'](_0x29d82d=>_0x29d82d[_0x44eeff(0x1368)])[_0x44eeff(0x1431)](_0x48a460=>'-\x20'+_0x48a460[_0x44eeff(0x128c)])[_0x44eeff(0x1143)]('\x0a'))[_0x44eeff(0x1143)](''),_0x1dad4a=_0x44eeff(0xa7b)+_0x1b9d13[_0x44eeff(0x5d2)]+_0x44eeff(0x40a)+_0x1b9d13[_0x44eeff(0x6a8)][_0x44eeff(0xf42)]+_0x44eeff(0x5e4)+_0x5193df+'\x0a'+_0x3dd997+_0x44eeff(0xff0)+_0x272787+_0x44eeff(0x9ec)+_0x3c8ac2+_0x44eeff(0x10cc);try{const _0x4e3902=[{'role':_0x44eeff(0x860),'content':_0x44eeff(0x754)}];let _0x47ffcd=_0x2ac0fa[_0x44eeff(0xe82)](_0x44eeff(0xc38)),_0x253af3=_0x16b978(_0x5f2575,_0x121e47,_0x1dad4a,_0x4e3902);const _0x57931f=_0x47ffcd?await fetch(_0x253af3['url'],_0x253af3[_0x44eeff(0xc6b)]):await fetch(_0x2ac0fa+_0x44eeff(0x14c2),{'method':_0x44eeff(0x12d9),'headers':{'Content-Type':_0x44eeff(0xa90),'Authorization':_0x44eeff(0xf03)+_0x121e47},'body':JSON[_0x44eeff(0x994)]({'model':_0x5f2575,'messages':[{'role':_0x44eeff(0x1594),'content':_0x1dad4a},..._0x4e3902],'temperature':_0x1ae02e['globalSettings']['apiTemperature']||0x1})});if(!_0x57931f['ok'])throw new Error(_0x44eeff(0xaa6)+_0x57931f[_0x44eeff(0x1260)]);const _0x147e17=await _0x57931f[_0x44eeff(0xb84)](),_0x422d35=getGeminiResponseText(_0x147e17),_0x384dce=_0x422d35['replace'](/^```json\s*/,'')['replace'](/```$/,''),_0x6ca8d4=JSON['parse'](_0x384dce);await _0x1460c5('请稍候...',_0x44eeff(0x14a2)+_0x6ca8d4['length']+_0x44eeff(0xf7c));const _0x513088=_0x6ca8d4['map'](async _0x4418c8=>{const _0x3c3711=_0x44eeff;let _0x506dd3=await _0x5cc50b(_0x4418c8[_0x3c3711(0xf85)],_0x4418c8[_0x3c3711(0x782)]);(!_0x506dd3||_0x506dd3[_0x3c3711(0x58a)]===0x0)&&(_0x506dd3=await _0x21b1f5(_0x4418c8['songName']));if(_0x506dd3[_0x3c3711(0x58a)]>0x0)return _0x550ed0(_0x506dd3[0x0]);return console[_0x3c3711(0xb3b)](_0x3c3711(0xe76)+_0x4418c8[_0x3c3711(0xf85)]+_0x3c3711(0x7c5)+_0x4418c8[_0x3c3711(0x782)]+'”'),null;}),_0x3d4f86=(await Promise[_0x44eeff(0x54b)](_0x513088))[_0x44eeff(0xede)](Boolean);_0x1b9d13['simulatedMusicPlaylist']=_0x3d4f86,await _0x3df81a[_0x44eeff(0x589)][_0x44eeff(0x295)](_0x1b9d13),await _0x116da9();}catch(_0x1ffcc6){console[_0x44eeff(0x127d)](_0x44eeff(0x36c),_0x1ffcc6),await _0x1460c5('生成失败',_0x44eeff(0x3b9)+_0x1ffcc6['message']);}}function _0x116da9(){const _0xecfc7=_0x2b1222,_0xe34dc1=document[_0xecfc7(0x1f4)](_0xecfc7(0x5a3));_0xe34dc1['innerHTML']='';if(!_0x2123eb)return;const _0x3e4d09=_0x1ae02e[_0xecfc7(0x589)][_0x2123eb],_0x11f460=_0x3e4d09[_0xecfc7(0x135b)]||[];if(_0x11f460['length']===0x0){_0xe34dc1[_0xecfc7(0xf21)]=_0xecfc7(0x141f);return;}_0x11f460[_0xecfc7(0x59b)]((_0x521969,_0x36caec)=>{const _0x4e702d=_0xecfc7,_0x246da7=document[_0x4e702d(0x219)](_0x4e702d(0xaf9));_0x246da7[_0x4e702d(0x7c6)]=_0x4e702d(0xb63),_0x246da7[_0x4e702d(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x521969['cover']+'\x22\x20class=\x22music-item-cover\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22music-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22music-item-name\x22>'+_0x521969[_0x4e702d(0x5d2)]+_0x4e702d(0x9f4)+_0x521969[_0x4e702d(0x1309)]+_0x4e702d(0x52c),_0x246da7[_0x4e702d(0x122b)]('click',()=>_0x4b54a0(_0x521969)),_0xe34dc1[_0x4e702d(0x6ce)](_0x246da7);});}let _0x5c282e={'currentPlaylist':[],'currentIndex':-0x1,'isPlaying':![],'playMode':_0x2b1222(0x249),'lrcUpdateInterval':null,'parsedLyrics':[],'currentLyricIndex':-0x1};function _0x4b54a0(_0x57edb9){const _0x424739=_0x2b1222,_0x38faa2=document['getElementById'](_0x424739(0xc64)),_0x33d09a=document[_0x424739(0x1f4)](_0x424739(0x930));if(_0x5c282e[_0x424739(0x77a)])clearInterval(_0x5c282e[_0x424739(0x77a)]);_0x38faa2['pause']();const _0x22029d=_0x5c282e[_0x424739(0xf7a)][_0x424739(0xf2d)](_0x170ac8=>_0x170ac8[_0x424739(0x9fe)]===_0x57edb9['src']);_0x22029d>-0x1?_0x5c282e[_0x424739(0x541)]=_0x22029d:(_0x5c282e[_0x424739(0xf7a)]=[_0x57edb9],_0x5c282e['currentIndex']=0x0);document['getElementById'](_0x424739(0xd15))['textContent']=_0x57edb9[_0x424739(0x5d2)],document['getElementById'](_0x424739(0x554))[_0x424739(0x231)]=_0x57edb9['artist'],document[_0x424739(0x1f4)](_0x424739(0x642))[_0x424739(0x9fe)]=_0x57edb9[_0x424739(0xeac)],_0x5c282e[_0x424739(0xc78)]=_0x312b38(_0x57edb9['lrcContent']||''),_0x5720b5();if(_0x57edb9[_0x424739(0x10b1)]){const _0x500081=new Blob([_0x57edb9[_0x424739(0x9fe)]],{'type':_0x57edb9[_0x424739(0x20b)]||_0x424739(0xf77)});_0x38faa2[_0x424739(0x9fe)]=URL['createObjectURL'](_0x500081);}else _0x38faa2['src']=_0x57edb9[_0x424739(0x9fe)];_0x38faa2[_0x424739(0x9ab)]()[_0x424739(0x3d1)](_0x11c14f=>console[_0x424739(0x127d)](_0x424739(0xbb8),_0x11c14f)),_0x38faa2[_0x424739(0x783)]=()=>{const _0x58fd33=_0x424739;document[_0x58fd33(0x1f4)]('char-music-total-time')[_0x58fd33(0x231)]=_0x56179d(_0x38faa2[_0x58fd33(0x15b4)]),_0x5c282e[_0x58fd33(0x77a)]=setInterval(_0x2d8378,0x1f4);},_0x33d09a['classList'][_0x424739(0x6a4)](_0x424739(0xfca));}function _0x5e6345(){const _0xdc52f9=_0x2b1222,_0x2924d3=document[_0xdc52f9(0x1f4)](_0xdc52f9(0x930)),_0x2817b2=document[_0xdc52f9(0x1f4)](_0xdc52f9(0xc64));if(_0x5c282e['lrcUpdateInterval'])clearInterval(_0x5c282e[_0xdc52f9(0x77a)]);_0x2817b2[_0xdc52f9(0x352)](),_0x2817b2[_0xdc52f9(0x9fe)]='',_0x2924d3[_0xdc52f9(0x159b)][_0xdc52f9(0xa9c)](_0xdc52f9(0xfca)),_0x5c282e[_0xdc52f9(0x14ce)]=![],document[_0xdc52f9(0x1f4)]('char-vinyl-container')[_0xdc52f9(0x159b)][_0xdc52f9(0xa9c)](_0xdc52f9(0x875));}function _0x2d8378(){const _0x2ec448=_0x2b1222,_0x4d06d5=document[_0x2ec448(0x1f4)](_0x2ec448(0xc64));if(!_0x4d06d5[_0x2ec448(0x15b4)])return;const _0x407438=_0x4d06d5[_0x2ec448(0xa68)],_0x5779d2=_0x4d06d5[_0x2ec448(0x15b4)];document[_0x2ec448(0x1f4)](_0x2ec448(0xf50))['style'][_0x2ec448(0x4cb)]=_0x407438/_0x5779d2*0x64+'%',document[_0x2ec448(0x1f4)]('char-music-current-time')[_0x2ec448(0x231)]=_0x56179d(_0x407438),_0x5f51a5(_0x407438);}function _0x5720b5(){const _0xb34234=_0x2b1222,_0x1661c9=document[_0xb34234(0x1f4)]('char-music-lyrics');_0x1661c9['innerHTML']='',_0x5c282e[_0xb34234(0x35c)]=-0x1;if(!_0x5c282e[_0xb34234(0xc78)]||_0x5c282e[_0xb34234(0xc78)][_0xb34234(0x58a)]===0x0){_0x1661c9[_0xb34234(0xf21)]=_0xb34234(0xd6b);return;}_0x5c282e['parsedLyrics'][_0xb34234(0x59b)]((_0x3329b1,_0x43cd49)=>{const _0x310f7c=_0xb34234,_0x14ba88=document[_0x310f7c(0x219)]('p');_0x14ba88['textContent']=_0x3329b1[_0x310f7c(0x40f)],_0x14ba88[_0x310f7c(0x746)][_0x310f7c(0x10ba)]=_0x43cd49,_0x1661c9[_0x310f7c(0x6ce)](_0x14ba88);});}function _0x5f51a5(_0x1258a2){const _0x22205c=_0x2b1222,_0x31a00f=_0x5c282e[_0x22205c(0xc78)];if(_0x31a00f[_0x22205c(0x58a)]===0x0)return;let _0x4e8b3e=-0x1;for(let _0x16fefa=0x0;_0x16fefa<_0x31a00f[_0x22205c(0x58a)];_0x16fefa++){if(_0x1258a2>=_0x31a00f[_0x16fefa][_0x22205c(0x12ba)])_0x4e8b3e=_0x16fefa;else break;}if(_0x4e8b3e===_0x5c282e['currentLyricIndex'])return;_0x5c282e[_0x22205c(0x35c)]=_0x4e8b3e;const _0x969352=document[_0x22205c(0x1f4)]('char-music-lyrics'),_0xf22044=_0x969352[_0x22205c(0x14bf)]('p');_0xf22044['forEach'](_0x2714be=>_0x2714be['classList'][_0x22205c(0xa9c)](_0x22205c(0x7cf)));if(_0x4e8b3e>-0x1){const _0x1d60fd=_0x969352[_0x22205c(0xeda)]('p[data-index=\x22'+_0x4e8b3e+'\x22]');if(_0x1d60fd){_0x1d60fd['classList'][_0x22205c(0x6a4)]('active');const _0x1be691=_0x969352[_0x22205c(0xf13)]/0x2-_0x1d60fd[_0x22205c(0x1363)]-_0x1d60fd[_0x22205c(0xc5b)]/0x2;_0xf22044['forEach'](_0x2bbbf0=>{const _0x18e77b=_0x22205c;_0x2bbbf0[_0x18e77b(0x215)]['transform']='translateY('+_0x1be691+_0x18e77b(0xc3a);});}}}function _0x1fc023(){const _0x4b5c71=_0x2b1222;if(_0x5c282e[_0x4b5c71(0xf7a)][_0x4b5c71(0x58a)]===0x0)return;let _0x40be3d;switch(_0x5c282e[_0x4b5c71(0x1132)]){case _0x4b5c71(0x13ae):_0x40be3d=Math['floor'](Math['random']()*_0x5c282e[_0x4b5c71(0xf7a)][_0x4b5c71(0x58a)]);break;case _0x4b5c71(0x10c0):_0x4b54a0(_0x5c282e['currentPlaylist'][_0x5c282e[_0x4b5c71(0x541)]]);return;case _0x4b5c71(0x249):default:_0x40be3d=(_0x5c282e['currentIndex']+0x1)%_0x5c282e[_0x4b5c71(0xf7a)][_0x4b5c71(0x58a)];break;}_0x4b54a0(_0x5c282e['currentPlaylist'][_0x40be3d]);}function _0x352a20(){const _0x302599=_0x2b1222;if(_0x5c282e[_0x302599(0xf7a)][_0x302599(0x58a)]===0x0)return;const _0x3f8f25=(_0x5c282e['currentIndex']-0x1+_0x5c282e[_0x302599(0xf7a)][_0x302599(0x58a)])%_0x5c282e['currentPlaylist']['length'];_0x4b54a0(_0x5c282e[_0x302599(0xf7a)][_0x3f8f25]);}function _0x39dda4(){const _0x581ebe=_0x2b1222,_0x2fd8d7=[_0x581ebe(0x249),_0x581ebe(0x13ae),_0x581ebe(0x10c0)],_0x5da947=_0x2fd8d7[_0x581ebe(0x621)](_0x5c282e[_0x581ebe(0x1132)]);_0x5c282e[_0x581ebe(0x1132)]=_0x2fd8d7[(_0x5da947+0x1)%_0x2fd8d7[_0x581ebe(0x58a)]],document[_0x581ebe(0x1f4)](_0x581ebe(0x1341))[_0x581ebe(0x231)]={'order':'顺序','random':'随机','single':'单曲'}[_0x5c282e[_0x581ebe(0x1132)]];}function _0x16901c(){const _0x2a2183=_0x2b1222,_0x5d83bb=document[_0x2a2183(0x1f4)](_0x2a2183(0xc64)),_0x14b5d8=document[_0x2a2183(0x1f4)](_0x2a2183(0xf97)),_0x585ed1=document['getElementById']('char-vinyl-container');_0x14b5d8[_0x2a2183(0x122b)](_0x2a2183(0x740),()=>{const _0x4419c7=_0x2a2183;if(_0x5d83bb[_0x4419c7(0x2e0)]){if(_0x5c282e[_0x4419c7(0x541)]>-0x1)_0x5d83bb[_0x4419c7(0x9ab)]();}else _0x5d83bb[_0x4419c7(0x352)]();}),_0x5d83bb[_0x2a2183(0xdd0)]=()=>{const _0x12b3b8=_0x2a2183;_0x14b5d8['innerHTML']=_0x12b3b8(0xfd8),_0x585ed1['classList'][_0x12b3b8(0x6a4)](_0x12b3b8(0x875)),_0x5c282e[_0x12b3b8(0x14ce)]=!![];},_0x5d83bb[_0x2a2183(0x52f)]=()=>{const _0x397f62=_0x2a2183;_0x14b5d8[_0x397f62(0xf21)]=_0x397f62(0xe34),_0x585ed1[_0x397f62(0x159b)]['remove'](_0x397f62(0x875)),_0x5c282e[_0x397f62(0x14ce)]=![];},_0x5d83bb[_0x2a2183(0x8f0)]=()=>{const _0x54837c=_0x2a2183;_0x585ed1[_0x54837c(0x159b)][_0x54837c(0xa9c)](_0x54837c(0x875)),_0x5c282e[_0x54837c(0x14ce)]=![],_0x1fc023();},document[_0x2a2183(0x1f4)]('char-music-prev-btn')[_0x2a2183(0x122b)](_0x2a2183(0x740),_0x352a20),document['getElementById']('char-music-next-btn')['addEventListener']('click',_0x1fc023),document['getElementById'](_0x2a2183(0x1341))[_0x2a2183(0x122b)](_0x2a2183(0x740),_0x39dda4),document['getElementById'](_0x2a2183(0x1493))[_0x2a2183(0x122b)](_0x2a2183(0x740),_0x4da1b5=>{const _0x5bbca8=_0x2a2183;if(!_0x5d83bb['duration'])return;const _0x30a651=_0x4da1b5[_0x5bbca8(0x6c1)],_0x4f26d3=_0x4da1b5[_0x5bbca8(0x553)];_0x5d83bb[_0x5bbca8(0xa68)]=_0x4f26d3/_0x30a651[_0x5bbca8(0x8e1)]*_0x5d83bb[_0x5bbca8(0x15b4)];});}async function _0x5591b9(){const _0x54330f=_0x2b1222,_0x501d76=document['getElementById']('douban-posts-list');_0x501d76[_0x54330f(0xf21)]='';const _0x217fe0=await _0x3df81a['doubanPosts'][_0x54330f(0x931)]('timestamp')[_0x54330f(0x115a)]()[_0x54330f(0x27a)]();if(_0x217fe0[_0x54330f(0x58a)]===0x0){_0x501d76[_0x54330f(0xf21)]='<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20padding:\x2050px\x200;\x22>这里空空如也，<br>点击右上角刷新按钮，看看大家都在聊什么吧！</p>';return;}_0x217fe0[_0x54330f(0x59b)](_0x206581=>{const _0x61af9a=_0x54330f;let _0x326e70;const _0x491a62=_0x206581[_0x61af9a(0x24c)]?Object[_0x61af9a(0x753)](_0x1ae02e[_0x61af9a(0x589)])[_0x61af9a(0x13b7)](_0x4295ed=>!_0x4295ed[_0x61af9a(0xe83)]&&_0x4295ed['name']===_0x206581[_0x61af9a(0x24c)]):null;if(_0x491a62)_0x326e70=_0x491a62[_0x61af9a(0x6a8)][_0x61af9a(0xc99)];else{const _0x2b4cda=Object[_0x61af9a(0x753)](_0x1ae02e[_0x61af9a(0x589)])[_0x61af9a(0x13b7)](_0x48e591=>!_0x48e591[_0x61af9a(0xe83)]&&_0x48e591[_0x61af9a(0x5d2)]===_0x206581[_0x61af9a(0xc8c)]);if(_0x2b4cda)_0x326e70=_0x2b4cda[_0x61af9a(0x6a8)][_0x61af9a(0xc99)];else _0x206581[_0x61af9a(0x53e)]?_0x326e70=_0x61af9a(0xe8f)+encodeURIComponent(_0x206581['authorAvatarPrompt']):_0x326e70=_0x5494d0;}const _0x3b2d8f=document['createElement']('div');_0x3b2d8f[_0x61af9a(0x7c6)]=_0x61af9a(0x88f),_0x3b2d8f[_0x61af9a(0x1199)]=()=>_0x419366(_0x206581['id']),_0x3b2d8f['innerHTML']=_0x61af9a(0xe32)+_0x326e70+'\x22\x20class=\x22douban-post-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22douban-author-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22douban-author-name\x22>'+_0x206581[_0x61af9a(0xc8c)]+_0x61af9a(0x1237)+_0x206581['groupName']+_0x61af9a(0xcf2)+_0x206581['postTitle']+_0x61af9a(0x6d2)+_0x206581['content'][_0x61af9a(0xef0)](/\n/g,'<br>')+_0x61af9a(0x14ae)+_0x206581[_0x61af9a(0x90a)]+_0x61af9a(0xbee)+_0x206581[_0x61af9a(0x2d8)]+_0x61af9a(0x569)+_0x3f7f7a(_0x206581[_0x61af9a(0x1388)])+_0x61af9a(0x2f0),_0x501d76[_0x61af9a(0x6ce)](_0x3b2d8f);});}async function _0x50c6f2(){const _0x5610b6=_0x2b1222,_0x41f788=_0x1ae02e[_0x5610b6(0x12c0)]['doubanActiveCharacterIds']||[];if(_0x41f788['length']===0x0){await _0x1460c5(_0x5610b6(0x1555),_0x5610b6(0xd42));return;}await _0x1460c5(_0x5610b6(0x11b7),_0x5610b6(0x12af)+_0x41f788[_0x5610b6(0x58a)]+_0x5610b6(0xc2f));const {proxyUrl:_0x38e120,apiKey:_0x37b1c0,model:_0x3c85ab}=_0x1ae02e['apiConfig'];if(!_0x38e120||!_0x37b1c0||!_0x3c85ab){alert('请先在API设置中配置好API信息。');return;}const _0x2f072e=new Set();_0x41f788[_0x5610b6(0x59b)](_0x2ec757=>{const _0x904df3=_0x5610b6,_0x3cc1fd=_0x1ae02e[_0x904df3(0x589)][_0x2ec757];_0x3cc1fd&&_0x3cc1fd[_0x904df3(0x6a8)]['linkedWorldBookIds']&&_0x3cc1fd[_0x904df3(0x6a8)][_0x904df3(0x1469)][_0x904df3(0x59b)](_0x232c38=>_0x2f072e[_0x904df3(0x6a4)](_0x232c38));});let _0x3bd6a9='';_0x2f072e[_0x5610b6(0xb51)]>0x0&&(_0x3bd6a9+=_0x5610b6(0x14be),_0x2f072e[_0x5610b6(0x59b)](_0x4dce83=>{const _0xbec350=_0x5610b6,_0x562ada=_0x1ae02e[_0xbec350(0x1453)][_0xbec350(0x13b7)](_0x43db3c=>_0x43db3c['id']===_0x4dce83);if(_0x562ada){const _0x4b30fe=_0x562ada[_0xbec350(0x128c)][_0xbec350(0xede)](_0x46200b=>_0x46200b['enabled']!==![])['map'](_0x17c7ea=>'-\x20'+_0x17c7ea[_0xbec350(0x128c)])[_0xbec350(0x1143)]('\x0a');_0x4b30fe&&(_0x3bd6a9+=_0xbec350(0x1356)+_0x562ada['name']+_0xbec350(0x134b)+_0x4b30fe);}}));const _0x4d17b0=_0x1ae02e[_0x5610b6(0x1453)][_0x5610b6(0x13b7)](_0x5085ee=>_0x5085ee[_0x5610b6(0x5d2)]===_0x5610b6(0x4d2));let _0x36d981='',_0x14c39f=[];_0x4d17b0&&_0x4d17b0[_0x5610b6(0x128c)]['forEach'](_0xf737c6=>{const _0x302cde=_0x5610b6;_0xf737c6[_0x302cde(0x306)][_0x302cde(0xe82)](_0x302cde(0x790))&&(_0x36d981+='\x0a#\x20豆瓣社区风格设定\x20(来自世界书)\x0a'+_0xf737c6[_0x302cde(0x128c)]);if(_0xf737c6[_0x302cde(0x306)][_0x302cde(0xe82)](_0x302cde(0x102e))){const _0x167c92=_0xf737c6[_0x302cde(0x128c)]['split']('\x0a');_0x167c92[_0x302cde(0x59b)](_0xc9321e=>{const _0x34ea45=_0x302cde,_0x460724=_0xc9321e[_0x34ea45(0xba5)](/- \*\*昵称\*\*:\s*(.*?)\s*\*\*人设\*\*:\s*(.*)/);_0x460724&&_0x14c39f[_0x34ea45(0x1426)]({'name':_0x460724[0x1][_0x34ea45(0x4a2)](),'persona':_0x460724[0x2][_0x34ea45(0x4a2)]()});});}});const _0x5a9fc9=_0x1ae02e[_0x5610b6(0x11ef)][_0x5610b6(0xb46)]||'我',_0x7e4f9d=_0x41f788[_0x5610b6(0x58a)]>0x0&&_0x1ae02e[_0x5610b6(0x589)][_0x41f788[0x0]]?_0x1ae02e[_0x5610b6(0x589)][_0x41f788[0x0]][_0x5610b6(0x6a8)][_0x5610b6(0x36b)]:_0x5610b6(0x1570);let _0x543843='';_0x41f788[_0x5610b6(0x59b)](_0x20d402=>{const _0x59dd82=_0x5610b6,_0x51d50b=_0x1ae02e['chats'][_0x20d402];if(_0x51d50b){const _0x3b5094=_0x51d50b[_0x59dd82(0x5fb)]&&_0x51d50b[_0x59dd82(0x5fb)][_0x59dd82(0x58a)]>0x0?_0x51d50b[_0x59dd82(0x5fb)]['map'](_0xd84652=>_0xd84652[_0x59dd82(0x128c)])[_0x59dd82(0x1143)](';\x20'):'无',_0x1b407b=_0x51d50b[_0x59dd82(0xce3)]['slice'](-0xa)[_0x59dd82(0x1431)](_0x8aaa62=>(_0x8aaa62[_0x59dd82(0xfbb)]===_0x59dd82(0x860)?_0x5a9fc9:_0x51d50b['name'])+':\x20'+String(_0x8aaa62[_0x59dd82(0x128c)])['substring'](0x0,0x1e)+_0x59dd82(0x629))[_0x59dd82(0x1143)]('\x0a');_0x543843+=_0x59dd82(0x13d4)+_0x51d50b[_0x59dd82(0x5d2)]+_0x59dd82(0x13b0)+_0x51d50b[_0x59dd82(0x6a8)][_0x59dd82(0xf42)]+'</persona>\x0a\x20\x20<memory>'+_0x3b5094+_0x59dd82(0xb17)+_0x1b407b+_0x59dd82(0xa51);}}),_0x14c39f[_0x5610b6(0x59b)](_0x224e2a=>{const _0x33c7e1=_0x5610b6;_0x543843+=_0x33c7e1(0x13d4)+_0x224e2a['name']+'</name>\x0a\x20\x20<persona>'+_0x224e2a['persona']+_0x33c7e1(0xf9b);});const _0x39a1dc=new Date(),_0xab6595=_0x39a1dc[_0x5610b6(0x613)](_0x5610b6(0xd02),{'dateStyle':_0x5610b6(0x82e),'timeStyle':_0x5610b6(0x144f)}),_0x316f53=_0x1ae02e[_0x5610b6(0x12c0)][_0x5610b6(0x9c7)]||0xc,_0x448ab4=_0x1ae02e[_0x5610b6(0x12c0)]['doubanMaxPosts']||0x14,_0x3723de='\x0a#\x20你的任务\x0a你是一个虚拟社区内容生成器。你的任务是根据下面提供的【统一角色列表】，虚构出【'+_0x316f53+'到'+_0x448ab4+_0x5610b6(0x1124)+_0xab6595+_0x5610b6(0x147b)+_0x5a9fc9+_0x5610b6(0xfef)+_0x5a9fc9+_0x5610b6(0x9fd)+_0x36d981+'\x0a'+_0x3bd6a9+_0x5610b6(0x7b1)+_0xab6595+'\x0a\x0a#\x20【你的聊天对象（用户）的身份档案】\x0a-\x20**昵称**:\x20'+_0x5a9fc9+_0x5610b6(0xa7c)+_0x7e4f9d+_0x5610b6(0xbf8)+_0x543843+'\x0a\x0a现在，请严格遵守所有规则，特别是【时间感知】和【禁止扮演用户】的铁律，开始生成这组生动、多样且充满“豆瓣味”的小组帖子。';try{const _0x325866=[{'role':_0x5610b6(0x860),'content':'请根据角色列表，生成豆瓣小组帖子。'}];let _0x352b71=_0x38e120['includes'](_0x5610b6(0xc38)),_0x55ddf6=_0x16b978(_0x3c85ab,_0x37b1c0,_0x3723de,_0x325866);const _0x2e95f1=_0x352b71?await fetch(_0x55ddf6[_0x5610b6(0x258)],_0x55ddf6[_0x5610b6(0xc6b)]):await fetch(_0x38e120+_0x5610b6(0x14c2),{'method':_0x5610b6(0x12d9),'headers':{'Content-Type':_0x5610b6(0xa90),'Authorization':_0x5610b6(0xf03)+_0x37b1c0},'body':JSON['stringify']({'model':_0x3c85ab,'messages':[{'role':_0x5610b6(0x1594),'content':_0x3723de},..._0x325866],'temperature':_0x1ae02e[_0x5610b6(0x12c0)][_0x5610b6(0x217)]||0x1})});if(!_0x2e95f1['ok'])throw new Error(_0x5610b6(0xaa6)+_0x2e95f1[_0x5610b6(0x1260)]);const _0x5dbd60=await _0x2e95f1[_0x5610b6(0xb84)](),_0x3d9096=getGeminiResponseText(_0x5dbd60),_0x10a1ec=_0x3d9096[_0x5610b6(0xba5)](/\[[\s\S]*\]/);if(!_0x10a1ec)throw new Error(_0x5610b6(0x600)+_0x3d9096);const _0x7e52e1=JSON[_0x5610b6(0x129c)](_0x10a1ec[0x0]);await _0x3df81a['doubanPosts'][_0x5610b6(0x411)](),await _0x3df81a[_0x5610b6(0x14f6)][_0x5610b6(0x4ea)](_0x7e52e1['map'](_0x1ac7b7=>({..._0x1ac7b7,'timestamp':Date[_0x5610b6(0xd6e)]()-Math[_0x5610b6(0x13ae)]()*0x186a0}))),await _0x5591b9();}catch(_0x10d088){console[_0x5610b6(0x127d)](_0x5610b6(0x1516),_0x10d088),await _0x1460c5(_0x5610b6(0x108a),_0x5610b6(0x631)+_0x10d088['message']);}}async function _0x419366(_0x248469){const _0x2936d8=_0x2b1222;_0x2e53fa(_0x2936d8(0x921)),_0x4b6465=_0x248469;const _0x49ddc2=await _0x3df81a['doubanPosts'][_0x2936d8(0x13f8)](_0x248469);if(!_0x49ddc2){_0x2e53fa(_0x2936d8(0x357));return;}document['getElementById']('douban-post-detail-title')[_0x2936d8(0x231)]=_0x2936d8(0xd14);let _0x3cfc63=_0x5494d0,_0x4ba206=_0x49ddc2[_0x2936d8(0xc8c)];const _0x17783f=_0x49ddc2[_0x2936d8(0x24c)]?Object[_0x2936d8(0x753)](_0x1ae02e['chats'])['find'](_0x150a89=>!_0x150a89[_0x2936d8(0xe83)]&&_0x150a89[_0x2936d8(0x96f)]===_0x49ddc2[_0x2936d8(0x24c)]):null;if(_0x17783f)_0x3cfc63=_0x17783f['settings']['aiAvatar'];else{const _0x108f89=Object['values'](_0x1ae02e[_0x2936d8(0x589)])[_0x2936d8(0x13b7)](_0x237a94=>!_0x237a94['isGroup']&&_0x237a94[_0x2936d8(0x5d2)]===_0x49ddc2[_0x2936d8(0xc8c)]);if(_0x108f89)_0x3cfc63=_0x108f89[_0x2936d8(0x6a8)]['aiAvatar'];else _0x49ddc2['authorAvatarPrompt']&&(_0x3cfc63=_0x2936d8(0xe8f)+encodeURIComponent(_0x49ddc2[_0x2936d8(0x53e)]));}document[_0x2936d8(0x1f4)](_0x2936d8(0x10c7))['src']=_0x3cfc63,document['getElementById'](_0x2936d8(0xeeb))[_0x2936d8(0x231)]=_0x4ba206,document[_0x2936d8(0x1f4)]('douban-detail-group')['textContent']=_0x2936d8(0x189)+_0x49ddc2['groupName'],document['getElementById'](_0x2936d8(0x333))[_0x2936d8(0x231)]=_0x49ddc2['postTitle'],document[_0x2936d8(0x1f4)](_0x2936d8(0x1ed))[_0x2936d8(0xf21)]=_0x49ddc2[_0x2936d8(0x128c)][_0x2936d8(0xef0)](/\n/g,'<br>'),document[_0x2936d8(0x1f4)](_0x2936d8(0x15d4))[_0x2936d8(0x9fe)]=_0x1ae02e['qzoneSettings'][_0x2936d8(0x95b)],document[_0x2936d8(0x1f4)](_0x2936d8(0x145c))['value']='';const _0x4eb3a8=document[_0x2936d8(0x1f4)](_0x2936d8(0x12e2));_0x4eb3a8[_0x2936d8(0xf21)]='';if(_0x49ddc2[_0x2936d8(0x10ae)]&&_0x49ddc2['comments'][_0x2936d8(0x58a)]>0x0){const _0x5ab692=new Map();_0x49ddc2[_0x2936d8(0x10ae)][_0x2936d8(0x59b)](_0x1b62f0=>{const _0x3ec5b6=_0x2936d8;let _0x2e20ef=_0x5494d0;const _0x59dea9=_0x1ae02e[_0x3ec5b6(0x11ef)][_0x3ec5b6(0xb46)]||'我',_0xd67f97=_0x1b62f0['commenter'];if(_0x5ab692[_0x3ec5b6(0xe75)](_0xd67f97))_0x2e20ef=_0x5ab692[_0x3ec5b6(0x13f8)](_0xd67f97);else{if(_0xd67f97===_0x59dea9)_0x2e20ef=_0x1ae02e['qzoneSettings'][_0x3ec5b6(0x95b)];else{if(_0xd67f97===_0x49ddc2[_0x3ec5b6(0xc8c)])_0x2e20ef=_0x3cfc63;else{const _0x39faae=_0x1b62f0[_0x3ec5b6(0x1133)]?Object['values'](_0x1ae02e['chats'])[_0x3ec5b6(0x13b7)](_0x4b1ef4=>!_0x4b1ef4[_0x3ec5b6(0xe83)]&&_0x4b1ef4['originalName']===_0x1b62f0[_0x3ec5b6(0x1133)]):null;if(_0x39faae)_0x2e20ef=_0x39faae[_0x3ec5b6(0x6a8)][_0x3ec5b6(0xc99)];else{const _0x3fc6f8=Object['values'](_0x1ae02e[_0x3ec5b6(0x589)])[_0x3ec5b6(0x13b7)](_0x3a27ab=>!_0x3a27ab[_0x3ec5b6(0xe83)]&&_0x3a27ab[_0x3ec5b6(0x5d2)]===_0xd67f97);if(_0x3fc6f8)_0x2e20ef=_0x3fc6f8[_0x3ec5b6(0x6a8)][_0x3ec5b6(0xc99)];else _0x1b62f0[_0x3ec5b6(0x400)]&&(_0x2e20ef='https://image.pollinations.ai/prompt/'+encodeURIComponent(_0x1b62f0[_0x3ec5b6(0x400)]));}}}_0x5ab692['set'](_0xd67f97,_0x2e20ef);}const _0x9c53f=document[_0x3ec5b6(0x219)]('div');_0x9c53f[_0x3ec5b6(0x7c6)]=_0x3ec5b6(0xab4),_0x9c53f[_0x3ec5b6(0xf21)]=_0x3ec5b6(0x960)+_0x2e20ef+_0x3ec5b6(0x80e)+_0xd67f97+_0x3ec5b6(0xc08)+_0x1b62f0[_0x3ec5b6(0x40f)][_0x3ec5b6(0xef0)](/\n/g,_0x3ec5b6(0xc9b))+_0x3ec5b6(0x101b),_0x4eb3a8[_0x3ec5b6(0x6ce)](_0x9c53f);});}else _0x4eb3a8[_0x2936d8(0xf21)]=_0x2936d8(0x641);const _0x15abf4=document[_0x2936d8(0x1f4)](_0x2936d8(0xd25));if(_0x15abf4)_0x15abf4[_0x2936d8(0x2d4)]=0x0;}async function _0x2444ab(){const _0x1b06a3=_0x2b1222;if(!_0x4b6465)return;const _0x19a14e=document[_0x1b06a3(0x1f4)](_0x1b06a3(0x145c)),_0x2bacee=_0x19a14e[_0x1b06a3(0x107e)][_0x1b06a3(0x4a2)]();if(!_0x2bacee)return;const _0x381f24=await _0x3df81a[_0x1b06a3(0x14f6)][_0x1b06a3(0x13f8)](_0x4b6465);if(!_0x381f24)return;!_0x381f24[_0x1b06a3(0x10ae)]&&(_0x381f24[_0x1b06a3(0x10ae)]=[]);const _0xf82e67=_0x1ae02e[_0x1b06a3(0x11ef)]['nickname']||'我';_0x381f24[_0x1b06a3(0x10ae)]['push']({'commenter':_0xf82e67,'text':_0x2bacee}),_0x381f24[_0x1b06a3(0x2d8)]++,await _0x3df81a[_0x1b06a3(0x14f6)]['put'](_0x381f24),_0x19a14e[_0x1b06a3(0x107e)]='',await _0x419366(_0x4b6465);}async function _0x2f2999(){const _0x2cdb81=_0x2b1222;if(!_0x4b6465)return;const _0x217ab5=_0x4b6465,_0x1defa4=await _0x3df81a[_0x2cdb81(0x14f6)]['get'](_0x217ab5);if(!_0x1defa4)return;const _0x791163=_0x1defa4[_0x2cdb81(0x10ae)]&&_0x1defa4[_0x2cdb81(0x10ae)][_0x2cdb81(0x5cc)](-0x1)[0x0];if(!_0x791163){alert('还没有任何评论，无法等待回复。');return;}await _0x1460c5(_0x2cdb81(0x11b7),_0x2cdb81(0xac3));try{const {proxyUrl:_0x4ae47a,apiKey:_0x5b9782,model:_0x5cd2ff}=_0x1ae02e[_0x2cdb81(0x226)];if(!_0x4ae47a||!_0x5b9782||!_0x5cd2ff)throw new Error('API未配置，无法生成内容。');const _0x3442d3=_0x1ae02e['qzoneSettings']['nickname']||'我',_0x3c6b9f=_0x1ae02e[_0x2cdb81(0x589)][Object['keys'](_0x1ae02e[_0x2cdb81(0x589)])[0x0]]?.[_0x2cdb81(0x6a8)][_0x2cdb81(0x36b)]||'(未设置)',_0x5bfbc4=new Map();_0x1defa4[_0x2cdb81(0x10ae)]&&_0x1defa4[_0x2cdb81(0x10ae)][_0x2cdb81(0x59b)](_0x329c1e=>{const _0x2bc07f=_0x2cdb81,_0x429ed7=(_0x1ae02e[_0x2bc07f(0x12c0)]['doubanActiveCharacterIds']||[])[_0x2bc07f(0x690)](_0x5912ac=>_0x1ae02e[_0x2bc07f(0x589)][_0x5912ac]?.[_0x2bc07f(0x5d2)]===_0x329c1e[_0x2bc07f(0xe81)]);!_0x429ed7&&_0x329c1e[_0x2bc07f(0x400)]&&_0x5bfbc4[_0x2bc07f(0x3d3)](_0x329c1e[_0x2bc07f(0xe81)],_0x329c1e['avatar_prompt']);});let _0x5eef03=_0x2cdb81(0x876);_0x5bfbc4[_0x2cdb81(0xb51)]>0x0?(_0x5eef03+=_0x2cdb81(0x848),_0x5bfbc4['forEach']((_0x13b519,_0x40f75f)=>{const _0x7b6c21=_0x2cdb81;_0x5eef03+='-\x20**'+_0x40f75f+_0x7b6c21(0x3d0)+_0x13b519+'\x22\x0a';})):_0x5eef03+=_0x2cdb81(0x1a9);const _0x43dd5e=_0x1ae02e['worldBooks'][_0x2cdb81(0x13b7)](_0xd4c0a6=>_0xd4c0a6[_0x2cdb81(0x5d2)]==='豆瓣设定');let _0x2407cd=[];_0x43dd5e&&_0x43dd5e[_0x2cdb81(0x128c)][_0x2cdb81(0x59b)](_0x38b7c8=>{const _0x1ed896=_0x2cdb81;if(_0x38b7c8[_0x1ed896(0x306)][_0x1ed896(0xe82)](_0x1ed896(0x102e))){const _0x31620f=_0x38b7c8['content'][_0x1ed896(0x23f)]('\x0a');_0x31620f[_0x1ed896(0x59b)](_0x45b7f7=>{const _0x5e9e6a=_0x1ed896,_0x844e2a=_0x45b7f7[_0x5e9e6a(0xba5)](/- \*\*昵称\*\*:\s*(.*?)\s*\*\*人设\*\*:\s*(.*)/);_0x844e2a&&_0x2407cd[_0x5e9e6a(0x1426)]({'name':_0x844e2a[0x1]['trim'](),'persona':_0x844e2a[0x2][_0x5e9e6a(0x4a2)]()});});}});let _0x2c954b='';const _0x4711c1=_0x1ae02e[_0x2cdb81(0x12c0)][_0x2cdb81(0x7dc)]||[];_0x4711c1[_0x2cdb81(0x59b)](_0x289016=>{const _0x3d4524=_0x2cdb81,_0x5390df=_0x1ae02e[_0x3d4524(0x589)][_0x289016];if(_0x5390df){const _0x1c87eb=_0x5390df[_0x3d4524(0x5fb)]&&_0x5390df[_0x3d4524(0x5fb)][_0x3d4524(0x58a)]>0x0?_0x5390df[_0x3d4524(0x5fb)][_0x3d4524(0x1431)](_0x39591b=>_0x39591b['content'])['join'](';\x20'):'无',_0x4ac925=_0x5390df[_0x3d4524(0xce3)][_0x3d4524(0x5cc)](-0xa)['map'](_0xb618d4=>(_0xb618d4[_0x3d4524(0xfbb)]===_0x3d4524(0x860)?_0x3442d3:_0x5390df['name'])+':\x20'+String(_0xb618d4[_0x3d4524(0x128c)])[_0x3d4524(0x516)](0x0,0x1e)+_0x3d4524(0x629))[_0x3d4524(0x1143)]('\x0a');_0x2c954b+=_0x3d4524(0x5bf)+_0x5390df[_0x3d4524(0x5d2)]+':\x20'+_0x5390df['settings']['aiPersona']['substring'](0x0,0x32)+_0x3d4524(0x573)+_0x1c87eb+_0x3d4524(0x6ea)+_0x4ac925+']';}}),_0x2407cd['forEach'](_0x3e8cae=>{const _0x2888b4=_0x2cdb81;_0x2c954b+=_0x2888b4(0x5bf)+_0x3e8cae[_0x2888b4(0x5d2)]+':\x20'+_0x3e8cae[_0x2888b4(0x3be)];});const _0x59b74f=new Date(),_0x3f1edc=_0x59b74f[_0x2cdb81(0x613)](_0x2cdb81(0xd02),{'dateStyle':_0x2cdb81(0x82e),'timeStyle':_0x2cdb81(0x144f)}),_0x9b5e78=_0x2cdb81(0x134f)+_0x3442d3+_0x2cdb81(0x106e)+_0x3f1edc+_0x2cdb81(0x8b8)+_0x3442d3+'”。\x0a\x20\x20\x20\x20-\x20\x20\x20你【绝对不能】生成\x20commenter\x20字段为\x20“'+_0x3442d3+_0x2cdb81(0x1167)+_0x1defa4[_0x2cdb81(0x4c0)]+_0x2cdb81(0xa44)+_0x1defa4[_0x2cdb81(0xc8c)]+_0x2cdb81(0x181)+_0x1defa4[_0x2cdb81(0x128c)]['substring'](0x0,0x64)+_0x2cdb81(0x1258)+_0x1defa4['comments'][_0x2cdb81(0x1431)](_0x1b06ec=>'-\x20'+_0x1b06ec[_0x2cdb81(0xe81)]+':\x20'+_0x1b06ec[_0x2cdb81(0x40f)])[_0x2cdb81(0x1143)]('\x0a')+'\x0a\x0a'+_0x5eef03+'\x0a\x0a#\x20当前情景\x0a-\x20**当前真实时间**:\x20'+_0x3f1edc+_0x2cdb81(0x2c8)+_0x3442d3+_0x2cdb81(0xa7c)+_0x3c6b9f+_0x2cdb81(0x1389)+_0x2c954b+_0x2cdb81(0xe18),_0x4dbf28=[{'role':_0x2cdb81(0x860),'content':_0x2cdb81(0x6b3)}];let _0x22d8ad=_0x4ae47a[_0x2cdb81(0xe82)](_0x2cdb81(0xc38)),_0x3e06a9=_0x16b978(_0x5cd2ff,_0x5b9782,_0x9b5e78,_0x4dbf28);const _0x18a7fc=_0x22d8ad?await fetch(_0x3e06a9[_0x2cdb81(0x258)],_0x3e06a9[_0x2cdb81(0xc6b)]):await fetch(_0x4ae47a+_0x2cdb81(0x14c2),{'method':_0x2cdb81(0x12d9),'headers':{'Content-Type':_0x2cdb81(0xa90),'Authorization':'Bearer\x20'+_0x5b9782},'body':JSON[_0x2cdb81(0x994)]({'model':_0x5cd2ff,'messages':[{'role':_0x2cdb81(0x1594),'content':_0x9b5e78},..._0x4dbf28],'temperature':_0x1ae02e[_0x2cdb81(0x12c0)]['apiTemperature']||0x1})});if(!_0x18a7fc['ok'])throw new Error(_0x2cdb81(0xaa6)+_0x18a7fc[_0x2cdb81(0x1260)]);const _0x17e3fd=await _0x18a7fc[_0x2cdb81(0xb84)](),_0x3f86eb=getGeminiResponseText(_0x17e3fd),_0x2c8b11=_0x3f86eb[_0x2cdb81(0xef0)](/^```json\s*/,'')['replace'](/```$/,''),_0x17fa10=JSON[_0x2cdb81(0x129c)](_0x2c8b11);Array['isArray'](_0x17fa10)&&_0x17fa10[_0x2cdb81(0x58a)]>0x0&&(_0x1defa4[_0x2cdb81(0x10ae)]['push'](..._0x17fa10),_0x1defa4['commentsCount']+=_0x17fa10['length'],await _0x3df81a[_0x2cdb81(0x14f6)][_0x2cdb81(0x295)](_0x1defa4)),await _0x419366(_0x217ab5),_0x3b5fc9();}catch(_0x1ee88f){console[_0x2cdb81(0x127d)](_0x2cdb81(0xe3c),_0x1ee88f),await _0x1460c5(_0x2cdb81(0xc5a),_0x2cdb81(0x802)+_0x1ee88f[_0x2cdb81(0x11f0)]);}}async function _0x1630e9(){const _0x204848=_0x2b1222,_0x479c44=document['getElementById'](_0x204848(0x3cd)),_0x4a3ca8=document[_0x204848(0x1f4)](_0x204848(0xfaa));_0x4a3ca8['innerHTML']='';const _0x153bfe=Object[_0x204848(0x753)](_0x1ae02e['chats'])[_0x204848(0xede)](_0x43152a=>!_0x43152a['isGroup']),_0x1e5bcb=new Set(_0x1ae02e[_0x204848(0x12c0)]['doubanActiveCharacterIds']||[]);_0x153bfe[_0x204848(0x58a)]===0x0?_0x4a3ca8['innerHTML']=_0x204848(0xd53):_0x153bfe[_0x204848(0x59b)](_0x80c9a9=>{const _0x3881d7=_0x204848,_0xf20134=document[_0x3881d7(0x219)]('div');_0xf20134['className']='contact-picker-item',_0xf20134['innerHTML']=_0x3881d7(0x10ed)+_0x80c9a9['id']+'\x22\x20'+(_0x1e5bcb[_0x3881d7(0xe75)](_0x80c9a9['id'])?_0x3881d7(0xe56):'')+'\x20style=\x22margin-right:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+(_0x80c9a9[_0x3881d7(0x6a8)][_0x3881d7(0xc99)]||_0x5494d0)+_0x3881d7(0x7cc)+_0x80c9a9['name']+_0x3881d7(0x13c7),_0x4a3ca8['appendChild'](_0xf20134);}),_0x479c44[_0x204848(0x159b)]['add'](_0x204848(0xfca));}async function _0x404b82(){const _0x31abb7=_0x2b1222,_0x594d97=document[_0x31abb7(0x14bf)](_0x31abb7(0x117b)),_0x54151a=Array['from'](_0x594d97)[_0x31abb7(0x1431)](_0x2684c0=>_0x2684c0['dataset']['chatId']);_0x1ae02e[_0x31abb7(0x12c0)][_0x31abb7(0x7dc)]=_0x54151a,await _0x3df81a['globalSettings'][_0x31abb7(0x295)](_0x1ae02e['globalSettings']),document['getElementById'](_0x31abb7(0x3cd))[_0x31abb7(0x159b)][_0x31abb7(0xa9c)]('visible'),await _0x50c6f2();}document[_0x2b1222(0x1f4)](_0x2b1222(0x8c7))['addEventListener'](_0x2b1222(0x740),_0x1630e9),document[_0x2b1222(0x1f4)](_0x2b1222(0xbe0))['addEventListener'](_0x2b1222(0x740),()=>{const _0x2ba4b3=_0x2b1222;document[_0x2ba4b3(0x1f4)](_0x2ba4b3(0x3cd))[_0x2ba4b3(0x159b)]['remove'](_0x2ba4b3(0xfca));}),document[_0x2b1222(0x1f4)](_0x2b1222(0xb3a))[_0x2b1222(0x122b)](_0x2b1222(0x740),_0x404b82),document[_0x2b1222(0x1f4)](_0x2b1222(0xfaa))[_0x2b1222(0x122b)](_0x2b1222(0x740),_0x5ab7bb=>{const _0x1df91c=_0x2b1222,_0x3e4bca=_0x5ab7bb[_0x1df91c(0xb57)][_0x1df91c(0x96a)](_0x1df91c(0x96b));if(_0x3e4bca){const _0x3d0ad4=_0x3e4bca[_0x1df91c(0xeda)](_0x1df91c(0xfab));_0x3d0ad4&&_0x5ab7bb[_0x1df91c(0xb57)]!==_0x3d0ad4&&(_0x3d0ad4['checked']=!_0x3d0ad4[_0x1df91c(0xe56)]);}});async function _0xb8cc7a(_0x35279f){const _0x1b510e=_0x2b1222;if(!_0x35279f)return;const _0x3da724=await _0x109970(_0x1b510e(0xe2a),'这将用文件中的设置覆盖当前的所有外观设置（包括壁纸、图标、字体、CSS等）。确定要继续吗？',{'confirmText':_0x1b510e(0x1103)});if(!_0x3da724)return;try{const _0x4d8388=await _0x35279f[_0x1b510e(0x40f)](),_0xe076ed=JSON['parse'](_0x4d8388);if(!_0xe076ed[_0x1b510e(0xd23)]&&!_0xe076ed[_0x1b510e(0x359)]&&!_0xe076ed[_0x1b510e(0x69e)])throw new Error(_0x1b510e(0xba6));Object[_0x1b510e(0x102c)](_0x1ae02e['globalSettings'],_0xe076ed),await _0x3df81a[_0x1b510e(0x12c0)][_0x1b510e(0x295)](_0x1ae02e[_0x1b510e(0x12c0)]),_0x47f04e(),_0x3fbfc(),_0x57e1d4(),_0x50b88d(),_0x1807b6(_0x1ae02e[_0x1b510e(0x12c0)][_0x1b510e(0x359)]),_0x143b61(_0x1ae02e[_0x1b510e(0x12c0)][_0x1b510e(0xa4e)]),_0x496c6d(),_0x5556f9(),_0x1216fb(),await _0x1460c5(_0x1b510e(0x1159),_0x1b510e(0x101a));}catch(_0xf5531){console[_0x1b510e(0x127d)](_0x1b510e(0x12a2),_0xf5531),await _0x1460c5(_0x1b510e(0x15ca),_0x1b510e(0x37d)+_0xf5531[_0x1b510e(0x11f0)]);}}async function _0x5668d2(_0xb4a1fc){const _0x56aa79=_0x2b1222;console[_0x56aa79(0x57e)]('检测到应用离线了\x20'+_0xb4a1fc[_0x56aa79(0x24f)](0x1)+_0x56aa79(0xa8b));const _0x26bbfd=Object[_0x56aa79(0x753)](_0x1ae02e[_0x56aa79(0x589)])[_0x56aa79(0xede)](_0xf2df95=>!_0xf2df95[_0x56aa79(0xe83)]&&_0xf2df95[_0x56aa79(0x6a8)][_0x56aa79(0x605)]&&_0xf2df95[_0x56aa79(0x13ab)]?.['status']==='friend');if(_0x26bbfd[_0x56aa79(0x58a)]===0x0){console[_0x56aa79(0x57e)](_0x56aa79(0xa14));return;}for(const _0x51aec0 of _0x26bbfd){const _0x6c3115=_0x51aec0[_0x56aa79(0x6a8)][_0x56aa79(0xfa7)]||0xf,_0x3d7bcf=_0x51aec0[_0x56aa79(0x1ac)]?(Date['now']()-_0x51aec0[_0x56aa79(0x1ac)])/(0x3e8*0x3c):Infinity;_0xb4a1fc>_0x6c3115&&_0x3d7bcf>_0x6c3115&&(Math[_0x56aa79(0x13ae)]()<0.3&&(console[_0x56aa79(0x57e)](_0x56aa79(0x1501)+_0x51aec0[_0x56aa79(0x5d2)]+_0x56aa79(0x10f3)),Math[_0x56aa79(0x13ae)]()<0.7?await _0x48a288(_0x51aec0['id']):console[_0x56aa79(0x57e)]('角色\x20\x22'+_0x51aec0[_0x56aa79(0x5d2)]+_0x56aa79(0xde2))));}}function _0x166142(){const _0x5369f2=_0x2b1222;if(!_0x1ae02e[_0x5369f2(0x588)])return;const _0x226db9=_0x1ae02e[_0x5369f2(0x589)][_0x1ae02e['activeChatId']];document['getElementById'](_0x5369f2(0x123b))[_0x5369f2(0x107e)]='',document[_0x5369f2(0x1f4)]('date-search-input')[_0x5369f2(0x107e)]='',document['getElementById'](_0x5369f2(0xea4))[_0x5369f2(0xf21)]=_0x5369f2(0x1442),_0x2e53fa('search-history-screen');}async function _0x555a8d(){const _0x372373=_0x2b1222,_0x21d7c0=_0x1ae02e['chats'][_0x1ae02e['activeChatId']];if(!_0x21d7c0)return;const _0x5556da=document[_0x372373(0x1f4)](_0x372373(0x123b))[_0x372373(0x107e)][_0x372373(0x4a2)]()[_0x372373(0x1f7)](),_0x3bab20=document[_0x372373(0x1f4)](_0x372373(0xef3))['value'];if(!_0x5556da&&!_0x3bab20){alert(_0x372373(0x347));return;}let _0x49bfa5=_0x21d7c0[_0x372373(0xce3)][_0x372373(0xede)](_0x270279=>!_0x270279['isHidden']);_0x5556da&&(_0x49bfa5=_0x49bfa5[_0x372373(0xede)](_0x9b243c=>{const _0x3418df=_0x372373;let _0x5ddf8e='';if(typeof _0x9b243c[_0x3418df(0x128c)]===_0x3418df(0x6c3))_0x5ddf8e=_0x9b243c[_0x3418df(0x128c)];else{if(_0x9b243c['type']===_0x3418df(0xd83))_0x5ddf8e=_0x9b243c[_0x3418df(0x128c)];else{if(_0x9b243c[_0x3418df(0xcbd)]===_0x3418df(0xce9)||_0x9b243c[_0x3418df(0xcbd)]===_0x3418df(0xe86))_0x5ddf8e=_0x9b243c[_0x3418df(0x128c)];else{if(_0x9b243c[_0x3418df(0xcbd)]==='offline_text')_0x5ddf8e=(_0x9b243c[_0x3418df(0xdf2)]||'')+'\x20'+(_0x9b243c[_0x3418df(0xdec)]||'');else _0x9b243c['quote']&&(_0x5ddf8e=_0x9b243c[_0x3418df(0x128c)]);}}}return _0x5ddf8e[_0x3418df(0x1f7)]()['includes'](_0x5556da);}));if(_0x3bab20){const _0x51e962=new Date(_0x3bab20),_0x43cc47=new Date(_0x51e962[_0x372373(0xb3e)](0x0,0x0,0x0,0x0))['getTime'](),_0x470258=new Date(_0x51e962['setHours'](0x17,0x3b,0x3b,0x3e7))[_0x372373(0x457)]();_0x49bfa5=_0x49bfa5['filter'](_0x48dc8b=>_0x48dc8b['timestamp']>=_0x43cc47&&_0x48dc8b[_0x372373(0x1388)]<=_0x470258);}await _0x5ce0e1(_0x49bfa5);}async function _0x5ce0e1(_0x38ebd2){const _0x16d3d9=_0x2b1222,_0x71914d=document[_0x16d3d9(0x1f4)](_0x16d3d9(0xea4)),_0x1e5157=_0x1ae02e[_0x16d3d9(0x589)][_0x1ae02e[_0x16d3d9(0x588)]];_0x71914d[_0x16d3d9(0xf21)]='';if(_0x38ebd2[_0x16d3d9(0x58a)]===0x0){_0x71914d[_0x16d3d9(0xf21)]=_0x16d3d9(0xb7c);return;}let _0x58baa0='';for(const _0x7c3c2d of _0x38ebd2){const _0x1ed22d=new Date(_0x7c3c2d[_0x16d3d9(0x1388)]),_0x3ea28c=_0x1ed22d[_0x16d3d9(0x5c5)]();if(_0x3ea28c!==_0x58baa0){const _0x273a47=document[_0x16d3d9(0x219)](_0x16d3d9(0xaf9));_0x273a47['className']=_0x16d3d9(0xd44),_0x273a47[_0x16d3d9(0x231)]=_0x16d3d9(0x6a0)+_0x1ed22d['getFullYear']()+'年'+(_0x1ed22d[_0x16d3d9(0x45d)]()+0x1)+'月'+_0x1ed22d[_0x16d3d9(0x772)]()+_0x16d3d9(0x818),_0x71914d[_0x16d3d9(0x6ce)](_0x273a47),_0x58baa0=_0x3ea28c;}const _0x31153c=await _0x1c1dfa(_0x7c3c2d,_0x1e5157);_0x31153c&&(_0x31153c[_0x16d3d9(0x215)][_0x16d3d9(0x14cb)]=_0x16d3d9(0x9fa),_0x31153c[_0x16d3d9(0x122b)](_0x16d3d9(0x740),()=>_0x4e17c1(_0x7c3c2d['timestamp'])),_0x71914d[_0x16d3d9(0x6ce)](_0x31153c));}}async function _0x4e17c1(_0x18c8a7){const _0x2a7f4a=_0x2b1222,_0x20e86a=_0x1ae02e[_0x2a7f4a(0x588)];if(!_0x20e86a)return;_0x2e53fa(_0x2a7f4a(0x13c3)),setTimeout(async()=>{const _0x3559d2=_0x2a7f4a,_0x49b070=document[_0x3559d2(0x1f4)](_0x3559d2(0xd31)),_0x1bd735=_0x3559d2(0x85f)+_0x18c8a7+'\x22]';let _0x5300da=_0x49b070[_0x3559d2(0xeda)](_0x1bd735),_0x18eeaf=0x0;const _0x56285a=0x14;while(!_0x5300da&&_0x18eeaf<_0x56285a){const _0x38c6de=document[_0x3559d2(0x1f4)](_0x3559d2(0xf2a));if(_0x38c6de)console[_0x3559d2(0x57e)]('目标消息未找到,\x20正在加载更多历史记录...\x20(尝试\x20'+(_0x18eeaf+0x1)+')'),await _0x56ec48(),_0x5300da=_0x49b070[_0x3559d2(0xeda)](_0x1bd735),_0x18eeaf++;else break;}_0x165061(_0x18c8a7);},0xc8);}async function _0x1feb48(){const _0xbc0789=_0x2b1222;document[_0xbc0789(0x1f4)]('keyword-search-input')[_0xbc0789(0x107e)]='',document[_0xbc0789(0x1f4)](_0xbc0789(0xef3))[_0xbc0789(0x107e)]='',await _0x5ce0e1(_0x1ae02e[_0xbc0789(0x589)][_0x1ae02e[_0xbc0789(0x588)]][_0xbc0789(0xce3)]['filter'](_0x30f8f3=>!_0x30f8f3[_0xbc0789(0x58e)]));}async function _0x52ef67(_0x16ffe9=![],_0xe8074b=null,_0xd93441=null){const _0xa4ce07=_0x2b1222,_0x5bfcec=document[_0xa4ce07(0x1f4)](_0xa4ce07(0x1552)),_0xb4d46c=document[_0xa4ce07(0x1f4)]('my-frame-grid'),_0x20bbc8=_0x1ae02e[_0xa4ce07(0x589)][_0x1ae02e[_0xa4ce07(0x588)]];_0x5bfcec[_0xa4ce07(0xf21)]='',_0xb4d46c[_0xa4ce07(0xf21)]='';const _0x294093=await _0x3df81a['customAvatarFrames'][_0xa4ce07(0x27a)](),_0x2cba47=[..._0x5a4e4d,..._0x294093];document['querySelector']('#avatar-frame-modal\x20.frame-tabs')[_0xa4ce07(0x215)][_0xa4ce07(0x887)]=_0x16ffe9?_0xa4ce07(0x1b5):_0xa4ce07(0xeba),document[_0xa4ce07(0x1f4)](_0xa4ce07(0xd13))[_0xa4ce07(0x215)][_0xa4ce07(0x887)]=_0xa4ce07(0x361),document[_0xa4ce07(0x1f4)](_0xa4ce07(0x1e1))['style'][_0xa4ce07(0x887)]=_0xa4ce07(0x1b5),document['getElementById'](_0xa4ce07(0x2ea))[_0xa4ce07(0x159b)]['add'](_0xa4ce07(0x7cf)),document[_0xa4ce07(0x1f4)]('my-frame-tab')[_0xa4ce07(0x159b)][_0xa4ce07(0xa9c)]('active');if(_0x16ffe9)_0x2cba47[_0xa4ce07(0x59b)](_0x3c0801=>{const _0x524bbc=_0xa4ce07,_0x376ec4=_0x1c324b(_0x3c0801,'my',_0xe8074b);_0x3c0801[_0x524bbc(0x258)]===_0xd93441&&_0x376ec4[_0x524bbc(0x159b)][_0x524bbc(0x6a4)](_0x524bbc(0xc3e)),_0x5bfcec[_0x524bbc(0x6ce)](_0x376ec4);});else{const _0x44f0e2=_0x20bbc8[_0xa4ce07(0x6a8)][_0xa4ce07(0xc99)]||_0x5494d0,_0x447107=_0x20bbc8['settings'][_0xa4ce07(0x1207)]||(_0x20bbc8[_0xa4ce07(0xe83)]?_0x203a38:_0x5494d0);_0x2cba47[_0xa4ce07(0x59b)](_0x18e112=>{const _0x36cc8c=_0xa4ce07,_0x30faea=_0x1c324b(_0x18e112,'ai',_0x44f0e2);if(_0x18e112[_0x36cc8c(0x258)]===_0x4a1402['ai'])_0x30faea[_0x36cc8c(0x159b)][_0x36cc8c(0x6a4)]('selected');_0x5bfcec[_0x36cc8c(0x6ce)](_0x30faea);const _0x587ae0=_0x1c324b(_0x18e112,'my',_0x447107);if(_0x18e112[_0x36cc8c(0x258)]===_0x4a1402['my'])_0x587ae0[_0x36cc8c(0x159b)][_0x36cc8c(0x6a4)]('selected');_0xb4d46c[_0x36cc8c(0x6ce)](_0x587ae0);});}}function _0x1c324b(_0x3b3271,_0x8574a9,_0x1ba6c1){const _0x383df8=_0x2b1222,_0x4e3ae2=document[_0x383df8(0x219)](_0x383df8(0xaf9));_0x4e3ae2[_0x383df8(0x7c6)]=_0x383df8(0x60e),_0x4e3ae2[_0x383df8(0x746)][_0x383df8(0x1506)]=_0x3b3271['url'],_0x4e3ae2[_0x383df8(0x156f)]=_0x3b3271[_0x383df8(0x5d2)];const _0x33f729=typeof _0x3b3271['id']==='number',_0x3ee623=_0x33f729?'<button\x20class=\x22delete-btn\x22\x20data-id=\x22'+_0x3b3271['id']+_0x383df8(0x105f):'';return _0x4e3ae2[_0x383df8(0xf21)]=_0x383df8(0x20e)+_0x3ee623+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x1ba6c1+_0x383df8(0xd86)+(_0x3b3271[_0x383df8(0x258)]?_0x383df8(0xe40)+_0x3b3271['url']+_0x383df8(0x145e):'')+_0x383df8(0xbcb),_0x4e3ae2['addEventListener'](_0x383df8(0x740),_0x1eaa9e=>{const _0x46e29e=_0x383df8;if(_0x1eaa9e[_0x46e29e(0xb57)]['classList'][_0x46e29e(0xaea)]('delete-btn'))return;if(_0x41d472){if(_0x33f729){const _0x484fc1=parseInt(_0x3b3271['id']);_0x4e3ae2['classList'][_0x46e29e(0x1483)]('selected'),_0x578a04[_0x46e29e(0xe75)](_0x484fc1)?_0x578a04[_0x46e29e(0xc40)](_0x484fc1):_0x578a04[_0x46e29e(0x6a4)](_0x484fc1),_0x2f953b();}}else{_0x4a1402[_0x8574a9]=_0x3b3271[_0x46e29e(0x258)];const _0x3635ca=_0x8574a9==='ai'?document[_0x46e29e(0x1f4)](_0x46e29e(0x1552)):document[_0x46e29e(0x1f4)](_0x46e29e(0x34e));_0x3635ca[_0x46e29e(0x14bf)](_0x46e29e(0x761))[_0x46e29e(0x59b)](_0x4d02f5=>_0x4d02f5[_0x46e29e(0x159b)][_0x46e29e(0xa9c)](_0x46e29e(0xc3e))),_0x4e3ae2[_0x46e29e(0x159b)][_0x46e29e(0x6a4)](_0x46e29e(0xc3e));}}),_0x4e3ae2;}async function _0x3b63d6(){const _0x4cd5ec=_0x2b1222,_0x39bb45=document[_0x4cd5ec(0x1f4)](_0x4cd5ec(0xefe)),_0x58a124=await new Promise(_0x18a6d4=>{const _0x57c9f0=_0x4cd5ec,_0x3b8319=_0x1faffe=>{const _0x1e3c90=_0x475c;_0x18a6d4(_0x1faffe['target'][_0x1e3c90(0x8b1)][0x0]||null),_0x39bb45[_0x1e3c90(0x7f6)](_0x1e3c90(0x1147),_0x3b8319);};_0x39bb45[_0x57c9f0(0x122b)](_0x57c9f0(0x1147),_0x3b8319,{'once':!![]}),_0x39bb45[_0x57c9f0(0x740)]();});if(!_0x58a124)return;const _0x3a8fe2=await _0x11f6fb(_0x4cd5ec(0x3a2),_0x4cd5ec(0x1128));if(!_0x3a8fe2||!_0x3a8fe2[_0x4cd5ec(0x4a2)]())return;const _0xa86528=await new Promise(_0x23f9da=>{const _0x276eb2=_0x4cd5ec,_0x3f3b8e=new FileReader();_0x3f3b8e['onload']=()=>_0x23f9da(_0x3f3b8e[_0x276eb2(0xbc9)]),_0x3f3b8e[_0x276eb2(0x21e)](_0x58a124);});await _0x3df81a['customAvatarFrames'][_0x4cd5ec(0x6a4)]({'name':_0x3a8fe2['trim'](),'url':_0xa86528}),_0x52ef67(_0x37b6a9);}async function _0x5e51d1(){const _0x240bec=_0x2b1222,_0x46e267=_0x240bec(0x5d1),_0x10305c=await _0x11f6fb(_0x240bec(0x239),_0x240bec(0x153c),'','textarea','<p\x20style=\x22font-size:12px;color:#888;\x22>'+_0x46e267+'</p>');if(!_0x10305c||!_0x10305c['trim']())return;const _0xea84e2=_0x10305c[_0x240bec(0x4a2)]()[_0x240bec(0x23f)]('\x0a'),_0x15e2fe=[];let _0x3e1c1d=0x0;for(const _0x377ec1 of _0xea84e2){const _0x134be9=_0x377ec1[_0x240bec(0xba5)](/^(.+?)[:：]\s*(https?:\/\/.+)$/);if(_0x134be9)_0x15e2fe[_0x240bec(0x1426)]({'name':_0x134be9[0x1]['trim'](),'url':_0x134be9[0x2]['trim']()});else _0x377ec1['trim']()&&_0x3e1c1d++;}_0x15e2fe[_0x240bec(0x58a)]>0x0&&(await _0x3df81a[_0x240bec(0x1434)]['bulkAdd'](_0x15e2fe),_0x52ef67(_0x37b6a9),await _0x1460c5('导入成功','成功导入\x20'+_0x15e2fe[_0x240bec(0x58a)]+'\x20个新头像框！')),_0x3e1c1d>0x0&&await _0x1460c5(_0x240bec(0x11d9),'有\x20'+_0x3e1c1d+_0x240bec(0xd1d));}async function _0x3dce11(_0x25c6c9){const _0x467e07=_0x2b1222,_0x5328ce=await _0x3df81a[_0x467e07(0x1434)]['get'](_0x25c6c9);if(!_0x5328ce)return;const _0x3a16a8=await _0x109970(_0x467e07(0xed1),_0x467e07(0xffc)+_0x5328ce[_0x467e07(0x5d2)]+_0x467e07(0xbdf),{'confirmButtonClass':_0x467e07(0x1c6)});_0x3a16a8&&(await _0x3df81a[_0x467e07(0x1434)][_0x467e07(0xc40)](_0x25c6c9),_0x52ef67(_0x37b6a9));}let _0x1452a3=0x0;const _0x19179a=0x2;function _0x5002c7(){const _0x434401=_0x2b1222,_0x1b731c=document['getElementById'](_0x434401(0x11ac)),_0x254e5a=document[_0x434401(0x1f4)](_0x434401(0x190)),_0x2f9420=document['querySelectorAll'](_0x434401(0x3e6));let _0x5c33a6=0x0,_0x28738c=0x0,_0x41f061=0x0,_0x14778c=![],_0x307c61=!![];const _0x1f0c13=()=>{const _0x17370b=_0x434401;_0x254e5a[_0x17370b(0x215)]['transform']=_0x17370b(0xf38)+_0x1452a3*(0x64/_0x19179a)+'%)',_0x2f9420[_0x17370b(0x59b)]((_0x501bbf,_0xc60ef8)=>{const _0x3f7f31=_0x17370b;_0x501bbf[_0x3f7f31(0x159b)][_0x3f7f31(0x1483)](_0x3f7f31(0x7cf),_0xc60ef8===_0x1452a3);});},_0x162937=_0x1f8cdf=>{const _0xb3822e=_0x434401;_0x14778c=!![],_0x307c61=!![],_0x5c33a6=_0x1f8cdf[_0xb3822e(0xcbd)][_0xb3822e(0xe82)]('mouse')?_0x1f8cdf[_0xb3822e(0xe97)]:_0x1f8cdf[_0xb3822e(0xc92)][0x0][_0xb3822e(0xe97)],_0x28738c=_0x1f8cdf['type'][_0xb3822e(0xe82)](_0xb3822e(0x373))?_0x1f8cdf[_0xb3822e(0x857)]:_0x1f8cdf['touches'][0x0][_0xb3822e(0x857)],_0x254e5a['style'][_0xb3822e(0x4dc)]=_0xb3822e(0x1b5);},_0x59348f=_0x5ce017=>{const _0x329faa=_0x434401;if(!_0x14778c)return;const _0x5cd875=_0x5ce017[_0x329faa(0xcbd)]['includes'](_0x329faa(0x373))?_0x5ce017[_0x329faa(0x857)]:_0x5ce017[_0x329faa(0xc92)][0x0]['pageY'];_0x41f061=_0x5ce017[_0x329faa(0xcbd)][_0x329faa(0xe82)](_0x329faa(0x373))?_0x5ce017['pageX']:_0x5ce017[_0x329faa(0xc92)][0x0][_0x329faa(0xe97)];const _0x18a9e0=_0x41f061-_0x5c33a6,_0x5d0d94=_0x5cd875-_0x28738c;_0x307c61&&(Math[_0x329faa(0x151f)](_0x18a9e0)>0xa||Math[_0x329faa(0x151f)](_0x5d0d94)>0xa)&&(_0x307c61=![]);if(Math[_0x329faa(0x151f)](_0x18a9e0)>Math[_0x329faa(0x151f)](_0x5d0d94)){if(_0x5ce017['cancelable'])_0x5ce017[_0x329faa(0x32e)]();_0x254e5a[_0x329faa(0x215)]['transform']=_0x329faa(0x131c)+_0x1452a3*(0x64/_0x19179a)+'%\x20+\x20'+_0x18a9e0+_0x329faa(0x97b);}},_0x546c44=_0x425b5c=>{const _0x1e1883=_0x434401;if(!_0x14778c)return;_0x14778c=![],_0x254e5a[_0x1e1883(0x215)]['transition']=_0x1e1883(0xaeb);if(_0x307c61){_0x1f0c13();return;}const _0xdb356d=_0x41f061-_0x5c33a6;if(Math[_0x1e1883(0x151f)](_0xdb356d)>_0x1b731c[_0x1e1883(0x93a)]/0x4){if(_0xdb356d>0x0&&_0x1452a3>0x0)_0x1452a3--;else _0xdb356d<0x0&&_0x1452a3<_0x19179a-0x1&&_0x1452a3++;}_0x1f0c13();};_0x1b731c[_0x434401(0x122b)](_0x434401(0x103d),_0x162937),_0x1b731c[_0x434401(0x122b)](_0x434401(0xb7e),_0x59348f),_0x1b731c[_0x434401(0x122b)](_0x434401(0x3e4),_0x546c44),_0x1b731c[_0x434401(0x122b)](_0x434401(0x120f),_0x546c44),_0x1b731c[_0x434401(0x122b)](_0x434401(0x158c),_0x162937,{'passive':![]}),_0x1b731c[_0x434401(0x122b)](_0x434401(0xa92),_0x59348f,{'passive':![]}),_0x1b731c['addEventListener'](_0x434401(0x4f5),_0x546c44);}let _0x1ebabd=null;async function _0x4b4193(){const _0xf6b2aa=_0x2b1222;await _0x65b939(),_0x2e53fa(_0xf6b2aa(0x1215));}async function _0x65b939(){const _0x47b2e4=_0x2b1222,_0x4a331f=document['getElementById'](_0x47b2e4(0x11fc)),_0x5aa057=document[_0x47b2e4(0x1f4)](_0x47b2e4(0xf26));_0x4a331f[_0x47b2e4(0xf21)]='',_0x5aa057[_0x47b2e4(0xf21)]='';const [_0x4bfc16,_0x123989]=await Promise[_0x47b2e4(0x54b)]([_0x3df81a[_0x47b2e4(0xda0)][_0x47b2e4(0x27a)](),_0x3df81a[_0x47b2e4(0xb93)]['orderBy']('name')[_0x47b2e4(0x27a)]()]);_0x1ae02e[_0x47b2e4(0xda0)]=_0x4bfc16;if(_0x4bfc16[_0x47b2e4(0x58a)]===0x0){_0x5aa057[_0x47b2e4(0xf21)]='<p\x20style=\x22text-align:center;\x20color:\x20#8a8a8a;\x20margin-top:\x2050px;\x22>点击右上角\x20\x22+\x22\x20创建你的第一个预设</p>';return;}const _0x65ac81=document[_0x47b2e4(0x219)](_0x47b2e4(0xd2d));_0x65ac81['className']=_0x47b2e4(0x656),_0x65ac81[_0x47b2e4(0x231)]='全部',_0x65ac81[_0x47b2e4(0x746)]['categoryId']=_0x47b2e4(0x54b),_0x4a331f[_0x47b2e4(0x6ce)](_0x65ac81);const _0x31fea4=document[_0x47b2e4(0x219)](_0x47b2e4(0xaf9));_0x31fea4[_0x47b2e4(0x7c6)]='world-book-category-pane\x20active',_0x31fea4[_0x47b2e4(0x746)][_0x47b2e4(0x1467)]=_0x47b2e4(0x54b),_0x5aa057[_0x47b2e4(0x6ce)](_0x31fea4),_0x123989[_0x47b2e4(0x59b)](_0x4b5d7f=>{const _0x37b2ee=_0x47b2e4,_0x37f39f=document[_0x37b2ee(0x219)](_0x37b2ee(0xd2d));_0x37f39f[_0x37b2ee(0x7c6)]='world-book-tab',_0x37f39f[_0x37b2ee(0x231)]=_0x4b5d7f['name'],_0x37f39f[_0x37b2ee(0x746)][_0x37b2ee(0x1467)]=String(_0x4b5d7f['id']),_0x4a331f['appendChild'](_0x37f39f);const _0x5d5917=document['createElement'](_0x37b2ee(0xaf9));_0x5d5917[_0x37b2ee(0x7c6)]=_0x37b2ee(0x15a4),_0x5d5917[_0x37b2ee(0x746)][_0x37b2ee(0x1467)]=String(_0x4b5d7f['id']),_0x5aa057[_0x37b2ee(0x6ce)](_0x5d5917);});const _0x552006=_0x4bfc16[_0x47b2e4(0x690)](_0x5d181f=>!_0x5d181f[_0x47b2e4(0x1467)]);if(_0x552006){const _0x4d4928=document[_0x47b2e4(0x219)](_0x47b2e4(0xd2d));_0x4d4928['className']=_0x47b2e4(0xab0),_0x4d4928['textContent']=_0x47b2e4(0x13d0),_0x4d4928[_0x47b2e4(0x746)][_0x47b2e4(0x1467)]=_0x47b2e4(0x139e),_0x4a331f[_0x47b2e4(0x6ce)](_0x4d4928);const _0x25d212=document[_0x47b2e4(0x219)](_0x47b2e4(0xaf9));_0x25d212[_0x47b2e4(0x7c6)]=_0x47b2e4(0x15a4),_0x25d212[_0x47b2e4(0x746)][_0x47b2e4(0x1467)]=_0x47b2e4(0x139e),_0x5aa057[_0x47b2e4(0x6ce)](_0x25d212);}_0x4bfc16['forEach'](_0x1203d5=>{const _0x3a9b58=_0x47b2e4,_0x38340f=_0x3a9b58(0x6bd)+_0x1203d5[_0x3a9b58(0x128c)]['length']+'\x20个条目。',_0x46b707=document[_0x3a9b58(0x219)]('div');_0x46b707[_0x3a9b58(0x7c6)]=_0x3a9b58(0x1464),_0x46b707[_0x3a9b58(0xf21)]=_0x3a9b58(0xaa1)+_0x1203d5['name']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-content-preview\x22>'+_0x38340f+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';const _0x277b39=()=>_0x2e4d29(_0x1203d5['id']),_0x248473=async()=>{const _0x52afaa=_0x3a9b58,_0x5461ec=await _0x109970('删除预设','确定要删除《'+_0x1203d5[_0x52afaa(0x5d2)]+_0x52afaa(0x14d8),{'confirmButtonClass':'btn-danger'});_0x5461ec&&(await _0x3df81a['presets'][_0x52afaa(0xc40)](_0x1203d5['id']),_0x1ae02e['presets']=await _0x3df81a[_0x52afaa(0xda0)][_0x52afaa(0x27a)](),_0x65b939());};_0x46b707[_0x3a9b58(0x122b)](_0x3a9b58(0x740),_0x277b39),_0x1160f3(_0x46b707,_0x248473);const _0x1a785b=_0x46b707[_0x3a9b58(0xf44)](!![]);_0x1a785b[_0x3a9b58(0x122b)]('click',_0x277b39),_0x1160f3(_0x1a785b,_0x248473),_0x31fea4[_0x3a9b58(0x6ce)](_0x1a785b);const _0x197598=_0x1203d5[_0x3a9b58(0x1467)]?String(_0x1203d5[_0x3a9b58(0x1467)]):'uncategorized',_0x2405df=_0x5aa057[_0x3a9b58(0xeda)](_0x3a9b58(0x1373)+_0x197598+'\x22]');_0x2405df&&_0x2405df['appendChild'](_0x46b707);}),document[_0x47b2e4(0x14bf)](_0x47b2e4(0x99c))[_0x47b2e4(0x59b)](_0x1f9a5b=>{const _0x489938=_0x47b2e4;_0x1f9a5b[_0x489938(0x122b)]('click',()=>_0x2744ce(_0x1f9a5b[_0x489938(0x746)][_0x489938(0x1467)]));});}function _0x2744ce(_0x384933){const _0x3b0904=_0x2b1222;document[_0x3b0904(0x14bf)](_0x3b0904(0x99c))[_0x3b0904(0x59b)](_0x2006dd=>{const _0x5816bd=_0x3b0904;_0x2006dd[_0x5816bd(0x159b)][_0x5816bd(0x1483)](_0x5816bd(0x7cf),_0x2006dd['dataset'][_0x5816bd(0x1467)]===_0x384933);}),document['querySelectorAll'](_0x3b0904(0xc60))[_0x3b0904(0x59b)](_0x57f9c1=>{const _0x55d7c0=_0x3b0904;_0x57f9c1[_0x55d7c0(0x159b)][_0x55d7c0(0x1483)](_0x55d7c0(0x7cf),_0x57f9c1[_0x55d7c0(0x746)][_0x55d7c0(0x1467)]===_0x384933);});}async function _0x2e4d29(_0x1903c9){const _0x3a75a8=_0x2b1222;_0x2e53fa(_0x3a75a8(0xcd6)),_0x1ebabd=_0x1903c9;try{const [_0x4802fa,_0x50f011]=await Promise['all']([_0x3df81a[_0x3a75a8(0xda0)][_0x3a75a8(0x13f8)](_0x1903c9),_0x3df81a[_0x3a75a8(0xb93)][_0x3a75a8(0x27a)]()]);if(!_0x4802fa){console[_0x3a75a8(0x127d)]('错误：尝试打开一个不存在的预设，ID:',_0x1903c9),await _0x1460c5(_0x3a75a8(0x57f),_0x3a75a8(0xe96)),_0x2e53fa(_0x3a75a8(0x1215));return;}setTimeout(()=>{const _0x28748e=_0x3a75a8;document['getElementById'](_0x28748e(0x12b3))[_0x28748e(0x231)]=_0x4802fa[_0x28748e(0x5d2)],document[_0x28748e(0x1f4)](_0x28748e(0x37e))[_0x28748e(0x107e)]=_0x4802fa[_0x28748e(0x5d2)];const _0x24bf18=document['getElementById'](_0x28748e(0x10cf));_0x24bf18[_0x28748e(0xf21)]='<option\x20value=\x22\x22>--\x20未分类\x20--</option>',_0x50f011['forEach'](_0x1d01a4=>{const _0x2edd18=_0x28748e,_0xbd2397=document['createElement'](_0x2edd18(0x10bb));_0xbd2397[_0x2edd18(0x107e)]=_0x1d01a4['id'],_0xbd2397[_0x2edd18(0x231)]=_0x1d01a4[_0x2edd18(0x5d2)];if(_0x4802fa[_0x2edd18(0x1467)]===_0x1d01a4['id'])_0xbd2397[_0x2edd18(0xc3e)]=!![];_0x24bf18[_0x2edd18(0x6ce)](_0xbd2397);});const _0x36bbf2=document[_0x28748e(0x1f4)](_0x28748e(0xdd6));_0x36bbf2[_0x28748e(0xf21)]='',Array[_0x28748e(0x121f)](_0x4802fa[_0x28748e(0x128c)])&&_0x4802fa[_0x28748e(0x128c)][_0x28748e(0x58a)]>0x0?_0x4802fa[_0x28748e(0x128c)][_0x28748e(0x59b)](_0xb3f3=>{const _0x563a7b=_0x1f43ec(_0xb3f3);_0x36bbf2['appendChild'](_0x563a7b);}):_0x36bbf2[_0x28748e(0xf21)]=_0x28748e(0xd08);},0x32);}catch(_0x4d78d7){console['error'](_0x3a75a8(0x7b3),_0x4d78d7),await _0x1460c5('加载失败',_0x3a75a8(0xd4f)+_0x4d78d7[_0x3a75a8(0x11f0)]),_0x2e53fa('preset-screen');}}function _0x1f43ec(_0x4c216d={'keys':[],'comment':'','content':'','enabled':!![]}){const _0x4264ea=_0x2b1222,_0x33a4f9=document[_0x4264ea(0x219)]('div');_0x33a4f9[_0x4264ea(0x7c6)]=_0x4264ea(0x578);const _0x1cc238=_0x4c216d[_0x4264ea(0x1368)]!==![]?_0x4264ea(0xe56):'';_0x33a4f9[_0x4264ea(0xf21)]=_0x4264ea(0x7a0)+_0x1cc238+_0x4264ea(0xa54)+(_0x4c216d[_0x4264ea(0x306)]||'')+_0x4264ea(0xfac)+(_0x4c216d['keys']||[])['join'](',\x20')+_0x4264ea(0xb50)+(_0x4c216d[_0x4264ea(0x128c)]||'')+_0x4264ea(0x1289),_0x33a4f9['querySelector'](_0x4264ea(0x44f))['addEventListener'](_0x4264ea(0x740),()=>_0x33a4f9['remove']());const _0x400113=_0x33a4f9[_0x4264ea(0xeda)](_0x4264ea(0x4e6)),_0x16b8de=_0x33a4f9[_0x4264ea(0xeda)]('.entry-content-container');return _0x400113[_0x4264ea(0x122b)](_0x4264ea(0x740),()=>{const _0x3c211d=_0x4264ea,_0x322975=_0x16b8de['style'][_0x3c211d(0x887)]===_0x3c211d(0x1b5);_0x16b8de[_0x3c211d(0x215)][_0x3c211d(0x887)]=_0x322975?_0x3c211d(0x361):'none',_0x400113[_0x3c211d(0x231)]=_0x322975?'收起':'展开';}),_0x33a4f9;}async function _0x58bd3d(){const _0x1cc473=_0x2b1222;await _0x2775f2(),document['querySelector']('#group-management-modal\x20.modal-header\x20span')[_0x1cc473(0x231)]=_0x1cc473(0x13dc),document[_0x1cc473(0x1f4)](_0x1cc473(0xa3e))[_0x1cc473(0x1199)]=_0x188cf0,document['getElementById'](_0x1cc473(0x14c0))[_0x1cc473(0x1199)]=_0x1c209e=>{const _0x200615=_0x1cc473;_0x1c209e['target'][_0x200615(0x159b)][_0x200615(0xaea)](_0x200615(0x2f5))&&_0x2a4e31(parseInt(_0x1c209e['target'][_0x200615(0x746)]['id']));},document['getElementById'](_0x1cc473(0x254))[_0x1cc473(0x1199)]=()=>{const _0xb7a392=_0x1cc473;document[_0xb7a392(0x1f4)](_0xb7a392(0x1033))[_0xb7a392(0x159b)]['remove']('visible'),_0x65b939();},document[_0x1cc473(0x1f4)](_0x1cc473(0x1033))[_0x1cc473(0x159b)][_0x1cc473(0x6a4)](_0x1cc473(0xfca));}async function _0x2775f2(){const _0x53025e=_0x2b1222,_0x240cc2=document[_0x53025e(0x1f4)](_0x53025e(0x14c0)),_0x4ab936=await _0x3df81a[_0x53025e(0xb93)]['toArray']();_0x240cc2[_0x53025e(0xf21)]='',_0x4ab936['length']===0x0&&(_0x240cc2[_0x53025e(0xf21)]='<p\x20style=\x22text-align:\x20center;\x20color:\x20var(--text-secondary);\x22>还没有任何分类</p>'),_0x4ab936[_0x53025e(0x59b)](_0x5d0ef8=>{const _0x39cdf4=_0x53025e,_0x120d16=document[_0x39cdf4(0x219)](_0x39cdf4(0xaf9));_0x120d16[_0x39cdf4(0x7c6)]=_0x39cdf4(0xd18),_0x120d16[_0x39cdf4(0xf21)]=_0x39cdf4(0x355)+_0x5d0ef8[_0x39cdf4(0x5d2)]+_0x39cdf4(0xd71)+_0x5d0ef8['id']+_0x39cdf4(0x4a8),_0x240cc2[_0x39cdf4(0x6ce)](_0x120d16);});}async function _0x188cf0(){const _0x492844=_0x2b1222,_0x342873=document['getElementById'](_0x492844(0x937)),_0xea054d=_0x342873[_0x492844(0x107e)][_0x492844(0x4a2)]();if(!_0xea054d)return alert('分类名不能为空！');const _0x155165=await _0x3df81a[_0x492844(0xb93)][_0x492844(0x478)](_0x492844(0x5d2))['equals'](_0xea054d)[_0x492844(0x9a8)]();if(_0x155165)return alert('分类\x20\x22'+_0xea054d+_0x492844(0xf6a));await _0x3df81a['presetCategories'][_0x492844(0x6a4)]({'name':_0xea054d}),_0x342873[_0x492844(0x107e)]='',await _0x2775f2();}async function _0x2a4e31(_0x2e23b7){const _0x188665=_0x2b1222,_0x44023c=await _0x109970(_0x188665(0xed1),_0x188665(0x2f6),{'confirmButtonClass':_0x188665(0x1c6)});_0x44023c&&(await _0x3df81a['presetCategories'][_0x188665(0xc40)](_0x2e23b7),await _0x3df81a['presets'][_0x188665(0x478)](_0x188665(0x1467))['equals'](_0x2e23b7)[_0x188665(0x1064)]({'categoryId':null}),_0x1ae02e[_0x188665(0xda0)]=await _0x3df81a[_0x188665(0xda0)]['toArray'](),await _0x2775f2());}async function _0x52f6c3(_0x3a8185){const _0x3adfdb=_0x2b1222,_0xf993da=_0x3a8185[_0x3adfdb(0xb57)][_0x3adfdb(0x8b1)][0x0];if(!_0xf993da)return;try{if(!_0xf993da[_0x3adfdb(0x5d2)][_0x3adfdb(0x324)]('.json'))throw new Error('文件格式不支持。请选择\x20.json\x20格式的\x20Tavern\x20预设文件。');const _0x4b286b=await _0xf993da['text'](),_0x4511c7=JSON[_0x3adfdb(0x129c)](_0x4b286b);await _0x5c6923(_0x4511c7,_0xf993da[_0x3adfdb(0x5d2)]);}catch(_0x1ad065){console[_0x3adfdb(0x127d)]('预设导入失败:',_0x1ad065),await _0x1460c5(_0x3adfdb(0x15ca),_0x3adfdb(0x69c)+_0x1ad065[_0x3adfdb(0x11f0)]);}finally{_0x3a8185['target'][_0x3adfdb(0x107e)]=null;}}async function _0x5c6923(_0xb5dfd1,_0x264938){const _0x2a735d=_0x2b1222;let _0xc6fd43=[];if(Array[_0x2a735d(0x121f)](_0xb5dfd1[_0x2a735d(0x6b5)])&&Array['isArray'](_0xb5dfd1['prompt_order'])&&_0xb5dfd1[_0x2a735d(0x11d2)][_0x2a735d(0x58a)]>0x0){console['log'](_0x2a735d(0xf9c));const _0x45b494=new Map(_0xb5dfd1[_0x2a735d(0x6b5)]['map'](_0x172e62=>[_0x172e62[_0x2a735d(0x1305)],_0x172e62])),_0x36b9b1=_0xb5dfd1[_0x2a735d(0x11d2)][_0x2a735d(0x7b6)]((_0x2d31ae,_0x1d5410)=>_0x1d5410[_0x2a735d(0x249)]&&_0x1d5410[_0x2a735d(0x249)][_0x2a735d(0x58a)]>(_0x2d31ae[_0x2a735d(0x58a)]||0x0)?_0x1d5410[_0x2a735d(0x249)]:_0x2d31ae,[]);_0x36b9b1&&_0x36b9b1[_0x2a735d(0x58a)]>0x0&&(_0xc6fd43=_0x36b9b1[_0x2a735d(0x1431)](_0x539dab=>{const _0x11895c=_0x2a735d,_0x159b10=_0x45b494['get'](_0x539dab[_0x11895c(0x1305)]);if(_0x159b10)return{'keys':[],'comment':_0x159b10[_0x11895c(0x5d2)]||'无标题','content':_0x159b10['content']||'','enabled':_0x539dab[_0x11895c(0x1368)]};return null;})[_0x2a735d(0xede)](Boolean));}else{if(_0xb5dfd1[_0x2a735d(0xd20)]&&typeof _0xb5dfd1[_0x2a735d(0xd20)]===_0x2a735d(0xcc5))console[_0x2a735d(0x57e)](_0x2a735d(0x1275)),Array[_0x2a735d(0x121f)](_0xb5dfd1[_0x2a735d(0x249)])?(console['log'](_0x2a735d(0xde6)),_0xc6fd43=_0xb5dfd1['order'][_0x2a735d(0x1431)](_0x2d13b9=>_0xb5dfd1[_0x2a735d(0xd20)][_0x2d13b9])[_0x2a735d(0xede)](Boolean)[_0x2a735d(0x1431)](_0x12b539=>({'keys':_0x12b539[_0x2a735d(0x1505)]||[],'comment':_0x12b539['comment']||_0x2a735d(0x286),'content':_0x12b539[_0x2a735d(0x128c)]||'','enabled':!_0x12b539[_0x2a735d(0x12a1)]}))):(console[_0x2a735d(0xb3b)]('未在文件中找到\x20\x27order\x27\x20字段，条目可能无法按原始顺序导入。'),_0xc6fd43=Object['values'](_0xb5dfd1[_0x2a735d(0xd20)])['map'](_0x918edb=>({'keys':_0x918edb[_0x2a735d(0x1505)]||[],'comment':_0x918edb[_0x2a735d(0x306)]||_0x2a735d(0x286),'content':_0x918edb[_0x2a735d(0x128c)]||'','enabled':!_0x918edb[_0x2a735d(0x12a1)]})));else{if(Array[_0x2a735d(0x121f)](_0xb5dfd1['prompts']))console[_0x2a735d(0x57e)]('检测到简单的\x20\x27prompts\x27\x20数组格式，将按数组内顺序导入。'),_0xc6fd43=_0xb5dfd1['prompts'][_0x2a735d(0x1431)](_0x11e5e6=>({'keys':[],'comment':_0x11e5e6[_0x2a735d(0x5d2)]||_0x2a735d(0x5e0),'content':_0x11e5e6[_0x2a735d(0x128c)]||'','enabled':!![]}));else throw new Error('文件格式无法识别。未找到有效的\x20\x27prompts\x27\x20数组或\x20\x27entries\x27\x20对象。');}}_0xc6fd43=_0xc6fd43[_0x2a735d(0xede)](_0xbf9027=>_0xbf9027[_0x2a735d(0x128c)]);if(_0xc6fd43[_0x2a735d(0x58a)]===0x0){alert(_0x2a735d(0x1201));return;}const _0x562746=_0x264938[_0x2a735d(0xef0)](/\.json$/i,''),_0x312055=await _0x11f6fb(_0x2a735d(0xbdb),_0x2a735d(0x3e2),_0x562746);if(!_0x312055||!_0x312055['trim']()){alert(_0x2a735d(0x119d));return;}const _0x1befe0={'id':_0x2a735d(0x511)+Date[_0x2a735d(0xd6e)](),'name':_0x312055[_0x2a735d(0x4a2)](),'content':_0xc6fd43,'categoryId':null};await _0x3df81a['presets'][_0x2a735d(0x6a4)](_0x1befe0),_0x1ae02e['presets'][_0x2a735d(0x1426)](_0x1befe0),await _0x65b939(),await _0x1460c5(_0x2a735d(0x3f1),_0x2a735d(0xf4c)+_0x312055+'》。');}async function _0x51f0fc(_0x29133b){const _0x1d9a33=_0x2b1222,_0x47d386=document['getElementById'](_0x1d9a33(0x76b));if(!_0x47d386)return;const _0x39eebb=_0x1ae02e[_0x1d9a33(0xda0)]||[];_0x47d386[_0x1d9a33(0xf21)]=_0x1d9a33(0x117a),_0x39eebb['forEach'](_0x207d79=>{const _0x4de277=_0x1d9a33,_0x18d2fe=document['createElement'](_0x4de277(0x10bb));_0x18d2fe['value']=_0x207d79['id'],_0x18d2fe[_0x4de277(0x231)]=_0x207d79[_0x4de277(0x5d2)],_0x47d386[_0x4de277(0x6ce)](_0x18d2fe);}),_0x29133b[_0x1d9a33(0x6a8)][_0x1d9a33(0x715)]&&(_0x47d386[_0x1d9a33(0x107e)]=_0x29133b[_0x1d9a33(0x6a8)]['offlinePresetId']);}function _0xbfb63d(){const _0x4a465c=_0x2b1222,_0x5ef5a6=document[_0x4a465c(0x1f4)](_0x4a465c(0xf6e));if(!_0x5ef5a6)return;_0x5ef5a6[_0x4a465c(0xf21)]='';let _0xc82892=_0x1ae02e['globalSettings'][_0x4a465c(0x2ad)]||_0x3498aa;_0xc82892[_0x4a465c(0x59b)](_0x56c5b6=>{const _0x2d56a2=_0x4a465c,_0x32461d=document['getElementById'](_0x56c5b6);if(_0x32461d){const _0x518c48=document[_0x2d56a2(0x219)]('div');_0x518c48[_0x2d56a2(0x7c6)]=_0x2d56a2(0x4e9),_0x518c48[_0x2d56a2(0x60f)]=!![],_0x518c48[_0x2d56a2(0x746)][_0x2d56a2(0xbb2)]=_0x56c5b6,_0x518c48[_0x2d56a2(0xf21)]=_0x32461d['innerHTML'],_0x5ef5a6[_0x2d56a2(0x6ce)](_0x518c48);}});}function _0x141f40(){const _0x767a55=_0x2b1222,_0x5ddfe9=document[_0x767a55(0x1f4)](_0x767a55(0xf6e));if(!_0x5ddfe9)return;let _0x3323e2=null;const _0x50d839=_0x196fc6=>{const _0x5ce61e=_0x767a55,_0xbbcd9c=_0x196fc6[_0x5ce61e(0xb57)][_0x5ce61e(0x96a)]('.draggable-button-item');if(!_0xbbcd9c)return;_0x3323e2=_0xbbcd9c,_0x3323e2[_0x5ce61e(0x159b)][_0x5ce61e(0x6a4)](_0x5ce61e(0x4b9));if(_0x196fc6[_0x5ce61e(0x260)])_0x196fc6['preventDefault']();},_0x21b334=_0x141d61=>{const _0x2a251f=_0x767a55;if(!_0x3323e2)return;const _0x57f4ff=_0x141d61[_0x2a251f(0xcbd)][_0x2a251f(0xe82)](_0x2a251f(0x373))?_0x141d61['clientX']:_0x141d61['touches'][0x0][_0x2a251f(0x1476)],_0x451ab4=_0x1cf080(_0x5ddfe9,_0x57f4ff);_0x451ab4==null?_0x5ddfe9[_0x2a251f(0x6ce)](_0x3323e2):_0x5ddfe9[_0x2a251f(0xa69)](_0x3323e2,_0x451ab4);},_0x419144=()=>{const _0x335557=_0x767a55;if(!_0x3323e2)return;_0x3323e2['classList'][_0x335557(0xa9c)](_0x335557(0x4b9)),_0x3323e2=null,_0xb58124();};_0x5ddfe9['addEventListener'](_0x767a55(0x103d),_0x50d839),_0x5ddfe9['addEventListener'](_0x767a55(0x158c),_0x50d839,{'passive':![]}),_0x5ddfe9['addEventListener']('mousemove',_0x21b334),_0x5ddfe9[_0x767a55(0x122b)](_0x767a55(0xa92),_0x21b334,{'passive':![]}),_0x5ddfe9[_0x767a55(0x122b)](_0x767a55(0x3e4),_0x419144),_0x5ddfe9[_0x767a55(0x122b)](_0x767a55(0x120f),_0x419144),_0x5ddfe9[_0x767a55(0x122b)](_0x767a55(0x4f5),_0x419144);}function _0x1cf080(_0x476860,_0x897eac){const _0x4f511c=_0x2b1222,_0x20ef3b=[..._0x476860['querySelectorAll'](_0x4f511c(0xd54))];return _0x20ef3b[_0x4f511c(0x7b6)]((_0x43dee0,_0x7330a9)=>{const _0x14f4bc=_0x4f511c,_0x1792db=_0x7330a9[_0x14f4bc(0x6cc)](),_0x5980e5=_0x897eac-_0x1792db[_0x14f4bc(0xbe7)]-_0x1792db[_0x14f4bc(0x4cb)]/0x2;return _0x5980e5<0x0&&_0x5980e5>_0x43dee0[_0x14f4bc(0x10e8)]?{'offset':_0x5980e5,'element':_0x7330a9}:_0x43dee0;},{'offset':Number[_0x4f511c(0xe0c)]})[_0x4f511c(0x5e6)];}async function _0xb58124(){const _0x2b8ac4=_0x2b1222,_0x28e0e3=document[_0x2b8ac4(0x1f4)](_0x2b8ac4(0xf6e)),_0x14f28c=Array[_0x2b8ac4(0xa81)](_0x28e0e3[_0x2b8ac4(0x14bf)]('.draggable-button-item'))[_0x2b8ac4(0x1431)](_0x481874=>_0x481874[_0x2b8ac4(0x746)][_0x2b8ac4(0xbb2)]);_0x1ae02e['globalSettings'][_0x2b8ac4(0x2ad)]=_0x14f28c,await _0x3df81a[_0x2b8ac4(0x12c0)]['put'](_0x1ae02e['globalSettings']);}function _0x26e5ff(){const _0x3155d4=_0x2b1222,_0x2e2ebe=_0x1ae02e[_0x3155d4(0x12c0)][_0x3155d4(0x2ad)];if(!_0x2e2ebe||!Array[_0x3155d4(0x121f)](_0x2e2ebe)||_0x2e2ebe['length']===0x0)return;const _0xc86c02=document[_0x3155d4(0x1f4)]('chat-input-actions-top');if(!_0xc86c02)return;_0x2e2ebe['forEach'](_0x3a159d=>{const _0x5e8d33=_0x3155d4,_0xc08461=document[_0x5e8d33(0x1f4)](_0x3a159d);_0xc08461&&_0xc86c02['appendChild'](_0xc08461);});}const _0x3498aa=[_0x2b1222(0x154c),'send-photo-btn','upload-image-btn',_0x2b1222(0xfe4),_0x2b1222(0x9d5),_0x2b1222(0x748),_0x2b1222(0xade),_0x2b1222(0x1547),_0x2b1222(0x1536),_0x2b1222(0x5be),_0x2b1222(0x10a3),_0x2b1222(0x536),_0x2b1222(0x1410),_0x2b1222(0xfee),_0x2b1222(0x19f),_0x2b1222(0x4f9),_0x2b1222(0xd92),'show-announcement-board-btn',_0x2b1222(0x3ad),'read-together-btn',_0x2b1222(0x1326)];async function _0xa1ee24(){const _0x45006e=_0x2b1222;_0x1ae02e['globalSettings'][_0x45006e(0x2ad)]=null,await _0x3df81a[_0x45006e(0x12c0)]['put'](_0x1ae02e[_0x45006e(0x12c0)]),_0xbfb63d(),_0x26e5ff(),await _0x1460c5('成功',_0x45006e(0xeb2));}let _0x2f1426=[],_0x1f99e5=[];function _0x513328(){const _0xbee4b6=_0x2b1222,_0x20c40a=document['getElementById']('data-clear-wizard-modal');_0x2f1426=[],_0x1f99e5=[],_0x4bf86a(),document[_0xbee4b6(0x1f4)](_0xbee4b6(0x1a7))['style'][_0xbee4b6(0x887)]='flex',document[_0xbee4b6(0x1f4)](_0xbee4b6(0x124c))[_0xbee4b6(0x215)][_0xbee4b6(0x887)]=_0xbee4b6(0x1b5),_0x20c40a[_0xbee4b6(0x159b)][_0xbee4b6(0x6a4)](_0xbee4b6(0xfca));}function _0x4bf86a(){const _0x4ea92d=_0x2b1222,_0x184de0=document[_0x4ea92d(0x1f4)](_0x4ea92d(0x81b));_0x184de0[_0x4ea92d(0xf21)]='';const _0x238cb2=document[_0x4ea92d(0x219)](_0x4ea92d(0xaf9));_0x238cb2[_0x4ea92d(0x7c6)]=_0x4ea92d(0x151a),_0x238cb2[_0x4ea92d(0x746)][_0x4ea92d(0x507)]=_0x4ea92d(0x860),_0x238cb2[_0x4ea92d(0xf21)]=_0x4ea92d(0xc67)+(_0x1ae02e[_0x4ea92d(0x11ef)][_0x4ea92d(0xb46)]||'我')+_0x4ea92d(0xbb1),_0x184de0['appendChild'](_0x238cb2),Object[_0x4ea92d(0x753)](_0x1ae02e['chats'])[_0x4ea92d(0x59b)](_0x3cd9a7=>{const _0x4cc970=_0x4ea92d;if(!_0x3cd9a7[_0x4cc970(0xe83)]){const _0x2ab6c2=document[_0x4cc970(0x219)]('div');_0x2ab6c2[_0x4cc970(0x7c6)]=_0x4cc970(0x151a),_0x2ab6c2['dataset'][_0x4cc970(0x507)]=_0x3cd9a7['id'],_0x2ab6c2[_0x4cc970(0xf21)]=_0x4cc970(0x5c4)+_0x3cd9a7[_0x4cc970(0x5d2)]+_0x4cc970(0x10c1),_0x184de0[_0x4cc970(0x6ce)](_0x2ab6c2);}});}function _0x49f956(){const _0x5ba1ad=_0x2b1222,_0x2c0fad=document[_0x5ba1ad(0x1f4)]('data-clear-type-list');_0x2c0fad[_0x5ba1ad(0xf21)]='';const _0x23f0aa=[{'id':_0x5ba1ad(0x21a),'name':_0x5ba1ad(0x2a6),'description':'将清空选定角色的所有对话消息、曾用备注和你的昵称。'},{'id':_0x5ba1ad(0x10bf),'name':'动态与互动','description':_0x5ba1ad(0x3ff)},{'id':_0x5ba1ad(0x111c),'name':'通话记录','description':_0x5ba1ad(0x138d)},{'id':_0x5ba1ad(0x11a6),'name':'心声','description':_0x5ba1ad(0x14df)},{'id':'memories','name':_0x5ba1ad(0x7d8),'description':'将清空选定角色的所有长期记忆。'},{'id':_0x5ba1ad(0xbeb),'name':'收藏','description':_0x5ba1ad(0xa24)},{'id':_0x5ba1ad(0x7c9),'name':'Cphone数据\x20(CPhone)','description':_0x5ba1ad(0x11e4)}];_0x23f0aa['forEach'](_0x52c32c=>{const _0x525bee=_0x5ba1ad,_0x3796d3=document[_0x525bee(0x219)](_0x525bee(0xaf9));_0x3796d3['className']=_0x525bee(0x151a),_0x3796d3[_0x525bee(0x746)][_0x525bee(0x705)]=_0x52c32c['id'],_0x3796d3['innerHTML']=_0x525bee(0xe8b)+_0x52c32c['name']+_0x525bee(0x468)+_0x52c32c[_0x525bee(0xdec)]+_0x525bee(0xc14),_0x2c0fad[_0x525bee(0x6ce)](_0x3796d3);});}function _0xfad803(){const _0x149277=_0x2b1222,_0x3b6fce=document['querySelectorAll'](_0x149277(0xf5c));if(_0x3b6fce[_0x149277(0x58a)]===0x0){alert(_0x149277(0x119c));return;}_0x2f1426=Array[_0x149277(0xa81)](_0x3b6fce)[_0x149277(0x1431)](_0x2ebf9a=>_0x2ebf9a[_0x149277(0x746)][_0x149277(0x507)]),_0x49f956(),document[_0x149277(0x1f4)](_0x149277(0x1a7))[_0x149277(0x215)][_0x149277(0x887)]=_0x149277(0x1b5),document[_0x149277(0x1f4)](_0x149277(0x124c))[_0x149277(0x215)]['display']=_0x149277(0xeba);}function _0x41003b(){const _0x8ad183=_0x2b1222;document['getElementById'](_0x8ad183(0x124c))['style'][_0x8ad183(0x887)]=_0x8ad183(0x1b5),document[_0x8ad183(0x1f4)](_0x8ad183(0x1a7))[_0x8ad183(0x215)][_0x8ad183(0x887)]='flex',document[_0x8ad183(0x14bf)](_0x8ad183(0xdf9))[_0x8ad183(0x59b)](_0x3efaa2=>{const _0x555074=_0x8ad183;_0x2f1426[_0x555074(0xe82)](_0x3efaa2['dataset'][_0x555074(0x507)])&&_0x3efaa2[_0x555074(0x159b)]['add'](_0x555074(0xc3e));});}async function _0x128b95(){const _0x51369d=_0x2b1222,_0x2da2e7=document['querySelectorAll']('#data-clear-type-list\x20.clear-posts-item.selected');if(_0x2da2e7[_0x51369d(0x58a)]===0x0){alert(_0x51369d(0xa89));return;}_0x1f99e5=Array[_0x51369d(0xa81)](_0x2da2e7)[_0x51369d(0x1431)](_0x490061=>_0x490061[_0x51369d(0x746)][_0x51369d(0x705)]);const _0x1d76ef=await _0x109970(_0x51369d(0xfde),'此操作将永久删除您选择的所有数据，且无法恢复！确定要继续吗？',{'confirmButtonClass':_0x51369d(0x1c6),'confirmText':'确认删除'});if(!_0x1d76ef)return;await _0x1460c5(_0x51369d(0x11b7),_0x51369d(0x612));try{await _0x3df81a['transaction']('rw',_0x3df81a[_0x51369d(0x308)],async()=>{const _0x1d6363=_0x51369d;for(const _0xf2d84b of _0x2f1426){for(const _0x3569aa of _0x1f99e5){if(_0x3569aa===_0x1d6363(0x21a)){if(_0xf2d84b==='user'){const _0x3049b9=await _0x3df81a[_0x1d6363(0x589)]['toArray']();for(const _0x5b1543 of _0x3049b9){_0x5b1543[_0x1d6363(0xce3)]=_0x5b1543['history'][_0x1d6363(0xede)](_0x49afcd=>_0x49afcd[_0x1d6363(0xfbb)]!=='user'),await _0x3df81a[_0x1d6363(0x589)][_0x1d6363(0x295)](_0x5b1543);}}else{const _0x31a4ea=await _0x3df81a[_0x1d6363(0x589)]['get'](_0xf2d84b);_0x31a4ea&&(_0x31a4ea['history']=[],_0x31a4ea[_0x1d6363(0xbae)]=_0x1d6363(0x629),_0x31a4ea[_0x1d6363(0x3d2)]=_0x1d6363(0x629),Array['isArray'](_0x31a4ea[_0x1d6363(0x1515)])&&(_0x31a4ea['nameHistory']=[]),_0x31a4ea[_0x1d6363(0x6a8)]&&(_0x31a4ea[_0x1d6363(0x6a8)]['myNickname']='我'),await _0x3df81a[_0x1d6363(0x589)][_0x1d6363(0x295)](_0x31a4ea));}}if(_0x3569aa==='qzone'){const _0x33272c=_0xf2d84b===_0x1d6363(0x860)?_0x1d6363(0x860):_0xf2d84b;await _0x3df81a['qzonePosts'][_0x1d6363(0x478)](_0x1d6363(0x12cf))['equals'](_0x33272c)[_0x1d6363(0xc40)]();}_0x3569aa===_0x1d6363(0x111c)&&_0xf2d84b!==_0x1d6363(0x860)&&await _0x3df81a[_0x1d6363(0xac4)][_0x1d6363(0x478)](_0x1d6363(0x3e0))[_0x1d6363(0x49d)](_0xf2d84b)[_0x1d6363(0xc40)]();if(_0x3569aa===_0x1d6363(0x11a6)&&_0xf2d84b!==_0x1d6363(0x860)){const _0x5d22d4=await _0x3df81a[_0x1d6363(0x589)][_0x1d6363(0x13f8)](_0xf2d84b);_0x5d22d4&&(_0x5d22d4['thoughtsHistory']=[],_0x5d22d4['heartfeltVoice']=_0x1d6363(0x629),_0x5d22d4[_0x1d6363(0x3d2)]=_0x1d6363(0x629),await _0x3df81a[_0x1d6363(0x589)]['put'](_0x5d22d4));}if(_0x3569aa===_0x1d6363(0x9e3)&&_0xf2d84b!=='user'){const _0x3d0811=await _0x3df81a[_0x1d6363(0x589)][_0x1d6363(0x13f8)](_0xf2d84b);_0x3d0811&&(_0x3d0811[_0x1d6363(0x5fb)]=[],await _0x3df81a[_0x1d6363(0x589)][_0x1d6363(0x295)](_0x3d0811));}_0x3569aa===_0x1d6363(0xbeb)&&(_0xf2d84b==='user'?(await _0x3df81a[_0x1d6363(0xbeb)][_0x1d6363(0x478)]('type')[_0x1d6363(0x49d)](_0x1d6363(0x4e1))[_0x1d6363(0xede)](_0x2263ca=>_0x2263ca[_0x1d6363(0x128c)][_0x1d6363(0x12cf)]==='user')['delete'](),await _0x3df81a[_0x1d6363(0xbeb)][_0x1d6363(0x478)](_0x1d6363(0xcbd))['equals'](_0x1d6363(0xa17))[_0x1d6363(0xede)](_0x48c79d=>_0x48c79d[_0x1d6363(0x128c)][_0x1d6363(0xfbb)]===_0x1d6363(0x860))['delete']()):(await _0x3df81a[_0x1d6363(0xbeb)][_0x1d6363(0x478)](_0x1d6363(0xcbd))[_0x1d6363(0x49d)](_0x1d6363(0xa17))[_0x1d6363(0xa26)](_0x2c194d=>_0x2c194d['chatId']===_0xf2d84b)['delete'](),await _0x3df81a[_0x1d6363(0xbeb)][_0x1d6363(0x478)]('type')['equals'](_0x1d6363(0x4e1))[_0x1d6363(0xede)](_0x2fe28f=>_0x2fe28f[_0x1d6363(0x128c)]['authorId']===_0xf2d84b)[_0x1d6363(0xc40)](),await _0x3df81a[_0x1d6363(0xbeb)][_0x1d6363(0x478)](_0x1d6363(0xcbd))[_0x1d6363(0x49d)](_0x1d6363(0x654))[_0x1d6363(0xede)](_0x1f447f=>_0x1f447f[_0x1d6363(0x128c)]['characterId']===_0xf2d84b)['delete'](),await _0x3df81a['favorites'][_0x1d6363(0x478)](_0x1d6363(0xcbd))[_0x1d6363(0x49d)](_0x1d6363(0x106c))[_0x1d6363(0xede)](_0x8c7be6=>_0x8c7be6[_0x1d6363(0x128c)][_0x1d6363(0x575)]===_0xf2d84b)[_0x1d6363(0xc40)](),await _0x3df81a[_0x1d6363(0xbeb)]['where']('type')['equals']('char_memo')[_0x1d6363(0xede)](_0x4ccadf=>_0x4ccadf[_0x1d6363(0x128c)]['characterId']===_0xf2d84b)['delete']()));if(_0x3569aa===_0x1d6363(0x7c9)&&_0xf2d84b!==_0x1d6363(0x860)){const _0x48b750=await _0x3df81a['chats'][_0x1d6363(0x13f8)](_0xf2d84b);_0x48b750&&(_0x48b750[_0x1d6363(0xb5c)]=[],_0x48b750[_0x1d6363(0x6fc)]=[],_0x48b750[_0x1d6363(0xa6f)]=[],_0x48b750['simulatedTaobaoHistory']=null,_0x48b750[_0x1d6363(0x943)]=[],_0x48b750[_0x1d6363(0xa3d)]=[],_0x48b750['simulatedMusicPlaylist']=[],_0x48b750['diary']=[],_0x48b750[_0x1d6363(0x11c6)]=[],await _0x3df81a['chats'][_0x1d6363(0x295)](_0x48b750));}}}}),await _0x18cf35(),await _0x1033ae(),document[_0x51369d(0x1f4)](_0x51369d(0xb4c))['classList'][_0x51369d(0xa9c)](_0x51369d(0xfca)),await _0x1460c5(_0x51369d(0x1f2),_0x51369d(0x1396));}catch(_0x240642){console['error'](_0x51369d(0x79c),_0x240642),await _0x1460c5(_0x51369d(0x2cf),'操作失败:\x20'+_0x240642[_0x51369d(0x11f0)]);}}async function _0x4ed932(_0x532dee,_0x1192af,_0x1a367a){const _0x2a011d=_0x2b1222,_0x18e01c=_0x1a367a[_0x2a011d(0xeda)]('.icon-preview')[_0x2a011d(0x14f9)],_0x16d6ce=await _0x12414d(_0x2a011d(0x68a)+_0x18e01c+_0x2a011d(0xb26),[{'text':'📁\x20从本地上传','value':_0x2a011d(0x13df)},{'text':'🌐\x20使用网络URL','value':_0x2a011d(0x258)}]);let _0x4283eb=null;if(_0x16d6ce==='local')_0x4283eb=await _0x2cdf38();else{if(_0x16d6ce===_0x2a011d(0x258)){const _0x19b158=_0x1192af==='cphone'?_0x1ae02e[_0x2a011d(0x12c0)][_0x2a011d(0x11df)][_0x532dee]:_0x1ae02e['globalSettings']['appIcons'][_0x532dee],_0x46f2b9=_0x19b158[_0x2a011d(0xebf)](_0x2a011d(0x792)),_0x41ec93=_0x46f2b9?'':_0x19b158;_0x4283eb=await _0x11f6fb(_0x2a011d(0x203),'请输入新的图片URL',_0x41ec93,'url');}}if(_0x4283eb&&_0x4283eb[_0x2a011d(0x4a2)]()){const _0x5461eb=_0x4283eb[_0x2a011d(0x4a2)]();_0x1192af===_0x2a011d(0x7c9)?_0x1ae02e[_0x2a011d(0x12c0)][_0x2a011d(0x11df)][_0x532dee]=_0x5461eb:_0x1ae02e['globalSettings'][_0x2a011d(0x69e)][_0x532dee]=_0x5461eb,_0x1a367a[_0x2a011d(0xeda)](_0x2a011d(0x13be))[_0x2a011d(0x9fe)]=_0x5461eb;}else _0x4283eb!==null&&alert(_0x2a011d(0x1300));}async function _0x51a94c(){const _0x1df91a=_0x2b1222,_0x29f2ce=await _0x109970(_0x1df91a(0x156e),_0x1df91a(0x1aa),{'confirmButtonClass':_0x1df91a(0x1c6),'confirmText':_0x1df91a(0x74d)});if(!_0x29f2ce)return;await _0x1460c5('请稍候...',_0x1df91a(0x465));let _0x4aba14={'found':0x0,'compressed':0x0,'skipped':0x0,'originalSize':0x0,'newSize':0x0};try{console['log'](_0x1df91a(0x13db));const _0x9bac57=[_0x1df91a(0x589),_0x1df91a(0x12c0),_0x1df91a(0x11ef),_0x1df91a(0x1420),_0x1df91a(0x1434)],_0x219931=[];for(const _0x34af14 of _0x9bac57){const _0x2b98bb=_0x3df81a['table'](_0x34af14),_0x3ad3a8=await _0x2b98bb['toArray']();_0x219931[_0x1df91a(0x1426)]({'tableName':_0x34af14,'records':_0x3ad3a8});}console[_0x1df91a(0x57e)](_0x1df91a(0x551));for(const _0x56be11 of _0x219931){for(const _0x2eafef of _0x56be11['records']){await _0x10f28a(_0x2eafef,_0x4aba14);}}console[_0x1df91a(0x57e)](_0x1df91a(0xd05)),await _0x3df81a[_0x1df91a(0x13a5)]('rw',_0x9bac57,async()=>{const _0x360da8=_0x1df91a;for(const _0x26d24e of _0x219931){await _0x3df81a[_0x360da8(0x12b7)](_0x26d24e[_0x360da8(0x10b8)])[_0x360da8(0x8b2)](_0x26d24e[_0x360da8(0xc0d)]);}});const _0x2d8c0c=_0x4aba14[_0x1df91a(0xdbc)]-_0x4aba14[_0x1df91a(0xd7e)],_0x1fa55b=_0x4aba14['originalSize']>0x0?(_0x2d8c0c/_0x4aba14['originalSize']*0x64)[_0x1df91a(0x24f)](0x2):0x0;await _0x1460c5(_0x1df91a(0x583),'扫描完成！<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20共找到\x20'+_0x4aba14[_0x1df91a(0xa8a)]+_0x1df91a(0x366)+_0x4aba14[_0x1df91a(0x34c)]+_0x1df91a(0x1028)+_0x4aba14['skipped']+'\x20张<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-\x20空间节省了\x20<strong>'+(_0x2d8c0c/0x400/0x400)[_0x1df91a(0x24f)](0x2)+_0x1df91a(0xbc0)+_0x1fa55b+_0x1df91a(0x945));}catch(_0x28d2b7){console[_0x1df91a(0x127d)](_0x1df91a(0x15c3),_0x28d2b7),await _0x1460c5(_0x1df91a(0xfa2),_0x1df91a(0x1345)+_0x28d2b7[_0x1df91a(0x11f0)]);}}function _0x5c1108(_0x4ba996,_0x18479d=''){const _0x1ae6ed=_0x2b1222;let _0xb10d53=0x0;for(const _0x1bf342 in _0x4ba996){if(_0x4ba996[_0x1ae6ed(0x37f)](_0x1bf342)){const _0x3802fc=_0x4ba996[_0x1bf342];if(typeof _0x3802fc===_0x1ae6ed(0x6c3)&&_0x3802fc[_0x1ae6ed(0xebf)](_0x1ae6ed(0x792))){const _0x32396a=_0x18479d===_0x1ae6ed(0x12c0)&&(_0x1bf342===_0x1ae6ed(0xd23)||_0x1bf342===_0x1ae6ed(0x99f)||_0x1bf342===_0x1ae6ed(0x3a1))||_0x18479d===_0x1ae6ed(0xd55)||_0x18479d===_0x1ae6ed(0x6a8)&&_0x1bf342==='background'||(_0x18479d===_0x1ae6ed(0x69e)||_0x18479d===_0x1ae6ed(0x11df));!_0x32396a&&(_0xb10d53+=_0x3802fc[_0x1ae6ed(0x58a)]);}else typeof _0x3802fc==='object'&&_0x3802fc!==null&&(_0xb10d53+=_0x5c1108(_0x3802fc,_0x1bf342));}}return _0xb10d53;}async function _0xfe46d9(){const _0x21a458=_0x2b1222,_0x5c8556=document[_0x21a458(0x1f4)](_0x21a458(0x1183));if(!_0x5c8556)return;_0x5c8556[_0x21a458(0xf21)]=_0x21a458(0x1435);try{let _0x5653a9=0x0;const _0x6f9f25=['chats','globalSettings',_0x21a458(0x11ef),_0x21a458(0x1420),_0x21a458(0x1434)];for(const _0x2a8eac of _0x6f9f25){const _0x18e38d=_0x3df81a[_0x21a458(0x12b7)](_0x2a8eac);await _0x18e38d['each'](_0x3ee6c8=>{_0x5653a9+=_0x5c1108(_0x3ee6c8);});}const _0x2586a0=(_0x5653a9/0x400/0x400)[_0x21a458(0x24f)](0x2);_0x5c8556['innerHTML']=_0x21a458(0xac1)+_0x2586a0+_0x21a458(0x62d);}catch(_0x3478f2){console[_0x21a458(0x127d)]('计算图片总大小时出错:',_0x3478f2),_0x5c8556[_0x21a458(0xf21)]=_0x21a458(0x1321);}}async function _0x10f28a(_0x4e28f0,_0x4d3e17,_0x5139ab=''){const _0x21e091=_0x2b1222;for(const _0x426a76 in _0x4e28f0){if(_0x4e28f0['hasOwnProperty'](_0x426a76)){const _0x51c41a=_0x4e28f0[_0x426a76];if(typeof _0x51c41a===_0x21e091(0x6c3)&&_0x51c41a[_0x21e091(0xebf)]('data:image')){const _0x56df9e=_0x5139ab===_0x21e091(0x12c0)&&(_0x426a76===_0x21e091(0xd23)||_0x426a76===_0x21e091(0x99f)||_0x426a76==='globalChatBackground')||_0x5139ab===_0x21e091(0xd55)||_0x5139ab===_0x21e091(0x6a8)&&_0x426a76===_0x21e091(0xece)||(_0x5139ab===_0x21e091(0x69e)||_0x5139ab===_0x21e091(0x11df));if(_0x56df9e)continue;_0x4d3e17[_0x21e091(0xa8a)]++,_0x4d3e17[_0x21e091(0xdbc)]+=_0x51c41a['length'];const _0x8965a3=await _0x331012(_0x51c41a);_0x8965a3&&_0x8965a3!==_0x51c41a?(_0x4e28f0[_0x426a76]=_0x8965a3,_0x4d3e17[_0x21e091(0x34c)]++,_0x4d3e17[_0x21e091(0xd7e)]+=_0x8965a3['length']):(_0x4d3e17['skipped']++,_0x4d3e17['newSize']+=_0x51c41a[_0x21e091(0x58a)]);}else typeof _0x51c41a==='object'&&_0x51c41a!==null&&await _0x10f28a(_0x51c41a,_0x4d3e17,_0x426a76);}}}async function _0x331012(_0x1e3531){const _0x1c2dcb=_0x2b1222;if(!_0x1e3531[_0x1c2dcb(0xebf)](_0x1c2dcb(0x792)))return _0x1e3531;try{const _0x742ab1=await(await fetch(_0x1e3531))[_0x1c2dcb(0x128e)](),_0x4dfe41={'maxSizeMB':0.5,'maxWidthOrHeight':0x320,'useWebWorker':!![],'initialQuality':0.5,'fileType':_0x1c2dcb(0x37b)};console['log'](_0x1c2dcb(0xdb5)+(_0x742ab1['size']/0x400/0x400)[_0x1c2dcb(0x24f)](0x2)+_0x1c2dcb(0xb03));const _0x7169c6=await imageCompression(_0x742ab1,_0x4dfe41);return console['log']('压缩完成，新的大小:\x20'+(_0x7169c6[_0x1c2dcb(0xb51)]/0x400/0x400)[_0x1c2dcb(0x24f)](0x2)+_0x1c2dcb(0xb03)),new Promise((_0x1251b0,_0xfc5855)=>{const _0x4eb129=_0x1c2dcb,_0x351739=new FileReader();_0x351739['onloadend']=()=>_0x1251b0(_0x351739[_0x4eb129(0xbc9)]),_0x351739[_0x4eb129(0xdf5)]=_0xfc5855,_0x351739[_0x4eb129(0x21e)](_0x7169c6);});}catch(_0x573483){return console[_0x1c2dcb(0x127d)](_0x1c2dcb(0xc59),_0x573483),_0x1e3531;}}function _0x2bd5b9(_0x5e19a5,_0x341f71){const _0x5e1f85=_0x2b1222;if(!_0x5e19a5||!_0x341f71||typeof _0x5e19a5!==_0x5e1f85(0x6c3)||typeof _0x341f71!==_0x5e1f85(0x6c3))return 0x0;const _0x4cb051=_0x5e19a5[_0x5e1f85(0x23f)]('.')[_0x5e1f85(0x1431)](Number),_0x2fc608=_0x341f71[_0x5e1f85(0x23f)]('.')['map'](Number),_0x4c4dfb=Math[_0x5e1f85(0x616)](_0x4cb051[_0x5e1f85(0x58a)],_0x2fc608[_0x5e1f85(0x58a)]);for(let _0x2f4d16=0x0;_0x2f4d16<_0x4c4dfb;_0x2f4d16++){const _0x2b0d9c=_0x4cb051[_0x2f4d16]||0x0,_0x444944=_0x2fc608[_0x2f4d16]||0x0;if(_0x2b0d9c>_0x444944)return 0x1;if(_0x2b0d9c<_0x444944)return-0x1;}return 0x0;}async function _0x23d398(){const _0x2801fa=_0x2b1222,_0x19c1da=_0x2801fa(0x571);try{const _0x2f690c=await fetch(_0x2801fa(0x1ab)+Date[_0x2801fa(0xd6e)]());if(!_0x2f690c['ok']){console[_0x2801fa(0xb3b)](_0x2801fa(0x1093));return;}const _0x29a2bd=await _0x2f690c[_0x2801fa(0x40f)](),_0x40a1eb=document['createElement'](_0x2801fa(0xaf9));_0x40a1eb[_0x2801fa(0xf21)]=_0x29a2bd;const _0xcabdd9=_0x40a1eb[_0x2801fa(0xeda)]('[data-version]');if(!_0xcabdd9){console[_0x2801fa(0x127d)](_0x2801fa(0x11b9));return;}const _0x38ae7c=_0xcabdd9['dataset']['version'],_0x2782e7=localStorage[_0x2801fa(0x587)]('dismissedUpdateVersion');!_0x2782e7||_0x2bd5b9(_0x38ae7c,_0x2782e7)>0x0?(console[_0x2801fa(0x57e)](_0x2801fa(0x40c)+_0x38ae7c+_0x2801fa(0x136e)+(_0x2782e7||'无')+')'),_0x25fa2b(_0x38ae7c,_0xcabdd9['innerHTML'])):console[_0x2801fa(0x57e)](_0x2801fa(0x99e)+_0x38ae7c+_0x2801fa(0x13f5));}catch(_0x47bd71){console['error'](_0x2801fa(0xe73),_0x47bd71);}}function _0x25fa2b(_0x1db4c7,_0x628c8c){const _0x1128e9=_0x2b1222,_0x3176ef=document['getElementById'](_0x1128e9(0x8d8)),_0x4d7d1a=document[_0x1128e9(0x1f4)]('update-notice-body'),_0x439cba=document['getElementById'](_0x1128e9(0x2d7)),_0x583fa9=document[_0x1128e9(0x1f4)](_0x1128e9(0xebd));_0x4d7d1a['innerHTML']=_0x628c8c,_0x439cba[_0x1128e9(0xa0d)]=!![],_0x583fa9[_0x1128e9(0xa0d)]=!![];const _0x4e131a=_0x439cba['textContent'];let _0x1025cd=0xa;_0x439cba[_0x1128e9(0x231)]=_0x4e131a+'\x20('+_0x1025cd+'s)';const _0x36c4d8=setInterval(()=>{const _0x47fd35=_0x1128e9;_0x1025cd--,_0x1025cd>0x0?_0x439cba[_0x47fd35(0x231)]=_0x4e131a+'\x20('+_0x1025cd+'s)':(clearInterval(_0x36c4d8),_0x439cba['disabled']=![],_0x583fa9[_0x47fd35(0xa0d)]=![],_0x439cba['textContent']=_0x4e131a);},0x3e8);_0x439cba['onclick']=()=>{const _0xf897c8=_0x1128e9;clearInterval(_0x36c4d8),_0x3176ef['classList'][_0xf897c8(0xa9c)]('visible'),_0x439cba[_0xf897c8(0x231)]=_0x4e131a;},_0x583fa9[_0x1128e9(0x1199)]=()=>{const _0x98588e=_0x1128e9;clearInterval(_0x36c4d8),localStorage[_0x98588e(0xae8)](_0x98588e(0x90d),_0x1db4c7),_0x3176ef['classList'][_0x98588e(0xa9c)](_0x98588e(0xfca)),console[_0x98588e(0x57e)]('用户已忽略版本:\x20'+_0x1db4c7),_0x439cba[_0x98588e(0x231)]=_0x4e131a;},_0x3176ef['classList']['add'](_0x1128e9(0xfca));}function _0x95bb62(){const _0x3a9618=_0x2b1222,_0x11f8e1=document[_0x3a9618(0x1f4)]('douban-settings-modal');document[_0x3a9618(0x1f4)](_0x3a9618(0x9bb))['value']=_0x1ae02e[_0x3a9618(0x12c0)][_0x3a9618(0x9c7)]||0xc,document[_0x3a9618(0x1f4)](_0x3a9618(0x1385))['value']=_0x1ae02e[_0x3a9618(0x12c0)][_0x3a9618(0x5f9)]||0x14,_0x11f8e1['classList'][_0x3a9618(0x6a4)](_0x3a9618(0xfca));}async function _0x25d73f(){const _0x367569=_0x2b1222,_0xb8ded5=document[_0x367569(0x1f4)](_0x367569(0x9bb)),_0x48ca61=document[_0x367569(0x1f4)]('douban-max-posts-input'),_0x3a90a6=parseInt(_0xb8ded5['value']),_0x184ca0=parseInt(_0x48ca61[_0x367569(0x107e)]);if(isNaN(_0x3a90a6)||isNaN(_0x184ca0)||_0x3a90a6<0x1||_0x184ca0<0x1){alert(_0x367569(0xc86));return;}if(_0x3a90a6>_0x184ca0){alert(_0x367569(0x288));return;}_0x1ae02e['globalSettings'][_0x367569(0x9c7)]=_0x3a90a6,_0x1ae02e[_0x367569(0x12c0)][_0x367569(0x5f9)]=_0x184ca0,await _0x3df81a[_0x367569(0x12c0)][_0x367569(0x295)](_0x1ae02e[_0x367569(0x12c0)]),document['getElementById'](_0x367569(0x12c5))[_0x367569(0x159b)][_0x367569(0xa9c)](_0x367569(0xfca)),await _0x1460c5('保存成功',_0x367569(0x9c2));}async function _0x5a357e(_0x453f72){const _0x18ddbc=_0x2b1222,_0x2cf600=document[_0x18ddbc(0x1f4)](_0x18ddbc(0x41c)),_0x5e5cc9=document[_0x18ddbc(0x1f4)](_0x18ddbc(0x1035));_0x5e5cc9[_0x18ddbc(0xf21)]='';let _0x1e8d6e=[];if(_0x453f72===_0x18ddbc(0x667)){const _0x1e860b=Object[_0x18ddbc(0x753)](_0x1ae02e[_0x18ddbc(0x589)])[_0x18ddbc(0xede)](_0x14cffd=>!_0x14cffd[_0x18ddbc(0xe83)]),_0x15a882=await _0x3df81a[_0x18ddbc(0x15b9)][_0x18ddbc(0x27a)]();_0x1e8d6e=[{'id':'user','name':_0x1ae02e['qzoneSettings']['nickname']||'我','originalName':_0x1ae02e[_0x18ddbc(0x11ef)][_0x18ddbc(0xb46)]||'我','avatar':_0x1ae02e['qzoneSettings'][_0x18ddbc(0x95b)],'type':_0x18ddbc(0x860)},..._0x1e860b[_0x18ddbc(0x1431)](_0x5715c6=>({'id':_0x5715c6['id'],'name':_0x5715c6[_0x18ddbc(0x5d2)],'originalName':_0x5715c6['originalName'],'avatar':_0x5715c6[_0x18ddbc(0x6a8)][_0x18ddbc(0xc99)],'type':_0x18ddbc(0x1381)})),..._0x15a882['map'](_0x500af0=>({'id':_0x18ddbc(0x27f)+_0x500af0['id'],'name':_0x500af0['name'],'originalName':_0x500af0[_0x18ddbc(0x5d2)],'avatar':_0x500af0[_0x18ddbc(0x95b)],'type':_0x18ddbc(0x717)}))],_0x4b691c['chatId']=null;}else{const _0xfa3a96=_0x1ae02e['chats'][_0x1ae02e[_0x18ddbc(0x588)]];if(!_0xfa3a96||!_0xfa3a96['isGroup'])return;_0x1e8d6e=[{'id':'user','name':_0xfa3a96[_0x18ddbc(0x6a8)][_0x18ddbc(0xe31)]||'我','originalName':_0x1ae02e['qzoneSettings']['nickname']||'我','avatar':_0xfa3a96[_0x18ddbc(0x6a8)][_0x18ddbc(0x1207)],'type':_0x18ddbc(0x860)},..._0xfa3a96['members'][_0x18ddbc(0x1431)](_0x3c8380=>{const _0x57766e=_0x18ddbc,_0x50cac5=_0x1ae02e[_0x57766e(0x589)][_0x3c8380['id']],_0x1a8237=_0x3c8380['avatar']||(_0x50cac5?_0x50cac5[_0x57766e(0x6a8)]['aiAvatar']:_0x54779f);return{'id':_0x3c8380['id'],'name':_0x3c8380[_0x57766e(0xd69)],'originalName':_0x3c8380['originalName'],'avatar':_0x1a8237,'type':_0x3c8380[_0x57766e(0x13e4)]?'npc':'character'};})],_0x4b691c[_0x18ddbc(0x3e0)]=_0x1ae02e[_0x18ddbc(0x588)];}_0x1e8d6e['forEach'](_0x4929a4=>{const _0x458e00=_0x18ddbc,_0xdc20a6=document[_0x458e00(0x219)](_0x458e00(0xaf9));_0xdc20a6['className']=_0x458e00(0xec5),_0xdc20a6[_0x458e00(0xf21)]=_0x458e00(0xd67)+JSON[_0x458e00(0x994)](_0x4929a4)+'\x27\x20'+(_0x4929a4[_0x458e00(0xcbd)]===_0x458e00(0x860)?'checked\x20disabled':_0x458e00(0xe56))+_0x458e00(0xbe3)+_0x4929a4[_0x458e00(0x95b)]+_0x458e00(0xddc)+_0x4929a4['name']+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x5e5cc9[_0x458e00(0x6ce)](_0xdc20a6);}),_0x2cf600[_0x18ddbc(0x159b)][_0x18ddbc(0x6a4)](_0x18ddbc(0xfca));}async function _0x2c0385(){const _0x56e9e4=_0x2b1222,_0x17dee7=document[_0x56e9e4(0x14bf)](_0x56e9e4(0xc9d)),_0x4d767d=_0x17dee7[_0x56e9e4(0x58a)];let _0x5983e1=[];if(_0x4d767d===0x6)_0x4b691c[_0x56e9e4(0x15cd)]='6p',_0x5983e1=['狼人','狼人','平民','平民',_0x56e9e4(0xd82),'猎人'];else{if(_0x4d767d===0x9)_0x4b691c[_0x56e9e4(0x15cd)]='9p',_0x5983e1=['狼人','狼人','狼人','平民','平民','平民',_0x56e9e4(0xd82),'女巫','猎人'];else{if(_0x4d767d===0xc)_0x4b691c[_0x56e9e4(0x15cd)]='12p',_0x5983e1=['狼人','狼人','狼人','狼人','平民','平民','平民','平民',_0x56e9e4(0xd82),'女巫','猎人','守卫'];else{alert(_0x56e9e4(0xe99)+_0x4d767d+'\x20不支持。请选择6、9或12人。');return;}}}document['getElementById'](_0x56e9e4(0x41c))[_0x56e9e4(0x159b)][_0x56e9e4(0xa9c)](_0x56e9e4(0xfca)),await _0x1460c5(_0x56e9e4(0x614),_0x56e9e4(0xf7b));for(let _0x401bf6=_0x5983e1[_0x56e9e4(0x58a)]-0x1;_0x401bf6>0x0;_0x401bf6--){const _0x36fc91=Math[_0x56e9e4(0x123c)](Math[_0x56e9e4(0x13ae)]()*(_0x401bf6+0x1));[_0x5983e1[_0x401bf6],_0x5983e1[_0x36fc91]]=[_0x5983e1[_0x36fc91],_0x5983e1[_0x401bf6]];}const _0x295311=Array[_0x56e9e4(0xa81)](_0x17dee7)[_0x56e9e4(0x1431)](_0xd1e5f1=>JSON[_0x56e9e4(0x129c)](_0xd1e5f1[_0x56e9e4(0x746)][_0x56e9e4(0x178)]));_0x4b691c[_0x56e9e4(0xae3)]=[];for(let _0x4dbdf9=0x0;_0x4dbdf9<_0x295311[_0x56e9e4(0x58a)];_0x4dbdf9++){const _0x111bbc=_0x295311[_0x4dbdf9],_0x5a2b8d=_0x5983e1[_0x4dbdf9];let _0x33c7b4=_0x56e9e4(0x984);if(_0x111bbc['type']===_0x56e9e4(0x1381)){const _0x16ec3b=_0x1ae02e['chats'][_0x111bbc['id']];_0x33c7b4=_0x16ec3b?_0x16ec3b[_0x56e9e4(0x6a8)]['aiPersona']:_0x56e9e4(0xd7b);}else{if(_0x111bbc['type']===_0x56e9e4(0x717)){const _0x253cf0=await _0x3df81a[_0x56e9e4(0x15b9)][_0x56e9e4(0x27a)](),_0x5f3477=_0x253cf0['find'](_0x198200=>'npc_'+_0x198200['id']===_0x111bbc['id']);_0x33c7b4=_0x5f3477?_0x5f3477[_0x56e9e4(0x3be)]:_0x56e9e4(0x2ff);}else{if(_0x111bbc[_0x56e9e4(0xcbd)]==='user'){const _0x306c0e=_0x4b691c[_0x56e9e4(0x3e0)]?_0x1ae02e[_0x56e9e4(0x589)][_0x4b691c['chatId']]:null;_0x33c7b4=_0x306c0e?_0x306c0e[_0x56e9e4(0x6a8)]['myPersona']:_0x56e9e4(0x1127);}}}const _0x10dd31={..._0x111bbc,'role':_0x5a2b8d,'isAlive':!![],'character_persona':_0x33c7b4};_0x5a2b8d==='女巫'&&(_0x10dd31[_0x56e9e4(0xe2e)]=![],_0x10dd31[_0x56e9e4(0xf54)]=![]),_0x5a2b8d==='守卫'&&(_0x10dd31['lastGuardedId']=null),_0x4b691c[_0x56e9e4(0xae3)][_0x56e9e4(0x1426)](_0x10dd31);}_0x4b691c[_0x56e9e4(0xd51)]=!![],_0x4b691c['currentDay']=0x1,_0x4b691c['currentPhase']=_0x56e9e4(0x3c1),_0x4b691c['gameLog']=[],_0x4b691c[_0x56e9e4(0x704)]=[];const _0x4f926f=_0x5983e1['reduce']((_0x1f1b8f,_0x2a361d)=>{return _0x1f1b8f[_0x2a361d]=(_0x1f1b8f[_0x2a361d]||0x0)+0x1,_0x1f1b8f;},{}),_0x1136c0=Object[_0x56e9e4(0xd20)](_0x4f926f)[_0x56e9e4(0x1431)](([_0x13be91,_0x569a9f])=>_0x13be91+'\x20x'+_0x569a9f)[_0x56e9e4(0x1143)]('、');_0x3d2f5f(_0x56e9e4(0x7a7)+_0x4d767d+_0x56e9e4(0x5e9)+_0x1136c0+'。');const _0x481df6=_0x4b691c[_0x56e9e4(0xae3)][_0x56e9e4(0x13b7)](_0x21500a=>_0x21500a['id']===_0x56e9e4(0x860));_0x5cbf84(),_0x2e53fa(_0x56e9e4(0x293)),_0x414988(_0x481df6[_0x56e9e4(0xfbb)]);}function _0x5cbf84(){const _0x203d67=_0x2b1222,_0x582826=document[_0x203d67(0x1f4)](_0x203d67(0x1214));_0x582826[_0x203d67(0xf21)]='';const _0x256a0f=[..._0x4b691c[_0x203d67(0xae3)]][_0x203d67(0x74e)]((_0x4dd966,_0x3f6834)=>_0x4dd966[_0x203d67(0x6f3)]-_0x3f6834[_0x203d67(0x6f3)]);_0x256a0f[_0x203d67(0x59b)]((_0x35e6af,_0x5484b2)=>{const _0x1e56d3=_0x203d67,_0x3249f2=_0x4b691c[_0x1e56d3(0xae3)][_0x1e56d3(0xf2d)](_0x6b8a7d=>_0x6b8a7d['id']===_0x35e6af['id'])+0x1,_0x75530c=document[_0x1e56d3(0x219)]('div');_0x75530c['className']=_0x1e56d3(0x778);if(!_0x35e6af['isAlive'])_0x75530c[_0x1e56d3(0x159b)][_0x1e56d3(0x6a4)](_0x1e56d3(0xdd7));_0x75530c['innerHTML']=_0x1e56d3(0x90b)+_0x35e6af[_0x1e56d3(0x95b)]+_0x1e56d3(0xb9c)+_0x3249f2+'.\x20'+_0x35e6af[_0x1e56d3(0x5d2)]+_0x1e56d3(0x12f5),_0x582826[_0x1e56d3(0x6ce)](_0x75530c);});const _0x32b8cc=document[_0x203d67(0x1f4)](_0x203d67(0xf4d));_0x32b8cc[_0x203d67(0xf21)]='';for(let _0x3264b6=0x1;_0x3264b6<=_0x4b691c[_0x203d67(0x14b0)];_0x3264b6++){const _0x23ff71=[..._0x4b691c[_0x203d67(0xc48)][_0x203d67(0xede)](_0x42fdbd=>_0x42fdbd[_0x203d67(0x1449)]===_0x3264b6),..._0x4b691c[_0x203d67(0x704)][_0x203d67(0xede)](_0x4de804=>_0x4de804[_0x203d67(0x1449)]===_0x3264b6)][_0x203d67(0x74e)]((_0x102795,_0x3d8f89)=>(_0x102795['timestamp']||0x0)-(_0x3d8f89['timestamp']||0x0));if(_0x23ff71[_0x203d67(0x58a)]>0x0){const _0x424db6=document[_0x203d67(0x219)](_0x203d67(0xaf9));_0x424db6['className']=_0x203d67(0x11c9),_0x424db6[_0x203d67(0x231)]=_0x203d67(0x6fd)+_0x3264b6+_0x203d67(0x1446),_0x424db6[_0x203d67(0x215)][_0x203d67(0x519)]=_0x203d67(0xda9),_0x32b8cc[_0x203d67(0x6ce)](_0x424db6),_0x23ff71[_0x203d67(0x59b)](_0x254b6c=>{const _0x3b947e=_0x203d67,_0x47b062=document[_0x3b947e(0x219)](_0x3b947e(0xaf9));_0x47b062['className']='werewolf-log-entry\x20'+_0x254b6c['type'],_0x254b6c[_0x3b947e(0xcbd)]===_0x3b947e(0xdf2)?_0x47b062['innerHTML']=_0x3b947e(0x266)+_0x254b6c[_0x3b947e(0x9dc)]+_0x3b947e(0xf93)+_0x254b6c[_0x3b947e(0x128c)]:_0x47b062['textContent']=_0x254b6c[_0x3b947e(0x128c)],_0x32b8cc[_0x3b947e(0x6ce)](_0x47b062);});}}_0x32b8cc['scrollTop']=_0x32b8cc[_0x203d67(0x1092)];const _0x2e434a={'start':_0x203d67(0x1304),'night':'第'+_0x4b691c[_0x203d67(0x14b0)]+_0x203d67(0x75d),'day':'第'+_0x4b691c[_0x203d67(0x14b0)]+_0x203d67(0x1412),'discussion':'第'+_0x4b691c[_0x203d67(0x14b0)]+_0x203d67(0xa33),'voting':'第'+_0x4b691c['currentDay']+'天\x20-\x20投票','gameover':_0x203d67(0x1dc)};document[_0x203d67(0x1f4)](_0x203d67(0x728))[_0x203d67(0x231)]=_0x203d67(0x701)+(_0x2e434a[_0x4b691c[_0x203d67(0xb65)]]||_0x4b691c[_0x203d67(0xb65)]);}function _0x414988(_0x472301){const _0x3a1459=_0x2b1222,_0x349d68={'狼人':'你的目标是杀死所有好人。每晚可以和同伴一起刀一个玩家。','平民':'你没有任何特殊能力，你的目标是通过投票放逐所有狼人。','预言家':_0x3a1459(0x200),'猎人':_0x3a1459(0x10d2),'女巫':_0x3a1459(0x201),'守卫':_0x3a1459(0x140f)};document['getElementById'](_0x3a1459(0xf83))['textContent']=_0x472301,document[_0x3a1459(0x1f4)](_0x3a1459(0x9af))[_0x3a1459(0x231)]=_0x349d68[_0x472301]||_0x3a1459(0xfa8),document['getElementById'](_0x3a1459(0xad8))[_0x3a1459(0x159b)][_0x3a1459(0x6a4)](_0x3a1459(0xfca));}async function _0x269d10(){const _0xfd52a1=_0x2b1222;_0x4b691c[_0xfd52a1(0xb65)]='第'+_0x4b691c[_0xfd52a1(0x14b0)]+_0xfd52a1(0x75d),_0x4b691c['nightActions']={},_0x3d2f5f('天黑请闭眼...'),_0x5cbf84(),document[_0xfd52a1(0x1f4)]('werewolf-action-bar')[_0xfd52a1(0x215)][_0xfd52a1(0x887)]=_0xfd52a1(0x1b5),document[_0xfd52a1(0x1f4)]('werewolf-retry-btn')[_0xfd52a1(0x215)][_0xfd52a1(0x887)]='none',await new Promise(_0x317d03=>setTimeout(_0x317d03,0x5dc));const _0x5afd91=_0x4b691c[_0xfd52a1(0xae3)]['find'](_0x1fe2ff=>_0x1fe2ff['role']==='守卫'&&_0x1fe2ff[_0xfd52a1(0x6f3)]);if(_0x5afd91){_0x3d2f5f(_0xfd52a1(0x38a)),_0x5cbf84();let _0x528a82=null;if(_0x5afd91['id']===_0xfd52a1(0x860))_0x528a82=await _0x25c273('guard',_0x5afd91['lastGuardedId']);else{const _0x48a480=_0x4b691c[_0xfd52a1(0xae3)]['filter'](_0x136e62=>_0x136e62[_0xfd52a1(0x6f3)]&&_0x136e62['id']!==_0x5afd91['lastGuardedId']);_0x48a480[_0xfd52a1(0x58a)]>0x0&&(_0x528a82=_0x48a480[Math['floor'](Math[_0xfd52a1(0x13ae)]()*_0x48a480['length'])]['id']);}_0x528a82&&(_0x4b691c['nightActions'][_0xfd52a1(0x406)]=_0x528a82,_0x5afd91['lastGuardedId']=_0x528a82),_0x3d2f5f(_0xfd52a1(0x1129)),_0x5cbf84(),await new Promise(_0x49f72e=>setTimeout(_0x49f72e,0x5dc));}_0x3d2f5f('狼人请睁眼，请选择要刀的玩家。'),_0x5cbf84();const _0x37c3cc=_0x4b691c[_0xfd52a1(0xae3)]['filter'](_0x8d6af0=>_0x8d6af0[_0xfd52a1(0xfbb)]==='狼人'&&_0x8d6af0[_0xfd52a1(0x6f3)]),_0x16e2ae=_0x37c3cc[_0xfd52a1(0x690)](_0x1efe4f=>_0x1efe4f['id']===_0xfd52a1(0x860));let _0x52f04a=null;_0x4b691c['lastFailedAction']=_0xfd52a1(0x5eb);try{if(_0x16e2ae)_0x3d2f5f(_0xfd52a1(0xb27)),_0x5cbf84(),_0x52f04a=await _0x557c92();else{if(_0x4b691c['currentDay']===0x1){console['log'](_0xfd52a1(0x12e7));const _0x5eebb7=_0x4b691c[_0xfd52a1(0xae3)]['filter'](_0x3fede8=>_0x3fede8[_0xfd52a1(0x6f3)]&&_0x3fede8[_0xfd52a1(0xfbb)]!=='狼人');_0x5eebb7[_0xfd52a1(0x58a)]>0x0&&(_0x52f04a=_0x5eebb7[Math[_0xfd52a1(0x123c)](Math['random']()*_0x5eebb7[_0xfd52a1(0x58a)])]['id']);}else _0x52f04a=await _0x40c680();}_0x4b691c[_0xfd52a1(0x6dc)]=null;}catch(_0x449d5e){console[_0xfd52a1(0x127d)]('狼人行动API失败:',_0x449d5e),await _0x1460c5('操作失败',_0xfd52a1(0x2af)),document[_0xfd52a1(0x1f4)](_0xfd52a1(0x888))[_0xfd52a1(0x215)][_0xfd52a1(0x887)]=_0xfd52a1(0x361);return;}_0x4b691c['nightActions'][_0xfd52a1(0xe26)]=_0x52f04a,_0x3d2f5f(_0xfd52a1(0x4b4)),_0x5cbf84(),await new Promise(_0x5aeca6=>setTimeout(_0x5aeca6,0x5dc));const _0x45cb31=_0x4b691c[_0xfd52a1(0xae3)][_0xfd52a1(0x13b7)](_0x277a66=>_0x277a66[_0xfd52a1(0xfbb)]==='女巫'&&_0x277a66['isAlive']);if(_0x45cb31){_0x3d2f5f('女巫请睁眼。'),_0x5cbf84();const _0x487a23=_0x4b691c[_0xfd52a1(0xae3)]['find'](_0x43b690=>_0x43b690['id']===_0x4b691c[_0xfd52a1(0x208)][_0xfd52a1(0xe26)]),_0x200c81=_0x4b691c[_0xfd52a1(0x208)][_0xfd52a1(0x406)]===_0x4b691c[_0xfd52a1(0x208)][_0xfd52a1(0xe26)],_0x581750=_0x200c81||!_0x487a23?null:_0x487a23;if(_0x45cb31['id']===_0xfd52a1(0x860)){let _0x55a521=await _0x5f26f8(_0x581750,_0x45cb31);_0x55a521[_0xfd52a1(0x14f2)]&&(_0x4b691c[_0xfd52a1(0x208)][_0xfd52a1(0x8cb)]=_0x4b691c[_0xfd52a1(0x208)][_0xfd52a1(0xe26)],_0x45cb31[_0xfd52a1(0xe2e)]=!![]),_0x55a521[_0xfd52a1(0xce7)]&&(_0x4b691c['nightActions'][_0xfd52a1(0x111d)]=_0x55a521[_0xfd52a1(0xce7)],_0x45cb31[_0xfd52a1(0xf54)]=!![]);}else{if(!_0x45cb31[_0xfd52a1(0xe2e)]&&_0x581750){let _0x29d19f=0x0;_0x4b691c[_0xfd52a1(0x14b0)]===0x1?_0x29d19f=0.3:_0x29d19f=0.8,console['log'](_0xfd52a1(0x134e)+_0x4b691c[_0xfd52a1(0x14b0)]+_0xfd52a1(0x5a8)+_0x29d19f*0x64+'%'),Math[_0xfd52a1(0x13ae)]()<_0x29d19f?(console[_0xfd52a1(0x57e)](_0xfd52a1(0xd3d)),_0x4b691c[_0xfd52a1(0x208)][_0xfd52a1(0x8cb)]=_0x4b691c[_0xfd52a1(0x208)][_0xfd52a1(0xe26)],_0x45cb31[_0xfd52a1(0xe2e)]=!![]):console['log'](_0xfd52a1(0x13eb));}if(!_0x4b691c['nightActions'][_0xfd52a1(0x8cb)]&&!_0x45cb31[_0xfd52a1(0xf54)]&&Math[_0xfd52a1(0x13ae)]()<0.5){const _0x5918f7=_0x4b691c[_0xfd52a1(0xae3)][_0xfd52a1(0xede)](_0xb1070d=>_0xb1070d['isAlive']&&_0xb1070d['id']!==_0x4b691c[_0xfd52a1(0x208)][_0xfd52a1(0xe26)]);if(_0x5918f7[_0xfd52a1(0x58a)]>0x0){const _0x3ad408=_0x5918f7[Math[_0xfd52a1(0x123c)](Math[_0xfd52a1(0x13ae)]()*_0x5918f7['length'])];_0x4b691c[_0xfd52a1(0x208)][_0xfd52a1(0x111d)]=_0x3ad408['id'],_0x45cb31['poisonUsed']=!![],console[_0xfd52a1(0x57e)](_0xfd52a1(0x7a2)+_0x3ad408[_0xfd52a1(0x5d2)]);}}}_0x3d2f5f(_0xfd52a1(0x240)),_0x5cbf84(),await new Promise(_0x207819=>setTimeout(_0x207819,0x5dc));}const _0x18cbfe=_0x4b691c[_0xfd52a1(0xae3)][_0xfd52a1(0x13b7)](_0x2368f8=>_0x2368f8[_0xfd52a1(0xfbb)]===_0xfd52a1(0xd82)&&_0x2368f8[_0xfd52a1(0x6f3)]);if(_0x18cbfe){_0x3d2f5f('预言家请睁眼，请选择要查验的玩家。'),_0x5cbf84();if(_0x18cbfe['id']===_0xfd52a1(0x860)){const _0x251264=await _0x25c273(_0xfd52a1(0x13d1)),_0x1538a8=_0x4b691c[_0xfd52a1(0xae3)][_0xfd52a1(0x13b7)](_0x58c2ae=>_0x58c2ae['id']===_0x251264);if(_0x1538a8){const _0x4b4463=_0x1538a8[_0xfd52a1(0xfbb)]==='狼人';await _0x1460c5(_0xfd52a1(0x807),'你查验的玩家\x20'+_0x1538a8[_0xfd52a1(0x5d2)]+_0xfd52a1(0xc70)+(_0x4b4463?'狼人':'好人')),_0x4b691c['nightActions'][_0xfd52a1(0xab5)]={'target':_0x251264,'result':_0x4b4463?'狼人':'好人'};}}else{const _0x24ccd1=_0x4b691c['players'][_0xfd52a1(0xede)](_0xc8b5f6=>_0xc8b5f6[_0xfd52a1(0x6f3)]&&_0xc8b5f6['id']!==_0x18cbfe['id']);if(_0x24ccd1[_0xfd52a1(0x58a)]>0x0){const _0x405759=_0x24ccd1[Math[_0xfd52a1(0x123c)](Math[_0xfd52a1(0x13ae)]()*_0x24ccd1[_0xfd52a1(0x58a)])];_0x4b691c[_0xfd52a1(0x208)][_0xfd52a1(0xab5)]={'target':_0x405759['id'],'result':_0x405759['role']==='狼人'?'狼人':'好人'};}}_0x3d2f5f(_0xfd52a1(0x14a3)),_0x5cbf84(),await new Promise(_0x529d3c=>setTimeout(_0x529d3c,0x5dc));}_0x2e38a0();}async function _0x2e38a0(){const _0x37a739=_0x2b1222;_0x4b691c[_0x37a739(0xb65)]='第'+_0x4b691c[_0x37a739(0x14b0)]+_0x37a739(0x1412),_0x4b691c[_0x37a739(0x128b)]={},_0x3d2f5f(_0x37a739(0xd97));const {killedId:_0x1dec09,guardedId:_0xa22da5,savedId:_0x3a2c14,poisonedId:_0x2b0bbf}=_0x4b691c[_0x37a739(0x208)],_0x4437e9=new Set();_0x1dec09&&_0x1dec09!==_0xa22da5&&_0x1dec09!==_0x3a2c14&&_0x4437e9[_0x37a739(0x6a4)](_0x1dec09);_0x2b0bbf&&_0x4437e9[_0x37a739(0x6a4)](_0x2b0bbf);if(_0x4437e9[_0x37a739(0xb51)]===0x0)_0x3d2f5f(_0x37a739(0x264));else for(const _0xa1ecf6 of _0x4437e9){const _0x3e975e=_0x4b691c[_0x37a739(0xae3)][_0x37a739(0x13b7)](_0x3093f1=>_0x3093f1['id']===_0xa1ecf6);if(_0x3e975e&&_0x3e975e[_0x37a739(0x6f3)]){_0x3e975e[_0x37a739(0x6f3)]=![],_0x3d2f5f(_0x37a739(0x13f0)+_0x3e975e[_0x37a739(0x5d2)]+_0x37a739(0xf1b));if(_0x3e975e[_0x37a739(0xfbb)]==='猎人'){_0x3d2f5f(_0x37a739(0xc7a)),_0x5cbf84();let _0x1bf2b3=null;if(_0x3e975e['id']==='user')_0x1bf2b3=await _0x25c273(_0x37a739(0xfe9));else{const _0x4bf04b=_0x4b691c[_0x37a739(0xae3)][_0x37a739(0xede)](_0x4d904e=>_0x4d904e['isAlive']&&_0x4d904e['id']!==_0x3e975e['id']);_0x4bf04b[_0x37a739(0x58a)]>0x0&&(_0x1bf2b3=_0x4bf04b[Math[_0x37a739(0x123c)](Math[_0x37a739(0x13ae)]()*_0x4bf04b[_0x37a739(0x58a)])]['id']);}const _0x426b7c=_0x4b691c[_0x37a739(0xae3)][_0x37a739(0x13b7)](_0x5dc0b5=>_0x5dc0b5['id']===_0x1bf2b3);_0x426b7c&&(_0x426b7c[_0x37a739(0x6f3)]=![],_0x3d2f5f('猎人带走了\x20'+_0x426b7c['name']+'。'));}}}_0x5cbf84();if(_0x4afcdf())return;await _0x3ceabd();}async function _0x3ceabd(){const _0x3cf84d=_0x2b1222;_0x3d2f5f(_0x3cf84d(0x832)),_0x5cbf84();const {proxyUrl:_0x5a6b94,apiKey:_0x406174,model:_0x31940b}=_0x1ae02e[_0x3cf84d(0x226)];if(!_0x5a6b94||!_0x406174||!_0x31940b){alert('API未配置，无法生成对话。');return;}const _0x15db4c=_0x129144();_0x4b691c[_0x3cf84d(0x6dc)]=_0x3cf84d(0x978);try{await _0x1460c5(_0x3cf84d(0x493),'正在等待AI角色们进行激烈的讨论...');let _0xc37752=_0x5a6b94[_0x3cf84d(0xe82)](_0x3cf84d(0xc38)),_0x616bbb=[{'role':_0x3cf84d(0x860),'content':_0x3cf84d(0x168)}],_0x4ba90d=_0x16b978(_0x31940b,_0x406174,_0x15db4c,_0x616bbb);const _0x26e2ec=_0xc37752?await fetch(_0x4ba90d['url'],_0x4ba90d[_0x3cf84d(0xc6b)]):await fetch(_0x5a6b94+'/v1/chat/completions',{'method':_0x3cf84d(0x12d9),'headers':{'Content-Type':_0x3cf84d(0xa90),'Authorization':_0x3cf84d(0xf03)+_0x406174},'body':JSON[_0x3cf84d(0x994)]({'model':_0x31940b,'messages':[{'role':_0x3cf84d(0x1594),'content':_0x15db4c},..._0x616bbb],'temperature':_0x1ae02e[_0x3cf84d(0x12c0)][_0x3cf84d(0x217)]||0.95})});if(!_0x26e2ec['ok']){const _0x183d90=await _0x26e2ec[_0x3cf84d(0xb84)]();throw new Error(_0x3cf84d(0xaa6)+_0x183d90['error'][_0x3cf84d(0x11f0)]);}const _0x3bcc5d=await _0x26e2ec['json'](),_0x20a8e9=getGeminiResponseText(_0x3bcc5d),_0x4d92fc=_0x20a8e9['match'](/(\[[\s\S]*\])/);if(!_0x4d92fc)throw new Error(_0x3cf84d(0x9ac)+_0x20a8e9);const _0x31c398=JSON['parse'](_0x4d92fc[0x0]);for(const _0x449950 of _0x31c398){_0x449950[_0x3cf84d(0xb19)]&&_0x449950[_0x3cf84d(0xdf2)]&&(_0x3f8883(_0x449950['speaker_name'],_0x449950[_0x3cf84d(0xdf2)]),_0x5cbf84(),await new Promise(_0x37addb=>setTimeout(_0x37addb,0x5dc+Math[_0x3cf84d(0x13ae)]()*0x7d0)));}_0x4b691c[_0x3cf84d(0x6dc)]=null;}catch(_0x3f36a7){console[_0x3cf84d(0x127d)](_0x3cf84d(0x151d),_0x3f36a7),await _0x1460c5(_0x3cf84d(0xa1b),_0x3cf84d(0xf9d)+_0x3f36a7[_0x3cf84d(0x11f0)]),document['getElementById'](_0x3cf84d(0x888))[_0x3cf84d(0x215)]['display']='block';return;}const _0xe08525=_0x4b691c[_0x3cf84d(0xae3)][_0x3cf84d(0x13b7)](_0x53a857=>_0x53a857['id']===_0x3cf84d(0x860)),_0x3b78db=document[_0x3cf84d(0x1f4)](_0x3cf84d(0x1fd)),_0x27f8ac=document[_0x3cf84d(0x1f4)](_0x3cf84d(0x15b0)),_0x9cfab0=document[_0x3cf84d(0x1f4)]('werewolf-finish-speech-btn'),_0x1592e3=document[_0x3cf84d(0x1f4)](_0x3cf84d(0x1208));_0x3b78db[_0x3cf84d(0x215)][_0x3cf84d(0x887)]=_0x3cf84d(0xeba);if(_0xe08525&&_0xe08525[_0x3cf84d(0x6f3)]){_0x27f8ac[_0x3cf84d(0x231)]=_0x3cf84d(0xf41),_0x9cfab0[_0x3cf84d(0x231)]=_0x3cf84d(0x3c8),_0x27f8ac[_0x3cf84d(0x215)][_0x3cf84d(0x887)]='block',_0x9cfab0['style'][_0x3cf84d(0x887)]=_0x3cf84d(0x361),_0x1592e3[_0x3cf84d(0xa0d)]=![],_0x1592e3['placeholder']='轮到你发言了...',_0x1592e3['focus']();const _0x2415d3=_0x27f8ac[_0x3cf84d(0xf44)](!![]);_0x27f8ac[_0x3cf84d(0xad7)][_0x3cf84d(0xa88)](_0x2415d3,_0x27f8ac),_0x2415d3[_0x3cf84d(0x122b)](_0x3cf84d(0x740),_0x1aadfe);const _0x3e4333=_0x9cfab0[_0x3cf84d(0xf44)](!![]);_0x9cfab0[_0x3cf84d(0xad7)][_0x3cf84d(0xa88)](_0x3e4333,_0x9cfab0),_0x3e4333[_0x3cf84d(0x122b)]('click',_0xa14269);}else{_0x3d2f5f(_0x3cf84d(0x1230)),_0x5cbf84(),_0x27f8ac[_0x3cf84d(0x231)]=_0x3cf84d(0xc3b),_0x9cfab0['textContent']=_0x3cf84d(0x1526),_0x27f8ac[_0x3cf84d(0x215)][_0x3cf84d(0x887)]='block',_0x9cfab0[_0x3cf84d(0x215)]['display']=_0x3cf84d(0x361),_0x1592e3[_0x3cf84d(0xa0d)]=!![],_0x1592e3[_0x3cf84d(0xced)]='你已死亡，正在围观...';const _0x4ead06=_0x27f8ac[_0x3cf84d(0xf44)](!![]);_0x27f8ac[_0x3cf84d(0xad7)][_0x3cf84d(0xa88)](_0x4ead06,_0x27f8ac),_0x4ead06[_0x3cf84d(0x122b)](_0x3cf84d(0x740),_0x5d5c00);const _0x1299db=_0x9cfab0[_0x3cf84d(0xf44)](!![]);_0x9cfab0[_0x3cf84d(0xad7)][_0x3cf84d(0xa88)](_0x1299db,_0x9cfab0),_0x1299db['addEventListener'](_0x3cf84d(0x740),_0x942cbc);}}function _0x129144(){const _0x581e3f=_0x2b1222,_0x5bfe49=_0x4b691c[_0x581e3f(0xae3)][_0x581e3f(0xede)](_0x5d8874=>_0x5d8874[_0x581e3f(0x6f3)]),_0x5f504b=_0x4b691c[_0x581e3f(0xae3)][_0x581e3f(0x13b7)](_0x4fcdbf=>_0x4fcdbf['id']===_0x581e3f(0x860)),_0x158179=_0x5f504b?_0x5f504b[_0x581e3f(0x5d2)]:'用户',_0x5d61cf=_0x5bfe49['some'](_0x41d2dd=>_0x41d2dd['id']==='user');let _0x3227aa=_0x581e3f(0x11e2);_0x3227aa+=_0x581e3f(0x823),_0x5bfe49[_0x581e3f(0x59b)]((_0x440fba,_0x18d741)=>{const _0x328451=_0x581e3f,_0x1493d3=_0x4b691c[_0x328451(0xae3)]['findIndex'](_0x582f0e=>_0x582f0e['id']===_0x440fba['id'])+0x1;let _0x39fc6a='';const _0x35febd=_0x1ae02e[_0x328451(0x589)][_0x440fba['id']];if(_0x35febd){const _0x5afaa7=_0x5bfe49[_0x328451(0xede)](_0x9f0c0d=>_0x9f0c0d['id']!==_0x440fba['id']&&_0x1ae02e[_0x328451(0x589)][_0x9f0c0d['id']]&&_0x1ae02e[_0x328451(0x589)][_0x9f0c0d['id']]['groupId']===_0x35febd[_0x328451(0x67d)]&&_0x35febd[_0x328451(0x67d)]!==null)[_0x328451(0x1431)](_0x40c74c=>_0x40c74c[_0x328451(0x5d2)])[_0x328451(0x1143)]('、');_0x5afaa7&&(_0x39fc6a+=_0x328451(0x129a)+_0x5afaa7+_0x328451(0x67a));}_0x440fba['id']!==_0x328451(0x860)&&(_0x39fc6a+=_0x328451(0xa4b)+_0x158179+_0x328451(0x896));_0x3227aa+=_0x328451(0x1599)+_0x1493d3+_0x328451(0x137d)+_0x440fba[_0x328451(0x5d2)]+_0x328451(0xce2)+_0x440fba[_0x328451(0x96f)]+_0x328451(0x2b6)+(_0x440fba['id']==='user'?_0x328451(0x586):'【AI角色】')+_0x328451(0x6d4)+_0x440fba[_0x328451(0x1038)]+'\x0a';if(_0x440fba['type']===_0x328451(0x1381)){const _0x2683d7=_0x1ae02e['chats'][_0x440fba['id']];if(_0x2683d7&&_0x2683d7[_0x328451(0x5fb)]&&_0x2683d7[_0x328451(0x5fb)][_0x328451(0x58a)]>0x0){const _0xb39e0e=_0x2683d7[_0x328451(0x5fb)][_0x328451(0x1431)](_0x2b688f=>_0x2b688f[_0x328451(0x128c)])[_0x328451(0x1143)](';\x20');_0x3227aa+=_0x328451(0x376)+_0xb39e0e+'\x0a';}}_0x39fc6a&&(_0x3227aa+=_0x328451(0x232)+_0x39fc6a);});let _0x48da7e=_0x581e3f(0xf24);_0x48da7e+=_0x581e3f(0x5a1);const _0x219ade=_0x4b691c[_0x581e3f(0xc48)][_0x581e3f(0xede)](_0x3ea7a0=>_0x3ea7a0[_0x581e3f(0x128c)][_0x581e3f(0xe82)](_0x581e3f(0x392))&&_0x3ea7a0['day']===_0x4b691c[_0x581e3f(0x14b0)]);_0x219ade['length']===0x0?_0x48da7e+=_0x581e3f(0xc76):_0x219ade[_0x581e3f(0x59b)](_0x14b582=>{const _0x49dfdd=_0x581e3f;_0x48da7e+='-\x20'+_0x14b582[_0x49dfdd(0x128c)]+'\x0a';});let _0x5dc0ec=_0x581e3f(0xd8c);if(_0x4b691c[_0x581e3f(0x14b0)]>0x1)for(let _0x2d93de=0x1;_0x2d93de<_0x4b691c[_0x581e3f(0x14b0)];_0x2d93de++){_0x5dc0ec+=_0x581e3f(0x1227)+_0x2d93de+_0x581e3f(0xb94);const _0x580f1b=_0x4b691c[_0x581e3f(0xc48)][_0x581e3f(0xede)](_0x3af985=>_0x3af985['day']===_0x2d93de&&(_0x3af985['content'][_0x581e3f(0xe82)]('死亡')||_0x3af985[_0x581e3f(0x128c)][_0x581e3f(0xe82)]('放逐')));_0x580f1b[_0x581e3f(0x58a)]>0x0?_0x5dc0ec+=_0x581e3f(0x801)+_0x580f1b[_0x581e3f(0x1431)](_0x287619=>_0x287619[_0x581e3f(0x128c)])[_0x581e3f(0x1143)]('\x20')+'\x0a':_0x5dc0ec+='*事件*:\x20平安夜，无人出局。\x0a';const _0x59f4f9=_0x4b691c['discussionLog'][_0x581e3f(0xede)](_0x43ba69=>_0x43ba69[_0x581e3f(0x1449)]===_0x2d93de);_0x59f4f9[_0x581e3f(0x58a)]>0x0&&(_0x5dc0ec+='*讨论记录*:\x0a'+_0x59f4f9[_0x581e3f(0x1431)](_0x2dfccd=>'-\x20'+_0x2dfccd[_0x581e3f(0x9dc)]+':\x20'+_0x2dfccd[_0x581e3f(0x128c)])[_0x581e3f(0x1143)]('\x0a')+'\x0a');}else _0x5dc0ec+='(今天是第一天，没有历史记录)\x0a';let _0x3a0e49=_0x581e3f(0xeca);const _0x24047e=_0x4b691c['discussionLog'][_0x581e3f(0xede)](_0xfd5271=>_0xfd5271[_0x581e3f(0x1449)]===_0x4b691c['currentDay']);_0x24047e['length']>0x0?_0x3a0e49+=_0x24047e[_0x581e3f(0x1431)](_0x3c5623=>_0x581e3f(0x6ca)+_0x3c5623['speaker']+'**:\x20'+_0x3c5623[_0x581e3f(0x128c)])[_0x581e3f(0x1143)]('\x0a'):_0x3a0e49+='(你是第一个发言的人)';let _0x39e2f0=_0x581e3f(0x418);_0x5bfe49[_0x581e3f(0x59b)](_0x391577=>{const _0x4c0cd7=_0x581e3f;if(_0x391577['id']!==_0x4c0cd7(0x860)){const _0x4c3822=_0x4b691c['players'][_0x4c0cd7(0xf2d)](_0x4e9058=>_0x4e9058['id']===_0x391577['id'])+0x1;_0x39e2f0+=_0x4c0cd7(0x3ae)+_0x4c3822+'号玩家:\x20'+_0x391577[_0x4c0cd7(0x5d2)]+_0x4c0cd7(0x85b)+_0x391577[_0x4c0cd7(0x96f)]+')\x0a\x0a####\x20阶段\x20A：数据输入\x20(Data\x20Input)\x0a1.\x20\x20**我的秘密身份**:\x20我是【'+_0x391577[_0x4c0cd7(0xfbb)]+_0x4c0cd7(0x816);let _0x5b28e9='';if(_0x391577[_0x4c0cd7(0xfbb)]==='狼人'){const _0xf30b40=_0x4b691c[_0x4c0cd7(0xae3)][_0x4c0cd7(0xede)](_0xd2c63f=>_0xd2c63f[_0x4c0cd7(0xfbb)]==='狼人'&&_0xd2c63f['id']!==_0x391577['id']&&_0xd2c63f['isAlive'])[_0x4c0cd7(0x1431)](_0x554350=>_0x554350['name'])[_0x4c0cd7(0x1143)]('、');_0x5b28e9+='\x20\x20\x20\x20-\x20我的狼队友是：'+(_0xf30b40||'无')+'\x0a';const _0x1d83aa=_0x4b691c[_0x4c0cd7(0xae3)]['find'](_0x25c637=>_0x25c637['id']===_0x4b691c[_0x4c0cd7(0x208)][_0x4c0cd7(0xe26)]);_0x5b28e9+=_0x4c0cd7(0xf70)+(_0x1d83aa?_0x1d83aa[_0x4c0cd7(0x5d2)]:'空刀')+'\x0a';}if(_0x391577[_0x4c0cd7(0xfbb)]===_0x4c0cd7(0xd82)&&_0x4b691c[_0x4c0cd7(0x208)][_0x4c0cd7(0xab5)]){const _0x168e5=_0x4b691c[_0x4c0cd7(0xae3)][_0x4c0cd7(0x13b7)](_0x540395=>_0x540395['id']===_0x4b691c[_0x4c0cd7(0x208)][_0x4c0cd7(0xab5)]['target']);_0x5b28e9+=_0x4c0cd7(0x139d)+_0x168e5[_0x4c0cd7(0x5d2)]+_0x4c0cd7(0xe23)+_0x4b691c[_0x4c0cd7(0x208)][_0x4c0cd7(0xab5)][_0x4c0cd7(0xbc9)]+'】\x0a';}if(_0x391577[_0x4c0cd7(0xfbb)]==='女巫'){if(_0x4b691c[_0x4c0cd7(0x208)]['savedId']){const _0x73cb33=_0x4b691c[_0x4c0cd7(0xae3)]['find'](_0x16b954=>_0x16b954['id']===_0x4b691c[_0x4c0cd7(0x208)][_0x4c0cd7(0x8cb)]);_0x5b28e9+=_0x4c0cd7(0xca9)+_0x73cb33[_0x4c0cd7(0x5d2)]+'。\x0a';}if(_0x4b691c[_0x4c0cd7(0x208)][_0x4c0cd7(0x111d)]){const _0x380ca3=_0x4b691c[_0x4c0cd7(0xae3)]['find'](_0x31b577=>_0x31b577['id']===_0x4b691c[_0x4c0cd7(0x208)][_0x4c0cd7(0x111d)]);_0x5b28e9+=_0x4c0cd7(0x18e)+_0x380ca3[_0x4c0cd7(0x5d2)]+'。\x0a';}_0x5b28e9+=_0x4c0cd7(0x6e9)+(_0x391577[_0x4c0cd7(0xe2e)]?_0x4c0cd7(0x12b4):'未使用')+'\x0a',_0x5b28e9+=_0x4c0cd7(0xd61)+(_0x391577[_0x4c0cd7(0xf54)]?_0x4c0cd7(0x12b4):'未使用')+'\x0a';}if(_0x391577[_0x4c0cd7(0xfbb)]==='守卫'){if(_0x4b691c[_0x4c0cd7(0x208)][_0x4c0cd7(0x406)]){const _0x303ff4=_0x4b691c['players'][_0x4c0cd7(0x13b7)](_0x27f019=>_0x27f019['id']===_0x4b691c['nightActions'][_0x4c0cd7(0x406)]);_0x5b28e9+=_0x4c0cd7(0x967)+_0x303ff4[_0x4c0cd7(0x5d2)]+'。\x0a';}else _0x5b28e9+=_0x4c0cd7(0xd94);}_0x5b28e9===''&&(_0x5b28e9=_0x4c0cd7(0xb75));_0x39e2f0+=_0x5b28e9,_0x39e2f0+=_0x4c0cd7(0x1527)+_0x48da7e[_0x4c0cd7(0xef0)](/\n/g,'\x20')+_0x4c0cd7(0x55b)+_0x3a0e49[_0x4c0cd7(0xef0)](/\n/g,'\x20')+'\x0a4.\x20\x20**我的人设与社交关系**:\x0a\x20\x20\x20\x20-\x20**人设**:\x20'+_0x391577[_0x4c0cd7(0x1038)]+_0x4c0cd7(0x13c8);let _0x48cf3='';const _0x3dc449=_0x1ae02e[_0x4c0cd7(0x589)][_0x391577['id']];if(_0x3dc449){const _0x5075a8=_0x5bfe49[_0x4c0cd7(0xede)](_0x29487d=>_0x29487d['id']!==_0x391577['id']&&_0x1ae02e['chats'][_0x29487d['id']]&&_0x1ae02e[_0x4c0cd7(0x589)][_0x29487d['id']][_0x4c0cd7(0x67d)]===_0x3dc449[_0x4c0cd7(0x67d)]&&_0x3dc449['groupId']!==null)['map'](_0x3d30c3=>_0x3d30c3[_0x4c0cd7(0x5d2)])['join']('、');_0x5075a8&&(_0x48cf3+=_0x4c0cd7(0xdd4)+_0x5075a8+_0x4c0cd7(0x12b1));}_0x391577['id']!==_0x4c0cd7(0x860)&&(_0x48cf3+='\x20\x20\x20\x20\x20\x20-\x20'+_0x158179+_0x4c0cd7(0x77f)),_0x48cf3===''&&(_0x48cf3='\x20\x20\x20\x20\x20\x20-\x20我在此次游戏中没有特别的社交关系。\x0a'),_0x39e2f0+=_0x48cf3,_0x39e2f0+=_0x4c0cd7(0x6ff)+_0x158179+')。\x0a2.\x20\x20**G\x20(Game\x20-\x20游戏互动)**:\x20针对【今日讨论】中\x20'+(_0x24047e[_0x4c0cd7(0x58a)]>0x0?'其他人的发言':_0x4c0cd7(0x10a9))+_0x4c0cd7(0x396)+_0x158179+_0x4c0cd7(0x20d)+_0x158179+_0x4c0cd7(0xcf0)+_0x391577[_0x4c0cd7(0xfbb)]+_0x4c0cd7(0x25e)+_0x391577['character_persona']['substring'](0x0,0x14)+_0x4c0cd7(0xff3);}}),_0x39e2f0+=_0x581e3f(0x64f);const _0x1297a0=_0x581e3f(0x1031)+(_0x5d61cf?_0x581e3f(0x98e)+_0x158179+')':_0x581e3f(0x1284)+_0x158179+')')+'以外的所有AI角色，并根据他们的【角色人设】和【狼人杀身份】，生成一整轮符合逻辑、充满博弈的发言。\x0a\x0a#\x20身份与人设铁律\x20(最高优先级)\x0a你【必须】为每一个角色都仔细阅读并严格遵守下面的档案。这是你所有行为和发言的唯一依据。在对话中，请务必注意角色人设中暗示的性别，并使用正确的称呼（例如“他”或“她”）。\x0a\x0a'+_0x3227aa+_0x581e3f(0xc23)+(_0x4b691c['gameMode']==='12p'?_0x581e3f(0x98a):_0x581e3f(0xe8a))+_0x581e3f(0x1a4)+_0x4b691c['currentDay']+_0x581e3f(0x120d)+_0x48da7e+_0x581e3f(0x1598)+_0x5bfe49['map'](_0x4ba290=>_0x4ba290['name']+'\x20('+(_0x4ba290['id']===_0x581e3f(0x860)?'用户':'AI')+')')[_0x581e3f(0x1143)](',\x20')+_0x581e3f(0x1005)+_0x158179+_0x581e3f(0x898)+_0x5dc0ec+_0x581e3f(0x12e6)+_0x3a0e49+'\x0a\x0a'+_0x39e2f0+_0x581e3f(0xa23);return _0x1297a0;}function _0x5fc463(_0xa6052c){const _0x16458d=_0x2b1222;let _0x3f61e7=_0x16458d(0x419);const _0x49e893=_0xa6052c[_0x16458d(0xc48)]['find'](_0x1e626a=>_0x1e626a[_0x16458d(0x128c)]['includes']('胜利'))?.[_0x16458d(0x128c)]||_0x16458d(0xc46);_0x3f61e7+=_0x16458d(0xb31)+_0x49e893+'\x0a\x0a',_0x3f61e7+=_0x16458d(0x1d5),_0xa6052c[_0x16458d(0xae3)][_0x16458d(0x59b)](_0xa10eec=>{const _0xc69227=_0x16458d,_0x41a970=_0xa10eec[_0xc69227(0x6f3)]?'存活':_0xc69227(0x56e);_0x3f61e7+='-\x20'+_0xa10eec[_0xc69227(0x5d2)]+':\x20'+_0xa10eec[_0xc69227(0xfbb)]+'\x20('+_0x41a970+')\x0a';}),_0x3f61e7+=_0x16458d(0x8c4);for(let _0x1fffcd=0x1;_0x1fffcd<=_0xa6052c[_0x16458d(0x14b0)];_0x1fffcd++){_0x3f61e7+=_0x16458d(0x1227)+_0x1fffcd+_0x16458d(0xb94);const _0x55d27e=_0xa6052c[_0x16458d(0xc48)][_0x16458d(0xede)](_0xe797bc=>_0xe797bc[_0x16458d(0x1449)]===_0x1fffcd&&_0xe797bc[_0x16458d(0x128c)][_0x16458d(0xe82)]('死亡'));if(_0x55d27e[_0x16458d(0x58a)]>0x0)_0x3f61e7+=_0x16458d(0x9e6)+_0x55d27e[_0x16458d(0x1431)](_0x11dc65=>_0x11dc65['content'])[_0x16458d(0x1143)]('\x20')+'\x0a';else(_0x1fffcd>0x1||_0x1fffcd===0x1&&_0xa6052c[_0x16458d(0x14b0)]>0x1)&&(_0x3f61e7+=_0x16458d(0x4b6));const _0x3daea6=_0xa6052c['discussionLog'][_0x16458d(0xede)](_0x13fe64=>_0x13fe64['day']===_0x1fffcd);_0x3daea6[_0x16458d(0x58a)]>0x0&&(_0x3f61e7+=_0x16458d(0x716)+_0x3daea6[_0x16458d(0x1431)](_0x8eed9e=>'-\x20'+_0x8eed9e[_0x16458d(0x9dc)]+':\x20'+_0x8eed9e[_0x16458d(0x128c)])[_0x16458d(0x1143)]('\x0a')+'\x0a');const _0x2c5dc7=_0xa6052c[_0x16458d(0xc48)][_0x16458d(0x13b7)](_0x424595=>_0x424595[_0x16458d(0x1449)]===_0x1fffcd&&_0x424595[_0x16458d(0x128c)]['includes'](_0x16458d(0xa5e)));_0x2c5dc7&&(_0x3f61e7+=_0x16458d(0x7bd)+_0x2c5dc7[_0x16458d(0x128c)]+'\x0a');}return _0x3f61e7+=_0x16458d(0x14c8),_0x3f61e7;}async function _0x2083ce(_0x42fd62){const _0x41f291=_0x2b1222;let _0x4165e5=0x0;for(const _0x397cf2 of _0x4b691c['players']){if(_0x397cf2[_0x41f291(0xcbd)]===_0x41f291(0x1381)){const _0x122e26=_0x1ae02e[_0x41f291(0x589)][_0x397cf2['id']];if(_0x122e26){const _0x37d53d={'content':_0x42fd62,'timestamp':Date[_0x41f291(0xd6e)](),'source':_0x41f291(0xc97)};!_0x122e26[_0x41f291(0x5fb)]&&(_0x122e26[_0x41f291(0x5fb)]=[]),_0x122e26[_0x41f291(0x5fb)][_0x41f291(0x1426)](_0x37d53d),await _0x3df81a['chats'][_0x41f291(0x295)](_0x122e26),_0x4165e5++;}}}return _0x4165e5;}async function _0x5268df(){const _0x494b0b=_0x2b1222;if(!_0x4b691c[_0x494b0b(0xd51)]&&_0x4b691c[_0x494b0b(0xb65)]==='gameover'){await _0x1460c5(_0x494b0b(0x11b7),'正在为所有AI角色生成并注入游戏记忆...');try{const _0x5ec9d1=_0x5fc463(_0x4b691c),_0x483ab5=await _0x2083ce(_0x5ec9d1);await _0x1460c5('成功','游戏记忆已成功注入到\x20'+_0x483ab5+_0x494b0b(0x1314));}catch(_0x1e7c95){console['error']('手动注入狼人杀记忆失败:',_0x1e7c95),await _0x1460c5('失败',_0x494b0b(0xf65)+_0x1e7c95[_0x494b0b(0x11f0)]);}}else alert('游戏尚未结束，无法进行总结。');}async function _0x35d5f9(_0x1cbf4a){const _0x24b20c=_0x2b1222;_0x4b691c['isActive']=![],_0x4b691c[_0x24b20c(0xb65)]=_0x24b20c(0xb8e),_0x3d2f5f(_0x1cbf4a+_0x24b20c(0x4f7)),document['getElementById']('werewolf-game-over-title')['textContent']=_0x1cbf4a+'胜利！';let _0xed2e59='';_0x1cbf4a==='好人'?_0xed2e59=_0x24b20c(0x1474):_0xed2e59='狼人数量已达到胜利条件，狼人阵营获得了胜利！';const _0x3ea112=document[_0x24b20c(0x1f4)](_0x24b20c(0xe3b));_0x3ea112['textContent']=_0xed2e59;const _0xc76386=document['getElementById']('werewolf-role-reveal-list');_0xc76386[_0x24b20c(0xf21)]='';const _0x3aafad=[..._0x4b691c['players']]['sort']((_0x229d46,_0x6d3f3b)=>{const _0x14cc14=_0x24b20c,_0x1a63d8=_0x4b691c[_0x14cc14(0xae3)][_0x14cc14(0xf2d)](_0x471c61=>_0x471c61['id']===_0x229d46['id']),_0x480d58=_0x4b691c[_0x14cc14(0xae3)]['findIndex'](_0x45061e=>_0x45061e['id']===_0x6d3f3b['id']);return _0x1a63d8-_0x480d58;});_0x3aafad[_0x24b20c(0x59b)]((_0x58710e,_0x4f11f4)=>{const _0x124c8=_0x24b20c,_0x1fab44=document[_0x124c8(0x219)](_0x124c8(0xaf9));_0x1fab44[_0x124c8(0x215)][_0x124c8(0x519)]=_0x124c8(0x243);if(_0x4f11f4===_0x3aafad[_0x124c8(0x58a)]-0x1)_0x1fab44[_0x124c8(0x215)][_0x124c8(0x452)]=_0x124c8(0x1b5);const _0x3b01b5=_0x58710e[_0x124c8(0xfbb)]==='狼人'?_0x124c8(0x5d8):_0x124c8(0xfd6);_0x1fab44[_0x124c8(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x58710e[_0x124c8(0x95b)]+_0x124c8(0x1d3)+(_0x58710e[_0x124c8(0x6f3)]?_0x124c8(0x1b5):'grayscale(100%)')+_0x124c8(0x10cd)+(_0x58710e[_0x124c8(0x6f3)]?_0x124c8(0x1b5):_0x124c8(0x546))+_0x124c8(0x744)+(_0x4f11f4+0x1)+'.\x20'+_0x58710e[_0x124c8(0x5d2)]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong\x20style=\x22color:\x20'+_0x3b01b5+';\x22>'+_0x58710e[_0x124c8(0xfbb)]+_0x124c8(0x124d),_0xc76386[_0x124c8(0x6ce)](_0x1fab44);}),document['getElementById'](_0x24b20c(0x2ae))[_0x24b20c(0x159b)][_0x24b20c(0x6a4)](_0x24b20c(0xfca));try{console[_0x24b20c(0x57e)]('游戏结束，开始自动总结并注入记忆...');const _0x3c2a47=_0x5fc463(_0x4b691c),_0x151df5=await generateAndInjectWerewolfMemories(_0x3c2a47);console['log'](_0x24b20c(0xce6)+_0x151df5+_0x24b20c(0x1407));}catch(_0x324d98){console[_0x24b20c(0x127d)]('自动总结狼人杀游戏失败:',_0x324d98),_0x3ea112&&(_0x3ea112[_0x24b20c(0xf21)]+=_0x24b20c(0x18b));}}function _0x3d2f5f(_0x19fb00){const _0x514d83=_0x2b1222;_0x4b691c[_0x514d83(0xc48)]['push']({'type':_0x514d83(0x1594),'content':_0x19fb00,'timestamp':Date[_0x514d83(0xd6e)](),'day':_0x4b691c[_0x514d83(0x14b0)]});}function _0x3f8883(_0x33fe20,_0x1e54d2){const _0x3e26fa=_0x2b1222;_0x4b691c['discussionLog'][_0x3e26fa(0x1426)]({'type':_0x3e26fa(0xdf2),'speaker':_0x33fe20,'content':_0x1e54d2,'timestamp':Date['now'](),'day':_0x4b691c[_0x3e26fa(0x14b0)]});}function _0x25c273(_0x996cad){return new Promise(_0x31e21b=>{const _0xf6686c=_0x475c,_0x546779=_0xf6686c(0xf81)+_0x996cad+_0xf6686c(0xa96),_0x2914f2='werewolf-'+_0x996cad+_0xf6686c(0x763);let _0x10d7d6='';if(_0x996cad===_0xf6686c(0x13d1))_0x10d7d6=_0xf6686c(0x8c0);if(_0x996cad==='hunter')_0x10d7d6=_0xf6686c(0xeff);if(_0x996cad===_0xf6686c(0xf28))_0x10d7d6='confirm-vote-btn';const _0x3bb30b=document[_0xf6686c(0x1f4)](_0x546779),_0x25a515=document[_0xf6686c(0x1f4)](_0x2914f2),_0x372dff=document['getElementById'](_0x10d7d6);_0x25a515[_0xf6686c(0xf21)]='';let _0x4d7fcd=null;const _0x206d06=_0x4b691c[_0xf6686c(0xae3)]['filter'](_0x141365=>_0x141365[_0xf6686c(0x6f3)]&&(_0x996cad==='hunter'||_0x996cad===_0xf6686c(0xf28)||_0x141365['id']!==_0xf6686c(0x860)));_0x206d06[_0xf6686c(0x59b)](_0x52262f=>{const _0x16a942=_0xf6686c,_0x3e7d7d=document[_0x16a942(0x219)](_0x16a942(0xaf9));_0x3e7d7d[_0x16a942(0x7c6)]=_0x16a942(0x11b6),_0x3e7d7d[_0x16a942(0x746)]['id']=_0x52262f['id'],_0x3e7d7d[_0x16a942(0xf21)]='<img\x20src=\x22'+_0x52262f[_0x16a942(0x95b)]+_0x16a942(0x304)+_0x52262f[_0x16a942(0x5d2)]+_0x16a942(0xa0c),_0x3e7d7d[_0x16a942(0x1199)]=()=>{const _0xa3f925=_0x16a942;_0x25a515[_0xa3f925(0x14bf)](_0xa3f925(0x1351))['forEach'](_0x404ba6=>_0x404ba6[_0xa3f925(0x159b)]['remove'](_0xa3f925(0xc3e))),_0x3e7d7d[_0xa3f925(0x159b)][_0xa3f925(0x6a4)](_0xa3f925(0xc3e)),_0x4d7fcd=_0x52262f['id'];},_0x25a515[_0x16a942(0x6ce)](_0x3e7d7d);});const _0x4ae829=_0x372dff[_0xf6686c(0xf44)](!![]);_0x372dff['parentNode'][_0xf6686c(0xa88)](_0x4ae829,_0x372dff),_0x4ae829[_0xf6686c(0x1199)]=()=>{const _0x34b43a=_0xf6686c;_0x4d7fcd?(_0x3bb30b[_0x34b43a(0x159b)][_0x34b43a(0xa9c)](_0x34b43a(0xfca)),_0x31e21b(_0x4d7fcd)):alert(_0x34b43a(0x93e));},_0x3bb30b[_0xf6686c(0x159b)]['add'](_0xf6686c(0xfca));});}function _0x557c92(){return new Promise(_0x149437=>{const _0x3e42ef=_0x475c,_0x36bb90=document[_0x3e42ef(0x1f4)]('werewolf-kill-modal'),_0x2b3bf5=document[_0x3e42ef(0x1f4)]('werewolf-kill-selection-list'),_0x1f5adf=document[_0x3e42ef(0x1f4)](_0x3e42ef(0x1272)),_0x3d1241=_0x36bb90['querySelector'](_0x3e42ef(0x192)),_0x481153=_0x4b691c['players'][_0x3e42ef(0xede)](_0x2b0dea=>_0x2b0dea[_0x3e42ef(0xfbb)]==='狼人'&&_0x2b0dea[_0x3e42ef(0x6f3)]),_0x2cf707=_0x481153['filter'](_0x3a8ab7=>_0x3a8ab7['id']!==_0x3e42ef(0x860))[_0x3e42ef(0x1431)](_0x46799f=>_0x46799f[_0x3e42ef(0x5d2)])[_0x3e42ef(0x1143)]('、');_0x2cf707?_0x3d1241['innerHTML']=_0x3e42ef(0x281)+_0x2cf707+_0x3e42ef(0x5f3):_0x3d1241['textContent']=_0x3e42ef(0xb47);_0x2b3bf5[_0x3e42ef(0xf21)]='';let _0x190c38=null;const _0xa98de5=_0x4b691c[_0x3e42ef(0xae3)]['filter'](_0x2950dc=>_0x2950dc['isAlive']&&_0x2950dc[_0x3e42ef(0xfbb)]!=='狼人');_0xa98de5[_0x3e42ef(0x59b)](_0x2e05a4=>{const _0x2d6a3f=_0x3e42ef,_0x496cca=document['createElement'](_0x2d6a3f(0xaf9));_0x496cca['className']=_0x2d6a3f(0x11b6),_0x496cca[_0x2d6a3f(0x746)]['id']=_0x2e05a4['id'],_0x496cca[_0x2d6a3f(0xf21)]=_0x2d6a3f(0xe40)+_0x2e05a4[_0x2d6a3f(0x95b)]+_0x2d6a3f(0x304)+_0x2e05a4[_0x2d6a3f(0x5d2)]+_0x2d6a3f(0xa0c),_0x496cca[_0x2d6a3f(0x1199)]=()=>{const _0x5e4900=_0x2d6a3f;_0x2b3bf5[_0x5e4900(0x14bf)]('.selected')[_0x5e4900(0x59b)](_0x10c70d=>_0x10c70d[_0x5e4900(0x159b)][_0x5e4900(0xa9c)]('selected')),_0x496cca[_0x5e4900(0x159b)][_0x5e4900(0x6a4)](_0x5e4900(0xc3e)),_0x190c38=_0x2e05a4['id'];},_0x2b3bf5['appendChild'](_0x496cca);});const _0x3712ae=_0x1f5adf[_0x3e42ef(0xf44)](!![]);_0x1f5adf[_0x3e42ef(0xad7)][_0x3e42ef(0xa88)](_0x3712ae,_0x1f5adf),_0x3712ae[_0x3e42ef(0x1199)]=()=>{const _0x3e937e=_0x3e42ef;_0x190c38?(_0x36bb90[_0x3e937e(0x159b)]['remove'](_0x3e937e(0xfca)),_0x149437(_0x190c38)):alert('请选择一个目标。');},_0x36bb90[_0x3e42ef(0x159b)][_0x3e42ef(0x6a4)](_0x3e42ef(0xfca));});}function _0xa14269(){const _0x487422=_0x2b1222,_0x246cfa=_0x4b691c[_0x487422(0xae3)][_0x487422(0x13b7)](_0x424617=>_0x424617['id']===_0x487422(0x860));if(!_0x246cfa||!_0x246cfa['isAlive'])return;const _0x1917d0=document[_0x487422(0x1f4)](_0x487422(0x1208)),_0x5045a7=_0x1917d0[_0x487422(0x107e)][_0x487422(0x4a2)]();_0x5045a7&&(_0x3f8883(_0x246cfa[_0x487422(0x5d2)],_0x5045a7),_0x5cbf84()),document[_0x487422(0x1f4)](_0x487422(0x1fd))[_0x487422(0x215)]['display']=_0x487422(0x1b5),_0x1917d0[_0x487422(0x107e)]='',_0x942cbc();}async function _0x5d5c00(){const _0x335d5e=_0x2b1222;_0x3d2f5f(_0x335d5e(0x12b0)),_0x5cbf84();const _0x409d5f=document[_0x335d5e(0x1f4)](_0x335d5e(0x15b0));if(_0x409d5f)_0x409d5f[_0x335d5e(0xa0d)]=!![];await _0x1460c5(_0x335d5e(0x493),_0x335d5e(0x118d));const {proxyUrl:_0x2f596e,apiKey:_0x1ab635,model:_0x12a6c4}=_0x1ae02e[_0x335d5e(0x226)];if(!_0x2f596e||!_0x1ab635||!_0x12a6c4){alert(_0x335d5e(0x8b4));return;}const _0x4be14f=_0x129144();try{let _0x3a8061=_0x2f596e[_0x335d5e(0xe82)](_0x335d5e(0xc38)),_0x2fa5cc=[{'role':_0x335d5e(0x860),'content':_0x335d5e(0x32b)}],_0x3c8ebb=_0x16b978(_0x12a6c4,_0x1ab635,_0x4be14f,_0x2fa5cc);const _0x32d56e=_0x3a8061?await fetch(_0x3c8ebb['url'],_0x3c8ebb[_0x335d5e(0xc6b)]):await fetch(_0x2f596e+'/v1/chat/completions',{'method':_0x335d5e(0x12d9),'headers':{'Content-Type':'application/json','Authorization':'Bearer\x20'+_0x1ab635},'body':JSON[_0x335d5e(0x994)]({'model':_0x12a6c4,'messages':[{'role':_0x335d5e(0x1594),'content':_0x4be14f},..._0x2fa5cc],'temperature':_0x1ae02e[_0x335d5e(0x12c0)][_0x335d5e(0x217)]||0.9})});if(!_0x32d56e['ok']){const _0x9ceed8=await _0x32d56e[_0x335d5e(0xb84)]();throw new Error(_0x335d5e(0xaa6)+_0x9ceed8[_0x335d5e(0x127d)][_0x335d5e(0x11f0)]);}const _0x2e76c8=await _0x32d56e['json'](),_0x49ee7d=getGeminiResponseText(_0x2e76c8),_0x51d8a7=_0x49ee7d['match'](/(\[[\s\S]*\])/);if(!_0x51d8a7)throw new Error(_0x335d5e(0x600)+_0x49ee7d);const _0x572015=JSON[_0x335d5e(0x129c)](_0x51d8a7[0x0]);for(const _0xc8fa0f of _0x572015){_0xc8fa0f['speaker_name']&&_0xc8fa0f[_0x335d5e(0xdf2)]&&(_0x3f8883(_0xc8fa0f[_0x335d5e(0xb19)],_0xc8fa0f[_0x335d5e(0xdf2)]),_0x5cbf84(),await new Promise(_0xb7b3b3=>setTimeout(_0xb7b3b3,0x5dc+Math[_0x335d5e(0x13ae)]()*0x7d0)));}}catch(_0x302437){console[_0x335d5e(0x127d)]('狼人杀AI回应生成失败:',_0x302437),await _0x1460c5(_0x335d5e(0xa1b),_0x335d5e(0x12fe)+_0x302437[_0x335d5e(0x11f0)]);}finally{if(_0x409d5f)_0x409d5f[_0x335d5e(0xa0d)]=![];}}async function _0x1aadfe(){const _0xf68786=_0x2b1222,_0xd31d16=_0x4b691c['players'][_0xf68786(0x13b7)](_0x5bdf38=>_0x5bdf38['id']===_0xf68786(0x860));if(!_0xd31d16||!_0xd31d16[_0xf68786(0x6f3)]){console[_0xf68786(0xb3b)](_0xf68786(0x1b2));return;}const _0x5e10b9=document[_0xf68786(0x1f4)](_0xf68786(0x1208)),_0x3f4675=_0x5e10b9[_0xf68786(0x107e)]['trim']();if(!_0x3f4675){alert(_0xf68786(0x209));return;}_0x3f8883(_0xd31d16['name'],_0x3f4675),_0x5cbf84(),_0x5e10b9['value']='',await _0x1460c5('请稍候',_0xf68786(0xa6b));const {proxyUrl:_0x2a0799,apiKey:_0x526180,model:_0x56336e}=_0x1ae02e[_0xf68786(0x226)];if(!_0x2a0799||!_0x526180||!_0x56336e){alert(_0xf68786(0x8b4));return;}const _0x191d4b=_0x129144();try{let _0x5ea306=_0x2a0799['includes']('generativelanguage'),_0x3e9961=[{'role':_0xf68786(0x860),'content':'现在，请所有AI角色针对刚刚的发言（特别是\x27'+_0xd31d16['name']+'\x27的发言）继续进行讨论。'}],_0x484686=_0x16b978(_0x56336e,_0x526180,_0x191d4b,_0x3e9961);const _0x11c75c=_0x5ea306?await fetch(_0x484686['url'],_0x484686['data']):await fetch(_0x2a0799+_0xf68786(0x14c2),{'method':_0xf68786(0x12d9),'headers':{'Content-Type':_0xf68786(0xa90),'Authorization':_0xf68786(0xf03)+_0x526180},'body':JSON[_0xf68786(0x994)]({'model':_0x56336e,'messages':[{'role':_0xf68786(0x1594),'content':_0x191d4b},..._0x3e9961],'temperature':_0x1ae02e[_0xf68786(0x12c0)][_0xf68786(0x217)]||0.9})});if(!_0x11c75c['ok']){const _0x7716ca=await _0x11c75c[_0xf68786(0xb84)]();throw new Error(_0xf68786(0xaa6)+_0x7716ca[_0xf68786(0x127d)][_0xf68786(0x11f0)]);}const _0x5389e3=await _0x11c75c[_0xf68786(0xb84)](),_0x1eb849=getGeminiResponseText(_0x5389e3);let _0x5bad3c;try{let _0x3ccb62=_0x1eb849[_0xf68786(0xef0)](/^```json\s*/,'')[_0xf68786(0xef0)](/```$/,'')[_0xf68786(0x4a2)]();const _0xdea6bf=_0x3ccb62[_0xf68786(0x621)]('['),_0x356923=_0x3ccb62['lastIndexOf'](']');if(_0xdea6bf===-0x1||_0x356923===-0x1||_0x356923<_0xdea6bf)throw new Error(_0xf68786(0x7db));const _0x2eda41=_0x3ccb62[_0xf68786(0x516)](_0xdea6bf,_0x356923+0x1);_0x5bad3c=JSON[_0xf68786(0x129c)](_0x2eda41);}catch(_0x45ec5d){if(_0x45ec5d[_0xf68786(0x11f0)][_0xf68786(0xe82)](_0xf68786(0xe03))){console[_0xf68786(0xb3b)](_0xf68786(0x9c1));const _0x456b34=_0x257aac=>{const _0x513ad1=_0xf68786;let _0x7094c2=![],_0x58b3a5=![],_0x4b5ff1='';for(let _0x17736c=0x0;_0x17736c<_0x257aac[_0x513ad1(0x58a)];_0x17736c++){const _0x19f499=_0x257aac[_0x17736c];if(_0x58b3a5){_0x4b5ff1+=_0x19f499,_0x58b3a5=![];continue;}if(_0x19f499==='\x5c'){_0x4b5ff1+=_0x19f499,_0x58b3a5=!![];continue;}if(_0x19f499==='\x22'){_0x4b5ff1+=_0x19f499,_0x7094c2=!_0x7094c2;continue;}if(_0x7094c2){if(_0x19f499==='\x0a')_0x4b5ff1+='\x5cn';else{if(_0x19f499==='\x0d')_0x4b5ff1+='\x5cr';else{if(_0x19f499==='\x09')_0x4b5ff1+='\x5ct';else{if(_0x19f499[_0x513ad1(0x109b)](0x0)<0x20)continue;else _0x4b5ff1+=_0x19f499;}}}}else _0x4b5ff1+=_0x19f499;}return _0x4b5ff1;};let _0x3f43d5=_0x1eb849[_0xf68786(0xef0)](/^```json\s*/,'')[_0xf68786(0xef0)](/```$/,'')[_0xf68786(0x4a2)]();const _0x46d125=_0x456b34(_0x3f43d5),_0x49b436=_0x46d125[_0xf68786(0xba5)](/(\[[\s\S]*\])/);if(!_0x49b436)throw new Error(_0xf68786(0x1503));_0x5bad3c=JSON['parse'](_0x49b436[0x0]);}else throw new Error(_0xf68786(0x1160)+_0x45ec5d['message']+_0xf68786(0x6b6)+_0x1eb849);}for(const _0x3dc82e of _0x5bad3c){_0x3dc82e['speaker_name']&&_0x3dc82e[_0xf68786(0xdf2)]&&(_0x3f8883(_0x3dc82e[_0xf68786(0xb19)],_0x3dc82e['dialogue']),_0x5cbf84(),await new Promise(_0x80f34e=>setTimeout(_0x80f34e,0x5dc+Math[_0xf68786(0x13ae)]()*0x7d0)));}}catch(_0x26a5c0){console[_0xf68786(0x127d)](_0xf68786(0x1013),_0x26a5c0),await _0x1460c5(_0xf68786(0xa1b),'错误:\x20'+_0x26a5c0[_0xf68786(0x11f0)]);}}async function _0x942cbc(){const _0x8ed217=_0x2b1222;_0x3d2f5f('发言结束，现在开始投票。'),_0x5cbf84(),_0x4b691c[_0x8ed217(0xde9)]={};let _0x2f90fe=null;_0x4b691c[_0x8ed217(0x6dc)]='getVotes';try{_0x2f90fe=await _0x44d944(),_0x2f90fe&&_0x2f90fe[_0x8ed217(0x59b)](_0x24fa1a=>{const _0x1c591d=_0x8ed217,_0x38c7c1=_0x4b691c[_0x1c591d(0xae3)][_0x1c591d(0x13b7)](_0xd938cf=>_0xd938cf[_0x1c591d(0x5d2)]===_0x24fa1a['voter_name']),_0x562571=_0x4b691c[_0x1c591d(0xae3)][_0x1c591d(0x13b7)](_0x5bc846=>_0x5bc846[_0x1c591d(0x5d2)]===_0x24fa1a[_0x1c591d(0x126f)]);_0x38c7c1&&_0x38c7c1[_0x1c591d(0x6f3)]&&_0x562571&&(_0x4b691c['votes'][_0x38c7c1[_0x1c591d(0x5d2)]]=_0x562571[_0x1c591d(0x5d2)]);}),_0x4b691c['lastFailedAction']=null;}catch(_0x5c6e55){console[_0x8ed217(0x127d)](_0x8ed217(0xa43),_0x5c6e55),await _0x1460c5(_0x8ed217(0xc5a),_0x8ed217(0x14aa)+_0x5c6e55[_0x8ed217(0x11f0)]),document[_0x8ed217(0x1f4)](_0x8ed217(0x888))['style'][_0x8ed217(0x887)]=_0x8ed217(0x361);return;}const _0xda15b3=_0x4b691c[_0x8ed217(0xae3)]['find'](_0x4c202a=>_0x4c202a['id']==='user');if(_0xda15b3&&_0xda15b3[_0x8ed217(0x6f3)]){_0x3d2f5f(_0x8ed217(0x13bb)),_0x5cbf84();const _0x1ef81e=await _0x25c273('vote'),_0x414960=_0x4b691c[_0x8ed217(0xae3)][_0x8ed217(0x13b7)](_0x57ebb8=>_0x57ebb8['id']===_0x1ef81e);_0x414960&&(_0x4b691c[_0x8ed217(0xde9)][_0xda15b3[_0x8ed217(0x5d2)]]=_0x414960[_0x8ed217(0x5d2)]);}_0x494457();}async function _0x44d944(){const _0x15040f=_0x2b1222,{proxyUrl:_0x2e8b7b,apiKey:_0x598f4e,model:_0x2bfc22}=_0x1ae02e['apiConfig'];if(!_0x2e8b7b||!_0x598f4e||!_0x2bfc22)return null;const _0x2db164=_0x4b691c[_0x15040f(0xae3)][_0x15040f(0xede)](_0xdefe67=>_0xdefe67['isAlive']&&_0xdefe67['id']!==_0x15040f(0x860)),_0x6a24b1=_0x4b691c[_0x15040f(0xae3)][_0x15040f(0xede)](_0x4bf9ce=>_0x4bf9ce[_0x15040f(0x6f3)])[_0x15040f(0x1431)](_0x46d352=>_0x46d352[_0x15040f(0x5d2)]);let _0x571a20=_0x129144();_0x571a20+='\x0a#\x20【【【最终投票指令\x20(最高优先级)】】】\x0a现在是投票环节。请你扮演【每一个存活的AI角色】，根据以上所有信息（特别是刚刚的讨论环节），为他们各自决定要投票放逐哪一位玩家。\x0a-\x20**投票依据**:\x20你的投票【必须】基于逻辑分析和你的身份。狼人可能会投给好人，好人需要找出狼人。\x0a-\x20**格式铁律**:\x20你的回复【必须且只能】是一个JSON数组，格式如下：\x0a```json\x0a[\x0a\x20\x20{\x22voter_name\x22:\x20\x22角色A的名字\x22,\x20\x22vote_for_name\x22:\x20\x22角色A投票的玩家名字\x22},\x0a\x20\x20{\x22voter_name\x22:\x20\x22角色B的名字\x22,\x20\x22vote_for_name\x22:\x20\x22角色B投票的玩家名字\x22}\x0a]\x0a```\x0a-\x20**可投票的玩家列表**:\x20'+_0x6a24b1[_0x15040f(0x1143)](',\x20')+_0x15040f(0x1d0);try{let _0x13bd93=_0x2e8b7b['includes'](_0x15040f(0xc38)),_0x1d15a6=[{'role':_0x15040f(0x860),'content':_0x15040f(0xe93)}],_0x1cad6e=_0x16b978(_0x2bfc22,_0x598f4e,_0x571a20,_0x1d15a6);const _0x4bee79=_0x13bd93?await fetch(_0x1cad6e['url'],_0x1cad6e['data']):await fetch(_0x2e8b7b+'/v1/chat/completions',{'method':_0x15040f(0x12d9),'headers':{'Content-Type':'application/json','Authorization':_0x15040f(0xf03)+_0x598f4e},'body':JSON[_0x15040f(0x994)]({'model':_0x2bfc22,'messages':[{'role':_0x15040f(0x1594),'content':_0x571a20},..._0x1d15a6],'temperature':_0x1ae02e['globalSettings'][_0x15040f(0x217)]||0.8})});if(!_0x4bee79['ok'])throw new Error((await _0x4bee79[_0x15040f(0xb84)]())[_0x15040f(0x127d)][_0x15040f(0x11f0)]);const _0x4c0f24=await _0x4bee79[_0x15040f(0xb84)](),_0x5e82a5=getGeminiResponseText(_0x4c0f24);let _0x294009=_0x5e82a5[_0x15040f(0xef0)](/^```json\s*/,'')[_0x15040f(0xef0)](/```$/,'')['trim']();const _0x94f3f7=_0x294009[_0x15040f(0x621)]('['),_0x501439=_0x294009['lastIndexOf'](']');if(_0x94f3f7===-0x1||_0x501439===-0x1||_0x501439<_0x94f3f7)throw new Error(_0x15040f(0x6bb));const _0x4fd4bc=_0x294009[_0x15040f(0x516)](_0x94f3f7,_0x501439+0x1);try{const _0x4d5a10=_0x4fd4bc[_0x15040f(0xba5)](/(\[[\s\S]*?\])/g);if(_0x4d5a10&&_0x4d5a10[_0x15040f(0x58a)]>0x0)return JSON[_0x15040f(0x129c)](_0x4d5a10[_0x4d5a10['length']-0x1]);return JSON['parse'](_0x4fd4bc);}catch(_0x1c6d4e){throw new Error(_0x15040f(0x1484)+_0x1c6d4e['message']+_0x15040f(0x6b6)+_0x5e82a5);}}catch(_0x398eeb){console[_0x15040f(0x127d)]('获取AI投票失败:',_0x398eeb);throw new Error(_0x15040f(0x11ae)+_0x398eeb[_0x15040f(0x11f0)]);}}function _0x494457(){const _0x1cc73b=_0x2b1222,_0x4a2b11={},_0x139947={};for(const _0x338d1e in _0x4b691c[_0x1cc73b(0xde9)]){const _0xa84b60=_0x4b691c[_0x1cc73b(0xde9)][_0x338d1e];_0x4a2b11[_0xa84b60]=(_0x4a2b11[_0xa84b60]||0x0)+0x1,!_0x139947[_0xa84b60]&&(_0x139947[_0xa84b60]=[]),_0x139947[_0xa84b60][_0x1cc73b(0x1426)](_0x338d1e);}let _0x16f982=0x0,_0x42740c=[];for(const _0x382c3d in _0x4a2b11){const _0x2baa4b=_0x4a2b11[_0x382c3d];if(_0x2baa4b>_0x16f982)_0x16f982=_0x2baa4b,_0x42740c=[_0x382c3d];else _0x2baa4b===_0x16f982&&_0x42740c['push'](_0x382c3d);}_0x3d2f5f(_0x1cc73b(0xee5));for(const _0x2e6f1e in _0x139947){_0x3d2f5f(_0x2e6f1e+'\x20('+_0x139947[_0x2e6f1e][_0x1cc73b(0x58a)]+_0x1cc73b(0xe7c)+_0x139947[_0x2e6f1e]['join']('、\x20'));}if(_0x42740c['length']===0x1&&_0x16f982>0x0){const _0x345570=_0x4b691c['players']['find'](_0x10fcdc=>_0x10fcdc[_0x1cc73b(0x5d2)]===_0x42740c[0x0]);if(_0x345570){_0x345570[_0x1cc73b(0x6f3)]=![],_0x3d2f5f(_0x345570[_0x1cc73b(0x5d2)]+_0x1cc73b(0x52e));if(_0x345570['role']==='猎人'){}}}else _0x3d2f5f(_0x1cc73b(0xf0c));_0x5cbf84();if(_0x4afcdf())return;_0x4b691c[_0x1cc73b(0x14b0)]++,_0x269d10();}async function _0x40c680(){const _0x39f553=_0x2b1222,{proxyUrl:_0x3c7654,apiKey:_0x4cce33,model:_0x4a993e}=_0x1ae02e[_0x39f553(0x226)];if(!_0x3c7654||!_0x4cce33||!_0x4a993e)return null;const _0x4264f3=_0x4b691c[_0x39f553(0xae3)][_0x39f553(0xede)](_0x282c7b=>_0x282c7b[_0x39f553(0xfbb)]==='狼人'&&_0x282c7b[_0x39f553(0x6f3)]),_0x542055=_0x4b691c[_0x39f553(0xae3)][_0x39f553(0xede)](_0x32c1bb=>_0x32c1bb[_0x39f553(0x6f3)]&&_0x32c1bb[_0x39f553(0xfbb)]!=='狼人'),_0x25ba04=_0x39f553(0xf73)+_0x4264f3[_0x39f553(0x1431)](_0x573906=>_0x573906[_0x39f553(0x5d2)])[_0x39f553(0x1143)]('、\x20')+'\x0a-\x20**可以刀的玩家列表**:\x20'+_0x542055[_0x39f553(0x1431)](_0x257d28=>_0x257d28[_0x39f553(0x5d2)])[_0x39f553(0x1143)]('、\x20')+'\x0a-\x20**讨论摘要**:\x20\x0a'+_0x4b691c['discussionLog']['map'](_0x1ddbc5=>_0x1ddbc5[_0x39f553(0x9dc)]+':\x20'+_0x1ddbc5[_0x39f553(0x128c)])[_0x39f553(0x1143)]('\x0a')+_0x39f553(0x10e4);try{let _0x561dc8=_0x3c7654[_0x39f553(0xe82)](_0x39f553(0xc38)),_0x3470f9=[{'role':'user','content':_0x39f553(0x957)}],_0x6409b8=_0x16b978(_0x4a993e,_0x4cce33,_0x25ba04,_0x3470f9);const _0x24a91c=_0x561dc8?await fetch(_0x6409b8['url'],_0x6409b8['data']):await fetch(_0x3c7654+_0x39f553(0x14c2),{'method':'POST','headers':{'Content-Type':_0x39f553(0xa90),'Authorization':_0x39f553(0xf03)+_0x4cce33},'body':JSON[_0x39f553(0x994)]({'model':_0x4a993e,'messages':[{'role':'system','content':_0x25ba04},..._0x3470f9],'temperature':_0x1ae02e[_0x39f553(0x12c0)][_0x39f553(0x217)]||0.8})});if(!_0x24a91c['ok'])throw new Error((await _0x24a91c[_0x39f553(0xb84)]())[_0x39f553(0x127d)][_0x39f553(0x11f0)]);const _0x50fd48=await _0x24a91c['json'](),_0x4bbb86=getGeminiResponseText(_0x50fd48),_0x57c25a=_0x4bbb86[_0x39f553(0xba5)](/({[\s\S]*})/);if(!_0x57c25a)throw new Error(_0x39f553(0x72d));const _0x1edb5c=JSON[_0x39f553(0x129c)](_0x57c25a[0x0]),_0x204c21=_0x4b691c[_0x39f553(0xae3)][_0x39f553(0x13b7)](_0x4afb9c=>_0x4afb9c[_0x39f553(0x5d2)]===_0x1edb5c[_0x39f553(0x5f7)]);return _0x204c21?_0x204c21['id']:null;}catch(_0x121d3b){return console[_0x39f553(0x127d)](_0x39f553(0x5e1),_0x121d3b),_0x542055[Math[_0x39f553(0x123c)](Math[_0x39f553(0x13ae)]()*_0x542055[_0x39f553(0x58a)])]['id'];}}function _0x5f26f8(_0x2c9d8f,_0x3e432e){return new Promise(_0x1a2c78=>{const _0x2f0626=_0x475c,_0x49a63a=document[_0x2f0626(0x1f4)]('werewolf-witch-modal'),_0x4ef0b3=document[_0x2f0626(0x1f4)](_0x2f0626(0x697)),_0x470df5=document[_0x2f0626(0x1f4)](_0x2f0626(0xb6a)),_0x9fde77=document[_0x2f0626(0x1f4)](_0x2f0626(0x13d2)),_0x5432e0=document['getElementById']('witch-do-nothing-btn');_0x4ef0b3[_0x2f0626(0xf21)]='';const _0x1eb483=_0x9fde77[_0x2f0626(0xf44)](!![]);_0x9fde77['parentNode'][_0x2f0626(0xa88)](_0x1eb483,_0x9fde77);const _0x3f9fa9=_0x5432e0[_0x2f0626(0xf44)](!![]);_0x5432e0[_0x2f0626(0xad7)]['replaceChild'](_0x3f9fa9,_0x5432e0),_0x1eb483['style'][_0x2f0626(0x887)]=_0x2f0626(0x361),_0x1eb483[_0x2f0626(0xa0d)]=!![];let _0x539ed5={'save':![],'poison':null},_0x17415e=null;if(_0x2c9d8f&&!_0x3e432e['antidoteUsed']){_0x470df5['textContent']='昨晚\x20'+_0x2c9d8f['name']+_0x2f0626(0x1204);const _0x89250f=document['createElement'](_0x2f0626(0xd2d));_0x89250f[_0x2f0626(0x7c6)]=_0x2f0626(0xa21),_0x89250f[_0x2f0626(0x231)]=_0x2f0626(0x1050),_0x89250f[_0x2f0626(0x215)]['margin']=_0x2f0626(0x534),_0x89250f[_0x2f0626(0x1199)]=()=>{const _0x43e13c=_0x2f0626;_0x539ed5['save']=!![],_0x49a63a['classList']['remove'](_0x43e13c(0xfca)),_0x1a2c78(_0x539ed5);},_0x4ef0b3[_0x2f0626(0x6ce)](_0x89250f);}else _0x2c9d8f?_0x470df5[_0x2f0626(0x231)]='昨晚\x20'+_0x2c9d8f[_0x2f0626(0x5d2)]+'\x20被刀了\x20(你没有解药了)':_0x470df5[_0x2f0626(0x231)]=_0x2f0626(0x1519);if(!_0x3e432e['poisonUsed']){const _0x256109=document[_0x2f0626(0x219)]('p');_0x256109[_0x2f0626(0x231)]=_0x2f0626(0xc54),_0x256109['style'][_0x2f0626(0x1316)]=_0x2f0626(0x803),_0x256109[_0x2f0626(0x215)][_0x2f0626(0x657)]=_0x2f0626(0x534),_0x4ef0b3[_0x2f0626(0x6ce)](_0x256109);const _0x4f0b7c=_0x4b691c[_0x2f0626(0xae3)][_0x2f0626(0xede)](_0x2144cd=>_0x2144cd[_0x2f0626(0x6f3)]&&_0x2144cd['id']!==_0x2c9d8f?.['id']);_0x4f0b7c[_0x2f0626(0x59b)](_0x45e19e=>{const _0x4411c1=_0x2f0626,_0xe511b5=document[_0x4411c1(0x219)]('div');_0xe511b5['className']='werewolf-selection-item',_0xe511b5['dataset']['id']=_0x45e19e['id'],_0xe511b5[_0x4411c1(0xf21)]=_0x4411c1(0xe40)+_0x45e19e[_0x4411c1(0x95b)]+_0x4411c1(0x304)+_0x45e19e[_0x4411c1(0x5d2)]+'</span>',_0xe511b5[_0x4411c1(0x1199)]=()=>{const _0x23de95=_0x4411c1;_0x4ef0b3[_0x23de95(0x14bf)](_0x23de95(0x1351))['forEach'](_0x1e6bdf=>_0x1e6bdf[_0x23de95(0x159b)]['remove'](_0x23de95(0xc3e))),_0xe511b5[_0x23de95(0x159b)][_0x23de95(0x6a4)](_0x23de95(0xc3e)),_0x17415e=_0x45e19e['id'],_0x1eb483['disabled']=![];},_0x4ef0b3['appendChild'](_0xe511b5);});}_0x1eb483[_0x2f0626(0x1199)]=()=>{const _0x2d9cd9=_0x2f0626;_0x17415e&&(_0x539ed5[_0x2d9cd9(0xce7)]=_0x17415e,_0x49a63a[_0x2d9cd9(0x159b)]['remove'](_0x2d9cd9(0xfca)),_0x1a2c78(_0x539ed5));},_0x3f9fa9[_0x2f0626(0x1199)]=()=>{const _0x509fa7=_0x2f0626;_0x49a63a[_0x509fa7(0x159b)]['remove'](_0x509fa7(0xfca)),_0x1a2c78(_0x539ed5);},_0x49a63a[_0x2f0626(0x159b)][_0x2f0626(0x6a4)]('visible');});}async function _0x25e926(){const _0xb7b292=_0x2b1222,_0x161697=_0x4b691c['lastFailedAction'];if(!_0x161697)return;document[_0xb7b292(0x1f4)](_0xb7b292(0x888))[_0xb7b292(0x215)][_0xb7b292(0x887)]='none',await _0x1460c5('请稍候...',_0xb7b292(0x422)+_0x161697+_0xb7b292(0x117c));switch(_0x161697){case _0xb7b292(0x5eb):await _0x269d10();break;case _0xb7b292(0x978):await _0x3ceabd();break;case _0xb7b292(0x108b):await _0x942cbc();break;}}function _0x4afcdf(){const _0x768552=_0x2b1222,_0x5e8c0d=_0x4b691c[_0x768552(0xae3)]['filter'](_0x68a464=>_0x68a464['isAlive']),_0x41c608=_0x5e8c0d[_0x768552(0xede)](_0x5519f6=>_0x5519f6['role']==='狼人'),_0xb75dec=_0x5e8c0d[_0x768552(0xede)](_0xdd91dd=>[_0x768552(0xd82),'女巫','猎人','守卫'][_0x768552(0xe82)](_0xdd91dd[_0x768552(0xfbb)])),_0x3e2516=_0x5e8c0d[_0x768552(0xede)](_0x552e0a=>_0x552e0a['role']==='平民');let _0x24bd3c=null;if(_0x41c608[_0x768552(0x58a)]===0x0)_0x24bd3c='好人';else{if(_0x41c608[_0x768552(0x58a)]>=_0xb75dec[_0x768552(0x58a)]+_0x3e2516[_0x768552(0x58a)])_0x24bd3c='狼人';else _0x4b691c[_0x768552(0x15cd)]===_0x768552(0xdf8)?(_0xb75dec[_0x768552(0x58a)]===0x0||_0x3e2516[_0x768552(0x58a)]===0x0)&&(_0x24bd3c='狼人'):_0xb75dec['length']===0x0&&_0x3e2516['length']===0x0&&(_0x24bd3c='狼人');}if(_0x24bd3c)return _0x35d5f9(_0x24bd3c),!![];return![];}async function _0x1ef920(){const _0x1f1bb5=_0x2b1222,_0x290c2c=await _0x109970('确认操作',_0x1f1bb5(0x14b3),{'confirmText':_0x1f1bb5(0xa62)});if(!_0x290c2c)return;await _0x1460c5(_0x1f1bb5(0x11b7),_0x1f1bb5(0x107a));try{const _0x371e81=await _0x3df81a['chats']['toArray']();let _0x5d2855=0x0;for(const _0x4e1175 of _0x371e81){let _0x1fe325=![];!Array[_0x1f1bb5(0x121f)](_0x4e1175[_0x1f1bb5(0xce3)])&&(_0x4e1175[_0x1f1bb5(0xce3)]=[],_0x1fe325=!![]),(typeof _0x4e1175[_0x1f1bb5(0x6a8)]!==_0x1f1bb5(0xcc5)||_0x4e1175['settings']===null)&&(_0x4e1175[_0x1f1bb5(0x6a8)]={},_0x1fe325=!![]),!_0x4e1175['isGroup']&&!_0x4e1175[_0x1f1bb5(0x96f)]&&(_0x4e1175[_0x1f1bb5(0x96f)]=_0x4e1175[_0x1f1bb5(0x5d2)],_0x1fe325=!![]),typeof _0x4e1175['unreadCount']===_0x1f1bb5(0x488)&&(_0x4e1175['unreadCount']=0x0,_0x1fe325=!![]),!Array['isArray'](_0x4e1175[_0x1f1bb5(0x5fb)])&&(_0x4e1175[_0x1f1bb5(0x5fb)]=[],_0x1fe325=!![]),_0x1fe325&&(_0x5d2855++,console['log'](_0x1f1bb5(0x8fb)+_0x4e1175[_0x1f1bb5(0x5d2)]+'\x22\x20(ID:\x20'+_0x4e1175['id']+_0x1f1bb5(0x14f7)),await _0x3df81a[_0x1f1bb5(0x589)][_0x1f1bb5(0x295)](_0x4e1175)),_0x1ae02e[_0x1f1bb5(0x589)][_0x4e1175['id']]=_0x4e1175;}_0x5d2855>0x0?(await _0x1460c5(_0x1f1bb5(0x29a),_0x1f1bb5(0x132f)+_0x5d2855+_0x1f1bb5(0x167)),await _0x1033ae()):await _0x1460c5(_0x1f1bb5(0x81f),_0x1f1bb5(0xc9a));}catch(_0x2c9cc4){console[_0x1f1bb5(0x127d)]('数据检查与修复失败:',_0x2c9cc4),await _0x1460c5(_0x1f1bb5(0xc5a),'执行检查时发生错误:\x20'+_0x2c9cc4[_0x1f1bb5(0x11f0)]);}}function _0x5563af(_0x125534,_0x3591cb=_0x2b1222(0xe00)){const _0x54e6ae=_0x2b1222;if(_0x125534[_0x54e6ae(0xeda)](_0x54e6ae(0x8f9)))return;const _0x2fc4b5=document[_0x54e6ae(0x219)](_0x54e6ae(0xaf9));_0x2fc4b5['className']=_0x54e6ae(0x986),_0x2fc4b5[_0x54e6ae(0xf21)]=_0x54e6ae(0x9ee),_0x3591cb==='bottom'?_0x125534[_0x54e6ae(0x6ce)](_0x2fc4b5):_0x125534[_0x54e6ae(0x2d2)](_0x2fc4b5);}function _0x1335c4(_0x2c0290){const _0x2e558f=_0x2b1222,_0x36042a=_0x2c0290[_0x2e558f(0xeda)](_0x2e558f(0x8f9));_0x36042a&&_0x36042a[_0x2e558f(0xa9c)]();}async function _0x563e35(){const _0x4cb9bd=_0x2b1222,_0x173b28=document['getElementById']('delete-world-books-modal'),_0x24be99=document[_0x4cb9bd(0x1f4)](_0x4cb9bd(0x1c3)),_0x31c31c=document[_0x4cb9bd(0x1f4)](_0x4cb9bd(0x10f1));_0x24be99[_0x4cb9bd(0xf21)]='',_0x31c31c[_0x4cb9bd(0xe56)]=![];const _0x538924=await _0x3df81a['worldBooks'][_0x4cb9bd(0x27a)]();_0x538924['length']===0x0?_0x24be99[_0x4cb9bd(0xf21)]=_0x4cb9bd(0xcc4):_0x538924[_0x4cb9bd(0x59b)](_0x45203=>{const _0x4e8adf=_0x4cb9bd,_0x1b3501=document[_0x4e8adf(0x219)]('div');_0x1b3501[_0x4e8adf(0x7c6)]=_0x4e8adf(0x151a),_0x1b3501[_0x4e8adf(0x746)][_0x4e8adf(0x5fc)]=_0x45203['id'],_0x1b3501[_0x4e8adf(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22name\x22>'+_0x45203[_0x4e8adf(0x5d2)]+_0x4e8adf(0x13c7),_0x24be99[_0x4e8adf(0x6ce)](_0x1b3501);}),_0x173b28['classList'][_0x4cb9bd(0x6a4)]('visible');}async function _0x196079(){const _0x231382=_0x2b1222,_0x210330=document[_0x231382(0x14bf)](_0x231382(0xc30));if(_0x210330[_0x231382(0x58a)]===0x0){alert(_0x231382(0xc0f));return;}const _0x1dec01=Array[_0x231382(0xa81)](_0x210330)[_0x231382(0x1431)](_0x269c0d=>_0x269c0d[_0x231382(0x746)][_0x231382(0x5fc)]),_0x40062f=await _0x109970('最后确认！',_0x231382(0x1235)+_0x210330['length']+_0x231382(0xb88),{'confirmButtonClass':_0x231382(0x1c6),'confirmText':_0x231382(0xed1)});if(!_0x40062f)return;await _0x1460c5('请稍候...','正在执行删除操作...');try{await _0x3df81a[_0x231382(0x13a5)]('rw',_0x3df81a[_0x231382(0x1453)],_0x3df81a[_0x231382(0x589)],async()=>{const _0x2617a9=_0x231382;await _0x3df81a['worldBooks'][_0x2617a9(0xab7)](_0x1dec01);const _0x316fda=await _0x3df81a['chats'][_0x2617a9(0x27a)]();for(const _0x315e05 of _0x316fda){if(_0x315e05[_0x2617a9(0x6a8)]&&Array[_0x2617a9(0x121f)](_0x315e05[_0x2617a9(0x6a8)][_0x2617a9(0x1469)])){const _0x2bd553=_0x315e05[_0x2617a9(0x6a8)][_0x2617a9(0x1469)][_0x2617a9(0x58a)];_0x315e05[_0x2617a9(0x6a8)][_0x2617a9(0x1469)]=_0x315e05[_0x2617a9(0x6a8)]['linkedWorldBookIds'][_0x2617a9(0xede)](_0x1ec8a8=>!_0x1dec01[_0x2617a9(0xe82)](_0x1ec8a8)),_0x315e05['settings']['linkedWorldBookIds']['length']<_0x2bd553&&await _0x3df81a[_0x2617a9(0x589)][_0x2617a9(0x295)](_0x315e05);}}}),_0x1ae02e[_0x231382(0x1453)]=_0x1ae02e[_0x231382(0x1453)][_0x231382(0xede)](_0x1a3129=>!_0x1dec01[_0x231382(0xe82)](_0x1a3129['id'])),document['getElementById'](_0x231382(0x6e8))[_0x231382(0x159b)][_0x231382(0xa9c)]('visible'),await _0x1460c5(_0x231382(0xfed),_0x210330[_0x231382(0x58a)]+'\x20本世界书已成功删除。');}catch(_0x108743){console['error'](_0x231382(0x300),_0x108743),await _0x1460c5(_0x231382(0x1234),_0x231382(0x1345)+_0x108743[_0x231382(0x11f0)]);}}function _0x155917(){const _0x2749ef=_0x2b1222;if(!_0x1ae02e[_0x2749ef(0x588)])return;const _0x2c1d98=_0x1ae02e['activeChatId'],_0x596893=document[_0x2749ef(0x1f4)](_0x2749ef(0xcb4)),_0x2fc74e=document[_0x2749ef(0x1f4)]('reading-window'),_0x5c63a2=document['getElementById'](_0x2749ef(0x1058));let _0x220cbf=_0x4705dd[_0x2c1d98];if(_0x220cbf&&_0x220cbf['isActive']){_0x220cbf[_0x2749ef(0x58c)]&&_0x5eb709();_0x596893[_0x2749ef(0x215)][_0x2749ef(0x887)]='flex';return;}_0x51dd66(_0x2c1d98),_0x58db24(_0x2c1d98),_0x596893['style']['display']=_0x2749ef(0xeba),_0x2fc74e[_0x2749ef(0x159b)]['remove'](_0x2749ef(0xac5)),_0x5c63a2[_0x2749ef(0x215)]['display']=_0x2749ef(0x1b5);const _0x3fb433=document[_0x2749ef(0x1f4)](_0x2749ef(0x296)),_0x47d522=_0x2fc74e[_0x2749ef(0x6cc)](),_0x13b694=(_0x3fb433[_0x2749ef(0xf13)]-_0x47d522[_0x2749ef(0x1158)])/0x2,_0x3e0f0d=(_0x3fb433[_0x2749ef(0x8e1)]-_0x47d522[_0x2749ef(0x4cb)])/0x2;_0x2fc74e[_0x2749ef(0x215)][_0x2749ef(0xe00)]=_0x13b694+'px',_0x2fc74e['style'][_0x2749ef(0xbe7)]=_0x3e0f0d+'px',_0x2fc74e['style'][_0x2749ef(0x8c6)]='';}function _0x51dd66(_0x497f81){const _0x12b222=_0x2b1222;_0x4705dd[_0x497f81]={'isActive':!![],'isMinimized':![],'title':_0x12b222(0x2a3),'contentLines':[],'currentPage':0x0,'totalPages':0x0,'linesPerPage':0xf,'currentSnippet':''};}function _0x53af84(){const _0x42cd50=_0x2b1222,_0x36f50c=_0x1ae02e[_0x42cd50(0x588)];if(!_0x36f50c||!_0x4705dd[_0x36f50c]||!_0x4705dd[_0x36f50c]['isActive'])return;document[_0x42cd50(0x1f4)](_0x42cd50(0xcb4))['style']['display']=_0x42cd50(0x1b5),document[_0x42cd50(0x1f4)](_0x42cd50(0x1058))[_0x42cd50(0x215)][_0x42cd50(0x887)]=_0x42cd50(0x1b5),document[_0x42cd50(0x1f4)](_0x42cd50(0x669))[_0x42cd50(0x159b)][_0x42cd50(0xa9c)](_0x42cd50(0xac5)),_0x4705dd[_0x36f50c][_0x42cd50(0xd51)]=![],console[_0x42cd50(0x57e)](_0x42cd50(0x398));}function _0x46c055(){const _0x31eb62=_0x2b1222,_0x231a11=_0x4705dd[_0x1ae02e[_0x31eb62(0x588)]];if(!_0x231a11||!_0x231a11[_0x31eb62(0xd51)]||_0x231a11[_0x31eb62(0x58c)])return;_0x231a11['isMinimized']=!![],document[_0x31eb62(0x1f4)]('reading-window')['classList'][_0x31eb62(0x6a4)](_0x31eb62(0xac5)),document[_0x31eb62(0x1f4)]('reading-restore-btn')[_0x31eb62(0x215)]['display']=_0x31eb62(0xeba);}function _0x5eb709(){const _0x5d1113=_0x2b1222,_0x3c4613=_0x4705dd[_0x1ae02e['activeChatId']];if(!_0x3c4613||!_0x3c4613['isActive']||!_0x3c4613[_0x5d1113(0x58c)])return;_0x3c4613[_0x5d1113(0x58c)]=![],document[_0x5d1113(0x1f4)](_0x5d1113(0x1058))['style'][_0x5d1113(0x887)]='none',document['getElementById'](_0x5d1113(0x669))['classList'][_0x5d1113(0xa9c)](_0x5d1113(0xac5));}function _0x2c3cea(_0x1dadc7,_0x22c5d5){const _0x253fcf=_0x2b1222;let _0x1e5b9b=0x0,_0x2a61e7=0x0,_0x331124=0x0,_0x27fc74=0x0;const _0x21ea06=document[_0x253fcf(0x1f4)](_0x253fcf(0x296)),_0x4ba46f=_0x39bc29=>{const _0xe6e2bc=_0x253fcf;if(_0x39bc29['target'][_0xe6e2bc(0x96a)]('button'))return;if(_0x1dadc7[_0xe6e2bc(0x215)][_0xe6e2bc(0x8c6)]){const _0x29c3af=_0x1dadc7[_0xe6e2bc(0x6cc)](),_0x12f981=_0x1dadc7[_0xe6e2bc(0x463)][_0xe6e2bc(0x6cc)]();_0x1dadc7[_0xe6e2bc(0x215)]['top']=_0x29c3af[_0xe6e2bc(0xe00)]-_0x12f981[_0xe6e2bc(0xe00)]+'px',_0x1dadc7[_0xe6e2bc(0x215)][_0xe6e2bc(0xbe7)]=_0x29c3af['left']-_0x12f981['left']+'px',_0x1dadc7[_0xe6e2bc(0x215)][_0xe6e2bc(0x8c6)]='';}_0x39bc29['preventDefault']();const _0xfed0bf=_0x39bc29[_0xe6e2bc(0xcbd)]==='touchstart'?_0x39bc29[_0xe6e2bc(0xc92)][0x0]:_0x39bc29;_0x331124=_0xfed0bf['clientX'],_0x27fc74=_0xfed0bf[_0xe6e2bc(0x1521)],document[_0xe6e2bc(0x122b)](_0xe6e2bc(0x3e4),_0x4ee101),document[_0xe6e2bc(0x122b)](_0xe6e2bc(0xb7e),_0x3dbecb),document[_0xe6e2bc(0x122b)](_0xe6e2bc(0x4f5),_0x4ee101),document[_0xe6e2bc(0x122b)](_0xe6e2bc(0xa92),_0x3dbecb);},_0x3dbecb=_0x53c09c=>{const _0x44c527=_0x253fcf,_0x5aea9f=_0x53c09c[_0x44c527(0xcbd)]===_0x44c527(0xa92)?_0x53c09c[_0x44c527(0xc92)][0x0]:_0x53c09c;_0x1e5b9b=_0x331124-_0x5aea9f[_0x44c527(0x1476)],_0x2a61e7=_0x27fc74-_0x5aea9f[_0x44c527(0x1521)],_0x331124=_0x5aea9f[_0x44c527(0x1476)],_0x27fc74=_0x5aea9f['clientY'];let _0x33b344=_0x1dadc7['offsetTop']-_0x2a61e7,_0x12b6d0=_0x1dadc7[_0x44c527(0xc49)]-_0x1e5b9b;const _0x3dda25=_0x21ea06[_0x44c527(0xf13)]-_0x1dadc7[_0x44c527(0xc5b)]-0xa,_0x4c61dc=_0x21ea06[_0x44c527(0x8e1)]-_0x1dadc7[_0x44c527(0x93a)]-0xa;_0x33b344=Math[_0x44c527(0x616)](0xa,Math[_0x44c527(0xbc3)](_0x33b344,_0x3dda25)),_0x12b6d0=Math[_0x44c527(0x616)](0xa,Math['min'](_0x12b6d0,_0x4c61dc)),_0x1dadc7[_0x44c527(0x215)][_0x44c527(0xe00)]=_0x33b344+'px',_0x1dadc7[_0x44c527(0x215)][_0x44c527(0xbe7)]=_0x12b6d0+'px';},_0x4ee101=()=>{const _0x4d3d1f=_0x253fcf;document[_0x4d3d1f(0x7f6)](_0x4d3d1f(0x3e4),_0x4ee101),document[_0x4d3d1f(0x7f6)]('mousemove',_0x3dbecb),document[_0x4d3d1f(0x7f6)](_0x4d3d1f(0x4f5),_0x4ee101),document[_0x4d3d1f(0x7f6)](_0x4d3d1f(0xa92),_0x3dbecb);};_0x22c5d5[_0x253fcf(0x122b)](_0x253fcf(0x103d),_0x4ba46f),_0x22c5d5[_0x253fcf(0x122b)](_0x253fcf(0x158c),_0x4ba46f);}function _0x58db24(_0xb029ee){const _0x4fae6f=_0x2b1222,_0x12adea=_0x4705dd[_0xb029ee];if(!_0x12adea)return;const _0x5c2991=document[_0x4fae6f(0x1f4)]('reading-title'),_0x1279ad=document[_0x4fae6f(0x1f4)](_0x4fae6f(0x5c3)),_0x4978bd=document[_0x4fae6f(0x1f4)](_0x4fae6f(0x413)),_0x43fcbf=document['getElementById'](_0x4fae6f(0x407)),_0x1dc671=document[_0x4fae6f(0x1f4)](_0x4fae6f(0xa9f));_0x5c2991[_0x4fae6f(0x231)]=_0x12adea['title'];if(_0x12adea[_0x4fae6f(0x184)][_0x4fae6f(0x58a)]===0x0)_0x1279ad[_0x4fae6f(0xf21)]=_0x4fae6f(0x1468),_0x12adea[_0x4fae6f(0x6e0)]=0x0,_0x12adea[_0x4fae6f(0x699)]=0x0;else{const _0x506195=_0x12adea[_0x4fae6f(0x699)]*_0x12adea['linesPerPage'],_0x1f8b4c=_0x506195+_0x12adea['linesPerPage'];_0x1279ad['textContent']=_0x12adea['contentLines'][_0x4fae6f(0x5cc)](_0x506195,_0x1f8b4c)[_0x4fae6f(0x1143)]('\x0a');}_0x4978bd[_0x4fae6f(0x231)]=_0x12adea['currentPage']+0x1+_0x4fae6f(0x67c)+_0x12adea[_0x4fae6f(0x6e0)],_0x43fcbf['disabled']=_0x12adea[_0x4fae6f(0x699)]===0x0,_0x1dc671[_0x4fae6f(0xa0d)]=_0x12adea[_0x4fae6f(0x699)]>=_0x12adea[_0x4fae6f(0x6e0)]-0x1;}function _0x18290e(){const _0x4ce585=_0x2b1222,_0x17f1ed=_0x4705dd[_0x1ae02e[_0x4ce585(0x588)]];_0x17f1ed&&_0x17f1ed[_0x4ce585(0x699)]<_0x17f1ed[_0x4ce585(0x6e0)]-0x1&&(_0x17f1ed[_0x4ce585(0x699)]++,_0x58db24(_0x1ae02e[_0x4ce585(0x588)]),document[_0x4ce585(0x1f4)]('reading-content')[_0x4ce585(0x2d4)]=0x0,_0x104912(_0x17f1ed[_0x4ce585(0x1295)],_0x17f1ed['currentPage']));}async function _0x2c12d0(){const _0x4021ed=_0x2b1222,_0xb962a5=_0x4705dd[_0x1ae02e[_0x4021ed(0x588)]];_0xb962a5&&_0xb962a5[_0x4021ed(0x699)]>0x0&&(_0xb962a5[_0x4021ed(0x699)]--,_0x58db24(_0x1ae02e['activeChatId']),document[_0x4021ed(0x1f4)](_0x4021ed(0x5c3))[_0x4021ed(0x2d4)]=0x0,await _0x104912(_0xb962a5['activeBookId'],_0xb962a5[_0x4021ed(0x699)]),await notifyAiOfPageTurn(_0x1ae02e[_0x4021ed(0x588)],_0xb962a5));}function _0x159f9a(){const _0x34ad94=_0x2b1222;document[_0x34ad94(0x1f4)](_0x34ad94(0xa8e))['click']();}async function _0x2f40e0(_0x6ada2b){const _0x595b08=_0x2b1222,_0x43cf91=new Uint8Array(_0x6ada2b);if(_0x43cf91['length']>=0x3&&_0x43cf91[0x0]===0xef&&_0x43cf91[0x1]===0xbb&&_0x43cf91[0x2]===0xbf)return console[_0x595b08(0x57e)]('检测到\x20UTF-8\x20BOM，使用\x20UTF-8\x20解码。'),new TextDecoder('utf-8')[_0x595b08(0x3e8)](_0x43cf91);if(_0x43cf91[_0x595b08(0x58a)]>=0x2&&_0x43cf91[0x0]===0xff&&_0x43cf91[0x1]===0xfe)return console['log']('检测到\x20UTF-16\x20LE\x20BOM，使用\x20UTF-16\x20LE\x20解码。'),new TextDecoder(_0x595b08(0x102b))[_0x595b08(0x3e8)](_0x43cf91);if(_0x43cf91[_0x595b08(0x58a)]>=0x2&&_0x43cf91[0x0]===0xfe&&_0x43cf91[0x1]===0xff)return console[_0x595b08(0x57e)](_0x595b08(0xab8)),new TextDecoder('utf-16be')[_0x595b08(0x3e8)](_0x43cf91);try{console['log'](_0x595b08(0x610));const _0x19c60e=new TextDecoder(_0x595b08(0x423),{'fatal':!![]})['decode'](_0x43cf91);return console[_0x595b08(0x57e)](_0x595b08(0x3fb)),_0x19c60e;}catch(_0x1578c4){console['log'](_0x595b08(0xaf3));try{const _0x257f4d=new TextDecoder(_0x595b08(0x9b9))['decode'](_0x43cf91);return console['log'](_0x595b08(0x113a)),_0x257f4d;}catch(_0x485858){console[_0x595b08(0x127d)](_0x595b08(0xc2a),_0x485858);throw new Error(_0x595b08(0x9f7));}}}async function _0x1c79a7(_0x3272f5){const _0x4c06e0=_0x2b1222,_0x30880c=_0x3272f5[_0x4c06e0(0xb57)][_0x4c06e0(0x8b1)][0x0];if(!_0x30880c)return;try{const _0x5c198d=await _0x30880c[_0x4c06e0(0x1018)](),_0x215556=await _0x2f40e0(_0x5c198d),_0x22ff8c=_0x30880c[_0x4c06e0(0x5d2)][_0x4c06e0(0xef0)](/\.txt$/i,''),_0x1908d0=await _0x3df81a['readingLibrary'][_0x4c06e0(0x6a4)]({'title':_0x22ff8c,'content':_0x215556,'lastOpened':Date[_0x4c06e0(0xd6e)]()});await _0x41d462(_0x1908d0),document[_0x4c06e0(0x1f4)](_0x4c06e0(0xd50))[_0x4c06e0(0x159b)][_0x4c06e0(0xaea)](_0x4c06e0(0xfca))&&_0x44c88c();}catch(_0x4f4473){console[_0x4c06e0(0x127d)]('导入书籍失败:',_0x4f4473),await _0x1460c5(_0x4c06e0(0x15ca),_0x4f4473['message']);}finally{_0x3272f5[_0x4c06e0(0xb57)]['value']=null;}}async function _0x389852(){const _0x1ed52b=_0x2b1222,_0x30abb5=_0x1ae02e[_0x1ed52b(0x588)];if(!_0x30abb5)return;const _0x17a393=_0x4705dd[_0x30abb5];if(!_0x17a393||_0x17a393['totalPages']<=0x1)return;const _0x3909e1=await _0x11f6fb('页面跳转',_0x1ed52b(0x1094)+_0x17a393['totalPages']+')',_0x17a393[_0x1ed52b(0x699)]+0x1);if(_0x3909e1===null)return;const _0x4261a9=parseInt(_0x3909e1);if(isNaN(_0x4261a9)||_0x4261a9<0x1||_0x4261a9>_0x17a393['totalPages']){alert(_0x1ed52b(0x1e7));return;}_0x17a393['currentPage']=_0x4261a9-0x1,_0x58db24(_0x30abb5),_0x104912(_0x17a393[_0x1ed52b(0x1295)],_0x17a393['currentPage']);}async function _0x104912(_0x13228e,_0x77f1e8){const _0x521613=_0x2b1222;if(!_0x13228e)return;try{await _0x3df81a[_0x521613(0x15d0)][_0x521613(0xf18)](_0x13228e,{'currentPage':_0x77f1e8});}catch(_0x1c0d24){console[_0x521613(0x127d)](_0x521613(0xacf)+_0x13228e+')的阅读进度失败:',_0x1c0d24);}}async function _0x18290e(){const _0x5960ba=_0x2b1222,_0x718d57=_0x4705dd[_0x1ae02e[_0x5960ba(0x588)]];_0x718d57&&_0x718d57[_0x5960ba(0x699)]<_0x718d57[_0x5960ba(0x6e0)]-0x1&&(_0x718d57[_0x5960ba(0x699)]++,_0x58db24(_0x1ae02e[_0x5960ba(0x588)]),document[_0x5960ba(0x1f4)](_0x5960ba(0x5c3))[_0x5960ba(0x2d4)]=0x0,await _0x104912(_0x718d57[_0x5960ba(0x1295)],_0x718d57[_0x5960ba(0x699)]),await notifyAiOfPageTurn(_0x1ae02e[_0x5960ba(0x588)],_0x718d57));}function _0x2ea4cb(_0x1c8709,_0x308f33){const _0x54195c=_0x2b1222,_0xdd527d=_0x1ae02e[_0x54195c(0x588)];if(!_0xdd527d)return;const _0xfed8e1=_0x4705dd[_0xdd527d];_0xfed8e1[_0x54195c(0x156f)]=_0x1c8709[_0x54195c(0xef0)](/\.txt$/i,''),_0xfed8e1[_0x54195c(0x184)]=_0x308f33[_0x54195c(0x23f)](/\r\n?|\n/)[_0x54195c(0x1431)](_0x34b9b=>_0x34b9b[_0x54195c(0xef0)](/ +/g,'\x20')),_0xfed8e1[_0x54195c(0x6e0)]=Math[_0x54195c(0xde8)](_0xfed8e1[_0x54195c(0x184)][_0x54195c(0x58a)]/_0xfed8e1[_0x54195c(0x1096)]),_0xfed8e1['currentPage']=0x0,_0x58db24(_0xdd527d);}async function _0x3a7baf(){const _0xd9a46a=_0x2b1222;document[_0xd9a46a(0x1f4)]('reading-library-search-input')[_0xd9a46a(0x107e)]='',await _0x44c88c(),document['getElementById'](_0xd9a46a(0xd50))[_0xd9a46a(0x159b)]['add']('visible');}async function _0x44c88c(_0x4dc9f6=''){const _0x49b4a3=_0x2b1222,_0x5ca58f=document[_0x49b4a3(0x1f4)](_0x49b4a3(0x16b));let _0x39253d=await _0x3df81a['readingLibrary']['orderBy'](_0x49b4a3(0x603))[_0x49b4a3(0x115a)]()[_0x49b4a3(0x27a)]();_0x5ca58f[_0x49b4a3(0xf21)]='';_0x4dc9f6&&(_0x39253d=_0x39253d[_0x49b4a3(0xede)](_0x1be258=>_0x1be258[_0x49b4a3(0x156f)][_0x49b4a3(0x1f7)]()[_0x49b4a3(0xe82)](_0x4dc9f6[_0x49b4a3(0x1f7)]())));if(_0x39253d[_0x49b4a3(0x58a)]===0x0){const _0x206112=_0x4dc9f6?_0x49b4a3(0x36a):_0x49b4a3(0xcc1);_0x5ca58f[_0x49b4a3(0xf21)]=_0x49b4a3(0xaad)+_0x206112+_0x49b4a3(0x1517);return;}_0x39253d['forEach'](_0x2352d3=>{const _0x54e68d=_0x49b4a3,_0x55f5a1=document[_0x54e68d(0x219)](_0x54e68d(0xaf9));_0x55f5a1[_0x54e68d(0x7c6)]=_0x54e68d(0xd18),_0x55f5a1['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-name\x22\x20style=\x22cursor:pointer;\x22\x20data-book-id=\x22'+_0x2352d3['id']+'\x22>'+_0x2352d3[_0x54e68d(0x156f)]+_0x54e68d(0x1569)+_0x2352d3['id']+_0x54e68d(0x1195),_0x5ca58f['appendChild'](_0x55f5a1);});}async function _0x41d462(_0x20f2b2){const _0x32931b=_0x2b1222,_0x27595d=_0x1ae02e['activeChatId'];if(!_0x27595d)return;const _0x571d4d=await _0x3df81a[_0x32931b(0x15d0)]['get'](_0x20f2b2);if(!_0x571d4d){alert('找不到这本书！');return;}await _0x3df81a['readingLibrary'][_0x32931b(0xf18)](_0x20f2b2,{'lastOpened':Date[_0x32931b(0xd6e)]()});const _0x384b6b=_0x4705dd[_0x27595d];_0x384b6b[_0x32931b(0x1295)]=_0x20f2b2,_0x384b6b['title']=_0x571d4d[_0x32931b(0x156f)],_0x384b6b[_0x32931b(0x184)]=_0x571d4d[_0x32931b(0x128c)]['split'](/\r\n?|\n/)['map'](_0x249b7f=>_0x249b7f[_0x32931b(0xef0)](/ +/g,'\x20')),_0x384b6b[_0x32931b(0x6e0)]=Math[_0x32931b(0xde8)](_0x384b6b[_0x32931b(0x184)]['length']/_0x384b6b[_0x32931b(0x1096)]),_0x384b6b[_0x32931b(0x699)]=_0x571d4d[_0x32931b(0x699)]||0x0,_0x58db24(_0x27595d),document[_0x32931b(0x1f4)](_0x32931b(0x5c3))[_0x32931b(0x2d4)]=0x0,document[_0x32931b(0x1f4)]('reading-library-modal')[_0x32931b(0x159b)]['remove'](_0x32931b(0xfca));}async function _0x390735(_0x2c98c2){const _0x39887b=_0x2b1222,_0xebf77b=await _0x3df81a[_0x39887b(0x15d0)][_0x39887b(0x13f8)](_0x2c98c2);if(!_0xebf77b)return;const _0x355cde=await _0x109970('删除书籍',_0x39887b(0x2dd)+_0xebf77b['title']+_0x39887b(0x14d8),{'confirmButtonClass':_0x39887b(0x1c6)});_0x355cde&&(await _0x3df81a['readingLibrary'][_0x39887b(0xc40)](_0x2c98c2),await _0x44c88c());}function _0x2ea4cb(_0x354a84,_0x1edc14){const _0x90dc73=_0x2b1222,_0x41a7f7=_0x1ae02e['activeChatId'];if(!_0x41a7f7)return;const _0x1f8ffc=_0x4705dd[_0x41a7f7];_0x1f8ffc[_0x90dc73(0x156f)]=_0x354a84[_0x90dc73(0xef0)](/\.txt$/i,''),_0x1f8ffc['contentLines']=_0x1edc14[_0x90dc73(0x23f)](/\r\n?|\n/),_0x1f8ffc[_0x90dc73(0x6e0)]=Math['ceil'](_0x1f8ffc[_0x90dc73(0x184)][_0x90dc73(0x58a)]/_0x1f8ffc['linesPerPage']),_0x1f8ffc[_0x90dc73(0x699)]=0x0,_0x58db24(_0x41a7f7);}function _0x2c3cea(_0x44e9e9,_0xa0c590){const _0x5b7e10=_0x2b1222;let _0x2f8eca=0x0,_0x47b0fa=0x0,_0x72ecf0=0x0,_0x52b71a=0x0,_0x582d58=![],_0x9d91b3=![];const _0x2acc27=document[_0x5b7e10(0x1f4)](_0x5b7e10(0x296)),_0x8b939e=_0xd3cee9=>{const _0x1dc837=_0x5b7e10;if(_0x44e9e9!==_0xa0c590&&_0xd3cee9[_0x1dc837(0xb57)][_0x1dc837(0x96a)](_0x1dc837(0xd2d)))return;_0x582d58=!![],_0x9d91b3=![];const _0x444b68=_0xd3cee9[_0x1dc837(0xcbd)]===_0x1dc837(0x158c)?_0xd3cee9[_0x1dc837(0xc92)][0x0]:_0xd3cee9;_0x72ecf0=_0x444b68['clientX'],_0x52b71a=_0x444b68[_0x1dc837(0x1521)],_0x44e9e9['style']['top']=_0x44e9e9[_0x1dc837(0x1363)]+'px',_0x44e9e9[_0x1dc837(0x215)][_0x1dc837(0xbe7)]=_0x44e9e9[_0x1dc837(0xc49)]+'px',_0x44e9e9[_0x1dc837(0x215)][_0x1dc837(0x8c6)]='',document[_0x1dc837(0x122b)](_0x1dc837(0x3e4),_0x41735d),document[_0x1dc837(0x122b)](_0x1dc837(0xb7e),_0x287912),document[_0x1dc837(0x122b)](_0x1dc837(0x4f5),_0x41735d),document['addEventListener'](_0x1dc837(0xa92),_0x287912,{'passive':![]});},_0x287912=_0x3af9af=>{const _0x19a8cd=_0x5b7e10;if(!_0x582d58)return;const _0x57a110=_0x3af9af[_0x19a8cd(0xcbd)]===_0x19a8cd(0xa92)?_0x3af9af['touches'][0x0]:_0x3af9af,_0x58f79c=_0x57a110[_0x19a8cd(0x1476)]-_0x72ecf0,_0x29169d=_0x57a110[_0x19a8cd(0x1521)]-_0x52b71a;!_0x9d91b3&&(Math[_0x19a8cd(0x151f)](_0x58f79c)>0x5||Math[_0x19a8cd(0x151f)](_0x29169d)>0x5)&&(_0x9d91b3=!![]);_0x9d91b3&&_0x3af9af['cancelable']&&_0x3af9af[_0x19a8cd(0x32e)]();_0x2f8eca=_0x72ecf0-_0x57a110['clientX'],_0x47b0fa=_0x52b71a-_0x57a110[_0x19a8cd(0x1521)],_0x72ecf0=_0x57a110[_0x19a8cd(0x1476)],_0x52b71a=_0x57a110[_0x19a8cd(0x1521)];let _0x289994=_0x44e9e9[_0x19a8cd(0x1363)]-_0x47b0fa,_0x555769=_0x44e9e9[_0x19a8cd(0xc49)]-_0x2f8eca;const _0x2ef542=_0x2acc27[_0x19a8cd(0xf13)]-_0x44e9e9['offsetHeight']-0xa,_0x5e867e=_0x2acc27['clientWidth']-_0x44e9e9[_0x19a8cd(0x93a)]-0xa;_0x289994=Math[_0x19a8cd(0x616)](0xa,Math[_0x19a8cd(0xbc3)](_0x289994,_0x2ef542)),_0x555769=Math[_0x19a8cd(0x616)](0xa,Math[_0x19a8cd(0xbc3)](_0x555769,_0x5e867e)),_0x44e9e9['style'][_0x19a8cd(0xe00)]=_0x289994+'px',_0x44e9e9[_0x19a8cd(0x215)][_0x19a8cd(0xbe7)]=_0x555769+'px';},_0x41735d=()=>{const _0x20c2fa=_0x5b7e10;document['removeEventListener'](_0x20c2fa(0x3e4),_0x41735d),document[_0x20c2fa(0x7f6)](_0x20c2fa(0xb7e),_0x287912),document[_0x20c2fa(0x7f6)](_0x20c2fa(0x4f5),_0x41735d),document[_0x20c2fa(0x7f6)](_0x20c2fa(0xa92),_0x287912);if(!_0x582d58)return;_0x582d58=![],!_0x9d91b3&&_0x44e9e9[_0x20c2fa(0x740)]();};_0xa0c590['addEventListener'](_0x5b7e10(0x103d),_0x8b939e),_0xa0c590[_0x5b7e10(0x122b)](_0x5b7e10(0x158c),_0x8b939e,{'passive':![]});}function _0x46c055(){const _0x144b63=_0x2b1222,_0x3431c9=_0x4705dd[_0x1ae02e['activeChatId']];if(!_0x3431c9||!_0x3431c9['isActive'])return;document[_0x144b63(0x1f4)]('reading-window')[_0x144b63(0x159b)]['add'](_0x144b63(0xac5)),document[_0x144b63(0x1f4)]('reading-restore-btn')[_0x144b63(0x215)][_0x144b63(0x887)]=_0x144b63(0xeba),_0x3431c9['isMinimized']=!![];}function _0x5eb709(){const _0x1d7a79=_0x2b1222,_0x2ee7f1=_0x4705dd[_0x1ae02e[_0x1d7a79(0x588)]];if(!_0x2ee7f1||!_0x2ee7f1[_0x1d7a79(0xd51)])return;document[_0x1d7a79(0x1f4)]('reading-restore-btn')['style'][_0x1d7a79(0x887)]=_0x1d7a79(0x1b5),document[_0x1d7a79(0x1f4)](_0x1d7a79(0x669))['classList'][_0x1d7a79(0xa9c)](_0x1d7a79(0xac5)),_0x2ee7f1[_0x1d7a79(0x58c)]=![];}function _0x3f35bb(_0x419ca6,_0x2067a8){let _0x3ee2d4;return function(..._0x3d9f1b){const _0x566b93=_0x475c,_0x363764=this;clearTimeout(_0x3ee2d4),_0x3ee2d4=setTimeout(()=>_0x419ca6[_0x566b93(0x1140)](_0x363764,_0x3d9f1b),_0x2067a8);};}function _0x5a2458(_0x53da6a){const _0x5bc682=_0x2b1222,_0x4b1f8d=_0x4705dd[_0x53da6a];if(!_0x4b1f8d||!_0x4b1f8d['isActive'])return'';const _0x2019ff=_0x4b1f8d[_0x5bc682(0x156f)]||_0x5bc682(0x1171);let _0x3d0e93='',_0x1e0a6c='';if(_0x4b1f8d[_0x5bc682(0x8e9)]&&_0x4b1f8d[_0x5bc682(0x8e9)][_0x5bc682(0x4a2)]())_0x3d0e93=_0x4b1f8d[_0x5bc682(0x8e9)],_0x1e0a6c='你正在阅读的段落';else{if(_0x4b1f8d[_0x5bc682(0x184)][_0x5bc682(0x58a)]>0x0){const _0x2eb2a3=_0x4b1f8d[_0x5bc682(0x699)]*_0x4b1f8d[_0x5bc682(0x1096)],_0x4ad822=_0x2eb2a3+_0x4b1f8d[_0x5bc682(0x1096)];_0x3d0e93=_0x4b1f8d[_0x5bc682(0x184)]['slice'](_0x2eb2a3,_0x4ad822)[_0x5bc682(0x1143)]('\x0a')['substring'](0x0,0xc8),_0x1e0a6c=_0x5bc682(0x12ef);}else _0x3d0e93=_0x5bc682(0xd09),_0x1e0a6c='内容';}return _0x5bc682(0x877)+_0x2019ff+_0x5bc682(0xd4a)+_0x1e0a6c+_0x5bc682(0x3d0)+_0x3d0e93+_0x5bc682(0x2b8)+(_0x1ae02e['chats'][_0x53da6a]?.[_0x5bc682(0x96f)]||'AI角色')+_0x5bc682(0x7d4);}function _0x2667a3(){const _0x4d1ce0=_0x2b1222,_0x5b1b=_0x1ae02e[_0x4d1ce0(0x588)];if(!_0x5b1b||!_0x4705dd[_0x5b1b])return;const _0x5f3b0c=_0x4705dd[_0x5b1b],_0x4c5443=document['getElementById'](_0x4d1ce0(0x5c3)),_0x310814=_0x4c5443[_0x4d1ce0(0x2d4)],_0x197b2c=_0x4c5443[_0x4d1ce0(0xf13)],_0x218f88=_0x310814+_0x197b2c,_0xe13f2e=0xf*1.8,_0x4d28a5=Math[_0x4d1ce0(0x123c)](_0x310814/_0xe13f2e),_0xee2eb8=Math[_0x4d1ce0(0xde8)](_0x218f88/_0xe13f2e),_0x1fc8e7=_0x5f3b0c[_0x4d1ce0(0x699)]*_0x5f3b0c[_0x4d1ce0(0x1096)]+_0x4d28a5,_0x4ba00f=_0x5f3b0c[_0x4d1ce0(0x699)]*_0x5f3b0c[_0x4d1ce0(0x1096)]+_0xee2eb8;if(_0x1fc8e7<0x0||_0x1fc8e7>=_0x5f3b0c['contentLines']['length'])return;const _0x10e91d=_0x5f3b0c[_0x4d1ce0(0x184)][_0x4d1ce0(0x5cc)](Math[_0x4d1ce0(0x616)](0x0,_0x1fc8e7),Math[_0x4d1ce0(0xbc3)](_0x5f3b0c[_0x4d1ce0(0x184)]['length'],_0x4ba00f))[_0x4d1ce0(0x1143)]('\x0a');_0x5f3b0c[_0x4d1ce0(0x8e9)]=_0x10e91d;}function _0x2d0337(){const _0x3804df=_0x2b1222,_0x43c4ad=document[_0x3804df(0x1f4)]('silent-audio-player');if(_0x43c4ad){const _0x5026b4=_0x43c4ad[_0x3804df(0x9ab)]();_0x5026b4!==undefined&&_0x5026b4[_0x3804df(0x14bc)](_0x22a708=>{const _0x343c28=_0x3804df;console[_0x343c28(0x57e)](_0x343c28(0x1051));})[_0x3804df(0x3d1)](_0x206cce=>{const _0x26cf12=_0x3804df;console[_0x26cf12(0xb3b)](_0x26cf12(0x708),_0x206cce);});}}function _0x12ea3e(){const _0x552f61=_0x2b1222,_0xfea458=document['getElementById']('silent-audio-player');_0xfea458&&!_0xfea458[_0x552f61(0x2e0)]&&(_0xfea458[_0x552f61(0x352)](),_0xfea458[_0x552f61(0xa68)]=0x0,console[_0x552f61(0x57e)]('静音音频已停止。'));}async function _0x1c9be1(_0x1cff6a){const _0x2cc116=_0x2b1222,_0x409f07=decodeURIComponent(_0x1cff6a[_0x2cc116(0x746)][_0x2cc116(0x40f)]),_0x534569=_0x1cff6a[_0x2cc116(0x746)]['voiceId'],_0x34863a=_0x1cff6a[_0x2cc116(0xeda)]('.voice-play-btn'),_0x5f39fd=_0x1cff6a['querySelector'](_0x2cc116(0x30c)),_0x45ef39=document['getElementById'](_0x2cc116(0xe65));if(!_0x45ef39[_0x2cc116(0x2e0)]&&_0x45ef39[_0x2cc116(0x746)][_0x2cc116(0xcc8)]===_0x409f07&&_0x45ef39['dataset'][_0x2cc116(0x6be)]===_0x534569){_0x45ef39['pause']();return;}_0x45ef39['pause'](),document[_0x2cc116(0x14bf)](_0x2cc116(0x1411))[_0x2cc116(0x59b)](_0x1c631a=>_0x1c631a[_0x2cc116(0x231)]='▶');const _0x386082=_0x2cc116(0x245)+_0x534569+'_'+_0x409f07;let _0x312b83=_0x1ae02e[_0x2cc116(0x6f8)][_0x2cc116(0x13f8)](_0x386082);if(_0x312b83){console['log'](_0x2cc116(0xc87)),await _0x67c109(_0x312b83['url'],_0x312b83[_0x2cc116(0xcbd)],_0x409f07,_0x534569,_0x1cff6a);return;}console[_0x2cc116(0x57e)](_0x2cc116(0x10e1));if(_0x34863a)_0x34863a['style']['display']=_0x2cc116(0x1b5);_0x5f39fd[_0x2cc116(0x215)][_0x2cc116(0x887)]=_0x2cc116(0x361);const {minimaxGroupId:_0x349082,minimaxApiKey:_0x2700c2}=_0x1ae02e[_0x2cc116(0x226)];if(!_0x349082||!_0x2700c2){await _0x1460c5('配置错误',_0x2cc116(0xbd7)),_0x5f39fd[_0x2cc116(0x215)]['display']=_0x2cc116(0x1b5);if(_0x34863a)_0x34863a[_0x2cc116(0x215)][_0x2cc116(0x887)]=_0x2cc116(0xeba);return;}try{const _0x14eb3d=await fetch(_0x2cc116(0xd81)+_0x349082,{'method':_0x2cc116(0x12d9),'headers':{'Authorization':_0x2cc116(0xf03)+_0x2700c2,'Content-Type':_0x2cc116(0xa90)},'body':JSON[_0x2cc116(0x994)]({'text':_0x409f07,'voice_id':_0x534569,'model':_0x1ae02e['apiConfig'][_0x2cc116(0x11fe)]||_0x2cc116(0x827),'speed':0x1,'vol':0x1,'pitch':0x0})});if(!_0x14eb3d['ok']){let _0x59faab='API\x20返回错误:\x20'+_0x14eb3d['status'];try{const _0x28d029=await _0x14eb3d[_0x2cc116(0xb84)]();_0x59faab=_0x28d029[_0x2cc116(0xa1e)]?.[_0x2cc116(0xeec)]||JSON[_0x2cc116(0x994)](_0x28d029);}catch(_0x44edb0){_0x59faab=await _0x14eb3d['text']();}throw new Error(_0x59faab);}const _0xe8448c=await _0x14eb3d[_0x2cc116(0x128e)](),_0x81a2c6=URL[_0x2cc116(0x297)](_0xe8448c);await _0x67c109(_0x81a2c6,_0xe8448c[_0x2cc116(0xcbd)],_0x409f07,_0x534569,_0x1cff6a);const _0x4a2714=new FileReader();_0x4a2714['onloadend']=function(){const _0x183c63=_0x2cc116;_0x1ae02e[_0x183c63(0x6f8)]['set'](_0x386082,{'url':_0x4a2714['result'],'type':_0xe8448c[_0x183c63(0xcbd)]}),console[_0x183c63(0x57e)](_0x183c63(0xd06));},_0x4a2714[_0x2cc116(0x21e)](_0xe8448c);}catch(_0x528a30){console[_0x2cc116(0x127d)](_0x2cc116(0xc56),_0x528a30),await _0x1460c5(_0x2cc116(0x1433),_0x2cc116(0x12fe)+_0x528a30[_0x2cc116(0x11f0)]);}finally{_0x5f39fd['style']['display']='none';if(_0x34863a)_0x34863a[_0x2cc116(0x215)][_0x2cc116(0x887)]=_0x2cc116(0xeba);}}function _0x67c109(_0x4a3e53,_0x21f8b2,_0x35281c,_0x1be741,_0x46c2ca){return new Promise((_0x4c141a,_0x28f24f)=>{const _0x54c9ea=_0x475c,_0x5a2a86=document[_0x54c9ea(0x1f4)]('tts-audio-player');_0x5a2a86[_0x54c9ea(0x9fe)]=_0x4a3e53,_0x5a2a86['type']=_0x21f8b2,_0x5a2a86[_0x54c9ea(0x746)][_0x54c9ea(0xcc8)]=_0x35281c,_0x5a2a86[_0x54c9ea(0x746)][_0x54c9ea(0x6be)]=_0x1be741;const _0x543b5b=_0x5a2a86[_0x54c9ea(0x9ab)]();_0x543b5b!==undefined&&_0x543b5b[_0x54c9ea(0x14bc)](()=>{const _0x1c78fe=_0x54c9ea,_0x17eadb=_0x46c2ca[_0x1c78fe(0xeda)]('.voice-play-btn');if(_0x17eadb)_0x17eadb[_0x1c78fe(0x231)]='❚❚';_0x4c141a();})[_0x54c9ea(0x3d1)](_0x10e91b=>{const _0x542ddf=_0x54c9ea;console[_0x542ddf(0x127d)](_0x542ddf(0xbb8),_0x10e91b),_0x28f24f(_0x10e91b);}),_0x5a2a86[_0x54c9ea(0x8f0)]=()=>{const _0x168007=_0x54c9ea,_0x114c58=_0x46c2ca['querySelector'](_0x168007(0x1411));if(_0x114c58)_0x114c58[_0x168007(0x231)]='▶';},_0x5a2a86[_0x54c9ea(0x52f)]=()=>{const _0x4d2290=_0x54c9ea,_0x52c4ad=_0x46c2ca[_0x4d2290(0xeda)](_0x4d2290(0x1411));if(_0x52c4ad)_0x52c4ad['textContent']='▶';};});}function _0x5244c5(_0x1c9866){const _0x315a12=_0x2b1222,_0x1b53a2=_0x1c9866[_0x315a12(0x96a)](_0x315a12(0x251));if(!_0x1b53a2)return;const _0x31f39c=_0x1b53a2[_0x315a12(0xeda)](_0x315a12(0x11d4)),_0x582a56=decodeURIComponent(_0x1c9866[_0x315a12(0x746)][_0x315a12(0x40f)]);_0x31f39c[_0x315a12(0x215)][_0x315a12(0x887)]===_0x315a12(0x361)?_0x31f39c['style']['display']=_0x315a12(0x1b5):(_0x31f39c[_0x315a12(0x231)]=_0x582a56,_0x31f39c[_0x315a12(0x215)]['display']=_0x315a12(0x361));}async function _0x55953a(){const _0x25c355=_0x2b1222;await _0x3463d9(),document[_0x25c355(0x1f4)]('product-category-manager-modal')[_0x25c355(0x159b)]['add'](_0x25c355(0xfca));}async function _0x3463d9(){const _0x46c9ff=_0x2b1222,_0x3f0861=document[_0x46c9ff(0x1f4)](_0x46c9ff(0x39b)),_0x273030=await _0x3df81a[_0x46c9ff(0xca5)][_0x46c9ff(0x27a)]();_0x3f0861[_0x46c9ff(0xf21)]='';if(_0x273030[_0x46c9ff(0x58a)]===0x0){_0x3f0861['innerHTML']=_0x46c9ff(0x1138);return;}_0x273030[_0x46c9ff(0x59b)](_0x24aad3=>{const _0x9bdeef=_0x46c9ff,_0x7e0b47=document[_0x9bdeef(0x219)](_0x9bdeef(0xaf9));_0x7e0b47[_0x9bdeef(0x7c6)]='existing-group-item',_0x7e0b47['innerHTML']=_0x9bdeef(0x1546)+_0x24aad3['name']+_0x9bdeef(0x564)+_0x24aad3['id']+_0x9bdeef(0xaa8),_0x3f0861[_0x9bdeef(0x6ce)](_0x7e0b47);});}async function _0x3b165b(){const _0x4c1334=_0x2b1222,_0x4a6540=document[_0x4c1334(0x1f4)](_0x4c1334(0x61b)),_0x25618a=_0x4a6540[_0x4c1334(0x107e)][_0x4c1334(0x4a2)]();if(!_0x25618a)return alert(_0x4c1334(0xc11));const _0x2b20e3=await _0x3df81a[_0x4c1334(0xca5)][_0x4c1334(0x478)](_0x4c1334(0x5d2))[_0x4c1334(0x49d)](_0x25618a)[_0x4c1334(0x9a8)]();if(_0x2b20e3)return alert(_0x4c1334(0x112b)+_0x25618a+_0x4c1334(0xf6a));await _0x3df81a['shoppingCategories'][_0x4c1334(0x6a4)]({'name':_0x25618a}),_0x4a6540[_0x4c1334(0x107e)]='',await _0x3463d9();}async function _0x3cb7af(_0x2d5baf){const _0x140120=_0x2b1222,_0x4dca32=await _0x109970(_0x140120(0xed1),_0x140120(0x27e),{'confirmButtonClass':_0x140120(0x1c6)});_0x4dca32&&(await _0x3df81a[_0x140120(0xca5)][_0x140120(0xc40)](_0x2d5baf),await _0x3df81a[_0x140120(0xbf4)][_0x140120(0x478)](_0x140120(0x1467))[_0x140120(0x49d)](_0x2d5baf)[_0x140120(0x1064)]({'categoryId':null}),await _0x3463d9());}function _0x15c396(_0x22f251={}){const _0x15da2e=_0x2b1222,_0x2f8da0=document[_0x15da2e(0x1f4)](_0x15da2e(0x808)),_0x550878=document[_0x15da2e(0x219)](_0x15da2e(0xaf9));return _0x550878[_0x15da2e(0x7c6)]=_0x15da2e(0x3a4),_0x550878[_0x15da2e(0xf21)]=_0x15da2e(0x3cb)+(_0x22f251[_0x15da2e(0x5d2)]||'')+_0x15da2e(0x4ef)+(_0x22f251[_0x15da2e(0x6ec)]||'')+_0x15da2e(0x6f2)+(_0x22f251['imageUrl']||'https://i.postimg.cc/PqYp5T5M/image.png')+_0x15da2e(0xdd9),_0x550878[_0x15da2e(0xeda)]('.delete-block-btn')[_0x15da2e(0x122b)](_0x15da2e(0x740),()=>_0x550878[_0x15da2e(0xa9c)]()),_0x550878[_0x15da2e(0xeda)](_0x15da2e(0x1510))[_0x15da2e(0x122b)](_0x15da2e(0x740),()=>{const _0x40f298=_0x15da2e;_0x550878[_0x40f298(0xeda)](_0x40f298(0x2fa))[_0x40f298(0x740)]();}),_0x550878[_0x15da2e(0xeda)](_0x15da2e(0x2fa))[_0x15da2e(0x122b)](_0x15da2e(0x1147),_0x50f1f4=>{const _0xd6bb5b=_0x15da2e,_0x4b54e8=_0x50f1f4[_0xd6bb5b(0xb57)][_0xd6bb5b(0x8b1)][0x0];if(_0x4b54e8){const _0x70b924=new FileReader();_0x70b924[_0xd6bb5b(0xcbe)]=_0x2efa2b=>{const _0x37ca8b=_0xd6bb5b;_0x550878[_0x37ca8b(0xeda)](_0x37ca8b(0x14d2))['src']=_0x2efa2b[_0x37ca8b(0xb57)][_0x37ca8b(0xbc9)];},_0x70b924[_0xd6bb5b(0x21e)](_0x4b54e8);}}),_0x2f8da0[_0x15da2e(0x6ce)](_0x550878),_0x550878;}async function _0x416bc9(_0x10aebc){const _0x5a6dae=_0x2b1222,_0x3fd7d3=await _0x3df81a[_0x5a6dae(0xbf4)][_0x5a6dae(0x13f8)](_0x10aebc);if(!_0x3fd7d3||!_0x3fd7d3[_0x5a6dae(0x7ec)]||_0x3fd7d3[_0x5a6dae(0x7ec)][_0x5a6dae(0x58a)]===0x0)return;const _0x3cf7c6=document[_0x5a6dae(0x1f4)](_0x5a6dae(0xf33));document[_0x5a6dae(0x1f4)](_0x5a6dae(0x1534))['src']=_0x3fd7d3[_0x5a6dae(0x48d)],document[_0x5a6dae(0x1f4)](_0x5a6dae(0x1148))[_0x5a6dae(0x231)]=_0x3fd7d3[_0x5a6dae(0x5d2)];const _0x580095=document[_0x5a6dae(0x1f4)](_0x5a6dae(0x9be));_0x580095[_0x5a6dae(0xf21)]='',_0x3fd7d3[_0x5a6dae(0x7ec)][_0x5a6dae(0x59b)]((_0x4df5a2,_0x36f626)=>{const _0x1d7649=_0x5a6dae,_0x407071=document[_0x1d7649(0x219)]('input');_0x407071[_0x1d7649(0xcbd)]=_0x1d7649(0x45a),_0x407071[_0x1d7649(0x5d2)]=_0x1d7649(0xdf7),_0x407071['id']=_0x1d7649(0x845)+_0x10aebc+'-'+_0x36f626,_0x407071[_0x1d7649(0x107e)]=_0x36f626,_0x407071[_0x1d7649(0x215)][_0x1d7649(0x887)]=_0x1d7649(0x1b5);if(_0x36f626===0x0)_0x407071[_0x1d7649(0xe56)]=!![];const _0x3f82ce=document['createElement'](_0x1d7649(0xb95));_0x3f82ce[_0x1d7649(0xffd)]='var-'+_0x10aebc+'-'+_0x36f626,_0x3f82ce[_0x1d7649(0x231)]=_0x4df5a2[_0x1d7649(0x5d2)],_0x3f82ce[_0x1d7649(0x215)]['cssText']=_0x1d7649(0xe3a),_0x580095['appendChild'](_0x407071),_0x580095[_0x1d7649(0x6ce)](_0x3f82ce);});const _0x3840a6=()=>{const _0x28f738=_0x5a6dae,_0x8b1de0=_0x580095[_0x28f738(0xeda)]('input[name=\x22variation-select\x22]:checked');_0x580095[_0x28f738(0x14bf)](_0x28f738(0xb95))['forEach'](_0x3763d1=>{const _0x3ef502=_0x28f738;_0x3763d1[_0x3ef502(0x215)][_0x3ef502(0xbc1)]=_0x3ef502(0xaaf),_0x3763d1[_0x3ef502(0x215)][_0x3ef502(0x1451)]=_0x3ef502(0x39d),_0x3763d1[_0x3ef502(0x215)][_0x3ef502(0x11e7)]=_0x3ef502(0xc4c);});if(_0x8b1de0){const _0x4abec7=_0x580095['querySelector'](_0x28f738(0x5da)+_0x8b1de0['id']+'\x22]');_0x4abec7[_0x28f738(0x215)][_0x28f738(0xbc1)]=_0x28f738(0x12d4),_0x4abec7[_0x28f738(0x215)]['color']='var(--accent-color)',_0x4abec7[_0x28f738(0x215)][_0x28f738(0x11e7)]=_0x28f738(0xbd6);const _0x39be9f=_0x3fd7d3[_0x28f738(0x7ec)][parseInt(_0x8b1de0['value'])];document[_0x28f738(0x1f4)](_0x28f738(0x94b))[_0x28f738(0x231)]='¥'+_0x39be9f[_0x28f738(0x6ec)][_0x28f738(0x24f)](0x2),_0x39be9f[_0x28f738(0x48d)]?document[_0x28f738(0x1f4)]('variation-product-image')[_0x28f738(0x9fe)]=_0x39be9f[_0x28f738(0x48d)]:document[_0x28f738(0x1f4)](_0x28f738(0x1534))[_0x28f738(0x9fe)]=_0x3fd7d3[_0x28f738(0x48d)];}};_0x580095['addEventListener'](_0x5a6dae(0x1147),_0x3840a6),_0x3840a6(),document[_0x5a6dae(0x1f4)](_0x5a6dae(0xa4d))['textContent']='1';const _0x137573=document[_0x5a6dae(0x1f4)]('confirm-variation-selection-btn'),_0x4c1a14=_0x137573[_0x5a6dae(0xf44)](!![]);_0x137573['parentNode']['replaceChild'](_0x4c1a14,_0x137573),_0x4c1a14['addEventListener'](_0x5a6dae(0x740),async()=>{const _0x5159f8=_0x5a6dae,_0x3ea77d=_0x580095['querySelector'](_0x5159f8(0x2a5)),_0x528dca=parseInt(document['getElementById'](_0x5159f8(0xa4d))[_0x5159f8(0x231)]);if(_0x3ea77d){const _0x402b5c=_0x3fd7d3[_0x5159f8(0x7ec)][parseInt(_0x3ea77d[_0x5159f8(0x107e)])];await _0x37f43c(_0x10aebc,_0x528dca,_0x402b5c),_0x3cf7c6[_0x5159f8(0x159b)][_0x5159f8(0xa9c)](_0x5159f8(0xfca)),await _0x1460c5('成功','已成功加入购物车！');}}),_0x3cf7c6[_0x5a6dae(0x159b)][_0x5a6dae(0x6a4)](_0x5a6dae(0xfca));}function _0x401e06(){const _0x3de68f=_0x2b1222,_0x5e077f=document[_0x3de68f(0x1f4)]('shopping-settings-modal');document[_0x3de68f(0x1f4)](_0x3de68f(0x11af))[_0x3de68f(0x107e)]=_0x1ae02e[_0x3de68f(0x12c0)]['shoppingCategoryCount']||0x3,document[_0x3de68f(0x1f4)](_0x3de68f(0x384))['value']=_0x1ae02e[_0x3de68f(0x12c0)][_0x3de68f(0x791)]||0x8,_0x5e077f[_0x3de68f(0x159b)]['add'](_0x3de68f(0xfca));}async function _0x46a65b(){const _0x1be129=_0x2b1222,_0xf76c45=document[_0x1be129(0x1f4)]('shopping-category-count-input'),_0x54f580=document[_0x1be129(0x1f4)](_0x1be129(0x384)),_0x325188=parseInt(_0xf76c45[_0x1be129(0x107e)]),_0x1c4245=parseInt(_0x54f580['value']);if(isNaN(_0x325188)||isNaN(_0x1c4245)||_0x325188<0x1||_0x1c4245<0x1){alert(_0x1be129(0xc86));return;}_0x1ae02e[_0x1be129(0x12c0)][_0x1be129(0xb39)]=_0x325188,_0x1ae02e[_0x1be129(0x12c0)][_0x1be129(0x791)]=_0x1c4245,await _0x3df81a['globalSettings'][_0x1be129(0x295)](_0x1ae02e['globalSettings']),document[_0x1be129(0x1f4)](_0x1be129(0x130e))[_0x1be129(0x159b)][_0x1be129(0xa9c)](_0x1be129(0xfca)),await _0x1460c5(_0x1be129(0x6a9),_0x1be129(0x8ac));}async function _0x2c72af(){const _0x528575=_0x2b1222;if(!_0x1ae02e[_0x528575(0x588)]){await _0x1460c5(_0x528575(0xc5a),'请先进入一个聊天页面，再返回购物中心进行生成，以便AI了解要为哪个角色生成商品。');return;}const _0x16f865=_0x1ae02e[_0x528575(0x589)][_0x1ae02e['activeChatId']],_0x5620ff=await _0x109970('为“'+_0x16f865['name']+_0x528575(0x933),'此操作将使用AI生成新的商品和分类，并【添加】到现有列表中。确定要继续吗？',{'confirmText':_0x528575(0x46e)});if(!_0x5620ff)return;await _0x1460c5(_0x528575(0x11b7),_0x528575(0x43a)+_0x16f865[_0x528575(0x5d2)]+_0x528575(0x3f8));const _0x47d371=_0x1ae02e[_0x528575(0x226)]['secondaryProxyUrl']&&_0x1ae02e[_0x528575(0x226)][_0x528575(0x247)]&&_0x1ae02e[_0x528575(0x226)][_0x528575(0xe21)],{proxyUrl:_0x3d3874,apiKey:_0x41aa90,model:_0x1751c8}=_0x47d371?{'proxyUrl':_0x1ae02e[_0x528575(0x226)][_0x528575(0x78a)],'apiKey':_0x1ae02e['apiConfig']['secondaryApiKey'],'model':_0x1ae02e[_0x528575(0x226)]['secondaryModel']}:_0x1ae02e[_0x528575(0x226)];if(!_0x3d3874||!_0x41aa90||!_0x1751c8){await _0x1460c5('API未配置',_0x528575(0x220));return;}const _0x4cfd66=_0x1ae02e[_0x528575(0x12c0)][_0x528575(0xb39)]||0x3,_0x33e74a=_0x1ae02e['globalSettings'][_0x528575(0x791)]||0x8,_0x5003a2=await _0x3df81a[_0x528575(0xca5)][_0x528575(0x27a)]();let _0x1fbfcd='';_0x5003a2[_0x528575(0x58a)]>0x0&&(_0x1fbfcd='\x0a#\x20【分类复用铁律\x20(最高优先级！)】\x0a在为新商品指定分类时，你【必须】首先检查下面的“已有分类列表”。\x0a-\x20\x20\x20如果一个新商品可以被归入某个【已存在的分类】，你【必须】复用那个分类的名称，而不是创造一个相似的新分类！\x0a-\x20\x20\x20只有当你确定商品【绝对】不属于任何一个已有分类时，你才能创造一个新的分类名称。\x0a-\x20\x20\x20**已有分类列表**:\x20['+_0x5003a2[_0x528575(0x1431)](_0x5f467c=>'\x22'+_0x5f467c[_0x528575(0x5d2)]+'\x22')['join'](',\x20')+']\x0a');const _0xc5797d=_0x1ae02e[_0x528575(0x11ef)]['nickname']||'我',_0x312129=_0x16f865[_0x528575(0x5fb)]&&_0x16f865[_0x528575(0x5fb)][_0x528575(0x58a)]>0x0?_0x16f865['longTermMemory']['map'](_0x2eff7f=>_0x528575(0x10a4)+_0x3f7f7a(_0x2eff7f[_0x528575(0x1388)])+')\x20'+_0x2eff7f[_0x528575(0x128c)])[_0x528575(0x1143)]('\x0a'):'无',_0x4a5974=_0x16f865[_0x528575(0xce3)][_0x528575(0x5cc)](-0xa)['map'](_0x576778=>(_0x576778[_0x528575(0xfbb)]===_0x528575(0x860)?_0xc5797d:_0x16f865[_0x528575(0x5d2)])+':\x20'+String(_0x576778[_0x528575(0x128c)])['substring'](0x0,0x1e)+_0x528575(0x629))['join']('\x0a');let _0x370ad2='';if(_0x16f865['settings'][_0x528575(0x1469)]&&_0x16f865['settings']['linkedWorldBookIds'][_0x528575(0x58a)]>0x0){const _0x421309=_0x16f865[_0x528575(0x6a8)][_0x528575(0x1469)][_0x528575(0x1431)](_0x55953d=>{const _0x1a8e3c=_0x528575,_0x5a684a=_0x1ae02e[_0x1a8e3c(0x1453)]['find'](_0x5510e4=>_0x5510e4['id']===_0x55953d);if(!_0x5a684a||!Array['isArray'](_0x5a684a[_0x1a8e3c(0x128c)]))return'';const _0x670910=_0x5a684a[_0x1a8e3c(0x128c)][_0x1a8e3c(0xede)](_0x3d8f94=>_0x3d8f94[_0x1a8e3c(0x1368)]!==![])[_0x1a8e3c(0x1431)](_0x47bc2d=>'-\x20'+_0x47bc2d[_0x1a8e3c(0x128c)])[_0x1a8e3c(0x1143)]('\x0a');return _0x670910?_0x1a8e3c(0x1356)+_0x5a684a[_0x1a8e3c(0x5d2)]+_0x1a8e3c(0x134b)+_0x670910:'';})[_0x528575(0xede)](Boolean)['join']('');_0x421309&&(_0x370ad2=_0x528575(0x129e)+_0x421309+'\x0a');}const _0x5b059f=_0x528575(0x686)+_0x16f865[_0x528575(0x5d2)]+_0x528575(0x121b)+_0x4cfd66+_0x528575(0x635)+_0x33e74a+_0x528575(0x154b)+_0x16f865[_0x528575(0x5d2)]+_0x528575(0x535)+_0x16f865['settings'][_0x528575(0xf42)]+'\x0a-\x20**长期记忆**:\x20'+_0x312129+_0x528575(0xd04)+_0x370ad2+'\x0a'+_0x1fbfcd+'\x0a-\x20**最近对话摘要**:\x0a'+_0x4a5974+'\x0a\x0a现在，请根据以上【所有上下文信息】，开始为“'+_0x16f865[_0x528575(0x5d2)]+'”生成这组【与角色高度相关】的商品数据。';try{const _0x4983d4=[{'role':'user','content':'请根据以上设定，生成商品数据。'}];let _0xc0f505=_0x3d3874[_0x528575(0xe82)](_0x528575(0xc38)),_0x437752=_0x16b978(_0x1751c8,_0x41aa90,_0x5b059f,_0x4983d4);const _0x32521d=_0xc0f505?await fetch(_0x437752[_0x528575(0x258)],_0x437752[_0x528575(0xc6b)]):await fetch(_0x3d3874+'/v1/chat/completions',{'method':_0x528575(0x12d9),'headers':{'Content-Type':_0x528575(0xa90),'Authorization':_0x528575(0xf03)+_0x41aa90},'body':JSON[_0x528575(0x994)]({'model':_0x1751c8,'messages':[{'role':_0x528575(0x1594),'content':_0x5b059f},..._0x4983d4],'temperature':_0x1ae02e['globalSettings']['apiTemperature']||0.9})});if(!_0x32521d['ok'])throw new Error(_0x528575(0xaa6)+_0x32521d['statusText']);const _0x5c1900=await _0x32521d[_0x528575(0xb84)](),_0x492e75=getGeminiResponseText(_0x5c1900),_0x1b6f02=_0x492e75['match'](/({[\s\S]*})/);if(!_0x1b6f02)throw new Error(_0x528575(0x450));const _0x26599b=JSON[_0x528575(0x129c)](_0x1b6f02[0x0]);if(!_0x26599b[_0x528575(0xffa)]||!Array[_0x528575(0x121f)](_0x26599b[_0x528575(0xffa)]))throw new Error(_0x528575(0xd19));await _0x3df81a['transaction']('rw',_0x3df81a['shoppingProducts'],_0x3df81a[_0x528575(0xca5)],async()=>{const _0x58401d=_0x528575;for(const _0x1073fc of _0x26599b[_0x58401d(0xffa)]){let _0x60bb54;const _0xdd6122=await _0x3df81a[_0x58401d(0xca5)][_0x58401d(0x478)]('name')[_0x58401d(0x292)](_0x1073fc[_0x58401d(0x5d2)])[_0x58401d(0x9a8)]();_0xdd6122?_0x60bb54=_0xdd6122['id']:_0x60bb54=await _0x3df81a[_0x58401d(0xca5)][_0x58401d(0x6a4)]({'name':_0x1073fc[_0x58401d(0x5d2)]});const _0x5e2b9b=_0x1073fc[_0x58401d(0x96d)][_0x58401d(0x1431)](_0x136f01=>{const _0xe8cb16=_0x58401d;return{'name':_0x136f01[_0xe8cb16(0x5d2)],'price':_0x136f01[_0xe8cb16(0x6ec)]||0x0,'description':_0x136f01[_0xe8cb16(0xdec)]||'','imageUrl':_0xe8cb16(0xe8f)+encodeURIComponent(_0x136f01[_0xe8cb16(0x1248)]),'variations':(_0x136f01[_0xe8cb16(0x7ec)]||[])['map'](_0x201c15=>({..._0x201c15,'imageUrl':'https://image.pollinations.ai/prompt/'+encodeURIComponent(_0x201c15[_0xe8cb16(0x1248)])})),'categoryId':_0x60bb54};});_0x5e2b9b['length']>0x0&&await _0x3df81a[_0x58401d(0xbf4)][_0x58401d(0x4ea)](_0x5e2b9b);}}),activeShoppingCategoryId=_0x528575(0x54b),await _0x4faebc(),await _0x1460c5(_0x528575(0x1122),'为“'+_0x16f865[_0x528575(0x5d2)]+'”量身定制的商品已上架！');}catch(_0x52d1ee){console[_0x528575(0x127d)](_0x528575(0xadd),_0x52d1ee),await _0x1460c5(_0x528575(0x108a),_0x528575(0x430)+_0x52d1ee[_0x528575(0x11f0)]);}}async function _0x303a08(_0x437a85){const _0x22cfe5=_0x2b1222,_0x1bed18=document[_0x22cfe5(0x1f4)](_0x437a85);if(!_0x1bed18)return;const _0x2115da=await _0x12414d(_0x22cfe5(0xe6a),[{'text':_0x22cfe5(0x1414),'value':'local'},{'text':_0x22cfe5(0x13a3),'value':'url'}]);let _0x20a3e9=null;if(_0x2115da==='local')_0x20a3e9=await _0x2cdf38();else _0x2115da===_0x22cfe5(0x258)&&(_0x20a3e9=await _0x11f6fb(_0x22cfe5(0xe6a),_0x22cfe5(0x1360),_0x1bed18[_0x22cfe5(0x9fe)],_0x22cfe5(0x258)));if(_0x20a3e9&&_0x20a3e9[_0x22cfe5(0x4a2)]()){const _0x5058a2=_0x20a3e9['trim']();_0x1bed18[_0x22cfe5(0x9fe)]=_0x5058a2,!_0x1ae02e[_0x22cfe5(0x12c0)][_0x22cfe5(0xd55)]&&(_0x1ae02e[_0x22cfe5(0x12c0)][_0x22cfe5(0xd55)]={}),_0x1ae02e[_0x22cfe5(0x12c0)][_0x22cfe5(0xd55)][_0x437a85]=_0x5058a2,await _0x3df81a[_0x22cfe5(0x12c0)][_0x22cfe5(0x295)](_0x1ae02e[_0x22cfe5(0x12c0)]),await _0x1460c5('成功',_0x22cfe5(0x87b));}}window[_0x2b1222(0xc07)]=_0x303a08;async function _0x2d7811(){const _0x3a7e40=_0x2b1222;if(!window['streamSaver']||typeof JSZip===_0x3a7e40(0x488)){await _0x1460c5('库加载失败',_0x3a7e40(0x25d));return;}await _0x1460c5('正在准备分片导出...',_0x3a7e40(0x580));const _0x5036a8=streamSaver[_0x3a7e40(0x46f)](_0x3a7e40(0xcf7)+new Date()[_0x3a7e40(0xc66)]()[_0x3a7e40(0x23f)]('T')[0x0]+_0x3a7e40(0xc02)),_0x528aed=new JSZip(),_0x2271cd=0x5f*0x400*0x400;let _0x36e039=0x1,_0x3f0675={},_0x5e6878=0x0;const _0xe70a1=new TextEncoder();try{const _0x3ce63a=_0x3df81a[_0x3a7e40(0x308)][_0x3a7e40(0x1431)](_0x13d26f=>_0x13d26f[_0x3a7e40(0x5d2)]);for(const _0x1e5844 of _0x3ce63a){console['log']('正在打包表:\x20'+_0x1e5844+'...');const _0x15c5d8=await _0x3df81a[_0x3a7e40(0x12b7)](_0x1e5844)[_0x3a7e40(0x27a)]();if(_0x15c5d8[_0x3a7e40(0x58a)]===0x0)continue;const _0x22dc90=JSON[_0x3a7e40(0x994)](_0x15c5d8),_0xb0d964=_0xe70a1[_0x3a7e40(0x7bc)](_0x22dc90)[_0x3a7e40(0x58a)];if(_0xb0d964>_0x2271cd){console[_0x3a7e40(0xb3b)](_0x3a7e40(0xe6d)+_0x1e5844+_0x3a7e40(0xecf)+(_0xb0d964/0x400/0x400)['toFixed'](0x2)+_0x3a7e40(0xa52));_0x5e6878>0x0&&(_0x528aed[_0x3a7e40(0x5aa)]('slice_'+_0x36e039++ +'.json',JSON[_0x3a7e40(0x994)]({'version':0x4,'type':_0x3a7e40(0x5cc),'data':_0x3f0675})),_0x3f0675={},_0x5e6878=0x0);_0x3f0675[_0x1e5844]=_0x15c5d8,_0x528aed[_0x3a7e40(0x5aa)](_0x3a7e40(0x1233)+_0x36e039++ +'.json',JSON[_0x3a7e40(0x994)]({'version':0x4,'type':'slice','data':_0x3f0675})),_0x3f0675={},_0x5e6878=0x0;continue;}_0x5e6878>0x0&&_0x5e6878+_0xb0d964>_0x2271cd&&(console[_0x3a7e40(0x57e)](_0x3a7e40(0x798)+_0x36e039+_0x3a7e40(0xcce)+(_0x5e6878/0x400/0x400)[_0x3a7e40(0x24f)](0x2)+_0x3a7e40(0x10e5)),_0x528aed['file'](_0x3a7e40(0x1233)+_0x36e039++ +'.json',JSON['stringify']({'version':0x4,'type':_0x3a7e40(0x5cc),'data':_0x3f0675})),_0x3f0675={},_0x5e6878=0x0),_0x3f0675[_0x1e5844]=_0x15c5d8,_0x5e6878+=_0xb0d964;}_0x5e6878>0x0&&(console[_0x3a7e40(0x57e)](_0x3a7e40(0x684)+_0x36e039+_0x3a7e40(0x1135)+(_0x5e6878/0x400/0x400)['toFixed'](0x2)+_0x3a7e40(0x205)),_0x528aed['file'](_0x3a7e40(0x1233)+_0x36e039+'.json',JSON[_0x3a7e40(0x994)]({'version':0x4,'type':_0x3a7e40(0x5cc),'data':_0x3f0675})));console[_0x3a7e40(0x57e)](_0x3a7e40(0x6d3));const _0x55391a=_0x528aed[_0x3a7e40(0x8e8)]({'type':_0x3a7e40(0x128e),'streamFiles':!![]}),_0x423923=new ReadableStream({'start'(_0x1f702a){const _0x48b1bb=_0x3a7e40;_0x55391a['on'](_0x48b1bb(0xc6b),_0x141cf5=>{const _0x468ef5=_0x48b1bb;_0x1f702a[_0x468ef5(0x115b)](_0x141cf5);})['on']('end',()=>{const _0x4c9234=_0x48b1bb;console[_0x4c9234(0x57e)](_0x4c9234(0x100a)),_0x1f702a[_0x4c9234(0xaef)]();})['on']('error',_0x3381cb=>{const _0xdb31cc=_0x48b1bb;console['error'](_0xdb31cc(0x4a7),_0x3381cb),_0x1f702a[_0xdb31cc(0x127d)](_0x3381cb);})['resume']();}});await _0x423923[_0x3a7e40(0xb7d)](_0x5036a8),await _0x1460c5('导出已开始','您的分片备份已开始下载。解压后，您可以使用“导入”功能，选择其中的\x20`slice_X.json`\x20文件进行增量恢复。');}catch(_0xc54582){console[_0x3a7e40(0x127d)](_0x3a7e40(0x13a9),_0xc54582),await _0x1460c5('导出失败',_0x3a7e40(0xe4d)+_0xc54582[_0x3a7e40(0x11f0)]);try{const _0x57c13e=_0x5036a8['getWriter']();_0x57c13e[_0x3a7e40(0x125c)](_0xc54582);}catch(_0x1d258c){}}}async function _0x534c32(){const _0x1d0574=_0x2b1222;if(!window[_0x1d0574(0x7be)]){alert(_0x1d0574(0xeef));return;}await _0x1460c5(_0x1d0574(0x1565),_0x1d0574(0x28a));const _0x1ab1ce=streamSaver[_0x1d0574(0x46f)](_0x1d0574(0x1587)+new Date()[_0x1d0574(0xc66)]()[_0x1d0574(0x23f)]('T')[0x0]+'.json'),_0x2a6f75=_0x1ab1ce[_0x1d0574(0x75b)](),_0x1f4f74=new TextEncoder();try{await _0x2a6f75[_0x1d0574(0x5d7)](_0x1f4f74[_0x1d0574(0x7bc)](_0x1d0574(0xe33)+Date[_0x1d0574(0xd6e)]()+_0x1d0574(0x11f8)));const _0x181efe=await _0x3df81a[_0x1d0574(0x308)][_0x1d0574(0x1431)](_0x2cf019=>_0x2cf019[_0x1d0574(0x5d2)]);for(let _0x9f9ff0=0x0;_0x9f9ff0<_0x181efe[_0x1d0574(0x58a)];_0x9f9ff0++){const _0x240b2a=_0x181efe[_0x9f9ff0],_0x3ac9a4=_0x3df81a['table'](_0x240b2a);await _0x2a6f75['write'](_0x1f4f74[_0x1d0574(0x7bc)]('\x22'+_0x240b2a+_0x1d0574(0x140a)));let _0x39ac39=!![];await _0x3ac9a4['each'](_0x7680a1=>{const _0x1ef6cc=_0x1d0574;!_0x39ac39&&_0x2a6f75[_0x1ef6cc(0x5d7)](_0x1f4f74[_0x1ef6cc(0x7bc)](',\x0a')),_0x2a6f75[_0x1ef6cc(0x5d7)](_0x1f4f74[_0x1ef6cc(0x7bc)](JSON[_0x1ef6cc(0x994)](_0x7680a1))),_0x39ac39=![];}),await _0x2a6f75[_0x1d0574(0x5d7)](_0x1f4f74[_0x1d0574(0x7bc)]('\x0a]')),_0x9f9ff0<_0x181efe[_0x1d0574(0x58a)]-0x1&&await _0x2a6f75['write'](_0x1f4f74[_0x1d0574(0x7bc)](',\x0a'));}await _0x2a6f75[_0x1d0574(0x5d7)](_0x1f4f74[_0x1d0574(0x7bc)]('\x0a}\x0a}'));}catch(_0x29d526){console[_0x1d0574(0x127d)]('流式导出过程中出错:',_0x29d526),await _0x1460c5(_0x1d0574(0x95c),_0x1d0574(0xb29)+_0x29d526['message']);}finally{await _0x2a6f75[_0x1d0574(0xaef)]();}}async function _0x4b00b1(){const _0x46e435=_0x2b1222;await _0x1460c5('正在准备...','正在读取所有数据到内存中，请稍候...');try{const _0x3b7a93={'version':0x3,'timestamp':Date[_0x46e435(0xd6e)](),'data':{}},_0x5bac11=_0x3df81a[_0x46e435(0x308)][_0x46e435(0x1431)](_0x3c5503=>_0x3c5503[_0x46e435(0x5d2)]);for(const _0x38e96b of _0x5bac11){const _0x1805f0=await _0x3df81a['table'](_0x38e96b)[_0x46e435(0x27a)]();_0x3b7a93[_0x46e435(0xc6b)][_0x38e96b]=_0x1805f0,console[_0x46e435(0x57e)](_0x46e435(0xfd7)+_0x38e96b+_0x46e435(0x15b7)+_0x1805f0[_0x46e435(0x58a)]);}const _0x377a64=new Blob([JSON['stringify'](_0x3b7a93,null,0x2)],{'type':_0x46e435(0xa90)}),_0xdb9d0a=URL[_0x46e435(0x297)](_0x377a64),_0x3a68dc=document[_0x46e435(0x219)]('a');_0x3a68dc[_0x46e435(0x4c6)]=_0xdb9d0a,_0x3a68dc['download']=_0x46e435(0xe74)+new Date()[_0x46e435(0xc66)]()[_0x46e435(0x23f)]('T')[0x0]+'.json',_0x3a68dc['click'](),URL[_0x46e435(0x157c)](_0xdb9d0a),await _0x1460c5('导出成功',_0x46e435(0x1317));}catch(_0x4db016){console[_0x46e435(0x127d)](_0x46e435(0x12ae),_0x4db016),await _0x1460c5(_0x46e435(0x95c),_0x46e435(0x5ea)+_0x4db016['message']);}}function _0x27308f(){const _0x305cfa=_0x2b1222,_0x4c6a6f=Object[_0x305cfa(0x753)](_0x1ae02e[_0x305cfa(0x589)])[_0x305cfa(0x7b6)]((_0x387bf9,_0x483f53)=>{if(_0x483f53['id']===_0x1ae02e['activeChatId'])return _0x387bf9;return _0x387bf9+(_0x483f53['unreadCount']||0x0);},0x0),_0x21a1d2=_0x496f96||0x0,_0x37e44d=_0x4c6a6f+_0x21a1d2,_0x9bcd63=document[_0x305cfa(0x1f4)](_0x305cfa(0x14dd));if(!_0x9bcd63)return;let _0xa201a6=_0x9bcd63[_0x305cfa(0xeda)]('.unread-indicator');!_0xa201a6&&(_0xa201a6=document[_0x305cfa(0x219)](_0x305cfa(0x489)),_0xa201a6[_0x305cfa(0x7c6)]=_0x305cfa(0x844),_0x9bcd63[_0x305cfa(0x6ce)](_0xa201a6));let _0x34d6a3=_0x9bcd63[_0x305cfa(0xeda)](_0x305cfa(0xfbf));_0x34d6a3&&_0x34d6a3['remove'](),_0x37e44d>0x0?(_0xa201a6[_0x305cfa(0x231)]=_0x37e44d>0x63?'99+':_0x37e44d,_0xa201a6[_0x305cfa(0x215)]['display']=_0x305cfa(0x361),_0xa201a6[_0x305cfa(0x215)][_0x305cfa(0xc5f)]='20',_0xa201a6[_0x305cfa(0x215)][_0x305cfa(0x8c6)]=_0x305cfa(0x2a1)):_0xa201a6[_0x305cfa(0x215)][_0x305cfa(0x887)]=_0x305cfa(0x1b5);}async function _0xad4be9(_0x5552ba){const _0x391875=_0x2b1222,_0x1a183c=_0x5552ba===_0x391875(0x139e)?{'id':_0x391875(0x139e),'name':_0x391875(0x13d0)}:await _0x3df81a[_0x391875(0x679)][_0x391875(0x13f8)](_0x5552ba);if(!_0x1a183c){console[_0x391875(0x127d)](_0x391875(0x6d0),_0x5552ba);return;}const _0x61cdc5=document[_0x391875(0x1f4)]('sticker-binding-modal'),_0x45b3d0=document['getElementById']('sticker-binding-chat-list'),_0x3eebfe=_0x61cdc5[_0x391875(0xeda)](_0x391875(0x192));_0x45b3d0[_0x391875(0xf21)]='',_0x3eebfe['textContent']=_0x391875(0x13aa)+_0x1a183c[_0x391875(0x5d2)]+_0x391875(0xa07);const _0x37ab4c=Object['values'](_0x1ae02e[_0x391875(0x589)])['sort']((_0x305f4c,_0x17e688)=>_0x305f4c[_0x391875(0x5d2)][_0x391875(0x1255)](_0x17e688[_0x391875(0x5d2)],'zh-CN'));_0x37ab4c[_0x391875(0x59b)](_0x4387e2=>{const _0x21ca10=_0x391875,_0x3c67a6=Array[_0x21ca10(0x121f)](_0x4387e2[_0x21ca10(0x6a8)]?.['stickerCategoryIds'])&&_0x4387e2[_0x21ca10(0x6a8)]['stickerCategoryIds'][_0x21ca10(0xe82)](_0x5552ba),_0x14d061=document[_0x21ca10(0x219)](_0x21ca10(0xaf9));_0x14d061[_0x21ca10(0x7c6)]=_0x21ca10(0xec5),_0x14d061[_0x21ca10(0xf21)]=_0x21ca10(0x1488)+_0x4387e2['id']+'\x22\x20'+(_0x3c67a6?_0x21ca10(0xe56):'')+'\x20style=\x22margin-right:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+(_0x4387e2[_0x21ca10(0xe83)]?_0x4387e2['settings'][_0x21ca10(0xe46)]:_0x4387e2[_0x21ca10(0x6a8)][_0x21ca10(0xc99)]||_0x5494d0)+_0x21ca10(0xddc)+_0x4387e2[_0x21ca10(0x5d2)]+_0x21ca10(0x12f5),_0x45b3d0['appendChild'](_0x14d061);}),document[_0x391875(0x1f4)](_0x391875(0xebc))['onclick']=()=>_0x2f524c(_0x5552ba),document[_0x391875(0x1f4)](_0x391875(0x1382))['onclick']=()=>_0x61cdc5[_0x391875(0x159b)][_0x391875(0xa9c)](_0x391875(0xfca)),_0x61cdc5[_0x391875(0x159b)][_0x391875(0x6a4)]('visible');}async function _0x2f524c(_0x37b91f){const _0x1dbb69=_0x2b1222,_0x42af20=new Set(Array['from'](document[_0x1dbb69(0x14bf)](_0x1dbb69(0x187)))['map'](_0x48b717=>_0x48b717[_0x1dbb69(0x746)]['chatId'])),_0x337069=[];for(const _0x461787 in _0x1ae02e['chats']){const _0x28daba=_0x1ae02e[_0x1dbb69(0x589)][_0x461787];!Array[_0x1dbb69(0x121f)](_0x28daba[_0x1dbb69(0x6a8)][_0x1dbb69(0x291)])&&(_0x28daba[_0x1dbb69(0x6a8)][_0x1dbb69(0x291)]=[]);const _0x5b30b7=_0x28daba['settings'][_0x1dbb69(0x291)][_0x1dbb69(0xe82)](_0x37b91f),_0xe7c95c=_0x42af20['has'](_0x461787);if(_0x5b30b7&&!_0xe7c95c)_0x28daba[_0x1dbb69(0x6a8)][_0x1dbb69(0x291)]=_0x28daba['settings'][_0x1dbb69(0x291)]['filter'](_0x10638a=>_0x10638a!==_0x37b91f),_0x337069[_0x1dbb69(0x1426)](_0x28daba);else!_0x5b30b7&&_0xe7c95c&&(_0x28daba[_0x1dbb69(0x6a8)][_0x1dbb69(0x291)][_0x1dbb69(0x1426)](_0x37b91f),_0x337069[_0x1dbb69(0x1426)](_0x28daba));}_0x337069[_0x1dbb69(0x58a)]>0x0&&(await _0x3df81a[_0x1dbb69(0x589)][_0x1dbb69(0x8b2)](_0x337069),await _0x1460c5(_0x1dbb69(0x6a9),_0x1dbb69(0xf23))),document[_0x1dbb69(0x1f4)](_0x1dbb69(0x12f3))[_0x1dbb69(0x159b)][_0x1dbb69(0xa9c)]('visible');}function _0x1df3df(_0x50cf93){const _0x32dc32=_0x2b1222;if(!_0x50cf93||!_0x50cf93[_0x32dc32(0x6a8)][_0x32dc32(0x291)]||_0x50cf93['settings'][_0x32dc32(0x291)]['length']===0x0)return'';const _0x39256c=_0x50cf93[_0x32dc32(0x6a8)]['stickerCategoryIds'];let _0x2d1316=[];const _0x236edd=new Set();_0x39256c['forEach'](_0x22a69f=>{const _0x43428b=_0x32dc32;let _0x5372a4;_0x22a69f==='uncategorized'?_0x5372a4=_0x1ae02e[_0x43428b(0x1420)][_0x43428b(0xede)](_0x5ee08a=>!_0x5ee08a[_0x43428b(0x1467)]):_0x5372a4=_0x1ae02e[_0x43428b(0x1420)][_0x43428b(0xede)](_0x1787b8=>_0x1787b8[_0x43428b(0x1467)]===_0x22a69f),_0x5372a4['forEach'](_0x3551fc=>{const _0x1232b2=_0x43428b;!_0x236edd[_0x1232b2(0xe75)](_0x3551fc[_0x1232b2(0x5d2)])&&(_0x2d1316[_0x1232b2(0x1426)](_0x3551fc),_0x236edd[_0x1232b2(0x6a4)](_0x3551fc['name']));});});if(_0x2d1316['length']===0x0)return'';const _0x6d13fd=_0x2d1316[_0x32dc32(0x1431)](_0x42413c=>'-\x20'+_0x42413c['name'])[_0x32dc32(0x1143)]('\x0a');return'\x0a#\x20可用表情包\x20(优先使用)\x0a-\x20请根据当前情景和你的情绪，从列表中【选择一个最合适的】表情含义来使用\x20\x22sticker\x22\x20指令。尽量让你的表情丰富多样，避免重复。\x0a'+_0x6d13fd+'\x0a';}function _0x2c88ab(_0x3b6702){const _0x9e75eb=_0x2b1222;if(!_0x3b6702||!_0x3b6702[_0x9e75eb(0xe83)])return'';let _0x247fdb='\x0a#\x20可用表情包\x20(优先使用)\x0a每个AI角色都被设置了专属表情包，在需要发送表情时，他们应该【优先】从自己的专属列表中选择。尽量让你的表情丰富多样，避免重复。\x0a',_0x3ae228=![];return _0x3b6702['members']['forEach'](_0xdf07bb=>{const _0x226b34=_0x9e75eb;if(_0xdf07bb['id']===_0x226b34(0x860))return;const _0x36b1e5=_0x1ae02e[_0x226b34(0x589)][_0xdf07bb['id']];if(_0x36b1e5&&_0x36b1e5[_0x226b34(0x6a8)][_0x226b34(0x291)]&&_0x36b1e5[_0x226b34(0x6a8)]['stickerCategoryIds'][_0x226b34(0x58a)]>0x0){const _0x4b9e5d=_0x36b1e5[_0x226b34(0x6a8)][_0x226b34(0x291)];let _0x5e930b=[];const _0xaf439b=new Set();_0x4b9e5d[_0x226b34(0x59b)](_0x4fbed6=>{const _0x43b932=_0x226b34;let _0x428e6;_0x4fbed6===_0x43b932(0x139e)?_0x428e6=_0x1ae02e[_0x43b932(0x1420)][_0x43b932(0xede)](_0x426d52=>!_0x426d52[_0x43b932(0x1467)]):_0x428e6=_0x1ae02e['userStickers'][_0x43b932(0xede)](_0x52b0b0=>_0x52b0b0[_0x43b932(0x1467)]===_0x4fbed6),_0x428e6[_0x43b932(0x59b)](_0x4a5c27=>{const _0x5a95f1=_0x43b932;!_0xaf439b[_0x5a95f1(0xe75)](_0x4a5c27[_0x5a95f1(0x5d2)])&&(_0x5e930b['push'](_0x4a5c27),_0xaf439b[_0x5a95f1(0x6a4)](_0x4a5c27['name']));});}),_0x5e930b[_0x226b34(0x58a)]>0x0&&(_0x3ae228=!![],_0x247fdb+=_0x226b34(0x1599)+_0xdf07bb[_0x226b34(0xd69)]+_0x226b34(0x85b)+_0xdf07bb[_0x226b34(0x96f)]+_0x226b34(0x323),_0x247fdb+=_0x5e930b[_0x226b34(0x1431)](_0x405075=>'-\x20'+_0x405075[_0x226b34(0x5d2)])[_0x226b34(0x1143)]('\x0a'));}}),_0x3ae228?_0x247fdb:'';}function _0x463239(_0x487a87){const _0x44b3f1=_0x2b1222;if(!_0x487a87)return 0x0;return Math[_0x44b3f1(0xde8)](_0x487a87[_0x44b3f1(0x58a)]/1.5);}async function _0x1716c1(){const _0x22fe2d=_0x2b1222;if(!_0x1ae02e[_0x22fe2d(0x588)])return 0x0;const _0xcad935=_0x1ae02e['chats'][_0x1ae02e['activeChatId']];if(!_0xcad935)return 0x0;const _0x291415=parseInt(document[_0x22fe2d(0x1f4)](_0x22fe2d(0x127f))[_0x22fe2d(0x107e)])||0xa,_0x266233=parseInt(document['getElementById']('linked-memory-count')['value'])||0xa,_0x1beb83=document['getElementById'](_0x22fe2d(0xca6))[_0x22fe2d(0xe56)],_0x3e406d=document[_0x22fe2d(0x1f4)](_0x22fe2d(0x348))[_0x22fe2d(0x107e)],_0x20c92e=document['getElementById']('my-persona')[_0x22fe2d(0x107e)];let _0x14472e='';const _0xc58283=Array[_0x22fe2d(0xa81)](document[_0x22fe2d(0x14bf)](_0x22fe2d(0x11e3)))[_0x22fe2d(0x1431)](_0xff5134=>_0xff5134['value'][_0x22fe2d(0xef0)](_0x22fe2d(0x7af),''));if(_0xc58283[_0x22fe2d(0x58a)]>0x0){const _0x44d0d9=_0xc58283[_0x22fe2d(0x1431)](_0x121d36=>{const _0x198c23=_0x22fe2d,_0xabcd05=_0x1ae02e['worldBooks']['find'](_0x15e18d=>_0x15e18d['id']===_0x121d36);if(!_0xabcd05||!Array[_0x198c23(0x121f)](_0xabcd05[_0x198c23(0x128c)]))return'';return _0xabcd05[_0x198c23(0x128c)]['filter'](_0x2b7fa2=>_0x2b7fa2[_0x198c23(0x1368)]!==![])[_0x198c23(0x1431)](_0x9cce0c=>_0x9cce0c['content'])[_0x198c23(0x1143)]('\x0a');})[_0x22fe2d(0xede)](Boolean)[_0x22fe2d(0x1143)]('\x0a');_0x14472e+=_0x44d0d9;}_0xcad935[_0x22fe2d(0x5fb)]&&_0xcad935[_0x22fe2d(0x5fb)]['length']>0x0&&(_0x14472e+=_0xcad935[_0x22fe2d(0x5fb)][_0x22fe2d(0x1431)](_0x61ba06=>_0x61ba06[_0x22fe2d(0x128c)])[_0x22fe2d(0x1143)]('\x0a'));const _0x13f1da=document[_0x22fe2d(0x1f4)](_0x22fe2d(0x712))[_0x22fe2d(0xe56)];if(_0x13f1da){const _0x43dae8=Array[_0x22fe2d(0xa81)](document[_0x22fe2d(0x14bf)](_0x22fe2d(0x191)))['map'](_0x128958=>_0x128958[_0x22fe2d(0x107e)]);for(const _0x6e5b8a of _0x43dae8){const _0x9d4eb2=_0x1ae02e[_0x22fe2d(0x589)][_0x6e5b8a];_0x9d4eb2&&_0x9d4eb2[_0x22fe2d(0xce3)][_0x22fe2d(0x58a)]>0x0&&(_0x14472e+=_0x9d4eb2[_0x22fe2d(0xce3)][_0x22fe2d(0x5cc)](-_0x266233)[_0x22fe2d(0x1431)](_0x10d444=>String(_0x10d444[_0x22fe2d(0x128c)]))[_0x22fe2d(0x1143)]('\x0a'));}}_0xcad935[_0x22fe2d(0xe83)]?_0xcad935[_0x22fe2d(0x1402)]['forEach'](_0x32c503=>{const _0x878069=_0x22fe2d;_0x14472e+=_0x32c503[_0x878069(0x3be)];}):_0x14472e+=_0x3e406d;_0x14472e+=_0x20c92e,_0x14472e+=_0x1df3df(_0xcad935);_0xcad935[_0x22fe2d(0xe83)]&&(_0x14472e+=_0x2c88ab(_0xcad935));if(!_0xcad935[_0x22fe2d(0xe83)]&&_0x1beb83){const _0x29ebe0=document[_0x22fe2d(0x1f4)](_0x22fe2d(0x76b))[_0x22fe2d(0x107e)];if(_0x29ebe0){const _0x107122=_0x1ae02e[_0x22fe2d(0xda0)][_0x22fe2d(0x13b7)](_0x293b10=>_0x293b10['id']===_0x29ebe0);_0x107122&&(_0x14472e+=_0x107122[_0x22fe2d(0x128c)][_0x22fe2d(0xede)](_0xca606b=>_0xca606b[_0x22fe2d(0x1368)]!==![])[_0x22fe2d(0x1431)](_0x2233be=>_0x2233be['content'])[_0x22fe2d(0x1143)]('\x0a'));}}const _0x396da6=_0xcad935[_0x22fe2d(0xce3)][_0x22fe2d(0x5cc)](-_0x291415);return _0x14472e+=_0x396da6[_0x22fe2d(0x1431)](_0x1f4938=>{const _0x14fd56=_0x22fe2d;if(typeof _0x1f4938[_0x14fd56(0x128c)]===_0x14fd56(0x6c3))return _0x1f4938['content'];if(Array[_0x14fd56(0x121f)](_0x1f4938[_0x14fd56(0x128c)]))return _0x1f4938['content'][_0x14fd56(0x1431)](_0x475932=>_0x475932[_0x14fd56(0x40f)])[_0x14fd56(0x1143)]('\x20');return'';})[_0x22fe2d(0x1143)]('\x0a'),_0x463239(_0x14472e);}const _0x4d6b07=_0x3f35bb(async()=>{const _0x29ff7b=_0x2b1222,_0x51cf75=document[_0x29ff7b(0x1f4)](_0x29ff7b(0x11bc));if(!_0x51cf75)return;_0x51cf75[_0x29ff7b(0xf21)]=_0x29ff7b(0x1522);try{const _0x46b7e7=await _0x1716c1();_0x51cf75[_0x29ff7b(0xf21)]=_0x29ff7b(0x5ff)+_0x46b7e7+_0x29ff7b(0xa1c);}catch(_0x3f4902){console[_0x29ff7b(0x127d)](_0x29ff7b(0x13e0),_0x3f4902),_0x51cf75[_0x29ff7b(0xf21)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22token-count-label\x22>预估总上下文Token数:</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22token-count-value\x22\x20style=\x22color:\x20red;\x22>计算出错</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';}},0x12c);async function _0x558681(){const _0x4b4f8b=_0x2b1222,_0x48a33a=document[_0x4b4f8b(0x1f4)](_0x4b4f8b(0x769));_0x48a33a[_0x4b4f8b(0xf21)]='',_0x3d56b6=[],_0x3a060d=0x0,_0x11c436=![];const _0x20f12b=[];try{const _0x14dcc2=await _0x3df81a[_0x4b4f8b(0x589)][_0x4b4f8b(0x27a)]();for(const _0x39c982 of _0x14dcc2){_0x39c982[_0x4b4f8b(0xce3)]&&_0x39c982[_0x4b4f8b(0xce3)][_0x4b4f8b(0x58a)]>0x0&&_0x39c982[_0x4b4f8b(0xce3)][_0x4b4f8b(0x59b)](_0x3803ed=>{const _0x13c799=_0x4b4f8b;_0x3803ed[_0x13c799(0xcbd)]===_0x13c799(0x132a)&&_0x3803ed['imageUrl']&&_0x20f12b[_0x13c799(0x1426)]({'sourceType':'chat','imageUrl':_0x3803ed[_0x13c799(0x48d)],'prompt':_0x3803ed[_0x13c799(0x1063)]||_0x3803ed[_0x13c799(0x936)]||'NAI\x20Image','chatId':_0x39c982['id'],'msgTimestamp':_0x3803ed[_0x13c799(0x1388)]});});}}catch(_0x2193b0){console[_0x4b4f8b(0x127d)](_0x4b4f8b(0x903),_0x2193b0);}try{const _0x3fc85b=await _0x3df81a[_0x4b4f8b(0x910)][_0x4b4f8b(0x27a)]();_0x3fc85b[_0x4b4f8b(0x59b)](_0x5576ef=>{const _0x2cb535=_0x4b4f8b;if(_0x5576ef[_0x2cb535(0xcbd)]===_0x2cb535(0x132a)){const _0x141df4=_0x5576ef[_0x2cb535(0x1583)]||(_0x5576ef[_0x2cb535(0x48d)]?[_0x5576ef['imageUrl']]:[]),_0x293956=Array['isArray'](_0x5576ef[_0x2cb535(0x1063)])?_0x5576ef[_0x2cb535(0x1063)]:[_0x5576ef[_0x2cb535(0x1063)]||_0x2cb535(0x2f3)];_0x141df4[_0x2cb535(0x59b)]((_0x56dc62,_0xdcf17c)=>{const _0x463a1c=_0x2cb535;_0x20f12b[_0x463a1c(0x1426)]({'sourceType':'qzone','imageUrl':_0x56dc62,'prompt':_0x293956[_0xdcf17c]||_0x293956[0x0],'postId':_0x5576ef['id'],'imageIndex':_0xdcf17c});});}});}catch(_0x12ce8c){console[_0x4b4f8b(0x127d)]('扫描动态失败:',_0x12ce8c);}_0x3d56b6=_0x20f12b['sort']((_0x331de,_0x263603)=>(_0x263603[_0x4b4f8b(0x11f1)]||_0x263603[_0x4b4f8b(0xd8f)]||0x0)-(_0x331de[_0x4b4f8b(0x11f1)]||_0x331de['postId']||0x0)),_0x3d56b6[_0x4b4f8b(0x58a)]===0x0?_0x48a33a[_0x4b4f8b(0xf21)]='<p\x20style=\x22text-align:center;\x20color:\x20var(--text-secondary);\x20grid-column:\x201\x20/\x20-1;\x22>画廊还是空的，快去生成一些图片吧！</p>':_0x540054(),document[_0x4b4f8b(0x1f4)](_0x4b4f8b(0x301))['classList'][_0x4b4f8b(0x6a4)](_0x4b4f8b(0xfca));}function _0x44ef34(_0x5b8d88){const _0x233117=_0x2b1222,_0xe1ecf1=document[_0x233117(0x1f4)](_0x233117(0x769));if(_0x5b8d88['length']===0x0&&_0x3a060d===0x0){_0xe1ecf1[_0x233117(0xf21)]=_0x233117(0x6f9);return;}const _0x49e69a=document[_0x233117(0xd5c)]();_0x5b8d88[_0x233117(0x59b)]((_0x569a0e,_0x459c9b)=>{const _0x48733c=_0x233117,_0x30958d=document['createElement'](_0x48733c(0xaf9));_0x30958d['className']=_0x48733c(0x7e2),_0x30958d[_0x48733c(0x156f)]=_0x569a0e[_0x48733c(0x1063)];const _0x1ba7b1=_0x569a0e[_0x48733c(0xa50)]+'_'+(_0x569a0e[_0x48733c(0x3e0)]||_0x569a0e['postId'])+'_'+(_0x569a0e['msgTimestamp']||_0x569a0e['imageIndex']);_0x30958d[_0x48733c(0x746)][_0x48733c(0x1505)]=_0x1ba7b1,_0x30958d[_0x48733c(0x746)]['imageUrl']=_0x569a0e[_0x48733c(0x48d)],_0x30958d[_0x48733c(0x746)][_0x48733c(0x1063)]=_0x569a0e[_0x48733c(0x1063)],_0x30958d['innerHTML']=_0x48733c(0xd66)+_0x569a0e[_0x48733c(0x48d)]+')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22nai-gallery-controls\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22nai-gallery-download-btn\x22\x20title=\x22下载\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22currentColor\x22><path\x20d=\x22M19\x209h-4V3H9v6H5l7\x207\x207-7zM5\x2018v2h14v-2H5z\x22></path></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22nai-gallery-delete-btn\x22\x20title=\x22删除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22currentColor\x22><path\x20d=\x22M6\x2019c0\x201.1.9\x202\x202\x202h8c1.1\x200\x202-.9\x202-2V7H6v12zM19\x204h-3.5l-1-1h-5l-1\x201H5v2h14V4z\x22></path></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22nai-gallery-name\x22>'+_0x569a0e[_0x48733c(0x1063)]+_0x48733c(0x12f5),_0x49e69a[_0x48733c(0x6ce)](_0x30958d);}),_0xe1ecf1['appendChild'](_0x49e69a);}async function _0x540054(){const _0x24e67b=_0x2b1222;if(_0x11c436||_0x3a060d>=_0x3d56b6['length'])return;_0x11c436=!![];const _0x3aeb7c=document[_0x24e67b(0x1f4)](_0x24e67b(0x769));_0x5563af(_0x3aeb7c,_0x24e67b(0xb30)),setTimeout(()=>{const _0x1d0cfb=_0x24e67b,_0x360e56=_0x3d56b6['slice'](_0x3a060d,_0x3a060d+_0x52bddc);_0x1335c4(_0x3aeb7c),_0x360e56[_0x1d0cfb(0x58a)]>0x0&&(_0x44ef34(_0x360e56),_0x3a060d+=_0x360e56['length']),_0x11c436=![];},0x1f4);}function _0x285672(){const _0x42a245=_0x2b1222;_0x1ef2b4=!_0x1ef2b4;const _0x586f1c=document['getElementById'](_0x42a245(0x769)),_0x4c519d=document[_0x42a245(0x1f4)](_0x42a245(0xa2b)),_0x4fc7af=document[_0x42a245(0x1f4)](_0x42a245(0x12cb)),_0x41fd0f=document['getElementById'](_0x42a245(0x121d));_0x586f1c[_0x42a245(0x159b)][_0x42a245(0x1483)](_0x42a245(0xb15),_0x1ef2b4),_0x1ef2b4?(_0x4c519d[_0x42a245(0x231)]='完成',_0x4fc7af['style'][_0x42a245(0x887)]=_0x42a245(0xeba),_0x48d248[_0x42a245(0x411)](),_0x41fd0f['checked']=![],_0x3ee9b0()):(_0x4c519d['textContent']='管理',_0x4fc7af[_0x42a245(0x215)]['display']=_0x42a245(0x1b5),_0x586f1c[_0x42a245(0x14bf)](_0x42a245(0x1334))[_0x42a245(0x59b)](_0x1fbfac=>_0x1fbfac['classList'][_0x42a245(0xa9c)](_0x42a245(0xc3e))));}function _0x3ee9b0(){const _0x39d617=_0x2b1222,_0x1a3e3c=document[_0x39d617(0x1f4)](_0x39d617(0xd30)),_0x47b734=document['getElementById'](_0x39d617(0x73a)),_0xe088e1=_0x48d248[_0x39d617(0xb51)];if(_0x1a3e3c)_0x1a3e3c[_0x39d617(0x231)]=_0x39d617(0x408)+_0xe088e1+')';if(_0x47b734)_0x47b734[_0x39d617(0x231)]=_0x39d617(0x1211)+_0xe088e1+')';}function _0x38d6c1(_0x325226){const _0x5a23f4=_0x2b1222,_0x661054=_0x325226['target'][_0x5a23f4(0x96a)](_0x5a23f4(0x137a));if(!_0x661054)return;const _0x46a6d0=_0x661054['dataset'][_0x5a23f4(0x1505)],_0x51bf2a=_0x661054[_0x5a23f4(0x746)]['imageUrl'],_0x36fd30=_0x661054['dataset'][_0x5a23f4(0x1063)];if(_0x325226[_0x5a23f4(0xb57)][_0x5a23f4(0x96a)](_0x5a23f4(0x1520))){_0x325226['stopPropagation'](),_0x1aae1e(_0x51bf2a,_0x36fd30);return;}if(_0x325226[_0x5a23f4(0xb57)][_0x5a23f4(0x96a)]('.nai-gallery-delete-btn')){_0x325226[_0x5a23f4(0x1025)](),_0xd8e0b0(new Set([_0x46a6d0]));return;}if(_0x1ef2b4)_0x661054[_0x5a23f4(0x159b)]['toggle'](_0x5a23f4(0xc3e)),_0x48d248[_0x5a23f4(0xe75)](_0x46a6d0)?_0x48d248[_0x5a23f4(0xc40)](_0x46a6d0):_0x48d248[_0x5a23f4(0x6a4)](_0x46a6d0),_0x3ee9b0();else{const _0x4cd685=_0x5a23f4(0x617),_0x3beba0='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x51bf2a+'\x22\x20style=\x22max-width:\x20100%;\x20border-radius:\x208px;\x20box-shadow:\x200\x204px\x2010px\x20rgba(0,0,0,0.1);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';_0x1460c5(_0x4cd685,_0x3beba0);}}async function _0x44eabb(){const _0xadbc59=_0x2b1222,_0x10f4b5=_0x48d248;if(_0x10f4b5['size']===0x0){alert('请先选择要下载的图片。');return;}if(typeof JSZip===_0xadbc59(0x488)||!window[_0xadbc59(0x7be)]){await _0x1460c5(_0xadbc59(0x1560),_0xadbc59(0x6de));return;}await _0x1460c5(_0xadbc59(0x11b7),'正在准备\x20'+_0x10f4b5['size']+_0xadbc59(0xf71));const _0x724e93=new JSZip();let _0x1eca7f=0x0;const _0x1eaf3e=[],_0x5c0307=Array['from'](_0x10f4b5);_0x5c0307[_0xadbc59(0x59b)]((_0xb985c,_0x110628)=>{const _0x1b565b=_0xadbc59,_0x1c863a=document['querySelector'](_0x1b565b(0x11ec)+_0xb985c+'\x22]');if(!_0x1c863a)return;const _0x944464=_0x1c863a[_0x1b565b(0x746)]['imageUrl'],_0x5888e1=_0x1c863a[_0x1b565b(0x746)]['prompt'],_0xf62e4d=_0x42b280(_0x5888e1),_0x2bcd7c=_0xf62e4d['replace'](/\.png$/,'_('+(_0x110628+0x1)+_0x1b565b(0x84c)),_0xb021ea=((async()=>{const _0x26f9fe=_0x1b565b;try{let _0x16b419;if(_0x944464[_0x26f9fe(0xebf)](_0x26f9fe(0xd32))){const _0x211035=await fetch(_0x944464);_0x16b419=await _0x211035['blob']();}else{let _0x4f51c2;try{_0x4f51c2=await fetch(_0x944464,{'mode':'cors'});if(!_0x4f51c2['ok'])throw new Error('直连失败');}catch(_0x4d5fca){console['warn']('直连失败,\x20尝试使用CORS代理...',_0x4d5fca[_0x26f9fe(0x11f0)]);const _0xd80b61=_0x3b1556();let _0x4b9701=_0xd80b61[_0x26f9fe(0x4fd)]===_0x26f9fe(0xb42)?_0xd80b61[_0x26f9fe(0x703)]:_0xd80b61[_0x26f9fe(0x4fd)];if(!_0x4b9701||_0x4b9701==='')_0x4b9701=_0x26f9fe(0x87e);const _0x5ee249=_0x4b9701+encodeURIComponent(_0x944464);_0x4f51c2=await fetch(_0x5ee249);}if(!_0x4f51c2['ok'])throw new Error(_0x26f9fe(0x39f)+_0x4f51c2[_0x26f9fe(0x1589)]);_0x16b419=await _0x4f51c2[_0x26f9fe(0x128e)]();}_0x724e93[_0x26f9fe(0x5aa)](_0x2bcd7c,_0x16b419,{'binary':!![]});}catch(_0x5f4095){console[_0x26f9fe(0x127d)](_0x26f9fe(0x98d)+_0x944464,_0x5f4095),_0x1eca7f++;}})());_0x1eaf3e['push'](_0xb021ea);}),await Promise[_0xadbc59(0x54b)](_0x1eaf3e);if(_0x1eca7f===_0x10f4b5[_0xadbc59(0xb51)]){await _0x1460c5(_0xadbc59(0x1560),'所有图片都下载失败了。这通常是由于网络问题或CORS跨域限制（请检查API设置中的CORS代理是否有效）。');return;}await _0x1460c5(_0xadbc59(0x234),_0xadbc59(0x13de));try{const _0x4a5412=streamSaver[_0xadbc59(0x46f)](_0xadbc59(0x643)+Date[_0xadbc59(0xd6e)]()+_0xadbc59(0xc02)),_0x163150=_0x724e93[_0xadbc59(0x8e8)]({'type':_0xadbc59(0x128e),'streamFiles':!![]}),_0x4a308c=new ReadableStream({'start'(_0x23e539){const _0x402aac=_0xadbc59;_0x163150['on'](_0x402aac(0xc6b),_0x1e9345=>{const _0x1afd60=_0x402aac;_0x23e539[_0x1afd60(0x115b)](_0x1e9345);})['on'](_0x402aac(0x120b),()=>{const _0x28a935=_0x402aac;console[_0x28a935(0x57e)](_0x28a935(0x100a)),_0x23e539[_0x28a935(0xaef)]();})['on'](_0x402aac(0x127d),_0x24f006=>{const _0x42a333=_0x402aac;console[_0x42a333(0x127d)](_0x42a333(0x4a7),_0x24f006),_0x23e539['error'](_0x24f006);})[_0x402aac(0xf05)]();}});await _0x4a308c[_0xadbc59(0xb7d)](_0x4a5412),_0x1eca7f>0x0&&_0x1460c5(_0xadbc59(0xae6),_0xadbc59(0x8d6)+(_0x10f4b5[_0xadbc59(0xb51)]-_0x1eca7f)+_0xadbc59(0x150b)+_0x1eca7f+_0xadbc59(0x92b));}catch(_0x494365){console[_0xadbc59(0x127d)](_0xadbc59(0x84f),_0x494365),await _0x1460c5('流式下载失败',_0xadbc59(0x62b)+_0x494365['message']);}}async function _0xd8e0b0(_0x50d6ce=null){const _0x47f155=_0x2b1222,_0x13a29f=_0x50d6ce||_0x48d248;if(_0x13a29f['size']===0x0)return;const _0x5961cb=await _0x109970(_0x47f155(0xed1),_0x47f155(0x1b0)+_0x13a29f[_0x47f155(0xb51)]+_0x47f155(0x21b),{'confirmButtonClass':_0x47f155(0x1c6)});if(!_0x5961cb)return;await _0x1460c5(_0x47f155(0x11b7),'正在执行删除操作...');let _0x42cfa2=0x0;const _0x791a2=new Map(),_0xcb9242=new Set(),_0xb6713=new Map(),_0x256f6c=new Set();for(const _0x62f307 of _0x13a29f){if(_0x62f307[_0x47f155(0xebf)](_0x47f155(0x11f5))){const _0x1127c5=_0x62f307[_0x47f155(0x23f)]('_'),_0x4722a1=parseInt(_0x1127c5[0x1]);!isNaN(_0x4722a1)&&_0x256f6c['add'](_0x4722a1);}}const _0x2c7150=new Map();if(_0x256f6c[_0x47f155(0xb51)]>0x0){const _0x122b7d=await _0x3df81a['qzonePosts'][_0x47f155(0x478)]('id')[_0x47f155(0x5b9)](Array[_0x47f155(0xa81)](_0x256f6c))[_0x47f155(0x27a)]();_0x122b7d[_0x47f155(0x59b)](_0x5607bb=>_0x2c7150[_0x47f155(0x3d3)](_0x5607bb['id'],_0x5607bb));}for(const _0x5e0cd6 of _0x13a29f){const _0x4da722=_0x5e0cd6[_0x47f155(0x23f)]('_');if(_0x4da722['length']<0x3){console['warn'](_0x47f155(0x95e),_0x5e0cd6);continue;}const _0x294e04=_0x4da722[0x0],_0x5a0823=_0x4da722[_0x47f155(0x1139)](),_0x3286b3=_0x4da722['slice'](0x1)[_0x47f155(0x1143)]('_');if(_0x294e04===_0x47f155(0x21a)){const _0x23f202=_0x3286b3,_0x323b7d=parseInt(_0x5a0823);if(!_0x791a2[_0x47f155(0xe75)](_0x23f202)){const _0x1011d5=await _0x3df81a[_0x47f155(0x589)][_0x47f155(0x13f8)](_0x23f202);if(_0x1011d5)_0x791a2['set'](_0x23f202,_0x1011d5);else{console[_0x47f155(0xb3b)](_0x47f155(0x5dc)+_0x23f202+_0x47f155(0x886));continue;}}const _0x307d69=_0x791a2[_0x47f155(0x13f8)](_0x23f202);if(_0x307d69&&_0x307d69['history']){const _0x2bf3d2=_0x307d69[_0x47f155(0xce3)][_0x47f155(0x58a)];_0x307d69[_0x47f155(0xce3)]=_0x307d69[_0x47f155(0xce3)][_0x47f155(0xede)](_0x57f0d3=>_0x57f0d3[_0x47f155(0x1388)]!==_0x323b7d),_0x307d69[_0x47f155(0xce3)][_0x47f155(0x58a)]<_0x2bf3d2&&(_0x42cfa2++,_0x791a2[_0x47f155(0x3d3)](_0x23f202,_0x307d69));}}else{if(_0x294e04===_0x47f155(0x10bf)){const _0x2f3755=parseInt(_0x3286b3),_0x3f380c=parseInt(_0x5a0823),_0x241252=_0xb6713['get'](_0x2f3755)||_0x2c7150['get'](_0x2f3755);if(!_0x241252){console[_0x47f155(0xb3b)](_0x47f155(0xde7)+_0x2f3755+_0x47f155(0x886));continue;}const _0x39b37c=_0x241252[_0x47f155(0x1583)]||(_0x241252['imageUrl']?[_0x241252[_0x47f155(0x48d)]]:[]);if(_0x39b37c[_0x47f155(0x58a)]<=0x1)_0xcb9242[_0x47f155(0x6a4)](_0x2f3755),_0xb6713['has'](_0x2f3755)&&_0xb6713[_0x47f155(0xc40)](_0x2f3755);else{const _0x91753e=_0x39b37c[_0x3f380c];_0x241252[_0x47f155(0x1583)]=_0x241252['imageUrls'][_0x47f155(0xede)](_0x2e2cae=>_0x2e2cae!==_0x91753e),_0x241252[_0x47f155(0x1063)]&&Array[_0x47f155(0x121f)](_0x241252[_0x47f155(0x1063)])&&_0x241252[_0x47f155(0x1063)][_0x3f380c]&&_0x241252[_0x47f155(0x1063)][_0x47f155(0x30b)](_0x3f380c,0x1),_0x241252[_0x47f155(0x48d)]=_0x241252[_0x47f155(0x1583)][0x0]||null,_0xb6713[_0x47f155(0x3d3)](_0x2f3755,_0x241252);}_0x42cfa2++;}}}try{await _0x3df81a[_0x47f155(0x13a5)]('rw',_0x3df81a['chats'],_0x3df81a[_0x47f155(0x910)],async()=>{const _0x2c8968=_0x47f155;_0x791a2[_0x2c8968(0xb51)]>0x0&&await _0x3df81a['chats'][_0x2c8968(0x8b2)](Array[_0x2c8968(0xa81)](_0x791a2[_0x2c8968(0x753)]())),_0xb6713[_0x2c8968(0xb51)]>0x0&&await _0x3df81a[_0x2c8968(0x910)]['bulkPut'](Array[_0x2c8968(0xa81)](_0xb6713[_0x2c8968(0x753)]())),_0xcb9242[_0x2c8968(0xb51)]>0x0&&await _0x3df81a['qzonePosts'][_0x2c8968(0xab7)](Array[_0x2c8968(0xa81)](_0xcb9242));}),_0x285672(),await _0x558681(),await _0x1460c5(_0x47f155(0xfed),_0x47f155(0x819)+_0x42cfa2+'\x20张图片。'),document[_0x47f155(0x1f4)](_0x47f155(0x13c3))[_0x47f155(0x159b)]['contains'](_0x47f155(0x7cf))&&_0x3689f0(_0x1ae02e[_0x47f155(0x588)]),document[_0x47f155(0x1f4)](_0x47f155(0x11b5))[_0x47f155(0x159b)]['contains'](_0x47f155(0x7cf))&&_0x28d6f7();}catch(_0x3babec){console[_0x47f155(0x127d)](_0x47f155(0x901),_0x3babec),await _0x1460c5('删除失败','操作失败:\x20'+_0x3babec[_0x47f155(0x11f0)]);}}function _0x42b280(_0x34e930){const _0xb3ed1c=_0x2b1222,_0x2a1412=_0x34e930||_0xb3ed1c(0x532);let _0x216ebd=_0x2a1412[_0xb3ed1c(0xef0)](/[^a-zA-Z0-9\u4e00-\u9fa5\s]/g,'_')[_0xb3ed1c(0xef0)](/\s+/g,'_')['substring'](0x0,0x1e);!_0x216ebd&&(_0x216ebd=_0xb3ed1c(0x532));const _0x548521=new Date()[_0xb3ed1c(0xc66)]()[_0xb3ed1c(0xef0)](/[-:]/g,'')[_0xb3ed1c(0xef0)]('T','_')[_0xb3ed1c(0x23f)]('.')[0x0];return _0x216ebd+'_'+_0x548521+_0xb3ed1c(0x1535);}async function _0x2642a0(){const _0xc64c06=_0x2b1222;initLanguage();async function _0x4357ae(_0x13b3df){const _0x56b659=_0x475c;if(!_0x13b3df)return;try{const _0x351e98=await _0x13b3df[_0x56b659(0x40f)](),_0x4cae49=JSON[_0x56b659(0x129c)](_0x351e98);if(_0x4cae49[_0x56b659(0xcbd)]===_0x56b659(0xf07))console[_0x56b659(0x57e)](_0x56b659(0xa49)),await _0x3cd55a(_0x4cae49);else{if(_0x4cae49['entries']&&typeof _0x4cae49[_0x56b659(0xd20)]===_0x56b659(0xcc5)){console[_0x56b659(0x57e)](_0x56b659(0x110d));try{await _0x431b54(),await _0x23d63b(_0x4cae49,_0x13b3df[_0x56b659(0x5d2)]);}catch(_0x4f994a){console[_0x56b659(0xb3b)](_0x56b659(0xb8c),_0x4f994a[_0x56b659(0x11f0)]);}}else throw new Error('文件格式无法识别。请确保您选择的是有效的\x20EPhone\x20世界书备份或\x20Tavern\x20AI\x20世界书文件。');}}catch(_0x2f8991){console['error'](_0x56b659(0x6cb),_0x2f8991),await _0x1460c5(_0x56b659(0x15ca),_0x56b659(0x37d)+_0x2f8991['message']);}}async function _0x23d63b(_0x2c1154,_0x472ed4){const _0x398f18=_0x475c,_0x5eff3c=_0x472ed4[_0x398f18(0xef0)](/\.json$/i,''),_0x5d2c89=await _0x11f6fb(_0x398f18(0x1511),_0x398f18(0x841),_0x5eff3c);if(!_0x5d2c89||!_0x5d2c89[_0x398f18(0x4a2)]()){alert(_0x398f18(0x169));return;}const _0x35b304=Object[_0x398f18(0x753)](_0x2c1154[_0x398f18(0xd20)])[_0x398f18(0x1431)](_0x183067=>{const _0x2ca903=_0x398f18;return{'keys':_0x183067[_0x2ca903(0x1505)]||[],'comment':_0x183067[_0x2ca903(0x306)]||_0x2ca903(0x286),'content':_0x183067[_0x2ca903(0x128c)]||'','enabled':!_0x183067['disable']};})[_0x398f18(0xede)](_0xccee68=>_0xccee68[_0x398f18(0x128c)]);if(_0x35b304[_0x398f18(0x58a)]===0x0){alert(_0x398f18(0x44a));return;}const _0x41854f={'id':_0x398f18(0x524)+Date[_0x398f18(0xd6e)](),'name':_0x5d2c89[_0x398f18(0x4a2)](),'content':_0x35b304,'categoryId':null};await _0x3df81a[_0x398f18(0x1453)][_0x398f18(0x6a4)](_0x41854f),_0x1ae02e[_0x398f18(0x1453)][_0x398f18(0x1426)](_0x41854f),await _0x23735f(),await _0x1460c5(_0x398f18(0x3f1),_0x398f18(0x1016)+_0x5d2c89+'》。');}async function _0x4ec9a5(){const _0x3ef46f=_0x475c;try{const _0x1201d8=await _0x3df81a[_0x3ef46f(0x1453)][_0x3ef46f(0x27a)](),_0x2266de=await _0x3df81a['worldBookCategories'][_0x3ef46f(0x27a)]();if(_0x1201d8[_0x3ef46f(0x58a)]===0x0&&_0x2266de[_0x3ef46f(0x58a)]===0x0){alert(_0x3ef46f(0x14fd));return;}const _0x158ac7={'type':_0x3ef46f(0xf07),'version':0x1,'timestamp':Date[_0x3ef46f(0xd6e)](),'books':_0x1201d8,'categories':_0x2266de},_0x301ebd=new Blob([JSON[_0x3ef46f(0x994)](_0x158ac7,null,0x2)],{'type':'application/json'}),_0x56783c=URL[_0x3ef46f(0x297)](_0x301ebd),_0x284d70=document[_0x3ef46f(0x219)]('a');_0x284d70[_0x3ef46f(0x4c6)]=_0x56783c,_0x284d70['download']='EPhone-WorldBooks-'+new Date()['toISOString']()['split']('T')[0x0]+_0x3ef46f(0x445),_0x284d70[_0x3ef46f(0x740)](),URL['revokeObjectURL'](_0x56783c),await _0x1460c5(_0x3ef46f(0xf2f),'所有世界书数据已成功导出！');}catch(_0x24dbe9){console[_0x3ef46f(0x127d)](_0x3ef46f(0xd10),_0x24dbe9),await _0x1460c5(_0x3ef46f(0x95c),_0x3ef46f(0x5ea)+_0x24dbe9['message']);}}async function _0x3cd55a(_0x4d5347){const _0x3b8c32=_0x475c;try{if(_0x4d5347[_0x3b8c32(0xcbd)]!==_0x3b8c32(0xf07)||!_0x4d5347[_0x3b8c32(0x7f0)])throw new Error(_0x3b8c32(0xc80));const _0x5f409c=await _0x109970(_0x3b8c32(0x6c2),_0x3b8c32(0x4ec),{'confirmButtonClass':_0x3b8c32(0x1c6),'confirmText':_0x3b8c32(0xa0a)});if(!_0x5f409c)return;await _0x3df81a[_0x3b8c32(0x13a5)]('rw',_0x3df81a[_0x3b8c32(0x1453)],_0x3df81a[_0x3b8c32(0xde3)],async()=>{const _0x1b7617=_0x3b8c32;await _0x3df81a[_0x1b7617(0x1453)][_0x1b7617(0x411)](),await _0x3df81a[_0x1b7617(0xde3)][_0x1b7617(0x411)](),Array['isArray'](_0x4d5347[_0x1b7617(0x7f0)])&&await _0x3df81a[_0x1b7617(0x1453)]['bulkPut'](_0x4d5347[_0x1b7617(0x7f0)]),Array[_0x1b7617(0x121f)](_0x4d5347['categories'])&&await _0x3df81a['worldBookCategories'][_0x1b7617(0x8b2)](_0x4d5347[_0x1b7617(0xffa)]);}),_0x1ae02e[_0x3b8c32(0x1453)]=await _0x3df81a[_0x3b8c32(0x1453)][_0x3b8c32(0x27a)](),await _0x23735f(),await _0x1460c5(_0x3b8c32(0x1159),'世界书数据已成功恢复！');}catch(_0x39d20b){console[_0x3b8c32(0x127d)](_0x3b8c32(0x6cb),_0x39d20b),await _0x1460c5(_0x3b8c32(0x15ca),'文件解析或应用失败:\x20'+_0x39d20b['message']);}}const _0x9a0514=localStorage[_0xc64c06(0x587)](_0xc64c06(0x567));if(_0x9a0514){const _0x1164e3=(Date['now']()-parseInt(_0x9a0514))/(0x3e8*0x3c);_0x1164e3>0x5&&_0x5668d2(_0x1164e3);}_0x16901c(),window[_0xc64c06(0xfa4)]=_0x2e53fa,window[_0xc64c06(0xd5a)]=_0x54bb4b,window[_0xc64c06(0xc95)]=_0x2e7bad,window[_0xc64c06(0x825)]=_0x40349d,window[_0xc64c06(0xfea)]=_0x45577b,window[_0xc64c06(0xbda)]=_0x597899,window[_0xc64c06(0x1313)]=_0x533dbb,window[_0xc64c06(0xaae)]=_0x58774f,window[_0xc64c06(0x18d)]=_0x2b00f0;const _0x53548c=document['createElement']('div');_0x53548c['id']=_0xc64c06(0xf17),_0x53548c['innerHTML']=_0xc64c06(0x2b9),document[_0xc64c06(0x1f4)](_0xc64c06(0xa4c))[_0xc64c06(0x6ce)](_0x53548c);const _0x23545=document[_0xc64c06(0x219)]('style');_0x23545['id']=_0xc64c06(0x13a1),document['head'][_0xc64c06(0x6ce)](_0x23545),_0x4d11d5['panelEl']=document[_0xc64c06(0x1f4)](_0xc64c06(0xea0)),_0x4d11d5[_0xc64c06(0x7ae)]=document[_0xc64c06(0x1f4)](_0xc64c06(0x87a));const _0x1bb203=localStorage['getItem']('ephone-theme')||_0xc64c06(0x1336);_0x486571(_0x1bb203);const _0x5a2ffa=document[_0xc64c06(0x219)](_0xc64c06(0x215));_0x5a2ffa['id']=_0xc64c06(0x35f),document['head']['appendChild'](_0x5a2ffa);const _0x38367c=document['createElement']('style');_0x38367c['id']='preview-bubble-style',document[_0xc64c06(0xda4)][_0xc64c06(0x6ce)](_0x38367c),_0x5379ba('',_0xc64c06(0xf0a),_0xc64c06(0x35f)),_0x5379ba('',_0xc64c06(0x76a),_0xc64c06(0x1bf)),window['openRenderingRulesScreen']=_0x54bb4b,window[_0xc64c06(0xfa4)]=_0x2e53fa,window[_0xc64c06(0x10cb)]=_0x1033ae,window['renderApiSettingsProxy']=_0x218733,window[_0xc64c06(0x8b5)]=_0x1216fb,window[_0xc64c06(0x25f)]=_0x23735f,await _0x18cf35(),_0x496c6d(),_0x4de72f(_0x1ae02e['globalSettings'][_0xc64c06(0x46a)]),_0xf32df4(_0x1ae02e[_0xc64c06(0x12c0)]['detachStatusBar']),_0x1798d7(_0x1ae02e[_0xc64c06(0x12c0)][_0xc64c06(0x1110)]),await _0x339620(),_0x1807b6(_0x1ae02e[_0xc64c06(0x12c0)][_0xc64c06(0x359)]);const _0x37425b=parseInt(localStorage[_0xc64c06(0x587)](_0xc64c06(0x11ce)))||0x0;_0xfc0942(_0x37425b);_0x1ae02e[_0xc64c06(0x12c0)]&&_0x1ae02e[_0xc64c06(0x12c0)][_0xc64c06(0xa4e)]&&_0x143b61(_0x1ae02e[_0xc64c06(0x12c0)][_0xc64c06(0xa4e)]);_0x42aa36(),setInterval(_0x42aa36,0x3e8*0x1e),_0x47f04e(),_0x266315(),_0x57e1d4(),_0x5556f9(),document[_0xc64c06(0x1f4)]('rules-tabs')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x296945=>{const _0x3afaf0=_0xc64c06;_0x296945[_0x3afaf0(0xb57)][_0x3afaf0(0x159b)]['contains'](_0x3afaf0(0x3b4))&&_0x576cd2(_0x296945[_0x3afaf0(0xb57)][_0x3afaf0(0x746)][_0x3afaf0(0x1467)]);}),document['getElementById']('add-new-rule-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>_0x17e3bd(null)),document[_0xc64c06(0x1f4)](_0xc64c06(0x11d8))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x745f38=_0xc64c06;document[_0x745f38(0x1f4)]('rule-editor-modal')['classList'][_0x745f38(0xa9c)]('visible');}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1180))['addEventListener']('click',_0x4fea28),document[_0xc64c06(0x1f4)](_0xc64c06(0xfee))[_0xc64c06(0x122b)]('click',()=>{const _0x2b77df=_0xc64c06;if(_0x1ae02e[_0x2b77df(0x588)]&&!_0x1ae02e[_0x2b77df(0x589)][_0x1ae02e['activeChatId']][_0x2b77df(0xe83)]){const _0x358765=_0x1ae02e[_0x2b77df(0x589)][_0x1ae02e['activeChatId']];_0x2baf5c(_0x358765['id'],_0x358765['originalName']);}});let _0xc04190=null;function _0x3b2afa(_0x1bf99a){const _0x1253e6=_0xc64c06;_0xc04190=_0x1bf99a;const _0x281a53=_0x1ae02e['chats'][_0x1ae02e[_0x1253e6(0x588)]],_0x236f10=_0x281a53[_0x1253e6(0x5ab)][_0x1253e6(0x13b7)](_0x17b8b7=>_0x17b8b7['id']===_0x1bf99a);if(!_0x236f10)return;const _0x1b526f=document[_0x1253e6(0x1f4)]('announcement-action-pin');_0x1b526f['textContent']=_0x236f10['isPinned']?'取消置顶':_0x1253e6(0xcd4),document[_0x1253e6(0x1f4)]('announcement-actions-modal')[_0x1253e6(0x159b)][_0x1253e6(0x6a4)](_0x1253e6(0xfca));}async function _0x1b7f38(){const _0x2be92c=_0xc64c06;if(!_0xc04190)return;const _0x212fd6=_0x1ae02e[_0x2be92c(0x589)][_0x1ae02e[_0x2be92c(0x588)]],_0x2e66c8=_0x212fd6[_0x2be92c(0x5ab)][_0x2be92c(0x13b7)](_0x3e732b=>_0x3e732b['id']===_0xc04190);_0x2e66c8&&(_0x2e66c8[_0x2be92c(0x6e3)]=!_0x2e66c8[_0x2be92c(0x6e3)],await _0x3df81a['chats'][_0x2be92c(0x295)](_0x212fd6),_0x2404ac()),document[_0x2be92c(0x1f4)](_0x2be92c(0x1244))[_0x2be92c(0x159b)][_0x2be92c(0xa9c)](_0x2be92c(0xfca));}async function _0x35bdcd(){const _0x10d395=_0xc64c06;if(!_0xc04190)return;const _0xd22edf=await _0x109970(_0x10d395(0xed1),_0x10d395(0x141a),{'confirmButtonClass':'btn-danger'});if(_0xd22edf){const _0x3b951e=_0x1ae02e['chats'][_0x1ae02e['activeChatId']];_0x3b951e[_0x10d395(0x5ab)]=_0x3b951e['announcements'][_0x10d395(0xede)](_0x24889d=>_0x24889d['id']!==_0xc04190),await _0x3df81a[_0x10d395(0x589)]['put'](_0x3b951e),_0x2404ac();}document[_0x10d395(0x1f4)](_0x10d395(0x1244))['classList'][_0x10d395(0xa9c)](_0x10d395(0xfca));}document[_0xc64c06(0x1f4)](_0xc64c06(0x1048))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x3b5fc9),document['getElementById']('custom-modal-overlay')['addEventListener'](_0xc64c06(0x740),_0x4a60f2=>{const _0x528d8a=_0xc64c06;if(_0x4a60f2[_0x528d8a(0xb57)]===_0x3826f5)_0x3b5fc9();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x766))['addEventListener'](_0xc64c06(0x740),async()=>{const _0x5a1879=_0xc64c06,_0x3fa7e8=await _0x12414d(_0x5a1879(0x1430),[{'text':_0x5a1879(0xbbd),'value':_0x5a1879(0x5cc)},{'text':_0x5a1879(0x4db),'value':_0x5a1879(0x836)},{'text':_0x5a1879(0xf1a),'value':'blob'}]);if(_0x3fa7e8===_0x5a1879(0x5cc))_0x2d7811();else{if(_0x3fa7e8===_0x5a1879(0x836))_0x534c32();else _0x3fa7e8===_0x5a1879(0x128e)&&_0x4b00b1();}}),document['getElementById'](_0xc64c06(0x155f))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0xcb7a4b),document['getElementById'](_0xc64c06(0xca6))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0xee86ec=>{const _0x26dc7b=_0xc64c06;document[_0x26dc7b(0x1f4)](_0x26dc7b(0xa58))['style']['display']=_0xee86ec[_0x26dc7b(0xb57)][_0x26dc7b(0xe56)]?_0x26dc7b(0x361):_0x26dc7b(0x1b5);}),document[_0xc64c06(0x1f4)]('import-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>document[_0xc64c06(0x1f4)]('import-data-input')[_0xc64c06(0x740)]()),document[_0xc64c06(0x1f4)](_0xc64c06(0x330))[_0xc64c06(0x122b)]('change',_0x45af5b=>{const _0x132f3a=_0xc64c06;document[_0x132f3a(0x1f4)](_0x132f3a(0x2a9))[_0x132f3a(0x215)][_0x132f3a(0x887)]=_0x45af5b[_0x132f3a(0xb57)][_0x132f3a(0xe56)]?_0x132f3a(0x361):_0x132f3a(0x1b5);}),document[_0xc64c06(0x1f4)](_0xc64c06(0x30d))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0xe19ccd=>_0xbaca74(_0xe19ccd[_0xc64c06(0xb57)][_0xc64c06(0x8b1)][0x0])),document[_0xc64c06(0x1f4)]('import-card-input')[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x537d50),document[_0xc64c06(0x1f4)]('back-to-list-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x4d7af2=_0xc64c06;_0x3913ad={},_0x5379ba('',_0x4d7af2(0xf0a),_0x4d7af2(0x35f)),_0x5379ba('',_0x4d7af2(0x76a),_0x4d7af2(0x1bf)),_0x527427(),_0x1ae02e[_0x4d7af2(0x588)]=null,_0x2e53fa(_0x4d7af2(0x133d));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1002))['addEventListener'](_0xc64c06(0x740),async()=>{const _0x539773=_0xc64c06,_0x211ac0=await _0x12414d(_0x539773(0xdcc),[{'text':_0x539773(0xaf1),'value':_0x539773(0xf32)},{'text':_0x539773(0x1c4),'value':_0x539773(0x745)}]);if(_0x211ac0==='manual'){const _0xcfb2ef=await _0x11f6fb(_0x539773(0x7fb),_0x539773(0x67b));if(!_0xcfb2ef||!_0xcfb2ef[_0x539773(0x4a2)]())return;const _0x43435c=await _0x11f6fb(_0x539773(0x23b),_0x539773(0x981));if(!_0x43435c||!_0x43435c[_0x539773(0x4a2)]())return;const _0xb932f2=_0x539773(0x13b9)+Date['now'](),_0xd7162c={'id':_0xb932f2,'name':_0xcfb2ef[_0x539773(0x4a2)](),'originalName':_0x43435c['trim'](),'isGroup':![],'isPinned':![],'unreadCount':0x0,'relationship':{'status':_0x539773(0xfe3),'blockedTimestamp':null,'applicationReason':''},'status':{'text':'在线','lastUpdate':Date[_0x539773(0xd6e)](),'isBusy':![]},'settings':{'aiPersona':_0x539773(0x1036),'myPersona':'我是谁呀。','myNickname':'我','maxMemory':0xa,'aiAvatar':_0x5494d0,'myAvatar':_0x5494d0,'background':'','theme':_0x539773(0x372),'fontSize':0xd,'customCss':'','linkedWorldBookIds':[],'aiAvatarLibrary':[],'myAvatarLibrary':[],'enableBackgroundActivity':!![],'actionCooldownMinutes':0xf,'enableTimePerception':!![],'isOfflineMode':![],'offlineMinLength':0x64,'offlineMaxLength':0x12c,'offlinePresetId':null,'timeZone':_0x539773(0x1001)},'history':[],'musicData':{'totalTime':0x0},'longTermMemory':[],'thoughtsHistory':[]};_0x1ae02e[_0x539773(0x589)][_0xb932f2]=_0xd7162c,await _0x3df81a[_0x539773(0x589)]['put'](_0xd7162c),_0x1033ae();}else{if(_0x211ac0==='import_card')try{await _0x431b54(),document[_0x539773(0x1f4)](_0x539773(0xaca))[_0x539773(0x740)]();}catch(_0x286330){console[_0x539773(0xb3b)](_0x539773(0xaf5),_0x286330['message']);}}}),document['getElementById'](_0xc64c06(0x280))[_0xc64c06(0x122b)]('click',_0x1a96cc),document['getElementById'](_0xc64c06(0x12a6))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>document[_0xc64c06(0x1f4)](_0xc64c06(0xf14))[_0xc64c06(0x159b)][_0xc64c06(0xa9c)](_0xc64c06(0xfca))),document[_0xc64c06(0x1f4)](_0xc64c06(0xf30))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x43f2fd),document[_0xc64c06(0x1f4)](_0xc64c06(0x2dc))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x2e7bad),document[_0xc64c06(0x1f4)](_0xc64c06(0xb74))['addEventListener']('click',()=>_0x33c89f(!![])),document[_0xc64c06(0x1f4)](_0xc64c06(0x142d))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x3d1c84),document['getElementById'](_0xc64c06(0xdde))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x12f193),document['getElementById'](_0xc64c06(0xfb8))['addEventListener'](_0xc64c06(0x740),_0x7288cb),document['getElementById']('music-prev-btn')['addEventListener'](_0xc64c06(0x740),_0x305f7d),document['getElementById'](_0xc64c06(0xc37))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x11fe89),document['getElementById'](_0xc64c06(0x257))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x332e57=_0xc64c06;_0x13c03f(),document['getElementById'](_0x332e57(0x1444))[_0x332e57(0x159b)][_0x332e57(0x6a4)]('visible');}),document[_0xc64c06(0x1f4)](_0xc64c06(0x143e))['addEventListener'](_0xc64c06(0x740),()=>document[_0xc64c06(0x1f4)](_0xc64c06(0x1444))[_0xc64c06(0x159b)]['remove'](_0xc64c06(0xfca))),document['getElementById'](_0xc64c06(0x1228))['addEventListener']('click',_0x352c30),document['getElementById'](_0xc64c06(0x68c))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>document[_0xc64c06(0x1f4)](_0xc64c06(0x6d6))[_0xc64c06(0x740)]()),document[_0xc64c06(0x1f4)](_0xc64c06(0x6d6))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x567779),document['getElementById']('playlist-body')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x8adb29=>{const _0x369ea9=_0xc64c06,_0x37643a=_0x8adb29[_0x369ea9(0xb57)],_0x284990=parseInt(_0x37643a['dataset'][_0x369ea9(0x10ba)]);if(isNaN(_0x284990))return;if(_0x37643a[_0x369ea9(0x159b)][_0x369ea9(0xaea)](_0x369ea9(0x2c1)))_0x188dd6(_0x284990);else{if(_0x37643a[_0x369ea9(0x159b)][_0x369ea9(0xaea)]('lyrics-btn'))_0x192e7a(_0x284990);else{if(_0x37643a[_0x369ea9(0x159b)][_0x369ea9(0xaea)](_0x369ea9(0x838)))_0x3caebb(_0x284990);else _0x37643a[_0x369ea9(0x159b)][_0x369ea9(0xaea)]('delete-track-btn')&&_0x352267(_0x284990);}}}),_0x43beab[_0xc64c06(0x122b)](_0xc64c06(0xe6b),()=>{const _0x4ac660=_0xc64c06;document[_0x4ac660(0x1f4)](_0x4ac660(0xe44))[_0x4ac660(0x159b)][_0x4ac660(0xa9c)](_0x4ac660(0x875)),_0x7288cb();});const _0x35ff61=document[_0xc64c06(0x1f4)](_0xc64c06(0x3e7));document[_0xc64c06(0x1f4)](_0xc64c06(0x127b))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x2fcd52=_0xc64c06;_0x2d0337();const _0x7ad0a0=_0x35ff61[_0x2fcd52(0x107e)][_0x2fcd52(0x4a2)]();if(!_0x7ad0a0||!_0x1ae02e[_0x2fcd52(0x588)])return;const _0x5d0645=_0x1ae02e['chats'][_0x1ae02e[_0x2fcd52(0x588)]],_0x2bf9b5={'role':_0x2fcd52(0x860),'content':_0x7ad0a0,'timestamp':Date[_0x2fcd52(0xd6e)]()};_0x44c23e&&(_0x2bf9b5[_0x2fcd52(0xadf)]=_0x44c23e),_0x5286f1(_0x2bf9b5,_0x5d0645),((async()=>{const _0x2f0862=_0x2fcd52;_0x5d0645['history'][_0x2f0862(0x1426)](_0x2bf9b5),await _0x3df81a[_0x2f0862(0x589)][_0x2f0862(0x295)](_0x5d0645),_0x1033ae();})()),_0x35ff61[_0x2fcd52(0x107e)]='',_0x35ff61['style']['height']='auto',_0x35ff61[_0x2fcd52(0xed2)](),_0x47891a(),document['body'][_0x2fcd52(0x159b)][_0x2fcd52(0xa9c)](_0x2fcd52(0x2c7));}),document[_0xc64c06(0x1f4)]('wait-reply-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x5626da),_0x35ff61[_0xc64c06(0x122b)](_0xc64c06(0x81a),_0x231856=>{const _0x1d12e2=_0xc64c06;_0x231856[_0x1d12e2(0x1505)]==='Enter'&&!_0x231856[_0x1d12e2(0x7b0)]&&(_0x231856[_0x1d12e2(0x32e)](),document[_0x1d12e2(0x1f4)](_0x1d12e2(0x127b))[_0x1d12e2(0x740)]());}),document[_0xc64c06(0x1f4)](_0xc64c06(0x12ad))[_0xc64c06(0x122b)](_0xc64c06(0x1147),async _0x3160d4=>{const _0x9d3688=_0xc64c06,_0x1222bf=_0x3160d4['target'][_0x9d3688(0x8b1)][0x0];if(_0x1222bf){const _0xcfbcd4=await new Promise((_0x185182,_0x562c1e)=>{const _0x5bbe17=_0x9d3688,_0x17f431=new FileReader();_0x17f431['onload']=()=>_0x185182(_0x17f431[_0x5bbe17(0xbc9)]),_0x17f431[_0x5bbe17(0xdf5)]=()=>_0x562c1e(_0x17f431[_0x5bbe17(0x127d)]),_0x17f431[_0x5bbe17(0x21e)](_0x1222bf);});_0x13859b=_0xcfbcd4,_0x1216fb();}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x5b8))[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x2a9b9b=_0xc64c06;_0x13859b&&(_0x1ae02e['globalSettings'][_0x2a9b9b(0xd23)]=_0x13859b),_0x1ae02e['globalSettings'][_0x2a9b9b(0x359)]=document[_0x2a9b9b(0x1f4)]('global-css-input')[_0x2a9b9b(0x107e)][_0x2a9b9b(0x4a2)](),_0x1ae02e[_0x2a9b9b(0x12c0)][_0x2a9b9b(0xe88)]=document[_0x2a9b9b(0x1f4)](_0x2a9b9b(0xe07))[_0x2a9b9b(0x107e)][_0x2a9b9b(0x4a2)](),_0x1ae02e[_0x2a9b9b(0x12c0)][_0x2a9b9b(0xad9)]=document['getElementById'](_0x2a9b9b(0x36e))[_0x2a9b9b(0xe56)],_0x1ae02e['globalSettings']['showPhoneFrame']=document[_0x2a9b9b(0x1f4)](_0x2a9b9b(0x9c6))[_0x2a9b9b(0xe56)],_0x1ae02e['globalSettings'][_0x2a9b9b(0x1110)]=document['getElementById'](_0x2a9b9b(0x157b))['checked'],_0x1ae02e[_0x2a9b9b(0x12c0)][_0x2a9b9b(0xbde)]=document[_0x2a9b9b(0x1f4)](_0x2a9b9b(0x3c3))['checked'],_0x1ae02e[_0x2a9b9b(0x12c0)][_0x2a9b9b(0x298)]=document[_0x2a9b9b(0x1f4)]('detach-status-bar-switch')['checked'],await _0x3df81a[_0x2a9b9b(0x12c0)]['put'](_0x1ae02e['globalSettings']),_0x47f04e(),_0x3fbfc(),_0x13859b=null,_0x57e1d4(),_0x50b88d(),_0x1807b6(_0x1ae02e['globalSettings'][_0x2a9b9b(0x359)]),_0x496c6d(),_0x1798d7(_0x1ae02e[_0x2a9b9b(0x12c0)]['enableMinimalChatUI']),alert('外观设置已保存并应用！'),_0x2e53fa(_0x2a9b9b(0x3b7));});const _0x150143=document['getElementById'](_0xc64c06(0xeb0));_0x150143[_0xc64c06(0x122b)]('scroll',()=>{const {scrollTop:_0x496b34,scrollHeight:_0x2d38f0,clientHeight:_0x76d363}=_0x150143;_0x2d38f0-_0x496b34-_0x76d363<_0x76d363&&(!_0x5cbd47&&_0x29147e());}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1264))[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x26c45f=_0xc64c06;_0x1ae02e[_0x26c45f(0x226)][_0x26c45f(0x157a)]=document[_0x26c45f(0x1f4)](_0x26c45f(0x926))['value'][_0x26c45f(0x4a2)](),_0x1ae02e['apiConfig'][_0x26c45f(0x13b6)]=document['getElementById'](_0x26c45f(0xa65))[_0x26c45f(0x107e)][_0x26c45f(0x4a2)](),_0x1ae02e[_0x26c45f(0x226)][_0x26c45f(0x9ef)]=document['getElementById']('model-select')[_0x26c45f(0x107e)],_0x1ae02e[_0x26c45f(0x226)][_0x26c45f(0x87d)]=document[_0x26c45f(0x1f4)]('minimax-group-id')[_0x26c45f(0x107e)]['trim'](),_0x1ae02e[_0x26c45f(0x226)][_0x26c45f(0x1502)]=document[_0x26c45f(0x1f4)](_0x26c45f(0x1395))[_0x26c45f(0x107e)][_0x26c45f(0x4a2)](),_0x1ae02e['apiConfig'][_0x26c45f(0x11fe)]=document[_0x26c45f(0x1f4)]('minimax-model-select')[_0x26c45f(0x107e)],_0x1ae02e['apiConfig'][_0x26c45f(0x78a)]=document['getElementById']('secondary-proxy-url')[_0x26c45f(0x107e)]['trim'](),_0x1ae02e[_0x26c45f(0x226)][_0x26c45f(0x247)]=document[_0x26c45f(0x1f4)]('secondary-api-key')[_0x26c45f(0x107e)][_0x26c45f(0x4a2)](),_0x1ae02e[_0x26c45f(0x226)][_0x26c45f(0xe21)]=document[_0x26c45f(0x1f4)](_0x26c45f(0xfeb))[_0x26c45f(0x107e)],await _0x3df81a['apiConfig'][_0x26c45f(0x295)](_0x1ae02e[_0x26c45f(0x226)]);const _0x149414=document[_0x26c45f(0x1f4)](_0x26c45f(0x4eb)),_0x261f8e=document[_0x26c45f(0x1f4)](_0x26c45f(0xc2b)),_0x4d86f8=document[_0x26c45f(0x1f4)]('block-cooldown-input');_0x1ae02e[_0x26c45f(0x12c0)]['enableBackgroundActivity']=_0x149414[_0x26c45f(0xe56)],_0x1ae02e[_0x26c45f(0x12c0)]['backgroundActivityInterval']=parseInt(_0x261f8e[_0x26c45f(0x107e)])||0x3c,_0x1ae02e[_0x26c45f(0x12c0)][_0x26c45f(0x8a1)]=parseFloat(_0x4d86f8['value'])||0x1,_0x1ae02e[_0x26c45f(0x12c0)][_0x26c45f(0x7d1)]=document['getElementById'](_0x26c45f(0x76d))['checked'],_0x1ae02e[_0x26c45f(0x12c0)][_0x26c45f(0xf47)]=parseInt(document[_0x26c45f(0x1f4)](_0x26c45f(0x8cc))[_0x26c45f(0x107e)])||0x32,_0x1ae02e['globalSettings'][_0x26c45f(0x12d7)]=parseInt(document[_0x26c45f(0x1f4)](_0x26c45f(0x713))[_0x26c45f(0x107e)])||0x1e,_0x1ae02e['globalSettings'][_0x26c45f(0x217)]=parseFloat(document[_0x26c45f(0x1f4)](_0x26c45f(0x1496))[_0x26c45f(0x107e)]),await _0x3df81a[_0x26c45f(0x12c0)][_0x26c45f(0x295)](_0x1ae02e[_0x26c45f(0x12c0)]),_0x2d78a9();_0x1ae02e[_0x26c45f(0x12c0)][_0x26c45f(0x605)]?(_0x217a5b(),console[_0x26c45f(0x57e)](_0x26c45f(0x505)+_0x1ae02e[_0x26c45f(0x12c0)][_0x26c45f(0xfd5)]+'秒')):console[_0x26c45f(0x57e)](_0x26c45f(0x16a));const _0x21cdcb=document['getElementById'](_0x26c45f(0x6d8))['checked'],_0x208e41=document[_0x26c45f(0x1f4)]('novelai-model')['value'],_0x312e8a=document[_0x26c45f(0x1f4)](_0x26c45f(0x8f7))[_0x26c45f(0x107e)]['trim']();localStorage[_0x26c45f(0xae8)]('novelai-enabled',_0x21cdcb),localStorage[_0x26c45f(0xae8)](_0x26c45f(0xf6b),_0x208e41),localStorage[_0x26c45f(0xae8)]('novelai-api-key',_0x312e8a),alert(_0x26c45f(0xd96));});const _0x201b56=document['getElementById']('api-key');_0x201b56[_0xc64c06(0x122b)]('focus',_0x58ef07=>{const _0x3bfd1f=_0xc64c06;_0x58ef07[_0x3bfd1f(0xb57)][_0x3bfd1f(0xfe2)](_0x3bfd1f(0xcbd),'text');}),_0x201b56[_0xc64c06(0x122b)](_0xc64c06(0x941),_0x32ad5d=>{const _0x1628e6=_0xc64c06;_0x32ad5d[_0x1628e6(0xb57)][_0x1628e6(0xfe2)](_0x1628e6(0xcbd),_0x1628e6(0x797));});async function _0x4f22c4(_0x1dca09,_0x15c37a,_0x4e2299){const _0x12520f=_0xc64c06,_0x428317=document['getElementById'](_0x1dca09)[_0x12520f(0x107e)][_0x12520f(0x4a2)](),_0x3b38dd=document[_0x12520f(0x1f4)](_0x15c37a)[_0x12520f(0x107e)][_0x12520f(0x4a2)]();if(!_0x428317||!_0x3b38dd)return alert(_0x12520f(0x159f));try{let _0x8ecbb8=_0x428317===GEMINI_API_URL;const _0x5c46eb=await fetch(_0x8ecbb8?GEMINI_API_URL+_0x12520f(0xc81)+getRandomValue(_0x3b38dd):_0x428317+_0x12520f(0xb58),_0x8ecbb8?undefined:{'headers':{'Authorization':_0x12520f(0xf03)+_0x3b38dd}});if(!_0x5c46eb['ok'])throw new Error(_0x12520f(0xc24));const _0x2334ec=await _0x5c46eb[_0x12520f(0xb84)]();let _0x1714da=_0x8ecbb8?_0x2334ec[_0x12520f(0x8ad)]['map'](_0x184efb=>({'id':_0x184efb[_0x12520f(0x5d2)]['split']('/')[0x1]||_0x184efb[_0x12520f(0x5d2)]})):_0x2334ec['data'];const _0xe62c03=document[_0x12520f(0x1f4)](_0x4e2299);_0xe62c03[_0x12520f(0xf21)]='';const _0x3b2105=_0x4e2299===_0x12520f(0x166)?_0x1ae02e[_0x12520f(0x226)][_0x12520f(0x9ef)]:_0x1ae02e[_0x12520f(0x226)][_0x12520f(0xe21)];_0x1714da[_0x12520f(0x59b)](_0x17b77f=>{const _0x519898=_0x12520f,_0x4660aa=document['createElement']('option');_0x4660aa[_0x519898(0x107e)]=_0x17b77f['id'],_0x4660aa[_0x519898(0x231)]=_0x17b77f['id'];if(_0x17b77f['id']===_0x3b2105)_0x4660aa[_0x519898(0xc3e)]=!![];_0xe62c03['appendChild'](_0x4660aa);}),alert(_0x12520f(0xf46));}catch(_0x26fb7e){alert(_0x12520f(0x1463)+_0x26fb7e[_0x12520f(0x11f0)]);}}document[_0xc64c06(0x1f4)](_0xc64c06(0x1325))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x542dde=_0xc64c06;_0x4f22c4('proxy-url','api-key',_0x542dde(0x166));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x79d))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x539e46=_0xc64c06;_0x4f22c4(_0x539e46(0x385),_0x539e46(0xc25),_0x539e46(0xfeb));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x5b4))[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x58c92c=_0xc64c06,_0x75d40e=await _0x11f6fb(_0x58c92c(0x787),_0x58c92c(0x104a));if(_0x75d40e&&_0x75d40e[_0x58c92c(0x4a2)]()){const _0x574c7e={'id':_0x58c92c(0x524)+Date[_0x58c92c(0xd6e)](),'name':_0x75d40e['trim'](),'content':''};await _0x3df81a[_0x58c92c(0x1453)][_0x58c92c(0x6a4)](_0x574c7e),_0x1ae02e['worldBooks'][_0x58c92c(0x1426)](_0x574c7e),_0x23735f(),_0x15f8e1(_0x574c7e['id']);}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x6ad))['addEventListener'](_0xc64c06(0x740),async()=>{const _0x714198=_0xc64c06;if(!_0x3e528d)return;const _0x48cebd=_0x1ae02e[_0x714198(0x1453)]['find'](_0x2c3085=>_0x2c3085['id']===_0x3e528d);if(!_0x48cebd)return;const _0x32c73e=document[_0x714198(0x1f4)](_0x714198(0x527))['value'][_0x714198(0x4a2)]();if(!_0x32c73e){alert(_0x714198(0xa67));return;}_0x48cebd[_0x714198(0x5d2)]=_0x32c73e;const _0x92009b=document[_0x714198(0x1f4)]('world-book-category-select')[_0x714198(0x107e)];_0x48cebd['categoryId']=_0x92009b?parseInt(_0x92009b):null;const _0x2e6fed=document[_0x714198(0x1f4)](_0x714198(0x62a)),_0x4ec3f0=_0x2e6fed[_0x714198(0x14bf)](_0x714198(0x707)),_0x140d3f=[];_0x4ec3f0[_0x714198(0x59b)](_0x739dbe=>{const _0x14af7a=_0x714198,_0x5192b5=_0x739dbe[_0x14af7a(0xeda)](_0x14af7a(0x1307))[_0x14af7a(0x107e)][_0x14af7a(0x4a2)](),_0x2274d7=_0x739dbe[_0x14af7a(0xeda)](_0x14af7a(0xfe1))[_0x14af7a(0x107e)]['trim'](),_0x12aaf8=_0x739dbe[_0x14af7a(0xeda)](_0x14af7a(0x7c2))[_0x14af7a(0xe56)];_0x2274d7&&_0x140d3f[_0x14af7a(0x1426)]({'comment':_0x739dbe[_0x14af7a(0xeda)](_0x14af7a(0xbc5))[_0x14af7a(0x107e)][_0x14af7a(0x4a2)](),'keys':_0x5192b5?_0x5192b5[_0x14af7a(0x23f)](',')['map'](_0x4bbf73=>_0x4bbf73['trim']())['filter'](_0x3bd59b=>_0x3bd59b):[],'content':_0x2274d7,'enabled':_0x12aaf8});}),_0x48cebd[_0x714198(0x128c)]=_0x140d3f,await _0x3df81a[_0x714198(0x1453)][_0x714198(0x295)](_0x48cebd),document[_0x714198(0x1f4)](_0x714198(0xb16))[_0x714198(0x231)]=_0x32c73e,_0x3e528d=null,_0x2e53fa('world-book-screen'),await _0x23735f();}),document[_0xc64c06(0x1f4)](_0xc64c06(0xd31))[_0xc64c06(0x122b)](_0xc64c06(0x740),async _0x5ddede=>{const _0x268866=_0xc64c06,_0x404b63=_0x5ddede['target'][_0x268866(0x96a)](_0x268866(0x56a));if(_0x404b63){_0x5ddede[_0x268866(0x1025)]();const _0xcb6fd1=_0x5ddede[_0x268866(0xb57)][_0x268866(0x96a)](_0x268866(0x251));if(_0xcb6fd1){const _0x2d6f4d=parseInt(_0xcb6fd1[_0x268866(0x746)]['timestamp']);!isNaN(_0x2d6f4d)&&await _0x1416e1(_0x2d6f4d,_0x404b63);}return;}const _0x10039b=_0x5ddede['target'][_0x268866(0x96a)](_0x268866(0xe7e));if(_0x10039b){const _0x376c73=_0x1ae02e[_0x268866(0x589)][_0x1ae02e[_0x268866(0x588)]];if(!_0x376c73)return;_0x5244c5(_0x10039b);const _0x2c6e85=_0x10039b[_0x268866(0x96a)](_0x268866(0x251)),_0x3b6f21=_0x2c6e85?_0x2c6e85[_0x268866(0xeda)](_0x268866(0x11d4)):null;if(_0x10039b[_0x268866(0x746)]['voiceId']&&_0x3b6f21&&_0x3b6f21['style'][_0x268866(0x887)]===_0x268866(0x361)){if(_0x376c73[_0x268866(0xe83)]){console[_0x268866(0x57e)]('这是一条群聊语音消息，已禁止发起TTS请求。');return;}if(_0x376c73[_0x268866(0x6a8)]['enableTts']===![]){console[_0x268866(0x57e)]('“'+_0x376c73[_0x268866(0x5d2)]+_0x268866(0x1123));return;}_0x1c9be1(_0x10039b);}return;}const _0xf46720=_0x5ddede[_0x268866(0xb57)]['closest'](_0x268866(0x625));if(_0xf46720){const _0x780512=_0xf46720['closest']('.message-bubble');if(_0x780512){const _0x55d95b=parseInt(_0x780512[_0x268866(0x746)]['timestamp']);if(!isNaN(_0x55d95b)){_0x109af1(_0x55d95b);return;}}}const _0x26e1f2=_0x5ddede[_0x268866(0xb57)][_0x268866(0x96a)](_0x268866(0x1383));if(_0x26e1f2){const _0x1c2f28=_0x26e1f2[_0x268866(0x96a)](_0x268866(0x251));if(_0x1c2f28){const _0x36dea1=parseInt(_0x1c2f28[_0x268866(0x746)]['timestamp']),_0x1d88e1=_0x26e1f2[_0x268866(0x746)]['choice'];if(!isNaN(_0x36dea1)&&_0x1d88e1){await _0x57ac52(_0x36dea1,_0x1d88e1);return;}}}const _0x20e83c=_0x5ddede[_0x268866(0xb57)][_0x268866(0x96a)](_0x268866(0x1422));if(_0x20e83c){const _0x29b6fb=parseInt(_0x20e83c[_0x268866(0x746)][_0x268866(0xd8f)]);if(!isNaN(_0x29b6fb)){const _0x15d513=await _0x3df81a[_0x268866(0x910)][_0x268866(0x13f8)](_0x29b6fb);if(_0x15d513){let _0x15c54c='';const _0x1669d6=_0x15d513[_0x268866(0x12cf)]===_0x268866(0x860)?_0x1ae02e[_0x268866(0x11ef)][_0x268866(0xb46)]:_0x1ae02e[_0x268866(0x589)][_0x15d513[_0x268866(0x12cf)]]?.[_0x268866(0x5d2)]||_0x268866(0x864);if(_0x15d513[_0x268866(0xcbd)]===_0x268866(0x30e))_0x15c54c=_0x15d513[_0x268866(0x128c)];else{_0x15c54c=_0x15d513[_0x268866(0xf1f)]||'';if(_0x15d513[_0x268866(0x48d)])_0x15c54c+=_0x268866(0xb0b);if(_0x15d513[_0x268866(0x1090)])_0x15c54c+=_0x268866(0x952)+_0x15d513['hiddenContent']+']';}_0x1460c5(_0x268866(0x189)+_0x1669d6+_0x268866(0x932),_0x15c54c[_0x268866(0xef0)](/\n/g,_0x268866(0xc9b)));}else _0x1460c5('提示',_0x268866(0x1393));}return;}const _0x21dbaf=_0x5ddede[_0x268866(0xb57)][_0x268866(0x96a)](_0x268866(0xe60));if(_0x21dbaf){const _0x125025=_0x21dbaf[_0x268866(0x746)]['description'];if(_0x125025)_0x1460c5('照片描述',_0x125025);return;}const _0x4cdb9b=_0x5ddede['target'][_0x268866(0x96a)](_0x268866(0x172));if(_0x4cdb9b&&_0x4cdb9b[_0x268866(0x746)]['originalTimestamp']){const _0x2e99e4=parseInt(_0x4cdb9b[_0x268866(0x746)][_0x268866(0x14fe)]);!isNaN(_0x2e99e4)&&_0x165061(_0x2e99e4);}const _0x527a3c=_0x5ddede[_0x268866(0xb57)][_0x268866(0x96a)](_0x268866(0x78e));if(_0x527a3c){const _0x456fbe=_0x527a3c[_0x268866(0x96a)](_0x268866(0x251));_0x456fbe&&_0xe31fb(parseInt(_0x456fbe[_0x268866(0x746)]['timestamp']));}const _0x15b349=_0x5ddede[_0x268866(0xb57)][_0x268866(0x96a)](_0x268866(0x8d7));if(_0x15b349){const _0x2e4b09=_0x15b349['closest'](_0x268866(0x251));if(_0x2e4b09&&_0x2e4b09[_0x268866(0x746)][_0x268866(0x1388)]){const _0xffe0d5=parseInt(_0x2e4b09[_0x268866(0x746)][_0x268866(0x1388)]);_0x528a5e(_0xffe0d5);}}const _0x5013e1=_0x5ddede[_0x268866(0xb57)][_0x268866(0x96a)](_0x268866(0x1070));if(_0x5013e1){const _0x55eb75=parseInt(_0x5013e1[_0x268866(0x746)]['pollTimestamp']);if(isNaN(_0x55eb75))return;const _0x20996d=_0x5ddede[_0x268866(0xb57)][_0x268866(0x96a)](_0x268866(0xd65));if(_0x20996d&&!_0x5013e1[_0x268866(0x159b)][_0x268866(0xaea)](_0x268866(0xd87))){_0x2b9da2(_0x55eb75,_0x20996d['dataset'][_0x268866(0x10bb)]);return;}const _0x728f99=_0x5ddede[_0x268866(0xb57)][_0x268866(0x96a)]('.poll-action-btn');if(_0x728f99){_0x5013e1[_0x268866(0x159b)]['contains'](_0x268866(0xd87))?_0x55b32a(_0x55eb75):_0x16b605(_0x55eb75);return;}_0x5013e1['classList']['contains'](_0x268866(0xd87))&&_0x55b32a(_0x55eb75);}const _0x101ad6=_0x5ddede[_0x268866(0xb57)][_0x268866(0x96a)](_0x268866(0xe9c));if(_0x101ad6){const _0x3af7e3=_0x1ae02e['chats'][_0x1ae02e[_0x268866(0x588)]],_0x43a555=_0x101ad6[_0x268866(0x96a)](_0x268866(0x711));if(_0x3af7e3&&_0x43a555){const _0x3c6160=parseInt(_0x43a555['dataset'][_0x268866(0x1388)]),_0x5ea8c2=_0x3af7e3[_0x268866(0xce3)][_0x268866(0x13b7)](_0x1a05ea=>_0x1a05ea[_0x268866(0x1388)]===_0x3c6160);if(_0x5ea8c2&&_0x5ea8c2['recalledData']){let _0x5c4b9b='';const _0x286009=_0x5ea8c2['recalledData'];_0x286009['originalType']===_0x268866(0x40f)?_0x5c4b9b=_0x268866(0xb8d)+_0x286009[_0x268866(0xb2f)]+'\x22':_0x5c4b9b=_0x268866(0x1b7)+_0x286009['originalType']+_0x268866(0x106a),_0x1460c5(_0x268866(0x1299),_0x5c4b9b);}}}const _0x20c491=_0x5ddede[_0x268866(0xb57)][_0x268866(0x96a)]('.link-share-card');if(_0x20c491&&_0x20c491[_0x268866(0x96a)]('.message-bubble.is-link-share')){const _0x1364d3=parseInt(_0x20c491['dataset'][_0x268866(0x1388)]);_0x2c2d06(_0x1364d3);}const _0x32c31f=_0x5ddede[_0x268866(0xb57)][_0x268866(0x96a)](_0x268866(0x251));if(_0x32c31f&&_0x32c31f['classList'][_0x268866(0xaea)]('ai')&&_0x32c31f[_0x268866(0x159b)][_0x268866(0xaea)]('is-transfer')&&_0x32c31f[_0x268866(0x746)][_0x268866(0x1589)]===_0x268866(0x630)){const _0x24013e=parseInt(_0x32c31f['dataset'][_0x268866(0x1388)]);!isNaN(_0x24013e)&&_0x1632cb(_0x24013e);}});const _0x2b2be6=document[_0xc64c06(0x1f4)](_0xc64c06(0xccd)),_0xc32d08=document[_0xc64c06(0xeda)](_0xc64c06(0x83f)),_0x5f153e=document[_0xc64c06(0x1f4)]('world-book-checkboxes-container');function _0x52ae54(){const _0x370ffe=_0xc64c06,_0x3b6a0d=_0x5f153e['querySelectorAll'](_0x370ffe(0x7e7)),_0x42c8a1=document[_0x370ffe(0xeda)](_0x370ffe(0x13a4));if(_0x3b6a0d[_0x370ffe(0x58a)]===0x0)_0x42c8a1[_0x370ffe(0x231)]=_0x370ffe(0xfd0);else{if(_0x3b6a0d[_0x370ffe(0x58a)]>0x2)_0x42c8a1[_0x370ffe(0x231)]='已选择\x20'+_0x3b6a0d[_0x370ffe(0x58a)]+_0x370ffe(0x595);else{const _0x4f29c8=Array[_0x370ffe(0xa81)](_0x3b6a0d)[_0x370ffe(0x1431)](_0x213a1b=>{return _0x213a1b['parentElement']['textContent']['trim']();});_0x42c8a1[_0x370ffe(0x231)]=_0x4f29c8['join'](',\x20');}}}_0xc32d08[_0xc64c06(0x122b)]('click',_0x47b3d7=>{const _0x1aa6b4=_0xc64c06;_0x47b3d7[_0x1aa6b4(0x1025)](),_0x5f153e[_0x1aa6b4(0x159b)][_0x1aa6b4(0x1483)](_0x1aa6b4(0xfca)),_0xc32d08[_0x1aa6b4(0x159b)][_0x1aa6b4(0x1483)](_0x1aa6b4(0xa18));}),document['getElementById']('world-book-checkboxes-container')[_0xc64c06(0x122b)]('change',_0x52ae54),window[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x264867=>{const _0x449fe3=_0xc64c06;!document[_0x449fe3(0xeda)](_0x449fe3(0x1551))[_0x449fe3(0xaea)](_0x264867[_0x449fe3(0xb57)])&&(_0x5f153e[_0x449fe3(0x159b)]['remove'](_0x449fe3(0xfca)),_0xc32d08[_0x449fe3(0x159b)][_0x449fe3(0xa9c)](_0x449fe3(0xa18)));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x4c4))[_0xc64c06(0x122b)]('click',async()=>{const _0x33e3c4=_0xc64c06;_0x42cb64();if(!_0x1ae02e[_0x33e3c4(0x588)])return;const _0x4be00e=_0x1ae02e[_0x33e3c4(0x589)][_0x1ae02e[_0x33e3c4(0x588)]],_0x180e6d=_0x4be00e[_0x33e3c4(0xe83)],_0x746d85=document['getElementById'](_0x33e3c4(0x1456));!_0x180e6d&&_0x4be00e[_0x33e3c4(0x6a8)]['alternateGreetings']&&_0x4be00e[_0x33e3c4(0x6a8)][_0x33e3c4(0x12ee)][_0x33e3c4(0x58a)]>0x0?_0x746d85[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x33e3c4(0x361):_0x746d85[_0x33e3c4(0x215)]['display']='none';document['getElementById']('chat-name-group')[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x33e3c4(0x361),document[_0x33e3c4(0x1f4)]('my-persona-group')['style'][_0x33e3c4(0x887)]='block',document['getElementById'](_0x33e3c4(0xdc5))['style'][_0x33e3c4(0x887)]=_0x33e3c4(0x361),document['getElementById']('my-group-nickname-group')[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x180e6d?_0x33e3c4(0x361):_0x33e3c4(0x1b5),document[_0x33e3c4(0x1f4)](_0x33e3c4(0x597))[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x180e6d?_0x33e3c4(0x1b5):'block',document['getElementById'](_0x33e3c4(0x151e))['style'][_0x33e3c4(0x887)]=_0x180e6d?'block':_0x33e3c4(0x1b5),document[_0x33e3c4(0x1f4)](_0x33e3c4(0x1080))[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x180e6d?_0x33e3c4(0x361):_0x33e3c4(0x1b5),document[_0x33e3c4(0x1f4)](_0x33e3c4(0x12c2))[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x180e6d?_0x33e3c4(0x1b5):_0x33e3c4(0x361),document['getElementById'](_0x33e3c4(0xcb9))[_0x33e3c4(0x215)]['display']=_0x180e6d?'none':'block',document['getElementById']('assign-group-section')['style'][_0x33e3c4(0x887)]=_0x180e6d?_0x33e3c4(0x1b5):'block',document[_0x33e3c4(0x1f4)](_0x33e3c4(0xb01))['style']['display']=_0x180e6d?_0x33e3c4(0x1b5):_0x33e3c4(0x361),document['getElementById'](_0x33e3c4(0xedd))[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x180e6d?_0x33e3c4(0x1b5):'block',document[_0x33e3c4(0x1f4)](_0x33e3c4(0x7f7))[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x180e6d?_0x33e3c4(0x1b5):_0x33e3c4(0x361),document[_0x33e3c4(0x1f4)](_0x33e3c4(0x883))[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x180e6d?_0x33e3c4(0x1b5):_0x33e3c4(0x361),document[_0x33e3c4(0x1f4)](_0x33e3c4(0x993))[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x180e6d?_0x33e3c4(0x1b5):_0x33e3c4(0x361),document['getElementById'](_0x33e3c4(0x199))[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x180e6d?_0x33e3c4(0x361):_0x33e3c4(0x1b5),document[_0x33e3c4(0x1f4)]('chat-name-input')[_0x33e3c4(0x107e)]=_0x4be00e[_0x33e3c4(0x5d2)],document[_0x33e3c4(0x1f4)](_0x33e3c4(0x1285))[_0x33e3c4(0x107e)]=_0x4be00e[_0x33e3c4(0x6a8)][_0x33e3c4(0x36b)],document[_0x33e3c4(0x1f4)]('my-avatar-preview')[_0x33e3c4(0x9fe)]=_0x4be00e[_0x33e3c4(0x6a8)][_0x33e3c4(0x1207)]||(_0x180e6d?_0x203a38:_0x5494d0),document[_0x33e3c4(0x1f4)]('max-memory')[_0x33e3c4(0x107e)]=_0x4be00e['settings'][_0x33e3c4(0x4b2)],document['getElementById'](_0x33e3c4(0x4d5))[_0x33e3c4(0x107e)]=_0x4be00e[_0x33e3c4(0x6a8)][_0x33e3c4(0x11c5)]||0xa;const _0x3e82c6=document[_0x33e3c4(0x1f4)]('bg-preview'),_0x304d4f=document[_0x33e3c4(0x1f4)](_0x33e3c4(0xa38));_0x4be00e['settings'][_0x33e3c4(0xece)]?(_0x3e82c6[_0x33e3c4(0x9fe)]=_0x4be00e['settings'][_0x33e3c4(0xece)],_0x3e82c6[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x33e3c4(0x361),_0x304d4f['style'][_0x33e3c4(0x887)]=_0x33e3c4(0x5f5)):(_0x3e82c6[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x33e3c4(0x1b5),_0x304d4f['style'][_0x33e3c4(0x887)]='none');document[_0x33e3c4(0x1f4)](_0x33e3c4(0x568))[_0x33e3c4(0x215)]['display']=_0x180e6d?_0x33e3c4(0x1b5):_0x33e3c4(0x361),document[_0x33e3c4(0x1f4)](_0x33e3c4(0x154d))[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x180e6d?'none':_0x33e3c4(0x361),document[_0x33e3c4(0x1f4)](_0x33e3c4(0x146c))[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x180e6d?'block':'none';const _0x8c3d7a=document['getElementById']('time-perception-toggle'),_0x27f887=document['getElementById'](_0x33e3c4(0x2a9));_0x8c3d7a[_0x33e3c4(0xe56)]=_0x4be00e['settings'][_0x33e3c4(0x885)],_0x27f887[_0x33e3c4(0x215)]['display']=_0x8c3d7a[_0x33e3c4(0xe56)]?_0x33e3c4(0x361):_0x33e3c4(0x1b5);const _0x46c452=document[_0x33e3c4(0x1f4)](_0x33e3c4(0x7ff)),_0x2d44ac=Intl[_0x33e3c4(0x811)](_0x33e3c4(0x63f));_0x46c452[_0x33e3c4(0xf21)]='',_0x2d44ac[_0x33e3c4(0x59b)](_0x153199=>{const _0x4baad3=_0x33e3c4,_0x27a496=document[_0x4baad3(0x219)](_0x4baad3(0x10bb));_0x27a496['value']=_0x153199,_0x27a496['textContent']=_0x153199,_0x46c452[_0x4baad3(0x6ce)](_0x27a496);}),_0x46c452[_0x33e3c4(0x107e)]=_0x4be00e['settings'][_0x33e3c4(0x63f)]||_0x33e3c4(0x1001);if(_0x180e6d)document['getElementById'](_0x33e3c4(0xf75))[_0x33e3c4(0xe56)]=_0x4be00e[_0x33e3c4(0x6a8)][_0x33e3c4(0x605)],document[_0x33e3c4(0x1f4)]('my-group-nickname-input')[_0x33e3c4(0x107e)]=_0x4be00e[_0x33e3c4(0x6a8)][_0x33e3c4(0xe31)]||'',document['getElementById'](_0x33e3c4(0x543))[_0x33e3c4(0x9fe)]=_0x4be00e['settings'][_0x33e3c4(0xe46)]||_0x22fe34,document[_0x33e3c4(0x1f4)](_0x33e3c4(0xb87))[_0x33e3c4(0x107e)]=_0x4be00e[_0x33e3c4(0x6a8)][_0x33e3c4(0xfa7)]||0xa,document[_0x33e3c4(0x1f4)](_0x33e3c4(0x154d))['style'][_0x33e3c4(0x887)]=_0x33e3c4(0x1b5),_0x1ac316(_0x4be00e[_0x33e3c4(0x1402)]);else{document[_0x33e3c4(0x1f4)]('single-char-background-activity-group')[_0x33e3c4(0x215)]['display']=_0x33e3c4(0x361),document[_0x33e3c4(0x1f4)]('char-background-activity-switch')['checked']=_0x4be00e[_0x33e3c4(0x6a8)]['enableBackgroundActivity'],document[_0x33e3c4(0x1f4)](_0x33e3c4(0xe3f))[_0x33e3c4(0xe56)]=_0x4be00e['settings'][_0x33e3c4(0xf16)];const _0x4a456e=document[_0x33e3c4(0x1f4)](_0x33e3c4(0xca6)),_0x3e4359=document[_0x33e3c4(0x1f4)]('offline-mode-options'),_0x1434d0=document[_0x33e3c4(0x1f4)]('offline-min-length-input'),_0x3b826c=document[_0x33e3c4(0x1f4)]('offline-max-length-input');_0x4a456e[_0x33e3c4(0xe56)]=_0x4be00e[_0x33e3c4(0x6a8)][_0x33e3c4(0x3f6)]||![],_0x3e4359[_0x33e3c4(0x215)][_0x33e3c4(0x887)]=_0x4a456e[_0x33e3c4(0xe56)]?'block':_0x33e3c4(0x1b5),_0x1434d0['value']=_0x4be00e['settings'][_0x33e3c4(0x5b0)]||0x64,_0x3b826c[_0x33e3c4(0x107e)]=_0x4be00e['settings'][_0x33e3c4(0x873)]||0x12c,await _0x51f0fc(_0x4be00e),document[_0x33e3c4(0x1f4)](_0x33e3c4(0xb3d))[_0x33e3c4(0x107e)]=_0x4be00e['originalName'],document[_0x33e3c4(0x1f4)]('ai-voice-id-input')['value']=_0x4be00e[_0x33e3c4(0x6a8)]['minimaxVoiceId']||'',document['getElementById'](_0x33e3c4(0x1150))[_0x33e3c4(0xe56)]=_0x4be00e[_0x33e3c4(0x6a8)]['enableTts']!==![],document[_0x33e3c4(0x1f4)](_0x33e3c4(0x348))['value']=_0x4be00e[_0x33e3c4(0x6a8)][_0x33e3c4(0xf42)],document[_0x33e3c4(0x1f4)](_0x33e3c4(0xa20))[_0x33e3c4(0x9fe)]=_0x4be00e[_0x33e3c4(0x6a8)]['aiAvatar']||_0x5494d0,document[_0x33e3c4(0x1f4)](_0x33e3c4(0x9ad))[_0x33e3c4(0x107e)]=_0x4be00e['settings'][_0x33e3c4(0xe31)]||'我',document['getElementById'](_0x33e3c4(0xdbb))[_0x33e3c4(0x107e)]=_0x4be00e['settings']['actionCooldownMinutes']||0xa;const _0x494c99=document[_0x33e3c4(0x1f4)](_0x33e3c4(0x1559));_0x494c99[_0x33e3c4(0xf21)]='<option\x20value=\x22\x22>未分组</option>';const _0x35781b=await _0x3df81a['qzoneGroups']['toArray']();_0x35781b[_0x33e3c4(0x59b)](_0x57bc31=>{const _0x7589af=_0x33e3c4,_0x12fd46=document[_0x7589af(0x219)](_0x7589af(0x10bb));_0x12fd46[_0x7589af(0x107e)]=_0x57bc31['id'],_0x12fd46[_0x7589af(0x231)]=_0x57bc31[_0x7589af(0x5d2)];if(_0x4be00e[_0x7589af(0x67d)]===_0x57bc31['id'])_0x12fd46[_0x7589af(0xc3e)]=!![];_0x494c99[_0x7589af(0x6ce)](_0x12fd46);});const _0x22d05b=_0x4be00e[_0x33e3c4(0x6a8)][_0x33e3c4(0xa12)]||{'vertical':_0x33e3c4(0xe00),'horizontal':_0x33e3c4(0x803),'offset':0xa};document['getElementById'](_0x33e3c4(0x14a9))[_0x33e3c4(0x107e)]=_0x22d05b[_0x33e3c4(0xc29)],document[_0x33e3c4(0x1f4)](_0x33e3c4(0x8f1))[_0x33e3c4(0x107e)]=_0x22d05b[_0x33e3c4(0x12e3)],document[_0x33e3c4(0x1f4)](_0x33e3c4(0x1ff))[_0x33e3c4(0x107e)]=_0x22d05b[_0x33e3c4(0x10e8)];}const _0x21e655=document[_0x33e3c4(0x1f4)]('world-book-checkboxes-container');_0x21e655[_0x33e3c4(0xf21)]='';const [_0x5c2b4f,_0xbf42d]=await Promise['all']([_0x3df81a[_0x33e3c4(0xde3)][_0x33e3c4(0x27a)](),_0x3df81a['worldBooks'][_0x33e3c4(0x27a)]()]),_0x353c20=new Set(_0x4be00e[_0x33e3c4(0x6a8)]['linkedWorldBookIds']||[]);if(_0xbf42d['length']===0x0)_0x21e655[_0x33e3c4(0xf21)]=_0x33e3c4(0x5ca);else{_0x5c2b4f['forEach'](_0x503f61=>{const _0x4acae3=_0x33e3c4,_0x23d9d8=_0xbf42d['filter'](_0x4168ed=>_0x4168ed[_0x4acae3(0x1467)]===_0x503f61['id']);if(_0x23d9d8['length']>0x0){const _0x43e5c4=document[_0x4acae3(0x219)]('h4');_0x43e5c4[_0x4acae3(0x231)]=_0x503f61['name'],_0x43e5c4[_0x4acae3(0x215)][_0x4acae3(0x519)]='margin:\x2010px\x200\x205px;\x20color:\x20#555;\x20border-bottom:\x201px\x20solid\x20#eee;\x20padding-bottom:\x203px;',_0x21e655['appendChild'](_0x43e5c4),_0x23d9d8[_0x4acae3(0x59b)](_0x1a9858=>{const _0x2547ae=_0x4acae3,_0x340375=_0x353c20[_0x2547ae(0xe75)](_0x1a9858['id']),_0x101fd3=document['createElement'](_0x2547ae(0xb95));_0x101fd3[_0x2547ae(0xf21)]=_0x2547ae(0xace)+_0x1a9858['id']+'\x22\x20'+(_0x340375?'checked':'')+'>\x20'+_0x1a9858['name'],_0x21e655[_0x2547ae(0x6ce)](_0x101fd3);});}});const _0x3dbad6=_0xbf42d[_0x33e3c4(0xede)](_0x2c8160=>!_0x2c8160[_0x33e3c4(0x1467)]);if(_0x3dbad6[_0x33e3c4(0x58a)]>0x0){const _0x93990b=document[_0x33e3c4(0x219)]('h4');_0x93990b[_0x33e3c4(0x231)]=_0x33e3c4(0x13d0),_0x93990b['style']['cssText']=_0x33e3c4(0x12aa),_0x21e655[_0x33e3c4(0x6ce)](_0x93990b),_0x3dbad6[_0x33e3c4(0x59b)](_0x1b6ce2=>{const _0x4cac9f=_0x33e3c4,_0x5830a2=_0x353c20[_0x4cac9f(0xe75)](_0x1b6ce2['id']),_0x1b732e=document['createElement'](_0x4cac9f(0xb95));_0x1b732e[_0x4cac9f(0xf21)]=_0x4cac9f(0xace)+_0x1b6ce2['id']+'\x22\x20'+(_0x5830a2?'checked':'')+'>\x20'+_0x1b6ce2[_0x4cac9f(0x5d2)],_0x21e655[_0x4cac9f(0x6ce)](_0x1b732e);});}}_0x52ae54();const _0x3d5f3=document['getElementById'](_0x33e3c4(0x712)),_0x44f246=document[_0x33e3c4(0x1f4)](_0x33e3c4(0x4c3)),_0xcf5979=document[_0x33e3c4(0x1f4)]('linked-chats-checkboxes-container'),_0x4e62fa=_0x4be00e['settings'][_0x33e3c4(0xf2e)]||[];_0x3d5f3[_0x33e3c4(0xe56)]=_0x4e62fa[_0x33e3c4(0x58a)]>0x0,_0x44f246['style'][_0x33e3c4(0x887)]=_0x3d5f3[_0x33e3c4(0xe56)]?_0x33e3c4(0x361):_0x33e3c4(0x1b5),_0xcf5979['innerHTML']='',Object['values'](_0x1ae02e[_0x33e3c4(0x589)])[_0x33e3c4(0x59b)](_0xadee0d=>{const _0x2d32d2=_0x33e3c4;if(_0xadee0d['id']===_0x4be00e['id'])return;const _0x328ee8=_0x4e62fa['includes'](_0xadee0d['id']),_0x4c0fa6=_0xadee0d[_0x2d32d2(0xe83)]?'[群聊]':'[私聊]',_0x4d48e6=document[_0x2d32d2(0x219)](_0x2d32d2(0xb95));_0x4d48e6[_0x2d32d2(0xf21)]='<input\x20type=\x22checkbox\x22\x20value=\x22'+_0xadee0d['id']+'\x22\x20'+(_0x328ee8?_0x2d32d2(0xe56):'')+'>\x20'+_0x4c0fa6+'\x20'+_0xadee0d[_0x2d32d2(0x5d2)],_0xcf5979['appendChild'](_0x4d48e6);});function _0x23be31(){const _0x1e3f93=_0x33e3c4,_0x4f5833=_0xcf5979[_0x1e3f93(0x14bf)]('input:checked'),_0xecf3eb=_0x44f246[_0x1e3f93(0xeda)](_0x1e3f93(0x13a4));if(_0x4f5833['length']===0x0)_0xecf3eb['textContent']=_0x1e3f93(0xfd0);else _0x4f5833[_0x1e3f93(0x58a)]>0x2?_0xecf3eb[_0x1e3f93(0x231)]=_0x1e3f93(0x1436)+_0x4f5833['length']+'\x20项':_0xecf3eb[_0x1e3f93(0x231)]=Array[_0x1e3f93(0xa81)](_0x4f5833)[_0x1e3f93(0x1431)](_0x546606=>_0x546606[_0x1e3f93(0x125a)][_0x1e3f93(0x231)][_0x1e3f93(0x4a2)]())[_0x1e3f93(0x1143)](',\x20');}_0x23be31(),_0x3d5f3[_0x33e3c4(0x122b)](_0x33e3c4(0x1147),()=>{const _0x3dc0ce=_0x33e3c4;_0x44f246[_0x3dc0ce(0x215)][_0x3dc0ce(0x887)]=_0x3d5f3[_0x3dc0ce(0xe56)]?_0x3dc0ce(0x361):_0x3dc0ce(0x1b5);});const _0x3e1204=_0x44f246[_0x33e3c4(0xeda)](_0x33e3c4(0xe0a)),_0x25b808=_0x3e1204['cloneNode'](!![]);_0x3e1204[_0x33e3c4(0xad7)][_0x33e3c4(0xa88)](_0x25b808,_0x3e1204),_0x25b808[_0x33e3c4(0x122b)]('click',_0x4e3c59=>{const _0x4547f4=_0x33e3c4;_0x4e3c59[_0x4547f4(0x1025)](),_0xcf5979[_0x4547f4(0x159b)]['toggle'](_0x4547f4(0xfca)),_0x25b808[_0x4547f4(0x159b)]['toggle'](_0x4547f4(0xa18));}),_0xcf5979['addEventListener'](_0x33e3c4(0x1147),_0x23be31);const _0x57516a=document[_0x33e3c4(0xeda)](_0x33e3c4(0x13c9)+(_0x4be00e['settings'][_0x33e3c4(0x195)]||_0x33e3c4(0x372))+'\x22]');if(_0x57516a)_0x57516a[_0x33e3c4(0xe56)]=!![];const _0x5c47c2=document['getElementById']('font-size-slider');_0x5c47c2[_0x33e3c4(0x107e)]=_0x4be00e[_0x33e3c4(0x6a8)][_0x33e3c4(0x202)]||0xd,document[_0x33e3c4(0x1f4)](_0x33e3c4(0xc16))[_0x33e3c4(0x231)]=_0x5c47c2[_0x33e3c4(0x107e)]+'px';const _0x1dea02=document['getElementById'](_0x33e3c4(0x833));_0x1dea02[_0x33e3c4(0x107e)]=_0x4be00e[_0x33e3c4(0x6a8)][_0x33e3c4(0x138e)]||'',_0x356272(),document[_0x33e3c4(0x1f4)](_0x33e3c4(0x2e2))['checked']=_0x4be00e[_0x33e3c4(0x6a8)]['enableAutoMemory']||![],document[_0x33e3c4(0x1f4)]('auto-memory-interval')[_0x33e3c4(0x107e)]=_0x4be00e[_0x33e3c4(0x6a8)][_0x33e3c4(0x58d)]||0x14,setTimeout(()=>{const _0x1f86eb=_0x33e3c4;_0x4d6b07();const _0x2b075b=[_0x1f86eb(0x348),_0x1f86eb(0x1285),_0x1f86eb(0x127f),_0x1f86eb(0x4d5),_0x1f86eb(0x2e2),_0x1f86eb(0xafd),_0x1f86eb(0xca6),'offline-min-length-input',_0x1f86eb(0x1277),_0x1f86eb(0x76b)];_0x2b075b[_0x1f86eb(0x59b)](_0x5b08bd=>{const _0x1037ab=_0x1f86eb,_0x29bc90=document[_0x1037ab(0x1f4)](_0x5b08bd);_0x29bc90&&_0x29bc90[_0x1037ab(0x122b)](_0x1037ab(0x1557),_0x4d6b07);}),document['getElementById']('world-book-checkboxes-container')[_0x1f86eb(0x122b)](_0x1f86eb(0x1147),_0x4d6b07),document[_0x1f86eb(0x1f4)](_0x1f86eb(0xc4b))[_0x1f86eb(0x122b)]('change',_0x4d6b07),document[_0x1f86eb(0x1f4)]('link-memory-toggle')[_0x1f86eb(0x122b)]('change',_0x4d6b07);},0x64),_0x2e53fa('chat-settings-screen');});function _0x1ac316(_0x394fc0){const _0x2d26f8=_0xc64c06,_0xa731a2=document['getElementById'](_0x2d26f8(0xbd2));_0xa731a2[_0x2d26f8(0xf21)]='',_0x394fc0['forEach'](_0xfd1aa9=>{const _0x1a3749=_0x2d26f8,_0x233b98=document[_0x1a3749(0x219)]('div');_0x233b98[_0x1a3749(0x7c6)]=_0x1a3749(0x1055),_0x233b98[_0x1a3749(0x746)][_0x1a3749(0x124a)]=_0xfd1aa9['id'];const _0x32240a=_0xfd1aa9[_0x1a3749(0x95b)]||(_0x1ae02e['chats'][_0xfd1aa9['id']]?_0x1ae02e['chats'][_0xfd1aa9['id']]['settings'][_0x1a3749(0xc99)]:_0x54779f);_0x233b98[_0x1a3749(0xf21)]=_0x1a3749(0xe40)+_0x32240a+_0x1a3749(0xec3)+_0xfd1aa9['groupNickname']+_0x1a3749(0x403)+_0xfd1aa9[_0x1a3749(0xd69)]+_0x1a3749(0x149b),_0x233b98[_0x1a3749(0x122b)](_0x1a3749(0x740),()=>_0x32a590(_0xfd1aa9['id'])),_0xa731a2['appendChild'](_0x233b98);});}document[_0xc64c06(0x1f4)]('save-member-settings-btn')[_0xc64c06(0x122b)]('click',async()=>{const _0x5b3763=_0xc64c06;if(!_0x530c3e)return;const _0x10f6c5=_0x1ae02e['chats'][_0x1ae02e[_0x5b3763(0x588)]],_0x5f0bc3=_0x10f6c5[_0x5b3763(0x1402)]['find'](_0x5ed5f7=>_0x5ed5f7['id']===_0x530c3e);if(!_0x5f0bc3)return;const _0x5a4b26=document[_0x5b3763(0x1f4)]('member-name-input')[_0x5b3763(0x107e)][_0x5b3763(0x4a2)]();if(!_0x5a4b26){alert(_0x5b3763(0x391));return;}_0x5f0bc3[_0x5b3763(0xd69)]=_0x5a4b26,_0x5f0bc3[_0x5b3763(0x3be)]=document[_0x5b3763(0x1f4)]('member-persona-input')[_0x5b3763(0x107e)];const _0x506486=document['getElementById'](_0x5b3763(0xa19))[_0x5b3763(0x9fe)];_0x5f0bc3['avatar']=_0x506486;const _0x5a04e6=_0x1ae02e[_0x5b3763(0x589)][_0x5f0bc3['id']];_0x5a04e6&&(_0x5a04e6[_0x5b3763(0x6a8)]['aiAvatar']=_0x506486,await _0x3df81a[_0x5b3763(0x589)][_0x5b3763(0x295)](_0x5a04e6)),await _0x3df81a['chats']['put'](_0x10f6c5),_0x1ac316(_0x10f6c5[_0x5b3763(0x1402)]),document['getElementById'](_0x5b3763(0x14c7))[_0x5b3763(0x159b)][_0x5b3763(0xa9c)](_0x5b3763(0xfca)),_0x530c3e=null;});function _0x32a590(_0x4461bd){const _0x36ba9e=_0xc64c06;_0x530c3e=_0x4461bd;const _0x8618c7=_0x1ae02e[_0x36ba9e(0x589)][_0x1ae02e['activeChatId']],_0xd83695=_0x8618c7[_0x36ba9e(0x1402)][_0x36ba9e(0x13b7)](_0x4439c9=>_0x4439c9['id']===_0x4461bd);if(!_0xd83695)return;document[_0x36ba9e(0x1f4)](_0x36ba9e(0x3b0))[_0x36ba9e(0x107e)]=_0xd83695[_0x36ba9e(0xd69)],document[_0x36ba9e(0x1f4)](_0x36ba9e(0x840))[_0x36ba9e(0x107e)]=_0xd83695[_0x36ba9e(0x3be)];const _0x4c07bb=_0xd83695['avatar']||(_0x1ae02e[_0x36ba9e(0x589)][_0xd83695['id']]?_0x1ae02e[_0x36ba9e(0x589)][_0xd83695['id']][_0x36ba9e(0x6a8)]['aiAvatar']:_0x54779f);document['getElementById']('member-avatar-preview')[_0x36ba9e(0x9fe)]=_0x4c07bb,document[_0x36ba9e(0x1f4)](_0x36ba9e(0x14c7))[_0x36ba9e(0x159b)][_0x36ba9e(0x6a4)](_0x36ba9e(0xfca));}document['getElementById'](_0xc64c06(0x3d7))['addEventListener'](_0xc64c06(0x740),()=>{const _0x3ce34f=_0xc64c06;document['getElementById']('member-settings-modal')[_0x3ce34f(0x159b)][_0x3ce34f(0xa9c)](_0x3ce34f(0xfca)),_0x530c3e=null;}),document['getElementById']('save-member-settings-btn')[_0xc64c06(0x122b)]('click',async()=>{const _0x125aaf=_0xc64c06;if(!_0x530c3e)return;const _0x3d43ad=_0x1ae02e['chats'][_0x1ae02e[_0x125aaf(0x588)]],_0xed702=_0x3d43ad[_0x125aaf(0x1402)]['find'](_0x39cc62=>_0x39cc62['id']===_0x530c3e);if(!_0xed702)return;const _0x3d2e51=document[_0x125aaf(0x1f4)](_0x125aaf(0x3b0))['value'][_0x125aaf(0x4a2)]();if(!_0x3d2e51){alert(_0x125aaf(0x391));return;}_0xed702['groupNickname']=_0x3d2e51,_0xed702[_0x125aaf(0x3be)]=document[_0x125aaf(0x1f4)](_0x125aaf(0x840))[_0x125aaf(0x107e)];const _0x4edea1=document[_0x125aaf(0x1f4)](_0x125aaf(0xa19))[_0x125aaf(0x9fe)];_0xed702['avatar']=_0x4edea1;const _0x4b27ec=_0x1ae02e['chats'][_0xed702['id']];_0x4b27ec&&(_0x4b27ec[_0x125aaf(0x6a8)][_0x125aaf(0xc99)]=_0x4edea1,await _0x3df81a['chats'][_0x125aaf(0x295)](_0x4b27ec)),await _0x3df81a[_0x125aaf(0x589)][_0x125aaf(0x295)](_0x3d43ad),_0x1ac316(_0x3d43ad[_0x125aaf(0x1402)]),document[_0x125aaf(0x1f4)](_0x125aaf(0x14c7))[_0x125aaf(0x159b)]['remove'](_0x125aaf(0xfca)),_0x530c3e=null;}),document[_0xc64c06(0x1f4)](_0xc64c06(0xdb4))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x1710fe=_0xc64c06;document['getElementById'](_0x1710fe(0x8f3))['checked']=!![];}),document[_0xc64c06(0x1f4)](_0xc64c06(0xa66))[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x3b9e81=_0xc64c06;if(!_0x1ae02e[_0x3b9e81(0x588)])return;const _0x5d3106=_0x1ae02e[_0x3b9e81(0x589)][_0x1ae02e[_0x3b9e81(0x588)]],_0x5af1b7=_0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0x3f6)]||![],_0xd1f58e=document[_0x3b9e81(0x1f4)](_0x3b9e81(0xf59))['value'][_0x3b9e81(0x4a2)]();if(!_0xd1f58e)return alert(_0x3b9e81(0x1266));if(!_0x5d3106[_0x3b9e81(0xe83)]&&_0xd1f58e!==_0x5d3106[_0x3b9e81(0x5d2)]){if(!_0x5d3106[_0x3b9e81(0x1515)])_0x5d3106[_0x3b9e81(0x1515)]=[];if(!_0x5d3106['nameHistory'][_0x3b9e81(0xe82)](_0x5d3106[_0x3b9e81(0x5d2)]))_0x5d3106[_0x3b9e81(0x1515)][_0x3b9e81(0x1426)](_0x5d3106['name']);}_0x5d3106['name']=_0xd1f58e;const _0x2e31c8=document[_0x3b9e81(0xeda)](_0x3b9e81(0x420));_0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0x195)]=_0x2e31c8?_0x2e31c8[_0x3b9e81(0x107e)]:_0x3b9e81(0x372),_0x5d3106['settings'][_0x3b9e81(0x202)]=parseInt(document['getElementById']('font-size-slider')[_0x3b9e81(0x107e)]),_0x5d3106[_0x3b9e81(0x6a8)]['customCss']=document['getElementById'](_0x3b9e81(0x833))['value'][_0x3b9e81(0x4a2)](),_0x5d3106['settings'][_0x3b9e81(0x36b)]=document['getElementById']('my-persona')['value'],_0x5d3106['settings'][_0x3b9e81(0x1207)]=document[_0x3b9e81(0x1f4)](_0x3b9e81(0xabc))[_0x3b9e81(0x9fe)],_0x5d3106['settings'][_0x3b9e81(0x4b2)]=parseInt(document[_0x3b9e81(0x1f4)]('max-memory')['value'])||0xa,_0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0x11c5)]=parseInt(document[_0x3b9e81(0x1f4)]('linked-memory-count')[_0x3b9e81(0x107e)])||0xa;const _0x43cc5f=document[_0x3b9e81(0x14bf)](_0x3b9e81(0x1380)),_0x572025=[];_0x43cc5f['forEach'](_0x2ede26=>{const _0x7df177=_0x3b9e81;_0x2ede26[_0x7df177(0x107e)][_0x7df177(0xebf)]('book_')&&_0x572025[_0x7df177(0x1426)](_0x2ede26['value']['replace'](_0x7df177(0x7af),''));}),_0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0x1469)]=_0x572025;const _0x46ae4a=document[_0x3b9e81(0x1f4)](_0x3b9e81(0x712))[_0x3b9e81(0xe56)];if(_0x46ae4a){const _0x4086a8=document['querySelectorAll'](_0x3b9e81(0x191));_0x5d3106[_0x3b9e81(0x6a8)]['linkedMemoryChatIds']=Array[_0x3b9e81(0xa81)](_0x4086a8)[_0x3b9e81(0x1431)](_0x4f8089=>_0x4f8089[_0x3b9e81(0x107e)]);}else _0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0xf2e)]=[];_0x5d3106['settings'][_0x3b9e81(0xd16)]=document[_0x3b9e81(0x1f4)](_0x3b9e81(0x2e2))[_0x3b9e81(0xe56)],_0x5d3106['settings'][_0x3b9e81(0x58d)]=parseInt(document[_0x3b9e81(0x1f4)](_0x3b9e81(0xafd))[_0x3b9e81(0x107e)])||0x14,_0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0x885)]=document['getElementById']('time-perception-toggle')['checked'],_0x5d3106[_0x3b9e81(0x6a8)]['timeZone']=document[_0x3b9e81(0x1f4)](_0x3b9e81(0x7ff))[_0x3b9e81(0x107e)];if(_0x5d3106['isGroup'])_0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0x605)]=document['getElementById'](_0x3b9e81(0xf75))[_0x3b9e81(0xe56)],_0x5d3106[_0x3b9e81(0x6a8)]['myNickname']=document[_0x3b9e81(0x1f4)](_0x3b9e81(0xcca))[_0x3b9e81(0x107e)][_0x3b9e81(0x4a2)](),_0x5d3106['settings']['groupAvatar']=document[_0x3b9e81(0x1f4)]('group-avatar-preview')[_0x3b9e81(0x9fe)],_0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0xfa7)]=parseInt(document[_0x3b9e81(0x1f4)]('group-action-cooldown-input')[_0x3b9e81(0x107e)])||0xa;else{_0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0x605)]=document[_0x3b9e81(0x1f4)](_0x3b9e81(0x50e))[_0x3b9e81(0xe56)];const _0x35cfca=document[_0x3b9e81(0x1f4)](_0x3b9e81(0xca6))[_0x3b9e81(0xe56)];_0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0x3f6)]=_0x35cfca;if(_0x5af1b7===!![]&&_0x35cfca===![]){const _0x17d57f={'role':_0x3b9e81(0x1594),'content':_0x3b9e81(0xc45),'timestamp':Date[_0x3b9e81(0xd6e)](),'isHidden':!![]};_0x5d3106['history'][_0x3b9e81(0x1426)](_0x17d57f),console[_0x3b9e81(0x57e)](_0x3b9e81(0x2b2));}_0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0xf16)]=document[_0x3b9e81(0x1f4)](_0x3b9e81(0xe3f))['checked'],_0x5d3106['settings'][_0x3b9e81(0x5b0)]=parseInt(document[_0x3b9e81(0x1f4)](_0x3b9e81(0x8bd))[_0x3b9e81(0x107e)])||0x64,_0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0x873)]=parseInt(document[_0x3b9e81(0x1f4)]('offline-max-length-input')[_0x3b9e81(0x107e)])||0x12c,_0x5d3106['settings'][_0x3b9e81(0x715)]=document['getElementById'](_0x3b9e81(0x76b))[_0x3b9e81(0x107e)]||null;const _0x4457ec=document[_0x3b9e81(0x1f4)]('ai-original-name-input')[_0x3b9e81(0x107e)][_0x3b9e81(0x4a2)]();if(!_0x4457ec)return alert(_0x3b9e81(0x789));_0x5d3106[_0x3b9e81(0x96f)]=_0x4457ec,_0x5d3106['settings'][_0x3b9e81(0xf42)]=document[_0x3b9e81(0x1f4)](_0x3b9e81(0x348))[_0x3b9e81(0x107e)],_0x5d3106['settings'][_0x3b9e81(0x4fc)]=document[_0x3b9e81(0x1f4)]('ai-voice-id-input')[_0x3b9e81(0x107e)][_0x3b9e81(0x4a2)](),_0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0x6ab)]=document[_0x3b9e81(0x1f4)](_0x3b9e81(0x1150))['checked'],_0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0xc99)]=document[_0x3b9e81(0x1f4)](_0x3b9e81(0xa20))[_0x3b9e81(0x9fe)],_0x5d3106[_0x3b9e81(0x6a8)]['myNickname']=document[_0x3b9e81(0x1f4)]('my-nickname-input')[_0x3b9e81(0x107e)][_0x3b9e81(0x4a2)]()||'我',_0x5d3106['settings'][_0x3b9e81(0xfa7)]=parseInt(document['getElementById'](_0x3b9e81(0xdbb))[_0x3b9e81(0x107e)])||0xa,_0x5d3106[_0x3b9e81(0x6a8)][_0x3b9e81(0xa12)]={'vertical':document[_0x3b9e81(0x1f4)](_0x3b9e81(0x14a9))[_0x3b9e81(0x107e)],'horizontal':document[_0x3b9e81(0x1f4)](_0x3b9e81(0x8f1))[_0x3b9e81(0x107e)],'offset':parseInt(document['getElementById'](_0x3b9e81(0x1ff))[_0x3b9e81(0x107e)])||0xa};const _0x37e2c9=document['getElementById'](_0x3b9e81(0x1559))[_0x3b9e81(0x107e)];_0x5d3106['groupId']=_0x37e2c9?parseInt(_0x37e2c9):null;}await _0x3df81a[_0x3b9e81(0x589)][_0x3b9e81(0x295)](_0x5d3106),!_0x5d3106[_0x3b9e81(0xe83)]&&(await _0x44799f(_0x5d3106),await _0x3901ec(_0x5d3106)),_0x3594f0(_0x5d3106),_0x5379ba(_0x5d3106['settings']['customCss'],_0x3b9e81(0xf0a),'custom-bubble-style'),_0x2e53fa(_0x3b9e81(0x13c3)),_0x3689f0(_0x1ae02e[_0x3b9e81(0x588)]),_0x1033ae();}),document['getElementById'](_0xc64c06(0x1000))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x372eb6=>{const _0x540b02=_0xc64c06;_0x372eb6['target'][_0x540b02(0x159b)][_0x540b02(0xaea)](_0x540b02(0xb2c))&&_0x50c117(_0x540b02(0x21a));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x14c7))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x333e65=>{const _0x3a0b3c=_0xc64c06;_0x333e65['target']['classList'][_0x3a0b3c(0xaea)](_0x3a0b3c(0xb2c))&&_0x50c117(_0x3a0b3c(0xc32));});const _0x501cb5=document['getElementById'](_0xc64c06(0x138b)),_0x34e52a=document[_0xc64c06(0x1f4)](_0xc64c06(0x2ea)),_0x197f51=document[_0xc64c06(0x1f4)]('my-frame-tab'),_0x18199c=document[_0xc64c06(0x1f4)](_0xc64c06(0xd13)),_0x4a4aa6=document['getElementById']('my-frame-content');document['getElementById'](_0xc64c06(0x1126))[_0xc64c06(0x122b)]('click',_0x530f25),document[_0xc64c06(0x1f4)]('cancel-frame-settings-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x3233da=_0xc64c06;_0x501cb5['classList'][_0x3233da(0xa9c)](_0x3233da(0xfca)),_0x37b6a9=![];}),_0x34e52a[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x4b61d6=_0xc64c06;_0x34e52a[_0x4b61d6(0x159b)][_0x4b61d6(0x6a4)](_0x4b61d6(0x7cf)),_0x197f51['classList']['remove'](_0x4b61d6(0x7cf)),_0x18199c[_0x4b61d6(0x215)]['display']='block',_0x4a4aa6[_0x4b61d6(0x215)][_0x4b61d6(0x887)]='none';}),_0x197f51[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x101483=_0xc64c06;_0x197f51['classList'][_0x101483(0x6a4)]('active'),_0x34e52a[_0x101483(0x159b)]['remove']('active'),_0x4a4aa6['style']['display']='block',_0x18199c[_0x101483(0x215)][_0x101483(0x887)]=_0x101483(0x1b5);}),document[_0xc64c06(0x1f4)](_0xc64c06(0x38c))['addEventListener'](_0xc64c06(0x740),async()=>{const _0x2958a1=_0xc64c06;if(!_0x1ae02e[_0x2958a1(0x588)])return;const _0x132986=_0x1ae02e[_0x2958a1(0x589)][_0x1ae02e[_0x2958a1(0x588)]],_0x38e0df=await _0x109970(_0x2958a1(0x13ba),'此操作将永久删除此聊天的所有消息，无法恢复。确定要清空吗？',{'confirmButtonClass':_0x2958a1(0x1c6)});_0x38e0df&&(_0x132986[_0x2958a1(0xce3)]=[],_0x132986[_0x2958a1(0xbae)]=_0x2958a1(0x629),_0x132986[_0x2958a1(0x3d2)]=_0x2958a1(0x629),await _0x3df81a[_0x2958a1(0x589)][_0x2958a1(0x295)](_0x132986),_0x3689f0(_0x1ae02e[_0x2958a1(0x588)]),_0x1033ae(),_0x2b2be6[_0x2958a1(0x159b)][_0x2958a1(0xa9c)](_0x2958a1(0xfca)));});const _0x1112c8=(_0x4ea305,_0x3927e4)=>{const _0x549661=_0xc64c06;document[_0x549661(0x1f4)](_0x4ea305)['addEventListener']('change',async _0x183937=>{const _0x8ca53e=_0x549661,_0x6c9c80=_0x183937[_0x8ca53e(0xb57)]['files'][0x0];if(_0x6c9c80){const _0x347dc4=await new Promise((_0x2ed4c5,_0x15e83c)=>{const _0xbf9513=_0x8ca53e,_0x10c368=new FileReader();_0x10c368['onload']=()=>_0x2ed4c5(_0x10c368[_0xbf9513(0xbc9)]),_0x10c368[_0xbf9513(0xdf5)]=()=>_0x15e83c(_0x10c368[_0xbf9513(0x127d)]),_0x10c368[_0xbf9513(0x21e)](_0x6c9c80);});_0x3927e4(_0x347dc4),_0x183937['target'][_0x8ca53e(0x107e)]=null;}});};_0x1112c8(_0xc64c06(0xdbd),_0x2a902d=>document['getElementById'](_0xc64c06(0xa20))[_0xc64c06(0x9fe)]=_0x2a902d),_0x1112c8('my-avatar-input',_0x2d43e3=>document[_0xc64c06(0x1f4)](_0xc64c06(0xabc))[_0xc64c06(0x9fe)]=_0x2d43e3),_0x1112c8(_0xc64c06(0xdfc),_0x1a3980=>document[_0xc64c06(0x1f4)](_0xc64c06(0x543))['src']=_0x1a3980),_0x1112c8(_0xc64c06(0x3d6),_0x75e918=>document[_0xc64c06(0x1f4)]('member-avatar-preview')[_0xc64c06(0x9fe)]=_0x75e918),_0x1112c8(_0xc64c06(0x531),_0x1778ed=>{const _0x1798e3=_0xc64c06;if(_0x1ae02e[_0x1798e3(0x588)]){_0x1ae02e[_0x1798e3(0x589)][_0x1ae02e[_0x1798e3(0x588)]][_0x1798e3(0x6a8)][_0x1798e3(0xece)]=_0x1778ed;const _0xd88d97=document['getElementById'](_0x1798e3(0x1327));_0xd88d97[_0x1798e3(0x9fe)]=_0x1778ed,_0xd88d97[_0x1798e3(0x215)][_0x1798e3(0x887)]='block',document[_0x1798e3(0x1f4)](_0x1798e3(0xa38))[_0x1798e3(0x215)][_0x1798e3(0x887)]='inline-block';}}),_0x1112c8(_0xc64c06(0x53d),_0x40aeea=>document[_0xc64c06(0x1f4)](_0xc64c06(0x9f6))[_0xc64c06(0x9fe)]=_0x40aeea),document['getElementById'](_0xc64c06(0xa38))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x4b55c6=_0xc64c06;if(_0x1ae02e[_0x4b55c6(0x588)]){_0x1ae02e[_0x4b55c6(0x589)][_0x1ae02e[_0x4b55c6(0x588)]][_0x4b55c6(0x6a8)]['background']='';const _0x417874=document[_0x4b55c6(0x1f4)]('bg-preview');_0x417874[_0x4b55c6(0x9fe)]='',_0x417874[_0x4b55c6(0x215)]['display']=_0x4b55c6(0x1b5),document[_0x4b55c6(0x1f4)](_0x4b55c6(0xa38))[_0x4b55c6(0x215)][_0x4b55c6(0x887)]=_0x4b55c6(0x1b5);}});const _0x1841b9=document[_0xc64c06(0x1f4)]('sticker-panel');document[_0xc64c06(0x1f4)](_0xc64c06(0x154c))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x6eab8f=_0xc64c06,_0x489469=_0x1ae02e[_0x6eab8f(0x589)][_0x1ae02e[_0x6eab8f(0x588)]];_0x489469&&_0x489469[_0x6eab8f(0x6a8)]['stickerCategoryId']?_0x483dbf=_0x489469[_0x6eab8f(0x6a8)][_0x6eab8f(0xfcb)]:_0x483dbf='all',_0x3056ba(),_0x1841b9[_0x6eab8f(0x159b)]['add']('visible');}),document[_0xc64c06(0x1f4)]('close-sticker-panel-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>_0x1841b9['classList'][_0xc64c06(0xa9c)](_0xc64c06(0xfca))),document[_0xc64c06(0x1f4)](_0xc64c06(0x356))['addEventListener'](_0xc64c06(0x740),_0x12c64d),document[_0xc64c06(0x1f4)](_0xc64c06(0xafb))['addEventListener'](_0xc64c06(0x740),()=>document['getElementById']('sticker-upload-input')['click']()),document['getElementById']('sticker-upload-input')['addEventListener'](_0xc64c06(0x1147),async _0x562119=>{const _0xdfe981=_0xc64c06,_0x3340a4=_0x562119['target'][_0xdfe981(0x8b1)][0x0];if(!_0x3340a4)return;const _0x470113=new FileReader();_0x470113[_0xdfe981(0x21e)](_0x3340a4),_0x470113[_0xdfe981(0xcbe)]=async()=>{const _0x860b52=_0xdfe981,_0x7d5c61=_0x470113['result'],_0x2f6e39=await _0x11f6fb('命名表情','请为这个表情命名\x20(例如：好耶、疑惑)');if(_0x2f6e39&&_0x2f6e39[_0x860b52(0x4a2)]()){const _0x2ab28a={'id':_0x860b52(0xb20)+Date[_0x860b52(0xd6e)](),'url':_0x7d5c61,'name':_0x2f6e39['trim'](),'categoryId':_0x483dbf!==_0x860b52(0x54b)&&_0x483dbf!=='uncategorized'?_0x483dbf:null};await _0x3df81a[_0x860b52(0x1420)]['add'](_0x2ab28a),_0x1ae02e[_0x860b52(0x1420)][_0x860b52(0x1426)](_0x2ab28a),_0x3056ba();}else{if(_0x2f6e39!==null)alert('表情名不能为空！');}},_0x562119[_0xdfe981(0xb57)][_0xdfe981(0x107e)]=null;}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1592))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>document['getElementById'](_0xc64c06(0x383))[_0xc64c06(0x740)]()),document[_0xc64c06(0x1f4)](_0xc64c06(0x383))['addEventListener']('change',async _0x8eec03=>{const _0x2f92e8=_0xc64c06,_0x22b76e=_0x8eec03[_0x2f92e8(0xb57)][_0x2f92e8(0x8b1)][0x0];if(!_0x22b76e||!_0x1ae02e[_0x2f92e8(0x588)])return;const _0x4ba468=new FileReader();_0x4ba468[_0x2f92e8(0xcbe)]=async _0x32a14e=>{const _0x510b35=_0x2f92e8,_0x21576c=_0x32a14e[_0x510b35(0xb57)][_0x510b35(0xbc9)],_0x6896a0=_0x1ae02e[_0x510b35(0x589)][_0x1ae02e['activeChatId']],_0x124f4b={'role':_0x510b35(0x860),'content':[{'type':_0x510b35(0x1296),'image_url':{'url':_0x21576c}}],'timestamp':Date['now']()};_0x6896a0['history'][_0x510b35(0x1426)](_0x124f4b),await _0x3df81a[_0x510b35(0x589)]['put'](_0x6896a0),_0x5286f1(_0x124f4b,_0x6896a0),_0x1033ae();},_0x4ba468[_0x2f92e8(0x21e)](_0x22b76e),_0x8eec03[_0x2f92e8(0xb57)][_0x2f92e8(0x107e)]=null;}),document[_0xc64c06(0x1f4)]('voice-message-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x1e22ab=_0xc64c06;if(!_0x1ae02e['activeChatId'])return;const _0x4cd60d=await _0x11f6fb(_0x1e22ab(0xa22),_0x1e22ab(0xeb8));if(_0x4cd60d&&_0x4cd60d[_0x1e22ab(0x4a2)]()){const _0x3f3472=_0x1ae02e[_0x1e22ab(0x589)][_0x1ae02e['activeChatId']],_0x287c98={'role':'user','type':_0x1e22ab(0xd83),'content':_0x4cd60d['trim'](),'timestamp':Date['now']()};_0x3f3472[_0x1e22ab(0xce3)][_0x1e22ab(0x1426)](_0x287c98),await _0x3df81a[_0x1e22ab(0x589)][_0x1e22ab(0x295)](_0x3f3472),_0x5286f1(_0x287c98,_0x3f3472),_0x1033ae();}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x130b))[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x2455e4=_0xc64c06;if(!_0x1ae02e[_0x2455e4(0x588)])return;const _0x495154=await _0x11f6fb(_0x2455e4(0xc62),_0x2455e4(0x386));if(_0x495154&&_0x495154['trim']()){const _0x374187=_0x1ae02e[_0x2455e4(0x589)][_0x1ae02e[_0x2455e4(0x588)]],_0x259c99={'role':_0x2455e4(0x860),'type':_0x2455e4(0xe86),'content':_0x495154[_0x2455e4(0x4a2)](),'timestamp':Date[_0x2455e4(0xd6e)]()};_0x374187['history'][_0x2455e4(0x1426)](_0x259c99),await _0x3df81a['chats']['put'](_0x374187),_0x5286f1(_0x259c99,_0x374187),_0x1033ae();}});const _0x3320be=document['getElementById']('waimai-request-modal');document[_0xc64c06(0x1f4)](_0xc64c06(0x748))[_0xc64c06(0x122b)]('click',()=>{const _0x17f0dd=_0xc64c06;_0x3320be[_0x17f0dd(0x159b)][_0x17f0dd(0x6a4)](_0x17f0dd(0xfca));}),_0x3320be[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x246fdf=>{const _0x4d75a9=_0xc64c06;_0x246fdf[_0x4d75a9(0xb57)]===_0x3320be&&_0x3320be[_0x4d75a9(0x159b)][_0x4d75a9(0xa9c)](_0x4d75a9(0xfca));}),document[_0xc64c06(0x1f4)](_0xc64c06(0xd4b))['addEventListener'](_0xc64c06(0x740),_0x42dd6),document[_0xc64c06(0x1f4)]('waimai-confirm-btn')[_0xc64c06(0x122b)]('click',async()=>{const _0x6cd596=_0xc64c06;if(!_0x1ae02e[_0x6cd596(0x588)])return;const _0xd15448=document[_0x6cd596(0x1f4)]('waimai-product-info'),_0x7c8204=document[_0x6cd596(0x1f4)](_0x6cd596(0x1cd)),_0xcba2e=_0xd15448[_0x6cd596(0x107e)][_0x6cd596(0x4a2)](),_0x5e77eb=parseFloat(_0x7c8204[_0x6cd596(0x107e)]);if(!_0xcba2e||isNaN(_0x5e77eb)||_0x5e77eb<=0x0){alert('请填写有效的商品信息和金额！');return;}const _0x3a4984=_0x1ae02e[_0x6cd596(0x589)][_0x1ae02e[_0x6cd596(0x588)]],_0x2ddea2=Date[_0x6cd596(0xd6e)](),_0x4ac4b0=_0x3a4984['isGroup']?_0x3a4984[_0x6cd596(0x6a8)][_0x6cd596(0xe31)]||'我':'我',_0x141a5a={'role':_0x6cd596(0x860),'senderName':_0x4ac4b0,'type':_0x6cd596(0x4a4),'productInfo':_0xcba2e,'amount':_0x5e77eb,'status':_0x6cd596(0x630),'countdownEndTime':_0x2ddea2+0xf*0x3c*0x3e8,'timestamp':_0x2ddea2};_0x3a4984[_0x6cd596(0xce3)][_0x6cd596(0x1426)](_0x141a5a),await _0x3df81a[_0x6cd596(0x589)][_0x6cd596(0x295)](_0x3a4984),_0x5286f1(_0x141a5a,_0x3a4984),_0x1033ae(),_0xd15448[_0x6cd596(0x107e)]='',_0x7c8204[_0x6cd596(0x107e)]='',_0x3320be[_0x6cd596(0x159b)]['remove'](_0x6cd596(0xfca));}),document[_0xc64c06(0x1f4)](_0xc64c06(0xa77))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x334ece),document[_0xc64c06(0x1f4)](_0xc64c06(0x765))['addEventListener']('click',_0x5283d2),document[_0xc64c06(0x1f4)](_0xc64c06(0xd17))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x377003),document[_0xc64c06(0x1f4)](_0xc64c06(0xcd2))['addEventListener'](_0xc64c06(0x740),_0x11d0db),document[_0xc64c06(0x1f4)](_0xc64c06(0x8a0))['addEventListener'](_0xc64c06(0x740),_0x4afcf3),document[_0xc64c06(0x1f4)](_0xc64c06(0x539))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x105a86),document[_0xc64c06(0x1f4)](_0xc64c06(0x1437))[_0xc64c06(0x122b)]('click',_0x59ef93),document[_0xc64c06(0x1f4)](_0xc64c06(0x222))['addEventListener']('click',_0x3feb15),document[_0xc64c06(0x1f4)](_0xc64c06(0x785))[_0xc64c06(0x122b)]('click',_0x527427),document[_0xc64c06(0x1f4)](_0xc64c06(0xb81))[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x5012c4=_0xc64c06;if(_0xc320bf[_0x5012c4(0xb51)]===0x0)return;const _0x46a0c3=await _0x109970('删除消息',_0x5012c4(0x435)+_0xc320bf[_0x5012c4(0xb51)]+_0x5012c4(0x63c),{'confirmButtonClass':_0x5012c4(0x1c6)});if(_0x46a0c3){const _0x38d805=_0x1ae02e[_0x5012c4(0x589)][_0x1ae02e[_0x5012c4(0x588)]];let _0x48c718=[];for(const _0x179c89 of _0xc320bf){const _0x15a56b=_0x38d805['history'][_0x5012c4(0x13b7)](_0x50948f=>_0x50948f[_0x5012c4(0x1388)]===_0x179c89);_0x15a56b&&_0x15a56b[_0x5012c4(0xcbd)]===_0x5012c4(0x7b8)&&_0x48c718[_0x5012c4(0x1426)]('关于“'+_0x15a56b['question']+_0x5012c4(0x1095)+_0x15a56b[_0x5012c4(0x1388)]+')');}_0x38d805['history']=_0x38d805[_0x5012c4(0xce3)]['filter'](_0x5705ab=>!_0xc320bf[_0x5012c4(0xe75)](_0x5705ab[_0x5012c4(0x1388)]));let _0xa0afa1=_0x5012c4(0xaf7);_0x48c718[_0x5012c4(0x58a)]>0x0&&(_0xa0afa1+=_0x5012c4(0x523)+_0x48c718[_0x5012c4(0x1143)]('；')+'。');_0xa0afa1+='\x20你应该像它们从未存在过一样继续对话，并相应地调整你的记忆和行为，不要再提及这些被删除的内容。';const _0x577799={'role':_0x5012c4(0x1594),'content':'[系统提示：'+_0xa0afa1+']','timestamp':Date[_0x5012c4(0xd6e)](),'isHidden':!![]};_0x38d805[_0x5012c4(0xce3)][_0x5012c4(0x1426)](_0x577799),await _0x3df81a[_0x5012c4(0x589)][_0x5012c4(0x295)](_0x38d805),_0x3689f0(_0x1ae02e['activeChatId']),_0x1033ae();}}),document[_0xc64c06(0x1f4)]('selection-erase-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x5d881a=_0xc64c06;if(_0xc320bf[_0x5d881a(0xb51)]===0x0)return;const _0x18510a=await _0x109970('彻底删除消息','这将从历史记录中【永久抹除】这\x20'+_0xc320bf[_0x5d881a(0xb51)]+_0x5d881a(0x6d9),{'confirmButtonClass':'btn-danger','confirmText':'确认抹除'});if(_0x18510a){const _0x54bb56=_0x1ae02e[_0x5d881a(0x589)][_0x1ae02e[_0x5d881a(0x588)]];_0x54bb56[_0x5d881a(0xce3)]=_0x54bb56[_0x5d881a(0xce3)][_0x5d881a(0xede)](_0x448f20=>!_0xc320bf[_0x5d881a(0xe75)](_0x448f20[_0x5d881a(0x1388)])),await _0x3df81a[_0x5d881a(0x589)][_0x5d881a(0x295)](_0x54bb56),_0x3689f0(_0x1ae02e['activeChatId']),_0x1033ae();}});const _0x1fda61=document[_0xc64c06(0x1f4)](_0xc64c06(0x918));_0x1fda61[_0xc64c06(0x122b)](_0xc64c06(0x1557),()=>_0x143b61(_0x1fda61[_0xc64c06(0x107e)]['trim'](),!![])),document['getElementById'](_0xc64c06(0x538))[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x22d5ba=_0xc64c06,_0x4d518e=_0x1fda61[_0x22d5ba(0x107e)][_0x22d5ba(0x4a2)]();if(!_0x4d518e){alert(_0x22d5ba(0x80c));return;}_0x143b61(_0x4d518e,![]),_0x1ae02e[_0x22d5ba(0x12c0)][_0x22d5ba(0xa4e)]=_0x4d518e,await _0x3df81a[_0x22d5ba(0x12c0)][_0x22d5ba(0x295)](_0x1ae02e[_0x22d5ba(0x12c0)]),alert('字体已保存并应用！');}),document['getElementById']('reset-font-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x1f5880),document[_0xc64c06(0x14bf)](_0xc64c06(0x3ea))['forEach'](_0x3a7586=>{const _0x2a8600=_0xc64c06;_0x3a7586[_0x2a8600(0x122b)](_0x2a8600(0x740),()=>_0x407a4b(_0x3a7586[_0x2a8600(0x746)][_0x2a8600(0x433)]));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x12ed))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>_0x407a4b('messages-view')),document['getElementById'](_0xc64c06(0x4b3))['addEventListener'](_0xc64c06(0x740),async()=>{const _0x35e225=_0xc64c06,_0x273e74=await _0x11f6fb(_0x35e225(0x2ce),_0x35e225(0x997),_0x1ae02e[_0x35e225(0x11ef)]['nickname']);_0x273e74&&_0x273e74[_0x35e225(0x4a2)]()&&(_0x1ae02e[_0x35e225(0x11ef)][_0x35e225(0xb46)]=_0x273e74[_0x35e225(0x4a2)](),await _0x2aaac5(),_0x21d0f5());}),document[_0xc64c06(0x1f4)](_0xc64c06(0xb44))[_0xc64c06(0x122b)]('click',()=>document[_0xc64c06(0x1f4)](_0xc64c06(0x660))[_0xc64c06(0x740)]()),document[_0xc64c06(0x1f4)](_0xc64c06(0x13ec))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>document[_0xc64c06(0x1f4)](_0xc64c06(0x1222))[_0xc64c06(0x740)]()),document['getElementById'](_0xc64c06(0x660))[_0xc64c06(0x122b)](_0xc64c06(0x1147),async _0x484ec0=>{const _0x26798b=_0xc64c06,_0x4083b2=_0x484ec0[_0x26798b(0xb57)][_0x26798b(0x8b1)][0x0];if(_0x4083b2){const _0x393e19=await new Promise(_0x118758=>{const _0xae302=_0x26798b,_0x468c53=new FileReader();_0x468c53['onload']=()=>_0x118758(_0x468c53[_0xae302(0xbc9)]),_0x468c53['readAsDataURL'](_0x4083b2);});_0x1ae02e['qzoneSettings']['avatar']=_0x393e19,await _0x2aaac5(),_0x21d0f5();}_0x484ec0['target'][_0x26798b(0x107e)]=null;}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1222))['addEventListener'](_0xc64c06(0x1147),async _0x9bc6fa=>{const _0x45366e=_0xc64c06,_0x43680a=_0x9bc6fa[_0x45366e(0xb57)]['files'][0x0];if(_0x43680a){const _0x38cfa5=await new Promise(_0x272fd0=>{const _0x1c9e23=_0x45366e,_0x341848=new FileReader();_0x341848['onload']=()=>_0x272fd0(_0x341848[_0x1c9e23(0xbc9)]),_0x341848[_0x1c9e23(0x21e)](_0x43680a);});_0x1ae02e[_0x45366e(0x11ef)][_0x45366e(0xdd5)]=_0x38cfa5,await _0x2aaac5(),_0x21d0f5();}_0x9bc6fa[_0x45366e(0xb57)][_0x45366e(0x107e)]=null;}),document[_0xc64c06(0x1f4)](_0xc64c06(0x28b))[_0xc64c06(0x122b)]('click',async()=>{const _0x4b67d8=_0xc64c06;_0x6b9f3c();const _0x40407d=document[_0x4b67d8(0x1f4)](_0x4b67d8(0x1c9));_0x40407d[_0x4b67d8(0x746)][_0x4b67d8(0x611)]=_0x4b67d8(0x30e),_0x40407d[_0x4b67d8(0xeda)](_0x4b67d8(0x9e5))[_0x4b67d8(0x215)][_0x4b67d8(0x887)]=_0x4b67d8(0x1b5),_0x40407d[_0x4b67d8(0xeda)]('#image-mode-content')[_0x4b67d8(0x215)][_0x4b67d8(0x887)]=_0x4b67d8(0x1b5),_0x40407d['querySelector'](_0x4b67d8(0x364))[_0x4b67d8(0x215)][_0x4b67d8(0x887)]='none',_0x40407d['querySelector'](_0x4b67d8(0x54d))['placeholder']=_0x4b67d8(0x1117);const _0x517902=document[_0x4b67d8(0x1f4)]('post-visibility-groups');_0x517902[_0x4b67d8(0xf21)]='';const _0x23b2c0=await _0x3df81a[_0x4b67d8(0x13fc)][_0x4b67d8(0x27a)]();_0x23b2c0[_0x4b67d8(0x58a)]>0x0?_0x23b2c0[_0x4b67d8(0x59b)](_0x1f6d80=>{const _0x489018=_0x4b67d8,_0x39df1c=document[_0x489018(0x219)](_0x489018(0xb95));_0x39df1c[_0x489018(0x215)]['display']=_0x489018(0x361),_0x39df1c[_0x489018(0xf21)]='<input\x20type=\x22checkbox\x22\x20name=\x22visibility_group\x22\x20value=\x22'+_0x1f6d80['id']+'\x22>\x20'+_0x1f6d80[_0x489018(0x5d2)],_0x517902['appendChild'](_0x39df1c);}):_0x517902[_0x4b67d8(0xf21)]=_0x4b67d8(0x133c),_0x40407d[_0x4b67d8(0x159b)][_0x4b67d8(0x6a4)]('visible');}),document[_0xc64c06(0x1f4)](_0xc64c06(0x255))[_0xc64c06(0x122b)]('click',async()=>{const _0x4c87b2=_0xc64c06;_0x6b9f3c();const _0x3cc6d9=document['getElementById'](_0x4c87b2(0x1c9));_0x3cc6d9[_0x4c87b2(0x746)][_0x4c87b2(0x611)]=_0x4c87b2(0x1597),_0x3cc6d9['querySelector'](_0x4c87b2(0x9e5))[_0x4c87b2(0x215)][_0x4c87b2(0x887)]=_0x4c87b2(0xeba),_0x3cc6d9['querySelector'](_0x4c87b2(0xcde))[_0x4c87b2(0x159b)][_0x4c87b2(0x6a4)](_0x4c87b2(0x7cf)),_0x3cc6d9[_0x4c87b2(0xeda)](_0x4c87b2(0x364))['classList'][_0x4c87b2(0xa9c)](_0x4c87b2(0x7cf)),_0x3cc6d9[_0x4c87b2(0xeda)](_0x4c87b2(0x54d))[_0x4c87b2(0xced)]=_0x4c87b2(0x1333);const _0x551774=document['getElementById'](_0x4c87b2(0x28e));_0x551774['innerHTML']='';const _0x188740=await _0x3df81a[_0x4c87b2(0x13fc)][_0x4c87b2(0x27a)]();_0x188740[_0x4c87b2(0x58a)]>0x0?_0x188740[_0x4c87b2(0x59b)](_0x3a0f9f=>{const _0x37f770=_0x4c87b2,_0x1131d2=document[_0x37f770(0x219)]('label');_0x1131d2[_0x37f770(0x215)]['display']=_0x37f770(0x361),_0x1131d2[_0x37f770(0xf21)]=_0x37f770(0xc8a)+_0x3a0f9f['id']+_0x37f770(0x7c7)+_0x3a0f9f[_0x37f770(0x5d2)],_0x551774[_0x37f770(0x6ce)](_0x1131d2);}):_0x551774['innerHTML']=_0x4c87b2(0x133c),_0x3cc6d9['classList']['add']('visible');}),document[_0xc64c06(0x1f4)]('open-album-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x2160b4=_0xc64c06;await _0x4a64dc(),_0x2e53fa(_0x2160b4(0x2f4));}),document['getElementById'](_0xc64c06(0xda5))['addEventListener'](_0xc64c06(0x740),()=>{const _0x285c06=_0xc64c06;_0x2e53fa(_0x285c06(0x133d)),_0x407a4b(_0x285c06(0x11b5));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1021))[_0xc64c06(0x122b)]('click',()=>{const _0x5d03de=_0xc64c06;_0x1ae02e[_0x5d03de(0x866)]=null,_0x2e53fa('album-screen');}),document[_0xc64c06(0x1f4)]('album-upload-photo-btn')['addEventListener']('click',()=>document[_0xc64c06(0x1f4)](_0xc64c06(0x2be))['click']()),document[_0xc64c06(0x1f4)](_0xc64c06(0x2be))['addEventListener'](_0xc64c06(0x1147),async _0x535a95=>{const _0x305060=_0xc64c06;if(!_0x1ae02e[_0x305060(0x866)])return;const _0x435c8b=_0x535a95[_0x305060(0xb57)]['files'];if(!_0x435c8b[_0x305060(0x58a)])return;const _0x585cc9=await _0x3df81a['qzoneAlbums'][_0x305060(0x13f8)](_0x1ae02e[_0x305060(0x866)]);for(const _0x358612 of _0x435c8b){const _0xf29dc2=await new Promise(_0x55828a=>{const _0x56b948=_0x305060,_0x2e6c61=new FileReader();_0x2e6c61['onload']=()=>_0x55828a(_0x2e6c61[_0x56b948(0xbc9)]),_0x2e6c61['readAsDataURL'](_0x358612);});await _0x3df81a['qzonePhotos'][_0x305060(0x6a4)]({'albumId':_0x1ae02e['activeAlbumId'],'url':_0xf29dc2,'createdAt':Date[_0x305060(0xd6e)]()});}const _0xc354f7=await _0x3df81a[_0x305060(0xaee)][_0x305060(0x478)](_0x305060(0x565))[_0x305060(0x49d)](_0x1ae02e[_0x305060(0x866)])[_0x305060(0x13bd)](),_0x3502b6={'photoCount':_0xc354f7};if(!_0x585cc9[_0x305060(0xa4a)]||_0x585cc9[_0x305060(0x14c1)][_0x305060(0xe82)](_0x305060(0xced))){const _0x5e7a21=await _0x3df81a[_0x305060(0xaee)][_0x305060(0x478)](_0x305060(0x565))[_0x305060(0x49d)](_0x1ae02e['activeAlbumId'])[_0x305060(0x9a8)]();if(_0x5e7a21)_0x3502b6['coverUrl']=_0x5e7a21[_0x305060(0x258)];}await _0x3df81a[_0x305060(0x20a)]['update'](_0x1ae02e[_0x305060(0x866)],_0x3502b6),await _0x4fd1c1(),await _0x4a64dc(),_0x535a95[_0x305060(0xb57)]['value']=null,alert(_0x305060(0x350));}),document[_0xc64c06(0x1f4)](_0xc64c06(0xba1))['addEventListener'](_0xc64c06(0x740),async _0x5e06f7=>{const _0x2b6400=_0xc64c06,_0x9344bd=_0x5e06f7['target'][_0x2b6400(0x96a)](_0x2b6400(0x5a4)),_0x2f05a8=_0x5e06f7[_0x2b6400(0xb57)][_0x2b6400(0x96a)](_0x2b6400(0x6b4));if(_0x9344bd){_0x5e06f7[_0x2b6400(0x1025)]();const _0x5652a7=parseInt(_0x9344bd[_0x2b6400(0x746)][_0x2b6400(0x12e1)]),_0x3bd0ee=await _0x109970(_0x2b6400(0x10ac),_0x2b6400(0xab9),{'confirmButtonClass':'btn-danger'});if(_0x3bd0ee){const _0x569503=await _0x3df81a[_0x2b6400(0xaee)][_0x2b6400(0x13f8)](_0x5652a7);if(!_0x569503)return;await _0x3df81a['qzonePhotos'][_0x2b6400(0xc40)](_0x5652a7);const _0x2dd6f3=await _0x3df81a['qzoneAlbums']['get'](_0x1ae02e[_0x2b6400(0x866)]),_0x5e1a28=(_0x2dd6f3['photoCount']||0x1)-0x1,_0x17164e={'photoCount':_0x5e1a28};if(_0x2dd6f3['coverUrl']===_0x569503[_0x2b6400(0x258)]){const _0x5baf33=await _0x3df81a[_0x2b6400(0xaee)]['where'](_0x2b6400(0x565))[_0x2b6400(0x49d)](_0x1ae02e['activeAlbumId'])[_0x2b6400(0x9a8)]();_0x17164e['coverUrl']=_0x5baf33?_0x5baf33[_0x2b6400(0x258)]:_0x2b6400(0x3c4);}await _0x3df81a[_0x2b6400(0x20a)][_0x2b6400(0xf18)](_0x1ae02e[_0x2b6400(0x866)],_0x17164e),await _0x4fd1c1(),await _0x4a64dc(),alert('照片已删除。');}}else _0x2f05a8&&_0x28357a(_0x2f05a8[_0x2b6400(0x9fe)]);}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1cc))['addEventListener'](_0xc64c06(0x740),_0x35aa07),document['getElementById'](_0xc64c06(0x661))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x3e8330),document[_0xc64c06(0x1f4)](_0xc64c06(0x138c))[_0xc64c06(0x122b)]('click',_0xbf2b5d),document[_0xc64c06(0x122b)](_0xc64c06(0x8cd),_0x18763f=>{const _0x222953=_0xc64c06;if(!_0x44e0a8[_0x222953(0x491)])return;if(_0x18763f[_0x222953(0x1505)]===_0x222953(0x92d))_0x3e8330();else{if(_0x18763f['key']==='ArrowLeft')_0xbf2b5d();else _0x18763f[_0x222953(0x1505)]===_0x222953(0xee0)&&_0x35aa07();}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x13cd))[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x12f222=_0xc64c06,_0x2e7021=await _0x11f6fb('创建新相册',_0x12f222(0x913));if(_0x2e7021&&_0x2e7021[_0x12f222(0x4a2)]()){const _0x4b842d={'name':_0x2e7021[_0x12f222(0x4a2)](),'coverUrl':_0x12f222(0x3c4),'photoCount':0x0,'createdAt':Date[_0x12f222(0xd6e)]()};await _0x3df81a[_0x12f222(0x20a)][_0x12f222(0x6a4)](_0x4b842d),await _0x4a64dc(),alert(_0x12f222(0x401)+_0x2e7021+'\x22\x20创建成功！');}else _0x2e7021!==null&&alert(_0x12f222(0x72e));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x12f9))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>document[_0xc64c06(0x1f4)](_0xc64c06(0x1c9))[_0xc64c06(0x159b)][_0xc64c06(0xa9c)](_0xc64c06(0xfca))),document[_0xc64c06(0x1f4)]('post-upload-local-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>document[_0xc64c06(0x1f4)](_0xc64c06(0x14a1))[_0xc64c06(0x740)]()),document[_0xc64c06(0x1f4)]('post-local-image-input')[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x1c1a13=>{const _0x15e4ca=_0xc64c06,_0x122874=_0x1c1a13[_0x15e4ca(0xb57)][_0x15e4ca(0x8b1)][0x0];if(_0x122874){const _0x14b455=new FileReader();_0x14b455[_0x15e4ca(0xcbe)]=_0x184c71=>{const _0x38f52e=_0x15e4ca;document['getElementById']('post-image-preview')[_0x38f52e(0x9fe)]=_0x184c71['target'][_0x38f52e(0xbc9)],document[_0x38f52e(0x1f4)](_0x38f52e(0x1364))[_0x38f52e(0x159b)]['add']('visible'),document['getElementById']('post-image-desc-group')[_0x38f52e(0x215)][_0x38f52e(0x887)]=_0x38f52e(0x361);},_0x14b455[_0x15e4ca(0x21e)](_0x122874);}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x9a3))[_0xc64c06(0x122b)]('click',async()=>{const _0x531176=_0xc64c06,_0xe0282b=await _0x11f6fb('输入图片URL',_0x531176(0xdbe),'',_0x531176(0x258));_0xe0282b&&(document[_0x531176(0x1f4)](_0x531176(0x1398))[_0x531176(0x9fe)]=_0xe0282b,document['getElementById'](_0x531176(0x1364))['classList'][_0x531176(0x6a4)](_0x531176(0xfca)),document[_0x531176(0x1f4)](_0x531176(0xf72))[_0x531176(0x215)][_0x531176(0x887)]=_0x531176(0x361));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1194))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>_0x6b9f3c());const _0x649774=document['getElementById'](_0xc64c06(0x890)),_0x156bf3=document['getElementById']('switch-to-text-image-mode'),_0x1a0140=document[_0xc64c06(0x1f4)](_0xc64c06(0x953)),_0x55ae6a=document[_0xc64c06(0x1f4)](_0xc64c06(0x135d));_0x649774[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x563e15=_0xc64c06;_0x649774['classList'][_0x563e15(0x6a4)]('active'),_0x156bf3[_0x563e15(0x159b)]['remove'](_0x563e15(0x7cf)),_0x1a0140['classList'][_0x563e15(0x6a4)](_0x563e15(0x7cf)),_0x55ae6a[_0x563e15(0x159b)][_0x563e15(0xa9c)]('active');}),_0x156bf3[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x468fd1=_0xc64c06;_0x156bf3['classList'][_0x468fd1(0x6a4)](_0x468fd1(0x7cf)),_0x649774[_0x468fd1(0x159b)][_0x468fd1(0xa9c)](_0x468fd1(0x7cf)),_0x55ae6a['classList'][_0x468fd1(0x6a4)](_0x468fd1(0x7cf)),_0x1a0140[_0x468fd1(0x159b)][_0x468fd1(0xa9c)](_0x468fd1(0x7cf));}),document[_0xc64c06(0x1f4)]('confirm-create-post-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x2d48d8=_0xc64c06,_0x803df5=document['getElementById']('create-post-modal'),_0x569d16=_0x803df5[_0x2d48d8(0x746)][_0x2d48d8(0x611)],_0x38f3e3=document[_0x2d48d8(0xeda)](_0x2d48d8(0x747))['value'];let _0x22cbde=null;_0x38f3e3==='include'&&(_0x22cbde=Array['from'](document[_0x2d48d8(0x14bf)](_0x2d48d8(0x113d)))['map'](_0x580423=>parseInt(_0x580423[_0x2d48d8(0x107e)])));let _0x39b7d6={};const _0x2929b5={'timestamp':Date['now'](),'authorId':_0x2d48d8(0x860),'visibleGroupIds':_0x22cbde};if(_0x569d16===_0x2d48d8(0x30e)){const _0x101b92=document[_0x2d48d8(0x1f4)]('post-public-text')[_0x2d48d8(0x107e)]['trim']();if(!_0x101b92){alert(_0x2d48d8(0x14a4));return;}_0x39b7d6={..._0x2929b5,'type':'shuoshuo','content':_0x101b92};}else{const _0x237923=document['getElementById'](_0x2d48d8(0xeaa))[_0x2d48d8(0x107e)][_0x2d48d8(0x4a2)](),_0x5e08c0=document[_0x2d48d8(0x1f4)](_0x2d48d8(0x953))[_0x2d48d8(0x159b)][_0x2d48d8(0xaea)]('active');if(_0x5e08c0){const _0xa90fe5=document['getElementById'](_0x2d48d8(0x1398))[_0x2d48d8(0x9fe)],_0x4bfa79=document['getElementById'](_0x2d48d8(0x10ad))[_0x2d48d8(0x107e)][_0x2d48d8(0x4a2)]();if(!_0xa90fe5||!(_0xa90fe5[_0x2d48d8(0xebf)]('http')||_0xa90fe5['startsWith'](_0x2d48d8(0xd32)))){alert(_0x2d48d8(0x8c2));return;}if(!_0x4bfa79){alert('请为你的图片添加一个简单的描述（必填，给AI看的）！');return;}_0x39b7d6={..._0x2929b5,'type':'image_post','publicText':_0x237923,'imageUrl':_0xa90fe5,'imageDescription':_0x4bfa79};}else{const _0x194fcf=document[_0x2d48d8(0x1f4)]('post-hidden-text')[_0x2d48d8(0x107e)][_0x2d48d8(0x4a2)]();if(!_0x194fcf){alert(_0x2d48d8(0x109d));return;}_0x39b7d6={..._0x2929b5,'type':'text_image','publicText':_0x237923,'hiddenContent':_0x194fcf};}}const _0x608b3e=await _0x3df81a[_0x2d48d8(0x910)][_0x2d48d8(0x6a4)](_0x39b7d6);let _0x547895=_0x39b7d6[_0x2d48d8(0x128c)]||_0x39b7d6['publicText']||_0x39b7d6[_0x2d48d8(0x91d)]||_0x39b7d6['hiddenContent']||_0x2d48d8(0x185);_0x547895=_0x547895[_0x2d48d8(0x516)](0x0,0x32)+(_0x547895[_0x2d48d8(0x58a)]>0x32?_0x2d48d8(0x629):'');for(const _0x363a8c in _0x1ae02e['chats']){const _0x438896=_0x1ae02e['chats'][_0x363a8c];if(_0x438896[_0x2d48d8(0xe83)])continue;let _0xffa6d8=![];const _0x22005a=_0x39b7d6[_0x2d48d8(0xe9a)];if(!_0x22005a||_0x22005a[_0x2d48d8(0x58a)]===0x0)_0xffa6d8=!![];else _0x438896[_0x2d48d8(0x67d)]&&_0x22005a[_0x2d48d8(0xe82)](_0x438896[_0x2d48d8(0x67d)])&&(_0xffa6d8=!![]);if(_0xffa6d8){const _0xa8c164={'role':'system','content':_0x2d48d8(0x336)+_0x608b3e+_0x2d48d8(0x1566)+_0x547895+_0x2d48d8(0xfd4),'timestamp':Date[_0x2d48d8(0xd6e)](),'isHidden':!![]};_0x438896['history'][_0x2d48d8(0x1426)](_0xa8c164),await _0x3df81a[_0x2d48d8(0x589)]['put'](_0x438896);}}await _0x28d6f7(),_0x803df5[_0x2d48d8(0x159b)]['remove'](_0x2d48d8(0xfca)),alert(_0x2d48d8(0x3f0));});const _0xc7d946=document['getElementById'](_0xc64c06(0x53c));let _0x59aeb1={'isDragging':![],'startX':0x0,'startY':0x0,'currentX':0x0,'activeContainer':null,'swipeDirection':null,'isClick':!![]};function _0x20ed05(_0x24a83f=null){const _0x36f120=_0xc64c06;document[_0x36f120(0x14bf)]('.qzone-post-container')[_0x36f120(0x59b)](_0xc8ddc3=>{const _0x4da769=_0x36f120;_0xc8ddc3!==_0x24a83f&&_0xc8ddc3[_0x4da769(0xeda)](_0x4da769(0xe84))[_0x4da769(0x159b)][_0x4da769(0xa9c)](_0x4da769(0x13b1));});}async function _0x17dc45(_0x568c75){const _0x527d36=_0xc64c06;_0x568c75[_0x527d36(0x1025)]();const _0x10175e=_0x568c75[_0x527d36(0xb57)],_0x112938=_0x10175e[_0x527d36(0x96a)]('.comment-delete-btn');if(_0x112938){const _0x50e2d5=_0x112938[_0x527d36(0x96a)]('.qzone-post-container'),_0x2c8647=parseInt(_0x50e2d5[_0x527d36(0x746)][_0x527d36(0xd8f)]),_0x3777ca=parseInt(_0x112938[_0x527d36(0x746)][_0x527d36(0x98b)]);if(isNaN(_0x2c8647)||isNaN(_0x3777ca))return;const _0x27b470=_0x6f01c2['find'](_0x1ae15e=>_0x1ae15e['id']===_0x2c8647);if(!_0x27b470||!_0x27b470[_0x527d36(0x10ae)]||!_0x27b470[_0x527d36(0x10ae)][_0x3777ca])return;const _0x577aa6=_0x27b470['comments'][_0x3777ca],_0x3d929f=await _0x109970('删除评论','确定要删除这条评论吗？',{'confirmButtonClass':_0x527d36(0x1c6)});if(_0x3d929f){_0x27b470['comments'][_0x527d36(0x30b)](_0x3777ca,0x1),await _0x3df81a[_0x527d36(0x910)][_0x527d36(0xf18)](_0x2c8647,{'comments':_0x27b470[_0x527d36(0x10ae)]});if(_0x577aa6&&_0x577aa6[_0x527d36(0xe27)]===_0x1ae02e[_0x527d36(0x11ef)][_0x527d36(0xb46)]){console[_0x527d36(0x57e)](_0x527d36(0x412));const _0x334c77=new Set();_0x27b470[_0x527d36(0x12cf)]!==_0x527d36(0x860)&&_0x334c77[_0x527d36(0x6a4)](_0x27b470[_0x527d36(0x12cf)]);if(_0x577aa6[_0x527d36(0xef4)]){const _0x39453e=Object[_0x527d36(0x753)](_0x1ae02e[_0x527d36(0x589)])[_0x527d36(0x13b7)](_0x282ea9=>_0x282ea9[_0x527d36(0x96f)]===_0x577aa6['replyTo']);_0x39453e&&_0x334c77[_0x527d36(0x6a4)](_0x39453e['id']);}const _0xe24fd0=(_0x27b470['publicText']||_0x27b470[_0x527d36(0x128c)]||'')[_0x527d36(0x516)](0x0,0x1e),_0x37f81c=_0x1ae02e['qzoneSettings'][_0x527d36(0xb46)];let _0x12056e;const _0x49f022=_0x1ae02e[_0x527d36(0x1420)][_0x527d36(0x13b7)](_0x49c159=>_0x49c159[_0x527d36(0x258)]===_0x577aa6['text']);if(_0x49f022)_0x12056e='用户\x27'+_0x37f81c+_0x527d36(0x65e)+_0xe24fd0+'”下，发送了一个表情评论，意思是：“'+_0x49f022[_0x527d36(0x5d2)]+'”。';else{if(_0x577aa6[_0x527d36(0xef4)]){const _0x39bfa1=_0x34f6a8(_0x577aa6[_0x527d36(0xef4)]);_0x12056e='用户\x27'+_0x37f81c+_0x527d36(0x65e)+_0xe24fd0+_0x527d36(0xdba)+_0x39bfa1+_0x527d36(0x8d4)+_0x577aa6['text']+'”。';}else _0x12056e='用户\x27'+_0x37f81c+_0x527d36(0x1376)+_0xe24fd0+_0x527d36(0x8ec)+_0x577aa6[_0x527d36(0x40f)]+'”。';}const _0x19f871=_0x527d36(0x147f)+_0x12056e+_0x527d36(0x788);for(const _0x169822 of _0x334c77){const _0x4fa3c7=_0x1ae02e['chats'][_0x169822];if(_0x4fa3c7){const _0x159efe=_0x4fa3c7[_0x527d36(0xce3)][_0x527d36(0x58a)];_0x4fa3c7['history']=_0x4fa3c7[_0x527d36(0xce3)][_0x527d36(0xede)](_0x27a3cd=>!(_0x27a3cd[_0x527d36(0x58e)]&&_0x27a3cd['role']===_0x527d36(0x1594)&&_0x27a3cd['content']===_0x19f871)),_0x4fa3c7['history'][_0x527d36(0x58a)]<_0x159efe&&(console[_0x527d36(0x57e)](_0x527d36(0x151c)+_0x4fa3c7[_0x527d36(0x5d2)]+_0x527d36(0xd36)),await _0x3df81a[_0x527d36(0x589)][_0x527d36(0x295)](_0x4fa3c7));}}}await _0x511c14(_0x2c8647);}return;}const _0x204229=_0x10175e[_0x527d36(0x96a)](_0x527d36(0x10b4));if(_0x204229){const _0x1ce5c3=_0x204229[_0x527d36(0x96a)]('.qzone-post-container');if(!_0x1ce5c3)return;const _0x802408=parseInt(_0x1ce5c3[_0x527d36(0x746)]['postId']);_0x4d11d5[_0x527d36(0x491)]&&_0x4d11d5[_0x527d36(0x15bf)]===_0x802408?_0x42ac48():_0x3c0632(_0x802408,_0x204229);return;}const _0x2f788e=_0x10175e[_0x527d36(0x96a)](_0x527d36(0x696));if(_0x2f788e){const _0x2b2ee8=parseInt(_0x2f788e[_0x527d36(0x746)]['postId']),_0xcd386e=_0x2f788e[_0x527d36(0x746)][_0x527d36(0x1133)],_0x55df26=_0x2f788e[_0x527d36(0x746)]['commenterDisplayName'];if(!_0xcd386e||!_0x55df26||_0xcd386e===_0x1ae02e[_0x527d36(0x11ef)][_0x527d36(0xb46)]){_0x4a7c98(_0x2f788e[_0x527d36(0x96a)](_0x527d36(0x104c)));return;}_0x743628={'postId':_0x2b2ee8,'replyToName':_0xcd386e,'replyToDisplayName':_0x55df26};const _0x474072=_0x2f788e[_0x527d36(0x96a)](_0x527d36(0x104c)),_0x52131b=_0x474072[_0x527d36(0xeda)]('.comment-input');_0x52131b[_0x527d36(0xced)]=_0x527d36(0xefc)+_0x55df26+':',_0x52131b['focus']();return;}if(_0x10175e[_0x527d36(0x159b)][_0x527d36(0xaea)](_0x527d36(0x142a))){const _0x2a2bb6=_0x10175e[_0x527d36(0x96a)](_0x527d36(0x104c));if(_0x2a2bb6&&_0x2a2bb6['dataset']['postId'])_0x5a2a11(parseInt(_0x2a2bb6[_0x527d36(0x746)][_0x527d36(0xd8f)]));return;}if(_0x10175e['tagName']===_0x527d36(0x15b3)&&_0x10175e['dataset']['hiddenText']){_0x1460c5('图片内容',_0x10175e[_0x527d36(0x746)][_0x527d36(0x645)][_0x527d36(0xef0)](/<br>/g,'\x0a'));return;}const _0x56da2f=_0x10175e['closest'](_0x527d36(0x104c));if(!_0x56da2f)return;const _0x2b9f55=parseInt(_0x56da2f[_0x527d36(0x746)][_0x527d36(0xd8f)]);if(isNaN(_0x2b9f55))return;if(_0x10175e[_0x527d36(0x96a)](_0x527d36(0x1480))){const _0x10f17a=await _0x109970('删除动态','确定要永久删除这条动态吗？',{'confirmButtonClass':_0x527d36(0x1c6)});_0x10f17a&&(_0x56da2f[_0x527d36(0x215)][_0x527d36(0x4dc)]='all\x200.3s\x20ease',_0x56da2f[_0x527d36(0x215)][_0x527d36(0x8c6)]='scale(0.8)',_0x56da2f[_0x527d36(0x215)][_0x527d36(0x38d)]='0',setTimeout(async()=>{const _0x17a85f=_0x527d36;await _0x3df81a[_0x17a85f(0x910)][_0x17a85f(0xc40)](_0x2b9f55);const _0x29a088=_0x17a85f(0x9df)+_0x2b9f55+')';for(const _0x5ac76d in _0x1ae02e[_0x17a85f(0x589)]){const _0x1dfeb9=_0x1ae02e['chats'][_0x5ac76d],_0x5be3d5=_0x1dfeb9['history'][_0x17a85f(0x58a)];_0x1dfeb9[_0x17a85f(0xce3)]=_0x1dfeb9['history'][_0x17a85f(0xede)](_0x26fffe=>!(_0x26fffe[_0x17a85f(0xfbb)]===_0x17a85f(0x1594)&&_0x26fffe[_0x17a85f(0x128c)][_0x17a85f(0xe82)](_0x29a088)));if(_0x1dfeb9[_0x17a85f(0xce3)]['length']<_0x5be3d5)await _0x3df81a[_0x17a85f(0x589)]['put'](_0x1dfeb9);}await _0x28d6f7(),alert(_0x17a85f(0x1186));},0x12c));return;}const _0x2b4fd0=_0x10175e['closest'](_0x527d36(0x8e0));if(_0x2b4fd0){if(_0x2b4fd0[_0x527d36(0x159b)][_0x527d36(0xaea)](_0x527d36(0x1209))){_0x4e75af(_0x2b9f55);return;}if(_0x2b4fd0[_0x527d36(0x159b)]['contains']('like')){const _0x502039=_0x6f01c2['find'](_0x39982f=>_0x39982f['id']===_0x2b9f55);if(!_0x502039)return;if(!_0x502039[_0x527d36(0xb09)])_0x502039[_0x527d36(0xb09)]=[];const _0x32a79d=_0x1ae02e[_0x527d36(0x11ef)][_0x527d36(0xb46)],_0x4794b1=_0x502039[_0x527d36(0xb09)][_0x527d36(0x621)](_0x32a79d);_0x4794b1>-0x1?_0x502039['likes'][_0x527d36(0x30b)](_0x4794b1,0x1):(_0x502039[_0x527d36(0xb09)][_0x527d36(0x1426)](_0x32a79d),_0x2b4fd0[_0x527d36(0x159b)][_0x527d36(0x6a4)]('animate-like'),_0x2b4fd0['addEventListener'](_0x527d36(0x3fd),()=>_0x2b4fd0[_0x527d36(0x159b)][_0x527d36(0xa9c)]('animate-like'),{'once':!![]})),await _0x3df81a[_0x527d36(0x910)]['update'](_0x2b9f55,{'likes':_0x502039[_0x527d36(0xb09)]}),await _0x511c14(_0x2b9f55);}if(_0x2b4fd0[_0x527d36(0x159b)][_0x527d36(0xaea)](_0x527d36(0x102d))){const _0xe5beb5=await _0x3df81a[_0x527d36(0xbeb)][_0x527d36(0x478)]({'type':'qzone_post','content.id':_0x2b9f55})[_0x527d36(0x9a8)]();if(_0xe5beb5)await _0x3df81a['favorites']['delete'](_0xe5beb5['id']),await _0x1460c5('提示','已取消收藏');else{const _0x36d080=await _0x3df81a['qzonePosts']['get'](_0x2b9f55);_0x36d080&&(await _0x3df81a[_0x527d36(0xbeb)][_0x527d36(0x6a4)]({'type':_0x527d36(0x4e1),'content':_0x36d080,'timestamp':Date['now']()}),await _0x1460c5('提示',_0x527d36(0x1319)));}await _0x511c14(_0x2b9f55);}return;}const _0x578f55=_0x10175e['closest'](_0x527d36(0x724));if(_0x578f55){const _0x33b9ae=_0x56da2f['querySelector']('.comment-input'),_0x6466ab=_0x33b9ae[_0x527d36(0x107e)][_0x527d36(0x4a2)]();if(!_0x6466ab)return alert(_0x527d36(0x14e9));const _0x3ace6b=_0x6f01c2[_0x527d36(0x13b7)](_0x708e17=>_0x708e17['id']===_0x2b9f55);if(!_0x3ace6b)return;if(!_0x3ace6b[_0x527d36(0x10ae)])_0x3ace6b[_0x527d36(0x10ae)]=[];const _0x120342={'commenterName':_0x1ae02e['qzoneSettings'][_0x527d36(0xb46)],'text':_0x6466ab,'timestamp':Date[_0x527d36(0xd6e)](),'replyTo':_0x743628&&_0x743628['postId']===_0x2b9f55?_0x743628[_0x527d36(0x47e)]:null};_0x3ace6b[_0x527d36(0x10ae)][_0x527d36(0x1426)](_0x120342),await _0x3df81a[_0x527d36(0x910)][_0x527d36(0xf18)](_0x2b9f55,{'comments':_0x3ace6b[_0x527d36(0x10ae)]});let _0x5d4324=(_0x3ace6b['publicText']||_0x3ace6b[_0x527d36(0x128c)]||'')[_0x527d36(0x516)](0x0,0x1e);const _0x341ff2=_0x1ae02e[_0x527d36(0x11ef)][_0x527d36(0xb46)],_0x50f5d5=new Set();if(_0x3ace6b[_0x527d36(0x12cf)]!==_0x527d36(0x860))_0x50f5d5[_0x527d36(0x6a4)](_0x3ace6b[_0x527d36(0x12cf)]);if(_0x120342['replyTo']&&_0x120342[_0x527d36(0xef4)]!==_0x341ff2){const _0x28bd88=Object[_0x527d36(0x753)](_0x1ae02e[_0x527d36(0x589)])['find'](_0x22093e=>_0x22093e['originalName']===_0x120342[_0x527d36(0xef4)]);if(_0x28bd88)_0x50f5d5[_0x527d36(0x6a4)](_0x28bd88['id']);}for(const _0x232316 of _0x50f5d5){const _0x55fdfd=_0x1ae02e[_0x527d36(0x589)][_0x232316];if(_0x55fdfd&&!_0x55fdfd[_0x527d36(0xe83)]){const _0x59e7c7=_0x1ae02e[_0x527d36(0x1420)]['find'](_0x33dd14=>_0x33dd14[_0x527d36(0x258)]===_0x6466ab);let _0x1c6582=_0x59e7c7?_0x527d36(0x817)+_0x341ff2+_0x527d36(0x65e)+_0x5d4324+_0x527d36(0x150d)+_0x59e7c7[_0x527d36(0x5d2)]+'”。':_0x120342[_0x527d36(0xef4)]?_0x527d36(0x817)+_0x341ff2+_0x527d36(0x65e)+_0x5d4324+_0x527d36(0xdba)+_0x743628[_0x527d36(0x158f)]+_0x527d36(0x8d4)+_0x6466ab+'”。':_0x527d36(0x817)+_0x341ff2+_0x527d36(0x1376)+_0x5d4324+'”，内容是：“'+_0x6466ab+'”。';const _0x56eb05={'role':_0x527d36(0x1594),'content':_0x527d36(0x147f)+_0x1c6582+'请你对此作出回应。]','timestamp':Date['now'](),'isHidden':!![]};_0x55fdfd['history'][_0x527d36(0x1426)](_0x56eb05),await _0x3df81a['chats'][_0x527d36(0x295)](_0x55fdfd);}}_0x33b9ae[_0x527d36(0x107e)]='',_0x4a7c98(_0x56da2f),await _0x511c14(_0x2b9f55);return;}}const _0x2716a4=_0x5502c4=>{const _0x361999=_0xc64c06,_0x1b52e9=_0x5502c4[_0x361999(0xb57)];if(_0x1b52e9[_0x361999(0x96a)](_0x361999(0x26f)))return;const _0x3248d2=_0x5502c4[_0x361999(0xb57)][_0x361999(0x96a)]('.qzone-post-container');if(!_0x3248d2)return;_0x20ed05(_0x3248d2),_0x59aeb1['activeContainer']=_0x3248d2,_0x59aeb1[_0x361999(0x1473)]=!![],_0x59aeb1[_0x361999(0x84a)]=!![],_0x59aeb1['swipeDirection']=null,_0x59aeb1[_0x361999(0x1543)]=_0x5502c4[_0x361999(0xcbd)][_0x361999(0xe82)](_0x361999(0x373))?_0x5502c4[_0x361999(0xe97)]:_0x5502c4['touches'][0x0][_0x361999(0xe97)],_0x59aeb1[_0x361999(0x647)]=_0x5502c4[_0x361999(0xcbd)]['includes'](_0x361999(0x373))?_0x5502c4[_0x361999(0x857)]:_0x5502c4[_0x361999(0xc92)][0x0][_0x361999(0x857)],_0x59aeb1['activeContainer'][_0x361999(0xeda)](_0x361999(0xe84))[_0x361999(0x215)][_0x361999(0x4dc)]=_0x361999(0x1b5),document[_0x361999(0x122b)](_0x361999(0xb7e),_0x44c437),document['addEventListener'](_0x361999(0x3e4),_0xcfe157),document['addEventListener'](_0x361999(0xa92),_0x44c437,{'passive':![]}),document[_0x361999(0x122b)](_0x361999(0x4f5),_0xcfe157);},_0x44c437=_0x388e62=>{const _0x3eaf79=_0xc64c06;if(!_0x59aeb1[_0x3eaf79(0x1473)]||!_0x59aeb1['activeContainer'])return;const _0x50c03d=_0x388e62[_0x3eaf79(0xcbd)][_0x3eaf79(0xe82)](_0x3eaf79(0x373))?_0x388e62['pageX']:_0x388e62['touches'][0x0]['pageX'],_0xddeb71=_0x388e62[_0x3eaf79(0xcbd)][_0x3eaf79(0xe82)](_0x3eaf79(0x373))?_0x388e62[_0x3eaf79(0x857)]:_0x388e62[_0x3eaf79(0xc92)][0x0][_0x3eaf79(0x857)],_0x388940=_0x50c03d-_0x59aeb1[_0x3eaf79(0x1543)],_0x4c5ee2=_0xddeb71-_0x59aeb1[_0x3eaf79(0x647)];_0x59aeb1[_0x3eaf79(0x84a)]&&(Math[_0x3eaf79(0x151f)](_0x388940)>0x5||Math[_0x3eaf79(0x151f)](_0x4c5ee2)>0x5)&&(_0x59aeb1[_0x3eaf79(0x84a)]=![]);!_0x59aeb1[_0x3eaf79(0x213)]&&(Math['abs'](_0x388940)>Math[_0x3eaf79(0x151f)](_0x4c5ee2)?_0x59aeb1['swipeDirection']=_0x3eaf79(0x12e3):_0x59aeb1[_0x3eaf79(0x213)]=_0x3eaf79(0xc29));if(_0x59aeb1['swipeDirection']===_0x3eaf79(0x12e3)){_0x388e62[_0x3eaf79(0x32e)](),_0x59aeb1['currentX']=_0x50c03d;let _0x3d3102=Math[_0x3eaf79(0xbc3)](0x0,Math[_0x3eaf79(0x616)](-0x5a,_0x388940));_0x59aeb1[_0x3eaf79(0x13e1)][_0x3eaf79(0xeda)](_0x3eaf79(0xe84))['style']['transform']=_0x3eaf79(0xe43)+_0x3d3102+'px)';}},_0xcfe157=_0x91b203=>{const _0x260ec0=_0xc64c06;document[_0x260ec0(0x7f6)](_0x260ec0(0xb7e),_0x44c437),document[_0x260ec0(0x7f6)](_0x260ec0(0x3e4),_0xcfe157),document[_0x260ec0(0x7f6)](_0x260ec0(0xa92),_0x44c437),document[_0x260ec0(0x7f6)](_0x260ec0(0x4f5),_0xcfe157);if(!_0x59aeb1[_0x260ec0(0x1473)]||!_0x59aeb1[_0x260ec0(0x13e1)])return;const _0x50b868=_0x59aeb1[_0x260ec0(0x13e1)][_0x260ec0(0xeda)](_0x260ec0(0xe84));_0x50b868[_0x260ec0(0x215)]['transition']=_0x260ec0(0x8a5);if(_0x59aeb1[_0x260ec0(0x213)]==='horizontal'&&!_0x59aeb1[_0x260ec0(0x84a)]){const _0x4f7780=_0x91b203[_0x260ec0(0xcbd)][_0x260ec0(0xe82)]('touchend')?_0x91b203['changedTouches'][0x0]['pageX']:_0x91b203[_0x260ec0(0xe97)],_0x4bedb8=_0x4f7780-_0x59aeb1['startX'];_0x4bedb8<-0x28?_0x50b868[_0x260ec0(0x159b)][_0x260ec0(0x6a4)](_0x260ec0(0x13b1)):_0x50b868[_0x260ec0(0x159b)][_0x260ec0(0xa9c)](_0x260ec0(0x13b1));}_0x50b868[_0x260ec0(0x215)][_0x260ec0(0x8c6)]='',_0x59aeb1[_0x260ec0(0x1473)]=![],_0x59aeb1[_0x260ec0(0x13e1)]=null,_0x59aeb1[_0x260ec0(0x213)]=null,_0x59aeb1[_0x260ec0(0x84a)]=!![];};_0xc7d946[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x17dc45),_0xc7d946[_0xc64c06(0x122b)](_0xc64c06(0x103d),_0x2716a4),_0xc7d946['addEventListener'](_0xc64c06(0x158c),_0x2716a4,{'passive':!![]}),_0xc7d946['addEventListener'](_0xc64c06(0x740),_0x1065be=>{const _0x206ef5=_0xc64c06;_0x1065be[_0x206ef5(0xb57)]&&_0x1065be[_0x206ef5(0xb57)]['id']==='load-more-qzone-btn'&&_0x2e2547();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1490))['addEventListener'](_0xc64c06(0x740),()=>{const _0x589075=_0xc64c06;_0x1ae02e[_0x589075(0x588)]&&_0x3f0e99(_0x1ae02e[_0x589075(0x588)]);}),document['getElementById'](_0xc64c06(0x211))['addEventListener'](_0xc64c06(0x1147),_0x1f50bf),document[_0xc64c06(0x1f4)](_0xc64c06(0x354))['addEventListener'](_0xc64c06(0x740),_0x2c154f),document['getElementById'](_0xc64c06(0xea9))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x5d5e42),document[_0xc64c06(0x1f4)](_0xc64c06(0x2b7))[_0xc64c06(0x122b)]('click',()=>{const _0x5b7472=_0xc64c06,_0x4bd06b=document[_0x5b7472(0x1f4)]('world-book-entries-container');_0x4bd06b['querySelector']('p')&&(_0x4bd06b[_0x5b7472(0xf21)]='');const _0x32b8b9=_0x4fc058();_0x4bd06b[_0x5b7472(0x6ce)](_0x32b8b9),_0x32b8b9[_0x5b7472(0xeda)](_0x5b7472(0xfe1))[_0x5b7472(0xed2)]();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x9ce))['addEventListener'](_0xc64c06(0x740),_0x42d8d8),document[_0xc64c06(0x1f4)](_0xc64c06(0x11be))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x4ce041=>{const _0x358672=_0xc64c06;_0x4ce041[_0x358672(0xb57)]&&_0x4ce041[_0x358672(0xb57)]['id']===_0x358672(0xd37)&&_0x616eb2();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x9e1))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x4b9a45),document[_0xc64c06(0x1f4)](_0xc64c06(0xcbf))[_0xc64c06(0x122b)]('click',_0x890701),document[_0xc64c06(0x1f4)](_0xc64c06(0xf9e))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x2aa0c4=>{const _0x5b5753=_0xc64c06;_0x2aa0c4[_0x5b5753(0xb57)]['id']===_0x5b5753(0xf9e)&&_0x2aa0c4['target']['classList'][_0x5b5753(0xa9c)]('visible');}),document[_0xc64c06(0x1f4)]('manage-stickers-btn')['addEventListener'](_0xc64c06(0x740),_0x5af9ef),document['getElementById'](_0xc64c06(0xfb0))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x120d5b),document['getElementById'](_0xc64c06(0x12ed))['addEventListener'](_0xc64c06(0x740),()=>_0x407a4b(_0xc64c06(0xeb0))),document[_0xc64c06(0x1f4)]('favorites-back-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>_0x407a4b(_0xc64c06(0xeb0)));const _0x30c487=document[_0xc64c06(0x1f4)](_0xc64c06(0x2d6)),_0x38beb3=document['getElementById'](_0xc64c06(0x18f));_0x30c487['addEventListener'](_0xc64c06(0x1557),()=>{const _0x9dc07f=_0xc64c06,_0x6b29f5=_0x30c487[_0x9dc07f(0x107e)][_0x9dc07f(0x4a2)]()['toLowerCase']();_0x38beb3[_0x9dc07f(0x215)][_0x9dc07f(0x887)]=_0x6b29f5?'block':_0x9dc07f(0x1b5);if(!_0x6b29f5){_0x34be73(allFavoriteItems);return;}const _0x50d8fe=allFavoriteItems[_0x9dc07f(0xede)](_0xef1b23=>{const _0x1d74f4=_0x9dc07f;let _0x243a6c='',_0x3f1eb6='';if(_0xef1b23[_0x1d74f4(0xcbd)]===_0x1d74f4(0x4e1)){const _0x2dec83=_0xef1b23[_0x1d74f4(0x128c)];_0x243a6c+=(_0x2dec83[_0x1d74f4(0xf1f)]||'')+'\x20'+(_0x2dec83[_0x1d74f4(0x128c)]||'');if(_0x2dec83[_0x1d74f4(0x12cf)]===_0x1d74f4(0x860))_0x3f1eb6=_0x1ae02e[_0x1d74f4(0x11ef)][_0x1d74f4(0xb46)];else _0x1ae02e[_0x1d74f4(0x589)][_0x2dec83[_0x1d74f4(0x12cf)]]&&(_0x3f1eb6=_0x1ae02e['chats'][_0x2dec83[_0x1d74f4(0x12cf)]][_0x1d74f4(0x5d2)]);}else{if(_0xef1b23['type']===_0x1d74f4(0xa17)){const _0x1bb51e=_0xef1b23['content'];typeof _0x1bb51e[_0x1d74f4(0x128c)]===_0x1d74f4(0x6c3)&&(_0x243a6c=_0x1bb51e[_0x1d74f4(0x128c)]);const _0x1657cc=_0x1ae02e[_0x1d74f4(0x589)][_0xef1b23[_0x1d74f4(0x3e0)]];_0x1657cc&&(_0x1bb51e[_0x1d74f4(0xfbb)]==='user'?_0x3f1eb6=_0x1657cc[_0x1d74f4(0xe83)]?_0x1657cc[_0x1d74f4(0x6a8)][_0x1d74f4(0xe31)]||'我':'我':_0x3f1eb6=_0x1657cc['isGroup']?_0x1bb51e[_0x1d74f4(0xfb7)]:_0x1657cc[_0x1d74f4(0x5d2)]);}}return _0x243a6c['toLowerCase']()['includes'](_0x6b29f5)||_0x3f1eb6[_0x1d74f4(0x1f7)]()[_0x1d74f4(0xe82)](_0x6b29f5);});_0x34be73(_0x50d8fe);}),_0x38beb3[_0xc64c06(0x122b)]('click',()=>{const _0x1cb322=_0xc64c06;_0x30c487[_0x1cb322(0x107e)]='',_0x38beb3[_0x1cb322(0x215)]['display']=_0x1cb322(0x1b5),_0x34be73(allFavoriteItems),_0x30c487['focus']();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x7b9))[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x39d51d=_0xc64c06;if(_0xc320bf[_0x39d51d(0xb51)]===0x0)return;const _0xf57f17=_0x1ae02e['chats'][_0x1ae02e[_0x39d51d(0x588)]];if(!_0xf57f17)return;const _0x1266b2=[],_0x50547f=[..._0xc320bf];for(const _0x513a52 of _0x50547f){const _0x59224d=await _0x3df81a[_0x39d51d(0xbeb)][_0x39d51d(0x478)]('originalTimestamp')[_0x39d51d(0x49d)](_0x513a52)[_0x39d51d(0x9a8)]();if(!_0x59224d){const _0x4149d6=_0xf57f17[_0x39d51d(0xce3)][_0x39d51d(0x13b7)](_0x8a013f=>_0x8a013f[_0x39d51d(0x1388)]===_0x513a52);_0x4149d6&&_0x1266b2[_0x39d51d(0x1426)]({'type':'chat_message','content':_0x4149d6,'chatId':_0x1ae02e[_0x39d51d(0x588)],'timestamp':Date[_0x39d51d(0xd6e)](),'originalTimestamp':_0x4149d6[_0x39d51d(0x1388)]});}}_0x1266b2[_0x39d51d(0x58a)]>0x0?(await _0x3df81a[_0x39d51d(0xbeb)][_0x39d51d(0x4ea)](_0x1266b2),allFavoriteItems=await _0x3df81a[_0x39d51d(0xbeb)][_0x39d51d(0x931)]('timestamp')[_0x39d51d(0x115a)]()[_0x39d51d(0x27a)](),await _0x1460c5(_0x39d51d(0xb49),'已成功收藏\x20'+_0x1266b2['length']+'\x20条消息。')):await _0x1460c5('提示',_0x39d51d(0x3f7)),_0x527427();});const _0x266e06=document['getElementById'](_0xc64c06(0x320)),_0x1f3529=document[_0xc64c06(0x1f4)](_0xc64c06(0x128f)),_0x343930=document[_0xc64c06(0x1f4)](_0xc64c06(0x360)),_0x4ebf11=document['getElementById']('chat-list-bottom-nav'),_0xdbcdf8=document[_0xc64c06(0x1f4)](_0xc64c06(0x908));_0x266e06[_0xc64c06(0x122b)]('click',()=>{const _0x1fb398=_0xc64c06;_0x15f518=!_0x15f518,_0x1f3529[_0x1fb398(0x159b)]['toggle']('selection-mode',_0x15f518),_0x15f518?(_0x266e06['textContent']='完成',_0x343930['style'][_0x1fb398(0x887)]=_0x1fb398(0x361),_0x4ebf11[_0x1fb398(0x215)]['display']='none',_0xdbcdf8['style'][_0x1fb398(0xbbc)]=_0x1fb398(0xaa3)):(_0x266e06[_0x1fb398(0x231)]='编辑',_0x343930[_0x1fb398(0x215)][_0x1fb398(0x887)]=_0x1fb398(0x1b5),_0x4ebf11[_0x1fb398(0x215)]['display']='flex',_0xdbcdf8[_0x1fb398(0x215)][_0x1fb398(0xbbc)]='',_0x2d5904[_0x1fb398(0x411)](),document[_0x1fb398(0x14bf)](_0x1fb398(0xf49))[_0x1fb398(0x59b)](_0x2c5a59=>_0x2c5a59[_0x1fb398(0x159b)][_0x1fb398(0xa9c)]('selected')),document[_0x1fb398(0x1f4)](_0x1fb398(0x5bd))['textContent']=_0x1fb398(0x58f));}),document['getElementById'](_0xc64c06(0x908))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x411ee1=>{const _0x45e187=_0xc64c06,_0x173834=_0x411ee1[_0x45e187(0xb57)],_0x51e9e9=_0x173834[_0x45e187(0x96a)](_0x45e187(0x1197));if(_0x173834[_0x45e187(0x1120)]==='IMG'&&_0x173834[_0x45e187(0x746)][_0x45e187(0x645)]){const _0x1ffc5a=_0x173834[_0x45e187(0x746)][_0x45e187(0x645)];_0x1460c5(_0x45e187(0xa40),_0x1ffc5a[_0x45e187(0xef0)](/<br>/g,'\x0a'));return;}if(!_0x15f518)return;if(!_0x51e9e9)return;const _0x1ba25d=parseInt(_0x51e9e9[_0x45e187(0x746)][_0x45e187(0xc01)]);if(isNaN(_0x1ba25d))return;_0x2d5904['has'](_0x1ba25d)?(_0x2d5904['delete'](_0x1ba25d),_0x51e9e9[_0x45e187(0x159b)][_0x45e187(0xa9c)](_0x45e187(0xc3e))):(_0x2d5904[_0x45e187(0x6a4)](_0x1ba25d),_0x51e9e9[_0x45e187(0x159b)][_0x45e187(0x6a4)](_0x45e187(0xc3e))),document['getElementById']('favorites-delete-selected-btn')[_0x45e187(0x231)]=_0x45e187(0x408)+_0x2d5904[_0x45e187(0xb51)]+')';}),document[_0xc64c06(0x1f4)]('favorites-delete-selected-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x50db4e=_0xc64c06;if(_0x2d5904[_0x50db4e(0xb51)]===0x0)return;const _0x5a6b75=await _0x109970(_0x50db4e(0xed1),_0x50db4e(0x86f)+_0x2d5904[_0x50db4e(0xb51)]+'\x20条内容吗？',{'confirmButtonClass':_0x50db4e(0x1c6)});if(_0x5a6b75){const _0xccd7d6=[..._0x2d5904];await _0x3df81a['favorites'][_0x50db4e(0xab7)](_0xccd7d6),await _0x1460c5('删除成功','选中的收藏已被移除。'),allFavoriteItems=allFavoriteItems[_0x50db4e(0xede)](_0x188d1f=>!_0xccd7d6[_0x50db4e(0xe82)](_0x188d1f['id'])),_0x34be73(allFavoriteItems),_0x266e06[_0x50db4e(0x740)]();}});_0x1ae02e[_0xc64c06(0x12c0)][_0xc64c06(0x605)]&&(_0x217a5b(),console[_0xc64c06(0x57e)]('后台活动模拟已自动启动。'));document[_0xc64c06(0x14bf)](_0xc64c06(0xa95))[_0xc64c06(0x59b)](_0x3486c7=>{const _0x2f0dfa=_0xc64c06;_0x3486c7['addEventListener'](_0x2f0dfa(0x1147),_0x356272);});const _0x2ee094=document['getElementById'](_0xc64c06(0xe62));_0x2ee094[_0xc64c06(0x122b)](_0xc64c06(0x1557),()=>{const _0x5d861b=_0xc64c06;document[_0x5d861b(0x1f4)](_0x5d861b(0xc16))['textContent']=_0x2ee094['value']+'px',_0x356272();});const _0x3b298f=document[_0xc64c06(0x1f4)](_0xc64c06(0x833));_0x3b298f['addEventListener'](_0xc64c06(0x1557),_0x356272),document['getElementById'](_0xc64c06(0xdb4))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x482265=_0xc64c06;document[_0x482265(0x1f4)]('theme-default')[_0x482265(0xe56)]=!![],_0x356272();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1576))['addEventListener']('click',()=>{const _0x4fc452=_0xc64c06;document[_0x4fc452(0x1f4)](_0x4fc452(0x833))['value']='',_0x356272();}),document[_0xc64c06(0x1f4)]('lyrics-vertical-pos')[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x356272),document[_0xc64c06(0x1f4)](_0xc64c06(0x8f1))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x356272),document[_0xc64c06(0x1f4)](_0xc64c06(0x1ff))[_0xc64c06(0x122b)]('input',_0x356272),document[_0xc64c06(0x14bf)](_0xc64c06(0xd85))[_0xc64c06(0x59b)](_0x25754d=>{const _0x4881b4=_0xc64c06;_0x25754d[_0x4881b4(0x122b)](_0x4881b4(0x1147),function(){const _0x46ff11=_0x4881b4,_0x49a13a=document[_0x46ff11(0x1f4)](_0x46ff11(0x28e));this[_0x46ff11(0x107e)]===_0x46ff11(0x1f8)||this['value']===_0x46ff11(0x207)?_0x49a13a[_0x46ff11(0x215)][_0x46ff11(0x887)]='block':_0x49a13a['style']['display']=_0x46ff11(0x1b5);});}),document[_0xc64c06(0x1f4)]('manage-groups-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x205fba),document['getElementById'](_0xc64c06(0x254))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0xb1f989=_0xc64c06;document[_0xb1f989(0x1f4)](_0xb1f989(0x1033))['classList'][_0xb1f989(0xa9c)](_0xb1f989(0xfca));const _0x8689b2=document['getElementById']('chat-settings-btn');document[_0xb1f989(0x1f4)](_0xb1f989(0xccd))[_0xb1f989(0x159b)]['contains']('visible')&&_0x8689b2[_0xb1f989(0x740)]();}),document[_0xc64c06(0x1f4)](_0xc64c06(0xa3e))['addEventListener'](_0xc64c06(0x740),_0x11e30b),document[_0xc64c06(0x1f4)]('existing-groups-list')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x7c3f2f=>{const _0x45a21f=_0xc64c06;if(_0x7c3f2f[_0x45a21f(0xb57)]['classList'][_0x45a21f(0xaea)](_0x45a21f(0x2f5))){const _0x1de778=parseInt(_0x7c3f2f[_0x45a21f(0xb57)][_0x45a21f(0x746)]['id']);_0x54a829(_0x1de778);}}),document[_0xc64c06(0x1f4)](_0xc64c06(0xfb4))['addEventListener'](_0xc64c06(0x740),_0x22a0ab),document[_0xc64c06(0x1f4)]('edit-message-btn')['addEventListener'](_0xc64c06(0x740),_0x5999ab),document['getElementById'](_0xc64c06(0xf4e))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x3cb484),document[_0xc64c06(0x1f4)](_0xc64c06(0xbf0))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x417baa),document[_0xc64c06(0x1f4)](_0xc64c06(0x41a))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x22d886=_0x3c0c35;_0x22a0ab(),_0x22d886&&_0x15b4f1(_0x22d886);}),document[_0xc64c06(0x1f4)]('chat-messages')[_0xc64c06(0x122b)]('click',_0x3c08cd=>{const _0x24c003=_0xc64c06,_0x3febe4=_0x3c08cd[_0x24c003(0xb57)][_0x24c003(0x96a)]('.message-bubble');if(!_0x3febe4)return;if(_0x3febe4[_0x24c003(0x159b)][_0x24c003(0xaea)]('ai')&&_0x3febe4[_0x24c003(0x159b)]['contains']('is-transfer')&&_0x3febe4[_0x24c003(0x746)][_0x24c003(0x1589)]==='pending'){const _0x1cca8a=parseInt(_0x3febe4[_0x24c003(0x746)][_0x24c003(0x1388)]);!isNaN(_0x1cca8a)&&_0x1632cb(_0x1cca8a);}}),document['getElementById']('transfer-action-accept')['addEventListener'](_0xc64c06(0x740),()=>_0x2ee6fa(_0xc64c06(0x11d3))),document['getElementById'](_0xc64c06(0x14e4))[_0xc64c06(0x122b)]('click',()=>_0x2ee6fa(_0xc64c06(0x1281))),document[_0xc64c06(0x1f4)](_0xc64c06(0x12fd))['addEventListener'](_0xc64c06(0x740),_0x46ad40),document[_0xc64c06(0x1f4)](_0xc64c06(0x1495))['addEventListener'](_0xc64c06(0x740),_0x5bc099),document[_0xc64c06(0x1f4)](_0xc64c06(0xb69))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x5a44cf),document[_0xc64c06(0x1f4)](_0xc64c06(0x1497))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x176d7f),document['getElementById'](_0xc64c06(0x8a3))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x2c264a=_0xc64c06;_0x2e53fa(_0x2c264a(0x133d));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x10f0))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x2eb54f=>{const _0x2ee196=_0xc64c06,_0x17adeb=_0x2eb54f[_0x2ee196(0xb57)]['closest'](_0x2ee196(0x96b));if(!_0x17adeb)return;const _0x4f52b0=_0x17adeb[_0x2ee196(0x746)][_0x2ee196(0x80a)];_0x17adeb[_0x2ee196(0x159b)]['toggle']('selected'),_0x2bd389[_0x2ee196(0xe75)](_0x4f52b0)?_0x2bd389[_0x2ee196(0xc40)](_0x4f52b0):_0x2bd389['add'](_0x4f52b0),_0x5c2ecb();}),document[_0xc64c06(0x1f4)]('manage-members-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{_0x4a91e3();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x700))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x447e29=_0xc64c06;_0x2e53fa('chat-interface-screen'),document['getElementById'](_0x447e29(0x4c4))[_0x447e29(0x740)]();}),document['getElementById'](_0xc64c06(0x9a6))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x27d3ac=>{const _0x32be67=_0xc64c06;_0x27d3ac['target']['classList']['contains'](_0x32be67(0x670))&&_0xec098b(_0x27d3ac[_0x32be67(0xb57)][_0x32be67(0x746)]['memberId']);}),document['getElementById'](_0xc64c06(0xdae))['addEventListener'](_0xc64c06(0x740),async()=>{const _0x34dba2=_0xc64c06,_0x421be5=document[_0x34dba2(0x1f4)](_0x34dba2(0x261)),_0x5eaeff=_0x421be5[_0x34dba2(0xf44)](!![]);_0x421be5['parentNode']['replaceChild'](_0x5eaeff,_0x421be5),_0x5eaeff['addEventListener'](_0x34dba2(0x740),_0x8f849e),await _0x3332d5();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x533))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x3a7902),document[_0xc64c06(0x1f4)]('video-call-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x266a61),document['getElementById'](_0xc64c06(0x1547))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x266a61),document[_0xc64c06(0x1f4)](_0xc64c06(0xb24))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x102da0),document[_0xc64c06(0x1f4)]('cancel-call-btn')['addEventListener'](_0xc64c06(0x740),()=>{const _0x3f0b12=_0xc64c06;_0x11ced0[_0x3f0b12(0x116c)]=![],_0x2e53fa(_0x3f0b12(0x13c3));}),document[_0xc64c06(0x1f4)](_0xc64c06(0xea8))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x3688e3),document[_0xc64c06(0x1f4)](_0xc64c06(0x1f5))[_0xc64c06(0x122b)]('click',async()=>{const _0x53f2c9=_0xc64c06;_0x2a3f87();const _0x42fb29=_0x1ae02e[_0x53f2c9(0x589)][_0x11ced0[_0x53f2c9(0x588)]];if(!_0x42fb29)return;if(_0x11ced0[_0x53f2c9(0xd5e)]){_0x11ced0[_0x53f2c9(0x59d)]=![];const _0x10450d={'role':_0x53f2c9(0x1594),'content':_0x53f2c9(0x1061),'timestamp':Date[_0x53f2c9(0xd6e)](),'isHidden':!![]};_0x42fb29[_0x53f2c9(0xce3)]['push'](_0x10450d),await _0x3df81a[_0x53f2c9(0x589)][_0x53f2c9(0x295)](_0x42fb29),await _0x5626da();}else{const _0x3b9a91={'role':_0x53f2c9(0x860),'content':'我拒绝了你的视频通话请求。','timestamp':Date[_0x53f2c9(0xd6e)]()};_0x42fb29['history']['push'](_0x3b9a91),await _0x3df81a[_0x53f2c9(0x589)][_0x53f2c9(0x295)](_0x42fb29),_0x2e53fa(_0x53f2c9(0x13c3)),_0x5286f1(_0x3b9a91,_0x42fb29),_0x5626da();}_0x11ced0[_0x53f2c9(0x116c)]=![];}),document[_0xc64c06(0x1f4)](_0xc64c06(0x27d))[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x133867=_0xc64c06;_0x2a3f87(),_0x11ced0[_0x133867(0x735)]='ai',_0x11ced0[_0x133867(0x59d)]=!![],_0x11ced0[_0x133867(0x588)]=_0x1ae02e[_0x133867(0x588)];if(_0x11ced0[_0x133867(0xd5e)]){const _0x46ff21=_0x1ae02e[_0x133867(0x589)][_0x11ced0[_0x133867(0x588)]],_0x5a9a06=_0x46ff21[_0x133867(0x1402)][_0x133867(0x13b7)](_0x1e0e9e=>_0x1e0e9e[_0x133867(0x5d2)]===_0x11ced0[_0x133867(0x108f)]);_0x5a9a06?_0x11ced0[_0x133867(0x1059)]=[_0x5a9a06]:_0x11ced0[_0x133867(0x1059)]=[];}_0xeb5668();}),document['getElementById']('user-speak-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x1edea6=_0xc64c06;if(!_0x11ced0[_0x1edea6(0xd51)])return;const _0x40f56a=document[_0x1edea6(0xeda)](_0x1edea6(0x12ec));_0x40f56a&&_0x40f56a[_0x1edea6(0x159b)][_0x1edea6(0x6a4)](_0x1edea6(0x8ed));const _0xb121f7=await _0x11f6fb('你说',_0x1edea6(0x9bf));_0x40f56a&&_0x40f56a[_0x1edea6(0x159b)][_0x1edea6(0xa9c)](_0x1edea6(0x8ed)),_0xb121f7&&_0xb121f7[_0x1edea6(0x4a2)]()&&_0x5e7bc2(_0xb121f7[_0x1edea6(0x4a2)]());}),document[_0xc64c06(0xeda)]('.nav-item[data-view=\x22memories-view\x22]')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x5aba78=_0xc64c06;_0x15f518&&document[_0x5aba78(0x1f4)]('favorites-edit-btn')['click'](),_0x407a4b(_0x5aba78(0xa0e)),_0x59bf0f();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x8d0))['addEventListener'](_0xc64c06(0x740),()=>_0x407a4b(_0xc64c06(0xeb0))),document[_0xc64c06(0x1f4)](_0xc64c06(0x946))['addEventListener'](_0xc64c06(0x740),async()=>{const _0x669ab4=_0xc64c06,_0x558d9b=document[_0x669ab4(0x1f4)]('countdown-title-input')[_0x669ab4(0x107e)][_0x669ab4(0x4a2)](),_0x458788=document[_0x669ab4(0x1f4)](_0x669ab4(0xa03))[_0x669ab4(0x107e)];if(!_0x558d9b||!_0x458788){alert(_0x669ab4(0xbdd));return;}const _0x582a76=new Date(_0x458788);if(isNaN(_0x582a76)||_0x582a76<=new Date()){alert(_0x669ab4(0x125f));return;}const _0x304c8a={'authorId':_0x669ab4(0x860),'description':_0x558d9b,'timestamp':Date[_0x669ab4(0xd6e)](),'type':'countdown','targetDate':_0x582a76[_0x669ab4(0x457)]()};await _0x3df81a['memories'][_0x669ab4(0x6a4)](_0x304c8a),document[_0x669ab4(0x1f4)](_0x669ab4(0x15c8))[_0x669ab4(0x159b)][_0x669ab4(0xa9c)](_0x669ab4(0xfca)),_0x59bf0f();}),document[_0xc64c06(0x1f4)]('block-chat-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x486ce6=_0xc64c06;if(!_0x1ae02e[_0x486ce6(0x588)]||_0x1ae02e[_0x486ce6(0x589)][_0x1ae02e['activeChatId']][_0x486ce6(0xe83)])return;const _0x402995=_0x1ae02e[_0x486ce6(0x589)][_0x1ae02e[_0x486ce6(0x588)]],_0x3c58f3=await _0x109970('确认拉黑','确定要拉黑“'+_0x402995[_0x486ce6(0x5d2)]+_0x486ce6(0x518),{'confirmButtonClass':_0x486ce6(0x1c6)});if(_0x3c58f3){_0x402995[_0x486ce6(0x13ab)][_0x486ce6(0x1589)]=_0x486ce6(0x14e6),_0x402995[_0x486ce6(0x13ab)][_0x486ce6(0x139b)]=Date[_0x486ce6(0xd6e)]();const _0xfd09be={'role':_0x486ce6(0x1594),'content':_0x486ce6(0xe11),'timestamp':Date[_0x486ce6(0xd6e)]()+0x1,'isHidden':!![]};_0x402995['history'][_0x486ce6(0x1426)](_0xfd09be),await _0x3df81a['chats'][_0x486ce6(0x295)](_0x402995),document[_0x486ce6(0x1f4)](_0x486ce6(0xccd))[_0x486ce6(0x159b)]['remove'](_0x486ce6(0xfca)),_0x3689f0(_0x1ae02e['activeChatId']),_0x1033ae();}}),document['getElementById']('chat-lock-overlay')[_0xc64c06(0x122b)](_0xc64c06(0x740),async _0x2c314e=>{const _0x577e69=_0xc64c06,_0x12969b=_0x1ae02e['chats'][_0x1ae02e[_0x577e69(0x588)]];if(!_0x12969b)return;if(_0x2c314e['target']['id']===_0x577e69(0xdf1)){alert(_0x577e69(0x1079)),await _0x31f1ac(_0x12969b['id']),_0x3689f0(_0x12969b['id']);return;}if(_0x2c314e[_0x577e69(0xb57)]['id']==='unblock-btn'){_0x12969b[_0x577e69(0x13ab)]['status']='friend',_0x12969b[_0x577e69(0x13ab)]['blockedTimestamp']=null;const _0xeedd59={'role':_0x577e69(0x1594),'content':_0x577e69(0x15a7),'timestamp':Date['now'](),'isHidden':!![]};_0x12969b[_0x577e69(0xce3)][_0x577e69(0x1426)](_0xeedd59),await _0x3df81a[_0x577e69(0x589)][_0x577e69(0x295)](_0x12969b),_0x3689f0(_0x12969b['id']),_0x1033ae(),_0x5626da();}else{if(_0x2c314e[_0x577e69(0xb57)]['id']===_0x577e69(0x14a0)){_0x12969b['relationship'][_0x577e69(0x1589)]=_0x577e69(0xfe3),_0x12969b['relationship']['applicationReason']='';const _0x35bca7={'role':_0x577e69(0x1594),'type':_0x577e69(0x1454),'content':_0x577e69(0x29d)+_0x12969b[_0x577e69(0x5d2)]+_0x577e69(0xe66),'timestamp':Date[_0x577e69(0xd6e)]()};_0x12969b[_0x577e69(0xce3)][_0x577e69(0x1426)](_0x35bca7);const _0x4c2850={'role':_0x577e69(0x13c0),'senderName':_0x12969b[_0x577e69(0x5d2)],'content':'太好了！我们又可以聊天啦！','timestamp':Date['now']()+0x1};_0x12969b['history']['push'](_0x4c2850),await _0x3df81a[_0x577e69(0x589)][_0x577e69(0x295)](_0x12969b),_0x3689f0(_0x12969b['id']),_0x1033ae();}else{if(_0x2c314e[_0x577e69(0xb57)]['id']===_0x577e69(0x5a6))_0x12969b[_0x577e69(0x13ab)][_0x577e69(0x1589)]=_0x577e69(0x14e6),_0x12969b[_0x577e69(0x13ab)][_0x577e69(0x139b)]=Date['now'](),_0x12969b[_0x577e69(0x13ab)]['applicationReason']='',await _0x3df81a[_0x577e69(0x589)][_0x577e69(0x295)](_0x12969b),_0x3689f0(_0x12969b['id']);else{if(_0x2c314e[_0x577e69(0xb57)]['id']===_0x577e69(0xbd4)){const _0x3da8b4=await _0x11f6fb(_0x577e69(0x76e),_0x577e69(0x577)+_0x12969b[_0x577e69(0x5d2)]+_0x577e69(0xfae),_0x577e69(0x5b3));_0x3da8b4!==null&&(_0x12969b[_0x577e69(0x13ab)][_0x577e69(0x1589)]='pending_ai_approval',_0x12969b[_0x577e69(0x13ab)][_0x577e69(0x8dd)]=_0x3da8b4,await _0x3df81a['chats'][_0x577e69(0x295)](_0x12969b),_0x3689f0(_0x12969b['id']),_0x1033ae(),_0x5626da());}}}}}),document[_0xc64c06(0x1f4)](_0xc64c06(0xfe4))['addEventListener'](_0xc64c06(0x740),_0x418789),document[_0xc64c06(0x1f4)](_0xc64c06(0x4d7))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x5073d9=_0xc64c06;document[_0x5073d9(0x1f4)](_0x5073d9(0x29c))[_0x5073d9(0x159b)][_0x5073d9(0xa9c)](_0x5073d9(0xfca));}),document[_0xc64c06(0x1f4)]('send-group-packet-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x544651),document[_0xc64c06(0x1f4)]('send-direct-packet-btn')[_0xc64c06(0x122b)]('click',_0x2b3e39);const _0x475683=document['getElementById'](_0xc64c06(0xfb9)),_0x1f7fcc=document[_0xc64c06(0x1f4)](_0xc64c06(0x114e)),_0x3a92c1=document[_0xc64c06(0x1f4)](_0xc64c06(0x45e)),_0x1e50e3=document['getElementById'](_0xc64c06(0x893));_0x475683[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x509725=_0xc64c06;_0x475683[_0x509725(0x159b)][_0x509725(0x6a4)](_0x509725(0x7cf)),_0x1f7fcc[_0x509725(0x159b)]['remove'](_0x509725(0x7cf)),_0x3a92c1['style'][_0x509725(0x887)]=_0x509725(0x361),_0x1e50e3[_0x509725(0x215)][_0x509725(0x887)]=_0x509725(0x1b5);}),_0x1f7fcc[_0xc64c06(0x122b)]('click',()=>{const _0x279486=_0xc64c06;_0x1f7fcc[_0x279486(0x159b)]['add'](_0x279486(0x7cf)),_0x475683[_0x279486(0x159b)][_0x279486(0xa9c)](_0x279486(0x7cf)),_0x1e50e3['style'][_0x279486(0x887)]=_0x279486(0x361),_0x3a92c1[_0x279486(0x215)]['display']=_0x279486(0x1b5);}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1074))['addEventListener'](_0xc64c06(0x1557),_0x2c48b6=>{const _0x1e3896=_0xc64c06,_0x49f8e5=parseFloat(_0x2c48b6['target'][_0x1e3896(0x107e)])||0x0;document[_0x1e3896(0x1f4)](_0x1e3896(0x5a5))[_0x1e3896(0x231)]='¥\x20'+_0x49f8e5['toFixed'](0x2);}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1193))[_0xc64c06(0x122b)]('input',_0x4df112=>{const _0x22d00e=_0xc64c06,_0x87edf9=parseFloat(_0x4df112[_0x22d00e(0xb57)][_0x22d00e(0x107e)])||0x0;document[_0x22d00e(0x1f4)]('rp-direct-total')[_0x22d00e(0x231)]='¥\x20'+_0x87edf9[_0x22d00e(0x24f)](0x2);}),document[_0xc64c06(0x1f4)](_0xc64c06(0xd31))[_0xc64c06(0x122b)]('click',_0x513429=>{const _0x2a0174=_0xc64c06,_0x376e7e=_0x513429[_0x2a0174(0xb57)][_0x2a0174(0x96a)]('.red-packet-card');if(!_0x376e7e)return;const _0x526ef6=_0x376e7e[_0x2a0174(0x96a)](_0x2a0174(0x251));if(!_0x526ef6||!_0x526ef6['dataset']['timestamp'])return;const _0x3a27fe=parseInt(_0x526ef6[_0x2a0174(0x746)][_0x2a0174(0x1388)]);_0x528a5e(_0x3a27fe);}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1536))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x200590),document['getElementById'](_0xc64c06(0x1462))[_0xc64c06(0x122b)]('click',_0x16add4),document[_0xc64c06(0x1f4)](_0xc64c06(0x54c))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x4c5807=_0xc64c06;document[_0x4c5807(0x1f4)]('create-poll-modal')['classList'][_0x4c5807(0xa9c)]('visible');}),document['getElementById'](_0xc64c06(0x974))['addEventListener'](_0xc64c06(0x740),_0x1ea708),document[_0xc64c06(0x1f4)](_0xc64c06(0xd31))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x4e6201=>{const _0x321d82=_0xc64c06,_0x372f70=_0x4e6201[_0x321d82(0xb57)][_0x321d82(0x96a)](_0x321d82(0x1070));if(!_0x372f70)return;const _0x58d7de=parseInt(_0x372f70[_0x321d82(0x746)][_0x321d82(0x148a)]);if(isNaN(_0x58d7de))return;const _0x206002=_0x4e6201[_0x321d82(0xb57)][_0x321d82(0x96a)](_0x321d82(0xd65));if(_0x206002&&!_0x372f70['classList']['contains']('closed')){_0x2b9da2(_0x58d7de,_0x206002[_0x321d82(0x746)][_0x321d82(0x10bb)]);return;}const _0x46aa08=_0x4e6201[_0x321d82(0xb57)][_0x321d82(0x96a)]('.poll-action-btn');if(_0x46aa08){_0x372f70['classList'][_0x321d82(0xaea)](_0x321d82(0xd87))?_0x55b32a(_0x58d7de):_0x16b605(_0x58d7de);return;}_0x372f70[_0x321d82(0x159b)][_0x321d82(0xaea)](_0x321d82(0xd87))&&_0x55b32a(_0x58d7de);}),document[_0xc64c06(0x1f4)]('manage-ai-avatar-library-btn')[_0xc64c06(0x122b)]('click',_0x3dcc29),document[_0xc64c06(0x1f4)]('add-ai-avatar-batch-btn')[_0xc64c06(0x122b)]('click',()=>_0x4b6e2b('ai')),document[_0xc64c06(0x1f4)]('add-group-avatar-batch-btn')[_0xc64c06(0x122b)]('click',()=>_0x4b6e2b(_0xc64c06(0x678))),document['getElementById']('add-ai-avatar-url-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x51f4e2),document['getElementById'](_0xc64c06(0x1509))['addEventListener'](_0xc64c06(0x740),()=>{const _0x5b74a2=_0xc64c06;document['getElementById']('ai-avatar-upload-input')[_0x5b74a2(0x740)]();}),document[_0xc64c06(0x1f4)](_0xc64c06(0xe91))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x5727a7),document[_0xc64c06(0x1f4)](_0xc64c06(0x10b0))[_0xc64c06(0x122b)]('click',_0x1c418f),document[_0xc64c06(0x1f4)](_0xc64c06(0x7e3))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x402168),document['getElementById']('add-group-avatar-url-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x522d1a),document['getElementById'](_0xc64c06(0x123a))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x951344=_0xc64c06;document['getElementById'](_0x951344(0xb52))[_0x951344(0x740)]();}),document[_0xc64c06(0x1f4)](_0xc64c06(0xb52))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x211d9f),document[_0xc64c06(0x1f4)]('close-group-avatar-library-btn')[_0xc64c06(0x122b)]('click',_0x189c79),document[_0xc64c06(0x1f4)](_0xc64c06(0x907))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x2824ee=>{const _0x16c0bc=_0xc64c06;if(_0x2824ee[_0x16c0bc(0xb57)]['classList'][_0x16c0bc(0xaea)](_0x16c0bc(0xa1f))){const _0x48f123=_0x2824ee[_0x16c0bc(0xb57)][_0x16c0bc(0x96a)](_0x16c0bc(0x1310)),_0xa80552=_0x48f123[_0x16c0bc(0x746)]['iconId'];_0xa80552&&_0x4ed932(_0xa80552,'ephone',_0x48f123);}}),document[_0xc64c06(0x1f4)](_0xc64c06(0xd31))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x4d147a=>{const _0x4d146c=_0xc64c06,_0x52b07a=_0x4d147a[_0x4d146c(0xb57)][_0x4d146c(0x96a)](_0x4d146c(0x13bf));if(_0x52b07a){const _0x43f17d=parseInt(_0x52b07a['dataset']['timestamp']);!isNaN(_0x43f17d)&&_0x1343e4(_0x43f17d);}}),document[_0xc64c06(0x1f4)]('browser-back-btn')['addEventListener']('click',()=>{const _0x10ef56=_0xc64c06;_0x2e53fa(_0x10ef56(0x13c3));}),_0x4d11d5[_0xc64c06(0x1225)]['addEventListener'](_0xc64c06(0x740),async _0x237886=>{const _0x4da880=_0xc64c06,_0x3035b3=_0x237886[_0x4da880(0xb57)][_0x4da880(0x96a)](_0x4da880(0x132e));if(_0x3035b3&&_0x4d11d5[_0x4da880(0x15bf)]!==null){const _0xd99987=_0x3035b3[_0x4da880(0x215)][_0x4da880(0xf98)][_0x4da880(0x5cc)](0x5,-0x2),_0x5d90f1=_0x1ae02e['userStickers'][_0x4da880(0x13b7)](_0x3e08ec=>_0x3e08ec[_0x4da880(0x258)]===_0xd99987);_0x5d90f1?await _0x4bb4d4(_0x4d11d5[_0x4da880(0x15bf)],_0x5d90f1):console[_0x4da880(0xb3b)](_0x4da880(0xc88),_0xd99987);}}),document[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x58b3fe=>{const _0xa73ff9=_0xc64c06;_0x4d11d5[_0xa73ff9(0x491)]&&!_0x4d11d5[_0xa73ff9(0x1225)]['contains'](_0x58b3fe['target'])&&!_0x58b3fe[_0xa73ff9(0xb57)][_0xa73ff9(0x96a)](_0xa73ff9(0x10b4))&&_0x42ac48();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x5be))['addEventListener']('click',_0x55ba1c),document['getElementById'](_0xc64c06(0x13c4))['addEventListener'](_0xc64c06(0x740),()=>{const _0x33b5b1=_0xc64c06;document[_0x33b5b1(0x1f4)](_0x33b5b1(0xc74))[_0x33b5b1(0x159b)]['remove'](_0x33b5b1(0xfca));}),document['getElementById'](_0xc64c06(0x38b))['addEventListener'](_0xc64c06(0x740),_0x166ab6),document['getElementById'](_0xc64c06(0x103b))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x3661c1),document[_0xc64c06(0x1f4)](_0xc64c06(0x9a7))['addEventListener']('change',_0x757f92=>{const _0x12f08f=_0xc64c06;_0xf32df4(_0x757f92[_0x12f08f(0xb57)][_0x12f08f(0xe56)]);}),document[_0xc64c06(0x1f4)](_0xc64c06(0x9c6))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x4ab60a=>{const _0x20eb20=_0xc64c06;_0x4de72f(_0x4ab60a['target'][_0x20eb20(0xe56)]);}),document[_0xc64c06(0x1f4)]('share-location-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x1fcca0),document[_0xc64c06(0x1f4)](_0xc64c06(0x10f4))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0xca395b),document['getElementById'](_0xc64c06(0x64c))['addEventListener']('click',()=>{const _0x82b6c4=_0xc64c06;_0x2e53fa(_0x82b6c4(0x133d));}),document['getElementById'](_0xc64c06(0x815))[_0xc64c06(0x122b)]('click',_0x5e7332=>{const _0x1a9a7a=_0xc64c06,_0x203cb0=_0x5e7332[_0x1a9a7a(0xb57)][_0x1a9a7a(0x96a)]('.call-record-card');_0x203cb0&&_0x203cb0[_0x1a9a7a(0x746)][_0x1a9a7a(0x1172)]&&_0x205cfe(parseInt(_0x203cb0['dataset'][_0x1a9a7a(0x1172)]));}),document['getElementById'](_0xc64c06(0xa94))['addEventListener'](_0xc64c06(0x740),()=>{const _0x5c0b62=_0xc64c06;document['getElementById']('call-transcript-modal')[_0x5c0b62(0x159b)][_0x5c0b62(0xa9c)](_0x5c0b62(0xfca));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x145b))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x1c12b7),document['getElementById'](_0xc64c06(0x41e))[_0xc64c06(0x122b)]('click',()=>{const _0x268140=_0xc64c06;_0xc320bf[_0x268140(0xb51)]>0x0&&_0x24db97();}),document[_0xc64c06(0x1f4)]('selection-screenshot-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0xeecd32),document[_0xc64c06(0x1f4)]('confirm-share-target-btn')['addEventListener'](_0xc64c06(0x740),async()=>{const _0x74caf2=_0xc64c06,_0x173677=_0x1ae02e[_0x74caf2(0x589)][_0x1ae02e[_0x74caf2(0x588)]],_0x5ab0bf=Array[_0x74caf2(0xa81)](document['querySelectorAll'](_0x74caf2(0x43f)))['map'](_0x101565=>_0x101565[_0x74caf2(0x746)][_0x74caf2(0x3e0)]);if(_0x5ab0bf['length']===0x0){alert(_0x74caf2(0x82c));return;}const _0x115123=[],_0x41a82e=[..._0xc320bf]['sort']((_0x99ced2,_0x370954)=>_0x99ced2-_0x370954);for(const _0x4d2c2a of _0x41a82e){const _0x3fb00=_0x173677[_0x74caf2(0xce3)]['find'](_0x508d29=>_0x508d29[_0x74caf2(0x1388)]===_0x4d2c2a);_0x3fb00&&_0x115123[_0x74caf2(0x1426)](_0x3fb00);}const _0x3ca937={'role':_0x74caf2(0x860),'senderName':_0x173677['isGroup']?_0x173677[_0x74caf2(0x6a8)][_0x74caf2(0xe31)]||'我':'我','type':_0x74caf2(0x804),'timestamp':Date[_0x74caf2(0xd6e)](),'payload':{'sourceChatName':_0x173677[_0x74caf2(0x5d2)],'title':_0x74caf2(0xd1e)+_0x173677[_0x74caf2(0x5d2)]+_0x74caf2(0x1596),'sharedHistory':_0x115123}};for(const _0x59fe4e of _0x5ab0bf){const _0x2c2725=_0x1ae02e[_0x74caf2(0x589)][_0x59fe4e];_0x2c2725&&(_0x2c2725['history'][_0x74caf2(0x1426)](_0x3ca937),await _0x3df81a[_0x74caf2(0x589)][_0x74caf2(0x295)](_0x2c2725));}document[_0x74caf2(0x1f4)]('share-target-modal')['classList'][_0x74caf2(0xa9c)]('visible'),_0x527427(),await _0x1460c5('分享成功',_0x74caf2(0x60a)+_0x5ab0bf['length']+_0x74caf2(0x506)),_0x1033ae();}),document['getElementById']('cancel-share-target-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x5da623=_0xc64c06;document[_0x5da623(0x1f4)]('share-target-modal')[_0x5da623(0x159b)][_0x5da623(0xa9c)](_0x5da623(0xfca));}),document['getElementById'](_0xc64c06(0xd31))['addEventListener'](_0xc64c06(0x740),_0x4be5cb=>{const _0x569741=_0xc64c06,_0x281f62=_0x4be5cb[_0x569741(0xb57)]['closest']('.link-share-card[data-timestamp]');if(_0x281f62&&_0x281f62[_0x569741(0x96a)](_0x569741(0x139f))){const _0x533308=parseInt(_0x281f62['dataset'][_0x569741(0x1388)]);_0x2c2d06(_0x533308);}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x4d6))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x320271=_0xc64c06;document[_0x320271(0x1f4)]('shared-history-viewer-modal')['classList']['remove'](_0x320271(0xfca));});async function _0x2c2d06(_0xbe7810){const _0x5bf6a5=_0xc64c06,_0x7ec810=_0x1ae02e['chats'][_0x1ae02e['activeChatId']];if(!_0x7ec810)return;const _0x3a7ee3=_0x7ec810[_0x5bf6a5(0xce3)][_0x5bf6a5(0x13b7)](_0x5f07a6=>_0x5f07a6[_0x5bf6a5(0x1388)]===_0xbe7810);if(!_0x3a7ee3){console[_0x5bf6a5(0x127d)](_0x5bf6a5(0x1114),_0xbe7810),await _0x1460c5(_0x5bf6a5(0x133b),_0x5bf6a5(0x970));return;}if(_0x3a7ee3[_0x5bf6a5(0xcbd)]==='share_link'){_0x1343e4(_0xbe7810);return;}if(_0x3a7ee3[_0x5bf6a5(0xcbd)]===_0x5bf6a5(0x804)){if(!_0x3a7ee3['payload']||!_0x3a7ee3[_0x5bf6a5(0x487)]['sharedHistory']){console['error']('聊天记录分享卡片数据损坏:',_0x3a7ee3),await _0x1460c5(_0x5bf6a5(0x133b),_0x5bf6a5(0x673));return;}}else{console[_0x5bf6a5(0x127d)](_0x5bf6a5(0x409),_0x3a7ee3[_0x5bf6a5(0xcbd)]),await _0x1460c5('查看失败','不支持的分享类型。');return;}const _0x4f5bc9=document['getElementById'](_0x5bf6a5(0x8eb)),_0x302952=document['getElementById'](_0x5bf6a5(0x6a7)),_0x41d738=document[_0x5bf6a5(0x1f4)](_0x5bf6a5(0x687));_0x302952[_0x5bf6a5(0x231)]=_0x3a7ee3['payload'][_0x5bf6a5(0x156f)],_0x41d738[_0x5bf6a5(0xf21)]='';const _0x98d50a=document[_0x5bf6a5(0xd5c)](),_0x55f2ce=Object[_0x5bf6a5(0x753)](_0x1ae02e[_0x5bf6a5(0x589)])[_0x5bf6a5(0x13b7)](_0x56bacb=>_0x56bacb[_0x5bf6a5(0x5d2)]===_0x3a7ee3[_0x5bf6a5(0x487)][_0x5bf6a5(0xdeb)])||_0x7ec810;for(const _0x51256e of _0x3a7ee3['payload'][_0x5bf6a5(0xe15)]){const _0x3054af=await _0x1c1dfa(_0x51256e,_0x55f2ce);_0x3054af&&_0x98d50a[_0x5bf6a5(0x6ce)](_0x3054af);}_0x41d738[_0x5bf6a5(0x6ce)](_0x98d50a),_0x4f5bc9[_0x5bf6a5(0x159b)][_0x5bf6a5(0x6a4)](_0x5bf6a5(0xfca));}_0x43beab[_0xc64c06(0x122b)](_0xc64c06(0xe8e),_0x39fb09),_0x43beab['addEventListener'](_0xc64c06(0x352),()=>{const _0x3f3711=_0xc64c06;_0x5419de[_0x3f3711(0xd51)]&&(_0x5419de[_0x3f3711(0x14ce)]=![],phoneScreenForIsland[_0x3f3711(0x159b)]['remove']('dynamic-island-active'),_0x5d7946());}),_0x43beab['addEventListener'](_0xc64c06(0x9ab),()=>{const _0x3f99fa=_0xc64c06;_0x5419de[_0x3f99fa(0xd51)]&&(_0x5419de[_0x3f99fa(0x14ce)]=!![],_0x5d7946());}),document[_0xc64c06(0x1f4)](_0xc64c06(0x28c))[_0xc64c06(0x122b)](_0xc64c06(0x740),async _0x140dcb=>{const _0x24fd06=_0xc64c06,_0x2e9016=_0x140dcb[_0x24fd06(0xb57)],_0x50dba7=_0x2e9016[_0x24fd06(0x96a)]('.album-art-btn');if(_0x50dba7){const _0x431611=parseInt(_0x50dba7['dataset']['index']);!isNaN(_0x431611)&&await _0x188dd6(_0x431611);return;}const _0x303ab8=_0x2e9016[_0x24fd06(0x96a)](_0x24fd06(0x628));if(_0x303ab8){const _0x55eae9=parseInt(_0x303ab8[_0x24fd06(0x746)][_0x24fd06(0x10ba)]);if(isNaN(_0x55eae9))return;await _0x192e7a(_0x55eae9);return;}const _0x56f141=_0x2e9016[_0x24fd06(0x96a)]('.delete-track-btn');if(_0x56f141){const _0x29be47=parseInt(_0x56f141[_0x24fd06(0x746)][_0x24fd06(0x10ba)]);if(isNaN(_0x29be47))return;const _0x2f3c64=_0x5419de[_0x24fd06(0x560)][_0x29be47],_0x3b3a57=await _0x109970(_0x24fd06(0xc5c),'确定要从播放列表中删除《'+_0x2f3c64['name']+'》吗？');_0x3b3a57&&_0x352267(_0x29be47);return;}const _0x1280e3=_0x2e9016[_0x24fd06(0x96a)](_0x24fd06(0xb0e));if(_0x1280e3){const _0x43a3d8=_0x1280e3['closest'](_0x24fd06(0x9b0)),_0x304537=Array[_0x24fd06(0xa81)](_0x43a3d8['parentElement'][_0x24fd06(0x1390)])['indexOf'](_0x43a3d8);_0x304537>-0x1&&_0x5c1930(_0x304537);}}),document[_0xc64c06(0xeda)](_0xc64c06(0x6c5))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x215bb9=>{const _0x4f6247=_0xc64c06;if(!_0x43beab['duration'])return;const _0xd92af1=_0x215bb9[_0x4f6247(0x6c1)],_0x265f0e=_0xd92af1['clientWidth'],_0x45a367=_0x215bb9[_0x4f6247(0x553)];_0x43beab['currentTime']=_0x45a367/_0x265f0e*_0x43beab[_0x4f6247(0x15b4)];}),document[_0xc64c06(0x1f4)]('chat-messages')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x40e775=>{const _0x3b8a76=_0xc64c06,_0x552e08=_0x40e775[_0x3b8a76(0xb57)][_0x3b8a76(0x96a)]('.recalled-message-placeholder');if(_0x552e08){const _0x32fb06=_0x1ae02e['chats'][_0x1ae02e[_0x3b8a76(0x588)]],_0x419e39=_0x552e08[_0x3b8a76(0x96a)](_0x3b8a76(0x711));if(_0x32fb06&&_0x419e39){const _0x4214a7=parseInt(_0x419e39[_0x3b8a76(0x746)][_0x3b8a76(0x1388)]),_0x4908ac=_0x32fb06[_0x3b8a76(0xce3)]['find'](_0x741fa5=>_0x741fa5[_0x3b8a76(0x1388)]===_0x4214a7);if(_0x4908ac&&_0x4908ac[_0x3b8a76(0x849)]){let _0x523e4a='';const _0x29f58b=_0x4908ac[_0x3b8a76(0x849)];switch(_0x29f58b[_0x3b8a76(0xf8c)]){case _0x3b8a76(0x40f):_0x523e4a=_0x3b8a76(0xb8d)+_0x29f58b[_0x3b8a76(0xb2f)]+'\x22';break;case _0x3b8a76(0xe86):case _0x3b8a76(0xce9):case _0x3b8a76(0x10ea):_0x523e4a='[图片/文字图]\x20描述:\x20\x22'+_0x29f58b[_0x3b8a76(0xb2f)]+'\x22';break;case _0x3b8a76(0xd83):_0x523e4a='[语音]\x20内容:\x20\x22'+_0x29f58b[_0x3b8a76(0xb2f)]+'\x22';break;case _0x3b8a76(0x1b3):_0x523e4a=_0x3b8a76(0x10f7)+(_0x29f58b[_0x3b8a76(0x9f1)]||_0x3b8a76(0x8ab))+_0x3b8a76(0xde0)+_0x29f58b[_0x3b8a76(0xb2f)];break;case _0x3b8a76(0x904):_0x523e4a='一条[转账]消息已被撤回。';break;default:_0x523e4a='撤回了一条['+_0x29f58b['originalType']+_0x3b8a76(0x4ab)+JSON['stringify'](_0x29f58b[_0x3b8a76(0xb2f)]);break;}_0x1460c5(_0x3b8a76(0x1299),_0x523e4a);}}}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x2b0))[_0xc64c06(0x122b)]('click',_0x23bc2e),document[_0xc64c06(0x1f4)](_0xc64c06(0x9b5))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x48dd40=_0xc64c06;document[_0x48dd40(0x1f4)]('world-book-category-manager-modal')['classList']['remove']('visible'),_0x23735f();}),document[_0xc64c06(0x1f4)]('add-new-category-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x59b9af),document[_0xc64c06(0x1f4)](_0xc64c06(0xb6c))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x541239=>{const _0x17783d=_0xc64c06;if(_0x541239[_0x17783d(0xb57)]['classList']['contains'](_0x17783d(0x2f5))){const _0x44ed99=parseInt(_0x541239[_0x17783d(0xb57)][_0x17783d(0x746)]['id']);_0x209650(_0x44ed99);}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x585))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x1b9e3f),document[_0xc64c06(0x1f4)]('repost-confirm-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x2d229f),document['getElementById']('quote-message-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x547958),document['getElementById']('cancel-reply-btn')[_0xc64c06(0x122b)]('click',_0x47891a),document[_0xc64c06(0x1f4)](_0xc64c06(0x53c))[_0xc64c06(0x122b)](_0xc64c06(0x1557),_0x5ef236=>{const _0x491681=_0xc64c06;if(!_0x5ef236[_0x491681(0xb57)][_0x491681(0xfcc)](_0x491681(0x9e4)))return;const _0x3e28de=_0x5ef236[_0x491681(0xb57)],_0x4a13ce=_0x3e28de[_0x491681(0x96a)]('.qzone-post-container');if(!_0x4a13ce)return;const _0x493102=_0x4a13ce[_0x491681(0xeda)](_0x491681(0xae4)),_0x49c83f=_0x3e28de[_0x491681(0x107e)],_0x1228ec=_0x49c83f[_0x491681(0xba5)](/@([\p{L}\w]*)$/u);if(_0x1228ec){const _0x2e3569=new Set(),_0x4eb213=_0x4a13ce[_0x491681(0xeda)](_0x491681(0xbb7))?.['textContent'];if(_0x4eb213)_0x2e3569['add'](_0x4eb213);_0x4a13ce['querySelectorAll']('.commenter-name')[_0x491681(0x59b)](_0x524163=>{const _0x2511f8=_0x491681;_0x2e3569[_0x2511f8(0x6a4)](_0x524163[_0x2511f8(0x231)][_0x2511f8(0xef0)](':',''));}),_0x2e3569[_0x491681(0xc40)](_0x1ae02e[_0x491681(0x11ef)][_0x491681(0xb46)]),_0x493102[_0x491681(0xf21)]='';if(_0x2e3569[_0x491681(0xb51)]>0x0){const _0x11adba=_0x1228ec[0x1];_0x2e3569[_0x491681(0x59b)](_0x139ad7=>{const _0x33c5db=_0x491681;if(_0x139ad7[_0x33c5db(0x1f7)]()[_0x33c5db(0xe82)](_0x11adba[_0x33c5db(0x1f7)]())){const _0x686602=document[_0x33c5db(0x219)](_0x33c5db(0xaf9));_0x686602['className']=_0x33c5db(0x6cf),_0x686602[_0x33c5db(0x231)]=_0x139ad7,_0x686602[_0x33c5db(0x122b)]('mousedown',_0xac765d=>{const _0x5e533c=_0x33c5db;_0xac765d['preventDefault']();const _0x5f32db=_0x49c83f['substring'](0x0,_0x1228ec['index'])+('@'+_0x139ad7+'\x20');_0x3e28de[_0x5e533c(0x107e)]=_0x5f32db,_0x493102['style'][_0x5e533c(0x887)]='none',_0x3e28de[_0x5e533c(0xed2)]();}),_0x493102[_0x33c5db(0x6ce)](_0x686602);}}),_0x493102['style'][_0x491681(0x887)]=_0x493102['children'][_0x491681(0x58a)]>0x0?_0x491681(0x361):'none';}else _0x493102['style'][_0x491681(0x887)]=_0x491681(0x1b5);}else _0x493102[_0x491681(0x215)][_0x491681(0x887)]=_0x491681(0x1b5);}),document[_0xc64c06(0x1f4)](_0xc64c06(0x53c))[_0xc64c06(0x122b)](_0xc64c06(0xb60),_0xaf6fcd=>{const _0x4bc780=_0xc64c06;if(_0xaf6fcd['target'][_0x4bc780(0xfcc)](_0x4bc780(0x9e4))){const _0x26acea=_0xaf6fcd[_0x4bc780(0xb57)][_0x4bc780(0x96a)](_0x4bc780(0x104c));if(_0x26acea){const _0x24d7e5=_0x26acea[_0x4bc780(0xeda)](_0x4bc780(0xae4));_0x24d7e5&&setTimeout(()=>{const _0x51bc13=_0x4bc780;_0x24d7e5[_0x51bc13(0x215)][_0x51bc13(0x887)]=_0x51bc13(0x1b5);},0xc8);}}});const _0x2a17fb=document['getElementById'](_0xc64c06(0x3e7)),_0x3d1b82=document[_0xc64c06(0x1f4)](_0xc64c06(0x19d));_0x2a17fb['addEventListener']('input',()=>{const _0x1416b9=_0xc64c06;if(!_0x1ae02e[_0x1416b9(0x588)]||!_0x1ae02e[_0x1416b9(0x589)][_0x1ae02e['activeChatId']][_0x1416b9(0xe83)]){_0x3d1b82[_0x1416b9(0x215)][_0x1416b9(0x887)]='none';return;}const _0x2f331b=_0x1ae02e[_0x1416b9(0x589)][_0x1ae02e[_0x1416b9(0x588)]],_0x319048=_0x2a17fb[_0x1416b9(0x107e)],_0x303fb0=_0x319048[_0x1416b9(0xba5)](/@([\p{L}\w]*)$/u);if(_0x303fb0){const _0x5bfd09=_0x2f331b[_0x1416b9(0x6a8)]['myNickname']||'我',_0x13de48=_0x2f331b[_0x1416b9(0x1402)][_0x1416b9(0x1431)](_0x1b8720=>_0x1b8720[_0x1416b9(0xd69)])[_0x1416b9(0xede)](_0x7cfb57=>_0x7cfb57!==_0x5bfd09);_0x3d1b82[_0x1416b9(0xf21)]='';if(_0x13de48[_0x1416b9(0x58a)]>0x0){const _0x31cc48=_0x303fb0[0x1];_0x13de48[_0x1416b9(0x59b)](_0x40db13=>{const _0x26518f=_0x1416b9;if(_0x40db13[_0x26518f(0x1f7)]()[_0x26518f(0xe82)](_0x31cc48[_0x26518f(0x1f7)]())){const _0x2e312e=document['createElement'](_0x26518f(0xaf9));_0x2e312e['className']=_0x26518f(0x6cf),_0x2e312e[_0x26518f(0x231)]=_0x40db13,_0x2e312e[_0x26518f(0x122b)](_0x26518f(0x103d),_0x5266f6=>{const _0x2da014=_0x26518f;_0x5266f6['preventDefault']();const _0x9c0c3b=_0x319048[_0x2da014(0x516)](0x0,_0x303fb0[_0x2da014(0x10ba)])+('@'+_0x40db13+'\x20');_0x2a17fb[_0x2da014(0x107e)]=_0x9c0c3b,_0x3d1b82[_0x2da014(0x215)]['display']=_0x2da014(0x1b5),_0x2a17fb[_0x2da014(0xed2)]();}),_0x3d1b82[_0x26518f(0x6ce)](_0x2e312e);}}),_0x3d1b82['style'][_0x1416b9(0x887)]=_0x3d1b82[_0x1416b9(0x1390)][_0x1416b9(0x58a)]>0x0?'block':'none';}else _0x3d1b82[_0x1416b9(0x215)]['display']=_0x1416b9(0x1b5);}else _0x3d1b82[_0x1416b9(0x215)][_0x1416b9(0x887)]=_0x1416b9(0x1b5);}),_0x2a17fb['addEventListener'](_0xc64c06(0x941),()=>{setTimeout(()=>{const _0x561367=_0x475c;_0x3d1b82[_0x561367(0x215)]['display']='none';},0xc8);}),document[_0xc64c06(0x1f4)](_0xc64c06(0xfdd))[_0xc64c06(0x122b)]('click',_0x497f93),document['getElementById']('show-announcement-board-btn')['addEventListener'](_0xc64c06(0x740),_0x2404ac),document[_0xc64c06(0x1f4)]('close-announcement-board-btn')['addEventListener'](_0xc64c06(0x740),()=>{const _0xe56a85=_0xc64c06;document['getElementById'](_0xe56a85(0x14ab))['classList'][_0xe56a85(0xa9c)](_0xe56a85(0xfca));}),document[_0xc64c06(0x1f4)]('announcement-board-content')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x419eea=>{const _0x40883c=_0xc64c06;if(_0x419eea[_0x40883c(0xb57)][_0x40883c(0x159b)][_0x40883c(0xaea)](_0x40883c(0x14fc))){const _0x19c9d6=_0x419eea['target'][_0x40883c(0x746)][_0x40883c(0x909)];_0x19c9d6&&_0x3b2afa(_0x19c9d6);}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1121))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x1b7f38),document[_0xc64c06(0x1f4)](_0xc64c06(0xac8))[_0xc64c06(0x122b)]('click',_0x35bdcd),document['getElementById'](_0xc64c06(0x4e7))[_0xc64c06(0x122b)]('click',()=>{const _0x1445dd=_0xc64c06;document[_0x1445dd(0x1f4)](_0x1445dd(0x1244))[_0x1445dd(0x159b)][_0x1445dd(0xa9c)](_0x1445dd(0xfca));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x14e5))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x6d688f=_0xc64c06;document['getElementById'](_0x6d688f(0x242))[_0x6d688f(0x107e)]='';}),document['getElementById'](_0xc64c06(0x56d))['addEventListener'](_0xc64c06(0x740),_0x537bdb),document['getElementById'](_0xc64c06(0x2e8))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x3b7a80=_0xc64c06;_0x2e53fa(_0x3b7a80(0x13c3));}),document[_0xc64c06(0x1f4)]('add-manual-memory-btn-header')['addEventListener']('click',_0x4a7290),document[_0xc64c06(0x1f4)](_0xc64c06(0xbaa))[_0xc64c06(0x122b)]('click',_0x66d2ab),document[_0xc64c06(0x1f4)](_0xc64c06(0xfe7))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x13b973=>{const _0xd2cca7=_0xc64c06,_0x3f9bd7=_0x13b973[_0xd2cca7(0xb57)][_0xd2cca7(0x96a)](_0xd2cca7(0x47d));if(_0x3f9bd7){_0x3f89fb(_0x3f9bd7['dataset'][_0xd2cca7(0x12cf)],parseInt(_0x3f9bd7['dataset'][_0xd2cca7(0x502)]));return;}const _0x3627ac=_0x13b973[_0xd2cca7(0xb57)][_0xd2cca7(0x96a)](_0xd2cca7(0xf29));if(_0x3627ac){_0x37aab4(_0x3627ac['dataset'][_0xd2cca7(0x12cf)],parseInt(_0x3627ac[_0xd2cca7(0x746)][_0xd2cca7(0x502)]));return;}}),document['getElementById']('gomoku-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x34d1db),document['getElementById']('close-gomoku-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x360542);const _0x354292=document[_0xc64c06(0x1f4)](_0xc64c06(0x19c));_0x354292[_0xc64c06(0x122b)]('mousemove',_0xd5621c),_0x354292[_0xc64c06(0x122b)](_0xc64c06(0xf68),()=>_0x3fb716(_0x1ae02e[_0xc64c06(0x588)])),_0x354292['addEventListener'](_0xc64c06(0x740),_0x13398a),document[_0xc64c06(0x1f4)](_0xc64c06(0xf63))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x9ea761=_0xc64c06;document[_0x9ea761(0x1f4)](_0x9ea761(0x1229))[_0x9ea761(0x107e)]='',document['getElementById'](_0x9ea761(0xa03))[_0x9ea761(0x107e)]='',document[_0x9ea761(0x1f4)](_0x9ea761(0x15c8))[_0x9ea761(0x159b)][_0x9ea761(0x6a4)](_0x9ea761(0xfca));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x107d))['addEventListener']('click',()=>{const _0x4d37cf=_0xc64c06;document[_0x4d37cf(0x1f4)]('create-countdown-modal')[_0x4d37cf(0x159b)][_0x4d37cf(0xa9c)]('visible');}),document[_0xc64c06(0x1f4)](_0xc64c06(0x3e9))[_0xc64c06(0x122b)]('click',_0x5491c4),document[_0xc64c06(0x1f4)]('delete-call-message-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x4a548e),document['getElementById'](_0xc64c06(0x59a))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x1af44f),document['getElementById']('edit-last-response-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x3b3797),document[_0xc64c06(0x1f4)]('cancel-ai-response-editor-btn')[_0xc64c06(0x122b)]('click',()=>{const _0x343c05=_0xc64c06;document['getElementById'](_0x343c05(0xbc2))[_0x343c05(0x159b)][_0x343c05(0xa9c)](_0x343c05(0xfca));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x9fb))['addEventListener'](_0xc64c06(0x740),_0x22d658),document[_0xc64c06(0x1f4)](_0xc64c06(0x110e))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0xbe3267=_0xc64c06,_0x53bf61=document[_0xbe3267(0x1f4)]('ai-response-editor-container'),_0x2275df=_0x19f2df('{\x0a\x20\x20\x22type\x22:\x20\x22text\x22,\x0a\x20\x20\x22content\x22:\x20\x22在这里输入新消息...\x22\x0a}');_0x53bf61[_0xbe3267(0x6ce)](_0x2275df),_0x2275df['querySelector']('textarea')[_0xbe3267(0xed2)]();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x2d9))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x4e5a6a),document[_0xc64c06(0x1f4)]('close-my-avatar-library-btn')[_0xc64c06(0x122b)]('click',_0x3ae5b2),document[_0xc64c06(0x1f4)](_0xc64c06(0xc4d))[_0xc64c06(0x122b)]('click',_0x2cf3e3),document[_0xc64c06(0x1f4)](_0xc64c06(0x15ae))[_0xc64c06(0x122b)]('click',()=>{const _0x3ac3b7=_0xc64c06;document['getElementById'](_0x3ac3b7(0x14c5))[_0x3ac3b7(0x740)]();}),document[_0xc64c06(0x1f4)]('my-avatar-upload-input')[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x45a9e6),document[_0xc64c06(0x1f4)]('add-my-avatar-batch-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x2ea9f0=_0xc64c06,_0x336350='请按照以下格式粘贴，一行一个：\x0a\x0a焦虑\x202a9wte.jpeg\x0a大惊失色\x20or8qf4.png\x0a没有灵感\x20njwujh.jpeg',_0x1c0871=await _0x11f6fb(_0x2ea9f0(0x793),_0x336350,'',_0x2ea9f0(0x1097));_0x1c0871&&_0x1c0871[_0x2ea9f0(0x4a2)]()&&await _0x1d39e5(_0x1c0871);}),document[_0xc64c06(0x1f4)]('open-shopping-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0xef4db1),document[_0xc64c06(0x1f4)](_0xc64c06(0x78b))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>_0x2e53fa('chat-interface-screen')),document['getElementById'](_0xc64c06(0x1349))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x4c7a32),document[_0xc64c06(0x1f4)](_0xc64c06(0x13ee))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0xef4db1),document['getElementById']('checkout-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x243414),document[_0xc64c06(0x1f4)](_0xc64c06(0xa3b))[_0xc64c06(0x122b)]('click',()=>{const _0xd7c394=_0xc64c06;document[_0xd7c394(0x1f4)](_0xd7c394(0x1a8))['classList'][_0xd7c394(0xa9c)](_0xd7c394(0xfca));}),document[_0xc64c06(0x1f4)](_0xc64c06(0xf78))['addEventListener'](_0xc64c06(0x740),()=>{const _0x7c4c07=_0xc64c06;_0x38b1ed=!_0x38b1ed;const _0x2673e6=document[_0x7c4c07(0x1f4)](_0x7c4c07(0xf78)),_0x19261e=document[_0x7c4c07(0x1f4)]('shopping-action-bar'),_0x321c4b=document['getElementById'](_0x7c4c07(0x7f8));_0x2673e6['style']['color']=_0x38b1ed?_0x7c4c07(0x12d4):_0x7c4c07(0x1a2),_0x38b1ed?(_0x19261e[_0x7c4c07(0x215)][_0x7c4c07(0x887)]=_0x7c4c07(0xeba),_0x321c4b[_0x7c4c07(0x215)][_0x7c4c07(0xbbc)]=_0x7c4c07(0xaa3)):(_0x19261e['style'][_0x7c4c07(0x887)]=_0x7c4c07(0x1b5),_0x321c4b['style'][_0x7c4c07(0xbbc)]='',_0x3f6e69[_0x7c4c07(0x411)](),document['querySelectorAll'](_0x7c4c07(0x230))[_0x7c4c07(0x59b)](_0x3c8fd7=>_0x3c8fd7['classList'][_0x7c4c07(0xa9c)](_0x7c4c07(0xc3e))),document[_0x7c4c07(0x1f4)](_0x7c4c07(0x91e))[_0x7c4c07(0x231)]=_0x7c4c07(0x58f),document[_0x7c4c07(0x1f4)]('select-all-products-checkbox')['checked']=![]),_0x4faebc(),_0x13c00e();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x85e))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{_0x38b1ed?_0x25b813(null):alert('请先点击扳手图标进入管理模式，才能添加新商品。');}),document[_0xc64c06(0x1f4)]('product-grid')[_0xc64c06(0x122b)](_0xc64c06(0x740),async _0xaeb7ff=>{const _0x21a640=_0xc64c06,_0x2f31c2=_0xaeb7ff[_0x21a640(0xb57)]['closest'](_0x21a640(0x4a1));if(!_0x2f31c2)return;const _0x4e7072=parseInt(_0x2f31c2[_0x21a640(0x746)]['id']);if(isNaN(_0x4e7072))return;if(_0x38b1ed){if(_0xaeb7ff[_0x21a640(0xb57)][_0x21a640(0x159b)][_0x21a640(0xaea)](_0x21a640(0x135f))){_0x25b813(_0x4e7072);return;}if(_0xaeb7ff[_0x21a640(0xb57)][_0x21a640(0x159b)]['contains'](_0x21a640(0xf51))){const _0x4d4f42=await _0x3df81a[_0x21a640(0xbf4)][_0x21a640(0x13f8)](_0x4e7072);if(!_0x4d4f42)return;const _0x4d37f3=await _0x109970(_0x21a640(0x1585),_0x21a640(0x326)+_0x4d4f42[_0x21a640(0x5d2)]+_0x21a640(0xbdf),{'confirmButtonClass':'btn-danger'});_0x4d37f3&&(await _0x3df81a[_0x21a640(0xbf4)][_0x21a640(0xc40)](_0x4e7072),await _0x4faebc(),alert('商品已删除。'));return;}_0x2f31c2['classList'][_0x21a640(0x1483)]('selected');_0x3f6e69[_0x21a640(0xe75)](_0x4e7072)?_0x3f6e69[_0x21a640(0xc40)](_0x4e7072):_0x3f6e69[_0x21a640(0x6a4)](_0x4e7072);document[_0x21a640(0x1f4)]('delete-selected-products-btn')[_0x21a640(0x231)]=_0x21a640(0x408)+_0x3f6e69[_0x21a640(0xb51)]+')';return;}if(_0xaeb7ff[_0x21a640(0xb57)][_0x21a640(0x159b)]['contains']('add-to-cart-btn')){const _0x105bb8=await _0x3df81a[_0x21a640(0xbf4)][_0x21a640(0x13f8)](_0x4e7072);_0x105bb8[_0x21a640(0x7ec)]&&_0x105bb8[_0x21a640(0x7ec)]['length']>0x0?_0x416bc9(_0x4e7072):(await _0x37f43c(_0x4e7072),await _0x1460c5('成功',_0x21a640(0x52b)));return;}_0x2f31c2[_0x21a640(0xaea)](_0xaeb7ff['target'])&&console[_0x21a640(0x57e)](_0x21a640(0x431)+_0x4e7072);}),document['getElementById'](_0xc64c06(0x224))['addEventListener']('click',_0x34ebee=>{const _0x3e3f30=_0xc64c06,_0x4a3da7=_0x34ebee[_0x3e3f30(0xb57)];_0x4a3da7[_0x3e3f30(0x159b)][_0x3e3f30(0xaea)](_0x3e3f30(0x12d1))&&_0x1adcd7(parseInt(_0x4a3da7[_0x3e3f30(0x746)]['id']),-0x1),_0x4a3da7['classList'][_0x3e3f30(0xaea)](_0x3e3f30(0xd3a))&&_0x1adcd7(parseInt(_0x4a3da7[_0x3e3f30(0x746)]['id']),0x1),_0x4a3da7[_0x3e3f30(0x159b)][_0x3e3f30(0xaea)](_0x3e3f30(0x1568))&&_0x383a35();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x572))[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x5292b3=_0xc64c06;if(_0x126669[_0x5292b3(0x58a)]===0x0)return;const _0x62d9ac=await _0x109970(_0x5292b3(0x55c),'确定要清空购物车中的所有商品吗？');_0x62d9ac&&(_0x126669=[],_0x552ba0(),_0x42157c());}),document[_0xc64c06(0x1f4)](_0xc64c06(0xdff))[_0xc64c06(0x122b)]('change',function(_0x20c394){const _0x10f3c7=_0xc64c06;document[_0x10f3c7(0x14bf)](_0x10f3c7(0xa2f))[_0x10f3c7(0x59b)](_0x388d3b=>{const _0x14e7a6=_0x10f3c7;_0x388d3b['checked']=_0x20c394[_0x14e7a6(0xb57)][_0x14e7a6(0xe56)];}),_0x383a35();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1242))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x408785=_0xc64c06;document[_0x408785(0x1f4)](_0x408785(0x1593))[_0x408785(0x159b)][_0x408785(0xa9c)](_0x408785(0xfca));}),document[_0xc64c06(0x1f4)](_0xc64c06(0xeb5))[_0xc64c06(0x122b)]('click',_0x4a1825),document['getElementById'](_0xc64c06(0xdaf))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x8c9652=>{const _0x4206c9=_0xc64c06,_0x1c6b75=_0x8c9652['target'][_0x4206c9(0x8b1)][0x0];if(_0x1c6b75){const _0x2e47bb=new FileReader();_0x2e47bb[_0x4206c9(0xcbe)]=_0x2d0ddd=>{const _0x305d5d=_0x4206c9;document[_0x305d5d(0x1f4)](_0x305d5d(0x15ba))['src']=_0x2d0ddd[_0x305d5d(0xb57)]['result'];},_0x2e47bb[_0x4206c9(0x21e)](_0x1c6b75);}}),document[_0xc64c06(0x1f4)]('chat-messages')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x1c79f1=>{const _0x2a75ef=_0xc64c06,_0x59bff4=_0x1c79f1[_0x2a75ef(0xb57)][_0x2a75ef(0x96a)](_0x2a75ef(0x78e));if(_0x59bff4){const _0x1ab0ba=_0x59bff4[_0x2a75ef(0x96a)](_0x2a75ef(0x251));_0x1ab0ba&&_0xe31fb(parseInt(_0x1ab0ba[_0x2a75ef(0x746)]['timestamp']));}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x14c4))[_0xc64c06(0x122b)]('click',()=>{const _0x57e9bb=_0xc64c06;document[_0x57e9bb(0x1f4)](_0x57e9bb(0x15d1))[_0x57e9bb(0x159b)][_0x57e9bb(0xa9c)]('visible');}),document[_0xc64c06(0x1f4)](_0xc64c06(0xacd))['addEventListener'](_0xc64c06(0x740),async()=>{const _0x18ff7d=_0xc64c06,_0x2fe5a4=Array[_0x18ff7d(0xa81)](document[_0x18ff7d(0x14bf)]('#gift-recipient-list\x20.contact-picker-item.selected'))[_0x18ff7d(0x1431)](_0x223ce7=>_0x223ce7[_0x18ff7d(0x746)]['recipientName']);if(_0x2fe5a4['length']===0x0){alert(_0x18ff7d(0x15cc));return;}const _0x3aa075=_0x126669[_0x18ff7d(0xede)](_0x478768=>document[_0x18ff7d(0xeda)](_0x18ff7d(0x143f)+_0x478768[_0x18ff7d(0x12f6)]+_0x18ff7d(0x426)));await _0xd5c77f(_0x3aa075,_0x2fe5a4),document[_0x18ff7d(0x1f4)]('gift-recipient-modal')[_0x18ff7d(0x159b)]['remove'](_0x18ff7d(0xfca));}),document[_0xc64c06(0x1f4)]('gift-recipient-list')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0xc743bc=>{const _0xab701c=_0xc64c06,_0x4d648b=_0xc743bc[_0xab701c(0xb57)]['closest'](_0xab701c(0x96b));_0x4d648b&&_0x4d648b['classList'][_0xab701c(0x1483)]('selected');}),document['getElementById']('select-all-recipients')[_0xc64c06(0x122b)]('change',function(_0x228605){const _0x434f37=_0xc64c06,_0x4377a9=_0x228605[_0x434f37(0xb57)]['checked'];document[_0x434f37(0x14bf)](_0x434f37(0xa02))[_0x434f37(0x59b)](_0x34ef3f=>{const _0x2fceea=_0x434f37;_0x34ef3f[_0x2fceea(0x159b)][_0x2fceea(0x1483)]('selected',_0x4377a9);});}),document['getElementById'](_0xc64c06(0x4f9))[_0xc64c06(0x122b)]('click',_0x42215c),document[_0xc64c06(0x1f4)](_0xc64c06(0x739))[_0xc64c06(0x122b)]('click',_0x1ac7c3),document['getElementById']('propel-btn')[_0xc64c06(0x122b)]('click',_0x3f8c33),document[_0xc64c06(0x1f4)](_0xc64c06(0xb8a))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x2fec72=_0xc64c06,_0x5bc032=document[_0x2fec72(0x1f4)](_0x2fec72(0xddb)),_0x47d7c2=document['getElementById']('notification-sound-url-input')['value'][_0x2fec72(0x4a2)]()||_0x2c09ea;_0x5bc032[_0x2fec72(0x9fe)]=_0x47d7c2,_0x5bc032[_0x2fec72(0x9ab)]()[_0x2fec72(0x3d1)](_0x427f59=>alert(_0x2fec72(0x133e)));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1076))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x159cf6=_0xc64c06;document['getElementById'](_0x159cf6(0xe07))[_0x159cf6(0x107e)]='',alert(_0x159cf6(0xc90));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x3b7))[_0xc64c06(0x122b)]('click',_0x22b354=>{const _0x27a241=_0xc64c06,_0x55030e=_0x22b354[_0x27a241(0xb57)];_0x55030e[_0x27a241(0x159b)][_0x27a241(0xaea)](_0x27a241(0x8f8))&&_0x514ed1(_0x55030e),_0x55030e[_0x27a241(0x159b)][_0x27a241(0xaea)](_0x27a241(0x2fd))&&_0x559e32(_0x55030e);}),document[_0xc64c06(0x1f4)]('add-song-search-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x3e6207),document['getElementById']('cancel-music-search-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x390519=_0xc64c06;document[_0x390519(0x1f4)](_0x390519(0x21d))[_0x390519(0x159b)][_0x390519(0xa9c)](_0x390519(0xfca));}),document['getElementById']('add-song-search-btn')[_0xc64c06(0x122b)]('click',_0x3e6207),document[_0xc64c06(0x1f4)](_0xc64c06(0x8a7))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x2d509a=_0xc64c06;document[_0x2d509a(0x1f4)](_0x2d509a(0x21d))['classList']['remove'](_0x2d509a(0xfca));}),document['getElementById'](_0xc64c06(0x737))[_0xc64c06(0x122b)](_0xc64c06(0x1147),function(_0x3b95e2){const _0x3423e5=_0xc64c06;document['querySelectorAll'](_0x3423e5(0x328))['forEach'](_0x3af6f5=>{const _0x427e5c=_0x3423e5;_0x3af6f5[_0x427e5c(0xe56)]=_0x3b95e2[_0x427e5c(0xb57)]['checked'];});}),document[_0xc64c06(0x1f4)](_0xc64c06(0x14d6))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x4c88af=>{const _0x5249ef=_0xc64c06,_0x3b25f1=_0x4c88af[_0x5249ef(0xb57)][_0x5249ef(0x96a)]('.search-result-item');if(_0x3b25f1){const _0x2ce568=_0x3b25f1['querySelector']('.music-search-checkbox');_0x2ce568&&(_0x4c88af[_0x5249ef(0xb57)]!==_0x2ce568&&(_0x2ce568[_0x5249ef(0xe56)]=!_0x2ce568[_0x5249ef(0xe56)]));}}),document['getElementById'](_0xc64c06(0xb9d))[_0xc64c06(0x122b)]('click',async()=>{const _0x2eb8b8=_0xc64c06,_0x15c4c8=document[_0x2eb8b8(0x14bf)](_0x2eb8b8(0x116f));if(_0x15c4c8[_0x2eb8b8(0x58a)]===0x0){alert(_0x2eb8b8(0x1206));return;}document[_0x2eb8b8(0x1f4)](_0x2eb8b8(0x21d))['classList'][_0x2eb8b8(0xa9c)](_0x2eb8b8(0xfca)),await _0x1460c5(_0x2eb8b8(0x11b7),_0x2eb8b8(0x917)+_0x15c4c8[_0x2eb8b8(0x58a)]+_0x2eb8b8(0x1012));const _0x5aaf9d=Array[_0x2eb8b8(0xa81)](_0x15c4c8)[_0x2eb8b8(0x1431)](_0x4b7dc6=>JSON[_0x2eb8b8(0x129c)](_0x4b7dc6[_0x2eb8b8(0x96a)](_0x2eb8b8(0x881))[_0x2eb8b8(0x746)][_0x2eb8b8(0xead)]));let _0x24c0ac=0x0,_0xa84d18=[];const _0x3508e0=_0x5aaf9d['map'](_0x3f3435=>_0x550ed0(_0x3f3435)),_0x4473e5=await Promise['all'](_0x3508e0);_0x4473e5[_0x2eb8b8(0x59b)]((_0x1ae838,_0x12451c)=>{const _0x153cab=_0x2eb8b8;_0x1ae838?(_0x5419de['playlist'][_0x153cab(0x1426)](_0x1ae838),_0x24c0ac++):_0xa84d18['push'](_0x5aaf9d[_0x12451c][_0x153cab(0x5d2)]);});_0x24c0ac>0x0&&(await _0x549080(),_0x13c03f(),_0x5419de[_0x2eb8b8(0x541)]===-0x1&&(_0x5419de[_0x2eb8b8(0x541)]=_0x5419de['playlist'][_0x2eb8b8(0x58a)]-_0x24c0ac,_0x5d7946()));let _0xa1d94a=_0x2eb8b8(0x7f9)+_0x24c0ac+'\x20首歌曲。';_0xa84d18[_0x2eb8b8(0x58a)]>0x0&&(_0xa1d94a+='\x0a\x0a'+_0xa84d18[_0x2eb8b8(0x58a)]+_0x2eb8b8(0x31c)+_0xa84d18[_0x2eb8b8(0x1143)](_0x2eb8b8(0x5bf))),await _0x1460c5(_0x2eb8b8(0x1291),_0xa1d94a);}),document[_0xc64c06(0x1f4)](_0xc64c06(0x14bb))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x379ce6=_0xc64c06;document[_0x379ce6(0x1f4)](_0x379ce6(0x14bb))[_0x379ce6(0x159b)][_0x379ce6(0x1483)](_0x379ce6(0xc0b));}),document['getElementById'](_0xc64c06(0x111f))['addEventListener']('click',_0x3e6207),document[_0xc64c06(0x1f4)](_0xc64c06(0x8a7))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0xc70488=_0xc64c06;document['getElementById'](_0xc70488(0x21d))[_0xc70488(0x159b)][_0xc70488(0xa9c)](_0xc70488(0xfca));}),document[_0xc64c06(0x1f4)]('search-results-list')['addEventListener']('click',_0xfed62c=>{const _0x4887f4=_0xc64c06,_0x1833c8=_0xfed62c['target'][_0x4887f4(0x96a)](_0x4887f4(0x881));if(_0x1833c8&&_0x1833c8[_0x4887f4(0x746)]['songJson']){const _0x1877f3=JSON[_0x4887f4(0x129c)](_0x1833c8['dataset'][_0x4887f4(0xead)]);handleSearchResultClick(_0x1877f3);}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x9b8))['addEventListener'](_0xc64c06(0x740),_0x2c5a3e),document[_0xc64c06(0x1f4)](_0xc64c06(0x7a6))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x57529d),document['getElementById'](_0xc64c06(0x6af))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0xf961e4),document[_0xc64c06(0x1f4)](_0xc64c06(0xe78))[_0xc64c06(0x122b)]('click',_0x9005f8),document[_0xc64c06(0x1f4)]('status-bar-toggle-switch')[_0xc64c06(0x122b)](_0xc64c06(0x1147),()=>{const _0x2dc800=_0xc64c06;_0x1ae02e[_0x2dc800(0x12c0)]['showStatusBar']=document[_0x2dc800(0x1f4)]('status-bar-toggle-switch')[_0x2dc800(0xe56)],_0x496c6d();}),document[_0xc64c06(0x1f4)]('qzone-more-actions-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x5157c4),document['getElementById'](_0xc64c06(0xa3c))['addEventListener'](_0xc64c06(0x740),()=>{const _0x2f6778=_0xc64c06;document['getElementById'](_0x2f6778(0x4a0))[_0x2f6778(0x159b)][_0x2f6778(0xa9c)]('visible');}),document[_0xc64c06(0x1f4)]('confirm-clear-posts-btn')[_0xc64c06(0x122b)]('click',_0x18b24f),document[_0xc64c06(0x1f4)](_0xc64c06(0x706))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x2c0e3b=>{const _0x208231=_0xc64c06,_0x14635a=_0x2c0e3b[_0x208231(0xb57)][_0x208231(0x96a)]('.clear-posts-item');_0x14635a&&_0x14635a['classList'][_0x208231(0x1483)](_0x208231(0xc3e));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x15ad))[_0xc64c06(0x122b)]('change',async _0x3d54f4=>{const _0x24e448=_0xc64c06,_0x1fea5d=_0x3d54f4[_0x24e448(0xb57)][_0x24e448(0x8b1)][0x0];if(_0x1fea5d){const _0x33965e=await new Promise(_0x210218=>{const _0x3ed7cc=_0x24e448,_0x1f3cab=new FileReader();_0x1f3cab['onload']=()=>_0x210218(_0x1f3cab[_0x3ed7cc(0xbc9)]),_0x1f3cab[_0x3ed7cc(0x21e)](_0x1fea5d);});_0x1ae02e[_0x24e448(0x12c0)][_0x24e448(0x3a1)]=_0x33965e,_0x1216fb();}_0x3d54f4[_0x24e448(0xb57)][_0x24e448(0x107e)]=null;}),document[_0xc64c06(0x1f4)](_0xc64c06(0xfec))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{_0x1ae02e['globalSettings']['globalChatBackground']='',_0x1216fb();}),document[_0xc64c06(0x1f4)]('save-wallpaper-btn')[_0xc64c06(0x122b)]('click',async()=>{const _0x4192fb=_0xc64c06;_0x13859b&&(_0x1ae02e['globalSettings'][_0x4192fb(0xd23)]=_0x13859b),_0x1ae02e[_0x4192fb(0x12c0)]['globalCss']=document[_0x4192fb(0x1f4)](_0x4192fb(0x242))[_0x4192fb(0x107e)]['trim'](),_0x1ae02e[_0x4192fb(0x12c0)][_0x4192fb(0xe88)]=document[_0x4192fb(0x1f4)](_0x4192fb(0xe07))[_0x4192fb(0x107e)]['trim'](),_0x1ae02e[_0x4192fb(0x12c0)]['showStatusBar']=document['getElementById'](_0x4192fb(0x36e))[_0x4192fb(0xe56)],await _0x3df81a[_0x4192fb(0x12c0)][_0x4192fb(0x295)](_0x1ae02e[_0x4192fb(0x12c0)]),_0x47f04e(),_0x13859b=null,_0x57e1d4(),_0x1807b6(_0x1ae02e['globalSettings'][_0x4192fb(0x359)]),_0x496c6d(),alert(_0x4192fb(0x6fa)),_0x2e53fa('home-screen');}),document[_0xc64c06(0x1f4)]('upload-global-bg-url-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x31090b=_0xc64c06,_0x3b4a00=await _0x11f6fb(_0x31090b(0x17a),_0x31090b(0x4d3),'',_0x31090b(0x258));if(_0x3b4a00&&_0x3b4a00[_0x31090b(0x4a2)]())_0x1ae02e[_0x31090b(0x12c0)][_0x31090b(0x3a1)]=_0x3b4a00[_0x31090b(0x4a2)](),_0x1216fb();else _0x3b4a00!==null&&alert('请输入有效的URL。');}),document['getElementById']('upload-ephone-bg-url-btn')['addEventListener'](_0xc64c06(0x740),async()=>{const _0x37595a=_0xc64c06,_0x6e76a4=await _0x11f6fb(_0x37595a(0x294),'请输入EPhone主屏幕的背景图片URL','',_0x37595a(0x258));if(_0x6e76a4&&_0x6e76a4[_0x37595a(0x4a2)]())_0x13859b=_0x6e76a4[_0x37595a(0x4a2)](),_0x1216fb();else _0x6e76a4!==null&&alert('请输入有效的URL。');}),document[_0xc64c06(0x1f4)]('upload-cphone-bg-url-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x496b68=_0xc64c06,_0x4cc27=await _0x11f6fb(_0x496b68(0xf20),_0x496b68(0xfc7),'',_0x496b68(0x258));if(_0x4cc27&&_0x4cc27[_0x496b68(0x4a2)]())_0x1ae02e['globalSettings']['cphoneWallpaper']=_0x4cc27[_0x496b68(0x4a2)](),_0x1216fb();else _0x4cc27!==null&&alert(_0x496b68(0x10a6));}),document[_0xc64c06(0x1f4)](_0xc64c06(0xbfa))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x247062=_0xc64c06;_0x13859b=null,_0x1ae02e[_0x247062(0x12c0)]['wallpaper']='',_0x1216fb();}),document['getElementById'](_0xc64c06(0xe98))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0xea4b6e=_0xc64c06;_0x1ae02e[_0xea4b6e(0x12c0)][_0xea4b6e(0x99f)]='',_0x1216fb();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x3bb))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x3cae5c),document[_0xc64c06(0x1f4)]('save-css-preset-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x5e03e1),document[_0xc64c06(0x1f4)](_0xc64c06(0x1486))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x925eac),document[_0xc64c06(0x1f4)]('font-preset-select')['addEventListener'](_0xc64c06(0x1147),_0x1622bd),document[_0xc64c06(0x1f4)](_0xc64c06(0xe9f))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x489b10),document['getElementById'](_0xc64c06(0x7d7))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0xf02c9f),document[_0xc64c06(0x1f4)](_0xc64c06(0x421))[_0xc64c06(0x122b)]('change',_0x495e16),document[_0xc64c06(0x1f4)](_0xc64c06(0x3cf))['addEventListener']('click',_0x38c15b),document[_0xc64c06(0x1f4)](_0xc64c06(0x850))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x1939b5),document[_0xc64c06(0x1f4)](_0xc64c06(0xe4b))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x1e402e),document['getElementById'](_0xc64c06(0xf8d))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x5c0deb=_0xc64c06;document[_0x5c0deb(0x1f4)]('sticker-category-manager-modal')[_0x5c0deb(0x159b)][_0x5c0deb(0xa9c)](_0x5c0deb(0xfca)),_0x3056ba();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x7e0))[_0xc64c06(0x122b)]('click',_0x26b112),document['getElementById']('existing-sticker-categories-list')[_0xc64c06(0x122b)]('click',_0x37e662=>{const _0x4df461=_0xc64c06;if(_0x37e662[_0x4df461(0xb57)][_0x4df461(0x159b)][_0x4df461(0xaea)](_0x4df461(0x2f5))){const _0x2e660d=parseInt(_0x37e662[_0x4df461(0xb57)][_0x4df461(0x746)]['id']);_0x42545b(_0x2e660d);}}),document[_0xc64c06(0x1f4)]('sticker-category-tabs')['addEventListener'](_0xc64c06(0x740),_0x2c1e8b=>{const _0x2afed1=_0xc64c06;if(_0x2c1e8b[_0x2afed1(0xb57)][_0x2afed1(0x159b)][_0x2afed1(0xaea)](_0x2afed1(0x666))){const _0x473bd4=_0x2c1e8b['target']['dataset'][_0x2afed1(0x1467)],_0x37031a=_0x473bd4!==_0x2afed1(0x54b)&&_0x473bd4!==_0x2afed1(0x139e)?parseInt(_0x473bd4):_0x473bd4;_0x51fdef(_0x37031a);}}),document['getElementById'](_0xc64c06(0x1c1))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x127ad0),document[_0xc64c06(0x1f4)](_0xc64c06(0xde4))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x4f5143),document[_0xc64c06(0x1f4)](_0xc64c06(0x82f))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x4cf25f=_0xc64c06;document[_0x4cf25f(0x1f4)]('import-single-chat-input')[_0x4cf25f(0x740)]();}),document[_0xc64c06(0x1f4)]('import-single-chat-input')['addEventListener'](_0xc64c06(0x1147),_0x9def3=>{const _0x2b2e3d=_0xc64c06,_0x7dd357=_0x9def3[_0x2b2e3d(0xb57)][_0x2b2e3d(0x8b1)][0x0];_0x7dd357&&_0x1f336e(_0x7dd357),_0x9def3[_0x2b2e3d(0xb57)]['value']=null;}),document[_0xc64c06(0x1f4)](_0xc64c06(0x14f0))[_0xc64c06(0x122b)]('click',()=>_0x19b93f()),document[_0xc64c06(0x1f4)]('add-char-diary-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>openDiaryEditor()),document[_0xc64c06(0x1f4)](_0xc64c06(0x164))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x5d54f8),document['getElementById'](_0xc64c06(0x11fd))[_0xc64c06(0x122b)]('click',_0x918322),document[_0xc64c06(0x1f4)](_0xc64c06(0xe48))[_0xc64c06(0x122b)]('click',_0x11d7e1),document[_0xc64c06(0x1f4)](_0xc64c06(0x112f))[_0xc64c06(0x122b)]('click',()=>{const _0x113caa=_0xc64c06,_0xbc330b=document[_0x113caa(0x1f4)]('char-diary-detail-content')[_0x113caa(0x6ba)];_0x1b02e6(_0xbc330b,'日记内容已复制！');}),document[_0xc64c06(0x1f4)](_0xc64c06(0x12eb))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x4ae3d2=_0xc64c06,_0x27ca09=document['getElementById'](_0x4ae3d2(0x955))[_0x4ae3d2(0x107e)];_0x1b02e6(_0x27ca09,'备忘录内容已复制！');}),document[_0xc64c06(0x1f4)]('copy-article-content-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x4faf46=_0xc64c06,_0xd0143c=document[_0x4faf46(0x1f4)](_0x4faf46(0x6f4))[_0x4faf46(0x6ba)];_0x1b02e6(_0xd0143c,_0x4faf46(0x521));}),document[_0xc64c06(0x1f4)]('regenerate-char-qq-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x353de2=_0xc64c06;_0x1460c5(_0x353de2(0x114c),_0x353de2(0x858));try{await Promise[_0x353de2(0x54b)]([_0x169d5d(),_0x4562fa()]),console[_0x353de2(0x57e)](_0x353de2(0x83d));}catch(_0x13de49){console[_0x353de2(0x127d)]('在同时执行两个函数时出错:',_0x13de49),await _0x1460c5(_0x353de2(0xc5a),'在执行组合操作时遇到错误:\x20'+_0x13de49[_0x353de2(0x11f0)]);}}),document[_0xc64c06(0x1f4)](_0xc64c06(0xdef))['addEventListener'](_0xc64c06(0x740),_0x4663f3=>{const _0x501e60=_0xc64c06,_0x5c8ad1=_0x4663f3[_0x501e60(0xb57)][_0x501e60(0x96a)](_0x501e60(0x12e5));if(_0x5c8ad1&&_0x5c8ad1[_0x501e60(0x746)][_0x501e60(0xe58)]){const _0x20c94e=parseInt(_0x5c8ad1[_0x501e60(0x746)][_0x501e60(0xe58)]);!isNaN(_0x20c94e)&&_0x54b7eb(_0x20c94e);}}),document['getElementById'](_0xc64c06(0xcf9))['addEventListener'](_0xc64c06(0x740),()=>{const _0x23d225=_0xc64c06;_0x1335d9(_0x23d225(0x453));});const _0x12ad5a=document[_0xc64c06(0x1f4)](_0xc64c06(0x95d)),_0x519593=()=>{const _0x1d4e22=_0xc64c06;if(_0x5b33ce!==_0x1d4e22(0xc77))return;if(_0x12ad5a['scrollTop']<0x1&&!_0x4d2c3e){const _0x19b269=_0x1ae02e[_0x1d4e22(0x589)][_0x2123eb]?.[_0x1d4e22(0xce3)][_0x1d4e22(0x58a)]||0x0;_0x19b269>_0x369c2d&&_0x5cf6f7();}};_0x12ad5a[_0xc64c06(0x122b)](_0xc64c06(0x1188),_0x519593),document[_0xc64c06(0x1f4)]('char-simulated-send-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x2d054a=_0xc64c06;alert(_0x2d054a(0x1c2));}),document[_0xc64c06(0x1f4)](_0xc64c06(0xc84))['addEventListener']('click',_0x10ea1e),document['getElementById'](_0xc64c06(0x14eb))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x50f6b1=>{const _0x104a9a=_0xc64c06,_0x3622a7=_0x50f6b1['target'][_0x104a9a(0x96a)](_0x104a9a(0x4da));if(_0x3622a7&&_0x3622a7[_0x104a9a(0x746)][_0x104a9a(0xdec)]){const _0x1692ce=_0x3622a7['dataset'][_0x104a9a(0xdec)];_0x1460c5(_0x104a9a(0xa5d),_0x1692ce['replace'](/\n/g,_0x104a9a(0xc9b)));}}),document[_0xc64c06(0x1f4)](_0xc64c06(0xb7b))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0xecabb9),document[_0xc64c06(0x1f4)](_0xc64c06(0x12f0))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x5b2548),document[_0xc64c06(0x1f4)](_0xc64c06(0x92c))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x206acd=>{const _0x39447b=_0xc64c06,_0x5404b5=_0x206acd['target'][_0x39447b(0x96a)]('.char-product-item');if(_0x5404b5&&_0x5404b5[_0x39447b(0x746)][_0x39447b(0x11d6)]){const _0x277377=_0x5404b5[_0x39447b(0x746)][_0x39447b(0x11d6)];_0x1460c5(_0x39447b(0x13bc),_0x277377[_0x39447b(0xef0)](/\n/g,_0x39447b(0xc9b)));}}),window[_0xc64c06(0x1313)]=_0x533dbb,document[_0xc64c06(0x1f4)]('regenerate-char-memo-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x1ab30b),document['getElementById'](_0xc64c06(0x136f))[_0xc64c06(0x122b)]('click',()=>_0x1335d9(_0xc64c06(0xb2a))),document[_0xc64c06(0x1f4)]('regenerate-char-diary-btn')['addEventListener'](_0xc64c06(0x740),_0x3c7fd1),document['getElementById'](_0xc64c06(0x1e6))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x2d26cb),document[_0xc64c06(0x1f4)](_0xc64c06(0x8bc))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>_0x1335d9(_0xc64c06(0x91c))),document[_0xc64c06(0x1f4)](_0xc64c06(0xcda))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x210fcc),document[_0xc64c06(0x1f4)](_0xc64c06(0xd0d))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x19852e),document[_0xc64c06(0x1f4)](_0xc64c06(0x639))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x1108ad),document['getElementById']('close-char-music-player-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x5e6345),document[_0xc64c06(0x1f4)](_0xc64c06(0xd4e))[_0xc64c06(0x122b)]('click',_0x50c6f2),document[_0xc64c06(0x1f4)](_0xc64c06(0xd4e))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x50c6f2),document[_0xc64c06(0x1f4)](_0xc64c06(0x882))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>_0x2e53fa(_0xc64c06(0x357))),document[_0xc64c06(0x1f4)](_0xc64c06(0xebe))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x2444ab),document[_0xc64c06(0x1f4)]('douban-wait-reply-btn')['addEventListener']('click',_0x2f2999),document[_0xc64c06(0x1f4)](_0xc64c06(0xa2c))[_0xc64c06(0x122b)]('change',async _0x119748=>{const _0x331365=_0xc64c06,_0x144d6b=_0x119748[_0x331365(0xb57)]['files'][0x0];if(_0x144d6b){const _0x6ec5b7=await new Promise(_0x5cfe5f=>{const _0x37bc83=_0x331365,_0x1f60db=new FileReader();_0x1f60db[_0x37bc83(0xcbe)]=()=>_0x5cfe5f(_0x1f60db[_0x37bc83(0xbc9)]),_0x1f60db['readAsDataURL'](_0x144d6b);});_0x1ae02e[_0x331365(0x12c0)]['cphoneWallpaper']=_0x6ec5b7,_0x1216fb();}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x70f))[_0xc64c06(0x122b)]('click',_0x4cbd31=>{const _0x598e07=_0xc64c06;if(_0x4cbd31['target'][_0x598e07(0x159b)][_0x598e07(0xaea)](_0x598e07(0xa1f))){const _0x2d4be1=_0x4cbd31[_0x598e07(0xb57)][_0x598e07(0x96a)](_0x598e07(0x1310)),_0x37d0c9=_0x2d4be1[_0x598e07(0x746)][_0x598e07(0x9a4)];_0x37d0c9&&_0x4ed932(_0x37d0c9,_0x598e07(0x7c9),_0x2d4be1);}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x6d5))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x38e609=_0xc64c06;document[_0x38e609(0x1f4)](_0x38e609(0x1185))[_0x38e609(0x740)]();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1185))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x2806ff=>{const _0x51d6b3=_0xc64c06,_0x58436c=_0x2806ff[_0x51d6b3(0xb57)]['files'][0x0];_0x58436c&&_0xb8cc7a(_0x58436c),_0x2806ff[_0x51d6b3(0xb57)][_0x51d6b3(0x107e)]=null;}),document['addEventListener']('visibilitychange',()=>{const _0x2f0f28=_0xc64c06;document[_0x2f0f28(0xdc2)]===_0x2f0f28(0xe89)&&(localStorage['setItem'](_0x2f0f28(0x567),Date['now']()),console[_0x2f0f28(0x57e)](_0x2f0f28(0x3f2)));}),document['getElementById'](_0xc64c06(0x1157))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x4ec9a5),document[_0xc64c06(0x1f4)](_0xc64c06(0x93f))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x1fed39=_0xc64c06;document[_0x1fed39(0x1f4)]('import-world-book-input')[_0x1fed39(0x740)]();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x779))['addEventListener'](_0xc64c06(0x1147),_0x45fede=>{const _0x4b4c48=_0xc64c06,_0x455e5b=_0x45fede[_0x4b4c48(0xb57)][_0x4b4c48(0x8b1)][0x0];_0x455e5b&&_0x4357ae(_0x455e5b),_0x45fede[_0x4b4c48(0xb57)]['value']=null;}),document[_0xc64c06(0x1f4)](_0xc64c06(0x76d))[_0xc64c06(0x122b)]('change',async _0x36c533=>{const _0x2ad56e=_0xc64c06,_0x573e8b=_0x36c533[_0x2ad56e(0xb57)]['checked'];_0x1ae02e[_0x2ad56e(0x12c0)]['enableAiDrawing']=_0x573e8b,await _0x3df81a[_0x2ad56e(0x12c0)]['put'](_0x1ae02e[_0x2ad56e(0x12c0)]);const _0x11670c=document[_0x2ad56e(0xeda)](_0x2ad56e(0x11a5));if(_0x11670c)switch(_0x11670c['id']){case _0x2ad56e(0x13c3):_0x3689f0(_0x1ae02e['activeChatId']);break;case _0x2ad56e(0x133d):if(document[_0x2ad56e(0x1f4)](_0x2ad56e(0x11b5))[_0x2ad56e(0x159b)][_0x2ad56e(0xaea)](_0x2ad56e(0x7cf)))_0x28d6f7();if(document[_0x2ad56e(0x1f4)](_0x2ad56e(0x128f))['classList'][_0x2ad56e(0xaea)](_0x2ad56e(0x7cf)))_0x2e35bf();break;case _0x2ad56e(0x357):_0x5591b9();break;case'douban-post-detail-screen':_0x419366(_0x4b6465);break;case'character-phone-screen':const _0x23f9cd=document[_0x2ad56e(0xeda)](_0x2ad56e(0x51c));if(_0x23f9cd)switch(_0x23f9cd['id']){case _0x2ad56e(0x13b3):_0x27df5a();break;case _0x2ad56e(0x7e4):_0x5c8c49();break;case _0x2ad56e(0x48f):const _0x29dd49=_0x1ae02e[_0x2ad56e(0x589)][_0x2123eb],_0x414ad2=_0x29dd49[_0x2ad56e(0xa6f)]||[],_0x2bb0a8=_0x414ad2['length']>0x0?_0x414ad2['length']-0x1:0x0;_0x31feba(_0x414ad2[_0x2bb0a8]);break;case'char-usage-screen':_0x5bafbb();break;case _0x2ad56e(0x453):_0x359b34();break;case'char-qq-conversation-screen':const _0x36d575=document[_0x2ad56e(0xeda)](_0x2ad56e(0x13f9))?.[_0x2ad56e(0x746)][_0x2ad56e(0xe58)]||0x0;_0x54b7eb(parseInt(_0x36d575));break;}break;}_0x1460c5(_0x2ad56e(0x15f),_0x2ad56e(0x1290)+(_0x573e8b?'开启':'关闭')+'。');}),document[_0xc64c06(0x1f4)](_0xc64c06(0xe3e))[_0xc64c06(0x122b)]('click',_0x166142),document[_0xc64c06(0x1f4)](_0xc64c06(0x139c))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{_0x2e53fa('chat-settings-screen');}),document[_0xc64c06(0x1f4)]('execute-search-btn')['addEventListener']('click',_0x555a8d),document[_0xc64c06(0x1f4)](_0xc64c06(0x1b8))['addEventListener']('click',_0x1feb48),document[_0xc64c06(0x1f4)](_0xc64c06(0x1339))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x3b63d6),document[_0xc64c06(0x1f4)](_0xc64c06(0xe5e))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x5e51d1),document[_0xc64c06(0xeda)]('#avatar-frame-modal\x20.modal-body')['addEventListener'](_0xc64c06(0x740),_0x1a4e02=>{const _0x37358d=_0xc64c06;if(_0x1a4e02[_0x37358d(0xb57)][_0x37358d(0x159b)][_0x37358d(0xaea)]('delete-btn')){const _0x5f3c6a=parseInt(_0x1a4e02[_0x37358d(0xb57)][_0x37358d(0x746)]['id']);!isNaN(_0x5f3c6a)&&_0x3dce11(_0x5f3c6a);}}),_0x5002c7(),window['openPresetScreen']=_0x4b4193,document[_0xc64c06(0x1f4)]('add-preset-btn')[_0xc64c06(0x122b)]('click',async()=>{const _0x343798=_0xc64c06,_0xc386bb=await _0x11f6fb('创建新预设','请输入预设名称');if(_0xc386bb&&_0xc386bb['trim']()){const _0x1c6b76={'id':'preset_'+Date[_0x343798(0xd6e)](),'name':_0xc386bb[_0x343798(0x4a2)](),'content':[]};await _0x3df81a[_0x343798(0xda0)]['add'](_0x1c6b76),await _0x65b939(),_0x2e4d29(_0x1c6b76['id']);}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x652))['addEventListener'](_0xc64c06(0x740),_0x58bd3d),document['getElementById']('add-preset-entry-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x17355a=_0xc64c06,_0x2e0bc3=document['getElementById']('preset-entries-container');_0x2e0bc3[_0x17355a(0xeda)]('p')&&(_0x2e0bc3[_0x17355a(0xf21)]='');const _0x2bd63e=_0x1f43ec();_0x2e0bc3[_0x17355a(0x6ce)](_0x2bd63e),_0x2bd63e[_0x17355a(0xeda)](_0x17355a(0xfe1))[_0x17355a(0xed2)]();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1146))['addEventListener'](_0xc64c06(0x740),async()=>{const _0x52d58f=_0xc64c06;if(!_0x1ebabd)return;const _0x16609f=await _0x3df81a[_0x52d58f(0xda0)]['get'](_0x1ebabd);if(!_0x16609f)return;const _0x50db14=document[_0x52d58f(0x1f4)](_0x52d58f(0x37e))[_0x52d58f(0x107e)][_0x52d58f(0x4a2)]();if(!_0x50db14){alert(_0x52d58f(0xe5c));return;}_0x16609f[_0x52d58f(0x5d2)]=_0x50db14,_0x16609f['categoryId']=parseInt(document[_0x52d58f(0x1f4)](_0x52d58f(0x10cf))[_0x52d58f(0x107e)])||null;const _0x4b901c=document[_0x52d58f(0x1f4)]('preset-entries-container'),_0x41ce60=_0x4b901c['querySelectorAll']('.message-editor-block'),_0x423e94=[];_0x41ce60[_0x52d58f(0x59b)](_0x13401b=>{const _0x3a21eb=_0x52d58f,_0x5c21eb=_0x13401b[_0x3a21eb(0xeda)]('.entry-content-textarea')['value'][_0x3a21eb(0x4a2)]();_0x5c21eb&&_0x423e94[_0x3a21eb(0x1426)]({'comment':_0x13401b['querySelector'](_0x3a21eb(0xbc5))[_0x3a21eb(0x107e)][_0x3a21eb(0x4a2)](),'keys':(_0x13401b[_0x3a21eb(0xeda)](_0x3a21eb(0x1307))[_0x3a21eb(0x107e)][_0x3a21eb(0x4a2)]()||'')[_0x3a21eb(0x23f)](',')[_0x3a21eb(0x1431)](_0x596f13=>_0x596f13[_0x3a21eb(0x4a2)]())[_0x3a21eb(0xede)](Boolean),'content':_0x5c21eb,'enabled':_0x13401b['querySelector'](_0x3a21eb(0x7c2))[_0x3a21eb(0xe56)]});}),_0x16609f[_0x52d58f(0x128c)]=_0x423e94,await _0x3df81a['presets']['put'](_0x16609f),_0x1ebabd=null,_0x2e53fa(_0x52d58f(0x1215)),await _0x65b939();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x7e1))[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x4982eb=_0xc64c06;try{await _0x431b54(),document[_0x4982eb(0x1f4)](_0x4982eb(0x14fa))[_0x4982eb(0x740)]();}catch(_0x42a4e6){console[_0x4982eb(0xb3b)](_0x4982eb(0x48a),_0x42a4e6[_0x4982eb(0x11f0)]);}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x14fa))['addEventListener']('change',_0x52f6c3),document[_0xc64c06(0x1f4)](_0xc64c06(0xa7f))[_0xc64c06(0x122b)]('click',_0xa1ee24),document[_0xc64c06(0x1f4)](_0xc64c06(0x1134))['addEventListener']('click',_0x513328),document[_0xc64c06(0x1f4)](_0xc64c06(0x19a))[_0xc64c06(0x122b)]('click',()=>{const _0x2ed7e8=_0xc64c06;document[_0x2ed7e8(0x1f4)]('data-clear-wizard-modal')[_0x2ed7e8(0x159b)]['remove'](_0x2ed7e8(0xfca));}),document[_0xc64c06(0x1f4)]('go-to-clear-step2-btn')['addEventListener'](_0xc64c06(0x740),_0xfad803),document[_0xc64c06(0x1f4)](_0xc64c06(0x1441))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x41003b),document['getElementById'](_0xc64c06(0x23a))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x4374a5=_0xc64c06;document[_0x4374a5(0x1f4)](_0x4374a5(0xb4c))[_0x4374a5(0x159b)]['remove'](_0x4374a5(0xfca));}),document['getElementById'](_0xc64c06(0x160))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x128b95),document[_0xc64c06(0x1f4)](_0xc64c06(0xb4c))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x2366e2=>{const _0x17bada=_0xc64c06,_0x4a1883=_0x2366e2[_0x17bada(0xb57)]['closest']('.clear-posts-item');_0x4a1883&&(_0x2366e2['stopPropagation'](),_0x4a1883['classList'][_0x17bada(0x1483)](_0x17bada(0xc3e)));}),document[_0xc64c06(0x1f4)](_0xc64c06(0xb4c))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x41f66d=>{const _0x112231=_0xc64c06;if(_0x41f66d[_0x112231(0xb57)]['id']==='select-all-chars-for-clear'){const _0x5e0b84=_0x41f66d['target'][_0x112231(0xe56)];document[_0x112231(0x14bf)](_0x112231(0xdf9))[_0x112231(0x59b)](_0x5172be=>{const _0x46fc21=_0x112231;_0x5172be[_0x46fc21(0x159b)][_0x46fc21(0x1483)]('selected',_0x5e0b84);});}else{if(_0x41f66d[_0x112231(0xb57)]['id']==='select-all-types-for-clear'){const _0x2b1680=_0x41f66d[_0x112231(0xb57)][_0x112231(0xe56)];document[_0x112231(0x14bf)]('#data-clear-type-list\x20.clear-posts-item')[_0x112231(0x59b)](_0x54b589=>{_0x54b589['classList']['toggle']('selected',_0x2b1680);});}}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x116d))[_0xc64c06(0x122b)]('click',_0x51a94c),document['getElementById']('copy-message-btn')[_0xc64c06(0x122b)]('click',_0x3cb484),document[_0xc64c06(0x1f4)]('copy-timestamp-btn')['addEventListener']('click',_0x16e0c2),document[_0xc64c06(0x1f4)](_0xc64c06(0x50a))['addEventListener'](_0xc64c06(0x740),()=>{_0x407a4b('messages-view');}),document[_0xc64c06(0x1f4)](_0xc64c06(0x4fa))['addEventListener'](_0xc64c06(0x740),()=>_0x2b00f0(null)),document[_0xc64c06(0x1f4)](_0xc64c06(0x334))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x1e8180),document[_0xc64c06(0x1f4)](_0xc64c06(0xca3))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x4e4224=>{const _0x234d64=_0xc64c06;_0x4e4224['target']['id']===_0x234d64(0x30f)&&_0x52554f();}),document[_0xc64c06(0x1f4)](_0xc64c06(0xe09))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x566cc7=_0xc64c06;document[_0x566cc7(0x1f4)](_0x566cc7(0xb5d))[_0x566cc7(0x159b)][_0x566cc7(0xa9c)](_0x566cc7(0xfca)),document[_0x566cc7(0x1f4)](_0x566cc7(0xca3))[_0x566cc7(0x159b)][_0x566cc7(0xaea)](_0x566cc7(0xfca))&&_0x2b00f0(editingNpcId);}),document[_0xc64c06(0x1f4)](_0xc64c06(0x10d5))[_0xc64c06(0x122b)]('click',_0x16a7ea),document['getElementById']('existing-npc-groups-list')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x17e1bd=>{const _0x5d395a=_0xc64c06;_0x17e1bd['target'][_0x5d395a(0x159b)][_0x5d395a(0xaea)](_0x5d395a(0x2f5))&&_0x231ff0(parseInt(_0x17e1bd[_0x5d395a(0xb57)][_0x5d395a(0x746)]['id']));}),document['getElementById']('cancel-npc-editor-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x5deedc=_0xc64c06;document['getElementById'](_0x5deedc(0xca3))[_0x5deedc(0x159b)]['remove'](_0x5deedc(0xfca));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x148c))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x56991a=>{const _0x509ffe=_0xc64c06,_0x166fa7=_0x56991a[_0x509ffe(0xb57)][_0x509ffe(0x8b1)][0x0];if(_0x166fa7){const _0x301db2=new FileReader();_0x301db2[_0x509ffe(0xcbe)]=_0x345db1=>{const _0x2dde25=_0x509ffe;document['getElementById'](_0x2dde25(0xba2))[_0x2dde25(0x9fe)]=_0x345db1[_0x2dde25(0xb57)]['result'];},_0x301db2[_0x509ffe(0x21e)](_0x166fa7);}}),document[_0xc64c06(0x1f4)]('chat-lock-overlay')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x33407a=>{const _0x15a2d9=_0xc64c06;if(_0x33407a[_0x15a2d9(0xb57)]['id']==='spectator-reroll-btn')_0x1532bd();else _0x33407a['target']['id']===_0x15a2d9(0x6ae)&&_0x3b3797();}),_0x1160f3(document[_0xc64c06(0x1f4)](_0xc64c06(0x14bb)),()=>{const _0x51ab24=_0xc64c06;_0x5419de['currentIndex']>-0x1&&_0x188dd6(_0x5419de[_0x51ab24(0x541)]);}),document['getElementById'](_0xc64c06(0x11f4))[_0xc64c06(0x122b)]('click',_0x95bb62),document['getElementById'](_0xc64c06(0x141e))[_0xc64c06(0x122b)]('click',_0x25d73f),document[_0xc64c06(0x1f4)](_0xc64c06(0xcc9))['addEventListener'](_0xc64c06(0x740),()=>{const _0x2cbd61=_0xc64c06;document[_0x2cbd61(0x1f4)]('douban-settings-modal')[_0x2cbd61(0x159b)][_0x2cbd61(0xa9c)](_0x2cbd61(0xfca));}),document[_0xc64c06(0x1f4)](_0xc64c06(0xb43))['addEventListener'](_0xc64c06(0x1557),_0x53519f=>{const _0x560dcb=_0xc64c06,_0x52ed97=_0x53519f[_0x560dcb(0xb57)][_0x560dcb(0x107e)][_0x560dcb(0x1f7)](),_0x19cbd2=document[_0x560dcb(0x1f4)](_0x560dcb(0x7ff));for(const _0x1d2fb5 of _0x19cbd2['options']){const _0x30de05=_0x1d2fb5['textContent'][_0x560dcb(0x1f7)]();_0x30de05[_0x560dcb(0xe82)](_0x52ed97)?_0x1d2fb5[_0x560dcb(0x215)]['display']='':_0x1d2fb5[_0x560dcb(0x215)]['display']=_0x560dcb(0x1b5);}}),window[_0xc64c06(0x142f)]=_0x5a357e,document[_0xc64c06(0x1f4)](_0xc64c06(0x3ad))['addEventListener'](_0xc64c06(0x740),()=>_0x5a357e('group')),document[_0xc64c06(0x1f4)](_0xc64c06(0x1354))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x588849=_0xc64c06;document[_0x588849(0x1f4)](_0x588849(0x41c))[_0x588849(0x159b)][_0x588849(0xa9c)]('visible');}),document[_0xc64c06(0x1f4)]('start-werewolf-game-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x2c0385),document[_0xc64c06(0x1f4)]('werewolf-role-confirm-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x3acc72=_0xc64c06;document[_0x3acc72(0x1f4)]('werewolf-role-modal')['classList'][_0x3acc72(0xa9c)](_0x3acc72(0xfca)),_0x269d10();}),document['getElementById']('exit-werewolf-game-btn')[_0xc64c06(0x122b)]('click',async()=>{const _0xc969db=_0xc64c06,_0x3539cc=await _0x109970(_0xc969db(0x1386),_0xc969db(0x1007),{'confirmButtonClass':_0xc969db(0x1c6)});_0x3539cc&&(_0x4b691c[_0xc969db(0xd51)]=![],_0x2e53fa(_0x4b691c[_0xc969db(0x3e0)]?_0xc969db(0x13c3):'home-screen'));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x110b))['addEventListener']('click',()=>{const _0x177ed0=_0xc64c06;document[_0x177ed0(0x1f4)](_0x177ed0(0x2ae))[_0x177ed0(0x159b)][_0x177ed0(0xa9c)](_0x177ed0(0xfca)),_0x2e53fa(_0x4b691c['chatId']?_0x177ed0(0x133d):_0x177ed0(0x3b7));}),document[_0xc64c06(0x1f4)](_0xc64c06(0xd38))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x38ba2c=_0xc64c06;document[_0x38ba2c(0x1f4)](_0x38ba2c(0x52d))[_0x38ba2c(0x159b)][_0x38ba2c(0xa9c)]('visible');}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1354))['addEventListener'](_0xc64c06(0x740),()=>{const _0x41ea6f=_0xc64c06;document[_0x41ea6f(0x1f4)](_0x41ea6f(0x41c))[_0x41ea6f(0x159b)][_0x41ea6f(0xa9c)]('visible');}),document[_0xc64c06(0x1f4)](_0xc64c06(0x888))[_0xc64c06(0x122b)]('click',_0x25e926),document[_0xc64c06(0x1f4)]('manual-werewolf-summary-btn')['addEventListener'](_0xc64c06(0x740),_0x5268df),document[_0xc64c06(0x1f4)]('check-and-fix-data-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x1ef920),document[_0xc64c06(0x1f4)]('dynamic-island-music-toggle-switch')['addEventListener'](_0xc64c06(0x1147),_0x1a750e=>{const _0x5d2933=_0xc64c06,_0x4c3aff=_0x1a750e[_0x5d2933(0xb57)][_0x5d2933(0xe56)];_0x1ae02e['globalSettings'][_0x5d2933(0xbde)]=_0x4c3aff;const _0x2f30d1=document['body'][_0x5d2933(0x159b)]['contains'](_0x5d2933(0x15af));if(_0x5419de[_0x5d2933(0xd51)]&&!_0x2f30d1){const _0x24962e=document['getElementById'](_0x5d2933(0x369)),_0x3d1744=document[_0x5d2933(0x1f4)]('phone-screen');_0x4c3aff?(_0x24962e[_0x5d2933(0x159b)][_0x5d2933(0xa9c)](_0x5d2933(0xfca)),_0x3d1744[_0x5d2933(0x159b)][_0x5d2933(0x6a4)]('dynamic-island-active')):(_0x3d1744[_0x5d2933(0x159b)][_0x5d2933(0xa9c)](_0x5d2933(0xd6c)),_0x5419de[_0x5d2933(0xc78)]&&_0x5419de[_0x5d2933(0xc78)][_0x5d2933(0x58a)]>0x0&&_0x24962e[_0x5d2933(0x159b)][_0x5d2933(0x6a4)](_0x5d2933(0xfca)));}}),document['getElementById']('delete-world-books-btn')['addEventListener'](_0xc64c06(0x740),_0x563e35),document[_0xc64c06(0x1f4)](_0xc64c06(0xd90))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x1e3203=_0xc64c06;document['getElementById'](_0x1e3203(0x6e8))[_0x1e3203(0x159b)][_0x1e3203(0xa9c)](_0x1e3203(0xfca));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x6d1))[_0xc64c06(0x122b)]('click',_0x196079),document[_0xc64c06(0x1f4)](_0xc64c06(0x6e8))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x45fc74=>{const _0x497b12=_0xc64c06,_0xd4c72b=_0x45fc74['target'][_0x497b12(0x96a)](_0x497b12(0x800));_0xd4c72b&&_0xd4c72b[_0x497b12(0x159b)][_0x497b12(0x1483)]('selected');if(_0x45fc74['target']['id']===_0x497b12(0x10f1)){const _0x23030e=_0x45fc74[_0x497b12(0xb57)][_0x497b12(0xe56)];document['querySelectorAll']('#delete-world-books-list\x20.clear-posts-item')[_0x497b12(0x59b)](_0x524beb=>{const _0x44cec6=_0x497b12;_0x524beb['classList'][_0x44cec6(0x1483)](_0x44cec6(0xc3e),_0x23030e);});}}),document[_0xc64c06(0x1f4)](_0xc64c06(0xf4a))[_0xc64c06(0x122b)](_0xc64c06(0x1557),()=>{_0x3056ba(![]);}),document['getElementById']('sticker-category-tabs')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x40e253=>{const _0x35e024=_0xc64c06;if(_0x40e253['target'][_0x35e024(0x159b)][_0x35e024(0xaea)](_0x35e024(0x666))){const _0x2e9d1d=_0x40e253['target'][_0x35e024(0x746)][_0x35e024(0x1467)],_0x31490e=_0x2e9d1d!==_0x35e024(0x54b)&&_0x2e9d1d!==_0x35e024(0x139e)?parseInt(_0x2e9d1d):_0x2e9d1d;document[_0x35e024(0x1f4)](_0x35e024(0xf4a))['value']='',_0x51fdef(_0x31490e);}});const _0x28819c=document['getElementById'](_0xc64c06(0xd31));_0x28819c[_0xc64c06(0x122b)](_0xc64c06(0x1188),()=>{const _0x3d9872=_0xc64c06;if(_0x28819c[_0x3d9872(0x2d4)]<0x1&&!_0x3e1778){const _0xe2c517=_0x1ae02e[_0x3d9872(0x589)][_0x1ae02e[_0x3d9872(0x588)]]?.[_0x3d9872(0xce3)][_0x3d9872(0x58a)]||0x0;_0xe2c517>_0x3dea4f&&_0x56ec48();}});const _0x5ede1e=document[_0xc64c06(0x1f4)](_0xc64c06(0x11be));_0x5ede1e[_0xc64c06(0x122b)](_0xc64c06(0x1188),()=>{const _0x1ed1b9=_0xc64c06,{scrollTop:_0x578d83,scrollHeight:_0x22c91a,clientHeight:_0x27a439}=_0x5ede1e;if(_0x22c91a-_0x578d83<=_0x27a439+0x32&&!_0x139519){const _0x5be37e=_0x1ae02e[_0x1ed1b9(0x589)][_0x1ae02e['activeChatId']]?.['thoughtsHistory'][_0x1ed1b9(0x58a)]||0x0;_0x5be37e>_0x8aa6f6&&_0x616eb2();}});const _0x5a789d=document[_0xc64c06(0xeda)](_0xc64c06(0x156a));_0x5a789d[_0xc64c06(0x122b)]('scroll',()=>{const _0x353f26=_0xc64c06,{scrollTop:_0x39642d,scrollHeight:_0x4421ca,clientHeight:_0xdda959}=_0x5a789d;_0x4421ca-_0x39642d<=_0xdda959+0x64&&!_0x121658&&(_0x6f01c2[_0x353f26(0x58a)]>_0x54afbd&&_0x2e2547());});const _0x3f97cc=document[_0xc64c06(0x1f4)](_0xc64c06(0x769));_0x3f97cc[_0xc64c06(0x122b)]('scroll',()=>{const {scrollTop:_0x280105,scrollHeight:_0x540018,clientHeight:_0x5775ba}=_0x3f97cc;_0x540018-_0x280105<=_0x5775ba+0x64&&!_0x11c436&&(_0x3d56b6['length']>_0x3a060d&&_0x540054());}),document[_0xc64c06(0x1f4)](_0xc64c06(0xfad))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x155917);const _0x48c575=document['getElementById'](_0xc64c06(0x1058));_0x2c3cea(_0x48c575,_0x48c575),document[_0xc64c06(0x1f4)](_0xc64c06(0x143a))['addEventListener'](_0xc64c06(0x740),_0x53af84),document[_0xc64c06(0x1f4)](_0xc64c06(0x15c1))[_0xc64c06(0x122b)]('click',_0x3a7baf),document[_0xc64c06(0x1f4)](_0xc64c06(0xa9f))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x18290e),document['getElementById'](_0xc64c06(0x407))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x2c12d0),document[_0xc64c06(0x1f4)](_0xc64c06(0xa8e))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x1c79a7),document[_0xc64c06(0x1f4)](_0xc64c06(0x555))[_0xc64c06(0x122b)]('click',_0x46c055),document[_0xc64c06(0x1f4)]('reading-restore-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x5eb709),_0x2c3cea(document[_0xc64c06(0x1f4)](_0xc64c06(0x669)),document[_0xc64c06(0xeda)](_0xc64c06(0x1459))),document['getElementById']('open-reading-library-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x3a7baf),document['getElementById']('close-reading-library-btn-header')['addEventListener']('click',()=>{const _0x31ed8d=_0xc64c06;document[_0x31ed8d(0x1f4)](_0x31ed8d(0xd50))[_0x31ed8d(0x159b)][_0x31ed8d(0xa9c)](_0x31ed8d(0xfca));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x49a))['addEventListener'](_0xc64c06(0x740),_0x159f9a),document[_0xc64c06(0x1f4)](_0xc64c06(0x16b))[_0xc64c06(0x122b)]('click',_0x2d9b15=>{const _0x3a020e=_0xc64c06,_0xcc134=_0x2d9b15[_0x3a020e(0xb57)];if(_0xcc134['classList'][_0x3a020e(0xaea)](_0x3a020e(0x13cc))){const _0xb4ae76=parseInt(_0xcc134[_0x3a020e(0x746)][_0x3a020e(0x5fc)]);_0x41d462(_0xb4ae76);}else{if(_0xcc134[_0x3a020e(0x159b)][_0x3a020e(0xaea)]('delete-group-btn')){const _0x2aa3a7=parseInt(_0xcc134[_0x3a020e(0x746)][_0x3a020e(0x5fc)]);_0x390735(_0x2aa3a7);}}}),document[_0xc64c06(0x1f4)]('page-indicator')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x389852),document[_0xc64c06(0x1f4)](_0xc64c06(0x156b))[_0xc64c06(0x122b)]('input',_0x39c742=>{const _0x2f545a=_0xc64c06;_0x44c88c(_0x39c742[_0x2f545a(0xb57)]['value']);});const _0x6e5b11=_0x3f35bb(_0x2667a3,0x12c);document[_0xc64c06(0x1f4)](_0xc64c06(0x5c3))[_0xc64c06(0x122b)](_0xc64c06(0x1188),_0x6e5b11),document['getElementById'](_0xc64c06(0x1496))[_0xc64c06(0x122b)](_0xc64c06(0x1557),_0x2588b1=>{const _0xec871f=_0xc64c06;document[_0xec871f(0x1f4)](_0xec871f(0x24b))[_0xec871f(0x231)]=_0x2588b1[_0xec871f(0xb57)][_0xec871f(0x107e)];});const _0x284d32=document[_0xc64c06(0x1f4)](_0xc64c06(0xeb0));_0x284d32[_0xc64c06(0x122b)](_0xc64c06(0x1188),()=>{const {scrollTop:_0x1f0f6c,scrollHeight:_0x2337f2,clientHeight:_0x3df458}=_0x284d32;_0x2337f2-_0x1f0f6c<=_0x3df458+0x96&&!_0x5cbd47&&_0x29147e();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x146d))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x55953a),document[_0xc64c06(0x1f4)](_0xc64c06(0xf06))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x343385=_0xc64c06;document[_0x343385(0x1f4)](_0x343385(0x148e))[_0x343385(0x159b)]['remove'](_0x343385(0xfca)),_0x25b813(_0x1f45c5);}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1370))['addEventListener'](_0xc64c06(0x740),_0x3b165b),document[_0xc64c06(0x1f4)]('existing-product-categories-list')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x26d342=>{const _0x750070=_0xc64c06;_0x26d342['target'][_0x750070(0x159b)][_0x750070(0xaea)](_0x750070(0x2f5))&&_0x3cb7af(parseInt(_0x26d342[_0x750070(0xb57)]['dataset']['id']));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x889))['addEventListener']('click',()=>_0x15c396()),document['getElementById'](_0xc64c06(0xb1b))[_0xc64c06(0x122b)]('click',()=>{const _0x4f11e4=_0xc64c06;document['getElementById'](_0x4f11e4(0xf33))[_0x4f11e4(0x159b)][_0x4f11e4(0xa9c)](_0x4f11e4(0xfca));}),document['getElementById'](_0xc64c06(0x434))['addEventListener']('click',()=>{const _0x5e5aef=_0xc64c06,_0x2a2e23=document[_0x5e5aef(0x1f4)](_0x5e5aef(0xa4d));let _0x4a11ed=parseInt(_0x2a2e23['textContent']);if(_0x4a11ed>0x1)_0x2a2e23[_0x5e5aef(0x231)]=_0x4a11ed-0x1;}),document[_0xc64c06(0x1f4)](_0xc64c06(0x425))[_0xc64c06(0x122b)]('click',()=>{const _0x3dd2b2=_0xc64c06,_0x5b8fc8=document['getElementById'](_0x3dd2b2(0xa4d));_0x5b8fc8[_0x3dd2b2(0x231)]=parseInt(_0x5b8fc8[_0x3dd2b2(0x231)])+0x1;}),document[_0xc64c06(0x1f4)](_0xc64c06(0xe4f))[_0xc64c06(0x122b)]('click',_0x5d2bd8=>{const _0x4986e7=_0xc64c06;if(_0x5d2bd8['target']['classList'][_0x4986e7(0xaea)]('product-category-tab')){const _0x293404=_0x5d2bd8[_0x4986e7(0xb57)][_0x4986e7(0x746)][_0x4986e7(0x1467)]==='all'?_0x4986e7(0x54b):parseInt(_0x5d2bd8[_0x4986e7(0xb57)][_0x4986e7(0x746)]['categoryId']);_0x4c2f6e(_0x293404);}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x149c))[_0xc64c06(0x122b)]('click',_0x2c72af),document['getElementById'](_0xc64c06(0xbb0))['addEventListener'](_0xc64c06(0x740),_0x401e06),document[_0xc64c06(0x1f4)](_0xc64c06(0x11da))[_0xc64c06(0x122b)]('click',_0x46a65b),document[_0xc64c06(0x1f4)](_0xc64c06(0x55a))['addEventListener']('click',()=>{const _0x3b6eaf=_0xc64c06;document[_0x3b6eaf(0x1f4)](_0x3b6eaf(0x130e))[_0x3b6eaf(0x159b)]['remove'](_0x3b6eaf(0xfca));}),document[_0xc64c06(0x1f4)](_0xc64c06(0xaec))['addEventListener'](_0xc64c06(0x1147),_0x46a244=>{const _0x55ecb9=_0xc64c06,_0x459b8a=_0x46a244[_0x55ecb9(0xb57)][_0x55ecb9(0xe56)],_0x1b9d7c=document[_0x55ecb9(0x14bf)](_0x55ecb9(0xff9));_0x1b9d7c[_0x55ecb9(0x59b)](_0x3b96dd=>{const _0x41f89e=_0x55ecb9,_0x273e7a=parseInt(_0x3b96dd[_0x41f89e(0x746)]['id']);_0x3b96dd[_0x41f89e(0x159b)][_0x41f89e(0x1483)](_0x41f89e(0xc3e),_0x459b8a),_0x459b8a?_0x3f6e69[_0x41f89e(0x6a4)](_0x273e7a):_0x3f6e69[_0x41f89e(0xc40)](_0x273e7a);}),document[_0x55ecb9(0x1f4)](_0x55ecb9(0x91e))[_0x55ecb9(0x231)]=_0x55ecb9(0x408)+_0x3f6e69[_0x55ecb9(0xb51)]+')';}),document[_0xc64c06(0x1f4)](_0xc64c06(0x91e))[_0xc64c06(0x122b)]('click',async()=>{const _0x492e78=_0xc64c06;if(_0x3f6e69[_0x492e78(0xb51)]===0x0){alert('请先选择要删除的商品。');return;}const _0x2fed3c=await _0x109970(_0x492e78(0xed1),'确定要永久删除选中的\x20'+_0x3f6e69[_0x492e78(0xb51)]+_0x492e78(0x1577),{'confirmButtonClass':'btn-danger'});_0x2fed3c&&(await _0x3df81a[_0x492e78(0xbf4)][_0x492e78(0xab7)]([..._0x3f6e69]),document[_0x492e78(0x1f4)]('manage-products-btn')['click'](),await _0x4faebc(),await _0x1460c5('成功',_0x492e78(0x1525)));}),document[_0xc64c06(0x1f4)]('appearance-preset-select')[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x166ae4),document[_0xc64c06(0x1f4)](_0xc64c06(0xe7d))['addEventListener'](_0xc64c06(0x740),_0x2d0876),document[_0xc64c06(0x1f4)](_0xc64c06(0x1202))['addEventListener'](_0xc64c06(0x740),_0x2c7aca),document[_0xc64c06(0x1f4)](_0xc64c06(0x6d8))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x2eafdf=>{const _0x3757d4=_0xc64c06,_0x4767a4=document[_0x3757d4(0x1f4)](_0x3757d4(0x158d));_0x4767a4[_0x3757d4(0x215)][_0x3757d4(0x887)]=_0x2eafdf[_0x3757d4(0xb57)]['checked']?_0x3757d4(0x361):_0x3757d4(0x1b5);}),document['getElementById'](_0xc64c06(0x55d))['addEventListener'](_0xc64c06(0x740),function(){const _0x3920ff=_0xc64c06,_0x407ae4=document['getElementById'](_0x3920ff(0x8f7));_0x407ae4[_0x3920ff(0xcbd)]===_0x3920ff(0x797)?(_0x407ae4[_0x3920ff(0xcbd)]=_0x3920ff(0x40f),this[_0x3920ff(0x231)]='😌'):(_0x407ae4[_0x3920ff(0xcbd)]=_0x3920ff(0x797),this[_0x3920ff(0x231)]='🧐');}),document[_0xc64c06(0x1f4)](_0xc64c06(0xfb6))['addEventListener'](_0xc64c06(0x740),()=>{const _0x429b90=_0xc64c06;_0x4e1ed1(),document[_0x429b90(0x1f4)](_0x429b90(0x11c4))[_0x429b90(0x215)]['display']=_0x429b90(0xeba);}),document[_0xc64c06(0x1f4)]('nai-cors-proxy')['addEventListener'](_0xc64c06(0x1147),_0x1f04f7=>{const _0x5f1220=_0xc64c06,_0x5e0a19=document['getElementById'](_0x5f1220(0xe8c));_0x1f04f7[_0x5f1220(0xb57)]['value']===_0x5f1220(0xb42)?_0x5e0a19[_0x5f1220(0x215)]['display']='block':_0x5e0a19[_0x5f1220(0x215)][_0x5f1220(0x887)]=_0x5f1220(0x1b5);}),document[_0xc64c06(0x1f4)]('close-novelai-settings')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x4dbf32=_0xc64c06;document[_0x4dbf32(0x1f4)](_0x4dbf32(0x11c4))['style']['display']=_0x4dbf32(0x1b5);}),document[_0xc64c06(0x1f4)]('save-nai-settings-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x32b967=_0xc64c06;_0x232297(),document[_0x32b967(0x1f4)](_0x32b967(0x11c4))['style'][_0x32b967(0x887)]=_0x32b967(0x1b5),alert(_0x32b967(0x410));}),document[_0xc64c06(0x1f4)](_0xc64c06(0xc85))['addEventListener'](_0xc64c06(0x740),()=>{const _0x42c518=_0xc64c06;confirm(_0x42c518(0xf5e))&&_0x288224();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x7ef))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x125c06=_0xc64c06,_0x592664=document[_0x125c06(0x1f4)](_0x125c06(0x8f7))[_0x125c06(0x107e)][_0x125c06(0x4a2)]();if(!_0x592664){alert(_0x125c06(0xe47));return;}document['getElementById'](_0x125c06(0x570))[_0x125c06(0x215)][_0x125c06(0x887)]=_0x125c06(0xeba),document['getElementById']('nai-test-result')['style'][_0x125c06(0x887)]=_0x125c06(0x1b5),document['getElementById'](_0x125c06(0xdcb))['style']['display']=_0x125c06(0x1b5);}),document[_0xc64c06(0x1f4)]('close-novelai-test')[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x39a6af=_0xc64c06;document[_0x39a6af(0x1f4)](_0x39a6af(0x570))[_0x39a6af(0x215)]['display']='none';}),document[_0xc64c06(0x1f4)](_0xc64c06(0x14bd))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x53bfc5=_0xc64c06;document[_0x53bfc5(0x1f4)](_0x53bfc5(0x570))[_0x53bfc5(0x215)]['display']=_0x53bfc5(0x1b5);}),document['getElementById'](_0xc64c06(0x9a0))[_0xc64c06(0x122b)]('click',async()=>{await _0x560edc();}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1429))['addEventListener'](_0xc64c06(0x740),()=>{const _0x19af64=_0xc64c06,_0x5ee6fb=document[_0x19af64(0x1f4)](_0x19af64(0x10b6)),_0x1d250a=document[_0x19af64(0x219)]('a');_0x1d250a[_0x19af64(0x4c6)]=_0x5ee6fb['src'],_0x1d250a[_0x19af64(0x1060)]=_0x19af64(0x346)+Date[_0x19af64(0xd6e)]()+'.png',_0x1d250a['click']();}),document['getElementById'](_0xc64c06(0x566))['addEventListener'](_0xc64c06(0x740),()=>{const _0x392b9f=_0xc64c06;if(!_0x1ae02e[_0x392b9f(0x588)])return;const _0x53f965=_0x1ae02e['chats'][_0x1ae02e[_0x392b9f(0x588)]],_0x5a5b13=_0x53f965[_0x392b9f(0x6a8)]['naiSettings']||{'promptSource':_0x392b9f(0x1594),'characterPositivePrompt':'','characterNegativePrompt':''};document[_0x392b9f(0x1f4)](_0x392b9f(0x530))['value']=_0x5a5b13['characterPositivePrompt']||'',document[_0x392b9f(0x1f4)](_0x392b9f(0x132c))[_0x392b9f(0x107e)]=_0x5a5b13[_0x392b9f(0x1220)]||'',document[_0x392b9f(0x1f4)](_0x392b9f(0xdb8))[_0x392b9f(0x215)]['display']=_0x392b9f(0xeba);}),document['getElementById'](_0xc64c06(0xff1))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0xd9d6fd=_0xc64c06;document[_0xd9d6fd(0x1f4)](_0xd9d6fd(0xdb8))[_0xd9d6fd(0x215)]['display']='none';}),document['getElementById'](_0xc64c06(0x12b2))[_0xc64c06(0x122b)](_0xc64c06(0x740),async()=>{const _0x3ae57f=_0xc64c06;if(!_0x1ae02e[_0x3ae57f(0x588)])return;const _0x39bfa4=_0x1ae02e[_0x3ae57f(0x589)][_0x1ae02e[_0x3ae57f(0x588)]];!_0x39bfa4[_0x3ae57f(0x6a8)]['naiSettings']&&(_0x39bfa4[_0x3ae57f(0x6a8)][_0x3ae57f(0x155d)]={'promptSource':_0x3ae57f(0x1594)}),_0x39bfa4[_0x3ae57f(0x6a8)][_0x3ae57f(0x155d)]['characterPositivePrompt']=document[_0x3ae57f(0x1f4)](_0x3ae57f(0x530))[_0x3ae57f(0x107e)]['trim'](),_0x39bfa4[_0x3ae57f(0x6a8)][_0x3ae57f(0x155d)]['characterNegativePrompt']=document[_0x3ae57f(0x1f4)](_0x3ae57f(0x132c))[_0x3ae57f(0x107e)][_0x3ae57f(0x4a2)](),console[_0x3ae57f(0x57e)]('💾\x20[专属弹窗]\x20保存角色NAI提示词'),console[_0x3ae57f(0x57e)]('\x20\x20\x20characterPositivePrompt:',_0x39bfa4[_0x3ae57f(0x6a8)]['naiSettings'][_0x3ae57f(0x62e)]),console[_0x3ae57f(0x57e)](_0x3ae57f(0x1165),_0x39bfa4[_0x3ae57f(0x6a8)][_0x3ae57f(0x155d)][_0x3ae57f(0x1220)]),console[_0x3ae57f(0x57e)](_0x3ae57f(0x8ff),_0x39bfa4['settings'][_0x3ae57f(0x155d)][_0x3ae57f(0x31d)]),await _0x3df81a[_0x3ae57f(0x589)][_0x3ae57f(0x295)](_0x39bfa4),document['getElementById'](_0x3ae57f(0xdb8))[_0x3ae57f(0x215)][_0x3ae57f(0x887)]=_0x3ae57f(0x1b5),alert(_0x3ae57f(0x54f));}),document[_0xc64c06(0x1f4)](_0xc64c06(0xb9a))['addEventListener'](_0xc64c06(0x740),()=>{const _0x5c3d80=_0xc64c06;confirm(_0x5c3d80(0x10dc))&&(document['getElementById'](_0x5c3d80(0x530))[_0x5c3d80(0x107e)]='',document[_0x5c3d80(0x1f4)]('character-nai-negative')[_0x5c3d80(0x107e)]='');}),document[_0xc64c06(0x1f4)](_0xc64c06(0xed6))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x2aca56=_0xc64c06;if(!_0x1ae02e['activeChatId'])return;const _0x2b7a68=_0x1ae02e['chats'][_0x1ae02e[_0x2aca56(0x588)]],_0xa5f3e1=_0x2b7a68[_0x2aca56(0x6a8)][_0x2aca56(0x155d)]||{'promptSource':_0x2aca56(0x1594),'characterPositivePrompt':'','characterNegativePrompt':''};document[_0x2aca56(0x1f4)]('character-nai-positive')['value']=_0xa5f3e1['characterPositivePrompt']||'',document[_0x2aca56(0x1f4)](_0x2aca56(0x132c))[_0x2aca56(0x107e)]=_0xa5f3e1[_0x2aca56(0x1220)]||'',document[_0x2aca56(0x1f4)](_0x2aca56(0xdb8))[_0x2aca56(0x215)][_0x2aca56(0x887)]=_0x2aca56(0xeba);}),document['getElementById'](_0xc64c06(0x440))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x5ac074),document[_0xc64c06(0x1f4)](_0xc64c06(0x1391))[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x4584cb),document[_0xc64c06(0x1f4)]('delete-selected-frames-btn')['addEventListener'](_0xc64c06(0x740),_0x24fb63),document[_0xc64c06(0x1f4)]('delete-current-category-btn')['addEventListener'](_0xc64c06(0x740),_0xca6a96),document[_0xc64c06(0x1f4)](_0xc64c06(0x7bf))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x53c356=_0xc64c06;_0x1335d9(_0x53c356(0x7e4));}),document[_0xc64c06(0x1f4)](_0xc64c06(0x856))[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x38b314=>{const _0x12edd9=_0xc64c06,_0x1fe4dc=_0x38b314['target'][_0x12edd9(0x96a)](_0x12edd9(0x96b));if(_0x1fe4dc){const _0x4a27a1=_0x1fe4dc[_0x12edd9(0xeda)](_0x12edd9(0x302));_0x4a27a1&&_0x38b314[_0x12edd9(0xb57)]!==_0x4a27a1&&(_0x4a27a1[_0x12edd9(0xe56)]=!_0x4a27a1[_0x12edd9(0xe56)]);}});const _0x54342e=document[_0xc64c06(0x1f4)](_0xc64c06(0x5dd));_0x1160f3(_0x54342e,_0xf8b728=>{const _0x40c8c8=_0xc64c06,_0x1fcc03=_0xf8b728[_0x40c8c8(0xb57)][_0x40c8c8(0x96a)](_0x40c8c8(0x51d));if(_0x1fcc03){_0xf8b728['preventDefault']();const _0x289d5c=_0x1fcc03[_0x40c8c8(0x746)][_0x40c8c8(0x1467)];if(_0x289d5c===_0x40c8c8(0x54b)){_0x1460c5('提示',_0x40c8c8(0xf39));return;}const _0x5ea33c=_0x289d5c===_0x40c8c8(0x139e)?'uncategorized':parseInt(_0x289d5c);_0xad4be9(_0x5ea33c);}}),document[_0xc64c06(0x1f4)](_0xc64c06(0x1326))[_0xc64c06(0x122b)]('click',_0x558681),document[_0xc64c06(0x1f4)](_0xc64c06(0x1ae))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>{const _0x466728=_0xc64c06;document[_0x466728(0x1f4)](_0x466728(0x301))[_0x466728(0x159b)]['remove'](_0x466728(0xfca));}),document[_0xc64c06(0x1f4)]('manage-nai-gallery-btn')[_0xc64c06(0x122b)]('click',_0x285672),document[_0xc64c06(0x1f4)](_0xc64c06(0x769))['addEventListener'](_0xc64c06(0x740),_0x2b3bf1=>{_0x38d6c1(_0x2b3bf1);}),document[_0xc64c06(0x1f4)]('select-all-nai-gallery-checkbox')[_0xc64c06(0x122b)](_0xc64c06(0x1147),_0x111552=>{const _0x49907f=_0xc64c06,_0x3ae285=_0x111552[_0x49907f(0xb57)][_0x49907f(0xe56)];document[_0x49907f(0x14bf)](_0x49907f(0x108c))[_0x49907f(0x59b)](_0x10b045=>{const _0x5dddbd=_0x49907f;_0x10b045['classList'][_0x5dddbd(0x1483)](_0x5dddbd(0xc3e),_0x3ae285);const _0xd822c7=_0x10b045[_0x5dddbd(0x746)]['key'];_0x3ae285?_0x48d248[_0x5dddbd(0x6a4)](_0xd822c7):_0x48d248['delete'](_0xd822c7);}),_0x3ee9b0();}),document['getElementById'](_0xc64c06(0x73a))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>_0x44eabb()),document[_0xc64c06(0x1f4)](_0xc64c06(0xd30))[_0xc64c06(0x122b)](_0xc64c06(0x740),()=>_0xd8e0b0()),document[_0xc64c06(0x1f4)](_0xc64c06(0xf3f))['addEventListener'](_0xc64c06(0x740),()=>{const _0xdc32c5=_0xc64c06;document[_0xdc32c5(0x8b9)]['classList']['toggle'](_0xdc32c5(0x2c7));}),document[_0xc64c06(0x1f4)]('profile-edit-btn')[_0xc64c06(0x122b)](_0xc64c06(0x740),_0x430345),_0x23d398(),_0x1e6f78(),_0x2e53fa(_0xc64c06(0x3b7));}_0x2642a0();});
</script>


</body>
</html>






































